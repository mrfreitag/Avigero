<?xml version="1.0" encoding="UTF-8" standalone="yes" ?>
<!DOCTYPE bugzilla SYSTEM "https://bugzilla.mozilla.org/bugzilla.dtd">

<bugzilla version="3.6.4+"
          urlbase="https://bugzilla.mozilla.org/"
          
          maintainer="bugzilla-admin@mozilla.org"
>

    <bug>
          <bug_id>648125</bug_id>
          
          <creation_ts>2011-04-06 14:40:00 -0700</creation_ts>
          <short_desc>Allow caching JS loaded with loadSubScript</short_desc>
          <delta_ts>2011-04-07 16:23:18 -0700</delta_ts>
          <reporter_accessible>1</reporter_accessible>
          <cclist_accessible>1</cclist_accessible>
          <classification_id>3</classification_id>
          <classification>Components</classification>
          <product>Core</product>
          <component>XPConnect</component>
          <version>Trunk</version>
          <rep_platform>All</rep_platform>
          <op_sys>All</op_sys>
          <bug_status>NEW</bug_status>
          
          
          
          
          
          
          <priority>--</priority>
          <bug_severity>normal</bug_severity>
          <target_milestone>---</target_milestone>
          
          <blocked>648124</blocked>
          
          <everconfirmed>1</everconfirmed>
          <reporter name="Dave Townsend (:Mossop)">dtownsend</reporter>
          <assigned_to name="Michael Wu [:mwu]">mwu</assigned_to>
          <cc>mwu</cc>
          <qa_contact>xpconnect</qa_contact>
          <cf_blocking_fennec>---</cf_blocking_fennec>
          <cf_blocking_fx>---</cf_blocking_fx>
          <cf_blocking_20>---</cf_blocking_20>
          <cf_status_20>---</cf_status_20>
          <cf_blocking_192>---</cf_blocking_192>
          <cf_status_192>---</cf_status_192>
          <cf_blocking_191>---</cf_blocking_191>
          <cf_status_191>---</cf_status_191>
          
          
          
          
          
          
          
          
          
          

      

      

      

          <long_desc isprivate="0">
            <commentid>5393273</commentid>
            <who name="Dave Townsend (:Mossop)">dtownsend</who>
            <bug_when>2011-04-06 14:40:57 -0700</bug_when>
            <thetext>Either directly or with a new API we could do with a means of caching JS loaded through loadSubScript, see bug 648124 for a prime use.</thetext>
          </long_desc>
          <long_desc isprivate="0">
            <commentid>5395400</commentid>
              <attachid>524525</attachid>
            <who name="Michael Wu [:mwu]">mwu</who>
            <bug_when>2011-04-07 16:23:18 -0700</bug_when>
            <thetext>Created attachment 524525
WIP: Cache subscripts in startupcache

Patch based on tracemonkey tip. Needs a bit more cleanup but it should work if someone wants to take this and measure how much time we save on bootstrap.js when cached.</thetext>
          </long_desc>
      
          <attachment
              isobsolete="0"
              ispatch="1"
              isprivate="0"
              isurl="0"
          >
            <attachid>524525</attachid>
            <date>2011-04-07 16:23:00 -0700</date>
            <delta_ts>2011-04-07 16:23:18 -0700</delta_ts>
            <desc>WIP: Cache subscripts in startupcache</desc>
            <filename>cache-subscripts</filename>
            <type>text/plain</type>
            <size>16688</size>
            <attacher>mwu</attacher>
            
              <data encoding="base64">IyBIRyBjaGFuZ2VzZXQgcGF0Y2gKIyBQYXJlbnQgYjdhOWU2N2YyZTU0NWQ2NTIyNjY0MzkzZTIy
ZDJlZmEzMjlhZTJmZAoKZGlmZiAtLWdpdCBhL2pzL3NyYy94cGNvbm5lY3QvbG9hZGVyL21vekpT
U3ViU2NyaXB0TG9hZGVyLmNwcCBiL2pzL3NyYy94cGNvbm5lY3QvbG9hZGVyL21vekpTU3ViU2Ny
aXB0TG9hZGVyLmNwcAotLS0gYS9qcy9zcmMveHBjb25uZWN0L2xvYWRlci9tb3pKU1N1YlNjcmlw
dExvYWRlci5jcHAKKysrIGIvanMvc3JjL3hwY29ubmVjdC9sb2FkZXIvbW96SlNTdWJTY3JpcHRM
b2FkZXIuY3BwCkBAIC02Miw4ICs2MiwxMyBAQAogI2luY2x1ZGUgImpzYXBpLmgiCiAjaW5jbHVk
ZSAianNkYmdhcGkuaCIKICNpbmNsdWRlICJqc2ZyaWVuZGFwaS5oIgorI2luY2x1ZGUgImpzeGRy
YXBpLmgiCiAKICNpbmNsdWRlICJtb3ppbGxhL0Z1bmN0aW9uVGltZXIuaCIKKyNpbmNsdWRlICJt
b3ppbGxhL3NjYWNoZS9TdGFydHVwQ2FjaGUuaCIKKyNpbmNsdWRlICJtb3ppbGxhL3NjYWNoZS9T
dGFydHVwQ2FjaGVVdGlscy5oIgorCit1c2luZyBuYW1lc3BhY2UgbW96aWxsYTo6c2NhY2hlOwog
CiAvKiBsb2FkKCkgZXJyb3IgbXNncywgWFhYIGxvY2FsaXplPyAqLwogI2RlZmluZSBMT0FEX0VS
Uk9SX05PU0VSVklDRSAiRXJyb3IgY3JlYXRpbmcgSU8gU2VydmljZS4iCkBAIC05Myw2ICs5OCwy
MzYgQEAgbW96SlNTdWJTY3JpcHRMb2FkZXI6On5tb3pKU1N1YlNjcmlwdExvYQogCiBOU19JTVBM
X1RIUkVBRFNBRkVfSVNVUFBPUlRTMShtb3pKU1N1YlNjcmlwdExvYWRlciwgbW96SUpTU3ViU2Ny
aXB0TG9hZGVyKQogCitzdGF0aWMgbnNyZXN1bHQKK1JlcG9ydEVycm9yKEpTQ29udGV4dCAqY3gs
IGNvbnN0IGNoYXIgKm1zZykKK3sKKyAgICBKU19TZXRQZW5kaW5nRXhjZXB0aW9uKGN4LCBTVFJJ
TkdfVE9fSlNWQUwoSlNfTmV3U3RyaW5nQ29weVooY3gsIG1zZykpKTsKKyAgICByZXR1cm4gTlNf
T0s7Cit9CisKK3N0YXRpYyBuc3Jlc3VsdAorUmVhZFNjcmlwdEZyb21TdHJlYW0oSlNDb250ZXh0
ICpjeCwgbnNJT2JqZWN0SW5wdXRTdHJlYW0gKnN0cmVhbSwKKyAgICAgICAgICAgICAgICAgICAg
IEpTT2JqZWN0ICoqc2NyaXB0T2JqKQoreworICAgICpzY3JpcHRPYmogPSBuc251bGw7CisKKyAg
ICBQUlVpbnQzMiBzaXplOworICAgIG5zcmVzdWx0IHJ2ID0gc3RyZWFtLT5SZWFkMzIoJnNpemUp
OworICAgIE5TX0VOU1VSRV9TVUNDRVNTKHJ2LCBydik7CisKKyAgICBjaGFyICpkYXRhOworICAg
IHJ2ID0gc3RyZWFtLT5SZWFkQnl0ZXMoc2l6ZSwgJmRhdGEpOworICAgIE5TX0VOU1VSRV9TVUND
RVNTKHJ2LCBydik7CisKKyAgICBKU1hEUlN0YXRlICp4ZHIgPSBKU19YRFJOZXdNZW0oY3gsIEpT
WERSX0RFQ09ERSk7CisgICAgTlNfRU5TVVJFX1RSVUUoeGRyLCBOU19FUlJPUl9PVVRfT0ZfTUVN
T1JZKTsKKworICAgIHhkci0+dXNlcmRhdGEgPSBzdHJlYW07CisgICAgSlNfWERSTWVtU2V0RGF0
YSh4ZHIsIGRhdGEsIHNpemUpOworCisgICAgaWYgKCFKU19YRFJTY3JpcHRPYmplY3QoeGRyLCBz
Y3JpcHRPYmopKSB7CisgICAgICAgIHJ2ID0gTlNfRVJST1JfRkFJTFVSRTsKKyAgICB9CisKKyAg
ICAvLyBVcGRhdGUgZGF0YSBpbiBjYXNlIDo6SlNfWERSU2NyaXB0IGNhbGxlZCBiYWNrIGludG8g
QysrIGNvZGUgdG8KKyAgICAvLyByZWFkIGFuIFhQQ09NIG9iamVjdC4KKyAgICAvLworICAgIC8v
IEluIHRoYXQgY2FzZSwgdGhlIHNlcmlhbGl6YXRpb24gcHJvY2VzcyBtdXN0IGhhdmUgZmx1c2hl
ZCBhIHJ1bgorICAgIC8vIG9mIGNvdW50ZWQgYnl0ZXMgY29udGFpbmluZyBKUyBkYXRhIGF0IHRo
ZSBwb2ludCB3aGVyZSB0aGUgWFBDT00KKyAgICAvLyBvYmplY3Qgc3RhcnRzLCBhZnRlciB3aGlj
aCBhbiBlbmNvZGluZyBDKysgY2FsbGJhY2sgZnJvbSB0aGUgSlMKKyAgICAvLyBYRFIgY29kZSBt
dXN0IGhhdmUgd3JpdHRlbiB0aGUgWFBDT00gb2JqZWN0IGRpcmVjdGx5IGludG8gdGhlCisgICAg
Ly8gbnNJT2JqZWN0T3V0cHV0U3RyZWFtLgorICAgIC8vCisgICAgLy8gVGhlIGRlc2VyaWFsaXph
dGlvbiBwcm9jZXNzIHdpbGwgWERSLWRlY29kZSBjb3VudGVkIGJ5dGVzIHVwIHRvCisgICAgLy8g
YnV0IG5vdCBpbmNsdWRpbmcgdGhlIFhQQ09NIG9iamVjdCwgdGhlbiBjYWxsIGJhY2sgaW50byBD
KysgdG8KKyAgICAvLyByZWFkIHRoZSBvYmplY3QsIHRoZW4gcmVhZCBtb3JlIGNvdW50ZWQgYnl0
ZXMgYW5kIGhhbmQgdGhlbSBvZmYKKyAgICAvLyB0byB0aGUgSlNYRFJTdGF0ZSwgc28gbW9yZSBK
UyBkYXRhIGNhbiBiZSBkZWNvZGVkLgorICAgIC8vCisgICAgLy8gVGhpcyBpbnRlcmxlYXZpbmcg
b2YgSlMgWERSIGRhdGEgYW5kIFhQQ09NIG9iamVjdCBkYXRhIG1heSBvY2N1cgorICAgIC8vIHNl
dmVyYWwgdGltZXMgYmVuZWF0aCB0aGUgY2FsbCB0byA6OkpTX1hEUlNjcmlwdCwgYWJvdmUuICBB
dCB0aGUKKyAgICAvLyBlbmQgb2YgdGhlIGRheSwgd2UgbmVlZCB0byBmcmVlICh2aWEgbnNNZW1v
cnkpIHRoZSBkYXRhIG93bmVkIGJ5CisgICAgLy8gdGhlIEpTWERSU3RhdGUuICBTbyB3ZSBzdGVh
bCBpdCBiYWNrLCBudWxsaW5nIHhkcidzIGJ1ZmZlciBzbyBpdAorICAgIC8vIGRvZXNuJ3QgZ2V0
IHBhc3NlZCB0byA6OkpTX2ZyZWUgYnkgOjpKU19YRFJEZXN0cm95LgorCisgICAgdWludDMyIGxl
bmd0aDsKKyAgICBkYXRhID0gc3RhdGljX2Nhc3Q8Y2hhcio+KEpTX1hEUk1lbUdldERhdGEoeGRy
LCAmbGVuZ3RoKSk7CisgICAgSlNfWERSTWVtU2V0RGF0YSh4ZHIsIG5zbnVsbCwgMCk7CisgICAg
SlNfWERSRGVzdHJveSh4ZHIpOworCisgICAgLy8gSWYgZGF0YSBpcyBudWxsIG5vdywgaXQgbXVz
dCBoYXZlIGJlZW4gZnJlZWQgd2hpbGUgZGVzZXJpYWxpemluZyBhbgorICAgIC8vIFhQQ09NIG9i
amVjdCAoZS5nLiwgYSBwcmluY2lwYWwpIGJlbmVhdGggOjpKU19YRFJTY3JpcHQuCisgICAgbnNN
ZW1vcnk6OkZyZWUoZGF0YSk7CisKKyAgICByZXR1cm4gcnY7Cit9CisKK3N0YXRpYyBuc3Jlc3Vs
dAorV3JpdGVTY3JpcHRUb1N0cmVhbShKU0NvbnRleHQgKmN4LCBKU09iamVjdCAqc2NyaXB0T2Jq
LAorICAgICAgICAgICAgICAgICAgICBuc0lPYmplY3RPdXRwdXRTdHJlYW0gKnN0cmVhbSkKK3sK
KyAgICBKU1hEUlN0YXRlICp4ZHIgPSBKU19YRFJOZXdNZW0oY3gsIEpTWERSX0VOQ09ERSk7Cisg
ICAgTlNfRU5TVVJFX1RSVUUoeGRyLCBOU19FUlJPUl9PVVRfT0ZfTUVNT1JZKTsKKworICAgIHhk
ci0+dXNlcmRhdGEgPSBzdHJlYW07CisgICAgbnNyZXN1bHQgcnYgPSBOU19PSzsKKworICAgIGlm
IChKU19YRFJTY3JpcHRPYmplY3QoeGRyLCAmc2NyaXB0T2JqKSkgeworICAgICAgICAvLyBHZXQg
dGhlIGVuY29kZWQgSlNYRFJTdGF0ZSBkYXRhIGFuZCB3cml0ZSBpdC4gIFRoZSBKU1hEUlN0YXRl
IG93bnMKKyAgICAgICAgLy8gdGhpcyBidWZmZXIgbWVtb3J5IGFuZCB3aWxsIGZyZWUgaXQgYmVu
ZWF0aCA6OkpTX1hEUkRlc3Ryb3kuCisgICAgICAgIC8vCisgICAgICAgIC8vIElmIGFuIFhQQ09N
IG9iamVjdCBuZWVkcyB0byBiZSB3cml0dGVuIGluIHRoZSBtaWRzdCBvZiB0aGUgSlMgWERSCisg
ICAgICAgIC8vIGVuY29kaW5nIHByb2Nlc3MsIHRoZSBDKysgY29kZSBjYWxsZWQgYmFjayBmcm9t
IHRoZSBKUyBlbmdpbmUgKGUuZy4sCisgICAgICAgIC8vIG5zRW5jb2RlSlNQcmluY2lwYWxzIGlu
IGNhcHMvc3JjL25zSlNQcmluY2lwYWxzLmNwcCkgd2lsbCBmbHVzaCBkYXRhCisgICAgICAgIC8v
IGZyb20gdGhlIEpTWERSU3RhdGUgdG8gYVN0cmVhbSwgdGhlbiB3cml0ZSB0aGUgb2JqZWN0LCB0
aGVuIHJldHVybgorICAgICAgICAvLyB0byBKUyBYRFIgY29kZSB3aXRoIHhkciByZXNldCBzbyBu
ZXcgSlMgZGF0YSBpcyBlbmNvZGVkIGF0IHRoZSBmcm9udAorICAgICAgICAvLyBvZiB0aGUgeGRy
J3MgZGF0YSBidWZmZXIuCisgICAgICAgIC8vCisgICAgICAgIC8vIEhvd2V2ZXIgbWFueSBYUENP
TSBvYmplY3RzIGFyZSBpbnRlcmxlYXZlZCB3aXRoIEpTIFhEUiBkYXRhIGluIHRoZQorICAgICAg
ICAvLyBzdHJlYW0sIHdoZW4gY29udHJvbCByZXR1cm5zIGhlcmUgZnJvbSA6OkpTX1hEUlNjcmlw
dCwgd2UnbGwgaGF2ZQorICAgICAgICAvLyBvbmUgbGFzdCBidWZmZXIgb2YgZGF0YSB0byB3cml0
ZSB0byBhU3RyZWFtLgorCisgICAgICAgIHVpbnQzMiBzaXplOworICAgICAgICBjb25zdCBjaGFy
KiBkYXRhID0gcmVpbnRlcnByZXRfY2FzdDxjb25zdCBjaGFyKj4KKyAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAoSlNfWERSTWVtR2V0RGF0YSh4ZHIsICZzaXplKSk7
CisgICAgICAgIE5TX0FTU0VSVElPTihkYXRhLCAibm8gZGVjb2RlZCBKU1hEUlN0YXRlIGRhdGEh
Iik7CisKKyAgICAgICAgcnYgPSBzdHJlYW0tPldyaXRlMzIoc2l6ZSk7CisgICAgICAgIGlmIChO
U19TVUNDRUVERUQocnYpKSB7CisgICAgICAgICAgICBydiA9IHN0cmVhbS0+V3JpdGVCeXRlcyhk
YXRhLCBzaXplKTsKKyAgICAgICAgfQorICAgIH0gZWxzZSB7CisgICAgICAgIHJ2ID0gTlNfRVJS
T1JfRkFJTFVSRTsgLy8gbGlrZWx5IHRvIGJlIGEgcHJpbmNpcGFscyBzZXJpYWxpemF0aW9uIGVy
cm9yCisgICAgfQorCisgICAgSlNfWERSRGVzdHJveSh4ZHIpOworICAgIHJldHVybiBydjsKK30K
Kworc3RhdGljIG5zcmVzdWx0CitSZWFkQ2FjaGVkU2NyaXB0KFN0YXJ0dXBDYWNoZSogY2FjaGUs
IG5zQUNTdHJpbmcgJnVyaSwgSlNDb250ZXh0ICpjeCwgSlNPYmplY3QgKipzY3JpcHRPYmopCit7
CisgICAgbnNyZXN1bHQgcnY7CisKKyAgICBuc0F1dG9BcnJheVB0cjxjaGFyPiBidWY7CisgICAg
UFJVaW50MzIgbGVuOworICAgIHJ2ID0gY2FjaGUtPkdldEJ1ZmZlcihQcm9taXNlRmxhdENTdHJp
bmcodXJpKS5nZXQoKSwgZ2V0dGVyX1RyYW5zZmVycyhidWYpLAorICAgICAgICAgICAgICAgICAg
ICAgICAgICAmbGVuKTsKKyAgICBpZiAoTlNfRkFJTEVEKHJ2KSkgeworICAgICAgICByZXR1cm4g
cnY7IC8vIGRvbid0IHdhcm4gc2luY2UgTk9UX0FWQUlMQUJMRSBpcyBhbiBvayBlcnJvcgorICAg
IH0KKworICAgIG5zQ09NUHRyPG5zSU9iamVjdElucHV0U3RyZWFtPiBvaXM7CisgICAgcnYgPSBO
U19OZXdPYmplY3RJbnB1dFN0cmVhbUZyb21CdWZmZXIoYnVmLCBsZW4sIGdldHRlcl9BZGRSZWZz
KG9pcykpOworICAgIE5TX0VOU1VSRV9TVUNDRVNTKHJ2LCBydik7CisgICAgYnVmLmZvcmdldCgp
OworCisgICAgcmV0dXJuIFJlYWRTY3JpcHRGcm9tU3RyZWFtKGN4LCBvaXMsIHNjcmlwdE9iaik7
Cit9CisKK3N0YXRpYyBuc3Jlc3VsdAorV3JpdGVDYWNoZWRTY3JpcHQoU3RhcnR1cENhY2hlKiBj
YWNoZSwgbnNBQ1N0cmluZyAmdXJpLCBKU0NvbnRleHQgKmN4LCBKU09iamVjdCAqc2NyaXB0T2Jq
KQoreworICAgIG5zcmVzdWx0IHJ2OworCisgICAgbnNDT01QdHI8bnNJT2JqZWN0T3V0cHV0U3Ry
ZWFtPiBvb3M7CisgICAgbnNDT01QdHI8bnNJU3RvcmFnZVN0cmVhbT4gc3RvcmFnZVN0cmVhbTsK
KyAgICBydiA9IE5TX05ld09iamVjdE91dHB1dFdyYXBwZWRTdG9yYWdlU3RyZWFtKGdldHRlcl9B
ZGRSZWZzKG9vcyksCisgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICBnZXR0ZXJfQWRkUmVmcyhzdG9yYWdlU3RyZWFtKSk7CisgICAgTlNfRU5TVVJFX1NVQ0NF
U1MocnYsIHJ2KTsKKworICAgIHJ2ID0gV3JpdGVTY3JpcHRUb1N0cmVhbShjeCwgc2NyaXB0T2Jq
LCBvb3MpOworICAgIG9vcy0+Q2xvc2UoKTsKKyAgICBOU19FTlNVUkVfU1VDQ0VTUyhydiwgcnYp
OworCisgICAgbnNBdXRvQXJyYXlQdHI8Y2hhcj4gYnVmOworICAgIFBSVWludDMyIGxlbjsKKyAg
ICBydiA9IE5TX05ld0J1ZmZlckZyb21TdG9yYWdlU3RyZWFtKHN0b3JhZ2VTdHJlYW0sIGdldHRl
cl9UcmFuc2ZlcnMoYnVmKSwKKyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICZsZW4pOworICAgIE5TX0VOU1VSRV9TVUNDRVNTKHJ2LCBydik7CisKKyAgICBydiA9IGNhY2hl
LT5QdXRCdWZmZXIoUHJvbWlzZUZsYXRDU3RyaW5nKHVyaSkuZ2V0KCksIGJ1ZiwgbGVuKTsKKyAg
ICByZXR1cm4gcnY7Cit9CisKK25zcmVzdWx0Cittb3pKU1N1YlNjcmlwdExvYWRlcjo6UmVhZFNj
cmlwdChuc0lVUkkgKnVyaSwgSlNDb250ZXh0ICpjeCwgSlNPYmplY3QgKnRhcmdldF9vYmosCisg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBqc2NoYXIgKmNoYXJzZXQsIGNvbnN0IGNo
YXIgKnVyaVN0ciwKKyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG5zSUlPU2Vydmlj
ZSAqc2VydiwgSlNPYmplY3QgKipzY3JpcHRPYmpwKQoreworICAgIG5zQ09NUHRyPG5zSUNoYW5u
ZWw+ICAgICBjaGFuOworICAgIG5zQ09NUHRyPG5zSUlucHV0U3RyZWFtPiBpbnN0cmVhbTsKKyAg
ICBKU1ByaW5jaXBhbHMgICAgKmpzUHJpbmNpcGFsczsKKyAgICBKU0Vycm9yUmVwb3J0ZXIgIGVy
OworCisgICAgbnNyZXN1bHQgcnY7CisgICAgLy8gSW5zdGVhZCBvZiBjYWxsaW5nIE5TX09wZW5V
UkksIHdlIGNyZWF0ZSB0aGUgY2hhbm5lbCBvdXJzZWx2ZXMgYW5kIGNhbGwKKyAgICAvLyBTZXRD
b250ZW50VHlwZSwgdG8gYXZvaWQgZXhwZW5zaXZlIE1JTUUgdHlwZSBsb29rdXBzIChidWcgNjMy
NDkwKS4KKyAgICBydiA9IE5TX05ld0NoYW5uZWwoZ2V0dGVyX0FkZFJlZnMoY2hhbiksIHVyaSwg
c2VydiwKKyAgICAgICAgICAgICAgICAgICAgICAgbnNudWxsLCBuc251bGwsIG5zSVJlcXVlc3Q6
OkxPQURfTk9STUFMKTsKKyAgICBpZiAoTlNfU1VDQ0VFREVEKHJ2KSkgeworICAgICAgICBjaGFu
LT5TZXRDb250ZW50VHlwZShOU19MSVRFUkFMX0NTVFJJTkcoImFwcGxpY2F0aW9uL2phdmFzY3Jp
cHQiKSk7CisgICAgICAgIHJ2ID0gY2hhbi0+T3BlbihnZXR0ZXJfQWRkUmVmcyhpbnN0cmVhbSkp
OworICAgIH0KKworICAgIGlmIChOU19GQUlMRUQocnYpKSB7CisgICAgICAgIHJldHVybiBSZXBv
cnRFcnJvcihjeCwgTE9BRF9FUlJPUl9OT1NUUkVBTSk7CisgICAgfQorICAgIAorICAgIFBSSW50
MzIgbGVuID0gLTE7CisKKyAgICBydiA9IGNoYW4tPkdldENvbnRlbnRMZW5ndGgoJmxlbik7Cisg
ICAgaWYgKE5TX0ZBSUxFRChydikgfHwgbGVuID09IC0xKSB7CisgICAgICAgIHJldHVybiBSZXBv
cnRFcnJvcihjeCwgTE9BRF9FUlJPUl9OT0NPTlRFTlQpOworICAgIH0KKworICAgIG5zQ1N0cmlu
ZyBidWY7CisgICAgcnYgPSBOU19SZWFkSW5wdXRTdHJlYW1Ub1N0cmluZyhpbnN0cmVhbSwgYnVm
LCBsZW4pOworICAgIGlmIChOU19GQUlMRUQocnYpKQorICAgICAgICByZXR1cm4gcnY7CisKKyAg
ICAvKiB3ZSBjYW4ndCBob2xkIG9udG8ganNQcmluY2lwYWxzIGFzIGEgbW9kdWxlIHZhciBiZWNh
dXNlIHRoZQorICAgICAqIEpTUFJJTkNJUEFMU19EUk9QIG1hY3JvIHRha2VzIGEgSlNDb250ZXh0
LCB3aGljaCB3ZSB3b24ndCBoYXZlIGluIHRoZQorICAgICAqIGRlc3RydWN0b3IgKi8KKyAgICBy
diA9IG1TeXN0ZW1QcmluY2lwYWwtPkdldEpTUHJpbmNpcGFscyhjeCwgJmpzUHJpbmNpcGFscyk7
CisgICAgaWYgKE5TX0ZBSUxFRChydikgfHwgIWpzUHJpbmNpcGFscykgeworICAgICAgICByZXR1
cm4gUmVwb3J0RXJyb3IoY3gsIExPQURfRVJST1JfTk9QUklOQ0lQQUxTKTsKKyAgICB9CisKKyAg
ICAvKiBzZXQgb3VyIG93biBlcnJvciByZXBvcnRlciBzbyB3ZSBjYW4gcmVwb3J0IGFueSBiYWQg
dGhpbmdzIGFzIGNhdGNoYWJsZQorICAgICAqIGV4Y2VwdGlvbnMsIGluY2x1ZGluZyB0aGUgc291
cmNlL2xpbmUgbnVtYmVyICovCisgICAgZXIgPSBKU19TZXRFcnJvclJlcG9ydGVyIChjeCwgbW96
SlNMb2FkZXJFcnJvclJlcG9ydGVyKTsKKworICAgIGlmIChjaGFyc2V0KSB7CisgICAgICAgIG5z
U3RyaW5nIHNjcmlwdDsKKyAgICAgICAgcnYgPSBuc1NjcmlwdExvYWRlcjo6Q29udmVydFRvVVRG
MTYoCisgICAgICAgICAgICAgICAgbnNudWxsLCByZWludGVycHJldF9jYXN0PGNvbnN0IFBSVWlu
dDgqPihidWYuZ2V0KCkpLCBsZW4sCisgICAgICAgICAgICAgICAgbnNEZXBlbmRlbnRTdHJpbmco
cmVpbnRlcnByZXRfY2FzdDxQUlVuaWNoYXIqPihjaGFyc2V0KSksIG5zbnVsbCwgc2NyaXB0KTsK
KworICAgICAgICBpZiAoTlNfRkFJTEVEKHJ2KSkgeworICAgICAgICAgICAgSlNQUklOQ0lQQUxT
X0RST1AoY3gsIGpzUHJpbmNpcGFscyk7CisgICAgICAgICAgICByZXR1cm4gUmVwb3J0RXJyb3Io
Y3gsIExPQURfRVJST1JfQkFEQ0hBUlNFVCk7CisgICAgICAgIH0KKworICAgICAgICAqc2NyaXB0
T2JqcCA9CisgICAgICAgICAgICBKU19Db21waWxlVUNTY3JpcHRGb3JQcmluY2lwYWxzVmVyc2lv
bihjeCwgdGFyZ2V0X29iaiwganNQcmluY2lwYWxzLAorICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVpbnRlcnByZXRfY2FzdDxjb25zdCBqc2NoYXIq
PihzY3JpcHQuZ2V0KCkpLAorICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgc2NyaXB0Lkxlbmd0aCgpLCB1cmlTdHIsIDEsCisgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBKU1ZFUlNJT05fTEFURVNUKTsKKyAg
ICB9IGVsc2UgeworICAgICAgICAqc2NyaXB0T2JqcCA9IEpTX0NvbXBpbGVTY3JpcHRGb3JQcmlu
Y2lwYWxzVmVyc2lvbihjeCwgdGFyZ2V0X29iaiwganNQcmluY2lwYWxzLCBidWYuZ2V0KCksCisg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBs
ZW4sIHVyaVN0ciwgMSwgSlNWRVJTSU9OX0xBVEVTVCk7CisgICAgfQorCisgICAgSlNQUklOQ0lQ
QUxTX0RST1AoY3gsIGpzUHJpbmNpcGFscyk7CisKKyAgICAvKiByZXBlbnQgZm9yIG91ciBldmls
IGRlZWRzICovCisgICAgSlNfU2V0RXJyb3JSZXBvcnRlcihjeCwgZXIpOworCisgICAgaWYgKCEq
c2NyaXB0T2JqcCkKKyAgICAgICAgcmV0dXJuIE5TX0VSUk9SX1VORVhQRUNURUQ7CisgICAgcmV0
dXJuIE5TX09LOworfQorCiBOU19JTUVUSE9ESU1QIC8qIGFyZ3MgYW5kIHJldHVybiB2YWx1ZSBh
cmUgZGVsdCB3aXRoIHVzaW5nIFhQQ29ubmVjdCBhbmQgSlNBUEkgKi8KIG1vekpTU3ViU2NyaXB0
TG9hZGVyOjpMb2FkU3ViU2NyaXB0IChjb25zdCBQUlVuaWNoYXIgKiBhVVJMCiAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgLyogWywgSlNPYmplY3QgKnRhcmdldF9vYmpdICov
KQpAQCAtMjI5LDE3ICs0NjQsNiBAQCBtb3pKU1N1YlNjcmlwdExvYWRlcjo6TG9hZFN1YlNjcmlw
dCAoY29uCiAKICAgICAvKiBsb2FkIHVwIHRoZSB1cmwuICBGcm9tIGhlcmUgb24sIGZhaWx1cmVz
IGFyZSByZWZsZWN0ZWQgYXMgYGBjdXN0b20nJwogICAgICAqIGpzIGV4Y2VwdGlvbnMgKi8KLSAg
ICBQUkludDMyICAgbGVuID0gLTE7Ci0gICAgUFJVaW50MzIgIHJlYWRjb3VudCA9IDA7ICAvLyBU
b3RhbCBhbW91bnQgb2YgZGF0YSByZWFkCi0gICAgUFJVaW50MzIgIGxhc3RSZWFkQ291bnQgPSAw
OyAgLy8gQW1vdW50IG9mIGRhdGEgcmVhZCBpbiBsYXN0IFJlYWQoKSBjYWxsCi0gICAgbnNBdXRv
QXJyYXlQdHI8Y2hhcj4gYnVmOwotICAgIAotICAgIEpTU3RyaW5nICAgICAgICAqZXJybXNnOwot
ICAgIEpTRXJyb3JSZXBvcnRlciAgZXI7Ci0gICAgSlNQcmluY2lwYWxzICAgICpqc1ByaW5jaXBh
bHM7Ci0gICAgCi0gICAgbnNDT01QdHI8bnNJQ2hhbm5lbD4gICAgIGNoYW47Ci0gICAgbnNDT01Q
dHI8bnNJSW5wdXRTdHJlYW0+IGluc3RyZWFtOwogICAgIG5zQ09NUHRyPG5zSVVSST4gdXJpOwog
ICAgIG5zQ0F1dG9TdHJpbmcgdXJpU3RyOwogICAgIG5zQ0F1dG9TdHJpbmcgc2NoZW1lOwpAQCAt
MjYzLDMyICs0ODcsMjcgQEAgbW96SlNTdWJTY3JpcHRMb2FkZXI6OkxvYWRTdWJTY3JpcHQgKGNv
bgogICAgICAgICByZXR1cm4gTlNfRVJST1JfRkFJTFVSRTsKICAgICB9CiAKKyAgICBTdGFydHVw
Q2FjaGUqIGNhY2hlID0gU3RhcnR1cENhY2hlOjpHZXRTaW5nbGV0b24oKTsKICAgICBuc0NPTVB0
cjxuc0lJT1NlcnZpY2U+IHNlcnYgPSBkb19HZXRTZXJ2aWNlKE5TX0lPU0VSVklDRV9DT05UUkFD
VElEKTsKLSAgICBpZiAoIXNlcnYpCi0gICAgewotICAgICAgICBlcnJtc2cgPSBKU19OZXdTdHJp
bmdDb3B5WiAoY3gsIExPQURfRVJST1JfTk9TRVJWSUNFKTsKLSAgICAgICAgZ290byByZXR1cm5f
ZXhjZXB0aW9uOworICAgIGlmICghc2VydikgeworICAgICAgICByZXR1cm4gUmVwb3J0RXJyb3Io
Y3gsIExPQURfRVJST1JfTk9TRVJWSUNFKTsKICAgICB9CiAKICAgICAvLyBNYWtlIHN1cmUgdG8g
ZXhwbGljaXRseSBjcmVhdGUgdGhlIFVSSSwgc2luY2Ugd2UnbGwgbmVlZCB0aGUKICAgICAvLyBj
YW5vbmljYWxpemVkIHNwZWMuCiAgICAgcnYgPSBOU19OZXdVUkkoZ2V0dGVyX0FkZFJlZnModXJp
KSwgdXJsYnl0ZXMucHRyKCksIG5zbnVsbCwgc2Vydik7CiAgICAgaWYgKE5TX0ZBSUxFRChydikp
IHsKLSAgICAgICAgZXJybXNnID0gSlNfTmV3U3RyaW5nQ29weVogKGN4LCBMT0FEX0VSUk9SX05P
VVJJKTsKLSAgICAgICAgZ290byByZXR1cm5fZXhjZXB0aW9uOworICAgICAgICByZXR1cm4gUmVw
b3J0RXJyb3IoY3gsIExPQURfRVJST1JfTk9VUkkpOwogICAgIH0KIAogICAgIHJ2ID0gdXJpLT5H
ZXRTcGVjKHVyaVN0cik7CiAgICAgaWYgKE5TX0ZBSUxFRChydikpIHsKLSAgICAgICAgZXJybXNn
ID0gSlNfTmV3U3RyaW5nQ29weVogKGN4LCBMT0FEX0VSUk9SX05PU1BFQyk7Ci0gICAgICAgIGdv
dG8gcmV0dXJuX2V4Y2VwdGlvbjsKKyAgICAgICAgcmV0dXJuIFJlcG9ydEVycm9yKGN4LCBMT0FE
X0VSUk9SX05PU1BFQyk7CiAgICAgfSAgICAKIAogICAgIHJ2ID0gdXJpLT5HZXRTY2hlbWUoc2No
ZW1lKTsKLSAgICBpZiAoTlNfRkFJTEVEKHJ2KSkKLSAgICB7Ci0gICAgICAgIGVycm1zZyA9IEpT
X05ld1N0cmluZ0NvcHlaIChjeCwgTE9BRF9FUlJPUl9OT1NDSEVNRSk7Ci0gICAgICAgIGdvdG8g
cmV0dXJuX2V4Y2VwdGlvbjsKKyAgICBpZiAoTlNfRkFJTEVEKHJ2KSkgeworICAgICAgICByZXR1
cm4gUmVwb3J0RXJyb3IoY3gsIExPQURfRVJST1JfTk9TQ0hFTUUpOwogICAgIH0KIAogICAgIGlm
ICghc2NoZW1lLkVxdWFsc0xpdGVyYWwoImNocm9tZSIpKQpAQCAtMjk2LDEwICs1MTUsOCBAQCBt
b3pKU1N1YlNjcmlwdExvYWRlcjo6TG9hZFN1YlNjcmlwdCAoY29uCiAgICAgICAgIC8vIFRoaXMg
bWlnaHQgYmUgYSBVUkkgdG8gYSBsb2NhbCBmaWxlLCB0aG91Z2ghCiAgICAgICAgIG5zQ09NUHRy
PG5zSVVSST4gaW5uZXJVUkkgPSBOU19HZXRJbm5lcm1vc3RVUkkodXJpKTsKICAgICAgICAgbnND
T01QdHI8bnNJRmlsZVVSTD4gZmlsZVVSTCA9IGRvX1F1ZXJ5SW50ZXJmYWNlKGlubmVyVVJJKTsK
LSAgICAgICAgaWYgKCFmaWxlVVJMKQotICAgICAgICB7Ci0gICAgICAgICAgICBlcnJtc2cgPSBK
U19OZXdTdHJpbmdDb3B5WiAoY3gsIExPQURfRVJST1JfVVJJX05PVF9MT0NBTCk7Ci0gICAgICAg
ICAgICBnb3RvIHJldHVybl9leGNlcHRpb247CisgICAgICAgIGlmICghZmlsZVVSTCkgeworICAg
ICAgICAgICAgcmV0dXJuIFJlcG9ydEVycm9yKGN4LCBMT0FEX0VSUk9SX1VSSV9OT1RfTE9DQUwp
OwogICAgICAgICB9CiAKICAgICAgICAgLy8gRm9yIGZpbGUgVVJJcyBwcmVwZW5kIHRoZSBmaWxl
bmFtZSB3aXRoIHRoZSBmaWxlbmFtZSBvZiB0aGUKQEAgLTMxMSwxMDYgKzUyOCwzMyBAQCBtb3pK
U1N1YlNjcmlwdExvYWRlcjo6TG9hZFN1YlNjcmlwdCAoY29uCiAgICAgICAgIHVyaVN0ciA9IHRt
cDsKICAgICB9CiAKLSAgICAvLyBJbnN0ZWFkIG9mIGNhbGxpbmcgTlNfT3BlblVSSSwgd2UgY3Jl
YXRlIHRoZSBjaGFubmVsIG91cnNlbHZlcyBhbmQgY2FsbAotICAgIC8vIFNldENvbnRlbnRUeXBl
LCB0byBhdm9pZCBleHBlbnNpdmUgTUlNRSB0eXBlIGxvb2t1cHMgKGJ1ZyA2MzI0OTApLgotICAg
IHJ2ID0gTlNfTmV3Q2hhbm5lbChnZXR0ZXJfQWRkUmVmcyhjaGFuKSwgdXJpLCBzZXJ2LAotICAg
ICAgICAgICAgICAgICAgICAgICBuc251bGwsIG5zbnVsbCwgbnNJUmVxdWVzdDo6TE9BRF9OT1JN
QUwpOwotICAgIGlmIChOU19TVUNDRUVERUQocnYpKQotICAgIHsKLSAgICAgICAgY2hhbi0+U2V0
Q29udGVudFR5cGUoTlNfTElURVJBTF9DU1RSSU5HKCJhcHBsaWNhdGlvbi9qYXZhc2NyaXB0Iikp
OwotICAgICAgICBydiA9IGNoYW4tPk9wZW4oZ2V0dGVyX0FkZFJlZnMoaW5zdHJlYW0pKTsKKyAg
ICBib29sIHdyaXRlU2NyaXB0ID0gZmFsc2U7CisgICAgSlNPYmplY3QgKnNjcmlwdE9iaiA9IG5z
bnVsbDsKKyAgICBydiA9IFJlYWRDYWNoZWRTY3JpcHQoY2FjaGUsIHVyaVN0ciwgY3gsICZzY3Jp
cHRPYmopOworICAgIGlmICghc2NyaXB0T2JqKSB7CisgICAgICAgIHJ2ID0gUmVhZFNjcmlwdCh1
cmksIGN4LCB0YXJnZXRfb2JqLCBjaGFyc2V0LCAoY2hhciAqKXVyaVN0ci5nZXQoKSwgc2Vydiwg
JnNjcmlwdE9iaik7CisgICAgICAgIHdyaXRlU2NyaXB0ID0gdHJ1ZTsKICAgICB9CiAKICAgICBp
ZiAoTlNfRkFJTEVEKHJ2KSkKLSAgICB7Ci0gICAgICAgIGVycm1zZyA9IEpTX05ld1N0cmluZ0Nv
cHlaIChjeCwgTE9BRF9FUlJPUl9OT1NUUkVBTSk7Ci0gICAgICAgIGdvdG8gcmV0dXJuX2V4Y2Vw
dGlvbjsKLSAgICB9Ci0gICAgCi0gICAgcnYgPSBjaGFuLT5HZXRDb250ZW50TGVuZ3RoICgmbGVu
KTsKLSAgICBpZiAoTlNfRkFJTEVEKHJ2KSB8fCBsZW4gPT0gLTEpCi0gICAgewotICAgICAgICBl
cnJtc2cgPSBKU19OZXdTdHJpbmdDb3B5WiAoY3gsIExPQURfRVJST1JfTk9DT05URU5UKTsKLSAg
ICAgICAgZ290byByZXR1cm5fZXhjZXB0aW9uOwotICAgIH0KKyAgICAgICAgcmV0dXJuIHJ2Owog
Ci0gICAgYnVmID0gbmV3IGNoYXJbbGVuICsgMV07Ci0gICAgaWYgKCFidWYpCi0gICAgICAgIHJl
dHVybiBOU19FUlJPUl9PVVRfT0ZfTUVNT1JZOwotICAgIGJ1ZltsZW5dID0gJ1wwJzsKLSAgICAK
LSAgICBkbyB7Ci0gICAgICAgIHJ2ID0gaW5zdHJlYW0tPlJlYWQgKGJ1ZiArIHJlYWRjb3VudCwg
bGVuIC0gcmVhZGNvdW50LCAmbGFzdFJlYWRDb3VudCk7Ci0gICAgICAgIGlmIChOU19GQUlMRUQo
cnYpKQotICAgICAgICB7Ci0gICAgICAgICAgICBlcnJtc2cgPSBKU19OZXdTdHJpbmdDb3B5WiAo
Y3gsIExPQURfRVJST1JfQkFEUkVBRCk7Ci0gICAgICAgICAgICBnb3RvIHJldHVybl9leGNlcHRp
b247Ci0gICAgICAgIH0KLSAgICAgICAgcmVhZGNvdW50ICs9IGxhc3RSZWFkQ291bnQ7Ci0gICAg
fSB3aGlsZSAobGFzdFJlYWRDb3VudCAmJiByZWFkY291bnQgIT0gUFJVaW50MzIobGVuKSk7Ci0g
ICAgCi0gICAgaWYgKHN0YXRpY19jYXN0PFBSVWludDMyPihsZW4pICE9IHJlYWRjb3VudCkKLSAg
ICB7Ci0gICAgICAgIGVycm1zZyA9IEpTX05ld1N0cmluZ0NvcHlaIChjeCwgTE9BRF9FUlJPUl9S
RUFEVU5ERVJGTE9XKTsKLSAgICAgICAgZ290byByZXR1cm5fZXhjZXB0aW9uOwotICAgIH0KKyAg
ICBvayA9IGZhbHNlOworICAgIGlmIChzY3JpcHRPYmopCisgICAgICAgIG9rID0gSlNfRXhlY3V0
ZVNjcmlwdFZlcnNpb24oY3gsIHRhcmdldF9vYmosIHNjcmlwdE9iaiwgcnZhbCwgSlNWRVJTSU9O
X0xBVEVTVCk7CiAKLSAgICAvKiB3ZSBjYW4ndCBob2xkIG9udG8ganNQcmluY2lwYWxzIGFzIGEg
bW9kdWxlIHZhciBiZWNhdXNlIHRoZQotICAgICAqIEpTUFJJTkNJUEFMU19EUk9QIG1hY3JvIHRh
a2VzIGEgSlNDb250ZXh0LCB3aGljaCB3ZSB3b24ndCBoYXZlIGluIHRoZQotICAgICAqIGRlc3Ry
dWN0b3IgKi8KLSAgICBydiA9IG1TeXN0ZW1QcmluY2lwYWwtPkdldEpTUHJpbmNpcGFscyhjeCwg
JmpzUHJpbmNpcGFscyk7Ci0gICAgaWYgKE5TX0ZBSUxFRChydikgfHwgIWpzUHJpbmNpcGFscykK
LSAgICB7Ci0gICAgICAgIGVycm1zZyA9IEpTX05ld1N0cmluZ0NvcHlaIChjeCwgTE9BRF9FUlJP
Ul9OT1BSSU5DSVBBTFMpOwotICAgICAgICBnb3RvIHJldHVybl9leGNlcHRpb247Ci0gICAgfQot
Ci0gICAgLyogc2V0IG91ciBvd24gZXJyb3IgcmVwb3J0ZXIgc28gd2UgY2FuIHJlcG9ydCBhbnkg
YmFkIHRoaW5ncyBhcyBjYXRjaGFibGUKLSAgICAgKiBleGNlcHRpb25zLCBpbmNsdWRpbmcgdGhl
IHNvdXJjZS9saW5lIG51bWJlciAqLwotICAgIGVyID0gSlNfU2V0RXJyb3JSZXBvcnRlciAoY3gs
IG1vekpTTG9hZGVyRXJyb3JSZXBvcnRlcik7Ci0KLSAgICBpZiAoY2hhcnNldCkKLSAgICB7Ci0g
ICAgICAgIG5zU3RyaW5nIHNjcmlwdDsKLSAgICAgICAgcnYgPSBuc1NjcmlwdExvYWRlcjo6Q29u
dmVydFRvVVRGMTYoCi0gICAgICAgICAgICAgICAgbnNudWxsLCByZWludGVycHJldF9jYXN0PFBS
VWludDgqPihidWYuZ2V0KCkpLCBsZW4sCi0gICAgICAgICAgICAgICAgbnNEZXBlbmRlbnRTdHJp
bmcocmVpbnRlcnByZXRfY2FzdDxQUlVuaWNoYXIqPihjaGFyc2V0KSksIG5zbnVsbCwgc2NyaXB0
KTsKLQotICAgICAgICBpZiAoTlNfRkFJTEVEKHJ2KSkKLSAgICAgICAgewotICAgICAgICAgICAg
SlNQUklOQ0lQQUxTX0RST1AoY3gsIGpzUHJpbmNpcGFscyk7Ci0gICAgICAgICAgICBlcnJtc2cg
PSBKU19OZXdTdHJpbmdDb3B5WihjeCwgTE9BRF9FUlJPUl9CQURDSEFSU0VUKTsKLSAgICAgICAg
ICAgIGdvdG8gcmV0dXJuX2V4Y2VwdGlvbjsKLSAgICAgICAgfQotICAgICAgICBvayA9IEpTX0V2
YWx1YXRlVUNTY3JpcHRGb3JQcmluY2lwYWxzKGN4LCB0YXJnZXRfb2JqLCBqc1ByaW5jaXBhbHMs
Ci0gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVpbnRlcnBy
ZXRfY2FzdDxjb25zdCBqc2NoYXIqPihzY3JpcHQuZ2V0KCkpLAotICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNjcmlwdC5MZW5ndGgoKSwgdXJpU3RyLmdldCgp
LCAxLCBydmFsKTsKLSAgICB9Ci0gICAgZWxzZQotICAgIHsKLSAgICAgICAgb2sgPSBKU19FdmFs
dWF0ZVNjcmlwdEZvclByaW5jaXBhbHMoY3gsIHRhcmdldF9vYmosIGpzUHJpbmNpcGFscywKLSAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYnVmLCBsZW4sIHVyaVN0
ci5nZXQoKSwgMSwgcnZhbCk7Ci0gICAgfQotCi0gICAgSlNQUklOQ0lQQUxTX0RST1AoY3gsIGpz
UHJpbmNpcGFscyk7Ci0KLSAgICBpZiAob2spCi0gICAgeworICAgIGlmIChvaykgewogICAgICAg
ICBKU0F1dG9FbnRlckNvbXBhcnRtZW50IHJhYzsKLQogICAgICAgICBpZiAoIXJhYy5lbnRlcihj
eCwgcmVzdWx0X29iaikgfHwgIUpTX1dyYXBWYWx1ZShjeCwgcnZhbCkpCiAgICAgICAgICAgICBy
ZXR1cm4gTlNfRVJST1JfVU5FWFBFQ1RFRDsgCiAgICAgfQogCi0gICAgLyogcmVwZW50IGZvciBv
dXIgZXZpbCBkZWVkcyAqLwotICAgIEpTX1NldEVycm9yUmVwb3J0ZXIgKGN4LCBlcik7CisgICAg
aWYgKHdyaXRlU2NyaXB0KSB7CisgICAgICAgIFdyaXRlQ2FjaGVkU2NyaXB0KGNhY2hlLCB1cmlT
dHIsIGN4LCBzY3JpcHRPYmopOworICAgIH0KIAogICAgIGNjLT5TZXRSZXR1cm5WYWx1ZVdhc1Nl
dCAob2spOwogICAgIHJldHVybiBOU19PSzsKLQotIHJldHVybl9leGNlcHRpb246Ci0gICAgSlNf
U2V0UGVuZGluZ0V4Y2VwdGlvbiAoY3gsIFNUUklOR19UT19KU1ZBTChlcnJtc2cpKTsKLSAgICBy
ZXR1cm4gTlNfT0s7CiB9CiAKICNlbmRpZiAvKiBOT19TVUJTQ1JJUFRfTE9BREVSICovCmRpZmYg
LS1naXQgYS9qcy9zcmMveHBjb25uZWN0L2xvYWRlci9tb3pKU1N1YlNjcmlwdExvYWRlci5oIGIv
anMvc3JjL3hwY29ubmVjdC9sb2FkZXIvbW96SlNTdWJTY3JpcHRMb2FkZXIuaAotLS0gYS9qcy9z
cmMveHBjb25uZWN0L2xvYWRlci9tb3pKU1N1YlNjcmlwdExvYWRlci5oCisrKyBiL2pzL3NyYy94
cGNvbm5lY3QvbG9hZGVyL21vekpTU3ViU2NyaXB0TG9hZGVyLmgKQEAgLTM4LDYgKzM4LDcgQEAK
ICAqCiAgKiAqKioqKiBFTkQgTElDRU5TRSBCTE9DSyAqKioqKiAqLwogCisjaW5jbHVkZSAianNh
cGkuaCIKICNpbmNsdWRlICJuc0NPTVB0ci5oIgogI2luY2x1ZGUgIm1veklKU1N1YlNjcmlwdExv
YWRlci5oIgogI2luY2x1ZGUgIm5zSVNjcmlwdFNlY3VyaXR5TWFuYWdlci5oIgpAQCAtNTAsNiAr
NTEsOCBAQAogICAgIHsweDhlLCAweDA4LCAweDgyLCAweGZhLCAweDBhLCAweDMzLCAweDliLCAw
eDAwfSBcCiB9CiAKK2NsYXNzIG5zSUlPU2VydmljZTsKKwogY2xhc3MgbW96SlNTdWJTY3JpcHRM
b2FkZXIgOiBwdWJsaWMgbW96SUpTU3ViU2NyaXB0TG9hZGVyCiB7CiBwdWJsaWM6CkBAIC02MSw2
ICs2NCw5IEBAIHB1YmxpYzoKICAgICBOU19ERUNMX01PWklKU1NVQlNDUklQVExPQURFUgogCiBw
cml2YXRlOgorICAgIG5zcmVzdWx0IFJlYWRTY3JpcHQobnNJVVJJICp1cmksIEpTQ29udGV4dCAq
Y3gsIEpTT2JqZWN0ICp0YXJnZXRfb2JqLAorICAgICAgICAgICAgICAgICAgICAgICAganNjaGFy
ICpjaGFyc2V0LCBjb25zdCBjaGFyICp1cmlTdHIsCisgICAgICAgICAgICAgICAgICAgICAgICBu
c0lJT1NlcnZpY2UgKnNlcnYsIEpTT2JqZWN0ICoqc2NyaXB0T2JqcCk7CisKICAgICBuc0NPTVB0
cjxuc0lQcmluY2lwYWw+IG1TeXN0ZW1QcmluY2lwYWw7Ci0gICAgCiB9Owo=
</data>

          </attachment>
      

    </bug>

</bugzilla>