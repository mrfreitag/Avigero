<?xml version="1.0" encoding="UTF-8" standalone="yes" ?>
<!DOCTYPE bugzilla SYSTEM "https://bugzilla.mozilla.org/bugzilla.dtd">

<bugzilla version="3.6.4+"
          urlbase="https://bugzilla.mozilla.org/"
          
          maintainer="bugzilla-admin@mozilla.org"
>

    <bug>
          <bug_id>648321</bug_id>
          
          <creation_ts>2011-04-07 11:55:00 -0700</creation_ts>
          <short_desc>Continue using inline slots after slot array is allocated</short_desc>
          <delta_ts>2011-04-08 19:55:31 -0700</delta_ts>
          <reporter_accessible>1</reporter_accessible>
          <cclist_accessible>1</cclist_accessible>
          <classification_id>3</classification_id>
          <classification>Components</classification>
          <product>Core</product>
          <component>JavaScript Engine</component>
          <version>unspecified</version>
          <rep_platform>All</rep_platform>
          <op_sys>All</op_sys>
          <bug_status>NEW</bug_status>
          
          
          
          
          
          
          <priority>--</priority>
          <bug_severity>normal</bug_severity>
          <target_milestone>---</target_milestone>
          
          
          <votes>3</votes>
          <everconfirmed>1</everconfirmed>
          <reporter name="Bill McCloskey (:billm)">wmccloskey</reporter>
          <assigned_to name="Brian Hackett">bhackett1024</assigned_to>
          <cc>anygregor</cc>
    
    <cc>bhackett1024</cc>
    
    <cc>dmandelin</cc>
    
    <cc>luke</cc>
    
    <cc>matjk7</cc>
    
    <cc>ryanvm</cc>
          <qa_contact>general</qa_contact>
          <cf_blocking_fennec>---</cf_blocking_fennec>
          <cf_blocking_fx>---</cf_blocking_fx>
          <cf_blocking_20>---</cf_blocking_20>
          <cf_status_20>---</cf_status_20>
          <cf_blocking_192>---</cf_blocking_192>
          <cf_status_192>---</cf_status_192>
          <cf_blocking_191>---</cf_blocking_191>
          <cf_status_191>---</cf_status_191>
          
          
          
          
          
          
          
          
          
          

      

      

      

          <long_desc isprivate="0">
            <commentid>5394822</commentid>
            <who name="Bill McCloskey (:billm)">wmccloskey</who>
            <bug_when>2011-04-07 11:55:13 -0700</bug_when>
            <thetext>In bug 584917, we decided to stop using inline slots at all after allocating a slot array. This simplifies the code, and it also makes sense for things like dense arrays.

However, in cases like the kraken ai-astar benchmark, we would save memory and improve performance by continuing to use the inline slots data for low-numbered slots. The ai-astar benchmark constructs a ton of objects with 5 properties. After they&apos;ve all been constructed it adds 4 more properties to all of them. Since most later accesses are to one of the first 5 properties, it would be nice if we could continue to use the inline slot here. Also, it would save memory.</thetext>
          </long_desc>
          <long_desc isprivate="0">
            <commentid>5397305</commentid>
              <attachid>524716</attachid>
            <who name="Brian Hackett">bhackett1024</who>
            <bug_when>2011-04-08 13:15:05 -0700</bug_when>
            <thetext>Created attachment 524716
patch

Make the changes described above.  Kraken improves by 3% (ai-astar by 35%), v8bench improves by 1%, SS regresses by 4%.  I need to figure out what&apos;s going on with the regression, the changes here are pure improvement for JIT code but VM slot accesses can slow down significantly.  Most of the SS regression looks to be in tests that probably spend a lot of time in the VM (tofte, tagcloud), will look to see if we need to either mitigate or eliminate the VM overhead.</thetext>
          </long_desc>
          <long_desc isprivate="0">
            <commentid>5397734</commentid>
              <attachid>524772</attachid>
            <who name="Brian Hackett">bhackett1024</who>
            <bug_when>2011-04-08 15:42:36 -0700</bug_when>
            <thetext>Created attachment 524772
patch

This wipes out the perf loss on SS and keeps the gain on kraken and v8bench by making numFixedSlots much faster.  The number of fixed slots is stashed in the top 5 bits of the object&apos;s flags (which have plenty of free space), so we can get them with a load and shift rather than several dereferences to get the arena and a switch statement.  This is also more forward-compatible with a generational GC, as we don&apos;t depend on the current arena to figure out numFixedSlots.</thetext>
          </long_desc>
          <long_desc isprivate="0">
            <commentid>5397742</commentid>
              <attachid>524773</attachid>
            <who name="Brian Hackett">bhackett1024</who>
            <bug_when>2011-04-08 15:43:52 -0700</bug_when>
            <thetext>Created attachment 524773
before/after benchmark comparison</thetext>
          </long_desc>
          <long_desc isprivate="0">
            <commentid>5397863</commentid>
              <attachid>524772</attachid>
            <who name="Luke Wagner [:luke]">luke</who>
            <bug_when>2011-04-08 16:57:43 -0700</bug_when>
            <thetext>Comment on attachment 524772
patch

I&apos;m not very knowledgeable in this area.  Perhaps Jason?</thetext>
          </long_desc>
          <long_desc isprivate="0">
            <commentid>5397997</commentid>
            <who name="Brian Hackett">bhackett1024</who>
            <bug_when>2011-04-08 19:55:31 -0700</bug_when>
            <thetext>Patch landed on JM.  This increases the divergence between the JM and TM branches, but unblocks forthcoming property-access optimizations and hopefully this bug will have landed on TM by the time we get interest in merging back from JM.

http://hg.mozilla.org/projects/jaegermonkey/rev/d3215d1e985a</thetext>
          </long_desc>
      
          <attachment
              isobsolete="1"
              ispatch="1"
              isprivate="0"
              isurl="0"
          >
            <attachid>524716</attachid>
            <date>2011-04-08 13:15:00 -0700</date>
            <delta_ts>2011-04-08 15:42:36 -0700</delta_ts>
            <desc>patch</desc>
            <filename>splitobject.6.txt</filename>
            <type>text/plain</type>
            <size>108701</size>
            <attacher>bhackett1024</attacher>
            
              <data encoding="base64">ZGlmZiAtLWdpdCBhL2pzL3NyYy9qc2FwaS10ZXN0cy90ZXN0QnVnNjA0MDg3LmNwcCBiL2pzL3Ny
Yy9qc2FwaS10ZXN0cy90ZXN0QnVnNjA0MDg3LmNwcAotLS0gYS9qcy9zcmMvanNhcGktdGVzdHMv
dGVzdEJ1ZzYwNDA4Ny5jcHAKKysrIGIvanMvc3JjL2pzYXBpLXRlc3RzL3Rlc3RCdWc2MDQwODcu
Y3BwCkBAIC0xLDE2ICsxLDE3IEBACiAvKiAtKi0gTW9kZTogQysrOyB0YWItd2lkdGg6IDg7IGlu
ZGVudC10YWJzLW1vZGU6IG5pbDsgYy1iYXNpYy1vZmZzZXQ6IDQgLSotCiAgKiB2aW06IHNldCB0
cz04IHN3PTQgZXQgdHc9OTk6CiAgKgogICogVGVzdHMgSlNfVHJhbnNwbGFudE9iamVjdAogICov
CiAKICNpbmNsdWRlICJ0ZXN0cy5oIgogI2luY2x1ZGUgImpzd3JhcHBlci5oIgorI2luY2x1ZGUg
Impzb2JqaW5saW5lcy5oIgogCiBzdHJ1Y3QgT3V0ZXJXcmFwcGVyIDogSlNXcmFwcGVyCiB7CiAg
ICAgT3V0ZXJXcmFwcGVyKCkgOiBKU1dyYXBwZXIoMCkge30KIAogICAgIHZpcnR1YWwgYm9vbCBp
c091dGVyV2luZG93KCkgewogICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICB9CmRpZmYgLS1naXQg
YS9qcy9zcmMvanNhcGktdGVzdHMvdGVzdENvbnNlcnZhdGl2ZUdDLmNwcCBiL2pzL3NyYy9qc2Fw
aS10ZXN0cy90ZXN0Q29uc2VydmF0aXZlR0MuY3BwCi0tLSBhL2pzL3NyYy9qc2FwaS10ZXN0cy90
ZXN0Q29uc2VydmF0aXZlR0MuY3BwCisrKyBiL2pzL3NyYy9qc2FwaS10ZXN0cy90ZXN0Q29uc2Vy
dmF0aXZlR0MuY3BwCkBAIC00MiwyMyArNDIsMjQgQEAgQkVHSU5fVEVTVCh0ZXN0Q29uc2VydmF0
aXZlR0MpCiAgICAgY2hlY2tPYmplY3RGaWVsZHMoJm9iajJDb3B5LCBvYmoyKTsKICAgICBDSEVD
SyghbWVtY21wKCZzdHIyQ29weSwgc3RyMiwgc2l6ZW9mKHN0cjJDb3B5KSkpOwogCiAgICAgcmV0
dXJuIHRydWU7CiB9CiAKIGJvb2wgY2hlY2tPYmplY3RGaWVsZHMoSlNPYmplY3QgKnNhdmVkQ29w
eSwgSlNPYmplY3QgKm9iaikKIHsKLSAgICAvKgotICAgICAqIFRoZSBHQyBjYW4gY2hhbmdlIHRo
ZSBzaGFwZSBhbmQgc2hyaW5rIGRzbG90cyBzbyB3ZSB1cGRhdGUgdGhlbSBiZWZvcmUKLSAgICAg
KiBkb2luZyBtZW1jbXAuCi0gICAgICovCi0gICAgc2F2ZWRDb3B5LT5vYmpTaGFwZSA9IG9iai0+
b2JqU2hhcGU7Ci0gICAgc2F2ZWRDb3B5LT5zbG90cyA9IG9iai0+c2xvdHM7Ci0gICAgQ0hFQ0so
IW1lbWNtcChzYXZlZENvcHksIG9iaiwgc2l6ZW9mKCpvYmopKSk7CisgICAgLyogSWdub3JlIGZp
ZWxkcyB3aGljaCBhcmUgdW5zdGFibGUgYWNyb3NzIEdDcy4gKi8KKyAgICBDSEVDSyhzYXZlZENv
cHktPm1hcCA9PSBvYmotPm1hcCk7CisgICAgQ0hFQ0soc2F2ZWRDb3B5LT5jbGFzcCA9PSBvYmot
PmNsYXNwKTsKKyAgICBDSEVDSyhzYXZlZENvcHktPmZsYWdzID09IG9iai0+ZmxhZ3MpOworICAg
IENIRUNLKHNhdmVkQ29weS0+ZW1wdHlTaGFwZXMgPT0gb2JqLT5lbXB0eVNoYXBlcyk7CisgICAg
Q0hFQ0soc2F2ZWRDb3B5LT5wcm90byA9PSBvYmotPnByb3RvKTsKKyAgICBDSEVDSyhzYXZlZENv
cHktPnBhcmVudCA9PSBvYmotPnBhcmVudCk7CisgICAgQ0hFQ0soc2F2ZWRDb3B5LT5wcml2YXRl
RGF0YSA9PSBvYmotPnByaXZhdGVEYXRhKTsKICAgICByZXR1cm4gdHJ1ZTsKIH0KIAogRU5EX1RF
U1QodGVzdENvbnNlcnZhdGl2ZUdDKQogCiBCRUdJTl9URVNUKHRlc3REZXJpdmVkVmFsdWVzKQog
ewogICBKU1N0cmluZyAqc3RyID0gSlNfTmV3U3RyaW5nQ29weVooY3gsICJvbmNlIHVwb24gYSBt
aWRuaWdodCBkcmVhcnkiKTsKZGlmZiAtLWdpdCBhL2pzL3NyYy9qc2FwaS10ZXN0cy90ZXN0RnVu
Y0NhbGxiYWNrLmNwcCBiL2pzL3NyYy9qc2FwaS10ZXN0cy90ZXN0RnVuY0NhbGxiYWNrLmNwcAot
LS0gYS9qcy9zcmMvanNhcGktdGVzdHMvdGVzdEZ1bmNDYWxsYmFjay5jcHAKKysrIGIvanMvc3Jj
L2pzYXBpLXRlc3RzL3Rlc3RGdW5jQ2FsbGJhY2suY3BwCkBAIC0xLDE0ICsxLDE1IEBACiAjaW5j
bHVkZSAidGVzdHMuaCIKICNpbmNsdWRlICJqc2Z1bi5oIgogI2luY2x1ZGUgImpzY250eHQuaCIK
IAogLy8gRm9yIFRSQUNJTkdfRU5BQkxFRAogI2luY2x1ZGUgImpzdHJhY2VyLmgiCisjaW5jbHVk
ZSAianNvYmppbmxpbmVzLmgiCiAKICNpZmRlZiBNT1pfVFJBQ0VfSlNDQUxMUwogCiBzdGF0aWMg
aW50IGRlcHRoID0gMDsKIHN0YXRpYyBpbnQgZW50ZXJzID0gMDsKIHN0YXRpYyBpbnQgbGVhdmVz
ID0gMDsKIHN0YXRpYyBpbnQgaW50ZXJwcmV0ZWQgPSAwOwogCmRpZmYgLS1naXQgYS9qcy9zcmMv
anNhcnJheS5jcHAgYi9qcy9zcmMvanNhcnJheS5jcHAKLS0tIGEvanMvc3JjL2pzYXJyYXkuY3Bw
CisrKyBiL2pzL3NyYy9qc2FycmF5LmNwcApAQCAtOTQwLDE3ICs5NDAsMTcgQEAgYXJyYXlfZGVs
ZXRlUHJvcGVydHkoSlNDb250ZXh0ICpjeCwgSlNPYgogfQogCiBzdGF0aWMgdm9pZAogYXJyYXlf
dHJhY2UoSlNUcmFjZXIgKnRyYywgSlNPYmplY3QgKm9iaikKIHsKICAgICBKU19BU1NFUlQob2Jq
LT5pc0RlbnNlQXJyYXkoKSk7CiAKICAgICB1aW50MzIgY2FwYWNpdHkgPSBvYmotPmdldERlbnNl
QXJyYXlDYXBhY2l0eSgpOwotICAgIE1hcmtWYWx1ZVJhbmdlKHRyYywgY2FwYWNpdHksIG9iai0+
c2xvdHMsICJlbGVtZW50Iik7CisgICAgTWFya1ZhbHVlUmFuZ2UodHJjLCBjYXBhY2l0eSwgb2Jq
LT5nZXREZW5zZUFycmF5RWxlbWVudHMoKSwgImVsZW1lbnQiKTsKIH0KIAogc3RhdGljIEpTQm9v
bAogYXJyYXlfZml4KEpTQ29udGV4dCAqY3gsIEpTT2JqZWN0ICpvYmosIGJvb2wgKnN1Y2Nlc3Ms
IEF1dG9JZFZlY3RvciAqcHJvcHMpCiB7CiAgICAgSlNfQVNTRVJUKG9iai0+aXNEZW5zZUFycmF5
KCkpOwogCiAgICAgLyoKQEAgLTEwNDAsNjggKzEwNDAsNzcgQEAgSlNPYmplY3Q6Om1ha2VEZW5z
ZUFycmF5U2xvdyhKU0NvbnRleHQgKgogICAgIEpTT2JqZWN0TWFwICpvbGRNYXAgPSBtYXA7CiAK
ICAgICAvKiBDcmVhdGUgYSBuYXRpdmUgc2NvcGUuICovCiAgICAgSlNPYmplY3QgKmFycmF5UHJv
dG8gPSBnZXRQcm90bygpOwogICAgIGpzOjpnYzo6RmluYWxpemVLaW5kIGtpbmQgPSBqczo6Z2M6
OkZpbmFsaXplS2luZChhcmVuYSgpLT5oZWFkZXIoKS0+dGhpbmdLaW5kKTsKICAgICBpZiAoIUlu
aXRTY29wZUZvck9iamVjdChjeCwgdGhpcywgJmpzX1Nsb3dBcnJheUNsYXNzLCBhcnJheVByb3Rv
LCBraW5kKSkKICAgICAgICAgcmV0dXJuIGZhbHNlOwogCi0gICAgdWludDMyIGNhcGFjaXR5ID0g
Z2V0RGVuc2VBcnJheUNhcGFjaXR5KCk7CisgICAgdWludDMyIGFycmF5Q2FwYWNpdHkgPSBnZXRE
ZW5zZUFycmF5Q2FwYWNpdHkoKTsKKworICAgIC8qCisgICAgICogQWRqdXN0IHRoZSBzbG90cyB0
byBhY2NvdW50IGZvciB0aGUgZGlmZmVyZW50IGxheW91dCBiZXR3ZWVuIGRlbnNlCisgICAgICog
YXJyYXlzIGFuZCBvdGhlciBvYmplY3RzLiBUaGUgc2xvdHMgbXVzdCBiZSBkeW5hbWljLCBhbmQg
dGhlIGZpeGVkIHNsb3RzCisgICAgICogYXJlIG5vdyBhdmFpbGFibGUgZm9yIG5ld2x5IGFkZGVk
IHByb3BlcnRpZXMuCisgICAgICovCisgICAgaWYgKGRlbnNlQXJyYXlIYXNJbmxpbmVTbG90cygp
KSB7CisgICAgICAgIGlmICghYWxsb2NTbG90cyhjeCwgbnVtU2xvdHMoKSkpIHsKKyAgICAgICAg
ICAgIHNldE1hcChvbGRNYXApOworICAgICAgICAgICAgcmV0dXJuIGZhbHNlOworICAgICAgICB9
CisgICAgICAgIEpTX0FTU0VSVCghZGVuc2VBcnJheUhhc0lubGluZVNsb3RzKCkpOworICAgIH0K
KyAgICBjYXBhY2l0eSA9IG51bUZpeGVkU2xvdHMoKSArIGFycmF5Q2FwYWNpdHk7CisgICAgY2xh
c3AgPSAmanNfU2xvd0FycmF5Q2xhc3M7CiAKICAgICAvKgogICAgICAqIEJlZ2luIHdpdGggdGhl
IGxlbmd0aCBwcm9wZXJ0eSB0byBzaGFyZSBtb3JlIG9mIHRoZSBwcm9wZXJ0eSB0cmVlLgogICAg
ICAqIFRoZSBnZXR0ZXIvc2V0dGVyIGhlcmUgd2lsbCBkaXJlY3RseSBhY2Nlc3MgdGhlIG9iamVj
dCdzIHByaXZhdGUgdmFsdWUuCiAgICAgICovCiAgICAgaWYgKCFBZGRMZW5ndGhQcm9wZXJ0eShj
eCwgdGhpcykpIHsKICAgICAgICAgc2V0TWFwKG9sZE1hcCk7CisgICAgICAgIGNhcGFjaXR5ID0g
YXJyYXlDYXBhY2l0eTsKKyAgICAgICAgY2xhc3AgPSAmanNfQXJyYXlDbGFzczsKICAgICAgICAg
cmV0dXJuIGZhbHNlOwogICAgIH0KIAogICAgIC8qCiAgICAgICogQ3JlYXRlIG5ldyBwcm9wZXJ0
aWVzIHBvaW50aW5nIHRvIGV4aXN0aW5nIGVsZW1lbnRzLiBQYWNrIHRoZSBhcnJheSB0bwogICAg
ICAqIHJlbW92ZSBob2xlcywgc28gdGhhdCBzaGFwZXMgdXNlIHN1Y2Nlc3NpdmUgc2xvdHMgKGFz
IGZvciBvdGhlciBvYmplY3RzKS4KICAgICAgKi8KICAgICB1aW50MzIgbmV4dCA9IDA7Ci0gICAg
Zm9yICh1aW50MzIgaSA9IDA7IGkgPCBjYXBhY2l0eTsgaSsrKSB7CisgICAgZm9yICh1aW50MzIg
aSA9IDA7IGkgPCBhcnJheUNhcGFjaXR5OyBpKyspIHsKKyAgICAgICAgLyogRGVuc2UgYXJyYXkg
aW5kZXhlcyBjYW4gYWx3YXlzIGZpdCBpbiBhIGpzaWQuICovCiAgICAgICAgIGpzaWQgaWQ7Ci0g
ICAgICAgIGlmICghVmFsdWVUb0lkKGN4LCBJbnQzMlZhbHVlKGkpLCAmaWQpKSB7CisgICAgICAg
IEpTX0FMV0FZU19UUlVFKFZhbHVlVG9JZChjeCwgSW50MzJWYWx1ZShpKSwgJmlkKSk7CisKKyAg
ICAgICAgaWYgKHNsb3RzW2ldLmlzTWFnaWMoSlNfQVJSQVlfSE9MRSkpCisgICAgICAgICAgICBj
b250aW51ZTsKKworICAgICAgICBzZXRTbG90KG5leHQsIHNsb3RzW2ldKTsKKworICAgICAgICBp
ZiAoIWFkZERhdGFQcm9wZXJ0eShjeCwgaWQsIG5leHQsIEpTUFJPUF9FTlVNRVJBVEUpKSB7CiAg
ICAgICAgICAgICBzZXRNYXAob2xkTWFwKTsKKyAgICAgICAgICAgIGNhcGFjaXR5ID0gYXJyYXlD
YXBhY2l0eTsKKyAgICAgICAgICAgIGNsYXNwID0gJmpzX0FycmF5Q2xhc3M7CiAgICAgICAgICAg
ICByZXR1cm4gZmFsc2U7CiAgICAgICAgIH0KIAotICAgICAgICBpZiAoZ2V0RGVuc2VBcnJheUVs
ZW1lbnQoaSkuaXNNYWdpYyhKU19BUlJBWV9IT0xFKSkKLSAgICAgICAgICAgIGNvbnRpbnVlOwot
Ci0gICAgICAgIHNldERlbnNlQXJyYXlFbGVtZW50KG5leHQsIGdldERlbnNlQXJyYXlFbGVtZW50
KGkpKTsKLQotICAgICAgICBpZiAoIWFkZERhdGFQcm9wZXJ0eShjeCwgaWQsIG5leHQsIEpTUFJP
UF9FTlVNRVJBVEUpKSB7Ci0gICAgICAgICAgICBzZXRNYXAob2xkTWFwKTsKLSAgICAgICAgICAg
IHJldHVybiBmYWxzZTsKLSAgICAgICAgfQotCiAgICAgICAgIG5leHQrKzsKICAgICB9CiAKLSAg
ICAvKgotICAgICAqIERlbnNlIGFycmF5cyB3aXRoIGRpZmZlcmVudCBudW1iZXJzIG9mIHNsb3Rz
IGJ1dCB0aGUgc2FtZSBudW1iZXIgb2YgZml4ZWQKLSAgICAgKiBzbG90cyBhbmQgdGhlIHNhbWUg
bm9uLWhvbGUgaW5kZXhlcyBtdXN0IHVzZSB0aGVpciBmaXhlZCBzbG90cyBjb25zaXN0ZW50bHku
Ci0gICAgICovCi0gICAgaWYgKGhhc1Nsb3RzQXJyYXkoKSAmJiBuZXh0IDw9IG51bUZpeGVkU2xv
dHMoKSkKLSAgICAgICAgcmV2ZXJ0VG9GaXhlZFNsb3RzKGN4KTsKLQotICAgIENsZWFyVmFsdWVS
YW5nZShzbG90cyArIG5leHQsIHRoaXMtPmNhcGFjaXR5IC0gbmV4dCwgZmFsc2UpOworICAgIGNs
ZWFyU2xvdFJhbmdlKG5leHQsIGNhcGFjaXR5IC0gbmV4dCk7CiAKICAgICAvKgogICAgICAqIEZp
bmFsbHksIHVwZGF0ZSBjbGFzcy4gSWYgfHRoaXN8IGlzIEFycmF5LnByb3RvdHlwZSwgdGhlbiBq
c19Jbml0Q2xhc3MKICAgICAgKiB3aWxsIGNyZWF0ZSBhbiBlbXB0eVNoYXBlIHdob3NlIGNsYXNz
IGlzICZqc19TbG93QXJyYXlDbGFzcywgdG8gZW5zdXJlCiAgICAgICogdGhhdCBkZWxlZ2F0aW5n
IGluc3RhbmNlcyBjYW4gc2hhcmUgc2hhcGVzIGluIHRoZSB0cmVlIHJvb3RlZCBhdCB0aGUKICAg
ICAgKiBwcm90bydzIGVtcHR5IHNoYXBlLgogICAgICAqLwotICAgIGNsYXNwID0gJmpzX1Nsb3dB
cnJheUNsYXNzOwogICAgIHJldHVybiB0cnVlOwogfQogCiAvKiBUcmFuc2ZlciBvd25lcnNoaXAg
b2YgYnVmZmVyIHRvIHJldHVybmVkIHN0cmluZy4gKi8KIHN0YXRpYyBpbmxpbmUgSlNCb29sCiBC
dWZmZXJUb1N0cmluZyhKU0NvbnRleHQgKmN4LCBTdHJpbmdCdWZmZXIgJnNiLCBWYWx1ZSAqcnZh
bCkKIHsKICAgICBKU1N0cmluZyAqc3RyID0gc2IuZmluaXNoU3RyaW5nKCk7CmRpZmYgLS1naXQg
YS9qcy9zcmMvanNmdW4uY3BwIGIvanMvc3JjL2pzZnVuLmNwcAotLS0gYS9qcy9zcmMvanNmdW4u
Y3BwCisrKyBiL2pzL3NyYy9qc2Z1bi5jcHAKQEAgLTEwNjksMTkgKzEwNjksMTggQEAganNfQ3Jl
YXRlQ2FsbE9iamVjdE9uVHJhY2UoSlNDb250ZXh0ICpjeAogCiBKU19ERUZJTkVfQ0FMTElORk9f
NChleHRlcm4sIE9CSkVDVCwganNfQ3JlYXRlQ2FsbE9iamVjdE9uVHJhY2UsIENPTlRFWFQsIEZV
TkNUSU9OLCBPQkpFQ1QsIE9CSkVDVCwKICAgICAgICAgICAgICAgICAgICAgIDAsIG5hbm9qaXQ6
OkFDQ1NFVF9TVE9SRV9BTlkpCiAKIGlubGluZSBzdGF0aWMgdm9pZAogQ29weVZhbHVlc1RvQ2Fs
bE9iamVjdChKU09iamVjdCAmY2FsbG9iaiwgdWludE4gbmFyZ3MsIFZhbHVlICphcmd2LCB1aW50
TiBudmFycywgVmFsdWUgKnNsb3RzKQogewogICAgIEpTX0FTU0VSVChjYWxsb2JqLm51bVNsb3Rz
KCkgPj0gSlNPYmplY3Q6OkNBTExfUkVTRVJWRURfU0xPVFMgKyBuYXJncyArIG52YXJzKTsKLSAg
ICBWYWx1ZSAqYmFzZSA9IGNhbGxvYmouZ2V0U2xvdHMoKSArIEpTT2JqZWN0OjpDQUxMX1JFU0VS
VkVEX1NMT1RTOwotICAgIG1lbWNweShiYXNlLCBhcmd2LCBuYXJncyAqIHNpemVvZihWYWx1ZSkp
OwotICAgIG1lbWNweShiYXNlICsgbmFyZ3MsIHNsb3RzLCBudmFycyAqIHNpemVvZihWYWx1ZSkp
OworICAgIGNhbGxvYmouY29weVNsb3RSYW5nZShKU09iamVjdDo6Q0FMTF9SRVNFUlZFRF9TTE9U
UywgYXJndiwgbmFyZ3MpOworICAgIGNhbGxvYmouY29weVNsb3RSYW5nZShKU09iamVjdDo6Q0FM
TF9SRVNFUlZFRF9TTE9UUyArIG5hcmdzLCBzbG90cywgbnZhcnMpOwogfQogCiB2b2lkCiBqc19Q
dXRDYWxsT2JqZWN0KEpTQ29udGV4dCAqY3gsIEpTU3RhY2tGcmFtZSAqZnApCiB7CiAgICAgSlNP
YmplY3QgJmNhbGxvYmogPSBmcC0+Y2FsbE9iaigpOwogICAgIEpTX0FTU0VSVChjYWxsb2JqLmdl
dFByaXZhdGUoKSA9PSBmcCk7CiAgICAgSlNfQVNTRVJUX0lGKGZwLT5pc0V2YWxGcmFtZSgpLCBm
cC0+aXNTdHJpY3RFdmFsRnJhbWUoKSk7CkBAIC0xMzgzLDE3ICsxMzgyLDE3IEBAIGNhbGxfdHJh
Y2UoSlNUcmFjZXIgKnRyYywgSlNPYmplY3QgKm9iaikKICAgICAgICAgICogZm9yIEpTIG9iamVj
dHMgKGluY2x1ZGluZyBDYWxsIG9iamVjdHMpLCBzbyBpcyB1bmFibGUgdG8gY29sbGVjdAogICAg
ICAgICAgKiBjeWNsZXMgaW52b2x2aW5nIENhbGwgb2JqZWN0cyB3aG9zZSBmcmFtZXMgYXJlIGFj
dGl2ZSB3aXRob3V0IHRoaXMKICAgICAgICAgICogaGlkaW5nIGhhY2suCiAgICAgICAgICAqLwog
ICAgICAgICB1aW50TiBmaXJzdCA9IEpTT2JqZWN0OjpDQUxMX1JFU0VSVkVEX1NMT1RTOwogICAg
ICAgICB1aW50TiBjb3VudCA9IGZwLT5zY3JpcHQoKS0+YmluZGluZ3MuY291bnRBcmdzQW5kVmFy
cygpOwogCiAgICAgICAgIEpTX0FTU0VSVChvYmotPm51bVNsb3RzKCkgPj0gZmlyc3QgKyBjb3Vu
dCk7Ci0gICAgICAgIFNldFZhbHVlUmFuZ2VUb1VuZGVmaW5lZChvYmotPmdldFNsb3RzKCkgKyBm
aXJzdCwgY291bnQpOworICAgICAgICBvYmotPmNsZWFyU2xvdFJhbmdlKGZpcnN0LCBjb3VudCk7
CiAgICAgfQogCiAgICAgTWF5YmVNYXJrR2VuZXJhdG9yKHRyYywgb2JqKTsKIH0KIAogSlNfUFVC
TElDX0RBVEEoQ2xhc3MpIGpzX0NhbGxDbGFzcyA9IHsKICAgICAiQ2FsbCIsCiAgICAgSlNDTEFT
U19IQVNfUFJJVkFURSB8CkBAIC0yMjQzLDE3ICsyMjQyLDE3IEBAIEpTT2JqZWN0Ojppbml0Qm91
bmRGdW5jdGlvbihKU0NvbnRleHQgKmMKIAogICAgICAgICBlbXB0eS0+c2xvdFNwYW4gKz0gYXJn
c2xlbjsKICAgICAgICAgbWFwID0gZW1wdHk7CiAKICAgICAgICAgaWYgKCFlbnN1cmVJbnN0YW5j
ZVJlc2VydmVkU2xvdHMoY3gsIGFyZ3NsZW4pKQogICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwog
CiAgICAgICAgIEpTX0FTU0VSVChudW1TbG90cygpID49IGFyZ3NsZW4gKyBGVU5fQ0xBU1NfUkVT
RVJWRURfU0xPVFMpOwotICAgICAgICBtZW1jcHkoZ2V0U2xvdHMoKSArIEZVTl9DTEFTU19SRVNF
UlZFRF9TTE9UUywgYXJncywgYXJnc2xlbiAqIHNpemVvZihWYWx1ZSkpOworICAgICAgICBjb3B5
U2xvdFJhbmdlKEZVTl9DTEFTU19SRVNFUlZFRF9TTE9UUywgYXJncywgYXJnc2xlbik7CiAgICAg
fQogICAgIHJldHVybiB0cnVlOwogfQogCiBpbmxpbmUgSlNPYmplY3QgKgogSlNPYmplY3Q6Omdl
dEJvdW5kRnVuY3Rpb25UYXJnZXQoKSBjb25zdAogewogICAgIEpTX0FTU0VSVChpc0Z1bmN0aW9u
KCkpOwpAQCAtMjI2NywyNiArMjI2NiwzMyBAQCBpbmxpbmUgY29uc3QganM6OlZhbHVlICYKIEpT
T2JqZWN0OjpnZXRCb3VuZEZ1bmN0aW9uVGhpcygpIGNvbnN0CiB7CiAgICAgSlNfQVNTRVJUKGlz
RnVuY3Rpb24oKSk7CiAgICAgSlNfQVNTRVJUKGlzQm91bmRGdW5jdGlvbigpKTsKIAogICAgIHJl
dHVybiBnZXRTbG90KEpTU0xPVF9CT1VORF9GVU5DVElPTl9USElTKTsKIH0KIAotaW5saW5lIGNv
bnN0IGpzOjpWYWx1ZSAqCi1KU09iamVjdDo6Z2V0Qm91bmRGdW5jdGlvbkFyZ3VtZW50cyh1aW50
TiAmYXJnc2xlbikgY29uc3QKK2lubGluZSBjb25zdCBqczo6VmFsdWUgJgorSlNPYmplY3Q6Omdl
dEJvdW5kRnVuY3Rpb25Bcmd1bWVudCh1aW50TiB3aGljaCkgY29uc3QKIHsKICAgICBKU19BU1NF
UlQoaXNGdW5jdGlvbigpKTsKICAgICBKU19BU1NFUlQoaXNCb3VuZEZ1bmN0aW9uKCkpOwotCi0g
ICAgYXJnc2xlbiA9IGdldFNsb3QoSlNTTE9UX0JPVU5EX0ZVTkNUSU9OX0FSR1NfQ09VTlQpLnRv
UHJpdmF0ZVVpbnQzMigpOwotICAgIEpTX0FTU0VSVF9JRihhcmdzbGVuID4gMCwgbnVtU2xvdHMo
KSA+PSBhcmdzbGVuKTsKLQotICAgIHJldHVybiBnZXRTbG90cygpICsgRlVOX0NMQVNTX1JFU0VS
VkVEX1NMT1RTOworICAgIEpTX0FTU0VSVCh3aGljaCA8IGdldEJvdW5kRnVuY3Rpb25Bcmd1bWVu
dENvdW50KCkpOworCisgICAgcmV0dXJuIGdldFNsb3QoRlVOX0NMQVNTX1JFU0VSVkVEX1NMT1RT
ICsgd2hpY2gpOworfQorCitpbmxpbmUgc2l6ZV90CitKU09iamVjdDo6Z2V0Qm91bmRGdW5jdGlv
bkFyZ3VtZW50Q291bnQoKSBjb25zdAoreworICAgIEpTX0FTU0VSVChpc0Z1bmN0aW9uKCkpOwor
ICAgIEpTX0FTU0VSVChpc0JvdW5kRnVuY3Rpb24oKSk7CisKKyAgICByZXR1cm4gZ2V0U2xvdChK
U1NMT1RfQk9VTkRfRlVOQ1RJT05fQVJHU19DT1VOVCkudG9Qcml2YXRlVWludDMyKCk7CiB9CiAK
IG5hbWVzcGFjZSBqcyB7CiAKIC8qIEVTNSAxNS4zLjQuNS4xIGFuZCAxNS4zLjQuNS4yLiAqLwog
SlNCb29sCiBDYWxsT3JDb25zdHJ1Y3RCb3VuZEZ1bmN0aW9uKEpTQ29udGV4dCAqY3gsIHVpbnRO
IGFyZ2MsIFZhbHVlICp2cCkKIHsKQEAgLTIyOTQsMTggKzIzMDAsMTcgQEAgQ2FsbE9yQ29uc3Ry
dWN0Qm91bmRGdW5jdGlvbihKU0NvbnRleHQgKgogICAgIEpTX0FTU0VSVChvYmotPmlzRnVuY3Rp
b24oKSk7CiAgICAgSlNfQVNTRVJUKG9iai0+aXNCb3VuZEZ1bmN0aW9uKCkpOwogCiAgICAgTGVh
dmVUcmFjZShjeCk7CiAKICAgICBib29sIGNvbnN0cnVjdGluZyA9IElzQ29uc3RydWN0aW5nKHZw
KTsKIAogICAgIC8qIDE1LjMuNC41LjEgc3RlcCAxLCAxNS4zLjQuNS4yIHN0ZXAgMy4gKi8KLSAg
ICB1aW50TiBhcmdzbGVuOwotICAgIGNvbnN0IFZhbHVlICpib3VuZEFyZ3MgPSBvYmotPmdldEJv
dW5kRnVuY3Rpb25Bcmd1bWVudHMoYXJnc2xlbik7CisgICAgdWludE4gYXJnc2xlbiA9IG9iai0+
Z2V0Qm91bmRGdW5jdGlvbkFyZ3VtZW50Q291bnQoKTsKIAogICAgIGlmIChhcmdjICsgYXJnc2xl
biA+IEpTX0FSR1NfTEVOR1RIX01BWCkgewogICAgICAgICBqc19SZXBvcnRBbGxvY2F0aW9uT3Zl
cmZsb3coY3gpOwogICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgfQogCiAgICAgLyogMTUuMy40
LjUuMSBzdGVwIDMsIDE1LjMuNC41LjIgc3RlcCAxLiAqLwogICAgIEpTT2JqZWN0ICp0YXJnZXQg
PSBvYmotPmdldEJvdW5kRnVuY3Rpb25UYXJnZXQoKTsKQEAgLTIzMTMsMTcgKzIzMTgsMTggQEAg
Q2FsbE9yQ29uc3RydWN0Qm91bmRGdW5jdGlvbihKU0NvbnRleHQgKgogICAgIC8qIDE1LjMuNC41
LjEgc3RlcCAyLiAqLwogICAgIGNvbnN0IFZhbHVlICZib3VuZFRoaXMgPSBvYmotPmdldEJvdW5k
RnVuY3Rpb25UaGlzKCk7CiAKICAgICBJbnZva2VBcmdzR3VhcmQgYXJnczsKICAgICBpZiAoIWN4
LT5zdGFjaygpLnB1c2hJbnZva2VBcmdzKGN4LCBhcmdjICsgYXJnc2xlbiwgJmFyZ3MpKQogICAg
ICAgICByZXR1cm4gZmFsc2U7CiAKICAgICAvKiAxNS4zLjQuNS4xLCAxNS4zLjQuNS4yIHN0ZXAg
NC4gKi8KLSAgICBtZW1jcHkoYXJncy5hcmd2KCksIGJvdW5kQXJncywgYXJnc2xlbiAqIHNpemVv
ZihWYWx1ZSkpOworICAgIGZvciAodWludE4gaSA9IDA7IGkgPCBhcmdzbGVuOyBpKyspCisgICAg
ICAgIGFyZ3NbaV0gPSBvYmotPmdldEJvdW5kRnVuY3Rpb25Bcmd1bWVudChpKTsKICAgICBtZW1j
cHkoYXJncy5hcmd2KCkgKyBhcmdzbGVuLCB2cCArIDIsIGFyZ2MgKiBzaXplb2YoVmFsdWUpKTsK
IAogICAgIC8qIDE1LjMuNC41LjEsIDE1LjMuNC41LjIgc3RlcCA1LiAqLwogICAgIGFyZ3MuY2Fs
bGVlKCkuc2V0T2JqZWN0KCp0YXJnZXQpOwogCiAgICAgaWYgKCFjb25zdHJ1Y3RpbmcpCiAgICAg
ICAgIGFyZ3MudGhpc3YoKSA9IGJvdW5kVGhpczsKIApkaWZmIC0tZ2l0IGEvanMvc3JjL2pzZnVu
LmggYi9qcy9zcmMvanNmdW4uaAotLS0gYS9qcy9zcmMvanNmdW4uaAorKysgYi9qcy9zcmMvanNm
dW4uaApAQCAtMTg4LDM3ICsxODgsMjYgQEAgc3RydWN0IEpTRnVuY3Rpb24gOiBwdWJsaWMgSlNP
YmplY3RfU2xvdAogICAgICAqIGEgY29tcGlsZXItY3JlYXRlZCBmdW5jdGlvbiBvYmplY3QgdXNl
IHRoZSBmaXJzdCBvbmUgdG8gaG9sZCBhIG11dGFibGUKICAgICAgKiBtZXRob2RBdG9tKCkgc3Rh
dGUgdmFyaWFibGUsIG5lZWRlZCBmb3IgY29ycmVjdCBmb28uY2FsbGVyIGhhbmRsaW5nLgogICAg
ICAqLwogICAgIGVudW0gewogICAgICAgICBNRVRIT0RfQVRPTV9TTE9UICA9IEpTU0xPVF9GVU5f
TUVUSE9EX0FUT00KICAgICB9OwogCiAgIHB1YmxpYzoKLSAgICB2b2lkIHNldEpvaW5hYmxlKCkg
ewotICAgICAgICBKU19BU1NFUlQoRlVOX0lOVEVSUFJFVEVEKHRoaXMpKTsKLSAgICAgICAgZ2V0
U2xvdFJlZihNRVRIT0RfQVRPTV9TTE9UKS5zZXROdWxsKCk7Ci0gICAgICAgIGZsYWdzIHw9IEpT
RlVOX0pPSU5BQkxFOwotICAgIH0KKyAgICBpbmxpbmUgdm9pZCBzZXRKb2luYWJsZSgpOwogCiAg
ICAgLyoKICAgICAgKiBNZXRob2QgbmFtZSBpbXB1dGVkIGZyb20gcHJvcGVydHkgdW5pcXVlbHkg
YXNzaWduZWQgdG8gb3IgaW5pdGlhbGl6ZWQsCiAgICAgICogd2hlcmUgdGhlIGZ1bmN0aW9uIGRv
ZXMgbm90IG5lZWQgdG8gYmUgY2xvbmVkIHRvIGNhcnJ5IGEgc2NvcGUgY2hhaW4gb3IKICAgICAg
KiBmbGF0dGVuZWQgdXB2YXJzLgogICAgICAqLwotICAgIEpTQXRvbSAqbWV0aG9kQXRvbSgpIGNv
bnN0IHsKLSAgICAgICAgcmV0dXJuIChqb2luYWJsZSgpICYmIGdldFNsb3QoTUVUSE9EX0FUT01f
U0xPVCkuaXNTdHJpbmcoKSkKLSAgICAgICAgICAgICAgID8gJmdldFNsb3QoTUVUSE9EX0FUT01f
U0xPVCkudG9TdHJpbmcoKS0+YXNBdG9tKCkKLSAgICAgICAgICAgICAgIDogTlVMTDsKLSAgICB9
CisgICAgaW5saW5lIEpTQXRvbSAqbWV0aG9kQXRvbSgpIGNvbnN0OwogCi0gICAgdm9pZCBzZXRN
ZXRob2RBdG9tKEpTQXRvbSAqYXRvbSkgewotICAgICAgICBKU19BU1NFUlQoam9pbmFibGUoKSk7
Ci0gICAgICAgIGdldFNsb3RSZWYoTUVUSE9EX0FUT01fU0xPVCkuc2V0U3RyaW5nKGF0b20pOwot
ICAgIH0KKyAgICBpbmxpbmUgdm9pZCBzZXRNZXRob2RBdG9tKEpTQXRvbSAqYXRvbSk7CiAKICAg
ICBqczo6TmF0aXZlIG1heWJlTmF0aXZlKCkgY29uc3QgewogICAgICAgICByZXR1cm4gaXNJbnRl
cnByZXRlZCgpID8gTlVMTCA6IHUubi5uYXRpdmU7CiAgICAgfQogCiAgICAgSlNTY3JpcHQgKnNj
cmlwdCgpIGNvbnN0IHsKICAgICAgICAgSlNfQVNTRVJUKGlzSW50ZXJwcmV0ZWQoKSk7CiAgICAg
ICAgIHJldHVybiB1Lmkuc2NyaXB0OwpkaWZmIC0tZ2l0IGEvanMvc3JjL2pzZ2MuY3BwIGIvanMv
c3JjL2pzZ2MuY3BwCi0tLSBhL2pzL3NyYy9qc2djLmNwcAorKysgYi9qcy9zcmMvanNnYy5jcHAK
QEAgLTI2MzMsMzEgKzI2MzMsNDAgQEAganNfR0MoSlNDb250ZXh0ICpjeCwgSlNDb21wYXJ0bWVu
dCAqY29tcAogICAgICAgICAgKi8KICAgICB9IHdoaWxlIChnY2tpbmQgPT0gR0NfTEFTVF9DT05U
RVhUICYmIHJ0LT5nY1Bva2UpOwogI2lmZGVmIEpTX0dDTUVURVIKICAgICBqc19EdW1wR0NTdGF0
cyhjeC0+cnVudGltZSwgc3RkZXJyKTsKICNlbmRpZgogICAgIEdDVElNRVJfRU5EKGdja2luZCA9
PSBHQ19MQVNUX0NPTlRFWFQpOwogfQogCi1uYW1lc3BhY2UganMgewotbmFtZXNwYWNlIGdjIHsK
LQogdm9pZAotTWFya09iamVjdFNsb3RzKEpTVHJhY2VyICp0cmMsIEpTT2JqZWN0ICpvYmopCitK
U09iamVjdDo6bWFya1Nsb3RzKEpTVHJhY2VyICp0cmMpCiB7Ci0gICAgSlNfQVNTRVJUKG9iai0+
c2xvdFNwYW4oKSA8PSBvYmotPm51bVNsb3RzKCkpOwotICAgIHVpbnQzMiBuc2xvdHMgPSBvYmot
PnNsb3RTcGFuKCk7Ci0gICAgZm9yICh1aW50MzIgaSA9IDA7IGkgIT0gbnNsb3RzOyArK2kpIHsK
LSAgICAgICAgY29uc3QgVmFsdWUgJnYgPSBvYmotPmdldFNsb3QoaSk7Ci0gICAgICAgIEpTX1NF
VF9UUkFDSU5HX0RFVEFJTFModHJjLCBqc19QcmludE9iamVjdFNsb3ROYW1lLCBvYmosIGkpOwor
ICAgIEpTX0FTU0VSVChpc05hdGl2ZSgpKTsKKyAgICBKU19BU1NFUlQoc2xvdFNwYW4oKSA8PSBu
dW1TbG90cygpKTsKKyAgICB1aW50MzIgbmZpeGVkID0gbnVtRml4ZWRTbG90cygpOworICAgIHVp
bnQzMiBuc2xvdHMgPSBzbG90U3BhbigpOworICAgIHVpbnQzMiBpOworICAgIGZvciAoaSA9IDA7
IGkgPCBuc2xvdHMgJiYgaSA8IG5maXhlZDsgaSsrKSB7CisgICAgICAgIGNvbnN0IFZhbHVlICZ2
ID0gZml4ZWRTbG90cygpW2ldOworICAgICAgICBKU19TRVRfVFJBQ0lOR19ERVRBSUxTKHRyYywg
anNfUHJpbnRPYmplY3RTbG90TmFtZSwgdGhpcywgaSk7CisgICAgICAgIE1hcmtWYWx1ZVJhdyh0
cmMsIHYpOworICAgIH0KKyAgICBmb3IgKDsgaSA8IG5zbG90czsgaSsrKSB7CisgICAgICAgIGNv
bnN0IFZhbHVlICZ2ID0gc2xvdHNbaSAtIG5maXhlZF07CisgICAgICAgIEpTX1NFVF9UUkFDSU5H
X0RFVEFJTFModHJjLCBqc19QcmludE9iamVjdFNsb3ROYW1lLCB0aGlzLCBpKTsKICAgICAgICAg
TWFya1ZhbHVlUmF3KHRyYywgdik7CiAgICAgfQogfQogCisKK25hbWVzcGFjZSBqcyB7CituYW1l
c3BhY2UgZ2MgeworCiBib29sCiBTZXRQcm90b0NoZWNraW5nRm9yQ3ljbGVzKEpTQ29udGV4dCAq
Y3gsIEpTT2JqZWN0ICpvYmosIEpTT2JqZWN0ICpwcm90bykKIHsKICAgICAvKgogICAgICAqIFRo
aXMgZnVuY3Rpb24gY2Fubm90IGJlIGNhbGxlZCBkdXJpbmcgdGhlIEdDIGFuZCBhbHdheXMgcmVx
dWlyZXMgYQogICAgICAqIHJlcXVlc3QuCiAgICAgICovCiAjaWZkZWYgSlNfVEhSRUFEU0FGRQpk
aWZmIC0tZ2l0IGEvanMvc3JjL2pzZ2NpbmxpbmVzLmggYi9qcy9zcmMvanNnY2lubGluZXMuaAot
LS0gYS9qcy9zcmMvanNnY2lubGluZXMuaAorKysgYi9qcy9zcmMvanNnY2lubGluZXMuaApAQCAt
MTIyLDE3ICsxMjIsMTcgQEAgY29uc3Qgc2l6ZV90IFNMT1RTX1RPX1RISU5HX0tJTkRfTElNSVQg
PQogCiAvKiBHZXQgdGhlIGJlc3Qga2luZCB0byB1c2Ugd2hlbiBtYWtpbmcgYW4gb2JqZWN0IHdp
dGggdGhlIGdpdmVuIHNsb3QgY291bnQuICovCiBzdGF0aWMgaW5saW5lIEZpbmFsaXplS2luZAog
R2V0R0NPYmplY3RLaW5kKHNpemVfdCBudW1TbG90cykKIHsKICAgICBleHRlcm4gRmluYWxpemVL
aW5kIHNsb3RzVG9UaGluZ0tpbmRbXTsKIAogICAgIGlmIChudW1TbG90cyA+PSBTTE9UU19UT19U
SElOR19LSU5EX0xJTUlUKQotICAgICAgICByZXR1cm4gRklOQUxJWkVfT0JKRUNUMDsKKyAgICAg
ICAgcmV0dXJuIEZJTkFMSVpFX09CSkVDVDE2OwogICAgIHJldHVybiBzbG90c1RvVGhpbmdLaW5k
W251bVNsb3RzXTsKIH0KIAogLyogR2V0IHRoZSBudW1iZXIgb2YgZml4ZWQgc2xvdHMgYW5kIGlu
aXRpYWwgY2FwYWNpdHkgYXNzb2NpYXRlZCB3aXRoIGEga2luZC4gKi8KIHN0YXRpYyBpbmxpbmUg
c2l6ZV90CiBHZXRHQ0tpbmRTbG90cyhGaW5hbGl6ZUtpbmQgdGhpbmdLaW5kKQogewogICAgIC8q
IFVzaW5nIGEgc3dpdGNoIGluIGhvcGVzIHRoYXQgdGhpbmdLaW5kIHdpbGwgdXN1YWxseSBiZSBh
IGNvbXBpbGUtdGltZSBjb25zdGFudC4gKi8KQEAgLTM3MiwxOSArMzcyLDE2IEBAIEpTT2JqZWN0
Ojp0cmFjZShKU1RyYWNlciAqdHJjKQogICAgICAgICB9CiAgICAgICAgIG9ialNoYXBlID0gbmV3
U2hhcGU7CiAgICAgfQogfQogCiBuYW1lc3BhY2UganMgewogbmFtZXNwYWNlIGdjIHsKIAotdm9p
ZAotTWFya09iamVjdFNsb3RzKEpTVHJhY2VyICp0cmMsIEpTT2JqZWN0ICpvYmopOwotCiBzdGF0
aWMgaW5saW5lIHZvaWQKIE1hcmtDaGlsZHJlbihKU1RyYWNlciAqdHJjLCBKU09iamVjdCAqb2Jq
KQogewogICAgIC8qIElmIG9iaiBoYXMgbm8gbWFwLCBpdCBtdXN0IGJlIGEgbmV3Ym9ybi4gKi8K
ICAgICBpZiAoIW9iai0+bWFwKQogICAgICAgICByZXR1cm47CiAKICAgICAvKiBUcmFjZSB1bml2
ZXJzYWwgKG9wcy1pbmRlcGVuZGVudCkgbWVtYmVycy4gKi8KQEAgLTQwOCwxNyArNDA1LDE3IEBA
IE1hcmtDaGlsZHJlbihKU1RyYWNlciAqdHJjLCBKU09iamVjdCAqb2IKICAgICBpZiAob2JqLT5p
c05hdGl2ZSgpKSB7CiAjaWZkZWYgSlNfRFVNUF9TQ09QRV9NRVRFUlMKICAgICAgICAganM6Ok1l
dGVyRW50cnlDb3VudChvYmotPnByb3BlcnR5Q291bnQpOwogI2VuZGlmCiAKICAgICAgICAgb2Jq
LT50cmFjZSh0cmMpOwogCiAgICAgICAgIGlmIChvYmotPnNsb3RTcGFuKCkgPiAwKQotICAgICAg
ICAgICAgTWFya09iamVjdFNsb3RzKHRyYywgb2JqKTsKKyAgICAgICAgICAgIG9iai0+bWFya1Ns
b3RzKHRyYyk7CiAgICAgfQogfQogCiBzdGF0aWMgaW5saW5lIHZvaWQKIE1hcmtDaGlsZHJlbihK
U1RyYWNlciAqdHJjLCBKU1N0cmluZyAqc3RyKQogewogICAgIGlmIChzdHItPmlzRGVwZW5kZW50
KCkpCiAgICAgICAgIE1hcmtTdHJpbmcodHJjLCBzdHItPmFzRGVwZW5kZW50KCkuYmFzZSgpLCAi
YmFzZSIpOwpkaWZmIC0tZ2l0IGEvanMvc3JjL2pzb2JqLmNwcCBiL2pzL3NyYy9qc29iai5jcHAK
LS0tIGEvanMvc3JjL2pzb2JqLmNwcAorKysgYi9qcy9zcmMvanNvYmouY3BwCkBAIC0zMjgyLDE3
ICszMjgyLDE3IEBAIGpzX1B1dEJsb2NrT2JqZWN0KEpTQ29udGV4dCAqY3gsIEpTQm9vbCAKICAg
ICBKU19BU1NFUlQoY291bnQgPD0gc2l6ZV90KGN4LT5yZWdzLT5zcCAtIGZwLT5iYXNlKCkgLSBk
ZXB0aCkpOwogCiAgICAgLyogU2VlIGNvbW1lbnRzIGluIENoZWNrRGVzdHJ1Y3R1cmluZyBmcm9t
IGpzcGFyc2UuY3BwLiAqLwogICAgIEpTX0FTU0VSVChjb3VudCA+PSAxKTsKIAogICAgIGlmIChu
b3JtYWxVbndpbmQpIHsKICAgICAgICAgdWludE4gc2xvdCA9IEpTU0xPVF9CTE9DS19GSVJTVF9G
UkVFX1NMT1Q7CiAgICAgICAgIGRlcHRoICs9IGZwLT5udW1GaXhlZCgpOwotICAgICAgICBtZW1j
cHkob2JqLT5nZXRTbG90cygpICsgc2xvdCwgZnAtPnNsb3RzKCkgKyBkZXB0aCwgY291bnQgKiBz
aXplb2YoVmFsdWUpKTsKKyAgICAgICAgb2JqLT5jb3B5U2xvdFJhbmdlKHNsb3QsIGZwLT5zbG90
cygpICsgZGVwdGgsIGNvdW50KTsKICAgICB9CiAKICAgICAvKiBXZSBtdXN0IGNsZWFyIHRoZSBw
cml2YXRlIHNsb3QgZXZlbiB3aXRoIGVycm9ycy4gKi8KICAgICBvYmotPnNldFByaXZhdGUoTlVM
TCk7CiAgICAgZnAtPnNldFNjb3BlQ2hhaW5Ob0NhbGxPYmooKm9iai0+Z2V0UGFyZW50KCkpOwog
ICAgIHJldHVybiBub3JtYWxVbndpbmQ7CiB9CiAKQEAgLTMzNTgsMjQgKzMzNTgsMTYgQEAgSlNP
YmplY3Q6OmRlZmluZUJsb2NrVmFyaWFibGUoSlNDb250ZXh0IAogICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgIFNoYXBlOjpIQVNfU0hPUlRJRCwgaW5kZXgpOwogICAgIGlmICgh
c2hhcGUpCiAgICAgICAgIHJldHVybiBOVUxMOwogICAgIGlmIChzbG90ID49IG51bVNsb3RzKCkg
JiYgIWdyb3dTbG90cyhjeCwgc2xvdCArIDEpKQogICAgICAgICByZXR1cm4gTlVMTDsKICAgICBy
ZXR1cm4gc2hhcGU7CiB9CiAKLXN0YXRpYyBzaXplX3QKLUdldE9iamVjdFNpemUoSlNPYmplY3Qg
Km9iaikKLXsKLSAgICByZXR1cm4gKG9iai0+aXNGdW5jdGlvbigpICYmICFvYmotPmdldFByaXZh
dGUoKSkKLSAgICAgICAgICAgPyBzaXplb2YoSlNGdW5jdGlvbikKLSAgICAgICAgICAgOiBzaXpl
b2YoSlNPYmplY3QpICsgc2l6ZW9mKGpzOjpWYWx1ZSkgKiBvYmotPm51bUZpeGVkU2xvdHMoKTsK
LX0KLQogYm9vbAogSlNPYmplY3Q6OmNvcHlQcm9wZXJ0aWVzRnJvbShKU0NvbnRleHQgKmN4LCBK
U09iamVjdCAqb2JqKQogewogICAgIC8vIElmIHdlJ3JlIG5vdCBuYXRpdmUsIHRoZW4gd2UgY2Fu
bm90IGNvcHkgcHJvcGVydGllcy4KICAgICBKU19BU1NFUlQoaXNOYXRpdmUoKSA9PSBvYmotPmlz
TmF0aXZlKCkpOwogICAgIGlmICghaXNOYXRpdmUoKSkKICAgICAgICAgcmV0dXJuIHRydWU7CiAK
QEAgLTM0MTAsMjYgKzM0MDIsMjYgQEAgQ29weVNsb3RzKEpTQ29udGV4dCAqY3gsIEpTT2JqZWN0
ICpmcm9tLAogICAgIEpTX0FTU0VSVCghZnJvbS0+aXNOYXRpdmUoKSAmJiAhdG8tPmlzTmF0aXZl
KCkpOwogICAgIHNpemVfdCBuc2xvdHMgPSBmcm9tLT5udW1TbG90cygpOwogICAgIGlmICh0by0+
ZW5zdXJlU2xvdHMoY3gsIG5zbG90cykpCiAgICAgICAgIHJldHVybiBmYWxzZTsKIAogICAgIHNp
emVfdCBuID0gMDsKICAgICBpZiAodG8tPmlzV3JhcHBlcigpICYmCiAgICAgICAgIChKU1dyYXBw
ZXI6OndyYXBwZXJIYW5kbGVyKHRvKS0+ZmxhZ3MoKSAmIEpTV3JhcHBlcjo6Q1JPU1NfQ09NUEFS
VE1FTlQpKSB7Ci0gICAgICAgIHRvLT5zbG90c1swXSA9IGZyb20tPnNsb3RzWzBdOwotICAgICAg
ICB0by0+c2xvdHNbMV0gPSBmcm9tLT5zbG90c1sxXTsKKyAgICAgICAgdG8tPnNldFNsb3QoMCwg
ZnJvbS0+Z2V0U2xvdCgwKSk7CisgICAgICAgIHRvLT5zZXRTbG90KDEsIGZyb20tPmdldFNsb3Qo
MSkpOwogICAgICAgICBuID0gMjsKICAgICB9CiAKICAgICBmb3IgKDsgbiA8IG5zbG90czsgKytu
KSB7Ci0gICAgICAgIFZhbHVlIHYgPSBmcm9tLT5zbG90c1tuXTsKKyAgICAgICAgVmFsdWUgdiA9
IGZyb20tPmdldFNsb3Qobik7CiAgICAgICAgIGlmICghY3gtPmNvbXBhcnRtZW50LT53cmFwKGN4
LCAmdikpCiAgICAgICAgICAgICByZXR1cm4gZmFsc2U7Ci0gICAgICAgIHRvLT5zbG90c1tuXSA9
IHY7CisgICAgICAgIHRvLT5zZXRTbG90KG4sIHYpOwogICAgIH0KICAgICByZXR1cm4gdHJ1ZTsK
IH0KIAogSlNPYmplY3QgKgogSlNPYmplY3Q6OmNsb25lKEpTQ29udGV4dCAqY3gsIEpTT2JqZWN0
ICpwcm90bywgSlNPYmplY3QgKnBhcmVudCkKIHsKICAgICAvKgpAQCAtMzQ2MywxMDMgKzM0NTUs
MTAxIEBAIEpTT2JqZWN0OjpjbG9uZShKU0NvbnRleHQgKmN4LCBKU09iamVjdCAKICAgICB9IGVs
c2UgewogICAgICAgICBKU19BU1NFUlQoaXNQcm94eSgpKTsKICAgICAgICAgaWYgKCFDb3B5U2xv
dHMoY3gsIHRoaXMsIGNsb25lKSkKICAgICAgICAgICAgIHJldHVybiBOVUxMOwogICAgIH0KICAg
ICByZXR1cm4gY2xvbmU7CiB9CiAKLXN0YXRpYyB2b2lkCi1UcmFkZUd1dHMoSlNPYmplY3QgKmEs
IEpTT2JqZWN0ICpiKQorYm9vbAorSlNPYmplY3Q6OlRyYWRlR3V0cyhKU0NvbnRleHQgKmN4LCBK
U09iamVjdCAqYSwgSlNPYmplY3QgKmIpCiB7CiAgICAgSlNfQVNTRVJUKGEtPmNvbXBhcnRtZW50
KCkgPT0gYi0+Y29tcGFydG1lbnQoKSk7CiAgICAgSlNfQVNTRVJUKGEtPmlzRnVuY3Rpb24oKSA9
PSBiLT5pc0Z1bmN0aW9uKCkpOwogCiAgICAgLyoKICAgICAgKiBSZWdleHAgZ3V0cyBhcmUgbW9y
ZSBjb21wbGljYXRlZCAtLSB3ZSB3b3VsZCBuZWVkIHRvIG1pZ3JhdGUgdGhlCiAgICAgICogcmVm
Y291bnRlZCBKSVQgY29kZSBibG9iIGZvciB0aGVtIGFjcm9zcyBjb21wYXJ0bWVudHMgaW5zdGVh
ZCBvZiBqdXN0CiAgICAgICogc3dhcHBpbmcgZ3V0cy4KICAgICAgKi8KICAgICBKU19BU1NFUlQo
IWEtPmlzUmVnRXhwKCkgJiYgIWItPmlzUmVnRXhwKCkpOwogCi0gICAgYm9vbCBhSW5saW5lID0g
IWEtPmhhc1Nsb3RzQXJyYXkoKTsKLSAgICBib29sIGJJbmxpbmUgPSAhYi0+aGFzU2xvdHNBcnJh
eSgpOworICAgIC8qCisgICAgICogQ2FsbGVycyBzaG91bGQgbm90IHRyeSB0byBzd2FwIGRlbnNl
IGFycmF5cywgdGhlc2UgdXNlIGEgZGlmZmVyZW50IHNsb3QKKyAgICAgKiByZXByZXNlbnRhdGlv
biBmcm9tIG90aGVyIG9iamVjdHMuCisgICAgICovCisgICAgSlNfQVNTRVJUKCFhLT5pc0RlbnNl
QXJyYXkoKSAmJiAhYi0+aXNEZW5zZUFycmF5KCkpOwogCiAgICAgLyogVHJhZGUgdGhlIGd1dHMg
b2YgdGhlIG9iamVjdHMuICovCi0gICAgY29uc3Qgc2l6ZV90IHNpemUgPSBHZXRPYmplY3RTaXpl
KGEpOwotICAgIGlmIChzaXplID09IEdldE9iamVjdFNpemUoYikpIHsKKyAgICBjb25zdCBzaXpl
X3Qgc2l6ZSA9IGEtPnN0cnVjdFNpemUoKTsKKyAgICBpZiAoc2l6ZSA9PSBiLT5zdHJ1Y3RTaXpl
KCkpIHsKICAgICAgICAgLyoKICAgICAgICAgICogSWYgdGhlIG9iamVjdHMgYXJlIHRoZSBzYW1l
IHNpemUsIHRoZW4gd2UgbWFrZSBubyBhc3N1bXB0aW9ucyBhYm91dAogICAgICAgICAgKiB3aGV0
aGVyIHRoZXkgaGF2ZSBkeW5hbWljYWxseSBhbGxvY2F0ZWQgc2xvdHMgYW5kIGluc3RlYWQganVz
dCBjb3B5CiAgICAgICAgICAqIHRoZW0gb3ZlciB3aG9sZXNhbGUuCiAgICAgICAgICAqLwogICAg
ICAgICBjaGFyIHRtcFt0bDo6TWF4PHNpemVvZihKU0Z1bmN0aW9uKSwgc2l6ZW9mKEpTT2JqZWN0
X1Nsb3RzMTYpPjo6cmVzdWx0XTsKICAgICAgICAgSlNfQVNTRVJUKHNpemUgPD0gc2l6ZW9mKHRt
cCkpOwogCiAgICAgICAgIG1lbWNweSh0bXAsIGEsIHNpemUpOwogICAgICAgICBtZW1jcHkoYSwg
Yiwgc2l6ZSk7CiAgICAgICAgIG1lbWNweShiLCB0bXAsIHNpemUpOwotCi0gICAgICAgIC8qIEZp
eHVwIHBvaW50ZXJzIGZvciBpbmxpbmUgc2xvdHMgb24gdGhlIG9iamVjdHMuICovCi0gICAgICAg
IGlmIChhSW5saW5lKQotICAgICAgICAgICAgYi0+c2xvdHMgPSBiLT5maXhlZFNsb3RzKCk7Ci0g
ICAgICAgIGlmIChiSW5saW5lKQotICAgICAgICAgICAgYS0+c2xvdHMgPSBhLT5maXhlZFNsb3Rz
KCk7CiAgICAgfSBlbHNlIHsKICAgICAgICAgLyoKLSAgICAgICAgICogSWYgdGhlIG9iamVjdHMg
YXJlIG9mIGRpZmZlcmluZyBzaXplcywgdGhlbiB3ZSBvbmx5IGNvcHkgb3ZlciB0aGUKLSAgICAg
ICAgICogSlNPYmplY3QgcG9ydGlvbiAodGhpbmdzIGxpa2UgY2xhc3MsIGV0Yy4pIGFuZCBsZWF2
ZSBpdCB0bwotICAgICAgICAgKiBKU09iamVjdDo6Y2xvbmUgdG8gY29weSBvdmVyIHRoZSBkeW5h
bWljIHNsb3RzIGZvciB1cy4KKyAgICAgICAgICogSWYgdGhlIG9iamVjdHMgYXJlIG9mIGRpZmZl
cmluZyBzaXplcywgdGhlbiB3ZSBuZWVkIHRvIGdldCBhcnJheXMgb2YKKyAgICAgICAgICogYWxs
IHRoZSBzbG90cyBhbmQgY29weSB0aGVtIG92ZXIgbWFudWFsbHk7IHdoZXRoZXIgYSBnaXZlbiBz
bG90IGlzCisgICAgICAgICAqIGlubGluZSBvciBub3Qgd2lsbCB2YXJ5IGJldHdlZW4gdGhlIG9i
amVjdHMuIFRoaXMgc2l0dWF0aW9uIG11c3QKKyAgICAgICAgICogb25seSBoYXBwZW4gd2hlbiB3
ZSBhcmUgc3dhcHBpbmcgcHJveGllcywgd2hpY2ggYXJlIG5vbi1uYXRpdmUgYW5kCisgICAgICAg
ICAqIHRodXMgZG8gbm90IGhhdmUgc2hhcGVzIGRlcGVuZGluZyBvbiB0aGUgbnVtYmVyIG9mIGlu
bGluZSBzbG90cy4KICAgICAgICAgICovCisgICAgICAgIEpTX0FTU0VSVChhLT5pc1Byb3h5KCkg
JiYgYi0+aXNQcm94eSgpKTsKKworICAgICAgICBBdXRvVmFsdWVWZWN0b3IgYXZhbHMoY3gpOwor
ICAgICAgICBpZiAoIWF2YWxzLnJlc2VydmUoYS0+bnVtU2xvdHMoKSkpCisgICAgICAgICAgICBy
ZXR1cm4gZmFsc2U7CisgICAgICAgIGZvciAoc2l6ZV90IGkgPSAwOyBpIDwgYS0+bnVtU2xvdHMo
KTsgaSsrKQorICAgICAgICAgICAgYXZhbHMuaW5mYWxsaWJsZUFwcGVuZChhLT5nZXRTbG90KGkp
KTsKKworICAgICAgICBBdXRvVmFsdWVWZWN0b3IgYnZhbHMoY3gpOworICAgICAgICBpZiAoIWJ2
YWxzLnJlc2VydmUoYi0+bnVtU2xvdHMoKSkpCisgICAgICAgICAgICByZXR1cm4gZmFsc2U7Cisg
ICAgICAgIGZvciAoc2l6ZV90IGkgPSAwOyBpIDwgYi0+bnVtU2xvdHMoKTsgaSsrKQorICAgICAg
ICAgICAgYnZhbHMuaW5mYWxsaWJsZUFwcGVuZChiLT5nZXRTbG90KGkpKTsKKwogICAgICAgICBp
ZiAoYS0+aXNGdW5jdGlvbigpKSB7CiAgICAgICAgICAgICBKU0Z1bmN0aW9uIHRtcDsKICAgICAg
ICAgICAgIG1lbWNweSgmdG1wLCBhLCBzaXplb2YgdG1wKTsKICAgICAgICAgICAgIG1lbWNweShh
LCBiLCBzaXplb2YgdG1wKTsKICAgICAgICAgICAgIG1lbWNweShiLCAmdG1wLCBzaXplb2YgdG1w
KTsKICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgIEpTT2JqZWN0IHRtcDsKICAgICAgICAg
ICAgIG1lbWNweSgmdG1wLCBhLCBzaXplb2YgdG1wKTsKICAgICAgICAgICAgIG1lbWNweShhLCBi
LCBzaXplb2YgdG1wKTsKICAgICAgICAgICAgIG1lbWNweShiLCAmdG1wLCBzaXplb2YgdG1wKTsK
ICAgICAgICAgfQogCi0gICAgICAgIEpTX0FTU0VSVCghYUlubGluZSk7Ci0gICAgICAgIEpTX0FT
U0VSVCghYklubGluZSk7Ci0gICAgfQorICAgICAgICBhLT5jb3B5U2xvdFJhbmdlKDAsIGJ2YWxz
LmJlZ2luKCksIGEtPm51bVNsb3RzKCkpOworICAgICAgICBiLT5jb3B5U2xvdFJhbmdlKDAsIGF2
YWxzLmJlZ2luKCksIGItPm51bVNsb3RzKCkpOworICAgIH0KKworICAgIHJldHVybiB0cnVlOwog
fQogCiAvKgogICogVXNlIHRoaXMgbWV0aG9kIHdpdGggZXh0cmVtZSBjYXV0aW9uLiBJdCB0cmFk
ZXMgdGhlIGd1dHMgb2YgdHdvIG9iamVjdHMgYW5kIHVwZGF0ZXMKICAqIHNjb3BlIG93bmVyc2hp
cC4gVGhpcyBvcGVyYXRpb24gaXMgbm90IHRocmVhZC1zYWZlLCBqdXN0IGFzIGZhc3QgYXJyYXkg
dG8gc2xvdyBhcnJheQogICogdHJhbnNpdGlvbnMgYXJlIGluaGVyZW50bHkgbm90IHRocmVhZC1z
YWZlLiBEb24ndCBwZXJmb3JtIGEgc3dhcCBvcGVyYXRpb24gb24gb2JqZWN0cwogICogc2hhcmVk
IGFjcm9zcyB0aHJlYWRzIG9yLCBvciBiYWQgdGhpbmdzIHdpbGwgaGFwcGVuLiBZb3UgaGF2ZSBi
ZWVuIHdhcm5lZC4KICAqLwogYm9vbAogSlNPYmplY3Q6OnN3YXAoSlNDb250ZXh0ICpjeCwgSlNP
YmplY3QgKm90aGVyKQogewotICAgIC8qCi0gICAgICogSWYgd2UgYXJlIHN3YXBwaW5nIG9iamVj
dHMgd2l0aCBhIGRpZmZlcmVudCBudW1iZXIgb2YgYnVpbHRpbiBzbG90cywgZm9yY2UKLSAgICAg
KiBib3RoIHRvIG5vdCB1c2UgdGhlaXIgaW5saW5lIHNsb3RzLgotICAgICAqLwotICAgIGlmIChH
ZXRPYmplY3RTaXplKHRoaXMpICE9IEdldE9iamVjdFNpemUob3RoZXIpKSB7Ci0gICAgICAgIGlm
ICghaGFzU2xvdHNBcnJheSgpKSB7Ci0gICAgICAgICAgICBpZiAoIWFsbG9jU2xvdHMoY3gsIG51
bVNsb3RzKCkpKQotICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTsKLSAgICAgICAgfQotICAg
ICAgICBpZiAoIW90aGVyLT5oYXNTbG90c0FycmF5KCkpIHsKLSAgICAgICAgICAgIGlmICghb3Ro
ZXItPmFsbG9jU2xvdHMoY3gsIG90aGVyLT5udW1TbG90cygpKSkKLSAgICAgICAgICAgICAgICBy
ZXR1cm4gZmFsc2U7Ci0gICAgICAgIH0KLSAgICB9Ci0KLSAgICBpZiAodGhpcy0+Y29tcGFydG1l
bnQoKSA9PSBvdGhlci0+Y29tcGFydG1lbnQoKSkgewotICAgICAgICBUcmFkZUd1dHModGhpcywg
b3RoZXIpOwotICAgICAgICByZXR1cm4gdHJ1ZTsKLSAgICB9CisgICAgaWYgKHRoaXMtPmNvbXBh
cnRtZW50KCkgPT0gb3RoZXItPmNvbXBhcnRtZW50KCkpCisgICAgICAgIHJldHVybiBUcmFkZUd1
dHMoY3gsIHRoaXMsIG90aGVyKTsKIAogICAgIEpTT2JqZWN0ICp0aGlzQ2xvbmU7CiAgICAgSlNP
YmplY3QgKm90aGVyQ2xvbmU7CiAgICAgewogICAgICAgICBBdXRvQ29tcGFydG1lbnQgYWMoY3gs
IG90aGVyKTsKICAgICAgICAgaWYgKCFhYy5lbnRlcigpKQogICAgICAgICAgICAgcmV0dXJuIGZh
bHNlOwogICAgICAgICB0aGlzQ2xvbmUgPSB0aGlzLT5jbG9uZShjeCwgb3RoZXItPmdldFByb3Rv
KCksIG90aGVyLT5nZXRQYXJlbnQoKSk7CkBAIC0zNTY5LDE4ICszNTU5LDIwIEBAIEpTT2JqZWN0
Ojpzd2FwKEpTQ29udGV4dCAqY3gsIEpTT2JqZWN0ICoKICAgICB7CiAgICAgICAgIEF1dG9Db21w
YXJ0bWVudCBhYyhjeCwgdGhpcyk7CiAgICAgICAgIGlmICghYWMuZW50ZXIoKSkKICAgICAgICAg
ICAgIHJldHVybiBmYWxzZTsKICAgICAgICAgb3RoZXJDbG9uZSA9IG90aGVyLT5jbG9uZShjeCwg
b3RoZXItPmdldFByb3RvKCksIG90aGVyLT5nZXRQYXJlbnQoKSk7CiAgICAgICAgIGlmICghb3Ro
ZXJDbG9uZSB8fCAhb3RoZXJDbG9uZS0+Y29weVByb3BlcnRpZXNGcm9tKGN4LCBvdGhlcikpCiAg
ICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgfQotICAgIFRyYWRlR3V0cyh0aGlzLCBvdGhl
ckNsb25lKTsKLSAgICBUcmFkZUd1dHMob3RoZXIsIHRoaXNDbG9uZSk7CisgICAgaWYgKCFUcmFk
ZUd1dHMoY3gsIHRoaXMsIG90aGVyQ2xvbmUpKQorICAgICAgICByZXR1cm4gZmFsc2U7CisgICAg
aWYgKCFUcmFkZUd1dHMoY3gsIG90aGVyLCB0aGlzQ2xvbmUpKQorICAgICAgICByZXR1cm4gZmFs
c2U7CiAKICAgICByZXR1cm4gdHJ1ZTsKIH0KIAogI2lmIEpTX0hBU19YRFIKIAogI2RlZmluZSBO
T19QQVJFTlRfSU5ERVggKCh1aW50MzIpLTEpCiAKQEAgLTM5NjYsMzggKzM5NTgsOTAgQEAganNf
SW5pdENsYXNzKEpTQ29udGV4dCAqY3gsIEpTT2JqZWN0ICpvYgogICAgICAgICAhanNfR2V0Q2xh
c3NQcm90b3R5cGUoY3gsIG9iaiwgSlNQcm90b19PYmplY3QsICZwcm90b1Byb3RvKSkgewogICAg
ICAgICByZXR1cm4gTlVMTDsKICAgICB9CiAKICAgICByZXR1cm4gRGVmaW5lQ29uc3RydWN0b3JB
bmRQcm90b3R5cGUoY3gsIG9iaiwga2V5LCBhdG9tLCBwcm90b1Byb3RvLCBjbGFzcCwgY29uc3Ry
dWN0b3IsIG5hcmdzLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBw
cywgZnMsIHN0YXRpY19wcywgc3RhdGljX2ZzKTsKIH0KIAordm9pZAorSlNPYmplY3Q6OmNsZWFy
U2xvdFJhbmdlKHNpemVfdCBzdGFydCwgc2l6ZV90IGxlbmd0aCkKK3sKKyAgICBKU19BU1NFUlQo
c3RhcnQgKyBsZW5ndGggPD0gY2FwYWNpdHkpOworICAgIGlmIChpc0RlbnNlQXJyYXkoKSkgewor
ICAgICAgICBDbGVhclZhbHVlUmFuZ2Uoc2xvdHMgKyBzdGFydCwgbGVuZ3RoLCB0cnVlKTsKKyAg
ICB9IGVsc2UgeworICAgICAgICBzaXplX3QgZml4ZWQgPSBudW1GaXhlZFNsb3RzKCk7CisgICAg
ICAgIGlmIChzdGFydCA8IGZpeGVkKSB7CisgICAgICAgICAgICBpZiAoc3RhcnQgKyBsZW5ndGgg
PCBmaXhlZCkgeworICAgICAgICAgICAgICAgIENsZWFyVmFsdWVSYW5nZShmaXhlZFNsb3RzKCkg
KyBzdGFydCwgbGVuZ3RoLCBmYWxzZSk7CisgICAgICAgICAgICB9IGVsc2UgeworICAgICAgICAg
ICAgICAgIHNpemVfdCBsb2NhbENsZWFyID0gZml4ZWQgLSBzdGFydDsKKyAgICAgICAgICAgICAg
ICBDbGVhclZhbHVlUmFuZ2UoZml4ZWRTbG90cygpICsgc3RhcnQsIGxvY2FsQ2xlYXIsIGZhbHNl
KTsKKyAgICAgICAgICAgICAgICBDbGVhclZhbHVlUmFuZ2Uoc2xvdHMsIGxlbmd0aCAtIGxvY2Fs
Q2xlYXIsIGZhbHNlKTsKKyAgICAgICAgICAgIH0KKyAgICAgICAgfSBlbHNlIHsKKyAgICAgICAg
ICAgIENsZWFyVmFsdWVSYW5nZShzbG90cyArIHN0YXJ0IC0gZml4ZWQsIGxlbmd0aCwgZmFsc2Up
OworICAgICAgICB9CisgICAgfQorfQorCit2b2lkCitKU09iamVjdDo6Y29weVNsb3RSYW5nZShz
aXplX3Qgc3RhcnQsIGNvbnN0IFZhbHVlICp2ZWN0b3IsIHNpemVfdCBsZW5ndGgpCit7CisgICAg
SlNfQVNTRVJUKHN0YXJ0ICsgbGVuZ3RoIDw9IGNhcGFjaXR5KTsKKyAgICBpZiAoaXNEZW5zZUFy
cmF5KCkpIHsKKyAgICAgICAgbWVtY3B5KHNsb3RzICsgc3RhcnQsIHZlY3RvciwgbGVuZ3RoICog
c2l6ZW9mKFZhbHVlKSk7CisgICAgfSBlbHNlIHsKKyAgICAgICAgc2l6ZV90IGZpeGVkID0gbnVt
Rml4ZWRTbG90cygpOworICAgICAgICBpZiAoc3RhcnQgPCBmaXhlZCkgeworICAgICAgICAgICAg
aWYgKHN0YXJ0ICsgbGVuZ3RoIDwgZml4ZWQpIHsKKyAgICAgICAgICAgICAgICBtZW1jcHkoZml4
ZWRTbG90cygpICsgc3RhcnQsIHZlY3RvciwgbGVuZ3RoICogc2l6ZW9mKFZhbHVlKSk7CisgICAg
ICAgICAgICB9IGVsc2UgeworICAgICAgICAgICAgICAgIHNpemVfdCBsb2NhbENvcHkgPSBmaXhl
ZCAtIHN0YXJ0OworICAgICAgICAgICAgICAgIG1lbWNweShmaXhlZFNsb3RzKCkgKyBzdGFydCwg
dmVjdG9yLCBsb2NhbENvcHkgKiBzaXplb2YoVmFsdWUpKTsKKyAgICAgICAgICAgICAgICBtZW1j
cHkoc2xvdHMsIHZlY3RvciArIGxvY2FsQ29weSwgKGxlbmd0aCAtIGxvY2FsQ29weSkgKiBzaXpl
b2YoVmFsdWUpKTsKKyAgICAgICAgICAgIH0KKyAgICAgICAgfSBlbHNlIHsKKyAgICAgICAgICAg
IG1lbWNweShzbG90cyArIHN0YXJ0IC0gZml4ZWQsIHZlY3RvciwgbGVuZ3RoICogc2l6ZW9mKFZh
bHVlKSk7CisgICAgICAgIH0KKyAgICB9Cit9CisKIGJvb2wKIEpTT2JqZWN0OjphbGxvY1Nsb3Rz
KEpTQ29udGV4dCAqY3gsIHNpemVfdCBuZXdjYXApCiB7CiAgICAgdWludDMyIG9sZGNhcCA9IG51
bVNsb3RzKCk7CiAKICAgICBKU19BU1NFUlQobmV3Y2FwID49IG9sZGNhcCAmJiAhaGFzU2xvdHNB
cnJheSgpKTsKIAogICAgIGlmIChuZXdjYXAgPiBOU0xPVFNfTElNSVQpIHsKICAgICAgICAgaWYg
KCFKU19PTl9UUkFDRShjeCkpCiAgICAgICAgICAgICBqc19SZXBvcnRBbGxvY2F0aW9uT3ZlcmZs
b3coY3gpOwogICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgfQogCi0gICAgVmFsdWUgKnRtcHNs
b3RzID0gKFZhbHVlKikgY3gtPm1hbGxvY18obmV3Y2FwICogc2l6ZW9mKFZhbHVlKSk7CisgICAg
dWludDMyIGFsbG9jQ291bnQgPSBpc0RlbnNlQXJyYXkoKSA/IG5ld2NhcCA6IG5ld2NhcCAtIG51
bUZpeGVkU2xvdHMoKTsKKworICAgIFZhbHVlICp0bXBzbG90cyA9IChWYWx1ZSopIGN4LT5tYWxs
b2NfKGFsbG9jQ291bnQgKiBzaXplb2YoVmFsdWUpKTsKICAgICBpZiAoIXRtcHNsb3RzKQogICAg
ICAgICByZXR1cm4gZmFsc2U7ICAvKiBMZWF2ZSBzbG90cyBhdCBpbmxpbmUgYnVmZmVyLiAqLwog
ICAgIHNsb3RzID0gdG1wc2xvdHM7CiAgICAgY2FwYWNpdHkgPSBuZXdjYXA7CiAKLSAgICAvKiBD
b3B5IG92ZXIgYW55dGhpbmcgZnJvbSB0aGUgaW5saW5lIGJ1ZmZlci4gKi8KLSAgICBtZW1jcHko
c2xvdHMsIGZpeGVkU2xvdHMoKSwgb2xkY2FwICogc2l6ZW9mKFZhbHVlKSk7Ci0gICAgQ2xlYXJW
YWx1ZVJhbmdlKHNsb3RzICsgb2xkY2FwLCBuZXdjYXAgLSBvbGRjYXAsIGlzRGVuc2VBcnJheSgp
KTsKKyAgICBpZiAoaXNEZW5zZUFycmF5KCkpIHsKKyAgICAgICAgLyogQ29weSBvdmVyIGFueXRo
aW5nIGZyb20gdGhlIGlubGluZSBidWZmZXIuICovCisgICAgICAgIG1lbWNweShzbG90cywgZml4
ZWRTbG90cygpLCBvbGRjYXAgKiBzaXplb2YoVmFsdWUpKTsKKyAgICAgICAgQ2xlYXJWYWx1ZVJh
bmdlKHNsb3RzICsgb2xkY2FwLCBuZXdjYXAgLSBvbGRjYXAsIHRydWUpOworICAgIH0gZWxzZSB7
CisgICAgICAgIC8qIENsZWFyIG91dCB0aGUgbmV3IHNsb3RzIHdpdGhvdXQgY29weWluZy4gKi8K
KyAgICAgICAgQ2xlYXJWYWx1ZVJhbmdlKHNsb3RzLCBhbGxvY0NvdW50LCBmYWxzZSk7CisgICAg
fQorCiAgICAgcmV0dXJuIHRydWU7CiB9CiAKIGJvb2wKIEpTT2JqZWN0Ojpncm93U2xvdHMoSlND
b250ZXh0ICpjeCwgc2l6ZV90IG5ld2NhcCkKIHsKICAgICAvKgogICAgICAqIFdoZW4gYW4gb2Jq
ZWN0IHdpdGggQ0FQQUNJVFlfRE9VQkxJTkdfTUFYIG9yIGZld2VyIHNsb3RzIG5lZWRzIHRvCkBA
IC00MDI3LDU1ICs0MDcxLDYxIEBAIEpTT2JqZWN0Ojpncm93U2xvdHMoSlNDb250ZXh0ICpjeCwg
c2l6ZV8KICAgICAgICAgSlNfUmVwb3J0T3V0T2ZNZW1vcnkoY3gpOwogICAgICAgICByZXR1cm4g
ZmFsc2U7CiAgICAgfQogCiAgICAgLyogSWYgbm90aGluZyB3YXMgYWxsb2NhdGVkIHlldCwgdHJl
YXQgaXQgYXMgaW5pdGlhbCBhbGxvY2F0aW9uLiAqLwogICAgIGlmICghaGFzU2xvdHNBcnJheSgp
KQogICAgICAgICByZXR1cm4gYWxsb2NTbG90cyhjeCwgYWN0dWFsQ2FwYWNpdHkpOwogCi0gICAg
VmFsdWUgKnRtcHNsb3RzID0gKFZhbHVlKikgY3gtPnJlYWxsb2NfKHNsb3RzLCBvbGRjYXAgKiBz
aXplb2YoVmFsdWUpLCBhY3R1YWxDYXBhY2l0eSAqIHNpemVvZihWYWx1ZSkpOworICAgIHVpbnQz
MiBvbGRBbGxvY0NvdW50ID0gaXNEZW5zZUFycmF5KCkgPyBvbGRjYXAgOiBvbGRjYXAgLSBudW1G
aXhlZFNsb3RzKCk7CisgICAgdWludDMyIGFsbG9jQ291bnQgPSBpc0RlbnNlQXJyYXkoKSA/IGFj
dHVhbENhcGFjaXR5IDogYWN0dWFsQ2FwYWNpdHkgLSBudW1GaXhlZFNsb3RzKCk7CisKKyAgICBW
YWx1ZSAqdG1wc2xvdHMgPSAoVmFsdWUqKSBjeC0+cmVhbGxvY18oc2xvdHMsIG9sZEFsbG9jQ291
bnQgKiBzaXplb2YoVmFsdWUpLAorICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICBhbGxvY0NvdW50ICogc2l6ZW9mKFZhbHVlKSk7CiAgICAgaWYgKCF0bXBzbG90cykK
ICAgICAgICAgcmV0dXJuIGZhbHNlOyAgICAvKiBMZWF2ZSBkc2xvdHMgYXMgaXRzIG9sZCBzaXpl
LiAqLwogICAgIHNsb3RzID0gdG1wc2xvdHM7CiAgICAgY2FwYWNpdHkgPSBhY3R1YWxDYXBhY2l0
eTsKIAogICAgIC8qIEluaXRpYWxpemUgdGhlIGFkZGl0aW9uYWwgc2xvdHMgd2UgYWRkZWQuICov
Ci0gICAgQ2xlYXJWYWx1ZVJhbmdlKHNsb3RzICsgb2xkY2FwLCBhY3R1YWxDYXBhY2l0eSAtIG9s
ZGNhcCwgaXNEZW5zZUFycmF5KCkpOworICAgIENsZWFyVmFsdWVSYW5nZShzbG90cyArIG9sZEFs
bG9jQ291bnQsIGFsbG9jQ291bnQgLSBvbGRBbGxvY0NvdW50LCBpc0RlbnNlQXJyYXkoKSk7CiAg
ICAgcmV0dXJuIHRydWU7CiB9CiAKIHZvaWQKIEpTT2JqZWN0OjpzaHJpbmtTbG90cyhKU0NvbnRl
eHQgKmN4LCBzaXplX3QgbmV3Y2FwKQogewogICAgIHVpbnQzMiBvbGRjYXAgPSBudW1TbG90cygp
OwogICAgIEpTX0FTU0VSVChuZXdjYXAgPD0gb2xkY2FwKTsKICAgICBKU19BU1NFUlQobmV3Y2Fw
ID49IHNsb3RTcGFuKCkpOwogCisgICAgc2l6ZV90IGZpeGVkID0gbnVtRml4ZWRTbG90cygpOwor
CiAgICAgaWYgKG9sZGNhcCA8PSBTTE9UX0NBUEFDSVRZX01JTiB8fCAhaGFzU2xvdHNBcnJheSgp
KSB7Ci0gICAgICAgIC8qIFdlIHdvbid0IHNocmluayB0aGUgc2xvdHMgYW55IG1vcmUuICBDbGVh
ciBleGNlc3MgaG9sZXMuICovCi0gICAgICAgIENsZWFyVmFsdWVSYW5nZShzbG90cyArIG5ld2Nh
cCwgb2xkY2FwIC0gbmV3Y2FwLCBpc0RlbnNlQXJyYXkoKSk7CisgICAgICAgIC8qIFdlIHdvbid0
IHNocmluayB0aGUgc2xvdHMgYW55IG1vcmUuIENsZWFyIGV4Y2VzcyBlbnRyaWVzLiAqLworICAg
ICAgICBjbGVhclNsb3RSYW5nZShuZXdjYXAsIG9sZGNhcCAtIG5ld2NhcCk7CiAgICAgICAgIHJl
dHVybjsKICAgICB9CiAKICAgICB1aW50MzIgZmlsbCA9IG5ld2NhcDsKICAgICBpZiAobmV3Y2Fw
IDwgU0xPVF9DQVBBQ0lUWV9NSU4pCiAgICAgICAgIG5ld2NhcCA9IFNMT1RfQ0FQQUNJVFlfTUlO
OwotICAgIGlmIChuZXdjYXAgPCBudW1GaXhlZFNsb3RzKCkpCi0gICAgICAgIG5ld2NhcCA9IG51
bUZpeGVkU2xvdHMoKTsKKyAgICBpZiAobmV3Y2FwIDwgZml4ZWQpCisgICAgICAgIG5ld2NhcCA9
IGZpeGVkOwogCiAgICAgVmFsdWUgKnRtcHNsb3RzID0gKFZhbHVlKikgY3gtPnJlYWxsb2NfKHNs
b3RzLCBuZXdjYXAgKiBzaXplb2YoVmFsdWUpKTsKICAgICBpZiAoIXRtcHNsb3RzKQogICAgICAg
ICByZXR1cm47ICAvKiBMZWF2ZSBzbG90cyBhdCBpdHMgb2xkIHNpemUuICovCiAgICAgc2xvdHMg
PSB0bXBzbG90czsKICAgICBjYXBhY2l0eSA9IG5ld2NhcDsKIAogICAgIGlmIChmaWxsIDwgbmV3
Y2FwKSB7CiAgICAgICAgIC8qIENsZWFyIGFueSBleGNlc3MgaG9sZXMgaWYgd2UgdHJpZWQgdG8g
c2hyaW5rIGJlbG93IFNMT1RfQ0FQQUNJVFlfTUlOLiAqLwotICAgICAgICBDbGVhclZhbHVlUmFu
Z2Uoc2xvdHMgKyBmaWxsLCBuZXdjYXAgLSBmaWxsLCBpc0RlbnNlQXJyYXkoKSk7CisgICAgICAg
IGNsZWFyU2xvdFJhbmdlKGZpbGwsIG5ld2NhcCAtIGZpbGwpOwogICAgIH0KIH0KIAogYm9vbAog
SlNPYmplY3Q6OmVuc3VyZUluc3RhbmNlUmVzZXJ2ZWRTbG90cyhKU0NvbnRleHQgKmN4LCBzaXpl
X3QgbnJlc2VydmVkKQogewogICAgIEpTX0FTU0VSVF9JRihpc05hdGl2ZSgpLAogICAgICAgICAg
ICAgICAgICBpc0Jsb2NrKCkgfHwgaXNDYWxsKCkgfHwgKGlzRnVuY3Rpb24oKSAmJiBpc0JvdW5k
RnVuY3Rpb24oKSkpOwpkaWZmIC0tZ2l0IGEvanMvc3JjL2pzb2JqLmggYi9qcy9zcmMvanNvYmou
aAotLS0gYS9qcy9zcmMvanNvYmouaAorKysgYi9qcy9zcmMvanNvYmouaApAQCAtMzA1LDM2ICsz
MDUsNDUgQEAgY2xhc3MgVmFsaWRhdGVXcml0ZXI7CiAgKiBidXQgaXQgaGFzIG5vIGludHJpbnNp
YyBtZWFuaW5nIHRvIFNwaWRlck1vbmtleS4gRnVydGhlciwgSlNGSUxFTkFNRV9TWVNURU0KICAq
IGFuZCBKU19GbGFnU2NyaXB0RmlsZW5hbWVQcmVmaXggKGFsc28gZXhwb3J0ZWQgdmlhIGpzZGJn
YXBpLmgpIGFyZSBpbnRlbmRlZAogICogdG8gYmUgY29tcGxlbWVudGFyeSB0byB0aGlzIGJpdCwg
YnV0IGl0IGlzIHVwIHRvIHRoZSBBUEkgY2xpZW50IHRvIGltcGxlbWVudAogICogYW55IHN1Y2gg
YXNzb2NpYXRpb24uCiAgKgogICogQm90aCB0aGVzZSBmbGFnIGJpdHMgYXJlIGluaXRpYWxseSB6
ZXJvOyB0aGV5IG1heSBiZSBzZXQgb3IgcXVlcmllZCB1c2luZwogICogdGhlIChpc3xzZXQpKERl
bGVnYXRlfFN5c3RlbSkgaW5saW5lIG1ldGhvZHMuCiAgKgotICogVGhlIHNsb3RzIG1lbWJlciBp
cyBhIHBvaW50ZXIgdG8gdGhlIHNsb3QgdmVjdG9yIGZvciB0aGUgb2JqZWN0LgotICogVGhpcyBj
YW4gYmUgZWl0aGVyIGEgZml4ZWQgYXJyYXkgYWxsb2NhdGVkIGltbWVkaWF0ZWx5IGFmdGVyIHRo
ZSBvYmplY3QsCi0gKiBvciBhIGR5bmFtaWNhbGx5IGFsbG9jYXRlZCBhcnJheS4gIEEgZHluYW1p
YyBhcnJheSBjYW4gYmUgdGVzdGVkIGZvciB3aXRoCi0gKiBoYXNTbG90c0FycmF5KCkuICBJbiBh
bGwgY2FzZXMsIGNhcGFjaXR5IGdpdmVzIHRoZSBudW1iZXIgb2YgdXNhYmxlIHNsb3RzLgotICog
VHdvIG9iamVjdHMgd2l0aCB0aGUgc2FtZSBzaGFwZSBoYXZlIHRoZSBzYW1lIG51bWJlciBvZiBm
aXhlZCBzbG90cywKLSAqIGFuZCBlaXRoZXIgYm90aCBoYXZlIG9yIG5laXRoZXIgaGF2ZSBkeW5h
bWljYWxseSBhbGxvY2F0ZWQgc2xvdCBhcnJheXMuCisgKiBPYmplY3RzIGNhbiBoYXZlIHNsb3Rz
IGFsbG9jYXRlZCBlaXRoZXIgaW4gYSBmaXhlZCBhcnJheSBpbW1lZGlhdGVseQorICogZm9sbG93
aW5nIHRoZSBvYmplY3QsIGluIGR5bmFtaWNhbGx5IGFsbG9jYXRlZCBzbG90cywgb3IgYm90aC4g
SW4gYWxsIGNhc2VzLAorICogJ2NhcGFjaXR5JyBnaXZlcyB0aGUgbnVtYmVyIG9mIHVzYWJsZSBz
bG90cy4gSG93IHRoZSBzbG90cyBhcmUgb3JnYW5pemVkCisgKiBpcyBkaWZmZXJlbnQgZm9yIGRl
bnNlIGFycmF5cyB2cy4gb3RoZXIgb2JqZWN0cy4KKyAqCisgKiBGb3IgZGVuc2UgYXJyYXlzIChh
cnJheXMgd2l0aCBvbmx5IG5vcm1hbCBpbnRlZ2VyIHByb3BlcnRpZXMpLCB0aGUgJ3Nsb3RzJwor
ICogbWVtYmVyIHBvaW50cyBlaXRoZXIgdG8gdGhlIGZpeGVkIGFycmF5IG9yIHRvIGEgZHluYW1p
YyBhcnJheSwgYW5kIGluCisgKiBhbGwgY2FzZXMgaXMgaW5kZXhlZCBieSB0aGUgYXNzb2NpYXRl
ZCBwcm9wZXJ0eSAoZS5nLiBvYmotPnNsb3RzWzVdIHN0b3JlcworICogdGhlIHZhbHVlIGZvciBw
cm9wZXJ0eSAnNScpLiBJZiBhIGR5bmFtaWMgYXJyYXkgaXMgaW4gdXNlLCBzbG90cyBpbiB0aGUK
KyAqIGZpeGVkIGFycmF5IGFyZSBub3QgdXNlZC4KKyAqCisgKiBGb3Igb2JqZWN0cyBvdGhlciB0
aGFuIGRlbnNlIGFycmF5cywgaWYgdGhlIG9iamVjdCBoYXMgTiBmaXhlZCBzbG90cyB0aGVuCisg
KiB0aG9zZSBhcmUgYWx3YXlzIHRoZSBmaXJzdCBOIHNsb3RzIG9mIHRoZSBvYmplY3QuIFRoZSBk
eW5hbWljIHNsb3RzIHBvaW50ZXIKKyAqIGlzIHVzZWQgaWYgdGhvc2UgZml4ZWQgc2xvdHMgb3Zl
cmZsb3csIGFuZCBzdG9yZXMgYWxsIHJlbWFpbmluZyBzbG90cy4KKyAqIFVubGlrZSBkZW5zZSBh
cnJheXMsIHRoZSBmaXhlZCBzbG90cyBjYW4gYWx3YXlzIGJlIGFjY2Vzc2VkLiBUd28gb2JqZWN0
cworICogd2l0aCB0aGUgc2FtZSBzaGFwZSBoYXZlIHRoZSBzYW1lIG51bWJlciBvZiBmaXhlZCBz
bG90cy4KICAqCiAgKiBJZiB5b3UgY2hhbmdlIHRoaXMgc3RydWN0LCB5b3UnbGwgcHJvYmFibHkg
bmVlZCB0byBjaGFuZ2UgdGhlIEFjY1NldCB2YWx1ZXMKICAqIGluIGpzYnVpbHRpbnMuaC4KICAq
Lwogc3RydWN0IEpTT2JqZWN0IDoganM6OmdjOjpDZWxsIHsKICAgICAvKgogICAgICAqIFRyYWNl
UmVjb3JkZXIgbXVzdCBiZSBhIGZyaWVuZCBiZWNhdXNlIGl0IGdlbmVyYXRlcyBjb2RlIHRoYXQK
ICAgICAgKiBtYW5pcHVsYXRlcyBKU09iamVjdHMsIHdoaWNoIHJlcXVpcmVzIHBlZWtpbmcgdW5k
ZXIgYW55IGVuY2Fwc3VsYXRpb24uCiAgICAgICogVmFsaWRhdGVXcml0ZXIgbXVzdCBiZSBhIGZy
aWVuZCBiZWNhdXNlIGl0IHdvcmtzIGluIHRhbmRlbSB3aXRoCiAgICAgICogVHJhY2VSZWNvcmRl
ci4KICAgICAgKi8KICAgICBmcmllbmQgY2xhc3MganM6OlRyYWNlUmVjb3JkZXI7CiAgICAgZnJp
ZW5kIGNsYXNzIG5hbm9qaXQ6OlZhbGlkYXRlV3JpdGVyOwotICAgIGZyaWVuZCBjbGFzcyBHZXRQ
cm9wQ29tcGlsZXI7CiAKICAgICAvKgogICAgICAqIFByaXZhdGUgcG9pbnRlciB0byB0aGUgbGFz
dCBhZGRlZCBwcm9wZXJ0eSBhbmQgbWV0aG9kcyB0byBtYW5pcHVsYXRlIHRoZQogICAgICAqIGxp
c3QgaXQgbGlua3MgYW1vbmcgcHJvcGVydGllcyBpbiB0aGlzIHNjb3BlLiBUaGUge3JlbW92ZSxp
bnNlcnR9IHBhaXIKICAgICAgKiBmb3IgRGljdGlvbmFyeVByb3BlcnRpZXMgYXNzZXJ0IHRoYXQg
dGhlIHNjb3BlIGlzIGluIGRpY3Rpb25hcnkgbW9kZSBhbmQKICAgICAgKiBhbnkgcmVhY2hhYmxl
IHByb3BlcnRpZXMgYXJlIGZsYWdnZWQgYXMgZGljdGlvbmFyeSBwcm9wZXJ0aWVzLgogICAgICAq
CiAgICAgICogRm9yIG5hdGl2ZSBvYmplY3RzLCB0aGlzIGZpZWxkIGlzIGFsd2F5cyBhIFNoYXBl
LiBGb3Igbm9uLW5hdGl2ZSBvYmplY3RzLApAQCAtMzk5LDE5ICs0MDgsMjQgQEAgc3RydWN0IEpT
T2JqZWN0IDoganM6OmdjOjpDZWxsIHsKICAgICB1aW50MzIgICAgICBvYmpTaGFwZTsgICAgICAg
ICAgICAgICAgICAgLyogY29weSBvZiBsYXN0UHJvcC0+c2hhcGUsIG9yIG92ZXJyaWRlIGlmIGRp
ZmZlcmVudCAqLwogCiAgICAgLyogSWYgcHJvdG90eXBlLCBsYXppbHkgZmlsbGVkIGFycmF5IG9m
IGVtcHR5IHNoYXBlcyBmb3IgZWFjaCBvYmplY3Qgc2l6ZS4gKi8KICAgICBqczo6RW1wdHlTaGFw
ZSAqKmVtcHR5U2hhcGVzOwogCiAgICAgSlNPYmplY3QgICAgKnByb3RvOyAgICAgICAgICAgICAg
ICAgICAgIC8qIG9iamVjdCdzIHByb3RvdHlwZSAqLwogICAgIEpTT2JqZWN0ICAgICpwYXJlbnQ7
ICAgICAgICAgICAgICAgICAgICAvKiBvYmplY3QncyBwYXJlbnQgKi8KICAgICB2b2lkICAgICAg
ICAqcHJpdmF0ZURhdGE7ICAgICAgICAgICAgICAgLyogcHJpdmF0ZSBkYXRhICovCi0gICAganN1
d29yZCAgICAgY2FwYWNpdHk7ICAgICAgICAgICAgICAgICAgIC8qIGNhcGFjaXR5IG9mIHNsb3Rz
ICovCisgICAganN1d29yZCAgICAgY2FwYWNpdHk7ICAgICAgICAgICAgICAgICAgIC8qIHRvdGFs
IG51bWJlciBvZiBhdmFpbGFibGUgc2xvdHMgKi8KKworICBwcml2YXRlOgogICAgIGpzOjpWYWx1
ZSAgICpzbG90czsgICAgICAgICAgICAgICAgICAgICAvKiBkeW5hbWljYWxseSBhbGxvY2F0ZWQg
c2xvdHMsCi0gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9y
IHBvaW50ZXIgdG8gZml4ZWRTbG90cygpICovCisgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgIG9yIHBvaW50ZXIgdG8gZml4ZWRTbG90cygpIGZvcgorICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBkZW5zZSBhcnJheXMuICov
CisKKyAgcHVibGljOgogCiAgICAgLyoKICAgICAgKiBSZXR1cm4gYW4gaW1tdXRhYmxlLCBzaGFy
ZWFibGUsIGVtcHR5IHNoYXBlIHdpdGggdGhlIHNhbWUgY2xhc3AgYXMgdGhpcwogICAgICAqIGFu
ZCB0aGUgc2FtZSBzbG90U3BhbiBhcyB0aGlzIGhhZCB3aGVuIGVtcHR5LgogICAgICAqCiAgICAg
ICogSWYgfHRoaXN8IGlzIHRoZSBzY29wZSBvZiBhbiBvYmplY3QgfHByb3RvfCwgdGhlIHJlc3Vs
dGluZyBzY29wZSBjYW4gYmUKICAgICAgKiB1c2VkIGFzIHRoZSBzY29wZSBvZiBhIG5ldyBvYmpl
Y3Qgd2hvc2UgcHJvdG90eXBlIGlzIHxwcm90b3wuCiAgICAgICovCkBAIC00MjgsMTYgKzQ0Miwx
NyBAQCBzdHJ1Y3QgSlNPYmplY3QgOiBqczo6Z2M6OkNlbGwgewogICAgICAgICByZXR1cm4gYyA9
PSBjbGFzcDsKICAgICB9CiAKICAgICBjb25zdCBqczo6T2JqZWN0T3BzICpnZXRPcHMoKSBjb25z
dCB7CiAgICAgICAgIHJldHVybiAmZ2V0Q2xhc3MoKS0+b3BzOwogICAgIH0KIAogICAgIGlubGlu
ZSB2b2lkIHRyYWNlKEpTVHJhY2VyICp0cmMpOworICAgIHZvaWQgbWFya1Nsb3RzKEpTVHJhY2Vy
ICp0cmMpOwogCiAgICAgdWludDMyIHNoYXBlKCkgY29uc3QgewogICAgICAgICBKU19BU1NFUlQo
b2JqU2hhcGUgIT0gSlNPYmplY3RNYXA6OklOVkFMSURfU0hBUEUpOwogICAgICAgICByZXR1cm4g
b2JqU2hhcGU7CiAgICAgfQogCiAgICAgYm9vbCBpc0RlbGVnYXRlKCkgY29uc3QgICAgIHsgcmV0
dXJuICEhKGZsYWdzICYgREVMRUdBVEUpOyB9CiAgICAgdm9pZCBzZXREZWxlZ2F0ZSgpICAgICAg
ICAgIHsgZmxhZ3MgfD0gREVMRUdBVEU7IH0KQEAgLTYwOCwzOSArNjIzLDcwIEBAIHN0cnVjdCBK
U09iamVjdCA6IGpzOjpnYzo6Q2VsbCB7CiAgICAgaW5saW5lIHVpbnQzMiBwcm9wZXJ0eUNvdW50
KCkgY29uc3Q7CiAKICAgICBpbmxpbmUgYm9vbCBoYXNQcm9wZXJ0eVRhYmxlKCkgY29uc3Q7CiAK
ICAgICAvKiBnYzo6RmluYWxpemVLaW5kICovIHVuc2lnbmVkIGZpbmFsaXplS2luZCgpIGNvbnN0
OwogCiAgICAgdWludDMyIG51bVNsb3RzKCkgY29uc3QgeyByZXR1cm4gY2FwYWNpdHk7IH0KIAot
ICAgIHNpemVfdCBzbG90c0FuZFN0cnVjdFNpemUodWludDMyIG5zbG90cykgY29uc3Q7Ci0gICAg
c2l6ZV90IHNsb3RzQW5kU3RydWN0U2l6ZSgpIGNvbnN0IHsgcmV0dXJuIHNsb3RzQW5kU3RydWN0
U2l6ZShudW1TbG90cygpKTsgfQorICAgIGlubGluZSBzaXplX3Qgc3RydWN0U2l6ZSgpIGNvbnN0
OworICAgIGlubGluZSBzaXplX3Qgc2xvdHNBbmRTdHJ1Y3RTaXplKCkgY29uc3Q7CiAKKyAgICAv
KiBTbG90IGFjY2Vzc29ycyBmb3IgSklUcy4gKi8KKworICAgIHN0YXRpYyBpbmxpbmUgc2l6ZV90
IGdldEZpeGVkU2xvdE9mZnNldChzaXplX3Qgc2xvdCk7CisgICAgc3RhdGljIGlubGluZSBzaXpl
X3Qgb2Zmc2V0T2ZDYXBhY2l0eSgpIHsgcmV0dXJuIG9mZnNldG9mKEpTT2JqZWN0LCBjYXBhY2l0
eSk7IH0KKyAgICBzdGF0aWMgaW5saW5lIHNpemVfdCBvZmZzZXRPZlNsb3RzKCkgeyByZXR1cm4g
b2Zmc2V0b2YoSlNPYmplY3QsIHNsb3RzKTsgfQorCisgICAgLyoKKyAgICAgKiBHZXQgYSByYXcg
cG9pbnRlciB0byB0aGUgb2JqZWN0J3Mgc2xvdHMsIG9yIGEgc2xvdCBvZiB0aGUgb2JqZWN0IGdp
dmVuCisgICAgICogYSBwcmV2aW91cyB2YWx1ZSBmb3IgaXRzIHNpbmNlLXJlYWxsb2NhdGVkIGR5
bmFtaWMgc2xvdHMuCisgICAgICovCisgICAgaW5saW5lIGpzOjpWYWx1ZSAqZ2V0UmF3U2xvdHMo
KTsKKyAgICBpbmxpbmUganM6OlZhbHVlICpnZXRSYXdTbG90KHNpemVfdCBzbG90LCBqczo6VmFs
dWUgKnNsb3RzKTsKKworICAgIC8qIFdoZXRoZXIgYSBzbG90IGlzIGF0IGEgZml4ZWQgb2Zmc2V0
IGZyb20gdGhpcyBvYmplY3QuICovCisgICAgaW5saW5lIGJvb2wgaXNGaXhlZFNsb3Qoc2l6ZV90
IHNsb3QpOworCisgICAgLyogSW5kZXggaW50byB0aGUgZHluYW1pYyBzbG90cyBhcnJheSB0byB1
c2UgZm9yIGEgZHluYW1pYyBzbG90LiAqLworICAgIGlubGluZSBzaXplX3QgZHluYW1pY1Nsb3RJ
bmRleChzaXplX3Qgc2xvdCk7CisKKyAgcHJpdmF0ZToKICAgICBpbmxpbmUganM6OlZhbHVlKiBm
aXhlZFNsb3RzKCkgY29uc3Q7CiAgICAgaW5saW5lIHNpemVfdCBudW1GaXhlZFNsb3RzKCkgY29u
c3Q7Ci0KLSAgICBzdGF0aWMgaW5saW5lIHNpemVfdCBnZXRGaXhlZFNsb3RPZmZzZXQoc2l6ZV90
IHNsb3QpOworICAgIGlubGluZSBib29sIGhhc1Nsb3RzQXJyYXkoKSBjb25zdDsKIAogICBwdWJs
aWM6CiAgICAgLyogTWluaW11bSBzaXplIGZvciBkeW5hbWljYWxseSBhbGxvY2F0ZWQgc2xvdHMu
ICovCiAgICAgc3RhdGljIGNvbnN0IHVpbnQzMiBTTE9UX0NBUEFDSVRZX01JTiA9IDg7CiAKICAg
ICBib29sIGFsbG9jU2xvdHMoSlNDb250ZXh0ICpjeCwgc2l6ZV90IG5zbG90cyk7CiAgICAgYm9v
bCBncm93U2xvdHMoSlNDb250ZXh0ICpjeCwgc2l6ZV90IG5zbG90cyk7CiAgICAgdm9pZCBzaHJp
bmtTbG90cyhKU0NvbnRleHQgKmN4LCBzaXplX3QgbnNsb3RzKTsKIAogICAgIGJvb2wgZW5zdXJl
U2xvdHMoSlNDb250ZXh0ICpjeCwgc2l6ZV90IG5zbG90cykgewogICAgICAgICBpZiAobnVtU2xv
dHMoKSA8IG5zbG90cykKICAgICAgICAgICAgIHJldHVybiBncm93U2xvdHMoY3gsIG5zbG90cyk7
CiAgICAgICAgIHJldHVybiB0cnVlOwogICAgIH0KIAogICAgIC8qCisgICAgICogRmlsbCBhIHJh
bmdlIG9mIHNsb3RzIHdpdGggaG9sZXMgb3IgdW5kZWZpbmVkLCBkZXBlbmRpbmcgb24gd2hldGhl
ciB0aGlzCisgICAgICogaXMgYSBkZW5zZSBhcnJheS4KKyAgICAgKi8KKyAgICB2b2lkIGNsZWFy
U2xvdFJhbmdlKHNpemVfdCBzdGFydCwgc2l6ZV90IGxlbmd0aCk7CisKKyAgICAvKgorICAgICAq
IENvcHkgYSBmbGF0IGFycmF5IG9mIHNsb3RzIHRvIHRoaXMgb2JqZWN0IGF0IGEgc3RhcnQgc2xv
dC4gQ2FsbGVyIG11c3QKKyAgICAgKiBlbnN1cmUgdGhlcmUgYXJlIGVub3VnaCBzbG90cyBpbiB0
aGlzIG9iamVjdC4KKyAgICAgKi8KKyAgICB2b2lkIGNvcHlTbG90UmFuZ2Uoc2l6ZV90IHN0YXJ0
LCBjb25zdCBqczo6VmFsdWUgKnZlY3Rvciwgc2l6ZV90IGxlbmd0aCk7CisKKyAgICAvKgogICAg
ICAqIEVuc3VyZSB0aGF0IHRoZSBvYmplY3QgaGFzIGF0IGxlYXN0IEpTQ0xBU1NfUkVTRVJWRURf
U0xPVFMoY2xhc3ApICsKICAgICAgKiBucmVzZXJ2ZWQgc2xvdHMuCiAgICAgICoKICAgICAgKiBU
aGlzIG1ldGhvZCBtYXkgYmUgY2FsbGVkIG9ubHkgZm9yIG5hdGl2ZSBvYmplY3RzIGZyZXNobHkg
Y3JlYXRlZCB1c2luZwogICAgICAqIE5ld09iamVjdCBvciBvbmUgb2YgaXRzIHZhcmlhbnQgd2hl
cmUgdGhlIG5ldyBvYmplY3Qgd2lsbCBib3RoIChhKSBuZXZlcgogICAgICAqIGVzY2FwZSB0byBz
Y3JpcHQgYW5kIChiKSBuZXZlciBiZSBleHRlbmRlZCB3aXRoIGFkLWhvYyBwcm9wZXJ0aWVzIHRo
YXQKICAgICAgKiB3b3VsZCB0cnkgdG8gYWxsb2NhdGUgaGlnaGVyIHNsb3RzIHdpdGhvdXQgdGhl
IGZyZXNoIG9iamVjdCBmaXJzdCBoYXZpbmcKICAgICAgKiBpdHMgbWFwIHNldCB0byBhIHNoYXBl
IHBhdGggdGhhdCBtYXBzIHRob3NlIHNsb3RzLgpAQCAtNjQ5LDcwICs2OTUsNDAgQEAgc3RydWN0
IEpTT2JqZWN0IDoganM6OmdjOjpDZWxsIHsKICAgICAgKiBhZGQgYWQtaG9jIHByb3BlcnRpZXMg
dG8gYSBCbG9jayBpbnN0YW5jZS4gQ2FsbCBvYmplY3RzIHNhdGlzZnkgKGEpIGFuZAogICAgICAq
IChiKSBhcyB3ZWxsLCBiZWNhdXNlIHRoZSBjb21waWxlci1jcmVhdGVkIFNoYXBlIHBhdGggdGhh
dCBjb3ZlcnMgYXJncywKICAgICAgKiB2YXJzLCBhbmQgdXB2YXJzLCBzdG9yZWQgaW4gdGhlaXIg
Y2FsbGVlIGZ1bmN0aW9uIGluIHUuaS5uYW1lcywgYmVjb21lcwogICAgICAqIHRoZWlyIGluaXRp
YWwgbWFwLgogICAgICAqLwogICAgIGJvb2wgZW5zdXJlSW5zdGFuY2VSZXNlcnZlZFNsb3RzKEpT
Q29udGV4dCAqY3gsIHNpemVfdCBucmVzZXJ2ZWQpOwogCiAgICAgLyoKLSAgICAgKiBHZXQgYSBk
aXJlY3QgcG9pbnRlciB0byB0aGUgb2JqZWN0J3Mgc2xvdHMuCi0gICAgICogVGhpcyBjYW4gYmUg
cmVhbGxvY2F0ZWQgaWYgdGhlIG9iamVjdCBpcyBtb2RpZmllZCwgd2F0Y2ggb3V0IQotICAgICAq
LwotICAgIGpzOjpWYWx1ZSAqZ2V0U2xvdHMoKSBjb25zdCB7Ci0gICAgICAgIHJldHVybiBzbG90
czsKLSAgICB9Ci0KLSAgICAvKgogICAgICAqIE5COiBlbnN1cmVDbGFzc1Jlc2VydmVkU2xvdHNG
b3JFbXB0eU9iamVjdCBhc3NlcnRzIHRoYXQgbmF0aXZlRW1wdHkoKQogICAgICAqIFVzZSBlbnN1
cmVDbGFzc1Jlc2VydmVkU2xvdHMgZm9yIGFueSBvYmplY3QsIGVpdGhlciBlbXB0eSBvciBhbHJl
YWR5CiAgICAgICogZXh0ZW5kZWQgd2l0aCBwcm9wZXJ0aWVzLgogICAgICAqLwogICAgIGJvb2wg
ZW5zdXJlQ2xhc3NSZXNlcnZlZFNsb3RzRm9yRW1wdHlPYmplY3QoSlNDb250ZXh0ICpjeCk7CiAK
ICAgICBpbmxpbmUgYm9vbCBlbnN1cmVDbGFzc1Jlc2VydmVkU2xvdHMoSlNDb250ZXh0ICpjeCk7
CiAKICAgICB1aW50MzIgc2xvdFNwYW4oKSBjb25zdCB7IHJldHVybiBtYXAtPnNsb3RTcGFuOyB9
CiAKICAgICBib29sIGNvbnRhaW5zU2xvdCh1aW50MzIgc2xvdCkgY29uc3QgeyByZXR1cm4gc2xv
dCA8IHNsb3RTcGFuKCk7IH0KIAotICAgIGpzOjpWYWx1ZSYgZ2V0U2xvdFJlZih1aW50TiBzbG90
KSB7Ci0gICAgICAgIEpTX0FTU0VSVChzbG90IDwgY2FwYWNpdHkpOwotICAgICAgICByZXR1cm4g
c2xvdHNbc2xvdF07Ci0gICAgfQorICAgIGlubGluZSBqczo6VmFsdWUgJmdldFNsb3RSZWYodWlu
dE4gc2xvdCk7CisgICAgaW5saW5lIGpzOjpWYWx1ZSAmbmF0aXZlR2V0U2xvdFJlZih1aW50TiBz
bG90KTsKKyAgICBpbmxpbmUgY29uc3QganM6OlZhbHVlICZnZXRTbG90KHVpbnROIHNsb3QpIGNv
bnN0OworICAgIGlubGluZSBjb25zdCBqczo6VmFsdWUgJm5hdGl2ZUdldFNsb3QodWludE4gc2xv
dCkgY29uc3Q7CisgICAgaW5saW5lIHZvaWQgc2V0U2xvdCh1aW50TiBzbG90LCBjb25zdCBqczo6
VmFsdWUgJnZhbHVlKTsKKyAgICBpbmxpbmUgdm9pZCBuYXRpdmVTZXRTbG90KHVpbnROIHNsb3Qs
IGNvbnN0IGpzOjpWYWx1ZSAmdmFsdWUpOworICAgIGlubGluZSBqczo6VmFsdWUgZ2V0UmVzZXJ2
ZWRTbG90KHVpbnROIGluZGV4KSBjb25zdDsKIAotICAgIGpzOjpWYWx1ZSAmbmF0aXZlR2V0U2xv
dFJlZih1aW50TiBzbG90KSB7Ci0gICAgICAgIEpTX0FTU0VSVChpc05hdGl2ZSgpKTsKLSAgICAg
ICAgSlNfQVNTRVJUKGNvbnRhaW5zU2xvdChzbG90KSk7Ci0gICAgICAgIHJldHVybiBnZXRTbG90
UmVmKHNsb3QpOwotICAgIH0KLQotICAgIGNvbnN0IGpzOjpWYWx1ZSAmZ2V0U2xvdCh1aW50TiBz
bG90KSBjb25zdCB7Ci0gICAgICAgIEpTX0FTU0VSVChzbG90IDwgY2FwYWNpdHkpOwotICAgICAg
ICByZXR1cm4gc2xvdHNbc2xvdF07Ci0gICAgfQotCi0gICAgY29uc3QganM6OlZhbHVlICZuYXRp
dmVHZXRTbG90KHVpbnROIHNsb3QpIGNvbnN0IHsKLSAgICAgICAgSlNfQVNTRVJUKGlzTmF0aXZl
KCkpOwotICAgICAgICBKU19BU1NFUlQoY29udGFpbnNTbG90KHNsb3QpKTsKLSAgICAgICAgcmV0
dXJuIGdldFNsb3Qoc2xvdCk7Ci0gICAgfQotCi0gICAgdm9pZCBzZXRTbG90KHVpbnROIHNsb3Qs
IGNvbnN0IGpzOjpWYWx1ZSAmdmFsdWUpIHsKLSAgICAgICAgSlNfQVNTRVJUKHNsb3QgPCBjYXBh
Y2l0eSk7Ci0gICAgICAgIHNsb3RzW3Nsb3RdID0gdmFsdWU7Ci0gICAgfQotCi0gICAgdm9pZCBu
YXRpdmVTZXRTbG90KHVpbnROIHNsb3QsIGNvbnN0IGpzOjpWYWx1ZSAmdmFsdWUpIHsKLSAgICAg
ICAgSlNfQVNTRVJUKGlzTmF0aXZlKCkpOwotICAgICAgICBKU19BU1NFUlQoY29udGFpbnNTbG90
KHNsb3QpKTsKLSAgICAgICAgcmV0dXJuIHNldFNsb3Qoc2xvdCwgdmFsdWUpOwotICAgIH0KLQot
ICAgIGlubGluZSBqczo6VmFsdWUgZ2V0UmVzZXJ2ZWRTbG90KHVpbnROIGluZGV4KSBjb25zdDsK
KyAgICAvKiBGb3Igc2xvdHMgd2hpY2ggYXJlIGtub3duIHRvIGFsd2F5cyBiZSBmaXhlZCwgZHVl
IHRvIHRoZSB3YXkgdGhleSBhcmUgYWxsb2NhdGVkLiAqLworICAgIGlubGluZSBqczo6VmFsdWUg
JmdldEZpeGVkU2xvdFJlZih1aW50TiBzbG90KTsKKyAgICBpbmxpbmUgY29uc3QganM6OlZhbHVl
ICZnZXRGaXhlZFNsb3QodWludE4gc2xvdCkgY29uc3Q7CisgICAgaW5saW5lIHZvaWQgc2V0Rml4
ZWRTbG90KHVpbnROIHNsb3QsIGNvbnN0IGpzOjpWYWx1ZSAmdmFsdWUpOwogCiAgICAgLyogRGVm
aW5lZCBpbiBqc3Njb3BlaW5saW5lcy5oIHRvIGF2b2lkIGluY2x1ZGluZyBpbXBsZW1lbnRhdGlv
biBkZXBlbmRlbmNpZXMgaGVyZS4gKi8KICAgICBpbmxpbmUgdm9pZCB1cGRhdGVTaGFwZShKU0Nv
bnRleHQgKmN4KTsKICAgICBpbmxpbmUgdm9pZCB1cGRhdGVGbGFncyhjb25zdCBqczo6U2hhcGUg
KnNoYXBlLCBib29sIGlzRGVmaW5pdGVseUF0b20gPSBmYWxzZSk7CiAKICAgICAvKiBFeHRlbmQg
dGhpcyBvYmplY3QgdG8gaGF2ZSBzaGFwZSBhcyBpdHMgbGFzdC1hZGRlZCBwcm9wZXJ0eS4gKi8K
ICAgICBpbmxpbmUgdm9pZCBleHRlbmQoSlNDb250ZXh0ICpjeCwgY29uc3QganM6OlNoYXBlICpz
aGFwZSwgYm9vbCBpc0RlZmluaXRlbHlBdG9tID0gZmFsc2UpOwogCkBAIC03OTIsMjkgKzgwOCwz
NSBAQCBzdHJ1Y3QgSlNPYmplY3QgOiBqczo6Z2M6OkNlbGwgewogCiAgIHByaXZhdGU6CiAgICAg
c3RhdGljIGNvbnN0IHVpbnQzMiBKU1NMT1RfUFJJTUlUSVZFX1RISVMgPSAwOwogCiAgIHB1Ymxp
YzoKICAgICBpbmxpbmUgY29uc3QganM6OlZhbHVlICZnZXRQcmltaXRpdmVUaGlzKCkgY29uc3Q7
CiAgICAgaW5saW5lIHZvaWQgc2V0UHJpbWl0aXZlVGhpcyhjb25zdCBqczo6VmFsdWUgJnB0aGlz
KTsKIAorICAgIHN0YXRpYyBzaXplX3QgZ2V0UHJpbWl0aXZlVGhpc09mZnNldCgpIHsKKyAgICAg
ICAgLyogQWxsIHByaW1pdGl2ZSBvYmplY3RzIGhhdmUgdGhlaXIgdmFsdWUgaW4gYSBmaXhlZCBz
bG90LiAqLworICAgICAgICByZXR1cm4gZ2V0Rml4ZWRTbG90T2Zmc2V0KEpTU0xPVF9QUklNSVRJ
VkVfVEhJUyk7CisgICAgfQorCiAgICAgLyoKICAgICAgKiBBcnJheS1zcGVjaWZpYyBnZXR0ZXJz
IGFuZCBzZXR0ZXJzIChmb3IgYm90aCBkZW5zZSBhbmQgc2xvdyBhcnJheXMpLgogICAgICAqLwog
CiAgICAgaW5saW5lIHVpbnQzMiBnZXRBcnJheUxlbmd0aCgpIGNvbnN0OwogICAgIGlubGluZSB2
b2lkIHNldEFycmF5TGVuZ3RoKHVpbnQzMiBsZW5ndGgpOwogCiAgICAgaW5saW5lIHVpbnQzMiBn
ZXREZW5zZUFycmF5Q2FwYWNpdHkoKTsKICAgICBpbmxpbmUganM6OlZhbHVlKiBnZXREZW5zZUFy
cmF5RWxlbWVudHMoKTsKICAgICBpbmxpbmUgY29uc3QganM6OlZhbHVlICZnZXREZW5zZUFycmF5
RWxlbWVudCh1aW50TiBpZHgpOwogICAgIGlubGluZSBqczo6VmFsdWUqIGFkZHJlc3NPZkRlbnNl
QXJyYXlFbGVtZW50KHVpbnROIGlkeCk7CiAgICAgaW5saW5lIHZvaWQgc2V0RGVuc2VBcnJheUVs
ZW1lbnQodWludE4gaWR4LCBjb25zdCBqczo6VmFsdWUgJnZhbCk7CiAgICAgaW5saW5lIHZvaWQg
c2hyaW5rRGVuc2VBcnJheUVsZW1lbnRzKEpTQ29udGV4dCAqY3gsIHVpbnROIGNhcCk7CisgICAg
aW5saW5lIGJvb2wgZGVuc2VBcnJheUhhc0lubGluZVNsb3RzKCkgY29uc3Q7CiAKICAgICAvKgog
ICAgICAqIGVuc3VyZURlbnNlQXJyYXlFbGVtZW50cyBlbnN1cmVzIHRoYXQgdGhlIGRlbnNlIGFy
cmF5IGNhbiBob2xkIGF0IGxlYXN0CiAgICAgICogaW5kZXggKyBleHRyYSBlbGVtZW50cy4gSXQg
cmV0dXJucyBFRF9PSyBvbiBzdWNjZXNzLCBFRF9GQUlMRUQgb24KICAgICAgKiBmYWlsdXJlIHRv
IGdyb3cgdGhlIGFycmF5LCBFRF9TUEFSU0Ugd2hlbiB0aGUgYXJyYXkgaXMgdG9vIHNwYXJzZSB0
bwogICAgICAqIGdyb3cgKHRoaXMgaW5jbHVkZXMgdGhlIGNhc2Ugb2YgaW5kZXggKyBleHRyYSBv
dmVyZmxvdykuIEluIHRoZSBsYXN0CiAgICAgICogdHdvIGNhc2VzIHRoZSBhcnJheSBpcyBrZXB0
IGludGFjdC4KICAgICAgKi8KQEAgLTg4NywxNiArOTA5LDIxIEBAIHN0cnVjdCBKU09iamVjdCA6
IGpzOjpnYzo6Q2VsbCB7CiAgICAgc3RhdGljIGNvbnN0IHVpbnQzMiBKU1NMT1RfQVJHU19MRU5H
VEggPSAwOwogICAgIHN0YXRpYyBjb25zdCB1aW50MzIgQVJHU19DTEFTU19SRVNFUlZFRF9TTE9U
UyA9IDI7CiAgICAgc3RhdGljIGNvbnN0IHVpbnQzMiBBUkdTX0ZJUlNUX0ZSRUVfU0xPVCA9IEFS
R1NfQ0xBU1NfUkVTRVJWRURfU0xPVFMgKyAxOwogCiAgICAgLyogTG93ZXItb3JkZXIgYml0IHN0
b2xlbiBmcm9tIHRoZSBsZW5ndGggc2xvdC4gKi8KICAgICBzdGF0aWMgY29uc3QgdWludDMyIEFS
R1NfTEVOR1RIX09WRVJSSURERU5fQklUID0gMHgxOwogICAgIHN0YXRpYyBjb25zdCB1aW50MzIg
QVJHU19QQUNLRURfQklUU19DT1VOVCA9IDE7CiAKKyAgICBzdGF0aWMgc2l6ZV90IGdldEFyZ3Vt
ZW50c0xlbmd0aE9mZnNldCgpIHsKKyAgICAgICAgLyogQWxsIGFyZ3VtZW50cyBvYmplY3RzIGhh
dmUgdGhlaXIgbGVuZ3RoIGluIGEgZml4ZWQgc2xvdC4gKi8KKyAgICAgICAgcmV0dXJuIGdldEZp
eGVkU2xvdE9mZnNldChKU1NMT1RfQVJHU19MRU5HVEgpOworICAgIH0KKwogICAgIC8qCiAgICAg
ICogU2V0IHRoZSBpbml0aWFsIGxlbmd0aCBvZiB0aGUgYXJndW1lbnRzLCBhbmQgbWFyayBpdCBh
cyBub3Qgb3ZlcnJpZGRlbi4KICAgICAgKi8KICAgICBpbmxpbmUgdm9pZCBzZXRBcmdzTGVuZ3Ro
KHVpbnQzMiBhcmdjKTsKIAogICAgIC8qCiAgICAgICogUmV0dXJuIHRoZSBpbml0aWFsIGxlbmd0
aCBvZiB0aGUgYXJndW1lbnRzLiAgVGhpcyBtYXkgZGlmZmVyIGZyb20gdGhlCiAgICAgICogY3Vy
cmVudCB2YWx1ZSBvZiBhcmd1bWVudHMubGVuZ3RoIQpAQCAtMTAxMSwzMiArMTAzOCwzNyBAQCBz
dHJ1Y3QgSlNPYmplY3QgOiBqczo6Z2M6OkNlbGwgewogICAgIHN0YXRpYyBjb25zdCB1aW50MzIg
SlNTTE9UX0ZVTl9NRVRIT0RfT0JKICA9IDE7CiAKICAgICBzdGF0aWMgY29uc3QgdWludDMyIEpT
U0xPVF9CT1VORF9GVU5DVElPTl9USElTICAgICAgID0gMDsKICAgICBzdGF0aWMgY29uc3QgdWlu
dDMyIEpTU0xPVF9CT1VORF9GVU5DVElPTl9BUkdTX0NPVU5UID0gMTsKIAogICBwdWJsaWM6CiAg
ICAgc3RhdGljIGNvbnN0IHVpbnQzMiBGVU5fQ0xBU1NfUkVTRVJWRURfU0xPVFMgPSAyOwogCisg
ICAgc3RhdGljIHNpemVfdCBnZXRGbGF0Q2xvc3VyZVVwdmFyc09mZnNldCgpIHsKKyAgICAgICAg
cmV0dXJuIGdldEZpeGVkU2xvdE9mZnNldChKU1NMT1RfRkxBVF9DTE9TVVJFX1VQVkFSUyk7Cisg
ICAgfQorCiAgICAgaW5saW5lIEpTRnVuY3Rpb24gKmdldEZ1bmN0aW9uUHJpdmF0ZSgpIGNvbnN0
OwogCiAgICAgaW5saW5lIGpzOjpWYWx1ZSAqZ2V0RmxhdENsb3N1cmVVcHZhcnMoKSBjb25zdDsK
ICAgICBpbmxpbmUganM6OlZhbHVlIGdldEZsYXRDbG9zdXJlVXB2YXIodWludDMyIGkpIGNvbnN0
OwogICAgIGlubGluZSBqczo6VmFsdWUgJmdldEZsYXRDbG9zdXJlVXB2YXIodWludDMyIGkpOwog
ICAgIGlubGluZSB2b2lkIHNldEZsYXRDbG9zdXJlVXB2YXJzKGpzOjpWYWx1ZSAqdXB2YXJzKTsK
IAogICAgIGlubGluZSBib29sIGhhc01ldGhvZE9iaihjb25zdCBKU09iamVjdCYgb2JqKSBjb25z
dDsKICAgICBpbmxpbmUgdm9pZCBzZXRNZXRob2RPYmooSlNPYmplY3QmIG9iaik7CiAKICAgICBp
bmxpbmUgYm9vbCBpbml0Qm91bmRGdW5jdGlvbihKU0NvbnRleHQgKmN4LCBjb25zdCBqczo6VmFs
dWUgJnRoaXNBcmcsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QganM6
OlZhbHVlICphcmdzLCB1aW50TiBhcmdzbGVuKTsKIAogICAgIGlubGluZSBKU09iamVjdCAqZ2V0
Qm91bmRGdW5jdGlvblRhcmdldCgpIGNvbnN0OwogICAgIGlubGluZSBjb25zdCBqczo6VmFsdWUg
JmdldEJvdW5kRnVuY3Rpb25UaGlzKCkgY29uc3Q7Ci0gICAgaW5saW5lIGNvbnN0IGpzOjpWYWx1
ZSAqZ2V0Qm91bmRGdW5jdGlvbkFyZ3VtZW50cyh1aW50TiAmYXJnc2xlbikgY29uc3Q7CisgICAg
aW5saW5lIGNvbnN0IGpzOjpWYWx1ZSAmZ2V0Qm91bmRGdW5jdGlvbkFyZ3VtZW50KHVpbnROIHdo
aWNoKSBjb25zdDsKKyAgICBpbmxpbmUgc2l6ZV90IGdldEJvdW5kRnVuY3Rpb25Bcmd1bWVudENv
dW50KCkgY29uc3Q7CiAKICAgICAvKgogICAgICAqIFJlZ0V4cC1zcGVjaWZpYyBnZXR0ZXJzIGFu
ZCBzZXR0ZXJzLgogICAgICAqLwogCiAgIHByaXZhdGU6CiAgICAgc3RhdGljIGNvbnN0IHVpbnQz
MiBKU1NMT1RfUkVHRVhQX0xBU1RfSU5ERVggPSAwOwogICAgIHN0YXRpYyBjb25zdCB1aW50MzIg
SlNTTE9UX1JFR0VYUF9TT1VSQ0UgPSAxOwpAQCAtMTE1NCwyNCArMTE4NiwxNiBAQCBzdHJ1Y3Qg
SlNPYmplY3QgOiBqczo6Z2M6OkNlbGwgewogICAgICAqLwogICAgIGlubGluZSBib29sIGluaXRT
aGFyaW5nRW1wdHlTaGFwZShKU0NvbnRleHQgKmN4LAogICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICBqczo6Q2xhc3MgKmNsYXNwLAogICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICBKU09iamVjdCAqcHJvdG8sCiAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgIEpTT2JqZWN0ICpwYXJlbnQsCiAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgIHZvaWQgKnByaXYsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgIC8qIGdjOjpGaW5hbGl6ZUtpbmQgKi8gdW5zaWduZWQga2luZCk7CiAKLSAgICBpbmxp
bmUgYm9vbCBoYXNTbG90c0FycmF5KCkgY29uc3Q7Ci0KLSAgICAvKiBUaGlzIG1ldGhvZCBjYW4g
b25seSBiZSBjYWxsZWQgd2hlbiBoYXNTbG90c0FycmF5KCkgcmV0dXJucyB0cnVlLiAqLwotICAg
IGlubGluZSB2b2lkIGZyZWVTbG90c0FycmF5KEpTQ29udGV4dCAqY3gpOwotCi0gICAgLyogRnJl
ZSB0aGUgc2xvdHMgYXJyYXkgYW5kIGNvcHkgc2xvdHMgdGhhdCBmaXQgaW50byB0aGUgZml4ZWQg
YXJyYXkuICovCi0gICAgaW5saW5lIHZvaWQgcmV2ZXJ0VG9GaXhlZFNsb3RzKEpTQ29udGV4dCAq
Y3gpOwotCiAgICAgaW5saW5lIGJvb2wgaGFzUHJvcGVydHkoSlNDb250ZXh0ICpjeCwganNpZCBp
ZCwgYm9vbCAqZm91bmRwLCB1aW50TiBmbGFncyA9IDApOwogCiAgICAgLyoKICAgICAgKiBBbGxv
Y2F0ZSBhbmQgZnJlZSBhbiBvYmplY3Qgc2xvdC4gTm90ZSB0aGF0IGZyZWVTbG90IGlzIGluZmFs
bGlibGU6IGl0CiAgICAgICogcmV0dXJucyB0cnVlIGlmZiB0aGlzIGlzIGEgZGljdGlvbmFyeS1t
b2RlIG9iamVjdCBhbmQgdGhlIGZyZWVkIHNsb3Qgd2FzCiAgICAgICogYWRkZWQgdG8gdGhlIGZy
ZWVsaXN0LgogICAgICAqCiAgICAgICogRklYTUU6IGJ1ZyA1OTMxMjkgLS0gc2xvdCBhbGxvY2F0
aW9uIHNob3VsZCBiZSBkb25lIGJ5IG9iamVjdCBtZXRob2RzCkBAIC0xMjA3LDE2ICsxMjMxLDE4
IEBAIHN0cnVjdCBKU09iamVjdCA6IGpzOjpnYzo6Q2VsbCB7CiAgICAgY29uc3QganM6OlNoYXBl
ICphZGRQcm9wZXJ0eUludGVybmFsKEpTQ29udGV4dCAqY3gsIGpzaWQgaWQsCiAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGpzOjpQcm9wZXJ0eU9wIGdldHRlciwganM6
OlN0cmljdFByb3BlcnR5T3Agc2V0dGVyLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICB1aW50MzIgc2xvdCwgdWludE4gYXR0cnMsCiAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgIHVpbnROIGZsYWdzLCBpbnROIHNob3J0aWQsCiAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGpzOjpTaGFwZSAqKnNwcCk7CiAKICAg
ICBib29sIHRvRGljdGlvbmFyeU1vZGUoSlNDb250ZXh0ICpjeCk7CiAKKyAgICBzdGF0aWMgYm9v
bCBUcmFkZUd1dHMoSlNDb250ZXh0ICpjeCwgSlNPYmplY3QgKmEsIEpTT2JqZWN0ICpiKTsKKwog
ICBwdWJsaWM6CiAgICAgLyogQWRkIGEgcHJvcGVydHkgd2hvc2UgaWQgaXMgbm90IHlldCBpbiB0
aGlzIHNjb3BlLiAqLwogICAgIGNvbnN0IGpzOjpTaGFwZSAqYWRkUHJvcGVydHkoSlNDb250ZXh0
ICpjeCwganNpZCBpZCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGpzOjpQcm9w
ZXJ0eU9wIGdldHRlciwganM6OlN0cmljdFByb3BlcnR5T3Agc2V0dGVyLAogICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgdWludDMyIHNsb3QsIHVpbnROIGF0dHJzLAogICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgdWludE4gZmxhZ3MsIGludE4gc2hvcnRpZCk7CiAKICAg
ICAvKiBBZGQgYSBkYXRhIHByb3BlcnR5IHdob3NlIGlkIGlzIG5vdCB5ZXQgaW4gdGhpcyBzY29w
ZS4gKi8KQEAgLTEzNTEsMTkgKzEzNzcsMTYgQEAgc3RydWN0IEpTT2JqZWN0IDoganM6OmdjOjpD
ZWxsIHsKIC8qIENoZWNrIGFsaWdubWVudCBmb3IgYW55IGZpeGVkIHNsb3RzIGFsbG9jYXRlZCBh
ZnRlciB0aGUgb2JqZWN0LiAqLwogSlNfU1RBVElDX0FTU0VSVChzaXplb2YoSlNPYmplY3QpICUg
c2l6ZW9mKGpzOjpWYWx1ZSkgPT0gMCk7CiAKIGlubGluZSBqczo6VmFsdWUqCiBKU09iamVjdDo6
Zml4ZWRTbG90cygpIGNvbnN0IHsKICAgICByZXR1cm4gKGpzOjpWYWx1ZSopIChqc3V3b3JkKHRo
aXMpICsgc2l6ZW9mKEpTT2JqZWN0KSk7CiB9CiAKLWlubGluZSBib29sCi1KU09iamVjdDo6aGFz
U2xvdHNBcnJheSgpIGNvbnN0IHsgcmV0dXJuIHRoaXMtPnNsb3RzICE9IGZpeGVkU2xvdHMoKTsg
fQotCiAvKiBzdGF0aWMgKi8gaW5saW5lIHNpemVfdAogSlNPYmplY3Q6OmdldEZpeGVkU2xvdE9m
ZnNldChzaXplX3Qgc2xvdCkgewogICAgIHJldHVybiBzaXplb2YoSlNPYmplY3QpICsgKHNsb3Qg
KiBzaXplb2YoanM6OlZhbHVlKSk7CiB9CiAKIHN0cnVjdCBKU09iamVjdF9TbG90czIgOiBKU09i
amVjdCB7IGpzOjpWYWx1ZSBmc2xvdHNbMl07IH07CiBzdHJ1Y3QgSlNPYmplY3RfU2xvdHM0IDog
SlNPYmplY3QgeyBqczo6VmFsdWUgZnNsb3RzWzRdOyB9Owogc3RydWN0IEpTT2JqZWN0X1Nsb3Rz
OCA6IEpTT2JqZWN0IHsganM6OlZhbHVlIGZzbG90c1s4XTsgfTsKQEAgLTE0NTUsMTkgKzE0Nzgs
MTkgQEAgSlNPYmplY3Q6OmlzQ2xvbmVkQmxvY2soKSBjb25zdAogICAgIHJldHVybiBpc0Jsb2Nr
KCkgJiYgISFnZXRQcm90bygpOwogfQogCiBzdGF0aWMgY29uc3QgdWludDMyIEpTU0xPVF9XSVRI
X1RISVMgPSAxOwogCiAjZGVmaW5lIE9CSl9CTE9DS19DT1VOVChjeCxvYmopICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBcCiAgICAgKG9iaiktPnByb3BlcnR5
Q291bnQoKQogI2RlZmluZSBPQkpfQkxPQ0tfREVQVEgoY3gsb2JqKSAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgXAotICAgIChvYmopLT5nZXRTbG90KEpTU0xP
VF9CTE9DS19ERVBUSCkudG9JbnQzMigpCisgICAgKG9iaiktPmdldEZpeGVkU2xvdChKU1NMT1Rf
QkxPQ0tfREVQVEgpLnRvSW50MzIoKQogI2RlZmluZSBPQkpfU0VUX0JMT0NLX0RFUFRIKGN4LG9i
aixkZXB0aCkgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgXAotICAgIChvYmop
LT5zZXRTbG90KEpTU0xPVF9CTE9DS19ERVBUSCwgVmFsdWUoSW50MzJWYWx1ZShkZXB0aCkpKQor
ICAgIChvYmopLT5zZXRGaXhlZFNsb3QoSlNTTE9UX0JMT0NLX0RFUFRILCBWYWx1ZShJbnQzMlZh
bHVlKGRlcHRoKSkpCiAKIC8qCiAgKiBUbyBtYWtlIHN1cmUgdGhpcyBzbG90IGlzIHdlbGwtZGVm
aW5lZCwgYWx3YXlzIGNhbGwganNfTmV3V2l0aE9iamVjdCB0bwogICogY3JlYXRlIGEgV2l0aCBv
YmplY3QsIGRvbid0IGNhbGwganNfTmV3T2JqZWN0IGRpcmVjdGx5LiAgV2hlbiBjcmVhdGluZyBh
CiAgKiBXaXRoIG9iamVjdCB0aGF0IGRvZXMgbm90IGNvcnJlc3BvbmQgdG8gYSBzdGFjayBzbG90
LCBwYXNzIC0xIGZvciBkZXB0aC4KICAqCiAgKiBXaGVuIHBvcHBpbmcgdGhlIHN0YWNrIGFjcm9z
cyB0aGlzIG9iamVjdCdzICJ3aXRoIiBzdGF0ZW1lbnQsIGNsaWVudCBjb2RlCiAgKiBtdXN0IGNh
bGwgd2l0aG9iai0+c2V0UHJpdmF0ZShOVUxMKS4KZGlmZiAtLWdpdCBhL2pzL3NyYy9qc29iamlu
bGluZXMuaCBiL2pzL3NyYy9qc29iamlubGluZXMuaAotLS0gYS9qcy9zcmMvanNvYmppbmxpbmVz
LmgKKysrIGIvanMvc3JjL2pzb2JqaW5saW5lcy5oCkBAIC0yNzksMTYgKzI3OSwxMjIgQEAgSlNP
YmplY3Q6Om1ldGhvZFdyaXRlQmFycmllcihKU0NvbnRleHQgKgogICAgICAgICBpZiAoQ2hhbmdl
c01ldGhvZFZhbHVlKHByZXYsIHYpKSB7CiAgICAgICAgICAgICBKU19GVU5DVElPTl9NRVRFUihj
eCwgbXdzbG90YmFycmllcik7CiAgICAgICAgICAgICByZXR1cm4gbWV0aG9kU2hhcGVDaGFuZ2Uo
Y3gsIHNsb3QpOwogICAgICAgICB9CiAgICAgfQogICAgIHJldHVybiB0cnVlOwogfQogCitpbmxp
bmUganM6OlZhbHVlICoKK0pTT2JqZWN0OjpnZXRSYXdTbG90cygpCit7CisgICAgSlNfQVNTRVJU
KGlzR2xvYmFsKCkpOworICAgIHJldHVybiBzbG90czsKK30KKworaW5saW5lIGpzOjpWYWx1ZSAq
CitKU09iamVjdDo6Z2V0UmF3U2xvdChzaXplX3Qgc2xvdCwganM6OlZhbHVlICpzbG90cykKK3sK
KyAgICBKU19BU1NFUlQoaXNHbG9iYWwoKSk7CisgICAgc2l6ZV90IGZpeGVkID0gbnVtRml4ZWRT
bG90cygpOworICAgIGlmIChzbG90IDwgZml4ZWQpCisgICAgICAgIHJldHVybiBmaXhlZFNsb3Rz
KCkgKyBzbG90OworICAgIHJldHVybiBzbG90cyArIHNsb3QgLSBmaXhlZDsKK30KKworaW5saW5l
IGJvb2wKK0pTT2JqZWN0Ojppc0ZpeGVkU2xvdChzaXplX3Qgc2xvdCkKK3sKKyAgICBKU19BU1NF
UlQoIWlzRGVuc2VBcnJheSgpKTsKKyAgICByZXR1cm4gc2xvdCA8IG51bUZpeGVkU2xvdHMoKTsK
K30KKworaW5saW5lIHNpemVfdAorSlNPYmplY3Q6OmR5bmFtaWNTbG90SW5kZXgoc2l6ZV90IHNs
b3QpCit7CisgICAgSlNfQVNTRVJUKCFpc0RlbnNlQXJyYXkoKSAmJiBzbG90ID49IG51bUZpeGVk
U2xvdHMoKSk7CisgICAgcmV0dXJuIHNsb3QgLSBudW1GaXhlZFNsb3RzKCk7Cit9CisKK2lubGlu
ZSBqczo6VmFsdWUgJgorSlNPYmplY3Q6OmdldFNsb3RSZWYodWludE4gc2xvdCkKK3sKKyAgICBK
U19BU1NFUlQoIWlzRGVuc2VBcnJheSgpKTsKKyAgICBKU19BU1NFUlQoc2xvdCA8IGNhcGFjaXR5
KTsKKyAgICBzaXplX3QgZml4ZWQgPSBudW1GaXhlZFNsb3RzKCk7CisgICAgaWYgKHNsb3QgPCBm
aXhlZCkKKyAgICAgICAgcmV0dXJuIGZpeGVkU2xvdHMoKVtzbG90XTsKKyAgICByZXR1cm4gc2xv
dHNbc2xvdCAtIGZpeGVkXTsKK30KKworaW5saW5lIGpzOjpWYWx1ZSAmCitKU09iamVjdDo6bmF0
aXZlR2V0U2xvdFJlZih1aW50TiBzbG90KQoreworICAgIEpTX0FTU0VSVChpc05hdGl2ZSgpKTsK
KyAgICBKU19BU1NFUlQoY29udGFpbnNTbG90KHNsb3QpKTsKKyAgICByZXR1cm4gZ2V0U2xvdFJl
ZihzbG90KTsKK30KKworaW5saW5lIGNvbnN0IGpzOjpWYWx1ZSAmCitKU09iamVjdDo6Z2V0U2xv
dCh1aW50TiBzbG90KSBjb25zdAoreworICAgIEpTX0FTU0VSVCghaXNEZW5zZUFycmF5KCkpOwor
ICAgIEpTX0FTU0VSVChzbG90IDwgY2FwYWNpdHkpOworICAgIHNpemVfdCBmaXhlZCA9IG51bUZp
eGVkU2xvdHMoKTsKKyAgICBpZiAoc2xvdCA8IGZpeGVkKQorICAgICAgICByZXR1cm4gZml4ZWRT
bG90cygpW3Nsb3RdOworICAgIHJldHVybiBzbG90c1tzbG90IC0gZml4ZWRdOworfQorCitpbmxp
bmUgY29uc3QganM6OlZhbHVlICYKK0pTT2JqZWN0OjpuYXRpdmVHZXRTbG90KHVpbnROIHNsb3Qp
IGNvbnN0Cit7CisgICAgSlNfQVNTRVJUKGlzTmF0aXZlKCkpOworICAgIEpTX0FTU0VSVChjb250
YWluc1Nsb3Qoc2xvdCkpOworICAgIHJldHVybiBnZXRTbG90KHNsb3QpOworfQorCitpbmxpbmUg
dm9pZAorSlNPYmplY3Q6OnNldFNsb3QodWludE4gc2xvdCwgY29uc3QganM6OlZhbHVlICZ2YWx1
ZSkKK3sKKyAgICBKU19BU1NFUlQoIWlzRGVuc2VBcnJheSgpKTsKKyAgICBKU19BU1NFUlQoc2xv
dCA8IGNhcGFjaXR5KTsKKyAgICBnZXRTbG90UmVmKHNsb3QpID0gdmFsdWU7Cit9CisKK2lubGlu
ZSB2b2lkCitKU09iamVjdDo6bmF0aXZlU2V0U2xvdCh1aW50TiBzbG90LCBjb25zdCBqczo6VmFs
dWUgJnZhbHVlKQoreworICAgIEpTX0FTU0VSVChpc05hdGl2ZSgpKTsKKyAgICBKU19BU1NFUlQo
Y29udGFpbnNTbG90KHNsb3QpKTsKKyAgICBzZXRTbG90KHNsb3QsIHZhbHVlKTsKK30KKworaW5s
aW5lIGpzOjpWYWx1ZSAmCitKU09iamVjdDo6Z2V0Rml4ZWRTbG90UmVmKHVpbnROIHNsb3QpCit7
CisgICAgSlNfQVNTRVJUKGlzTmF0aXZlKCkgJiYgc2xvdCA8IG51bUZpeGVkU2xvdHMoKSk7Cisg
ICAgcmV0dXJuIGZpeGVkU2xvdHMoKVtzbG90XTsKK30KKworaW5saW5lIGNvbnN0IGpzOjpWYWx1
ZSAmCitKU09iamVjdDo6Z2V0Rml4ZWRTbG90KHVpbnROIHNsb3QpIGNvbnN0Cit7CisgICAgSlNf
QVNTRVJUKGlzTmF0aXZlKCkgJiYgc2xvdCA8IG51bUZpeGVkU2xvdHMoKSk7CisgICAgcmV0dXJu
IGZpeGVkU2xvdHMoKVtzbG90XTsKK30KKworaW5saW5lIHZvaWQKK0pTT2JqZWN0OjpzZXRGaXhl
ZFNsb3QodWludE4gc2xvdCwgY29uc3QganM6OlZhbHVlICZ2YWx1ZSkKK3sKKyAgICBKU19BU1NF
UlQoaXNOYXRpdmUoKSAmJiBzbG90IDwgbnVtRml4ZWRTbG90cygpKTsKKyAgICBmaXhlZFNsb3Rz
KClbc2xvdF0gPSB2YWx1ZTsKK30KKwogaW5saW5lIGJvb2wKIEpTT2JqZWN0OjplbnN1cmVDbGFz
c1Jlc2VydmVkU2xvdHMoSlNDb250ZXh0ICpjeCkKIHsKICAgICByZXR1cm4gIW5hdGl2ZUVtcHR5
KCkgfHwgZW5zdXJlQ2xhc3NSZXNlcnZlZFNsb3RzRm9yRW1wdHlPYmplY3QoY3gpOwogfQogCiBp
bmxpbmUganM6OlZhbHVlCiBKU09iamVjdDo6Z2V0UmVzZXJ2ZWRTbG90KHVpbnROIGluZGV4KSBj
b25zdApAQCAtMzA3LDUyICs0MTMsNzEgQEAgSlNPYmplY3Q6OmlzUHJpbWl0aXZlKCkgY29uc3QK
IHsKICAgICByZXR1cm4gaXNOdW1iZXIoKSB8fCBpc1N0cmluZygpIHx8IGlzQm9vbGVhbigpOwog
fQogCiBpbmxpbmUgY29uc3QganM6OlZhbHVlICYKIEpTT2JqZWN0OjpnZXRQcmltaXRpdmVUaGlz
KCkgY29uc3QKIHsKICAgICBKU19BU1NFUlQoaXNQcmltaXRpdmUoKSk7Ci0gICAgcmV0dXJuIGdl
dFNsb3QoSlNTTE9UX1BSSU1JVElWRV9USElTKTsKKyAgICByZXR1cm4gZ2V0Rml4ZWRTbG90KEpT
U0xPVF9QUklNSVRJVkVfVEhJUyk7CiB9CiAKIGlubGluZSB2b2lkCiBKU09iamVjdDo6c2V0UHJp
bWl0aXZlVGhpcyhjb25zdCBqczo6VmFsdWUgJnB0aGlzKQogewogICAgIEpTX0FTU0VSVChpc1By
aW1pdGl2ZSgpKTsKLSAgICBzZXRTbG90KEpTU0xPVF9QUklNSVRJVkVfVEhJUywgcHRoaXMpOwor
ICAgIHNldEZpeGVkU2xvdChKU1NMT1RfUFJJTUlUSVZFX1RISVMsIHB0aGlzKTsKIH0KIAogaW5s
aW5lIC8qIGdjOjpGaW5hbGl6ZUtpbmQgKi8gdW5zaWduZWQKIEpTT2JqZWN0OjpmaW5hbGl6ZUtp
bmQoKSBjb25zdAogewogICAgIHJldHVybiBqczo6Z2M6OkZpbmFsaXplS2luZChhcmVuYSgpLT5o
ZWFkZXIoKS0+dGhpbmdLaW5kKTsKIH0KIAoraW5saW5lIGJvb2wKK0pTT2JqZWN0OjpoYXNTbG90
c0FycmF5KCkgY29uc3QKK3sKKyAgICBKU19BU1NFUlRfSUYoIXNsb3RzLCAhaXNEZW5zZUFycmF5
KCkpOworICAgIEpTX0FTU0VSVF9JRihzbG90cyA9PSBmaXhlZFNsb3RzKCksIGlzRGVuc2VBcnJh
eSgpKTsKKyAgICByZXR1cm4gc2xvdHMgJiYgc2xvdHMgIT0gZml4ZWRTbG90cygpOworfQorCiBp
bmxpbmUgc2l6ZV90CiBKU09iamVjdDo6bnVtRml4ZWRTbG90cygpIGNvbnN0CiB7CiAgICAgaWYg
KGlzRnVuY3Rpb24oKSkKICAgICAgICAgcmV0dXJuIEpTT2JqZWN0OjpGVU5fQ0xBU1NfUkVTRVJW
RURfU0xPVFM7CiAgICAgaWYgKCFoYXNTbG90c0FycmF5KCkpCiAgICAgICAgIHJldHVybiBjYXBh
Y2l0eTsKICAgICByZXR1cm4ganM6OmdjOjpHZXRHQ0tpbmRTbG90cyhqczo6Z2M6OkZpbmFsaXpl
S2luZChmaW5hbGl6ZUtpbmQoKSkpOwogfQogCiBpbmxpbmUgc2l6ZV90Ci1KU09iamVjdDo6c2xv
dHNBbmRTdHJ1Y3RTaXplKHVpbnQzMiBuc2xvdHMpIGNvbnN0CitKU09iamVjdDo6c3RydWN0U2l6
ZSgpIGNvbnN0CiB7Ci0gICAgYm9vbCBpc0Z1biA9IGlzRnVuY3Rpb24oKSAmJiB0aGlzID09IChK
U09iamVjdCopIGdldFByaXZhdGUoKTsKKyAgICByZXR1cm4gKGlzRnVuY3Rpb24oKSAmJiAhZ2V0
UHJpdmF0ZSgpKQorICAgICAgICAgICA/IHNpemVvZihKU0Z1bmN0aW9uKQorICAgICAgICAgICA6
IHNpemVvZihKU09iamVjdCkgKyBzaXplb2YoanM6OlZhbHVlKSAqIG51bUZpeGVkU2xvdHMoKTsK
K30KIAotICAgIGludCBuZHNsb3RzID0gaGFzU2xvdHNBcnJheSgpID8gbnNsb3RzIDogMDsKLSAg
ICBpbnQgbmZzbG90cyA9IGlzRnVuID8gMCA6IG51bUZpeGVkU2xvdHMoKTsKK2lubGluZSBzaXpl
X3QKK0pTT2JqZWN0OjpzbG90c0FuZFN0cnVjdFNpemUoKSBjb25zdAoreworICAgIGludCBuZHNs
b3RzID0gMDsKKyAgICBpZiAoaXNEZW5zZUFycmF5KCkpIHsKKyAgICAgICAgaWYgKCFkZW5zZUFy
cmF5SGFzSW5saW5lU2xvdHMoKSkKKyAgICAgICAgICAgIG5kc2xvdHMgPSBudW1TbG90cygpOwor
ICAgIH0gZWxzZSB7CisgICAgICAgIGlmIChzbG90cykKKyAgICAgICAgICAgIG5kc2xvdHMgPSBu
dW1TbG90cygpIC0gbnVtRml4ZWRTbG90cygpOworICAgIH0KIAotICAgIHJldHVybiBzaXplb2Yo
anM6OlZhbHVlKSAqIChuZHNsb3RzICsgbmZzbG90cykKLSAgICAgICAgICAgKyBpc0Z1biA/IHNp
emVvZihKU0Z1bmN0aW9uKSA6IHNpemVvZihKU09iamVjdCk7CisgICAgcmV0dXJuIHN0cnVjdFNp
emUoKSArIHNpemVvZihqczo6VmFsdWUpICogbmRzbG90czsKIH0KIAogaW5saW5lIHVpbnQzMgog
SlNPYmplY3Q6OmdldEFycmF5TGVuZ3RoKCkgY29uc3QKIHsKICAgICBKU19BU1NFUlQoaXNBcnJh
eSgpKTsKICAgICByZXR1cm4gKHVpbnQzMikoc2l6ZV90KSBnZXRQcml2YXRlKCk7CiB9CkBAIC0z
NzAsOTMgKzQ5NSwxMDAgQEAgSlNPYmplY3Q6OmdldERlbnNlQXJyYXlDYXBhY2l0eSgpCiAgICAg
SlNfQVNTRVJUKGlzRGVuc2VBcnJheSgpKTsKICAgICByZXR1cm4gbnVtU2xvdHMoKTsKIH0KIAog
aW5saW5lIGpzOjpWYWx1ZSoKIEpTT2JqZWN0OjpnZXREZW5zZUFycmF5RWxlbWVudHMoKQogewog
ICAgIEpTX0FTU0VSVChpc0RlbnNlQXJyYXkoKSk7Ci0gICAgcmV0dXJuIGdldFNsb3RzKCk7Cisg
ICAgcmV0dXJuIHNsb3RzOwogfQogCiBpbmxpbmUgY29uc3QganM6OlZhbHVlICYKIEpTT2JqZWN0
OjpnZXREZW5zZUFycmF5RWxlbWVudCh1aW50TiBpZHgpCiB7Ci0gICAgSlNfQVNTRVJUKGlzRGVu
c2VBcnJheSgpKTsKLSAgICByZXR1cm4gZ2V0U2xvdChpZHgpOworICAgIEpTX0FTU0VSVChpc0Rl
bnNlQXJyYXkoKSAmJiBpZHggPCBjYXBhY2l0eSk7CisgICAgcmV0dXJuIHNsb3RzW2lkeF07CiB9
CiAKIGlubGluZSBqczo6VmFsdWUgKgogSlNPYmplY3Q6OmFkZHJlc3NPZkRlbnNlQXJyYXlFbGVt
ZW50KHVpbnROIGlkeCkKIHsKLSAgICBKU19BU1NFUlQoaXNEZW5zZUFycmF5KCkpOwotICAgIHJl
dHVybiAmZ2V0U2xvdFJlZihpZHgpOworICAgIEpTX0FTU0VSVChpc0RlbnNlQXJyYXkoKSAmJiBp
ZHggPCBjYXBhY2l0eSk7CisgICAgcmV0dXJuICZzbG90c1tpZHhdOwogfQogCiBpbmxpbmUgdm9p
ZAogSlNPYmplY3Q6OnNldERlbnNlQXJyYXlFbGVtZW50KHVpbnROIGlkeCwgY29uc3QganM6OlZh
bHVlICZ2YWwpCiB7Ci0gICAgSlNfQVNTRVJUKGlzRGVuc2VBcnJheSgpKTsKLSAgICBzZXRTbG90
KGlkeCwgdmFsKTsKKyAgICBKU19BU1NFUlQoaXNEZW5zZUFycmF5KCkgJiYgaWR4IDwgY2FwYWNp
dHkpOworICAgIHNsb3RzW2lkeF0gPSB2YWw7CiB9CiAKIGlubGluZSB2b2lkCiBKU09iamVjdDo6
c2hyaW5rRGVuc2VBcnJheUVsZW1lbnRzKEpTQ29udGV4dCAqY3gsIHVpbnROIGNhcCkKIHsKICAg
ICBKU19BU1NFUlQoaXNEZW5zZUFycmF5KCkpOwogICAgIHNocmlua1Nsb3RzKGN4LCBjYXApOwog
fQogCitpbmxpbmUgYm9vbAorSlNPYmplY3Q6OmRlbnNlQXJyYXlIYXNJbmxpbmVTbG90cygpIGNv
bnN0Cit7CisgICAgSlNfQVNTRVJUKGlzRGVuc2VBcnJheSgpICYmIHNsb3RzKTsKKyAgICByZXR1
cm4gc2xvdHMgPT0gZml4ZWRTbG90cygpOworfQorCiBpbmxpbmUgdm9pZAogSlNPYmplY3Q6OnNl
dEFyZ3NMZW5ndGgodWludDMyIGFyZ2MpCiB7CiAgICAgSlNfQVNTRVJUKGlzQXJndW1lbnRzKCkp
OwogICAgIEpTX0FTU0VSVChhcmdjIDw9IEpTX0FSR1NfTEVOR1RIX01BWCk7CiAgICAgSlNfQVNT
RVJUKFVJTlQzMl9NQVggPiAodWludDY0KGFyZ2MpIDw8IEFSR1NfUEFDS0VEX0JJVFNfQ09VTlQp
KTsKLSAgICBnZXRTbG90UmVmKEpTU0xPVF9BUkdTX0xFTkdUSCkuc2V0SW50MzIoYXJnYyA8PCBB
UkdTX1BBQ0tFRF9CSVRTX0NPVU5UKTsKKyAgICBnZXRGaXhlZFNsb3RSZWYoSlNTTE9UX0FSR1Nf
TEVOR1RIKS5zZXRJbnQzMihhcmdjIDw8IEFSR1NfUEFDS0VEX0JJVFNfQ09VTlQpOwogICAgIEpT
X0FTU0VSVCghaXNBcmdzTGVuZ3RoT3ZlcnJpZGRlbigpKTsKIH0KIAogaW5saW5lIHVpbnQzMgog
SlNPYmplY3Q6OmdldEFyZ3NJbml0aWFsTGVuZ3RoKCkgY29uc3QKIHsKICAgICBKU19BU1NFUlQo
aXNBcmd1bWVudHMoKSk7Ci0gICAgdWludDMyIGFyZ2MgPSB1aW50MzIoZ2V0U2xvdChKU1NMT1Rf
QVJHU19MRU5HVEgpLnRvSW50MzIoKSkgPj4gQVJHU19QQUNLRURfQklUU19DT1VOVDsKKyAgICB1
aW50MzIgYXJnYyA9IHVpbnQzMihnZXRGaXhlZFNsb3QoSlNTTE9UX0FSR1NfTEVOR1RIKS50b0lu
dDMyKCkpID4+IEFSR1NfUEFDS0VEX0JJVFNfQ09VTlQ7CiAgICAgSlNfQVNTRVJUKGFyZ2MgPD0g
SlNfQVJHU19MRU5HVEhfTUFYKTsKICAgICByZXR1cm4gYXJnYzsKIH0KIAogaW5saW5lIHZvaWQK
IEpTT2JqZWN0OjpzZXRBcmdzTGVuZ3RoT3ZlcnJpZGRlbigpCiB7CiAgICAgSlNfQVNTRVJUKGlz
QXJndW1lbnRzKCkpOwotICAgIGdldFNsb3RSZWYoSlNTTE9UX0FSR1NfTEVOR1RIKS5nZXRJbnQz
MlJlZigpIHw9IEFSR1NfTEVOR1RIX09WRVJSSURERU5fQklUOworICAgIGdldEZpeGVkU2xvdFJl
ZihKU1NMT1RfQVJHU19MRU5HVEgpLmdldEludDMyUmVmKCkgfD0gQVJHU19MRU5HVEhfT1ZFUlJJ
RERFTl9CSVQ7CiB9CiAKIGlubGluZSBib29sCiBKU09iamVjdDo6aXNBcmdzTGVuZ3RoT3ZlcnJp
ZGRlbigpIGNvbnN0CiB7CiAgICAgSlNfQVNTRVJUKGlzQXJndW1lbnRzKCkpOwotICAgIGNvbnN0
IGpzOjpWYWx1ZSAmdiA9IGdldFNsb3QoSlNTTE9UX0FSR1NfTEVOR1RIKTsKKyAgICBjb25zdCBq
czo6VmFsdWUgJnYgPSBnZXRGaXhlZFNsb3QoSlNTTE9UX0FSR1NfTEVOR1RIKTsKICAgICByZXR1
cm4gdi50b0ludDMyKCkgJiBBUkdTX0xFTkdUSF9PVkVSUklEREVOX0JJVDsKIH0KIAogaW5saW5l
IGpzOjpBcmd1bWVudHNEYXRhICoKIEpTT2JqZWN0OjpnZXRBcmdzRGF0YSgpIGNvbnN0CiB7CiAg
ICAgSlNfQVNTRVJUKGlzQXJndW1lbnRzKCkpOwotICAgIHJldHVybiAoanM6OkFyZ3VtZW50c0Rh
dGEgKikgZ2V0U2xvdChKU1NMT1RfQVJHU19EQVRBKS50b1ByaXZhdGUoKTsKKyAgICByZXR1cm4g
KGpzOjpBcmd1bWVudHNEYXRhICopIGdldEZpeGVkU2xvdChKU1NMT1RfQVJHU19EQVRBKS50b1By
aXZhdGUoKTsKIH0KIAogaW5saW5lIHZvaWQKIEpTT2JqZWN0OjpzZXRBcmdzRGF0YShqczo6QXJn
dW1lbnRzRGF0YSAqZGF0YSkKIHsKICAgICBKU19BU1NFUlQoaXNBcmd1bWVudHMoKSk7Ci0gICAg
Z2V0U2xvdFJlZihKU1NMT1RfQVJHU19EQVRBKS5zZXRQcml2YXRlKGRhdGEpOworICAgIGdldEZp
eGVkU2xvdFJlZihKU1NMT1RfQVJHU19EQVRBKS5zZXRQcml2YXRlKGRhdGEpOwogfQogCiBpbmxp
bmUgY29uc3QganM6OlZhbHVlICYKIEpTT2JqZWN0OjpnZXRBcmdzQ2FsbGVlKCkgY29uc3QKIHsK
ICAgICByZXR1cm4gZ2V0QXJnc0RhdGEoKS0+Y2FsbGVlOwogfQogCkBAIC00OTYsNjUgKzYyOCw2
NSBAQCBKU09iamVjdDo6c2V0QXJnc0VsZW1lbnQodWludDMyIGksIGNvbnN0CiAgICAgSlNfQVNT
RVJUKGkgPCBnZXRBcmdzSW5pdGlhbExlbmd0aCgpKTsKICAgICBnZXRBcmdzRGF0YSgpLT5zbG90
c1tpXSA9IHY7CiB9CiAKIGlubGluZSBib29sCiBKU09iamVjdDo6Y2FsbElzRm9yRXZhbCgpIGNv
bnN0CiB7CiAgICAgSlNfQVNTRVJUKGlzQ2FsbCgpKTsKLSAgICBKU19BU1NFUlQoZ2V0U2xvdChK
U1NMT1RfQ0FMTF9DQUxMRUUpLmlzT2JqZWN0T3JOdWxsKCkpOwotICAgIEpTX0FTU0VSVF9JRihn
ZXRTbG90KEpTU0xPVF9DQUxMX0NBTExFRSkuaXNPYmplY3QoKSwKLSAgICAgICAgICAgICAgICAg
Z2V0U2xvdChKU1NMT1RfQ0FMTF9DQUxMRUUpLnRvT2JqZWN0KCkuaXNGdW5jdGlvbigpKTsKLSAg
ICByZXR1cm4gZ2V0U2xvdChKU1NMT1RfQ0FMTF9DQUxMRUUpLmlzTnVsbCgpOworICAgIEpTX0FT
U0VSVChnZXRGaXhlZFNsb3QoSlNTTE9UX0NBTExfQ0FMTEVFKS5pc09iamVjdE9yTnVsbCgpKTsK
KyAgICBKU19BU1NFUlRfSUYoZ2V0Rml4ZWRTbG90KEpTU0xPVF9DQUxMX0NBTExFRSkuaXNPYmpl
Y3QoKSwKKyAgICAgICAgICAgICAgICAgZ2V0Rml4ZWRTbG90KEpTU0xPVF9DQUxMX0NBTExFRSku
dG9PYmplY3QoKS5pc0Z1bmN0aW9uKCkpOworICAgIHJldHVybiBnZXRGaXhlZFNsb3QoSlNTTE9U
X0NBTExfQ0FMTEVFKS5pc051bGwoKTsKIH0KIAogaW5saW5lIEpTU3RhY2tGcmFtZSAqCiBKU09i
amVjdDo6bWF5YmVDYWxsT2JqU3RhY2tGcmFtZSgpIGNvbnN0CiB7CiAgICAgSlNfQVNTRVJUKGlz
Q2FsbCgpKTsKICAgICByZXR1cm4gcmVpbnRlcnByZXRfY2FzdDxKU1N0YWNrRnJhbWUgKj4oZ2V0
UHJpdmF0ZSgpKTsKIH0KIAogaW5saW5lIHZvaWQKIEpTT2JqZWN0OjpzZXRDYWxsT2JqQ2FsbGVl
KEpTT2JqZWN0ICpjYWxsZWUpCiB7CiAgICAgSlNfQVNTRVJUKGlzQ2FsbCgpKTsKICAgICBKU19B
U1NFUlRfSUYoY2FsbGVlLCBjYWxsZWUtPmlzRnVuY3Rpb24oKSk7Ci0gICAgcmV0dXJuIGdldFNs
b3RSZWYoSlNTTE9UX0NBTExfQ0FMTEVFKS5zZXRPYmplY3RPck51bGwoY2FsbGVlKTsKKyAgICBy
ZXR1cm4gZ2V0Rml4ZWRTbG90UmVmKEpTU0xPVF9DQUxMX0NBTExFRSkuc2V0T2JqZWN0T3JOdWxs
KGNhbGxlZSk7CiB9CiAKIGlubGluZSBKU09iamVjdCAqCiBKU09iamVjdDo6Z2V0Q2FsbE9iakNh
bGxlZSgpIGNvbnN0CiB7CiAgICAgSlNfQVNTRVJUKGlzQ2FsbCgpKTsKLSAgICByZXR1cm4gZ2V0
U2xvdChKU1NMT1RfQ0FMTF9DQUxMRUUpLnRvT2JqZWN0T3JOdWxsKCk7CisgICAgcmV0dXJuIGdl
dEZpeGVkU2xvdChKU1NMT1RfQ0FMTF9DQUxMRUUpLnRvT2JqZWN0T3JOdWxsKCk7CiB9CiAKIGlu
bGluZSBKU0Z1bmN0aW9uICoKIEpTT2JqZWN0OjpnZXRDYWxsT2JqQ2FsbGVlRnVuY3Rpb24oKSBj
b25zdAogewogICAgIEpTX0FTU0VSVChpc0NhbGwoKSk7Ci0gICAgcmV0dXJuIGdldFNsb3QoSlNT
TE9UX0NBTExfQ0FMTEVFKS50b09iamVjdCgpLmdldEZ1bmN0aW9uUHJpdmF0ZSgpOworICAgIHJl
dHVybiBnZXRGaXhlZFNsb3QoSlNTTE9UX0NBTExfQ0FMTEVFKS50b09iamVjdCgpLmdldEZ1bmN0
aW9uUHJpdmF0ZSgpOwogfQogCiBpbmxpbmUgY29uc3QganM6OlZhbHVlICYKIEpTT2JqZWN0Ojpn
ZXRDYWxsT2JqQXJndW1lbnRzKCkgY29uc3QKIHsKICAgICBKU19BU1NFUlQoaXNDYWxsKCkpOwog
ICAgIEpTX0FTU0VSVCghY2FsbElzRm9yRXZhbCgpKTsKLSAgICByZXR1cm4gZ2V0U2xvdChKU1NM
T1RfQ0FMTF9BUkdVTUVOVFMpOworICAgIHJldHVybiBnZXRGaXhlZFNsb3QoSlNTTE9UX0NBTExf
QVJHVU1FTlRTKTsKIH0KIAogaW5saW5lIHZvaWQKIEpTT2JqZWN0OjpzZXRDYWxsT2JqQXJndW1l
bnRzKGNvbnN0IGpzOjpWYWx1ZSAmdikKIHsKICAgICBKU19BU1NFUlQoaXNDYWxsKCkpOwogICAg
IEpTX0FTU0VSVCghY2FsbElzRm9yRXZhbCgpKTsKLSAgICBzZXRTbG90KEpTU0xPVF9DQUxMX0FS
R1VNRU5UUywgdik7CisgICAgc2V0Rml4ZWRTbG90KEpTU0xPVF9DQUxMX0FSR1VNRU5UUywgdik7
CiB9CiAKIGlubGluZSBjb25zdCBqczo6VmFsdWUgJgogSlNPYmplY3Q6OmNhbGxPYmpBcmcodWlu
dE4gaSkgY29uc3QKIHsKICAgICBKU19BU1NFUlQoaXNDYWxsKCkpOwogICAgIEpTX0FTU0VSVChp
IDwgZ2V0Q2FsbE9iakNhbGxlZUZ1bmN0aW9uKCktPm5hcmdzKTsKICAgICByZXR1cm4gZ2V0U2xv
dChKU09iamVjdDo6Q0FMTF9SRVNFUlZFRF9TTE9UUyArIGkpOwpAQCAtNTg1LDM1ICs3MTcsMzUg
QEAgSlNPYmplY3Q6OmNhbGxPYmpWYXIodWludE4gaSkKICAgICBKU19BU1NFUlQoaSA8IGZ1bi0+
c2NyaXB0KCktPmJpbmRpbmdzLmNvdW50VmFycygpKTsKICAgICByZXR1cm4gZ2V0U2xvdFJlZihK
U09iamVjdDo6Q0FMTF9SRVNFUlZFRF9TTE9UUyArIGZ1bi0+bmFyZ3MgKyBpKTsKIH0KIAogaW5s
aW5lIGNvbnN0IGpzOjpWYWx1ZSAmCiBKU09iamVjdDo6Z2V0RGF0ZVVUQ1RpbWUoKSBjb25zdAog
ewogICAgIEpTX0FTU0VSVChpc0RhdGUoKSk7Ci0gICAgcmV0dXJuIGdldFNsb3QoSlNTTE9UX0RB
VEVfVVRDX1RJTUUpOworICAgIHJldHVybiBnZXRGaXhlZFNsb3QoSlNTTE9UX0RBVEVfVVRDX1RJ
TUUpOwogfQogCiBpbmxpbmUgdm9pZCAKIEpTT2JqZWN0OjpzZXREYXRlVVRDVGltZShjb25zdCBq
czo6VmFsdWUgJnRpbWUpCiB7CiAgICAgSlNfQVNTRVJUKGlzRGF0ZSgpKTsKLSAgICBzZXRTbG90
KEpTU0xPVF9EQVRFX1VUQ19USU1FLCB0aW1lKTsKKyAgICBzZXRGaXhlZFNsb3QoSlNTTE9UX0RB
VEVfVVRDX1RJTUUsIHRpbWUpOwogfQogCiBpbmxpbmUganM6OlZhbHVlICoKIEpTT2JqZWN0Ojpn
ZXRGbGF0Q2xvc3VyZVVwdmFycygpIGNvbnN0CiB7CiAjaWZkZWYgREVCVUcKICAgICBKU0Z1bmN0
aW9uICpmdW4gPSBnZXRGdW5jdGlvblByaXZhdGUoKTsKICAgICBKU19BU1NFUlQoZnVuLT5pc0Zs
YXRDbG9zdXJlKCkpOwogICAgIEpTX0FTU0VSVChmdW4tPnNjcmlwdCgpLT5iaW5kaW5ncy5jb3Vu
dFVwdmFycygpID09IGZ1bi0+c2NyaXB0KCktPnVwdmFycygpLT5sZW5ndGgpOwogI2VuZGlmCi0g
ICAgcmV0dXJuIChqczo6VmFsdWUgKikgZ2V0U2xvdChKU1NMT1RfRkxBVF9DTE9TVVJFX1VQVkFS
UykudG9Qcml2YXRlKCk7CisgICAgcmV0dXJuIChqczo6VmFsdWUgKikgZ2V0Rml4ZWRTbG90KEpT
U0xPVF9GTEFUX0NMT1NVUkVfVVBWQVJTKS50b1ByaXZhdGUoKTsKIH0KIAogaW5saW5lIGpzOjpW
YWx1ZQogSlNPYmplY3Q6OmdldEZsYXRDbG9zdXJlVXB2YXIodWludDMyIGkpIGNvbnN0CiB7CiAg
ICAgSlNfQVNTRVJUKGkgPCBnZXRGdW5jdGlvblByaXZhdGUoKS0+c2NyaXB0KCktPmJpbmRpbmdz
LmNvdW50VXB2YXJzKCkpOwogICAgIHJldHVybiBnZXRGbGF0Q2xvc3VyZVVwdmFycygpW2ldOwog
fQpAQCAtNjI1LDMxICs3NTcsMzEgQEAgSlNPYmplY3Q6OmdldEZsYXRDbG9zdXJlVXB2YXIodWlu
dDMyIGkpCiAgICAgcmV0dXJuIGdldEZsYXRDbG9zdXJlVXB2YXJzKClbaV07CiB9CiAKIGlubGlu
ZSB2b2lkCiBKU09iamVjdDo6c2V0RmxhdENsb3N1cmVVcHZhcnMoanM6OlZhbHVlICp1cHZhcnMp
CiB7CiAgICAgSlNfQVNTRVJUKGlzRnVuY3Rpb24oKSk7CiAgICAgSlNfQVNTRVJUKEZVTl9GTEFU
X0NMT1NVUkUoZ2V0RnVuY3Rpb25Qcml2YXRlKCkpKTsKLSAgICBnZXRTbG90UmVmKEpTU0xPVF9G
TEFUX0NMT1NVUkVfVVBWQVJTKS5zZXRQcml2YXRlKHVwdmFycyk7CisgICAgZ2V0Rml4ZWRTbG90
UmVmKEpTU0xPVF9GTEFUX0NMT1NVUkVfVVBWQVJTKS5zZXRQcml2YXRlKHVwdmFycyk7CiB9CiAK
IGlubGluZSBib29sCiBKU09iamVjdDo6aGFzTWV0aG9kT2JqKGNvbnN0IEpTT2JqZWN0JiBvYmop
IGNvbnN0CiB7CiAgICAgcmV0dXJuIEpTU0xPVF9GVU5fTUVUSE9EX09CSiA8IG51bVNsb3RzKCkg
JiYKLSAgICAgICAgICAgZ2V0U2xvdChKU1NMT1RfRlVOX01FVEhPRF9PQkopLmlzT2JqZWN0KCkg
JiYKLSAgICAgICAgICAgJmdldFNsb3QoSlNTTE9UX0ZVTl9NRVRIT0RfT0JKKS50b09iamVjdCgp
ID09ICZvYmo7CisgICAgICAgICAgIGdldEZpeGVkU2xvdChKU1NMT1RfRlVOX01FVEhPRF9PQkop
LmlzT2JqZWN0KCkgJiYKKyAgICAgICAgICAgJmdldEZpeGVkU2xvdChKU1NMT1RfRlVOX01FVEhP
RF9PQkopLnRvT2JqZWN0KCkgPT0gJm9iajsKIH0KIAogaW5saW5lIHZvaWQKIEpTT2JqZWN0Ojpz
ZXRNZXRob2RPYmooSlNPYmplY3QmIG9iaikKIHsKLSAgICBnZXRTbG90UmVmKEpTU0xPVF9GVU5f
TUVUSE9EX09CSikuc2V0T2JqZWN0KG9iaik7CisgICAgZ2V0Rml4ZWRTbG90UmVmKEpTU0xPVF9G
VU5fTUVUSE9EX09CSikuc2V0T2JqZWN0KG9iaik7CiB9CiAKIGlubGluZSBqczo6TmF0aXZlSXRl
cmF0b3IgKgogSlNPYmplY3Q6OmdldE5hdGl2ZUl0ZXJhdG9yKCkgY29uc3QKIHsKICAgICByZXR1
cm4gKGpzOjpOYXRpdmVJdGVyYXRvciAqKSBnZXRQcml2YXRlKCk7CiB9CiAKQEAgLTc0NCwyMyAr
ODc2LDIzIEBAIEpTT2JqZWN0OjpzZXRRTmFtZUxvY2FsTmFtZShKU0xpbmVhclN0cmkKIHsKICAg
ICBKU19BU1NFUlQoaXNRTmFtZSgpKTsKICAgICBzZXRTbG90KEpTU0xPVF9RTkFNRV9MT0NBTF9O
QU1FLCBuYW1lID8ganM6OlN0cmluZ1ZhbHVlKG5hbWUpIDoganM6OlVuZGVmaW5lZFZhbHVlKCkp
OwogfQogCiBpbmxpbmUgSlNPYmplY3QgKgogSlNPYmplY3Q6OmdldFdpdGhUaGlzKCkgY29uc3QK
IHsKLSAgICByZXR1cm4gJmdldFNsb3QoSlNTTE9UX1dJVEhfVEhJUykudG9PYmplY3QoKTsKKyAg
ICByZXR1cm4gJmdldEZpeGVkU2xvdChKU1NMT1RfV0lUSF9USElTKS50b09iamVjdCgpOwogfQog
CiBpbmxpbmUgdm9pZAogSlNPYmplY3Q6OnNldFdpdGhUaGlzKEpTT2JqZWN0ICp0aGlzcCkKIHsK
LSAgICBnZXRTbG90UmVmKEpTU0xPVF9XSVRIX1RISVMpLnNldE9iamVjdCgqdGhpc3ApOworICAg
IGdldEZpeGVkU2xvdFJlZihKU1NMT1RfV0lUSF9USElTKS5zZXRPYmplY3QoKnRoaXNwKTsKIH0K
IAogaW5saW5lIHZvaWQKIEpTT2JqZWN0Ojppbml0KEpTQ29udGV4dCAqY3gsIGpzOjpDbGFzcyAq
YWNsYXNwLCBKU09iamVjdCAqcHJvdG8sIEpTT2JqZWN0ICpwYXJlbnQsCiAgICAgICAgICAgICAg
ICB2b2lkICpwcml2LCBib29sIHVzZUhvbGVzKQogewogICAgIGNsYXNwID0gYWNsYXNwOwogICAg
IGZsYWdzID0gMDsKQEAgLTc3MywzNyArOTA1LDM2IEBAIEpTT2JqZWN0Ojppbml0KEpTQ29udGV4
dCAqY3gsIGpzOjpDbGFzcyAKICAgICAgKi8KICAgICBvYmpTaGFwZSA9IEpTT2JqZWN0TWFwOjpJ
TlZBTElEX1NIQVBFOwogI2VuZGlmCiAKICAgICBzZXRQcm90byhwcm90byk7CiAgICAgc2V0UGFy
ZW50KHBhcmVudCk7CiAKICAgICBwcml2YXRlRGF0YSA9IHByaXY7Ci0gICAgc2xvdHMgPSBmaXhl
ZFNsb3RzKCk7CiAKICAgICAvKgogICAgICAqIEZpbGwgdGhlIGZpeGVkIHNsb3RzIHdpdGggdW5k
ZWZpbmVkIG9yIGFycmF5IGhvbGVzLiAgVGhpcyBvYmplY3QgbXVzdAogICAgICAqIGFscmVhZHkg
aGF2ZSBpdHMgY2FwYWNpdHkgZmlsbGVkIGluLCBhcyBieSBqc19OZXdHQ09iamVjdC4KICAgICAg
Ki8KLSAgICBKU19BU1NFUlQoY2FwYWNpdHkgPT0gbnVtRml4ZWRTbG90cygpKTsKLSAgICBDbGVh
clZhbHVlUmFuZ2Uoc2xvdHMsIGNhcGFjaXR5LCB1c2VIb2xlcyk7CisgICAgc2xvdHMgPSB1c2VI
b2xlcyA/IGZpeGVkU2xvdHMoKSA6IE5VTEw7CisgICAgQ2xlYXJWYWx1ZVJhbmdlKGZpeGVkU2xv
dHMoKSwgY2FwYWNpdHksIHVzZUhvbGVzKTsKIAogICAgIGVtcHR5U2hhcGVzID0gTlVMTDsKIH0K
IAogaW5saW5lIHZvaWQKIEpTT2JqZWN0OjpmaW5pc2goSlNDb250ZXh0ICpjeCkKIHsKICNpZmRl
ZiBERUJVRwogICAgIGlmIChpc05hdGl2ZSgpKQogICAgICAgICBKU19MT0NLX1JVTlRJTUVfVk9J
RChjeC0+cnVudGltZSwgY3gtPnJ1bnRpbWUtPmxpdmVPYmplY3RQcm9wcyAtPSBwcm9wZXJ0eUNv
dW50KCkpOwogI2VuZGlmCiAgICAgaWYgKGhhc1Nsb3RzQXJyYXkoKSkKLSAgICAgICAgZnJlZVNs
b3RzQXJyYXkoY3gpOworICAgICAgICBjeC0+ZnJlZV8oc2xvdHMpOwogICAgIGlmIChlbXB0eVNo
YXBlcykKICAgICAgICAgY3gtPmZyZWVfKGVtcHR5U2hhcGVzKTsKIH0KIAogaW5saW5lIGJvb2wK
IEpTT2JqZWN0Ojppbml0U2hhcmluZ0VtcHR5U2hhcGUoSlNDb250ZXh0ICpjeCwKICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAganM6OkNsYXNzICphY2xhc3AsCiAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgIEpTT2JqZWN0ICpwcm90bywKQEAgLTgxOCwzNSArOTQ5LDE2IEBA
IEpTT2JqZWN0Ojppbml0U2hhcmluZ0VtcHR5U2hhcGUoSlNDb250ZXgKICAgICBqczo6RW1wdHlT
aGFwZSAqZW1wdHkgPSBwcm90by0+Z2V0RW1wdHlTaGFwZShjeCwgYWNsYXNwLCBraW5kKTsKICAg
ICBpZiAoIWVtcHR5KQogICAgICAgICByZXR1cm4gZmFsc2U7CiAKICAgICBzZXRNYXAoZW1wdHkp
OwogICAgIHJldHVybiB0cnVlOwogfQogCi1pbmxpbmUgdm9pZAotSlNPYmplY3Q6OmZyZWVTbG90
c0FycmF5KEpTQ29udGV4dCAqY3gpCi17Ci0gICAgSlNfQVNTRVJUKGhhc1Nsb3RzQXJyYXkoKSk7
Ci0gICAgY3gtPmZyZWVfKHNsb3RzKTsKLX0KLQotaW5saW5lIHZvaWQKLUpTT2JqZWN0OjpyZXZl
cnRUb0ZpeGVkU2xvdHMoSlNDb250ZXh0ICpjeCkKLXsKLSAgICBKU19BU1NFUlQoaGFzU2xvdHNB
cnJheSgpKTsKLSAgICBzaXplX3QgZml4ZWQgPSBudW1GaXhlZFNsb3RzKCk7Ci0gICAgSlNfQVNT
RVJUKGNhcGFjaXR5ID49IGZpeGVkKTsKLSAgICBtZW1jcHkoZml4ZWRTbG90cygpLCBzbG90cywg
Zml4ZWQgKiBzaXplb2YoanM6OlZhbHVlKSk7Ci0gICAgZnJlZVNsb3RzQXJyYXkoY3gpOwotICAg
IHNsb3RzID0gZml4ZWRTbG90cygpOwotICAgIGNhcGFjaXR5ID0gZml4ZWQ7Ci19Ci0KIGlubGlu
ZSBib29sCiBKU09iamVjdDo6aGFzUHJvcGVydHkoSlNDb250ZXh0ICpjeCwganNpZCBpZCwgYm9v
bCAqZm91bmRwLCB1aW50TiBmbGFncykKIHsKICAgICBKU09iamVjdCAqcG9iajsKICAgICBKU1By
b3BlcnR5ICpwcm9wOwogICAgIEpTQXV0b1Jlc29sdmVGbGFncyByZihjeCwgZmxhZ3MpOwogICAg
IGlmICghbG9va3VwUHJvcGVydHkoY3gsIGlkLCAmcG9iaiwgJnByb3ApKQogICAgICAgICByZXR1
cm4gZmFsc2U7CkBAIC0xMjgxLDkgKzEzOTMsNzYgQEAgRGVmaW5lQ29uc3RydWN0b3JBbmRQcm90
b3R5cGUoSlNDb250ZXh0IAogICAgIGdsb2JhbC0+c2V0U2xvdChrZXksIE9iamVjdFZhbHVlKCpj
dG9yKSk7CiAgICAgZ2xvYmFsLT5zZXRTbG90KGtleSArIEpTUHJvdG9fTElNSVQsIE9iamVjdFZh
bHVlKCpwcm90bykpOwogICAgIGdsb2JhbC0+c2V0U2xvdChrZXkgKyBKU1Byb3RvX0xJTUlUICog
MiwgT2JqZWN0VmFsdWUoKmN0b3IpKTsKICAgICByZXR1cm4gdHJ1ZTsKIH0KIAogfSAvKiBuYW1l
c3BhY2UganMgKi8KIAorLyogRnVuY3Rpb24gc2xvdCBhY2Nlc3NvcnMuICovCisKK3ZvaWQKK0pT
RnVuY3Rpb246OnNldEpvaW5hYmxlKCkKK3sKKyAgICBKU19BU1NFUlQoRlVOX0lOVEVSUFJFVEVE
KHRoaXMpKTsKKyAgICBnZXRGaXhlZFNsb3RSZWYoTUVUSE9EX0FUT01fU0xPVCkuc2V0TnVsbCgp
OworICAgIGZsYWdzIHw9IEpTRlVOX0pPSU5BQkxFOworfQorCisvKgorICogTWV0aG9kIG5hbWUg
aW1wdXRlZCBmcm9tIHByb3BlcnR5IHVuaXF1ZWx5IGFzc2lnbmVkIHRvIG9yIGluaXRpYWxpemVk
LAorICogd2hlcmUgdGhlIGZ1bmN0aW9uIGRvZXMgbm90IG5lZWQgdG8gYmUgY2xvbmVkIHRvIGNh
cnJ5IGEgc2NvcGUgY2hhaW4gb3IKKyAqIGZsYXR0ZW5lZCB1cHZhcnMuCisgKi8KK0pTQXRvbSAq
CitKU0Z1bmN0aW9uOjptZXRob2RBdG9tKCkgY29uc3QKK3sKKyAgICByZXR1cm4gKGpvaW5hYmxl
KCkgJiYgZ2V0Rml4ZWRTbG90KE1FVEhPRF9BVE9NX1NMT1QpLmlzU3RyaW5nKCkpCisgICAgICAg
ICAgID8gJmdldEZpeGVkU2xvdChNRVRIT0RfQVRPTV9TTE9UKS50b1N0cmluZygpLT5hc0F0b20o
KQorICAgICAgICAgICA6IE5VTEw7Cit9CisKK3ZvaWQKK0pTRnVuY3Rpb246OnNldE1ldGhvZEF0
b20oSlNBdG9tICphdG9tKQoreworICAgIEpTX0FTU0VSVChqb2luYWJsZSgpKTsKKyAgICBnZXRG
aXhlZFNsb3RSZWYoTUVUSE9EX0FUT01fU0xPVCkuc2V0U3RyaW5nKGF0b20pOworfQorCisvKiBQ
cm94eSBzbG90IGFjY2Vzc29ycy4gKi8KKworaW5saW5lIGpzOjpKU1Byb3h5SGFuZGxlciAqCitK
U09iamVjdDo6Z2V0UHJveHlIYW5kbGVyKCkgY29uc3QKK3sKKyAgICBKU19BU1NFUlQoaXNQcm94
eSgpKTsKKyAgICByZXR1cm4gKGpzOjpKU1Byb3h5SGFuZGxlciAqKSBnZXRTbG90KGpzOjpKU1NM
T1RfUFJPWFlfSEFORExFUikudG9Qcml2YXRlKCk7Cit9CisKK2lubGluZSBjb25zdCBqczo6VmFs
dWUgJgorSlNPYmplY3Q6OmdldFByb3h5UHJpdmF0ZSgpIGNvbnN0Cit7CisgICAgSlNfQVNTRVJU
KGlzUHJveHkoKSk7CisgICAgcmV0dXJuIGdldFNsb3QoanM6OkpTU0xPVF9QUk9YWV9QUklWQVRF
KTsKK30KKworaW5saW5lIHZvaWQKK0pTT2JqZWN0OjpzZXRQcm94eVByaXZhdGUoY29uc3QganM6
OlZhbHVlICZwcml2KQoreworICAgIEpTX0FTU0VSVChpc1Byb3h5KCkpOworICAgIHNldFNsb3Qo
anM6OkpTU0xPVF9QUk9YWV9QUklWQVRFLCBwcml2KTsKK30KKworaW5saW5lIGNvbnN0IGpzOjpW
YWx1ZSAmCitKU09iamVjdDo6Z2V0UHJveHlFeHRyYSgpIGNvbnN0Cit7CisgICAgSlNfQVNTRVJU
KGlzUHJveHkoKSk7CisgICAgcmV0dXJuIGdldFNsb3QoanM6OkpTU0xPVF9QUk9YWV9FWFRSQSk7
Cit9CisKK2lubGluZSB2b2lkCitKU09iamVjdDo6c2V0UHJveHlFeHRyYShjb25zdCBqczo6VmFs
dWUgJmV4dHJhKQoreworICAgIEpTX0FTU0VSVChpc1Byb3h5KCkpOworICAgIHNldFNsb3QoanM6
OkpTU0xPVF9QUk9YWV9FWFRSQSwgZXh0cmEpOworfQorCiAjZW5kaWYgLyoganNvYmppbmxpbmVz
X2hfX18gKi8KZGlmZiAtLWdpdCBhL2pzL3NyYy9qc3Byb3h5LmggYi9qcy9zcmMvanNwcm94eS5o
Ci0tLSBhL2pzL3NyYy9qc3Byb3h5LmgKKysrIGIvanMvc3JjL2pzcHJveHkuaApAQCAtMTYxLDUx
ICsxNjEsMTYgQEAgSlNPYmplY3Q6OmlzRnVuY3Rpb25Qcm94eSgpIGNvbnN0CiB9CiAKIGlubGlu
ZSBib29sCiBKU09iamVjdDo6aXNQcm94eSgpIGNvbnN0CiB7CiAgICAgcmV0dXJuIGlzT2JqZWN0
UHJveHkoKSB8fCBpc0Z1bmN0aW9uUHJveHkoKTsKIH0KIAotaW5saW5lIGpzOjpKU1Byb3h5SGFu
ZGxlciAqCi1KU09iamVjdDo6Z2V0UHJveHlIYW5kbGVyKCkgY29uc3QKLXsKLSAgICBKU19BU1NF
UlQoaXNQcm94eSgpKTsKLSAgICByZXR1cm4gKGpzOjpKU1Byb3h5SGFuZGxlciAqKSBnZXRTbG90
KGpzOjpKU1NMT1RfUFJPWFlfSEFORExFUikudG9Qcml2YXRlKCk7Ci19Ci0KLWlubGluZSBjb25z
dCBqczo6VmFsdWUgJgotSlNPYmplY3Q6OmdldFByb3h5UHJpdmF0ZSgpIGNvbnN0Ci17Ci0gICAg
SlNfQVNTRVJUKGlzUHJveHkoKSk7Ci0gICAgcmV0dXJuIGdldFNsb3QoanM6OkpTU0xPVF9QUk9Y
WV9QUklWQVRFKTsKLX0KLQotaW5saW5lIHZvaWQKLUpTT2JqZWN0OjpzZXRQcm94eVByaXZhdGUo
Y29uc3QganM6OlZhbHVlICZwcml2KQotewotICAgIEpTX0FTU0VSVChpc1Byb3h5KCkpOwotICAg
IHNldFNsb3QoanM6OkpTU0xPVF9QUk9YWV9QUklWQVRFLCBwcml2KTsKLX0KLQotaW5saW5lIGNv
bnN0IGpzOjpWYWx1ZSAmCi1KU09iamVjdDo6Z2V0UHJveHlFeHRyYSgpIGNvbnN0Ci17Ci0gICAg
SlNfQVNTRVJUKGlzUHJveHkoKSk7Ci0gICAgcmV0dXJuIGdldFNsb3QoanM6OkpTU0xPVF9QUk9Y
WV9FWFRSQSk7Ci19Ci0KLWlubGluZSB2b2lkCi1KU09iamVjdDo6c2V0UHJveHlFeHRyYShjb25z
dCBqczo6VmFsdWUgJmV4dHJhKQotewotICAgIEpTX0FTU0VSVChpc1Byb3h5KCkpOwotICAgIHNl
dFNsb3QoanM6OkpTU0xPVF9QUk9YWV9FWFRSQSwgZXh0cmEpOwotfQotCiBuYW1lc3BhY2UganMg
ewogCiBKU19GUklFTkRfQVBJKEpTT2JqZWN0ICopCiBOZXdQcm94eU9iamVjdChKU0NvbnRleHQg
KmN4LCBKU1Byb3h5SGFuZGxlciAqaGFuZGxlciwgY29uc3QganM6OlZhbHVlICZwcml2LAogICAg
ICAgICAgICAgICAgSlNPYmplY3QgKnByb3RvLCBKU09iamVjdCAqcGFyZW50LAogICAgICAgICAg
ICAgICAgSlNPYmplY3QgKmNhbGwgPSBOVUxMLCBKU09iamVjdCAqY29uc3RydWN0ID0gTlVMTCk7
CiAKIEpTX0ZSSUVORF9BUEkoSlNCb29sKQpkaWZmIC0tZ2l0IGEvanMvc3JjL2pzcmVnZXhwLmgg
Yi9qcy9zcmMvanNyZWdleHAuaAotLS0gYS9qcy9zcmMvanNyZWdleHAuaAorKysgYi9qcy9zcmMv
anNyZWdleHAuaApAQCAtMzIzLDc0ICszMjMsMTYgQEAgY2xhc3MgUHJlc2VydmVSZWdFeHBTdGF0
aWNzCiB9CiAKIHN0YXRpYyBpbmxpbmUgYm9vbAogVkFMVUVfSVNfUkVHRVhQKEpTQ29udGV4dCAq
Y3gsIGpzOjpWYWx1ZSB2KQogewogICAgIHJldHVybiAhdi5pc1ByaW1pdGl2ZSgpICYmIHYudG9P
YmplY3QoKS5pc1JlZ0V4cCgpOwogfQogCi1pbmxpbmUgY29uc3QganM6OlZhbHVlICYKLUpTT2Jq
ZWN0OjpnZXRSZWdFeHBMYXN0SW5kZXgoKSBjb25zdAotewotICAgIEpTX0FTU0VSVChpc1JlZ0V4
cCgpKTsKLSAgICByZXR1cm4gZ2V0U2xvdChKU1NMT1RfUkVHRVhQX0xBU1RfSU5ERVgpOwotfQot
Ci1pbmxpbmUgdm9pZAotSlNPYmplY3Q6OnNldFJlZ0V4cExhc3RJbmRleChjb25zdCBqczo6VmFs
dWUgJnYpCi17Ci0gICAgSlNfQVNTRVJUKGlzUmVnRXhwKCkpOwotICAgIHNldFNsb3QoSlNTTE9U
X1JFR0VYUF9MQVNUX0lOREVYLCB2KTsKLX0KLQotaW5saW5lIHZvaWQKLUpTT2JqZWN0OjpzZXRS
ZWdFeHBMYXN0SW5kZXgoanNkb3VibGUgZCkKLXsKLSAgICBKU19BU1NFUlQoaXNSZWdFeHAoKSk7
Ci0gICAgc2V0U2xvdChKU1NMT1RfUkVHRVhQX0xBU1RfSU5ERVgsIGpzOjpOdW1iZXJWYWx1ZShk
KSk7Ci19Ci0KLWlubGluZSB2b2lkCi1KU09iamVjdDo6emVyb1JlZ0V4cExhc3RJbmRleCgpCi17
Ci0gICAgSlNfQVNTRVJUKGlzUmVnRXhwKCkpOwotICAgIHNldFNsb3QoSlNTTE9UX1JFR0VYUF9M
QVNUX0lOREVYLCBqczo6SW50MzJWYWx1ZSgwKSk7Ci19Ci0KLWlubGluZSB2b2lkCi1KU09iamVj
dDo6c2V0UmVnRXhwU291cmNlKEpTU3RyaW5nICpzb3VyY2UpCi17Ci0gICAgc2V0U2xvdChKU1NM
T1RfUkVHRVhQX1NPVVJDRSwganM6OlN0cmluZ1ZhbHVlKHNvdXJjZSkpOwotfQotCi1pbmxpbmUg
dm9pZAotSlNPYmplY3Q6OnNldFJlZ0V4cEdsb2JhbChib29sIGdsb2JhbCkKLXsKLSAgICBzZXRT
bG90KEpTU0xPVF9SRUdFWFBfR0xPQkFMLCBqczo6Qm9vbGVhblZhbHVlKGdsb2JhbCkpOwotfQot
Ci1pbmxpbmUgdm9pZAotSlNPYmplY3Q6OnNldFJlZ0V4cElnbm9yZUNhc2UoYm9vbCBpZ25vcmVD
YXNlKQotewotICAgIHNldFNsb3QoSlNTTE9UX1JFR0VYUF9JR05PUkVfQ0FTRSwganM6OkJvb2xl
YW5WYWx1ZShpZ25vcmVDYXNlKSk7Ci19Ci0KLWlubGluZSB2b2lkCi1KU09iamVjdDo6c2V0UmVn
RXhwTXVsdGlsaW5lKGJvb2wgbXVsdGlsaW5lKQotewotICAgIHNldFNsb3QoSlNTTE9UX1JFR0VY
UF9NVUxUSUxJTkUsIGpzOjpCb29sZWFuVmFsdWUobXVsdGlsaW5lKSk7Ci19Ci0KLWlubGluZSB2
b2lkCi1KU09iamVjdDo6c2V0UmVnRXhwU3RpY2t5KGJvb2wgc3RpY2t5KQotewotICAgIHNldFNs
b3QoSlNTTE9UX1JFR0VYUF9TVElDS1ksIGpzOjpCb29sZWFuVmFsdWUoc3RpY2t5KSk7Ci19Ci0K
IG5hbWVzcGFjZSBqcyB7IGNsYXNzIEF1dG9TdHJpbmdSb290ZXI7IH0KIAogaW5saW5lIGJvb2wK
IEpTT2JqZWN0Ojppc1JlZ0V4cCgpIGNvbnN0CiB7CiAgICAgcmV0dXJuIGdldENsYXNzKCkgPT0g
JmpzX1JlZ0V4cENsYXNzOwogfQogCmRpZmYgLS1naXQgYS9qcy9zcmMvanNyZWdleHBpbmxpbmVz
LmggYi9qcy9zcmMvanNyZWdleHBpbmxpbmVzLmgKLS0tIGEvanMvc3JjL2pzcmVnZXhwaW5saW5l
cy5oCisrKyBiL2pzL3NyYy9qc3JlZ2V4cGlubGluZXMuaApAQCAtNzc2LDkgKzc3Niw2NyBAQCBK
U09iamVjdDo6aW5pdFJlZ0V4cChKU0NvbnRleHQgKmN4LCBqczo6CiAgICAgc2V0UmVnRXhwU291
cmNlKHJlLT5nZXRTb3VyY2UoKSk7CiAgICAgc2V0UmVnRXhwR2xvYmFsKHJlLT5nbG9iYWwoKSk7
CiAgICAgc2V0UmVnRXhwSWdub3JlQ2FzZShyZS0+aWdub3JlQ2FzZSgpKTsKICAgICBzZXRSZWdF
eHBNdWx0aWxpbmUocmUtPm11bHRpbGluZSgpKTsKICAgICBzZXRSZWdFeHBTdGlja3kocmUtPnN0
aWNreSgpKTsKICAgICByZXR1cm4gdHJ1ZTsKIH0KIAoraW5saW5lIGNvbnN0IGpzOjpWYWx1ZSAm
CitKU09iamVjdDo6Z2V0UmVnRXhwTGFzdEluZGV4KCkgY29uc3QKK3sKKyAgICBKU19BU1NFUlQo
aXNSZWdFeHAoKSk7CisgICAgcmV0dXJuIGdldFNsb3QoSlNTTE9UX1JFR0VYUF9MQVNUX0lOREVY
KTsKK30KKworaW5saW5lIHZvaWQKK0pTT2JqZWN0OjpzZXRSZWdFeHBMYXN0SW5kZXgoY29uc3Qg
anM6OlZhbHVlICZ2KQoreworICAgIEpTX0FTU0VSVChpc1JlZ0V4cCgpKTsKKyAgICBzZXRTbG90
KEpTU0xPVF9SRUdFWFBfTEFTVF9JTkRFWCwgdik7Cit9CisKK2lubGluZSB2b2lkCitKU09iamVj
dDo6c2V0UmVnRXhwTGFzdEluZGV4KGpzZG91YmxlIGQpCit7CisgICAgSlNfQVNTRVJUKGlzUmVn
RXhwKCkpOworICAgIHNldFNsb3QoSlNTTE9UX1JFR0VYUF9MQVNUX0lOREVYLCBqczo6TnVtYmVy
VmFsdWUoZCkpOworfQorCitpbmxpbmUgdm9pZAorSlNPYmplY3Q6Onplcm9SZWdFeHBMYXN0SW5k
ZXgoKQoreworICAgIEpTX0FTU0VSVChpc1JlZ0V4cCgpKTsKKyAgICBzZXRTbG90KEpTU0xPVF9S
RUdFWFBfTEFTVF9JTkRFWCwganM6OkludDMyVmFsdWUoMCkpOworfQorCitpbmxpbmUgdm9pZAor
SlNPYmplY3Q6OnNldFJlZ0V4cFNvdXJjZShKU1N0cmluZyAqc291cmNlKQoreworICAgIHNldFNs
b3QoSlNTTE9UX1JFR0VYUF9TT1VSQ0UsIGpzOjpTdHJpbmdWYWx1ZShzb3VyY2UpKTsKK30KKwor
aW5saW5lIHZvaWQKK0pTT2JqZWN0OjpzZXRSZWdFeHBHbG9iYWwoYm9vbCBnbG9iYWwpCit7Cisg
ICAgc2V0U2xvdChKU1NMT1RfUkVHRVhQX0dMT0JBTCwganM6OkJvb2xlYW5WYWx1ZShnbG9iYWwp
KTsKK30KKworaW5saW5lIHZvaWQKK0pTT2JqZWN0OjpzZXRSZWdFeHBJZ25vcmVDYXNlKGJvb2wg
aWdub3JlQ2FzZSkKK3sKKyAgICBzZXRTbG90KEpTU0xPVF9SRUdFWFBfSUdOT1JFX0NBU0UsIGpz
OjpCb29sZWFuVmFsdWUoaWdub3JlQ2FzZSkpOworfQorCitpbmxpbmUgdm9pZAorSlNPYmplY3Q6
OnNldFJlZ0V4cE11bHRpbGluZShib29sIG11bHRpbGluZSkKK3sKKyAgICBzZXRTbG90KEpTU0xP
VF9SRUdFWFBfTVVMVElMSU5FLCBqczo6Qm9vbGVhblZhbHVlKG11bHRpbGluZSkpOworfQorCitp
bmxpbmUgdm9pZAorSlNPYmplY3Q6OnNldFJlZ0V4cFN0aWNreShib29sIHN0aWNreSkKK3sKKyAg
ICBzZXRTbG90KEpTU0xPVF9SRUdFWFBfU1RJQ0tZLCBqczo6Qm9vbGVhblZhbHVlKHN0aWNreSkp
OworfQorCiAjZW5kaWYgLyoganNyZWdleHBpbmxpbmVzX2hfX18gKi8KZGlmZiAtLWdpdCBhL2pz
L3NyYy9qc3Njb3BlLmNwcCBiL2pzL3NyYy9qc3Njb3BlLmNwcAotLS0gYS9qcy9zcmMvanNzY29w
ZS5jcHAKKysrIGIvanMvc3JjL2pzc2NvcGUuY3BwCkBAIC0xMTkzLDI4ICsxMTkzLDE2IEBAIEpT
T2JqZWN0OjpyZW1vdmVQcm9wZXJ0eShKU0NvbnRleHQgKmN4LCAKICAgICB9IGVsc2UgewogICAg
ICAgICAvKgogICAgICAgICAgKiBOb24tZGljdGlvbmFyeS1tb2RlIHByb3BlcnR5IHRhYmxlcyBh
cmUgc2hhcmVkIGltbXV0YWJsZXMsIHNvIGFsbCB3ZQogICAgICAgICAgKiBuZWVkIGRvIGlzIHJl
dHJhY3QgbGFzdFByb3AgYW5kIHdlJ2xsIGVpdGhlciBnZXQgb3IgZWxzZSBsYXppbHkgbWFrZQog
ICAgICAgICAgKiB2aWEgYSBsYXRlciBoYXNoaWZ5IHRoZSBleGFjdCB0YWJsZSBmb3IgdGhlIG5l
dyBwcm9wZXJ0eSBsaW5lYWdlLgogICAgICAgICAgKi8KICAgICAgICAgSlNfQVNTRVJUKHNoYXBl
ID09IGxhc3RQcm9wKTsKICAgICAgICAgcmVtb3ZlTGFzdFByb3BlcnR5KCk7Ci0KLSAgICAgICAg
LyoKLSAgICAgICAgICogUmV2ZXJ0IHRvIGZpeGVkIHNsb3RzIGlmIHRoaXMgd2FzIHRoZSBmaXJz
dCBkeW5hbWljYWxseSBhbGxvY2F0ZWQgc2xvdCwKLSAgICAgICAgICogcHJlc2VydmluZyBpbnZh
cmlhbnQgdGhhdCBvYmplY3RzIHdpdGggdGhlIHNhbWUgc2hhcGUgdXNlIHRoZSBmaXhlZAotICAg
ICAgICAgKiBzbG90cyBpbiB0aGUgc2FtZSB3YXkuCi0gICAgICAgICAqLwotICAgICAgICBzaXpl
X3QgZml4ZWQgPSBudW1GaXhlZFNsb3RzKCk7Ci0gICAgICAgIGlmIChzaGFwZS0+c2xvdCA9PSBm
aXhlZCkgewotICAgICAgICAgICAgSlNfQVNTRVJUX0lGKCFsYXN0UHJvcC0+aXNFbXB0eVNoYXBl
KCkgJiYgbGFzdFByb3AtPmhhc1Nsb3QoKSwKLSAgICAgICAgICAgICAgICAgICAgICAgICBsYXN0
UHJvcC0+c2xvdCA9PSBmaXhlZCAtIDEpOwotICAgICAgICAgICAgcmV2ZXJ0VG9GaXhlZFNsb3Rz
KGN4KTsKLSAgICAgICAgfQogICAgIH0KICAgICB1cGRhdGVTaGFwZShjeCk7CiAKICAgICAvKiBP
biB0aGUgd2F5IG91dCwgY29uc2lkZXIgc2hyaW5raW5nIHRhYmxlIGlmIGl0cyBsb2FkIGZhY3Rv
ciBpcyA8PSAuMjUuICovCiAgICAgaWYgKGxhc3RQcm9wLT5oYXNUYWJsZSgpKSB7CiAgICAgICAg
IFByb3BlcnR5VGFibGUgKnRhYmxlID0gbGFzdFByb3AtPmdldFRhYmxlKCk7CiAgICAgICAgIHVp
bnQzMiBzaXplID0gdGFibGUtPmNhcGFjaXR5KCk7CiAgICAgICAgIGlmIChzaXplID4gUHJvcGVy
dHlUYWJsZTo6TUlOX1NJWkUgJiYgdGFibGUtPmVudHJ5Q291bnQgPD0gc2l6ZSA+PiAyKSB7CkBA
IC0xMjQ5LDI0ICsxMjM3LDE2IEBAIEpTT2JqZWN0OjpjbGVhcihKU0NvbnRleHQgKmN4KQogICAg
ICAgICBKU19BU1NFUlQoaW5EaWN0aW9uYXJ5TW9kZSgpID09IHNoYXBlLT5pbkRpY3Rpb25hcnko
KSk7CiAgICAgfQogICAgIEpTX0FTU0VSVChzaGFwZS0+aXNFbXB0eVNoYXBlKCkpOwogCiAgICAg
aWYgKGluRGljdGlvbmFyeU1vZGUoKSkKICAgICAgICAgc2hhcGUtPmxpc3RwID0gJmxhc3RQcm9w
OwogCiAgICAgLyoKLSAgICAgKiBSZXZlcnQgdG8gZml4ZWQgc2xvdHMgaWYgd2UgaGF2ZSBjbGVh
cmVkIGJlbG93IHRoZSBmaXJzdCBkeW5hbWljYWxseQotICAgICAqIGFsbG9jYXRlZCBzbG90LCBw
cmVzZXJ2aW5nIGludmFyaWFudCB0aGF0IG9iamVjdHMgd2l0aCB0aGUgc2FtZSBzaGFwZQotICAg
ICAqIHVzZSB0aGUgZml4ZWQgc2xvdHMgaW4gdGhlIHNhbWUgd2F5LgotICAgICAqLwotICAgIGlm
IChoYXNTbG90c0FycmF5KCkgJiYgSlNTTE9UX0ZSRUUoZ2V0Q2xhc3MoKSkgPD0gbnVtRml4ZWRT
bG90cygpKQotICAgICAgICByZXZlcnRUb0ZpeGVkU2xvdHMoY3gpOwotCi0gICAgLyoKICAgICAg
KiBXZSBoYXZlIHJld291bmQgdG8gYSB1bmlxdWVseS1zaGFwZWQgZW1wdHkgc2NvcGUsIHNvIHdl
IGRvbid0IG5lZWQgYW4KICAgICAgKiBvdmVycmlkZSBmb3IgdGhpcyBvYmplY3QncyBzaGFwZS4K
ICAgICAgKi8KICAgICBjbGVhck93blNoYXBlKCk7CiAgICAgc2V0TWFwKHNoYXBlKTsKIAogICAg
IExlYXZlVHJhY2VJZkdsb2JhbE9iamVjdChjeCwgdGhpcyk7CiAgICAgSlNfQVRPTUlDX0lOQ1JF
TUVOVCgmY3gtPnJ1bnRpbWUtPnByb3BlcnR5UmVtb3ZhbHMpOwpkaWZmIC0tZ2l0IGEvanMvc3Jj
L2pzdHJhY2VyLmNwcCBiL2pzL3NyYy9qc3RyYWNlci5jcHAKLS0tIGEvanMvc3JjL2pzdHJhY2Vy
LmNwcAorKysgYi9qcy9zcmMvanN0cmFjZXIuY3BwCkBAIC0yNTgzLDMxICsyNTgzLDMxIEBAIFRy
YWNlUmVjb3JkZXI6OndfaW1tcElkR0MoanNpZCBpZCkKICAgICAgICAgdHJlZS0+Z2N0aGluZ3Mu
YWRkVW5pcXVlKElkVG9WYWx1ZShpZCkpOwogICAgIHJldHVybiB3LmltbXBOb25HQygodm9pZCop
SlNJRF9CSVRTKGlkKSk7CiB9CiAKIHB0cmRpZmZfdAogVHJhY2VSZWNvcmRlcjo6bmF0aXZlR2xv
YmFsU2xvdChjb25zdCBWYWx1ZSogcCkgY29uc3QKIHsKICAgICBKU19BU1NFUlQoaXNHbG9iYWwo
cCkpOwotICAgIHJldHVybiBwdHJkaWZmX3QocCAtIGdsb2JhbE9iai0+c2xvdHMpOworICAgIHJl
dHVybiBwdHJkaWZmX3QocCAtIGdsb2JhbE9iai0+c2xvdHMgKyBnbG9iYWxPYmotPm51bUZpeGVk
U2xvdHMoKSk7CiB9CiAKIC8qIERldGVybWluZSB0aGUgb2Zmc2V0IGluIHRoZSBuYXRpdmUgZ2xv
YmFsIGZyYW1lIGZvciBhIGpzdmFsIHdlIHRyYWNrLiAqLwogcHRyZGlmZl90CiBUcmFjZVJlY29y
ZGVyOjpuYXRpdmVHbG9iYWxPZmZzZXQoY29uc3QgVmFsdWUqIHApIGNvbnN0CiB7CiAgICAgcmV0
dXJuIG5hdGl2ZUdsb2JhbFNsb3QocCkgKiBzaXplb2YoZG91YmxlKTsKIH0KIAogLyogRGV0ZXJt
aW5lIHdoZXRoZXIgYSB2YWx1ZSBpcyBhIGdsb2JhbCBzdGFjayBzbG90LiAqLwogYm9vbAogVHJh
Y2VSZWNvcmRlcjo6aXNHbG9iYWwoY29uc3QgVmFsdWUqIHApIGNvbnN0CiB7Ci0gICAgcmV0dXJu
IChzaXplX3QocCAtIGdsb2JhbE9iai0+c2xvdHMpIDwgZ2xvYmFsT2JqLT5udW1TbG90cygpKTsK
KyAgICByZXR1cm4gKHNpemVfdChwIC0gZ2xvYmFsT2JqLT5zbG90cykgPCBnbG9iYWxPYmotPm51
bVNsb3RzKCkgLSBnbG9iYWxPYmotPm51bUZpeGVkU2xvdHMoKSk7CiB9CiAKIGJvb2wKIFRyYWNl
UmVjb3JkZXI6OmlzVm9pZFB0ckdsb2JhbChjb25zdCB2b2lkKiBwKSBjb25zdAogewogICAgIHJl
dHVybiBpc0dsb2JhbCgoY29uc3QgVmFsdWUgKilwKTsKIH0KIApAQCAtMzk0MCwyNiArMzk0MCwy
OSBAQCBUcmFjZVJlY29yZGVyOjprbm93bihKU09iamVjdCoqIHApCiAgKiBUaGlzIGZ1bmN0aW9u
IGNoZWNrIGZvciB0aGF0IGNvbmRpdGlvbiBhbmQgcmUtbWFwcyB0aGUgZW50cmllcyBvZiB0aGUg
dHJhY2tlcgogICogYWNjb3JkaW5nbHkuCiAgKi8KIEpTX1JFUVVJUkVTX1NUQUNLIHZvaWQKIFRy
YWNlUmVjb3JkZXI6OmNoZWNrRm9yR2xvYmFsT2JqZWN0UmVhbGxvY2F0aW9uSGVscGVyKCkKIHsK
ICAgICBkZWJ1Z19vbmx5X3ByaW50MChMQ19UTVRyYWNlciwgImdsb2JhbE9iai0+c2xvdHMgcmVs
b2NhdGVkLCB1cGRhdGluZyB0cmFja2VyXG4iKTsKICAgICBWYWx1ZSogc3JjID0gZ2xvYmFsX3Ns
b3RzOwotICAgIFZhbHVlKiBkc3QgPSBnbG9iYWxPYmotPmdldFNsb3RzKCk7CisgICAgVmFsdWUq
IGRzdCA9IGdsb2JhbE9iai0+Z2V0UmF3U2xvdHMoKTsKICAgICBqc3VpbnQgbGVuZ3RoID0gZ2xv
YmFsT2JqLT5jYXBhY2l0eTsKICAgICBMSW5zKiogbWFwID0gKExJbnMqKilhbGxvY2Eoc2l6ZW9m
KExJbnMqKSAqIGxlbmd0aCk7CiAgICAgZm9yIChqc3VpbnQgbiA9IDA7IG4gPCBsZW5ndGg7ICsr
bikgewotICAgICAgICBtYXBbbl0gPSB0cmFja2VyLmdldChzcmMpOwotICAgICAgICB0cmFja2Vy
LnNldChzcmMrKywgTlVMTCk7Ci0gICAgfQotICAgIGZvciAoanN1aW50IG4gPSAwOyBuIDwgbGVu
Z3RoOyArK24pCi0gICAgICAgIHRyYWNrZXIuc2V0KGRzdCsrLCBtYXBbbl0pOwotICAgIGdsb2Jh
bF9zbG90cyA9IGdsb2JhbE9iai0+Z2V0U2xvdHMoKTsKKyAgICAgICAgVmFsdWUgKnNsb3QgPSBn
bG9iYWxPYmotPmdldFJhd1Nsb3Qobiwgc3JjKTsKKyAgICAgICAgbWFwW25dID0gdHJhY2tlci5n
ZXQoc2xvdCk7CisgICAgICAgIHRyYWNrZXIuc2V0KHNsb3QsIE5VTEwpOworICAgIH0KKyAgICBm
b3IgKGpzdWludCBuID0gMDsgbiA8IGxlbmd0aDsgKytuKSB7CisgICAgICAgIFZhbHVlICpzbG90
ID0gZ2xvYmFsT2JqLT5nZXRSYXdTbG90KG4sIGRzdCk7CisgICAgICAgIHRyYWNrZXIuc2V0KHNs
b3QsIG1hcFtuXSk7CisgICAgfQorICAgIGdsb2JhbF9zbG90cyA9IGdsb2JhbE9iai0+Z2V0UmF3
U2xvdHMoKTsKIH0KIAogLyogRGV0ZXJtaW5lIHdoZXRoZXIgdGhlIGN1cnJlbnQgYnJhbmNoIGlz
IGEgbG9vcCBlZGdlICh0YWtlbiBvciBub3QgdGFrZW4pLiAqLwogc3RhdGljIEpTX1JFUVVJUkVT
X1NUQUNLIGJvb2wKIElzTG9vcEVkZ2UoanNieXRlY29kZSogcGMsIGpzYnl0ZWNvZGUqIGhlYWRl
cikKIHsKICAgICBzd2l0Y2ggKCpwYykgewogICAgICAgY2FzZSBKU09QX0lGRVE6CkBAIC05Njcw
LDMxICs5NjczLDMxIEBAIFRyYWNlUmVjb3JkZXI6OnN0b2JqX3NldF9kc2xvdChMSW5zICpvYmoK
IHZvaWQKIFRyYWNlUmVjb3JkZXI6OnN0b2JqX3NldF9zbG90KEpTT2JqZWN0ICpvYmosIExJbnMq
IG9ial9pbnMsIHVuc2lnbmVkIHNsb3QsIExJbnMqJiBzbG90c19pbnMsCiAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICBjb25zdCBWYWx1ZSAmdiwgTElucyogdl9pbnMpCiB7CiAgICAgLyoK
ICAgICAgKiBBIHNoYXBlIGd1YXJkIG11c3QgaGF2ZSBhbHJlYWR5IGJlZW4gZ2VuZXJhdGVkIGZv
ciBvYmosIHdoaWNoIHdpbGwKICAgICAgKiBlbnN1cmUgdGhhdCBmdXR1cmUgb2JqZWN0cyBoYXZl
IHRoZSBzYW1lIG51bWJlciBvZiBmaXhlZCBzbG90cy4KICAgICAgKi8KLSAgICBpZiAoIW9iai0+
aGFzU2xvdHNBcnJheSgpKSB7CisgICAgaWYgKG9iai0+aXNGaXhlZFNsb3Qoc2xvdCkpIHsKICAg
ICAgICAgSlNfQVNTRVJUKHNsb3QgPCBvYmotPm51bVNsb3RzKCkpOwogICAgICAgICBzdG9ial9z
ZXRfZnNsb3Qob2JqX2lucywgc2xvdCwgdiwgdl9pbnMpOwogICAgIH0gZWxzZSB7Ci0gICAgICAg
IHN0b2JqX3NldF9kc2xvdChvYmpfaW5zLCBzbG90LCBzbG90c19pbnMsIHYsIHZfaW5zKTsKKyAg
ICAgICAgc3RvYmpfc2V0X2RzbG90KG9ial9pbnMsIG9iai0+ZHluYW1pY1Nsb3RJbmRleChzbG90
KSwgc2xvdHNfaW5zLCB2LCB2X2lucyk7CiAgICAgfQogfQogCiBMSW5zKgogVHJhY2VSZWNvcmRl
cjo6dW5ib3hfc2xvdChKU09iamVjdCAqb2JqLCBMSW5zICpvYmpfaW5zLCB1aW50MzIgc2xvdCwg
Vk1TaWRlRXhpdCAqZXhpdCkKIHsKICAgICAvKiBTYW1lIGd1YXJhbnRlZSBhYm91dCBmaXhlZCBz
bG90cyBhcyBzdG9ial9zZXRfc2xvdC4gKi8KLSAgICBBZGRyZXNzIGFkZHIgPSAoIW9iai0+aGFz
U2xvdHNBcnJheSgpKQorICAgIEFkZHJlc3MgYWRkciA9IG9iai0+aXNGaXhlZFNsb3Qoc2xvdCkK
ICAgICAgICAgICAgICAgICAgPyAoQWRkcmVzcylGU2xvdHNBZGRyZXNzKG9ial9pbnMsIHNsb3Qp
Ci0gICAgICAgICAgICAgICAgIDogKEFkZHJlc3MpRFNsb3RzQWRkcmVzcyh3LmxkcE9ialNsb3Rz
KG9ial9pbnMpLCBzbG90KTsKKyAgICAgICAgICAgICAgICAgOiAoQWRkcmVzcylEU2xvdHNBZGRy
ZXNzKHcubGRwT2JqU2xvdHMob2JqX2lucyksIG9iai0+ZHluYW1pY1Nsb3RJbmRleChzbG90KSk7
CiAKICAgICByZXR1cm4gdW5ib3hfdmFsdWUob2JqLT5nZXRTbG90KHNsb3QpLCBhZGRyLCBleGl0
KTsKIH0KIAogI2lmIEpTX0JJVFNfUEVSX1dPUkQgPT0gMzIKIAogdm9pZAogVHJhY2VSZWNvcmRl
cjo6Ym94X3VuZGVmaW5lZF9pbnRvKEFkZHJlc3MgYWRkcikKQEAgLTEyMjM4LDE3ICsxMjI0MSwx
NyBAQCBUcmFjZVJlY29yZGVyOjpzZXRDYWxsUHJvcChKU09iamVjdCAqY2FsCiAgICAgICAgIH0K
IAogICAgICAgICAvLyBOb3cgYXNzZXJ0IHRoYXQgdGhlIHNob3J0aWQgZ2V0IHdlIGRpZCBhYm92
ZSB3YXMgb2suIEhhdmUgdG8gZG8gaXQKICAgICAgICAgLy8gYWZ0ZXIgdGhlIFJFVFVSTl9TVE9Q
IGFib3ZlLCBzaW5jZSBpbiB0aGF0IGNhc2Ugd2UgbWF5IGluIGZhY3Qgbm90CiAgICAgICAgIC8v
IGhhdmUgYSB2YWxpZCBzaG9ydGlkOyBidXQgd2UgZG9uJ3QgdXNlIGl0IGluIHRoYXQgY2FzZSBh
bnl3YXkuCiAgICAgICAgIEpTX0FTU0VSVChzaGFwZS0+aGFzU2hvcnRJRCgpKTsKIAogICAgICAg
ICBMSW5zKiBzbG90c19pbnMgPSBOVUxMOwotICAgICAgICBzdG9ial9zZXRfZHNsb3QoY2FsbG9i
al9pbnMsIHNsb3QsIHNsb3RzX2lucywgdiwgdl9pbnMpOworICAgICAgICBzdG9ial9zZXRfc2xv
dChjYWxsb2JqLCBjYWxsb2JqX2lucywgc2xvdCwgc2xvdHNfaW5zLCB2LCB2X2lucyk7CiAgICAg
ICAgIHJldHVybiBSRUNPUkRfQ09OVElOVUU7CiAgICAgfQogCiAgICAgLy8gVGhpcyBpcyB0aGUg
aGFyZCBjYXNlOiB3ZSBoYXZlIGEgSlNTdGFja0ZyYW1lIHByaXZhdGUsIGJ1dCBpdCdzIG5vdCBp
bgogICAgIC8vIHJhbmdlLiAgRHVyaW5nIHRyYWNlIGV4ZWN1dGlvbiB3ZSBtYXkgb3IgbWF5IG5v
dCBoYXZlIGEgSlNTdGFja0ZyYW1lCiAgICAgLy8gYW55bW9yZS4gIENhbGwgdGhlIHN0YW5kYXJk
IGJ1aWx0aW5zLCB3aGljaCBoYW5kbGUgdGhhdCBzaXR1YXRpb24uCiAKICAgICAvLyBTZXQgdmFy
aWFibGVzIGluIG9mZi10cmFjZS1zdGFjayBjYWxsIG9iamVjdHMgYnkgY2FsbGluZyBzdGFuZGFy
ZCBidWlsdGlucy4KZGlmZiAtLWdpdCBhL2pzL3NyYy9qc3RyYWNlci5oIGIvanMvc3JjL2pzdHJh
Y2VyLmgKLS0tIGEvanMvc3JjL2pzdHJhY2VyLmgKKysrIGIvanMvc3JjL2pzdHJhY2VyLmgKQEAg
LTEyMzYsMTcgKzEyMzYsMTcgQEAgY2xhc3MgVHJhY2VSZWNvcmRlcgogICAgIEpTX1JFUVVJUkVT
X1NUQUNLIGJvb2wga25vd24oY29uc3QgVmFsdWUqIHApOwogICAgIEpTX1JFUVVJUkVTX1NUQUNL
IGJvb2wga25vd24oSlNPYmplY3QqKiBwKTsKICAgICAvKgogICAgICAqIFRoZSBzbG90cyBvZiB0
aGUgZ2xvYmFsIG9iamVjdCBhcmUgc29tZXRpbWVzIHJlYWxsb2NhdGVkIGJ5IHRoZQogICAgICAq
IGludGVycHJldGVyLiAgVGhpcyBmdW5jdGlvbiBjaGVja3MgZm9yIHRoYXQgY29uZGl0aW9uIGFu
ZCByZS1tYXBzIHRoZQogICAgICAqIGVudHJpZXMgb2YgdGhlIHRyYWNrZXIgYWNjb3JkaW5nbHku
CiAgICAgICovCiAgICAgSlNfUkVRVUlSRVNfU1RBQ0sgdm9pZCBjaGVja0Zvckdsb2JhbE9iamVj
dFJlYWxsb2NhdGlvbigpIHsKLSAgICAgICAgaWYgKGdsb2JhbF9zbG90cyAhPSBnbG9iYWxPYmot
PmdldFNsb3RzKCkpCisgICAgICAgIGlmIChnbG9iYWxfc2xvdHMgIT0gZ2xvYmFsT2JqLT5nZXRS
YXdTbG90cygpKQogICAgICAgICAgICAgY2hlY2tGb3JHbG9iYWxPYmplY3RSZWFsbG9jYXRpb25I
ZWxwZXIoKTsKICAgICB9CiAgICAgSlNfUkVRVUlSRVNfU1RBQ0sgdm9pZCBjaGVja0Zvckdsb2Jh
bE9iamVjdFJlYWxsb2NhdGlvbkhlbHBlcigpOwogCiAgICAgSlNfUkVRVUlSRVNfU1RBQ0sgVHlw
ZUNvbnNlbnN1cyBzZWxmVHlwZVN0YWJpbGl0eShTbG90TWFwJiBzbWFwKTsKICAgICBKU19SRVFV
SVJFU19TVEFDSyBUeXBlQ29uc2Vuc3VzIHBlZXJUeXBlU3RhYmlsaXR5KFNsb3RNYXAmIHNtYXAs
IGNvbnN0IHZvaWQqIGlwLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgVHJlZUZyYWdtZW50KiogcGVlcik7CiAKQEAgLTE2MzQsMTcgKzE2MzQs
MTcgQEAgY2xhc3MgVHJhY2VSZWNvcmRlcgogCiAgICAgYm9vbCBnbG9iYWxTZXRFeHBlY3RlZCh1
bnNpZ25lZCBzbG90KSB7CiAgICAgICAgIHVuc2lnbmVkICpwaSA9IEZpbmQocGVuZGluZ0dsb2Jh
bFNsb3RzVG9TZXQsIHNsb3QpOwogICAgICAgICBpZiAocGkgPT0gcGVuZGluZ0dsb2JhbFNsb3Rz
VG9TZXQuZW5kKCkpIHsKICAgICAgICAgICAgIC8qCiAgICAgICAgICAgICAgKiBEbyBzbG90IGFy
aXRobWV0aWMgbWFudWFsbHkgdG8gYXZvaWQgZ2V0U2xvdFJlZiBhc3NlcnRpb25zIHdoaWNoCiAg
ICAgICAgICAgICAgKiBkbyBub3QgbmVlZCB0byBiZSBzYXRpc2ZpZWQgZm9yIHRoaXMgcHVycG9z
ZS4KICAgICAgICAgICAgICAqLwotICAgICAgICAgICAgVmFsdWUgKnZwID0gZ2xvYmFsT2JqLT5n
ZXRTbG90cygpICsgc2xvdDsKKyAgICAgICAgICAgIFZhbHVlICp2cCA9IGdsb2JhbE9iai0+Z2V0
UmF3U2xvdChzbG90LCBnbG9iYWxPYmotPmdldFJhd1Nsb3RzKCkpOwogCiAgICAgICAgICAgICAv
KiBJZiB0aGlzIGdsb2JhbCBpcyBkZWZpbml0ZWx5IGJlaW5nIHRyYWNrZWQsIHRoZW4gdGhlIHdy
aXRlIGlzIHVuZXhwZWN0ZWQuICovCiAgICAgICAgICAgICBpZiAodHJhY2tlci5oYXModnApKQog
ICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICAgICAgIAogICAgICAgICAgICAg
LyoKICAgICAgICAgICAgICAqIE90aGVyd2lzZSwgb25seSBhYm9ydCBpZiB0aGUgZ2xvYmFsIGlz
IG5vdCBwcmVzZW50IGluIHRoZQogICAgICAgICAgICAgICogaW1wb3J0IHR5cGVtYXAuIEp1c3Qg
ZGVlcCBhYm9ydGluZyBmYWxzZSBoZXJlIGlzIG5vdCBhY2NlcHRhYmxlLApkaWZmIC0tZ2l0IGEv
anMvc3JjL2pzd3JhcHBlci5jcHAgYi9qcy9zcmMvanN3cmFwcGVyLmNwcAotLS0gYS9qcy9zcmMv
anN3cmFwcGVyLmNwcAorKysgYi9qcy9zcmMvanN3cmFwcGVyLmNwcApAQCAtMzA4LDE2ICszMDgs
MjggQEAgSlNXcmFwcGVyOjpmdW5fdG9TdHJpbmcoSlNDb250ZXh0ICpjeCwgSgogfQogCiB2b2lk
CiBKU1dyYXBwZXI6OnRyYWNlKEpTVHJhY2VyICp0cmMsIEpTT2JqZWN0ICp3cmFwcGVyKQogewog
ICAgIE1hcmtPYmplY3QodHJjLCAqd3JhcHBlZE9iamVjdCh3cmFwcGVyKSwgIndyYXBwZWRPYmpl
Y3QiKTsKIH0KIAorSlNPYmplY3QgKgorSlNXcmFwcGVyOjp3cmFwcGVkT2JqZWN0KGNvbnN0IEpT
T2JqZWN0ICp3cmFwcGVyKQoreworICAgIHJldHVybiB3cmFwcGVyLT5nZXRQcm94eVByaXZhdGUo
KS50b09iamVjdE9yTnVsbCgpOworfQorCitKU1dyYXBwZXIgKgorSlNXcmFwcGVyOjp3cmFwcGVy
SGFuZGxlcihjb25zdCBKU09iamVjdCAqd3JhcHBlcikKK3sKKyAgICByZXR1cm4gc3RhdGljX2Nh
c3Q8SlNXcmFwcGVyICo+KHdyYXBwZXItPmdldFByb3h5SGFuZGxlcigpKTsKK30KKwogYm9vbAog
SlNXcmFwcGVyOjplbnRlcihKU0NvbnRleHQgKmN4LCBKU09iamVjdCAqd3JhcHBlciwganNpZCBp
ZCwgQWN0aW9uIGFjdCwgYm9vbCAqYnApCiB7CiAgICAgKmJwID0gdHJ1ZTsKICAgICByZXR1cm4g
dHJ1ZTsKIH0KIAogdm9pZApkaWZmIC0tZ2l0IGEvanMvc3JjL2pzd3JhcHBlci5oIGIvanMvc3Jj
L2pzd3JhcHBlci5oCi0tLSBhL2pzL3NyYy9qc3dyYXBwZXIuaAorKysgYi9qcy9zcmMvanN3cmFw
cGVyLmgKQEAgLTk2LDIyICs5NiwxOCBAQCBjbGFzcyBKU19GUklFTkRfQVBJKEpTV3JhcHBlcikg
OiBwdWJsaWMgCiAgICAgdmlydHVhbCBib29sIGVudGVyKEpTQ29udGV4dCAqY3gsIEpTT2JqZWN0
ICp3cmFwcGVyLCBqc2lkIGlkLCBBY3Rpb24gYWN0LCBib29sICpicCk7CiAgICAgdmlydHVhbCB2
b2lkIGxlYXZlKEpTQ29udGV4dCAqY3gsIEpTT2JqZWN0ICp3cmFwcGVyKTsKIAogICAgIHN0YXRp
YyBKU1dyYXBwZXIgc2luZ2xldG9uOwogCiAgICAgc3RhdGljIEpTT2JqZWN0ICpOZXcoSlNDb250
ZXh0ICpjeCwgSlNPYmplY3QgKm9iaiwgSlNPYmplY3QgKnByb3RvLCBKU09iamVjdCAqcGFyZW50
LAogICAgICAgICAgICAgICAgICAgICAgICAgIEpTV3JhcHBlciAqaGFuZGxlcik7CiAKLSAgICBz
dGF0aWMgaW5saW5lIEpTT2JqZWN0ICp3cmFwcGVkT2JqZWN0KGNvbnN0IEpTT2JqZWN0ICp3cmFw
cGVyKSB7Ci0gICAgICAgIHJldHVybiB3cmFwcGVyLT5nZXRQcm94eVByaXZhdGUoKS50b09iamVj
dE9yTnVsbCgpOwotICAgIH0KLSAgICBzdGF0aWMgaW5saW5lIEpTV3JhcHBlciAqd3JhcHBlckhh
bmRsZXIoY29uc3QgSlNPYmplY3QgKndyYXBwZXIpIHsKLSAgICAgICAgcmV0dXJuIHN0YXRpY19j
YXN0PEpTV3JhcHBlciAqPih3cmFwcGVyLT5nZXRQcm94eUhhbmRsZXIoKSk7Ci0gICAgfQorICAg
IHN0YXRpYyBKU09iamVjdCAqd3JhcHBlZE9iamVjdChjb25zdCBKU09iamVjdCAqd3JhcHBlcik7
CisgICAgc3RhdGljIEpTV3JhcHBlciAqd3JhcHBlckhhbmRsZXIoY29uc3QgSlNPYmplY3QgKndy
YXBwZXIpOwogCiAgICAgZW51bSB7CiAgICAgICAgIENST1NTX0NPTVBBUlRNRU5UID0gMSA8PCAw
LAogICAgICAgICBMQVNUX1VTRURfRkxBRyA9IENST1NTX0NPTVBBUlRNRU5UCiAgICAgfTsKIAog
ICAgIHN0YXRpYyB2b2lkICpnZXRXcmFwcGVyRmFtaWx5KCk7CiB9OwpkaWZmIC0tZ2l0IGEvanMv
c3JjL21ldGhvZGppdC9CYXNlQXNzZW1ibGVyLmggYi9qcy9zcmMvbWV0aG9kaml0L0Jhc2VBc3Nl
bWJsZXIuaAotLS0gYS9qcy9zcmMvbWV0aG9kaml0L0Jhc2VBc3NlbWJsZXIuaAorKysgYi9qcy9z
cmMvbWV0aG9kaml0L0Jhc2VBc3NlbWJsZXIuaApAQCAtMjQ4LDE5ICsyNDgsMjMgQEAgc3RhdGlj
IGNvbnN0IEpTQzo6TWFjcm9Bc3NlbWJsZXI6OlJlZ2lzdAogICAgICAgICByZXR1cm4gYnJhbmNo
UHRyKGNvbmQsIEFkZHJlc3MoZnVuLCBvZmZzZXRvZihKU09iamVjdCwgY2xhc3ApKSwKICAgICAg
ICAgICAgICAgICAgICAgICAgICBJbW1QdHIoJmpzX0Z1bmN0aW9uQ2xhc3MpKTsKICAgICB9CiAK
ICAgICAvKgogICAgICAqIEZpbmRzIGFuZCByZXR1cm5zIHRoZSBhZGRyZXNzIG9mIGEga25vd24g
b2JqZWN0IGFuZCBzbG90LgogICAgICAqLwogICAgIEFkZHJlc3Mgb2JqU2xvdFJlZihKU09iamVj
dCAqb2JqLCBSZWdpc3RlcklEIHJlZywgdWludDMyIHNsb3QpIHsKLSAgICAgICAgbW92ZShJbW1Q
dHIoJm9iai0+c2xvdHMpLCByZWcpOwotICAgICAgICBsb2FkUHRyKHJlZywgcmVnKTsKLSAgICAg
ICAgcmV0dXJuIEFkZHJlc3MocmVnLCBzbG90ICogc2l6ZW9mKFZhbHVlKSk7CisgICAgICAgIG1v
dmUoSW1tUHRyKG9iaiksIHJlZyk7CisgICAgICAgIGlmIChvYmotPmlzRml4ZWRTbG90KHNsb3Qp
KSB7CisgICAgICAgICAgICByZXR1cm4gQWRkcmVzcyhyZWcsIEpTT2JqZWN0OjpnZXRGaXhlZFNs
b3RPZmZzZXQoc2xvdCkpOworICAgICAgICB9IGVsc2UgeworICAgICAgICAgICAgbG9hZFB0cihB
ZGRyZXNzKHJlZywgSlNPYmplY3Q6Om9mZnNldE9mU2xvdHMoKSksIHJlZyk7CisgICAgICAgICAg
ICByZXR1cm4gQWRkcmVzcyhyZWcsIG9iai0+ZHluYW1pY1Nsb3RJbmRleChzbG90KSAqIHNpemVv
ZihWYWx1ZSkpOworICAgICAgICB9CiAgICAgfQogCiAjaWZkZWYgSlNfQ1BVX1g4NgogICAgIHZv
aWQgaWRpdihSZWdpc3RlcklEIHJlZykgewogICAgICAgICBtX2Fzc2VtYmxlci5jZHEoKTsKICAg
ICAgICAgbV9hc3NlbWJsZXIuaWRpdmxfcihyZWcpOwogICAgIH0KICNlbmRpZgpAQCAtNjYwLDE3
ICs2NjQsMTcgQEAgc3RhdGljIGNvbnN0IEpTQzo6TWFjcm9Bc3NlbWJsZXI6OlJlZ2lzdAogICAg
IEZhc3RBcnJheUxvYWRGYWlscyBmYXN0QXJyYXlMb2FkKFJlZ2lzdGVySUQgb2JqUmVnLCBjb25z
dCBJbnQzMktleSAma2V5LAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFJl
Z2lzdGVySUQgdHlwZVJlZywgUmVnaXN0ZXJJRCBkYXRhUmVnKSB7CiAgICAgICAgIEpTX0FTU0VS
VChvYmpSZWcgIT0gdHlwZVJlZyk7CiAKICAgICAgICAgRmFzdEFycmF5TG9hZEZhaWxzIGZhaWxz
OwogICAgICAgICBmYWlscy5yYW5nZUNoZWNrID0gZ3VhcmRBcnJheUNhcGFjaXR5KG9ialJlZywg
a2V5KTsKIAogICAgICAgICBSZWdpc3RlcklEIGRzbG90c1JlZyA9IG9ialJlZzsKLSAgICAgICAg
bG9hZFB0cihBZGRyZXNzKG9ialJlZywgb2Zmc2V0b2YoSlNPYmplY3QsIHNsb3RzKSksIGRzbG90
c1JlZyk7CisgICAgICAgIGxvYWRQdHIoQWRkcmVzcyhvYmpSZWcsIEpTT2JqZWN0OjpvZmZzZXRP
ZlNsb3RzKCkpLCBkc2xvdHNSZWcpOwogCiAgICAgICAgIC8vIExvYWQgdGhlIHNsb3Qgb3V0IG9m
IHRoZSBhcnJheS4KICAgICAgICAgaWYgKGtleS5pc0NvbnN0YW50KCkpIHsKICAgICAgICAgICAg
IEFkZHJlc3Mgc2xvdChvYmpSZWcsIGtleS5pbmRleCgpICogc2l6ZW9mKFZhbHVlKSk7CiAgICAg
ICAgICAgICBmYWlscy5ob2xlQ2hlY2sgPSBmYXN0QXJyYXlMb2FkU2xvdChzbG90LCB0eXBlUmVn
LCBkYXRhUmVnKTsKICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgIEJhc2VJbmRleCBzbG90
KG9ialJlZywga2V5LnJlZygpLCBKU1ZBTF9TQ0FMRSk7CiAgICAgICAgICAgICBmYWlscy5ob2xl
Q2hlY2sgPSBmYXN0QXJyYXlMb2FkU2xvdChzbG90LCB0eXBlUmVnLCBkYXRhUmVnKTsKQEAgLTY5
MywzMiArNjk3LDQwIEBAIHN0YXRpYyBjb25zdCBKU0M6Ok1hY3JvQXNzZW1ibGVyOjpSZWdpc3QK
IAogICAgIHZvaWQgcmVtYXRQYXlsb2FkKGNvbnN0IFN0YXRlUmVtYXQgJnJlbWF0LCBSZWdpc3Rl
cklEIHJlZykgewogICAgICAgICBpZiAocmVtYXQuaW5NZW1vcnkoKSkKICAgICAgICAgICAgIGxv
YWRQYXlsb2FkKHJlbWF0LmFkZHJlc3MoKSwgcmVnKTsKICAgICAgICAgZWxzZQogICAgICAgICAg
ICAgbW92ZShyZW1hdC5yZWcoKSwgcmVnKTsKICAgICB9CiAKLSAgICB2b2lkIGxvYWREeW5hbWlj
U2xvdChSZWdpc3RlcklEIG9ialJlZywgdWludDMyIHNsb3QsCisgICAgdm9pZCBsb2FkRHluYW1p
Y1Nsb3QoUmVnaXN0ZXJJRCBvYmpSZWcsIHVpbnQzMiBpbmRleCwKICAgICAgICAgICAgICAgICAg
ICAgICAgICBSZWdpc3RlcklEIHR5cGVSZWcsIFJlZ2lzdGVySUQgZGF0YVJlZykgewotICAgICAg
ICBsb2FkUHRyKEFkZHJlc3Mob2JqUmVnLCBvZmZzZXRvZihKU09iamVjdCwgc2xvdHMpKSwgZGF0
YVJlZyk7Ci0gICAgICAgIGxvYWRWYWx1ZUFzQ29tcG9uZW50cyhBZGRyZXNzKGRhdGFSZWcsIHNs
b3QgKiBzaXplb2YoVmFsdWUpKSwgdHlwZVJlZywgZGF0YVJlZyk7CisgICAgICAgIGxvYWRQdHIo
QWRkcmVzcyhvYmpSZWcsIEpTT2JqZWN0OjpvZmZzZXRPZlNsb3RzKCkpLCBkYXRhUmVnKTsKKyAg
ICAgICAgbG9hZFZhbHVlQXNDb21wb25lbnRzKEFkZHJlc3MoZGF0YVJlZywgaW5kZXggKiBzaXpl
b2YoVmFsdWUpKSwgdHlwZVJlZywgZGF0YVJlZyk7CiAgICAgfQogCiAgICAgdm9pZCBsb2FkT2Jq
UHJvcChKU09iamVjdCAqb2JqLCBSZWdpc3RlcklEIG9ialJlZywKICAgICAgICAgICAgICAgICAg
ICAgIGNvbnN0IGpzOjpTaGFwZSAqc2hhcGUsCiAgICAgICAgICAgICAgICAgICAgICBSZWdpc3Rl
cklEIHR5cGVSZWcsIFJlZ2lzdGVySUQgZGF0YVJlZykKICAgICB7CiAgICAgICAgIGlmIChzaGFw
ZS0+aXNNZXRob2QoKSkKICAgICAgICAgICAgIGxvYWRWYWx1ZUFzQ29tcG9uZW50cyhPYmplY3RW
YWx1ZShzaGFwZS0+bWV0aG9kT2JqZWN0KCkpLCB0eXBlUmVnLCBkYXRhUmVnKTsKLSAgICAgICAg
ZWxzZSBpZiAob2JqLT5oYXNTbG90c0FycmF5KCkpCi0gICAgICAgICAgICBsb2FkRHluYW1pY1Ns
b3Qob2JqUmVnLCBzaGFwZS0+c2xvdCwgdHlwZVJlZywgZGF0YVJlZyk7CisgICAgICAgIGVsc2Ug
aWYgKG9iai0+aXNGaXhlZFNsb3Qoc2hhcGUtPnNsb3QpKQorICAgICAgICAgICAgbG9hZElubGlu
ZVNsb3Qob2JqUmVnLCBzaGFwZS0+c2xvdCwgdHlwZVJlZywgZGF0YVJlZyk7CiAgICAgICAgIGVs
c2UKLSAgICAgICAgICAgIGxvYWRJbmxpbmVTbG90KG9ialJlZywgc2hhcGUtPnNsb3QsIHR5cGVS
ZWcsIGRhdGFSZWcpOworICAgICAgICAgICAgbG9hZER5bmFtaWNTbG90KG9ialJlZywgb2JqLT5k
eW5hbWljU2xvdEluZGV4KHNoYXBlLT5zbG90KSwgdHlwZVJlZywgZGF0YVJlZyk7CisgICAgfQor
CisgICAgQWRkcmVzcyBvYmpQcm9wQWRkcmVzcyhKU09iamVjdCAqb2JqLCBSZWdpc3RlcklEIG9i
alJlZywgdWludDMyIHNsb3QpCisgICAgeworICAgICAgICBpZiAob2JqLT5pc0ZpeGVkU2xvdChz
bG90KSkKKyAgICAgICAgICAgIHJldHVybiBBZGRyZXNzKG9ialJlZywgSlNPYmplY3Q6OmdldEZp
eGVkU2xvdE9mZnNldChzbG90KSk7CisgICAgICAgIGxvYWRQdHIoQWRkcmVzcyhvYmpSZWcsIEpT
T2JqZWN0OjpvZmZzZXRPZlNsb3RzKCkpLCBvYmpSZWcpOworICAgICAgICByZXR1cm4gQWRkcmVz
cyhvYmpSZWcsIG9iai0+ZHluYW1pY1Nsb3RJbmRleChzbG90KSAqIHNpemVvZihWYWx1ZSkpOwog
ICAgIH0KIAogICAgIHN0YXRpYyB1aW50MzIgbWFza0FkZHJlc3MoQWRkcmVzcyBhZGRyZXNzKSB7
CiAgICAgICAgIHJldHVybiBSZWdpc3RlcnM6Om1hc2tSZWcoYWRkcmVzcy5iYXNlKTsKICAgICB9
CiAKICAgICBzdGF0aWMgdWludDMyIG1hc2tBZGRyZXNzKEJhc2VJbmRleCBhZGRyZXNzKSB7CiAg
ICAgICAgIHJldHVybiBSZWdpc3RlcnM6Om1hc2tSZWcoYWRkcmVzcy5iYXNlKSB8CmRpZmYgLS1n
aXQgYS9qcy9zcmMvbWV0aG9kaml0L0NvbXBpbGVyLmNwcCBiL2pzL3NyYy9tZXRob2RqaXQvQ29t
cGlsZXIuY3BwCi0tLSBhL2pzL3NyYy9tZXRob2RqaXQvQ29tcGlsZXIuY3BwCisrKyBiL2pzL3Ny
Yy9tZXRob2RqaXQvQ29tcGlsZXIuY3BwCkBAIC0xODUwLDE4ICsxODUwLDE3IEBAIG1qaXQ6OkNv
bXBpbGVyOjpnZW5lcmF0ZU1ldGhvZCgpCiAgICAgICAgICAgICB1aW50TiBpbmRleCA9IEdFVF9V
SU5UMTYoUEMpOwogCiAgICAgICAgICAgICAvLyBMb2FkIHRoZSBjYWxsZWUncyBwYXlsb2FkIGlu
dG8gYSByZWdpc3Rlci4KICAgICAgICAgICAgIGZyYW1lLnB1c2hDYWxsZWUoKTsKICAgICAgICAg
ICAgIFJlZ2lzdGVySUQgcmVnID0gZnJhbWUuY29weURhdGFJbnRvUmVnKGZyYW1lLnBlZWsoLTEp
KTsKICAgICAgICAgICAgIGZyYW1lLnBvcCgpOwogCiAgICAgICAgICAgICAvLyBvYmotPmdldEZs
YXRDbG9zdXJlVXB2YXJzKCkKLSAgICAgICAgICAgIG1hc20ubG9hZFB0cihBZGRyZXNzKHJlZywg
b2Zmc2V0b2YoSlNPYmplY3QsIHNsb3RzKSksIHJlZyk7Ci0gICAgICAgICAgICBBZGRyZXNzIHVw
dmFyQWRkcmVzcyhyZWcsIEpTT2JqZWN0OjpKU1NMT1RfRkxBVF9DTE9TVVJFX1VQVkFSUyAqIHNp
emVvZihWYWx1ZSkpOworICAgICAgICAgICAgQWRkcmVzcyB1cHZhckFkZHJlc3MocmVnLCBKU09i
amVjdDo6Z2V0RmxhdENsb3N1cmVVcHZhcnNPZmZzZXQoKSk7CiAgICAgICAgICAgICBtYXNtLmxv
YWRQcml2YXRlKHVwdmFyQWRkcmVzcywgcmVnKTsKICAgICAgICAgICAgIC8vIHB1c2ggKChWYWx1
ZSAqKSByZWcpW2luZGV4XQogICAgICAgICAgICAgZnJhbWUuZnJlZVJlZyhyZWcpOwogICAgICAg
ICAgICAgZnJhbWUucHVzaChBZGRyZXNzKHJlZywgaW5kZXggKiBzaXplb2YoVmFsdWUpKSk7CiAg
ICAgICAgICAgICBpZiAob3AgPT0gSlNPUF9DQUxMRkNTTE9UKQogICAgICAgICAgICAgICAgIGZy
YW1lLnB1c2goVW5kZWZpbmVkVmFsdWUoKSk7CiAgICAgICAgICAgfQogICAgICAgICAgIEVORF9D
QVNFKEpTT1BfQ0FMTEZDU0xPVCkKZGlmZiAtLWdpdCBhL2pzL3NyYy9tZXRob2RqaXQvRmFzdE9w
cy5jcHAgYi9qcy9zcmMvbWV0aG9kaml0L0Zhc3RPcHMuY3BwCi0tLSBhL2pzL3NyYy9tZXRob2Rq
aXQvRmFzdE9wcy5jcHAKKysrIGIvanMvc3JjL21ldGhvZGppdC9GYXN0T3BzLmNwcApAQCAtMTgw
NCwyMSArMTgwNCwyMSBAQCBtaml0OjpDb21waWxlcjo6anNvcF9pbml0cHJvcCgpCiAjaWZkZWYg
REVCVUcKICAgICBpbnQgcmVzID0KICNlbmRpZgogICAgIGpzX0xvb2t1cFByb3BlcnR5V2l0aEZs
YWdzKGN4LCBiYXNlb2JqLCBBVE9NX1RPX0pTSUQoYXRvbSksCiAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgSlNSRVNPTFZFX1FVQUxJRklFRCwgJmhvbGRlciwgJnByb3ApOwogICAgIEpT
X0FTU0VSVChyZXMgPj0gMCAmJiBwcm9wICYmIGhvbGRlciA9PSBiYXNlb2JqKTsKIAogICAgIFJl
Z2lzdGVySUQgb2JqUmVnID0gZnJhbWUuY29weURhdGFJbnRvUmVnKG9iaik7Ci0gICAgbWFzbS5s
b2FkUHRyKEFkZHJlc3Mob2JqUmVnLCBvZmZzZXRvZihKU09iamVjdCwgc2xvdHMpKSwgb2JqUmVn
KTsKIAogICAgIC8qIFBlcmZvcm0gdGhlIHN0b3JlLiAqLwogICAgIFNoYXBlICpzaGFwZSA9IChT
aGFwZSAqKSBwcm9wOwotICAgIGZyYW1lLnN0b3JlVG8oZmUsIEFkZHJlc3Mob2JqUmVnLCBzaGFw
ZS0+c2xvdCAqIHNpemVvZihWYWx1ZSkpKTsKKyAgICBBZGRyZXNzIGFkZHJlc3MgPSBtYXNtLm9i
alByb3BBZGRyZXNzKGJhc2VvYmosIG9ialJlZywgc2hhcGUtPnNsb3QpOworICAgIGZyYW1lLnN0
b3JlVG8oZmUsIGFkZHJlc3MpOwogICAgIGZyYW1lLmZyZWVSZWcob2JqUmVnKTsKIH0KIAogdm9p
ZAogbWppdDo6Q29tcGlsZXI6Ompzb3BfaW5pdGVsZW0oKQogewogICAgIEZyYW1lRW50cnkgKm9i
aiA9IGZyYW1lLnBlZWsoLTMpOwogICAgIEZyYW1lRW50cnkgKmlkID0gZnJhbWUucGVlaygtMik7
CmRpZmYgLS1naXQgYS9qcy9zcmMvbWV0aG9kaml0L01vbm9JQy5jcHAgYi9qcy9zcmMvbWV0aG9k
aml0L01vbm9JQy5jcHAKLS0tIGEvanMvc3JjL21ldGhvZGppdC9Nb25vSUMuY3BwCisrKyBiL2pz
L3NyYy9tZXRob2RqaXQvTW9ub0lDLmNwcApAQCAtOTksMTggKzk5LDE5IEBAIGljOjpHZXRHbG9i
YWxOYW1lKFZNRnJhbWUgJmYsIGljOjpHZXRHbG8KICAgICB9CiAgICAgdWludDMyIHNsb3QgPSBz
aGFwZS0+c2xvdDsKIAogICAgIC8qIFBhdGNoIHNoYXBlIGd1YXJkLiAqLwogICAgIFJlcGF0Y2hl
ciByZXBhdGNoZXIoZi5qaXQoKSk7CiAgICAgcmVwYXRjaGVyLnJlcGF0Y2goaWMtPmZhc3RQYXRo
U3RhcnQuZGF0YUxhYmVsMzJBdE9mZnNldChpYy0+c2hhcGVPZmZzZXQpLCBvYmotPnNoYXBlKCkp
OwogCiAgICAgLyogUGF0Y2ggbG9hZHMuICovCisgICAgdWludDMyIGluZGV4ID0gb2JqLT5keW5h
bWljU2xvdEluZGV4KHNsb3QpOwogICAgIEpTQzo6Q29kZUxvY2F0aW9uTGFiZWwgbGFiZWwgPSBp
Yy0+ZmFzdFBhdGhTdGFydC5sYWJlbEF0T2Zmc2V0KGljLT5sb2FkU3RvcmVPZmZzZXQpOwotICAg
IHJlcGF0Y2hlci5wYXRjaEFkZHJlc3NPZmZzZXRGb3JWYWx1ZUxvYWQobGFiZWwsIHNsb3QgKiBz
aXplb2YoVmFsdWUpKTsKKyAgICByZXBhdGNoZXIucGF0Y2hBZGRyZXNzT2Zmc2V0Rm9yVmFsdWVM
b2FkKGxhYmVsLCBpbmRleCAqIHNpemVvZihWYWx1ZSkpOwogCiAgICAgLyogRG8gbG9hZCBhbnl3
YXkuLi4gdGhpcyB0aW1lLiAqLwogICAgIHN0dWJzOjpHZXRHbG9iYWxOYW1lKGYpOwogfQogCiB0
ZW1wbGF0ZSA8SlNCb29sIHN0cmljdD4KIHN0YXRpYyB2b2lkIEpTX0ZBU1RDQUxMCiBEaXNhYmxl
ZFNldEdsb2JhbChWTUZyYW1lICZmLCBpYzo6U2V0R2xvYmFsTmFtZUlDICppYykKQEAgLTE2Niwx
OSArMTY3LDIwIEBAIFNldEdsb2JhbE5hbWVJQzo6cGF0Y2hJbmxpbmVTaGFwZUd1YXJkKFIKIAog
c3RhdGljIExvb2t1cFN0YXR1cwogVXBkYXRlU2V0R2xvYmFsTmFtZVN0dWIoVk1GcmFtZSAmZiwg
aWM6OlNldEdsb2JhbE5hbWVJQyAqaWMsIEpTT2JqZWN0ICpvYmosIGNvbnN0IFNoYXBlICpzaGFw
ZSkKIHsKICAgICBSZXBhdGNoZXIgcmVwYXRjaGVyKGljLT5leHRyYVN0dWIpOwogCiAgICAgaWMt
PnBhdGNoRXh0cmFTaGFwZUd1YXJkKHJlcGF0Y2hlciwgb2JqLT5zaGFwZSgpKTsKIAorICAgIHVp
bnQzMiBpbmRleCA9IG9iai0+ZHluYW1pY1Nsb3RJbmRleChzaGFwZS0+c2xvdCk7CiAgICAgSlND
OjpDb2RlTG9jYXRpb25MYWJlbCBsYWJlbChKU0M6Ok1hY3JvQXNzZW1ibGVyQ29kZVB0cihpYy0+
ZXh0cmFTdHViLnN0YXJ0KCkpKTsKICAgICBsYWJlbCA9IGxhYmVsLmxhYmVsQXRPZmZzZXQoaWMt
PmV4dHJhU3RvcmVPZmZzZXQpOwotICAgIHJlcGF0Y2hlci5wYXRjaEFkZHJlc3NPZmZzZXRGb3JW
YWx1ZVN0b3JlKGxhYmVsLCBzaGFwZS0+c2xvdCAqIHNpemVvZihWYWx1ZSksCisgICAgcmVwYXRj
aGVyLnBhdGNoQWRkcmVzc09mZnNldEZvclZhbHVlU3RvcmUobGFiZWwsIGluZGV4ICogc2l6ZW9m
KFZhbHVlKSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBp
Yy0+dnIuaXNUeXBlS25vd24oKSk7CiAKICAgICByZXR1cm4gTG9va3VwX0NhY2hlYWJsZTsKIH0K
IAogc3RhdGljIExvb2t1cFN0YXR1cwogQXR0YWNoU2V0R2xvYmFsTmFtZVN0dWIoVk1GcmFtZSAm
ZiwgaWM6OlNldEdsb2JhbE5hbWVJQyAqaWMsIEpTT2JqZWN0ICpvYmosIGNvbnN0IFNoYXBlICpz
aGFwZSkKIHsKQEAgLTE5NSwzMCArMTk3LDMxIEBAIEF0dGFjaFNldEdsb2JhbE5hbWVTdHViKFZN
RnJhbWUgJmYsIGljOjoKICAgICAgICAgbWFzbS5tb3ZlKEltbVB0cihvYmopLCBpYy0+b2JqUmVn
KTsKIAogICAgIEpTX0FTU0VSVChvYmotPmJyYW5kZWQoKSk7CiAKICAgICAvKgogICAgICAqIExv
YWQgb2JqLT5zbG90cy4gSWYgaWMtPm9iakNvbnN0LCB0aGVuIHRoaXMgY2xvYmJlcnMgb2JqUmVn
LCBiZWNhdXNlCiAgICAgICogaWMtPm9ialJlZyA9PSBpYy0+c2hhcGVSZWcuCiAgICAgICovCi0g
ICAgbWFzbS5sb2FkUHRyKEFkZHJlc3MoaWMtPm9ialJlZywgb2Zmc2V0b2YoSlNPYmplY3QsIHNs
b3RzKSksIGljLT5zaGFwZVJlZyk7CisgICAgSlNfQVNTRVJUKCFvYmotPmlzRml4ZWRTbG90KHNo
YXBlLT5zbG90KSk7CisgICAgbWFzbS5sb2FkUHRyKEFkZHJlc3MoaWMtPm9ialJlZywgSlNPYmpl
Y3Q6Om9mZnNldE9mU2xvdHMoKSksIGljLT5zaGFwZVJlZyk7CiAKICAgICAvKiBUZXN0IGlmIG92
ZXJ3cml0aW5nIGEgZnVuY3Rpb24tdGFnZ2VkIHNsb3QuICovCi0gICAgQWRkcmVzcyBzbG90KGlj
LT5zaGFwZVJlZywgc2l6ZW9mKFZhbHVlKSAqIHNoYXBlLT5zbG90KTsKKyAgICBBZGRyZXNzIHNs
b3QoaWMtPnNoYXBlUmVnLCBzaXplb2YoVmFsdWUpICogb2JqLT5keW5hbWljU2xvdEluZGV4KHNo
YXBlLT5zbG90KSk7CiAgICAgSnVtcCBpc05vdE9iamVjdCA9IG1hc20udGVzdE9iamVjdChBc3Nl
bWJsZXI6Ok5vdEVxdWFsLCBzbG90KTsKIAogICAgIC8qIE5vdywgdGVzdCBpZiB0aGUgb2JqZWN0
IGlzIGEgZnVuY3Rpb24gb2JqZWN0LiAqLwogICAgIG1hc20ubG9hZFBheWxvYWQoc2xvdCwgaWMt
PnNoYXBlUmVnKTsKICAgICBKdW1wIGlzRnVuID0gbWFzbS50ZXN0RnVuY3Rpb24oQXNzZW1ibGVy
OjpFcXVhbCwgaWMtPnNoYXBlUmVnKTsKIAogICAgIC8qIFJlc3RvcmUgc2hhcGVSZWcgdG8gb2Jq
LT5zbG90cywgc2luY2Ugd2UgY2xvYmJlcmVkIGl0LiAqLwogICAgIGlmIChpYy0+b2JqQ29uc3Qp
CiAgICAgICAgIG1hc20ubW92ZShJbW1QdHIob2JqKSwgaWMtPm9ialJlZyk7Ci0gICAgbWFzbS5s
b2FkUHRyKEFkZHJlc3MoaWMtPm9ialJlZywgb2Zmc2V0b2YoSlNPYmplY3QsIHNsb3RzKSksIGlj
LT5zaGFwZVJlZyk7CisgICAgbWFzbS5sb2FkUHRyKEFkZHJlc3MoaWMtPm9ialJlZywgSlNPYmpl
Y3Q6Om9mZnNldE9mU2xvdHMoKSksIGljLT5zaGFwZVJlZyk7CiAKICAgICAvKiBJZiB0aGUgb2Jq
ZWN0IHRlc3QgZmFpbHMsIHNoYXBlUmVnIGlzIHN0aWxsIG9iai0+c2xvdHMuICovCiAgICAgaXNO
b3RPYmplY3QubGlua1RvKG1hc20ubGFiZWwoKSwgJm1hc20pOwogICAgIERhdGFMYWJlbDMyIHN0
b3JlID0gbWFzbS5zdG9yZVZhbHVlV2l0aEFkZHJlc3NPZmZzZXRQYXRjaChpYy0+dnIsIHNsb3Qp
OwogCiAgICAgSnVtcCBkb25lID0gbWFzbS5qdW1wKCk7CiAKICAgICBKSVRTY3JpcHQgKmppdCA9
IGYuaml0KCk7CkBAIC0zMDAsMTggKzMwMywxOSBAQCBVcGRhdGVTZXRHbG9iYWxOYW1lKFZNRnJh
bWUgJmYsIGljOjpTZXRHCiAKICAgICAgICAgcmV0dXJuIEF0dGFjaFNldEdsb2JhbE5hbWVTdHVi
KGYsIGljLCBvYmosIHNoYXBlKTsKICAgICB9CiAKICAgICAvKiBPYmplY3QgaXMgbm90IGJyYW5k
ZWQsIHNvIHdlIGNhbiB1c2UgdGhlIGlubGluZSBwYXRoLiAqLwogICAgIFJlcGF0Y2hlciByZXBh
dGNoZXIoZi5qaXQoKSk7CiAgICAgaWMtPnBhdGNoSW5saW5lU2hhcGVHdWFyZChyZXBhdGNoZXIs
IG9iai0+c2hhcGUoKSk7CiAKKyAgICB1aW50MzIgaW5kZXggPSBvYmotPmR5bmFtaWNTbG90SW5k
ZXgoc2hhcGUtPnNsb3QpOwogICAgIEpTQzo6Q29kZUxvY2F0aW9uTGFiZWwgbGFiZWwgPSBpYy0+
ZmFzdFBhdGhTdGFydC5sYWJlbEF0T2Zmc2V0KGljLT5sb2FkU3RvcmVPZmZzZXQpOwotICAgIHJl
cGF0Y2hlci5wYXRjaEFkZHJlc3NPZmZzZXRGb3JWYWx1ZVN0b3JlKGxhYmVsLCBzaGFwZS0+c2xv
dCAqIHNpemVvZihWYWx1ZSksCisgICAgcmVwYXRjaGVyLnBhdGNoQWRkcmVzc09mZnNldEZvclZh
bHVlU3RvcmUobGFiZWwsIGluZGV4ICogc2l6ZW9mKFZhbHVlKSwKICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpYy0+dnIuaXNUeXBlS25vd24oKSk7CiAKICAg
ICByZXR1cm4gTG9va3VwX0NhY2hlYWJsZTsKIH0KIAogdm9pZCBKU19GQVNUQ0FMTAogaWM6OlNl
dEdsb2JhbE5hbWUoVk1GcmFtZSAmZiwgaWM6OlNldEdsb2JhbE5hbWVJQyAqaWMpCiB7CmRpZmYg
LS1naXQgYS9qcy9zcmMvbWV0aG9kaml0L1BvbHlJQy5jcHAgYi9qcy9zcmMvbWV0aG9kaml0L1Bv
bHlJQy5jcHAKLS0tIGEvanMvc3JjL21ldGhvZGppdC9Qb2x5SUMuY3BwCisrKyBiL2pzL3NyYy9t
ZXRob2RqaXQvUG9seUlDLmNwcApAQCAtMjA2LDQyICsyMDYsNDIgQEAgY2xhc3MgU2V0UHJvcENv
bXBpbGVyIDogcHVibGljIFBJQ1N0dWJDbwogICAgICAgICAgICAgICAgICAgICAgICAgICBpbnQz
MihKU09iamVjdE1hcDo6SU5WQUxJRF9TSEFQRSkpOwogICAgICAgICByZXBhdGNoZXIucmVsaW5r
KGxhYmVscy5nZXRJbmxpbmVTaGFwZUp1bXAocGljLmZhc3RQYXRoU3RhcnQubGFiZWxBdE9mZnNl
dChwaWMuc2hhcGVHdWFyZCkpLAogICAgICAgICAgICAgICAgICAgICAgICAgIHBpYy5zbG93UGF0
aFN0YXJ0KTsKIAogICAgICAgICBGdW5jdGlvblB0ciB0YXJnZXQoSlNfRlVOQ19UT19EQVRBX1BU
Uih2b2lkICosIGljOjpTZXRQcm9wKSk7CiAgICAgICAgIHJlcGF0Y2hlci5yZWxpbmsocGljLnNs
b3dQYXRoQ2FsbCwgdGFyZ2V0KTsKICAgICB9CiAKLSAgICBMb29rdXBTdGF0dXMgcGF0Y2hJbmxp
bmUoY29uc3QgU2hhcGUgKnNoYXBlLCBib29sIGlubGluZVNsb3QpCisgICAgTG9va3VwU3RhdHVz
IHBhdGNoSW5saW5lKGNvbnN0IFNoYXBlICpzaGFwZSkKICAgICB7CiAgICAgICAgIEpTX0FTU0VS
VCghcGljLmlubGluZVBhdGhQYXRjaGVkKTsKICAgICAgICAgSmFlZ2VyU3BldyhKU3Bld19QSUNz
LCAicGF0Y2ggc2V0cHJvcCBpbmxpbmUgYXQgJXBcbiIsIHBpYy5mYXN0UGF0aFN0YXJ0LmV4ZWN1
dGFibGVBZGRyZXNzKCkpOwogCiAgICAgICAgIFJlcGF0Y2hlciByZXBhdGNoZXIoZi5qaXQoKSk7
CiAgICAgICAgIFNldFByb3BMYWJlbHMgJmxhYmVscyA9IHBpYy5zZXRQcm9wTGFiZWxzKCk7CiAK
ICAgICAgICAgaW50MzIgb2Zmc2V0OwotICAgICAgICBpZiAoaW5saW5lU2xvdCkgeworICAgICAg
ICBpZiAob2JqLT5pc0ZpeGVkU2xvdChzaGFwZS0+c2xvdCkpIHsKICAgICAgICAgICAgIENvZGVM
b2NhdGlvbkluc3RydWN0aW9uIGlzdHIgPSBsYWJlbHMuZ2V0RHNsb3RzTG9hZChwaWMuZmFzdFBh
dGhSZWpvaW4sIHBpYy51LnZyKTsKICAgICAgICAgICAgIHJlcGF0Y2hlci5yZXBhdGNoTG9hZFB0
clRvTEVBKGlzdHIpOwogCiAgICAgICAgICAgICAvLyAKICAgICAgICAgICAgIC8vIFdlJ3ZlIHBh
dGNoZWQgfCBtb3YgZHNsb3RzLCBbb2JqICsgRFNMT1RTX09GRlNFVF0KICAgICAgICAgICAgIC8v
IFRvOiAgICAgICAgICAgfCBsZWEgZnNsb3RzLCBbb2JqICsgRFNMT1RTX09GRlNFVF0KICAgICAg
ICAgICAgIC8vCiAgICAgICAgICAgICAvLyBCZWNhdXNlIHRoZSBvZmZzZXQgaXMgd3JvbmcsIGl0
J3MgbmVjZXNzYXJ5IHRvIGNvcnJlY3QgaXQKICAgICAgICAgICAgIC8vIGJlbG93LgogICAgICAg
ICAgICAgLy8KICAgICAgICAgICAgIGludDMyIGRpZmYgPSBpbnQzMihKU09iamVjdDo6Z2V0Rml4
ZWRTbG90T2Zmc2V0KDApKSAtCi0gICAgICAgICAgICAgICAgICAgICAgICAgaW50MzIob2Zmc2V0
b2YoSlNPYmplY3QsIHNsb3RzKSk7CisgICAgICAgICAgICAgICAgICAgICAgICAgaW50MzIoSlNP
YmplY3Q6Om9mZnNldE9mU2xvdHMoKSk7CiAgICAgICAgICAgICBKU19BU1NFUlQoZGlmZiAhPSAw
KTsKICAgICAgICAgICAgIG9mZnNldCAgPSAoaW50MzIoc2hhcGUtPnNsb3QpICogc2l6ZW9mKFZh
bHVlKSkgKyBkaWZmOwogICAgICAgICB9IGVsc2UgewotICAgICAgICAgICAgb2Zmc2V0ID0gc2hh
cGUtPnNsb3QgKiBzaXplb2YoVmFsdWUpOworICAgICAgICAgICAgb2Zmc2V0ID0gb2JqLT5keW5h
bWljU2xvdEluZGV4KHNoYXBlLT5zbG90KSAqIHNpemVvZihWYWx1ZSk7CiAgICAgICAgIH0KIAog
ICAgICAgICByZXBhdGNoZXIucmVwYXRjaChsYWJlbHMuZ2V0SW5saW5lU2hhcGVEYXRhKHBpYy5m
YXN0UGF0aFN0YXJ0LCBwaWMuc2hhcGVHdWFyZCksCiAgICAgICAgICAgICAgICAgICAgICAgICAg
IG9iai0+c2hhcGUoKSk7CiAgICAgICAgIHJlcGF0Y2hlci5wYXRjaEFkZHJlc3NPZmZzZXRGb3JW
YWx1ZVN0b3JlKGxhYmVscy5nZXRJbmxpbmVWYWx1ZVN0b3JlKHBpYy5mYXN0UGF0aFJlam9pbiwK
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgcGljLnUudnIpLAogICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICBvZmZzZXQsIHBpYy51LnZyLmlzVHlwZUtub3duKCkp
OwogCkBAIC0yNjcsMTcgKzI2NywxNyBAQCBjbGFzcyBTZXRQcm9wQ29tcGlsZXIgOiBwdWJsaWMg
UElDU3R1YkNvCiAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICBDb2RlTG9jYXRpb25MYWJl
bCBzaGFwZUd1YXJkID0gbGFiZWwubGFiZWxBdE9mZnNldChwaWMuc2hhcGVHdWFyZCk7CiAgICAg
ICAgICAgICByZXBhdGNoZXIucmVsaW5rKHBpYy5zZXRQcm9wTGFiZWxzKCkuZ2V0SW5saW5lU2hh
cGVKdW1wKHNoYXBlR3VhcmQpLCBjcyk7CiAgICAgICAgIH0KICAgICAgICAgaWYgKGludCBzZWNv
bmRHdWFyZE9mZnNldCA9IGdldExhc3RTdHViU2Vjb25kU2hhcGVHdWFyZCgpKQogICAgICAgICAg
ICAgcmVwYXRjaGVyLnJlbGluayhsYWJlbC5qdW1wQXRPZmZzZXQoc2Vjb25kR3VhcmRPZmZzZXQp
LCBjcyk7CiAgICAgfQogCi0gICAgTG9va3VwU3RhdHVzIGdlbmVyYXRlU3R1Yih1aW50MzIgaW5p
dGlhbFNoYXBlLCBjb25zdCBTaGFwZSAqc2hhcGUsIGJvb2wgYWRkaW5nLCBib29sIGlubGluZVNs
b3QpCisgICAgTG9va3VwU3RhdHVzIGdlbmVyYXRlU3R1Yih1aW50MzIgaW5pdGlhbFNoYXBlLCBj
b25zdCBTaGFwZSAqc2hhcGUsIGJvb2wgYWRkaW5nKQogICAgIHsKICAgICAgICAgLyogRXhpdHMg
dG8gdGhlIHNsb3cgcGF0aC4gKi8KICAgICAgICAgVmVjdG9yPEp1bXAsIDg+IHNsb3dFeGl0cyhj
eCk7CiAgICAgICAgIFZlY3RvcjxKdW1wLCA4PiBvdGhlckd1YXJkcyhjeCk7CiAKICAgICAgICAg
QXNzZW1ibGVyIG1hc207CiAKICAgICAgICAgLy8gU2hhcGUgZ3VhcmQuCkBAIC0zMjcsMzEgKzMy
NywzMSBAQCBjbGFzcyBTZXRQcm9wQ29tcGlsZXIgOiBwdWJsaWMgUElDU3R1YkNvCiAgICAgICAg
ICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAgSnVtcCBtaXNtYXRjaGVkRnVu
Y3Rpb24gPQogICAgICAgICAgICAgICAgICAgICAgICAgbWFzbS5icmFuY2hQdHIoQXNzZW1ibGVy
OjpOb3RFcXVhbCwgcGljLnUudnIuZGF0YVJlZygpLCBJbW1QdHIoZnVub2JqKSk7CiAgICAgICAg
ICAgICAgICAgICAgIGlmICghc2xvd0V4aXRzLmFwcGVuZChtaXNtYXRjaGVkRnVuY3Rpb24pKQog
ICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGVycm9yKCk7CiAgICAgICAgICAgICAgICAg
fQogICAgICAgICAgICAgfQogCi0gICAgICAgICAgICBpZiAoaW5saW5lU2xvdCkgeworICAgICAg
ICAgICAgaWYgKG9iai0+aXNGaXhlZFNsb3Qoc2hhcGUtPnNsb3QpKSB7CiAgICAgICAgICAgICAg
ICAgQWRkcmVzcyBhZGRyZXNzKHBpYy5vYmpSZWcsCiAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgIEpTT2JqZWN0OjpnZXRGaXhlZFNsb3RPZmZzZXQoc2hhcGUtPnNsb3QpKTsKICAgICAg
ICAgICAgICAgICBtYXNtLnN0b3JlVmFsdWUocGljLnUudnIsIGFkZHJlc3MpOwogICAgICAgICAg
ICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAvKiBDaGVjayBjYXBhY2l0eS4gKi8KICAgICAg
ICAgICAgICAgICBBZGRyZXNzIGNhcGFjaXR5KHBpYy5vYmpSZWcsIG9mZnNldG9mKEpTT2JqZWN0
LCBjYXBhY2l0eSkpOwogICAgICAgICAgICAgICAgIG1hc20ubG9hZDMyKG1hc20ucGF5bG9hZE9m
KGNhcGFjaXR5KSwgcGljLnNoYXBlUmVnKTsKICAgICAgICAgICAgICAgICBKdW1wIG92ZXJDYXBh
Y2l0eSA9IG1hc20uYnJhbmNoMzIoQXNzZW1ibGVyOjpMZXNzVGhhbk9yRXF1YWwsIHBpYy5zaGFw
ZVJlZywKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
SW1tMzIoc2hhcGUtPnNsb3QpKTsKICAgICAgICAgICAgICAgICBpZiAoIXNsb3dFeGl0cy5hcHBl
bmQob3ZlckNhcGFjaXR5KSkKICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGVycm9yKCk7CiAK
LSAgICAgICAgICAgICAgICBtYXNtLmxvYWRQdHIoQWRkcmVzcyhwaWMub2JqUmVnLCBvZmZzZXRv
ZihKU09iamVjdCwgc2xvdHMpKSwgcGljLnNoYXBlUmVnKTsKLSAgICAgICAgICAgICAgICBBZGRy
ZXNzIGFkZHJlc3MocGljLnNoYXBlUmVnLCBzaGFwZS0+c2xvdCAqIHNpemVvZihWYWx1ZSkpOwor
ICAgICAgICAgICAgICAgIG1hc20ubG9hZFB0cihBZGRyZXNzKHBpYy5vYmpSZWcsIEpTT2JqZWN0
OjpvZmZzZXRPZlNsb3RzKCkpLCBwaWMuc2hhcGVSZWcpOworICAgICAgICAgICAgICAgIEFkZHJl
c3MgYWRkcmVzcyhwaWMuc2hhcGVSZWcsIG9iai0+ZHluYW1pY1Nsb3RJbmRleChzaGFwZS0+c2xv
dCkgKiBzaXplb2YoVmFsdWUpKTsKICAgICAgICAgICAgICAgICBtYXNtLnN0b3JlVmFsdWUocGlj
LnUudnIsIGFkZHJlc3MpOwogICAgICAgICAgICAgfQogCiAgICAgICAgICAgICB1aW50MzIgbmV3
U2hhcGUgPSBvYmotPnNoYXBlKCk7CiAgICAgICAgICAgICBKU19BU1NFUlQobmV3U2hhcGUgIT0g
aW5pdGlhbFNoYXBlKTsKIAogICAgICAgICAgICAgLyogV3JpdGUgdGhlIG9iamVjdCdzIG5ldyBz
aGFwZS4gKi8KICAgICAgICAgICAgIG1hc20uc3RvcmVQdHIoSW1tUHRyKHNoYXBlKSwgQWRkcmVz
cyhwaWMub2JqUmVnLCBvZmZzZXRvZihKU09iamVjdCwgbGFzdFByb3ApKSk7CkBAIC0zNjIsMjEg
KzM2MiwxNyBAQCBjbGFzcyBTZXRQcm9wQ29tcGlsZXIgOiBwdWJsaWMgUElDU3R1YkNvCiAgICAg
ICAgICAgICAgICAgQWRkcmVzcyBmbGFncyhwaWMub2JqUmVnLCBvZmZzZXRvZihKU09iamVjdCwg
ZmxhZ3MpKTsKIAogICAgICAgICAgICAgICAgIC8qIFVzZSBzaGFwZVJlZyB0byBsb2FkLCBiaXR3
aXNlLW9yLCBhbmQgc3RvcmUgZmxhZ3MuICovCiAgICAgICAgICAgICAgICAgbWFzbS5sb2FkMzIo
ZmxhZ3MsIHBpYy5zaGFwZVJlZyk7CiAgICAgICAgICAgICAgICAgbWFzbS5vcjMyKEltbTMyKEpT
T2JqZWN0OjpNRVRIT0RfQkFSUklFUiksIHBpYy5zaGFwZVJlZyk7CiAgICAgICAgICAgICAgICAg
bWFzbS5zdG9yZTMyKHBpYy5zaGFwZVJlZywgZmxhZ3MpOwogICAgICAgICAgICAgfQogICAgICAg
ICB9IGVsc2UgaWYgKHNoYXBlLT5oYXNEZWZhdWx0U2V0dGVyKCkpIHsKLSAgICAgICAgICAgIEFk
ZHJlc3MgYWRkcmVzcyhwaWMub2JqUmVnLCBKU09iamVjdDo6Z2V0Rml4ZWRTbG90T2Zmc2V0KHNo
YXBlLT5zbG90KSk7Ci0gICAgICAgICAgICBpZiAoIWlubGluZVNsb3QpIHsKLSAgICAgICAgICAg
ICAgICBtYXNtLmxvYWRQdHIoQWRkcmVzcyhwaWMub2JqUmVnLCBvZmZzZXRvZihKU09iamVjdCwg
c2xvdHMpKSwgcGljLm9ialJlZyk7Ci0gICAgICAgICAgICAgICAgYWRkcmVzcyA9IEFkZHJlc3Mo
cGljLm9ialJlZywgc2hhcGUtPnNsb3QgKiBzaXplb2YoVmFsdWUpKTsKLSAgICAgICAgICAgIH0K
KyAgICAgICAgICAgIEFkZHJlc3MgYWRkcmVzcyA9IG1hc20ub2JqUHJvcEFkZHJlc3Mob2JqLCBw
aWMub2JqUmVnLCBzaGFwZS0+c2xvdCk7CiAKICAgICAgICAgICAgIC8vIElmIHRoZSBzY29wZSBp
cyBicmFuZGVkLCBvciBoYXMgYSBtZXRob2QgYmFycmllci4gSXQncyBub3cgbmVjZXNzYXJ5CiAg
ICAgICAgICAgICAvLyB0byBndWFyZCB0aGF0IHdlJ3JlIG5vdCBvdmVyd3JpdGluZyBhIGZ1bmN0
aW9uLXZhbHVlZCBwcm9wZXJ0eS4KICAgICAgICAgICAgIGlmIChvYmotPmJyYW5kZWRPckhhc01l
dGhvZEJhcnJpZXIoKSkgewogICAgICAgICAgICAgICAgIG1hc20ubG9hZFR5cGVUYWcoYWRkcmVz
cywgcGljLnNoYXBlUmVnKTsKICAgICAgICAgICAgICAgICBKdW1wIHNraXAgPSBtYXNtLnRlc3RP
YmplY3QoQXNzZW1ibGVyOjpOb3RFcXVhbCwgcGljLnNoYXBlUmVnKTsKICAgICAgICAgICAgICAg
ICBtYXNtLmxvYWRQYXlsb2FkKGFkZHJlc3MsIHBpYy5zaGFwZVJlZyk7CiAgICAgICAgICAgICAg
ICAgSnVtcCByZWJyYW5kID0gbWFzbS50ZXN0RnVuY3Rpb24oQXNzZW1ibGVyOjpFcXVhbCwgcGlj
LnNoYXBlUmVnKTsKQEAgLTQwOSwyMCArNDA1LDIxIEBAIGNsYXNzIFNldFByb3BDb21waWxlciA6
IHB1YmxpYyBQSUNTdHViQ28KICAgICAgICAgICAgICAgICBtYXNtLnN0b3JlVmFsdWUocGljLnUu
dnIsIGFkZHIpOwogICAgICAgICAgICAgICAgIHNraXBPdmVyID0gbWFzbS5qdW1wKCk7CiAgICAg
ICAgICAgICB9CiAKICAgICAgICAgICAgIGVzY2FwZWRGcmFtZS5saW5rVG8obWFzbS5sYWJlbCgp
LCAmbWFzbSk7CiAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgaWYgKHNoYXBlLT5zZXR0
ZXJPcCgpID09IFNldENhbGxWYXIpCiAgICAgICAgICAgICAgICAgICAgIHNsb3QgKz0gZnVuLT5u
YXJnczsKLSAgICAgICAgICAgICAgICBtYXNtLmxvYWRQdHIoQWRkcmVzcyhwaWMub2JqUmVnLCBv
ZmZzZXRvZihKU09iamVjdCwgc2xvdHMpKSwgcGljLm9ialJlZyk7Ci0KLSAgICAgICAgICAgICAg
ICBBZGRyZXNzIGRzbG90KHBpYy5vYmpSZWcsIChzbG90ICsgSlNPYmplY3Q6OkNBTExfUkVTRVJW
RURfU0xPVFMpICogc2l6ZW9mKFZhbHVlKSk7Ci0gICAgICAgICAgICAgICAgbWFzbS5zdG9yZVZh
bHVlKHBpYy51LnZyLCBkc2xvdCk7CisKKyAgICAgICAgICAgICAgICBzbG90ICs9IEpTT2JqZWN0
OjpDQUxMX1JFU0VSVkVEX1NMT1RTOworICAgICAgICAgICAgICAgIEFkZHJlc3MgYWRkcmVzcyA9
IG1hc20ub2JqUHJvcEFkZHJlc3Mob2JqLCBwaWMub2JqUmVnLCBzbG90KTsKKworICAgICAgICAg
ICAgICAgIG1hc20uc3RvcmVWYWx1ZShwaWMudS52ciwgYWRkcmVzcyk7CiAgICAgICAgICAgICB9
CiAKICAgICAgICAgICAgIHBpYy5zaGFwZVJlZ0hhc0Jhc2VTaGFwZSA9IGZhbHNlOwogICAgICAg
ICB9CiAKICAgICAgICAgSnVtcCBkb25lID0gbWFzbS5qdW1wKCk7CiAKICAgICAgICAgLy8gQ29t
bW9uIGFsbCBzZWNvbmRhcnkgZ3VhcmRzIGludG8gb25lIGJpZyBleGl0LgpAQCAtNTkyLDE3ICs1
ODksMTcgQEAgY2xhc3MgU2V0UHJvcENvbXBpbGVyIDogcHVibGljIFBJQ1N0dWJDbwogICAgICAg
ICAgICAgICogRG9pbmcgdGhpcyB3b3VsZCBjYXVzZSB1cyB0byB3YWxrIGRvd24gdGhpcyBzYW1l
IHVwZGF0ZSBwYXRoCiAgICAgICAgICAgICAgKiBldmVyeSB0aW1lIGEgcmVhbGxvY2F0aW9uIGlz
IG5lZWRlZCwgaG93ZXZlciwgd2hpY2ggd2lsbAogICAgICAgICAgICAgICogdXN1YWxseSBiZSBh
IHNsb3dkb3duIGV2ZW4gaWYgdGhlcmUgKmFyZSogb3RoZXIgc2hhcGVzIHRoYXQKICAgICAgICAg
ICAgICAqIGRvbid0IHJlYWxsb2MuCiAgICAgICAgICAgICAgKi8KICAgICAgICAgICAgIGlmIChv
YmotPm51bVNsb3RzKCkgIT0gc2xvdHMpCiAgICAgICAgICAgICAgICAgcmV0dXJuIGRpc2FibGUo
Imluc3VmZmljaWVudCBzbG90IGNhcGFjaXR5Iik7CiAKLSAgICAgICAgICAgIHJldHVybiBnZW5l
cmF0ZVN0dWIoaW5pdGlhbFNoYXBlLCBzaGFwZSwgdHJ1ZSwgIW9iai0+aGFzU2xvdHNBcnJheSgp
KTsKKyAgICAgICAgICAgIHJldHVybiBnZW5lcmF0ZVN0dWIoaW5pdGlhbFNoYXBlLCBzaGFwZSwg
dHJ1ZSk7CiAgICAgICAgIH0KIAogICAgICAgICBjb25zdCBTaGFwZSAqc2hhcGUgPSAoY29uc3Qg
U2hhcGUgKikgcHJvcDsKICAgICAgICAgaWYgKHBpYy5raW5kID09IGljOjpQSUNJbmZvOjpTRVRN
RVRIT0QgJiYgIXNoYXBlLT5pc01ldGhvZCgpKQogICAgICAgICAgICAgcmV0dXJuIGRpc2FibGUo
InNldCBtZXRob2Qgb24gbm9uLW1ldGhvZCBzaGFwZSIpOwogICAgICAgICBpZiAoIXNoYXBlLT53
cml0YWJsZSgpKQogICAgICAgICAgICAgcmV0dXJuIGRpc2FibGUoInJlYWRvbmx5Iik7CiAKQEAg
LTYxOCwyMCArNjE1LDIwIEBAIGNsYXNzIFNldFByb3BDb21waWxlciA6IHB1YmxpYyBQSUNTdHVi
Q28KICAgICAgICAgICAgIH0KICAgICAgICAgfQogCiAgICAgICAgIEpTX0FTU0VSVChvYmogPT0g
aG9sZGVyKTsKICAgICAgICAgaWYgKCFwaWMuaW5saW5lUGF0aFBhdGNoZWQgJiYKICAgICAgICAg
ICAgICFvYmotPmJyYW5kZWRPckhhc01ldGhvZEJhcnJpZXIoKSAmJgogICAgICAgICAgICAgc2hh
cGUtPmhhc0RlZmF1bHRTZXR0ZXIoKSAmJgogICAgICAgICAgICAgIW9iai0+aXNEZW5zZUFycmF5
KCkpIHsKLSAgICAgICAgICAgIHJldHVybiBwYXRjaElubGluZShzaGFwZSwgIW9iai0+aGFzU2xv
dHNBcnJheSgpKTsKLSAgICAgICAgfSAKLQotICAgICAgICByZXR1cm4gZ2VuZXJhdGVTdHViKG9i
ai0+c2hhcGUoKSwgc2hhcGUsIGZhbHNlLCAhb2JqLT5oYXNTbG90c0FycmF5KCkpOworICAgICAg
ICAgICAgcmV0dXJuIHBhdGNoSW5saW5lKHNoYXBlKTsKKyAgICAgICAgfQorCisgICAgICAgIHJl
dHVybiBnZW5lcmF0ZVN0dWIob2JqLT5zaGFwZSgpLCBzaGFwZSwgZmFsc2UpOwogICAgIH0KIH07
CiAKIHN0YXRpYyBib29sCiBJc0NhY2hlYWJsZVByb3RvQ2hhaW4oSlNPYmplY3QgKm9iaiwgSlNP
YmplY3QgKmhvbGRlcikKIHsKICAgICB3aGlsZSAob2JqICE9IGhvbGRlcikgewogICAgICAgICBK
U09iamVjdCAqcHJvdG8gPSBvYmotPmdldFByb3RvKCk7CkBAIC03NjQsMTkgKzc2MSwxNyBAQCBj
bGFzcyBHZXRQcm9wQ29tcGlsZXIgOiBwdWJsaWMgUElDU3R1YkNvCiAgICAgfQogCiAgICAgTG9v
a3VwU3RhdHVzIGdlbmVyYXRlQXJnc0xlbmd0aFN0dWIoKQogICAgIHsKICAgICAgICAgQXNzZW1i
bGVyIG1hc207CiAKICAgICAgICAgSnVtcCBub3RBcmdzID0gbWFzbS50ZXN0T2JqQ2xhc3MoQXNz
ZW1ibGVyOjpOb3RFcXVhbCwgcGljLm9ialJlZywgb2JqLT5nZXRDbGFzcygpKTsKIAotICAgICAg
ICBtYXNtLmxvYWRQdHIoQWRkcmVzcyhwaWMub2JqUmVnLCBvZmZzZXRvZihKU09iamVjdCwgc2xv
dHMpKSwgcGljLm9ialJlZyk7Ci0gICAgICAgIG1hc20ubG9hZDMyKEFkZHJlc3MocGljLm9ialJl
ZywgSlNPYmplY3Q6OkpTU0xPVF9BUkdTX0xFTkdUSCAqIHNpemVvZihWYWx1ZSkpLAotICAgICAg
ICAgICAgICAgICAgICBwaWMub2JqUmVnKTsKKyAgICAgICAgbWFzbS5sb2FkMzIoQWRkcmVzcyhw
aWMub2JqUmVnLCBKU09iamVjdDo6Z2V0QXJndW1lbnRzTGVuZ3RoT2Zmc2V0KCkpLCBwaWMub2Jq
UmVnKTsKICAgICAgICAgbWFzbS5tb3ZlKHBpYy5vYmpSZWcsIHBpYy5zaGFwZVJlZyk7CiAgICAg
ICAgIEp1bXAgb3ZlcnJpZGRlbiA9IG1hc20uYnJhbmNoVGVzdDMyKEFzc2VtYmxlcjo6Tm9uWmVy
bywgcGljLnNoYXBlUmVnLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICBJbW0zMihKU09iamVjdDo6QVJHU19MRU5HVEhfT1ZFUlJJRERFTl9CSVQpKTsKICAgICAg
ICAgbWFzbS5yc2hpZnQzMihJbW0zMihKU09iamVjdDo6QVJHU19QQUNLRURfQklUU19DT1VOVCks
IHBpYy5vYmpSZWcpOwogICAgICAgICAKICAgICAgICAgbWFzbS5tb3ZlKEltbVR5cGUoSlNWQUxf
VFlQRV9JTlQzMiksIHBpYy5zaGFwZVJlZyk7CiAgICAgICAgIEp1bXAgZG9uZSA9IG1hc20uanVt
cCgpOwogCkBAIC04NDIsMTkgKzgzNywxOSBAQCBjbGFzcyBHZXRQcm9wQ29tcGlsZXIgOiBwdWJs
aWMgUElDU3R1YkNvCiAgICAgICAgIHJldHVybiBMb29rdXBfQ2FjaGVhYmxlOwogICAgIH0KIAog
ICAgIExvb2t1cFN0YXR1cyBnZW5lcmF0ZVN0cmluZ09iakxlbmd0aFN0dWIoKQogICAgIHsKICAg
ICAgICAgQXNzZW1ibGVyIG1hc207CiAKICAgICAgICAgSnVtcCBub3RTdHJpbmdPYmogPSBtYXNt
LnRlc3RPYmpDbGFzcyhBc3NlbWJsZXI6Ok5vdEVxdWFsLCBwaWMub2JqUmVnLCBvYmotPmdldENs
YXNzKCkpOwotICAgICAgICBtYXNtLmxvYWRQdHIoQWRkcmVzcyhwaWMub2JqUmVnLCBvZmZzZXRv
ZihKU09iamVjdCwgc2xvdHMpKSwgcGljLm9ialJlZyk7Ci0gICAgICAgIG1hc20ubG9hZFBheWxv
YWQoQWRkcmVzcyhwaWMub2JqUmVnLCBKU09iamVjdDo6SlNTTE9UX1BSSU1JVElWRV9USElTICog
c2l6ZW9mKFZhbHVlKSksCi0gICAgICAgICAgICAgICAgICAgICAgICAgcGljLm9ialJlZyk7CisK
KworICAgICAgICBtYXNtLmxvYWRQYXlsb2FkKEFkZHJlc3MocGljLm9ialJlZywgSlNPYmplY3Q6
OmdldFByaW1pdGl2ZVRoaXNPZmZzZXQoKSksIHBpYy5vYmpSZWcpOwogICAgICAgICBtYXNtLmxv
YWRQdHIoQWRkcmVzcyhwaWMub2JqUmVnLCBKU1N0cmluZzo6b2Zmc2V0T2ZMZW5ndGhBbmRGbGFn
cygpKSwgcGljLm9ialJlZyk7CiAgICAgICAgIG1hc20udXJzaGlmdDMyKEltbTMyKEpTU3RyaW5n
OjpMRU5HVEhfU0hJRlQpLCBwaWMub2JqUmVnKTsKICAgICAgICAgbWFzbS5tb3ZlKEltbVR5cGUo
SlNWQUxfVFlQRV9JTlQzMiksIHBpYy5zaGFwZVJlZyk7CiAgICAgICAgIEp1bXAgZG9uZSA9IG1h
c20uanVtcCgpOwogCiAgICAgICAgIFBJQ0xpbmtlciBidWZmZXIobWFzbSwgcGljKTsKICAgICAg
ICAgaWYgKCFidWZmZXIuaW5pdChjeCkpCiAgICAgICAgICAgICByZXR1cm4gZXJyb3IoKTsKQEAg
LTk5NSwzMyArOTkwLDMzIEBAIGNsYXNzIEdldFByb3BDb21waWxlciA6IHB1YmxpYyBQSUNTdHVi
Q28KIAogICAgIExvb2t1cFN0YXR1cyBwYXRjaElubGluZShKU09iamVjdCAqaG9sZGVyLCBjb25z
dCBTaGFwZSAqc2hhcGUpCiAgICAgewogICAgICAgICBzcGV3KCJwYXRjaCIsICJpbmxpbmUiKTsK
ICAgICAgICAgUmVwYXRjaGVyIHJlcGF0Y2hlcihmLmppdCgpKTsKICAgICAgICAgR2V0UHJvcExh
YmVscyAmbGFiZWxzID0gcGljLmdldFByb3BMYWJlbHMoKTsKIAogICAgICAgICBpbnQzMiBvZmZz
ZXQ7Ci0gICAgICAgIGlmICghaG9sZGVyLT5oYXNTbG90c0FycmF5KCkpIHsKKyAgICAgICAgaWYg
KGhvbGRlci0+aXNGaXhlZFNsb3Qoc2hhcGUtPnNsb3QpKSB7CiAgICAgICAgICAgICBDb2RlTG9j
YXRpb25JbnN0cnVjdGlvbiBpc3RyID0gbGFiZWxzLmdldERzbG90c0xvYWQocGljLmZhc3RQYXRo
UmVqb2luKTsKICAgICAgICAgICAgIHJlcGF0Y2hlci5yZXBhdGNoTG9hZFB0clRvTEVBKGlzdHIp
OwogCiAgICAgICAgICAgICAvLyAKICAgICAgICAgICAgIC8vIFdlJ3ZlIHBhdGNoZWQgfCBtb3Yg
ZHNsb3RzLCBbb2JqICsgRFNMT1RTX09GRlNFVF0KICAgICAgICAgICAgIC8vIFRvOiAgICAgICAg
ICAgfCBsZWEgZnNsb3RzLCBbb2JqICsgRFNMT1RTX09GRlNFVF0KICAgICAgICAgICAgIC8vCiAg
ICAgICAgICAgICAvLyBCZWNhdXNlIHRoZSBvZmZzZXQgaXMgd3JvbmcsIGl0J3MgbmVjZXNzYXJ5
IHRvIGNvcnJlY3QgaXQKICAgICAgICAgICAgIC8vIGJlbG93LgogICAgICAgICAgICAgLy8KICAg
ICAgICAgICAgIGludDMyIGRpZmYgPSBpbnQzMihKU09iamVjdDo6Z2V0Rml4ZWRTbG90T2Zmc2V0
KDApKSAtCi0gICAgICAgICAgICAgICAgICAgICAgICAgaW50MzIob2Zmc2V0b2YoSlNPYmplY3Qs
IHNsb3RzKSk7CisgICAgICAgICAgICAgICAgICAgICAgICAgaW50MzIoSlNPYmplY3Q6Om9mZnNl
dE9mU2xvdHMoKSk7CiAgICAgICAgICAgICBKU19BU1NFUlQoZGlmZiAhPSAwKTsKICAgICAgICAg
ICAgIG9mZnNldCAgPSAoaW50MzIoc2hhcGUtPnNsb3QpICogc2l6ZW9mKFZhbHVlKSkgKyBkaWZm
OwogICAgICAgICB9IGVsc2UgewotICAgICAgICAgICAgb2Zmc2V0ID0gc2hhcGUtPnNsb3QgKiBz
aXplb2YoVmFsdWUpOworICAgICAgICAgICAgb2Zmc2V0ID0gaG9sZGVyLT5keW5hbWljU2xvdElu
ZGV4KHNoYXBlLT5zbG90KSAqIHNpemVvZihWYWx1ZSk7CiAgICAgICAgIH0KIAogICAgICAgICBy
ZXBhdGNoZXIucmVwYXRjaChsYWJlbHMuZ2V0SW5saW5lU2hhcGVEYXRhKHBpYy5nZXRGYXN0U2hh
cGVHdWFyZCgpKSwgb2JqLT5zaGFwZSgpKTsKICAgICAgICAgcmVwYXRjaGVyLnBhdGNoQWRkcmVz
c09mZnNldEZvclZhbHVlTG9hZChsYWJlbHMuZ2V0VmFsdWVMb2FkKHBpYy5mYXN0UGF0aFJlam9p
biksIG9mZnNldCk7CiAKICAgICAgICAgcGljLmlubGluZVBhdGhQYXRjaGVkID0gdHJ1ZTsKIAog
ICAgICAgICByZXR1cm4gTG9va3VwX0NhY2hlYWJsZTsKQEAgLTEzNTcsMjQgKzEzNTIsMjQgQEAg
Y2xhc3MgU2NvcGVOYW1lQ29tcGlsZXIgOiBwdWJsaWMgUElDU3R1YgogICAgICAgICAgICAgbWFz
bS5sb2FkUGF5bG9hZChhZGRyLCBwaWMub2JqUmVnKTsKICAgICAgICAgICAgIG1hc20ubG9hZFR5
cGVUYWcoYWRkciwgcGljLnNoYXBlUmVnKTsKICAgICAgICAgICAgIHNraXBPdmVyID0gbWFzbS5q
dW1wKCk7CiAgICAgICAgIH0KIAogICAgICAgICBlc2NhcGVkRnJhbWUubGlua1RvKG1hc20ubGFi
ZWwoKSwgJm1hc20pOwogCiAgICAgICAgIHsKLSAgICAgICAgICAgIG1hc20ubG9hZFB0cihBZGRy
ZXNzKHBpYy5vYmpSZWcsIG9mZnNldG9mKEpTT2JqZWN0LCBzbG90cykpLCBwaWMub2JqUmVnKTsK
LQogICAgICAgICAgICAgaWYgKGtpbmQgPT0gVkFSKQogICAgICAgICAgICAgICAgIHNsb3QgKz0g
ZnVuLT5uYXJnczsKLSAgICAgICAgICAgIEFkZHJlc3MgZHNsb3QocGljLm9ialJlZywgKHNsb3Qg
KyBKU09iamVjdDo6Q0FMTF9SRVNFUlZFRF9TTE9UUykgKiBzaXplb2YoVmFsdWUpKTsKKworICAg
ICAgICAgICAgc2xvdCArPSBKU09iamVjdDo6Q0FMTF9SRVNFUlZFRF9TTE9UUzsKKyAgICAgICAg
ICAgIEFkZHJlc3MgYWRkcmVzcyA9IG1hc20ub2JqUHJvcEFkZHJlc3Mob2JqLCBwaWMub2JqUmVn
LCBzbG90KTsKIAogICAgICAgICAgICAgLyogU2FmZSBiZWNhdXNlIHR5cGUgaXMgbG9hZGVkIGZp
cnN0LiAqLwotICAgICAgICAgICAgbWFzbS5sb2FkVmFsdWVBc0NvbXBvbmVudHMoZHNsb3QsIHBp
Yy5zaGFwZVJlZywgcGljLm9ialJlZyk7CisgICAgICAgICAgICBtYXNtLmxvYWRWYWx1ZUFzQ29t
cG9uZW50cyhhZGRyZXNzLCBwaWMuc2hhcGVSZWcsIHBpYy5vYmpSZWcpOwogICAgICAgICB9CiAK
ICAgICAgICAgc2tpcE92ZXIubGlua1RvKG1hc20ubGFiZWwoKSwgJm1hc20pOwogICAgICAgICBK
dW1wIGRvbmUgPSBtYXNtLmp1bXAoKTsKIAogICAgICAgICAvLyBBbGwgZmFpbHVyZXMgZmxvdyB0
byBoZXJlLCBzbyB0aGVyZSBpcyBhIGNvbW1vbiBwb2ludCB0byBwYXRjaC4KICAgICAgICAgZm9y
IChKdW1wICpwaiA9IGZhaWxzLmJlZ2luKCk7IHBqICE9IGZhaWxzLmVuZCgpOyArK3BqKQogICAg
ICAgICAgICAgcGotPmxpbmtUbyhtYXNtLmxhYmVsKCksICZtYXNtKTsKQEAgLTI1MTYsMTcgKzI1
MTEsMTcgQEAgU2V0RWxlbWVudElDOjphdHRhY2hIb2xlU3R1YihKU0NvbnRleHQgKgogICAgICAg
ICBza2lwVXBkYXRlID0gbWFzbS5icmFuY2gzMihBc3NlbWJsZXI6OkFib3ZlLCBhcnJheUxlbmd0
aCwga2V5UmVnKTsKICAgICAgICAgbWFzbS5hZGQzMihJbW0zMigxKSwga2V5UmVnKTsKICAgICAg
ICAgbWFzbS5zdG9yZTMyKGtleVJlZywgYXJyYXlMZW5ndGgpOwogICAgICAgICBtYXNtLnN1YjMy
KEltbTMyKDEpLCBrZXlSZWcpOwogICAgIH0KICAgICBza2lwVXBkYXRlLmxpbmtUbyhtYXNtLmxh
YmVsKCksICZtYXNtKTsKIAogICAgIC8vIFN0b3JlIHRoZSB2YWx1ZSBiYWNrLgotICAgIG1hc20u
bG9hZFB0cihBZGRyZXNzKG9ialJlZywgb2Zmc2V0b2YoSlNPYmplY3QsIHNsb3RzKSksIG9ialJl
Zyk7CisgICAgbWFzbS5sb2FkUHRyKEFkZHJlc3Mob2JqUmVnLCBKU09iamVjdDo6b2Zmc2V0T2ZT
bG90cygpKSwgb2JqUmVnKTsKICAgICBpZiAoaGFzQ29uc3RhbnRLZXkpIHsKICAgICAgICAgQWRk
cmVzcyBzbG90KG9ialJlZywga2V5VmFsdWUgKiBzaXplb2YoVmFsdWUpKTsKICAgICAgICAgbWFz
bS5zdG9yZVZhbHVlKHZyLCBzbG90KTsKICAgICB9IGVsc2UgewogICAgICAgICBCYXNlSW5kZXgg
c2xvdChvYmpSZWcsIGtleVJlZywgQXNzZW1ibGVyOjpKU1ZBTF9TQ0FMRSk7CiAgICAgICAgIG1h
c20uc3RvcmVWYWx1ZSh2ciwgc2xvdCk7CiAgICAgfQogCmRpZmYgLS1naXQgYS9qcy9zcmMvdHJh
Y2VqaXQvV3JpdGVyLmNwcCBiL2pzL3NyYy90cmFjZWppdC9Xcml0ZXIuY3BwCi0tLSBhL2pzL3Ny
Yy90cmFjZWppdC9Xcml0ZXIuY3BwCisrKyBiL2pzL3NyYy90cmFjZWppdC9Xcml0ZXIuY3BwCkBA
IC0yNjAsMjUgKzI2MCwzMSBAQCBjb3VsZEJlT2JqZWN0T3JTdHJpbmcoTElucyAqaW5zKQogICAg
IH0KIAogICAgIHJldHVybiByZXQ7CiB9CiAKIHN0YXRpYyBib29sCiBpc0NvbnN0UHJpdmF0ZVB0
cihMSW5zICppbnMsIHVuc2lnbmVkIHNsb3QpCiB7CisgICAgLy8gbWF0Y2ggYm90aCBpbmxpbmUg
YW5kIGluZGlyZWN0IHNsb3QgYWNjZXNzZXMuCisgICAgdWludDMyIGlubGluZU9mZnNldCA9IEpT
T2JqZWN0OjpnZXRGaXhlZFNsb3RPZmZzZXQoc2xvdCkgKyBzUGF5bG9hZE9mZnNldDsKKyAgICB1
aW50MzIgb29sT2Zmc2V0ID0gKHNsb3QgKiBzaXplb2YoVmFsdWUpKSArIHNQYXlsb2FkT2Zmc2V0
OworCiAjaWYgSlNfQklUU19QRVJfV09SRCA9PSAzMgogICAgIC8vIGlucyA9IGxkcC5zbG90cy9j
IC4uLls8b2Zmc2V0IG9mIHNsb3Q+XQotICAgIHJldHVybiBtYXRjaChpbnMsIExJUl9sZHAsIEFD
Q1NFVF9TTE9UUywgTE9BRF9DT05TVCwgc2xvdCAqIHNpemVvZihWYWx1ZSkgKyBzUGF5bG9hZE9m
ZnNldCk7CisgICAgcmV0dXJuIG1hdGNoKGlucywgTElSX2xkcCwgQUNDU0VUX1NMT1RTLCBMT0FE
X0NPTlNULCBpbmxpbmVPZmZzZXQpCisgICAgICAgIHx8IG1hdGNoKGlucywgTElSX2xkcCwgQUND
U0VUX1NMT1RTLCBMT0FEX0NPTlNULCBvb2xPZmZzZXQpOwogI2VsaWYgSlNfQklUU19QRVJfV09S
RCA9PSA2NAogICAgIC8vIGluc19vcHJuZDEgPSBsZHAuc2xvdHMvYyAuLi5bPG9mZnNldCBvZiBz
bG90Pl0KICAgICAvLyBpbnNfb3BybmQyID0gaW1taSAxCiAgICAgLy8gaW5zID0gbHNocSBpbnNf
b3BybmQxLCBpbnNfb3BybmQyCiAgICAgcmV0dXJuIGlucy0+aXNvcChMSVJfbHNocSkgJiYKLSAg
ICAgICAgICAgbWF0Y2goaW5zLT5vcHJuZDEoKSwgTElSX2xkcCwgQUNDU0VUX1NMT1RTLCBMT0FE
X0NPTlNULCBzbG90ICogc2l6ZW9mKFZhbHVlKSkgJiYKKyAgICAgICAgICAgKG1hdGNoKGlucy0+
b3BybmQxKCksIExJUl9sZHAsIEFDQ1NFVF9TTE9UUywgTE9BRF9DT05TVCwgaW5saW5lT2Zmc2V0
KQorICAgICAgICAgfHwgbWF0Y2goaW5zLT5vcHJuZDEoKSwgTElSX2xkcCwgQUNDU0VUX1NMT1RT
LCBMT0FEX0NPTlNULCBvb2xPZmZzZXQpKSAmJgogICAgICAgICAgICBpbnMtPm9wcm5kMigpLT5p
c0ltbUkoMSk7CiAjZW5kaWYKIH0KIAogLyoKICAqIEFueSB0aW1lIHlvdSB1c2UgYW4gQWNjU2V0
IGFubm90YXRpb24gb3RoZXIgdGhhbiBBQ0NTRVRfQUxMLCB5b3UgYXJlIG1ha2luZwogICogYSBw
cm9taXNlIHRvIE5hbm9qaXQgYWJvdXQgdGhlIHByb3BlcnRpZXMgb2YgdGhlIGFubm90YXRlZCBs
b2FkL3N0b3JlL2NhbGwuCiAgKiBJZiB0aGF0IGFubm90YXRpb24gaXMgd3JvbmcsIGl0IGNvdWxk
IGNhdXNlIHJhcmUgYW5kIHN1YnRsZSBidWdzLiAgU28gdGhpcwpkaWZmIC0tZ2l0IGEvanMvc3Jj
L3RyYWNlaml0L1dyaXRlci5oIGIvanMvc3JjL3RyYWNlaml0L1dyaXRlci5oCi0tLSBhL2pzL3Ny
Yy90cmFjZWppdC9Xcml0ZXIuaAorKysgYi9qcy9zcmMvdHJhY2VqaXQvV3JpdGVyLmgKQEAgLTUx
MSwyMyArNTExLDIzIEBAIGNsYXNzIFdyaXRlcgogCiAgICAgbmo6OkxJbnMgKnN0dWlPYmpQcml2
YXRlKG5qOjpMSW5zICpvYmosIG5qOjpMSW5zICp2YWx1ZSkgY29uc3QgewogICAgICAgICByZXR1
cm4gbmFtZShsaXItPmluc1N0b3JlKG5qOjpMSVJfc3RpLCB2YWx1ZSwgb2JqLCBvZmZzZXRvZihK
U09iamVjdCwgcHJpdmF0ZURhdGEpLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
IEFDQ1NFVF9PQkpfUFJJVkFURSksCiAgICAgICAgICAgICAgICAgICAgICJwcml2YXRlX3VpbnQz
MiIpOwogICAgIH0KIAogICAgIG5qOjpMSW5zICpsZGlEZW5zZUFycmF5Q2FwYWNpdHkobmo6OkxJ
bnMgKmFycmF5KSBjb25zdCB7Ci0gICAgICAgIHJldHVybiBuYW1lKGxpci0+aW5zTG9hZChuajo6
TElSX2xkaSwgYXJyYXksIG9mZnNldG9mKEpTT2JqZWN0LCBjYXBhY2l0eSksCisgICAgICAgIHJl
dHVybiBuYW1lKGxpci0+aW5zTG9hZChuajo6TElSX2xkaSwgYXJyYXksIEpTT2JqZWN0OjpvZmZz
ZXRPZkNhcGFjaXR5KCksCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBBQ0NTRVRf
T0JKX0NBUEFDSVRZKSwKICAgICAgICAgICAgICAgICAgICAgImNhcGFjaXR5Iik7CiAgICAgfQog
CiAgICAgbmo6OkxJbnMgKmxkcE9ialNsb3RzKG5qOjpMSW5zICpvYmopIGNvbnN0IHsKLSAgICAg
ICAgcmV0dXJuIG5hbWUobGlyLT5pbnNMb2FkKG5qOjpMSVJfbGRwLCBvYmosIG9mZnNldG9mKEpT
T2JqZWN0LCBzbG90cyksIEFDQ1NFVF9PQkpfU0xPVFMpLAorICAgICAgICByZXR1cm4gbmFtZShs
aXItPmluc0xvYWQobmo6OkxJUl9sZHAsIG9iaiwgSlNPYmplY3Q6Om9mZnNldE9mU2xvdHMoKSwg
QUNDU0VUX09CSl9TTE9UUyksCiAgICAgICAgICAgICAgICAgICAgICJzbG90cyIpOwogICAgIH0K
IAogICAgIG5qOjpMSW5zICpsZGlDb25zdFR5cGVkQXJyYXlMZW5ndGgobmo6OkxJbnMgKmFycmF5
KSBjb25zdCB7CiAgICAgICAgIHJldHVybiBuYW1lKGxpci0+aW5zTG9hZChuajo6TElSX2xkaSwg
YXJyYXksIGpzOjpUeXBlZEFycmF5OjpsZW5ndGhPZmZzZXQoKSwgQUNDU0VUX1RBUlJBWSwKICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG5qOjpMT0FEX0NPTlNUKSwKICAgICAgICAg
ICAgICAgICAgICAgInR5cGVkQXJyYXlMZW5ndGgiKTsKICAgICB9CkBAIC0xMTcyLDI4ICsxMTcy
LDI1IEBAIGNsYXNzIFdyaXRlcgogICAgICAgICByZXR1cm4gbGlyLT5pbnMyKG9wLCB4LCB5KTsK
ICAgICB9CiAKICAgICAvKiBPcGVyYXRpb25zIGludm9sdmluZyBub24tdHJpdmlhbCBjb21iaW5h
dGlvbnMgb2YgbXVsdGlwbGUgaW5zdHJ1Y3Rpb25zLiAqLwogCiAgICAgLyoKICAgICAgKiBOYjog
dGhpcyAiUHJpdmF0aXplZCIgcmVmZXJzIHRvIHRoZSBQcml2YXRlIEFQSSBpbiBqc3ZhbHVlLmgu
ICBJdAogICAgICAqIGRvZXNuJ3QgcmVmZXIgdG8gdGhlIEpTT2JqOjpwcml2YXRlRGF0YSBzbG90
ISAgQ29uZnVzaW5nLgorICAgICAqIFRoaXMgc2hvdWxkIG9ubHkgYmUgdXNlZCBmb3Igc2xvdHMg
d2hpY2ggYXJlIGtub3duIHRvIGFsd2F5cyBiZSBmaXhlZC4KICAgICAgKi8KICAgICBuajo6TElu
cyAqZ2V0T2JqUHJpdmF0aXplZFNsb3Qobmo6OkxJbnMgKm9iaiwgdWludDMyIHNsb3QpIGNvbnN0
IHsKKyAgICAgICAgdWludDMyIG9mZnNldCA9IEpTT2JqZWN0OjpnZXRGaXhlZFNsb3RPZmZzZXQo
c2xvdCkgKyBzUGF5bG9hZE9mZnNldDsKICNpZiBKU19CSVRTX1BFUl9XT1JEID09IDMyCi0gICAg
ICAgIG5qOjpMSW5zICp2YWRkcl9pbnMgPSBsZHBPYmpTbG90cyhvYmopOwotICAgICAgICByZXR1
cm4gbGlyLT5pbnNMb2FkKG5qOjpMSVJfbGRpLCB2YWRkcl9pbnMsCi0gICAgICAgICAgICAgICAg
ICAgICAgICAgICAgc2xvdCAqIHNpemVvZihWYWx1ZSkgKyBzUGF5bG9hZE9mZnNldCwgQUNDU0VU
X1NMT1RTLCBuajo6TE9BRF9DT05TVCk7Ci0KKyAgICAgICAgcmV0dXJuIGxpci0+aW5zTG9hZChu
ajo6TElSX2xkaSwgb2JqLCBvZmZzZXQsIEFDQ1NFVF9TTE9UUywgbmo6OkxPQURfQ09OU1QpOwog
I2VsaWYgSlNfQklUU19QRVJfV09SRCA9PSA2NAogICAgICAgICAvKiBOLkIuIE9uIDY0LWJpdCwg
cHJpdmF0aXplZCB2YWx1ZSBhcmUgZW5jb2RlZCBkaWZmZXJlbnRseSBmcm9tIG90aGVyIHBvaW50
ZXJzLiAqLwotICAgICAgICBuajo6TElucyAqdmFkZHJfaW5zID0gbGRwT2JqU2xvdHMob2JqKTsK
LSAgICAgICAgbmo6OkxJbnMgKnZfaW5zID0gbGlyLT5pbnNMb2FkKG5qOjpMSVJfbGRxLCB2YWRk
cl9pbnMsCi0gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzbG90ICogc2l6
ZW9mKFZhbHVlKSArIHNQYXlsb2FkT2Zmc2V0LAorICAgICAgICBuajo6TElucyAqdl9pbnMgPSBs
aXItPmluc0xvYWQobmo6OkxJUl9sZHEsIG9iaiwgb2Zmc2V0LAogICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgQUNDU0VUX1NMT1RTLCBuajo6TE9BRF9DT05TVCk7CiAgICAg
ICAgIHJldHVybiBsc2hxTih2X2lucywgMSk7CiAjZW5kaWYKICAgICB9CiAKICAgICBuajo6TElu
cyAqZ2V0RHNsb3RBZGRyZXNzKG5qOjpMSW5zICpvYmosIG5qOjpMSW5zICppZHgpIGNvbnN0IHsK
ICAgICAgICAgSlNfQVNTRVJUKHNpemVvZihWYWx1ZSkgPT0gOCk7IC8vIFRoZSB8M3wgaW4gdGhl
IGZvbGxvd2luZyBzdGF0ZW1lbnQgcmVxdWlyZXMgdGhpcy4KICAgICAgICAgbmo6OkxJbnMgKm9m
ZnNldCA9IGxzaHBOKHVpMnAoaWR4KSwgMyk7CkBAIC0xMjA5LDIwICsxMjA2LDE4IEBAIGNsYXNz
IFdyaXRlcgogICAgIG5qOjpMSW5zICpnZXRTdHJpbmdDaGFyKG5qOjpMSW5zICpzdHIsIG5qOjpM
SW5zICppZHgpIGNvbnN0IHsKICAgICAgICAgbmo6OkxJbnMgKmNoYXJzID0gbGRwU3RyaW5nQ2hh
cnMoc3RyKTsKICAgICAgICAgcmV0dXJuIG5hbWUobGlyLT5pbnNMb2FkKG5qOjpMSVJfbGR1czJ1
aSwgYWRkcChjaGFycywgbHNocE4oaWR4LCAxKSksIDAsCiAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICBBQ0NTRVRfU1RSSU5HX01DSEFSUywgbmo6OkxPQURfQ09OU1QpLAogICAgICAg
ICAgICAgICAgICAgICAic3RyQ2hhciIpOwogICAgIH0KIAogICAgIG5qOjpMSW5zICpnZXRBcmdz
TGVuZ3RoKG5qOjpMSW5zICphcmdzKSBjb25zdCB7Ci0gICAgICAgIHVpbnQzMiBzbG90ID0gSlNP
YmplY3Q6OkpTU0xPVF9BUkdTX0xFTkdUSDsKLSAgICAgICAgbmo6OkxJbnMgKnZhZGRyX2lucyA9
IGxkcE9ialNsb3RzKGFyZ3MpOwotICAgICAgICByZXR1cm4gbmFtZShsaXItPmluc0xvYWQobmo6
OkxJUl9sZGksIHZhZGRyX2lucywgc2xvdCAqIHNpemVvZihWYWx1ZSkgKyBzUGF5bG9hZE9mZnNl
dCwKLSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIEFDQ1NFVF9TTE9UUyksCisgICAg
ICAgIHVpbnQzMiBvZmZzZXQgPSBKU09iamVjdDo6Z2V0QXJndW1lbnRzTGVuZ3RoT2Zmc2V0KCkg
KyBzUGF5bG9hZE9mZnNldDsKKyAgICAgICAgcmV0dXJuIG5hbWUobGlyLT5pbnNMb2FkKG5qOjpM
SVJfbGRpLCBhcmdzLCBvZmZzZXQsIEFDQ1NFVF9TTE9UUyksCiAgICAgICAgICAgICAgICAgICAg
ICJhcmdzTGVuZ3RoIik7CiAgICAgfQogfTsKIAogfSAgIC8qIG5hbWVzcGFjZSB0aml0ICovCiB9
ICAgLyogbmFtZXNwYWNlIGpzICovCiAKICNlbmRpZiAvKiB0cmFjZWppdF9Xcml0ZXJfaF9fXyAq
Lwo=
</data>

          </attachment>
          <attachment
              isobsolete="0"
              ispatch="1"
              isprivate="0"
              isurl="0"
          >
            <attachid>524772</attachid>
            <date>2011-04-08 15:42:00 -0700</date>
            <delta_ts>2011-04-08 17:01:16 -0700</delta_ts>
            <desc>patch</desc>
            <filename>splitobject.8.txt</filename>
            <type>text/plain</type>
            <size>103027</size>
            <attacher>bhackett1024</attacher>
            
              <data encoding="base64">ZGlmZiAtLWdpdCBhL2pzL3NyYy9qc2FwaS10ZXN0cy90ZXN0Q29uc2VydmF0aXZlR0MuY3BwIGIv
anMvc3JjL2pzYXBpLXRlc3RzL3Rlc3RDb25zZXJ2YXRpdmVHQy5jcHAKLS0tIGEvanMvc3JjL2pz
YXBpLXRlc3RzL3Rlc3RDb25zZXJ2YXRpdmVHQy5jcHAKKysrIGIvanMvc3JjL2pzYXBpLXRlc3Rz
L3Rlc3RDb25zZXJ2YXRpdmVHQy5jcHAKQEAgLTQyLDIzICs0MiwyNCBAQCBCRUdJTl9URVNUKHRl
c3RDb25zZXJ2YXRpdmVHQykKICAgICBjaGVja09iamVjdEZpZWxkcygmb2JqMkNvcHksIG9iajIp
OwogICAgIENIRUNLKCFtZW1jbXAoJnN0cjJDb3B5LCBzdHIyLCBzaXplb2Yoc3RyMkNvcHkpKSk7
CiAKICAgICByZXR1cm4gdHJ1ZTsKIH0KIAogYm9vbCBjaGVja09iamVjdEZpZWxkcyhKU09iamVj
dCAqc2F2ZWRDb3B5LCBKU09iamVjdCAqb2JqKQogewotICAgIC8qCi0gICAgICogVGhlIEdDIGNh
biBjaGFuZ2UgdGhlIHNoYXBlIGFuZCBzaHJpbmsgZHNsb3RzIHNvIHdlIHVwZGF0ZSB0aGVtIGJl
Zm9yZQotICAgICAqIGRvaW5nIG1lbWNtcC4KLSAgICAgKi8KLSAgICBzYXZlZENvcHktPm9ialNo
YXBlID0gb2JqLT5vYmpTaGFwZTsKLSAgICBzYXZlZENvcHktPnNsb3RzID0gb2JqLT5zbG90czsK
LSAgICBDSEVDSyghbWVtY21wKHNhdmVkQ29weSwgb2JqLCBzaXplb2YoKm9iaikpKTsKKyAgICAv
KiBJZ25vcmUgZmllbGRzIHdoaWNoIGFyZSB1bnN0YWJsZSBhY3Jvc3MgR0NzLiAqLworICAgIENI
RUNLKHNhdmVkQ29weS0+bWFwID09IG9iai0+bWFwKTsKKyAgICBDSEVDSyhzYXZlZENvcHktPmNs
YXNwID09IG9iai0+Y2xhc3ApOworICAgIENIRUNLKHNhdmVkQ29weS0+ZmxhZ3MgPT0gb2JqLT5m
bGFncyk7CisgICAgQ0hFQ0soc2F2ZWRDb3B5LT5lbXB0eVNoYXBlcyA9PSBvYmotPmVtcHR5U2hh
cGVzKTsKKyAgICBDSEVDSyhzYXZlZENvcHktPnByb3RvID09IG9iai0+cHJvdG8pOworICAgIENI
RUNLKHNhdmVkQ29weS0+cGFyZW50ID09IG9iai0+cGFyZW50KTsKKyAgICBDSEVDSyhzYXZlZENv
cHktPnByaXZhdGVEYXRhID09IG9iai0+cHJpdmF0ZURhdGEpOwogICAgIHJldHVybiB0cnVlOwog
fQogCiBFTkRfVEVTVCh0ZXN0Q29uc2VydmF0aXZlR0MpCiAKIEJFR0lOX1RFU1QodGVzdERlcml2
ZWRWYWx1ZXMpCiB7CiAgIEpTU3RyaW5nICpzdHIgPSBKU19OZXdTdHJpbmdDb3B5WihjeCwgIm9u
Y2UgdXBvbiBhIG1pZG5pZ2h0IGRyZWFyeSIpOwpkaWZmIC0tZ2l0IGEvanMvc3JjL2pzYXBpLXRl
c3RzL3Rlc3RGdW5jQ2FsbGJhY2suY3BwIGIvanMvc3JjL2pzYXBpLXRlc3RzL3Rlc3RGdW5jQ2Fs
bGJhY2suY3BwCi0tLSBhL2pzL3NyYy9qc2FwaS10ZXN0cy90ZXN0RnVuY0NhbGxiYWNrLmNwcAor
KysgYi9qcy9zcmMvanNhcGktdGVzdHMvdGVzdEZ1bmNDYWxsYmFjay5jcHAKQEAgLTEsMTQgKzEs
MTUgQEAKICNpbmNsdWRlICJ0ZXN0cy5oIgogI2luY2x1ZGUgImpzZnVuLmgiCiAjaW5jbHVkZSAi
anNjbnR4dC5oIgogCiAvLyBGb3IgVFJBQ0lOR19FTkFCTEVECiAjaW5jbHVkZSAianN0cmFjZXIu
aCIKKyNpbmNsdWRlICJqc29iamlubGluZXMuaCIKIAogI2lmZGVmIE1PWl9UUkFDRV9KU0NBTExT
CiAKIHN0YXRpYyBpbnQgZGVwdGggPSAwOwogc3RhdGljIGludCBlbnRlcnMgPSAwOwogc3RhdGlj
IGludCBsZWF2ZXMgPSAwOwogc3RhdGljIGludCBpbnRlcnByZXRlZCA9IDA7CiAKZGlmZiAtLWdp
dCBhL2pzL3NyYy9qc2FycmF5LmNwcCBiL2pzL3NyYy9qc2FycmF5LmNwcAotLS0gYS9qcy9zcmMv
anNhcnJheS5jcHAKKysrIGIvanMvc3JjL2pzYXJyYXkuY3BwCkBAIC05NDAsMTcgKzk0MCwxNyBA
QCBhcnJheV9kZWxldGVQcm9wZXJ0eShKU0NvbnRleHQgKmN4LCBKU09iCiB9CiAKIHN0YXRpYyB2
b2lkCiBhcnJheV90cmFjZShKU1RyYWNlciAqdHJjLCBKU09iamVjdCAqb2JqKQogewogICAgIEpT
X0FTU0VSVChvYmotPmlzRGVuc2VBcnJheSgpKTsKIAogICAgIHVpbnQzMiBjYXBhY2l0eSA9IG9i
ai0+Z2V0RGVuc2VBcnJheUNhcGFjaXR5KCk7Ci0gICAgTWFya1ZhbHVlUmFuZ2UodHJjLCBjYXBh
Y2l0eSwgb2JqLT5zbG90cywgImVsZW1lbnQiKTsKKyAgICBNYXJrVmFsdWVSYW5nZSh0cmMsIGNh
cGFjaXR5LCBvYmotPmdldERlbnNlQXJyYXlFbGVtZW50cygpLCAiZWxlbWVudCIpOwogfQogCiBz
dGF0aWMgSlNCb29sCiBhcnJheV9maXgoSlNDb250ZXh0ICpjeCwgSlNPYmplY3QgKm9iaiwgYm9v
bCAqc3VjY2VzcywgQXV0b0lkVmVjdG9yICpwcm9wcykKIHsKICAgICBKU19BU1NFUlQob2JqLT5p
c0RlbnNlQXJyYXkoKSk7CiAKICAgICAvKgpAQCAtMTA0MCw2OCArMTA0MCw3NyBAQCBKU09iamVj
dDo6bWFrZURlbnNlQXJyYXlTbG93KEpTQ29udGV4dCAqCiAgICAgSlNPYmplY3RNYXAgKm9sZE1h
cCA9IG1hcDsKIAogICAgIC8qIENyZWF0ZSBhIG5hdGl2ZSBzY29wZS4gKi8KICAgICBKU09iamVj
dCAqYXJyYXlQcm90byA9IGdldFByb3RvKCk7CiAgICAganM6OmdjOjpGaW5hbGl6ZUtpbmQga2lu
ZCA9IGpzOjpnYzo6RmluYWxpemVLaW5kKGFyZW5hKCktPmhlYWRlcigpLT50aGluZ0tpbmQpOwog
ICAgIGlmICghSW5pdFNjb3BlRm9yT2JqZWN0KGN4LCB0aGlzLCAmanNfU2xvd0FycmF5Q2xhc3Ms
IGFycmF5UHJvdG8sIGtpbmQpKQogICAgICAgICByZXR1cm4gZmFsc2U7CiAKLSAgICB1aW50MzIg
Y2FwYWNpdHkgPSBnZXREZW5zZUFycmF5Q2FwYWNpdHkoKTsKKyAgICB1aW50MzIgYXJyYXlDYXBh
Y2l0eSA9IGdldERlbnNlQXJyYXlDYXBhY2l0eSgpOworCisgICAgLyoKKyAgICAgKiBBZGp1c3Qg
dGhlIHNsb3RzIHRvIGFjY291bnQgZm9yIHRoZSBkaWZmZXJlbnQgbGF5b3V0IGJldHdlZW4gZGVu
c2UKKyAgICAgKiBhcnJheXMgYW5kIG90aGVyIG9iamVjdHMuIFRoZSBzbG90cyBtdXN0IGJlIGR5
bmFtaWMsIGFuZCB0aGUgZml4ZWQgc2xvdHMKKyAgICAgKiBhcmUgbm93IGF2YWlsYWJsZSBmb3Ig
bmV3bHkgYWRkZWQgcHJvcGVydGllcy4KKyAgICAgKi8KKyAgICBpZiAoZGVuc2VBcnJheUhhc0lu
bGluZVNsb3RzKCkpIHsKKyAgICAgICAgaWYgKCFhbGxvY1Nsb3RzKGN4LCBudW1TbG90cygpKSkg
eworICAgICAgICAgICAgc2V0TWFwKG9sZE1hcCk7CisgICAgICAgICAgICByZXR1cm4gZmFsc2U7
CisgICAgICAgIH0KKyAgICAgICAgSlNfQVNTRVJUKCFkZW5zZUFycmF5SGFzSW5saW5lU2xvdHMo
KSk7CisgICAgfQorICAgIGNhcGFjaXR5ID0gbnVtRml4ZWRTbG90cygpICsgYXJyYXlDYXBhY2l0
eTsKKyAgICBjbGFzcCA9ICZqc19TbG93QXJyYXlDbGFzczsKIAogICAgIC8qCiAgICAgICogQmVn
aW4gd2l0aCB0aGUgbGVuZ3RoIHByb3BlcnR5IHRvIHNoYXJlIG1vcmUgb2YgdGhlIHByb3BlcnR5
IHRyZWUuCiAgICAgICogVGhlIGdldHRlci9zZXR0ZXIgaGVyZSB3aWxsIGRpcmVjdGx5IGFjY2Vz
cyB0aGUgb2JqZWN0J3MgcHJpdmF0ZSB2YWx1ZS4KICAgICAgKi8KICAgICBpZiAoIUFkZExlbmd0
aFByb3BlcnR5KGN4LCB0aGlzKSkgewogICAgICAgICBzZXRNYXAob2xkTWFwKTsKKyAgICAgICAg
Y2FwYWNpdHkgPSBhcnJheUNhcGFjaXR5OworICAgICAgICBjbGFzcCA9ICZqc19BcnJheUNsYXNz
OwogICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgfQogCiAgICAgLyoKICAgICAgKiBDcmVhdGUg
bmV3IHByb3BlcnRpZXMgcG9pbnRpbmcgdG8gZXhpc3RpbmcgZWxlbWVudHMuIFBhY2sgdGhlIGFy
cmF5IHRvCiAgICAgICogcmVtb3ZlIGhvbGVzLCBzbyB0aGF0IHNoYXBlcyB1c2Ugc3VjY2Vzc2l2
ZSBzbG90cyAoYXMgZm9yIG90aGVyIG9iamVjdHMpLgogICAgICAqLwogICAgIHVpbnQzMiBuZXh0
ID0gMDsKLSAgICBmb3IgKHVpbnQzMiBpID0gMDsgaSA8IGNhcGFjaXR5OyBpKyspIHsKKyAgICBm
b3IgKHVpbnQzMiBpID0gMDsgaSA8IGFycmF5Q2FwYWNpdHk7IGkrKykgeworICAgICAgICAvKiBE
ZW5zZSBhcnJheSBpbmRleGVzIGNhbiBhbHdheXMgZml0IGluIGEganNpZC4gKi8KICAgICAgICAg
anNpZCBpZDsKLSAgICAgICAgaWYgKCFWYWx1ZVRvSWQoY3gsIEludDMyVmFsdWUoaSksICZpZCkp
IHsKKyAgICAgICAgSlNfQUxXQVlTX1RSVUUoVmFsdWVUb0lkKGN4LCBJbnQzMlZhbHVlKGkpLCAm
aWQpKTsKKworICAgICAgICBpZiAoc2xvdHNbaV0uaXNNYWdpYyhKU19BUlJBWV9IT0xFKSkKKyAg
ICAgICAgICAgIGNvbnRpbnVlOworCisgICAgICAgIHNldFNsb3QobmV4dCwgc2xvdHNbaV0pOwor
CisgICAgICAgIGlmICghYWRkRGF0YVByb3BlcnR5KGN4LCBpZCwgbmV4dCwgSlNQUk9QX0VOVU1F
UkFURSkpIHsKICAgICAgICAgICAgIHNldE1hcChvbGRNYXApOworICAgICAgICAgICAgY2FwYWNp
dHkgPSBhcnJheUNhcGFjaXR5OworICAgICAgICAgICAgY2xhc3AgPSAmanNfQXJyYXlDbGFzczsK
ICAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICAgfQogCi0gICAgICAgIGlmIChnZXRE
ZW5zZUFycmF5RWxlbWVudChpKS5pc01hZ2ljKEpTX0FSUkFZX0hPTEUpKQotICAgICAgICAgICAg
Y29udGludWU7Ci0KLSAgICAgICAgc2V0RGVuc2VBcnJheUVsZW1lbnQobmV4dCwgZ2V0RGVuc2VB
cnJheUVsZW1lbnQoaSkpOwotCi0gICAgICAgIGlmICghYWRkRGF0YVByb3BlcnR5KGN4LCBpZCwg
bmV4dCwgSlNQUk9QX0VOVU1FUkFURSkpIHsKLSAgICAgICAgICAgIHNldE1hcChvbGRNYXApOwot
ICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwotICAgICAgICB9Ci0KICAgICAgICAgbmV4dCsrOwog
ICAgIH0KIAotICAgIC8qCi0gICAgICogRGVuc2UgYXJyYXlzIHdpdGggZGlmZmVyZW50IG51bWJl
cnMgb2Ygc2xvdHMgYnV0IHRoZSBzYW1lIG51bWJlciBvZiBmaXhlZAotICAgICAqIHNsb3RzIGFu
ZCB0aGUgc2FtZSBub24taG9sZSBpbmRleGVzIG11c3QgdXNlIHRoZWlyIGZpeGVkIHNsb3RzIGNv
bnNpc3RlbnRseS4KLSAgICAgKi8KLSAgICBpZiAoaGFzU2xvdHNBcnJheSgpICYmIG5leHQgPD0g
bnVtRml4ZWRTbG90cygpKQotICAgICAgICByZXZlcnRUb0ZpeGVkU2xvdHMoY3gpOwotCi0gICAg
Q2xlYXJWYWx1ZVJhbmdlKHNsb3RzICsgbmV4dCwgdGhpcy0+Y2FwYWNpdHkgLSBuZXh0LCBmYWxz
ZSk7CisgICAgY2xlYXJTbG90UmFuZ2UobmV4dCwgY2FwYWNpdHkgLSBuZXh0KTsKIAogICAgIC8q
CiAgICAgICogRmluYWxseSwgdXBkYXRlIGNsYXNzLiBJZiB8dGhpc3wgaXMgQXJyYXkucHJvdG90
eXBlLCB0aGVuIGpzX0luaXRDbGFzcwogICAgICAqIHdpbGwgY3JlYXRlIGFuIGVtcHR5U2hhcGUg
d2hvc2UgY2xhc3MgaXMgJmpzX1Nsb3dBcnJheUNsYXNzLCB0byBlbnN1cmUKICAgICAgKiB0aGF0
IGRlbGVnYXRpbmcgaW5zdGFuY2VzIGNhbiBzaGFyZSBzaGFwZXMgaW4gdGhlIHRyZWUgcm9vdGVk
IGF0IHRoZQogICAgICAqIHByb3RvJ3MgZW1wdHkgc2hhcGUuCiAgICAgICovCi0gICAgY2xhc3Ag
PSAmanNfU2xvd0FycmF5Q2xhc3M7CiAgICAgcmV0dXJuIHRydWU7CiB9CiAKIC8qIFRyYW5zZmVy
IG93bmVyc2hpcCBvZiBidWZmZXIgdG8gcmV0dXJuZWQgc3RyaW5nLiAqLwogc3RhdGljIGlubGlu
ZSBKU0Jvb2wKIEJ1ZmZlclRvU3RyaW5nKEpTQ29udGV4dCAqY3gsIFN0cmluZ0J1ZmZlciAmc2Is
IFZhbHVlICpydmFsKQogewogICAgIEpTU3RyaW5nICpzdHIgPSBzYi5maW5pc2hTdHJpbmcoKTsK
ZGlmZiAtLWdpdCBhL2pzL3NyYy9qc2Z1bi5jcHAgYi9qcy9zcmMvanNmdW4uY3BwCi0tLSBhL2pz
L3NyYy9qc2Z1bi5jcHAKKysrIGIvanMvc3JjL2pzZnVuLmNwcApAQCAtOTU3LDE3ICs5NTcsMTcg
QEAgQ2FsbGVlR2V0dGVyKEpTQ29udGV4dCAqY3gsIEpTT2JqZWN0ICpvYgogICogbXVzdCBiZSBu
dWxsLgogICovCiBzdGF0aWMgSlNPYmplY3QgKgogTmV3Q2FsbE9iamVjdChKU0NvbnRleHQgKmN4
LCBKU1NjcmlwdCAqc2NyaXB0LCBKU09iamVjdCAmc2NvcGVDaGFpbiwgSlNPYmplY3QgKmNhbGxl
ZSkKIHsKICAgICBCaW5kaW5ncyAmYmluZGluZ3MgPSBzY3JpcHQtPmJpbmRpbmdzOwogICAgIHNp
emVfdCBhcmdzVmFycyA9IGJpbmRpbmdzLmNvdW50QXJnc0FuZFZhcnMoKTsKICAgICBzaXplX3Qg
c2xvdHMgPSBKU09iamVjdDo6Q0FMTF9SRVNFUlZFRF9TTE9UUyArIGFyZ3NWYXJzOwotICAgIGdj
OjpGaW5hbGl6ZUtpbmQga2luZCA9IGdjOjpHZXRHQ09iamVjdEtpbmQoc2xvdHMpOworICAgIGdj
OjpGaW5hbGl6ZUtpbmQga2luZCA9IGdjOjpHZXRHQ09iamVjdEtpbmQoc2xvdHMsIGdjOjpGSU5B
TElaRV9PQkpFQ1QyKTsKIAogICAgIEpTT2JqZWN0ICpjYWxsb2JqID0ganNfTmV3R0NPYmplY3Qo
Y3gsIGtpbmQpOwogICAgIGlmICghY2FsbG9iaikKICAgICAgICAgcmV0dXJuIE5VTEw7CiAKICAg
ICAvKiBJbml0IGltbWVkaWF0ZWx5IHRvIGF2b2lkIEdDIHNlZWluZyBhIGhhbGYtaW5pdCdlZCBv
YmplY3QuICovCiAgICAgY2FsbG9iai0+aW5pdENhbGwoY3gsIGJpbmRpbmdzLCAmc2NvcGVDaGFp
bik7CiAKQEAgLTEwNjksMTkgKzEwNjksMTggQEAganNfQ3JlYXRlQ2FsbE9iamVjdE9uVHJhY2Uo
SlNDb250ZXh0ICpjeAogCiBKU19ERUZJTkVfQ0FMTElORk9fNChleHRlcm4sIE9CSkVDVCwganNf
Q3JlYXRlQ2FsbE9iamVjdE9uVHJhY2UsIENPTlRFWFQsIEZVTkNUSU9OLCBPQkpFQ1QsIE9CSkVD
VCwKICAgICAgICAgICAgICAgICAgICAgIDAsIG5hbm9qaXQ6OkFDQ1NFVF9TVE9SRV9BTlkpCiAK
IGlubGluZSBzdGF0aWMgdm9pZAogQ29weVZhbHVlc1RvQ2FsbE9iamVjdChKU09iamVjdCAmY2Fs
bG9iaiwgdWludE4gbmFyZ3MsIFZhbHVlICphcmd2LCB1aW50TiBudmFycywgVmFsdWUgKnNsb3Rz
KQogewogICAgIEpTX0FTU0VSVChjYWxsb2JqLm51bVNsb3RzKCkgPj0gSlNPYmplY3Q6OkNBTExf
UkVTRVJWRURfU0xPVFMgKyBuYXJncyArIG52YXJzKTsKLSAgICBWYWx1ZSAqYmFzZSA9IGNhbGxv
YmouZ2V0U2xvdHMoKSArIEpTT2JqZWN0OjpDQUxMX1JFU0VSVkVEX1NMT1RTOwotICAgIG1lbWNw
eShiYXNlLCBhcmd2LCBuYXJncyAqIHNpemVvZihWYWx1ZSkpOwotICAgIG1lbWNweShiYXNlICsg
bmFyZ3MsIHNsb3RzLCBudmFycyAqIHNpemVvZihWYWx1ZSkpOworICAgIGNhbGxvYmouY29weVNs
b3RSYW5nZShKU09iamVjdDo6Q0FMTF9SRVNFUlZFRF9TTE9UUywgYXJndiwgbmFyZ3MpOworICAg
IGNhbGxvYmouY29weVNsb3RSYW5nZShKU09iamVjdDo6Q0FMTF9SRVNFUlZFRF9TTE9UUyArIG5h
cmdzLCBzbG90cywgbnZhcnMpOwogfQogCiB2b2lkCiBqc19QdXRDYWxsT2JqZWN0KEpTQ29udGV4
dCAqY3gsIEpTU3RhY2tGcmFtZSAqZnApCiB7CiAgICAgSlNPYmplY3QgJmNhbGxvYmogPSBmcC0+
Y2FsbE9iaigpOwogICAgIEpTX0FTU0VSVChjYWxsb2JqLmdldFByaXZhdGUoKSA9PSBmcCk7CiAg
ICAgSlNfQVNTRVJUX0lGKGZwLT5pc0V2YWxGcmFtZSgpLCBmcC0+aXNTdHJpY3RFdmFsRnJhbWUo
KSk7CkBAIC0xMzgzLDE3ICsxMzgyLDE3IEBAIGNhbGxfdHJhY2UoSlNUcmFjZXIgKnRyYywgSlNP
YmplY3QgKm9iaikKICAgICAgICAgICogZm9yIEpTIG9iamVjdHMgKGluY2x1ZGluZyBDYWxsIG9i
amVjdHMpLCBzbyBpcyB1bmFibGUgdG8gY29sbGVjdAogICAgICAgICAgKiBjeWNsZXMgaW52b2x2
aW5nIENhbGwgb2JqZWN0cyB3aG9zZSBmcmFtZXMgYXJlIGFjdGl2ZSB3aXRob3V0IHRoaXMKICAg
ICAgICAgICogaGlkaW5nIGhhY2suCiAgICAgICAgICAqLwogICAgICAgICB1aW50TiBmaXJzdCA9
IEpTT2JqZWN0OjpDQUxMX1JFU0VSVkVEX1NMT1RTOwogICAgICAgICB1aW50TiBjb3VudCA9IGZw
LT5zY3JpcHQoKS0+YmluZGluZ3MuY291bnRBcmdzQW5kVmFycygpOwogCiAgICAgICAgIEpTX0FT
U0VSVChvYmotPm51bVNsb3RzKCkgPj0gZmlyc3QgKyBjb3VudCk7Ci0gICAgICAgIFNldFZhbHVl
UmFuZ2VUb1VuZGVmaW5lZChvYmotPmdldFNsb3RzKCkgKyBmaXJzdCwgY291bnQpOworICAgICAg
ICBvYmotPmNsZWFyU2xvdFJhbmdlKGZpcnN0LCBjb3VudCk7CiAgICAgfQogCiAgICAgTWF5YmVN
YXJrR2VuZXJhdG9yKHRyYywgb2JqKTsKIH0KIAogSlNfUFVCTElDX0RBVEEoQ2xhc3MpIGpzX0Nh
bGxDbGFzcyA9IHsKICAgICAiQ2FsbCIsCiAgICAgSlNDTEFTU19IQVNfUFJJVkFURSB8CkBAIC0y
MjQzLDE3ICsyMjQyLDE3IEBAIEpTT2JqZWN0Ojppbml0Qm91bmRGdW5jdGlvbihKU0NvbnRleHQg
KmMKIAogICAgICAgICBlbXB0eS0+c2xvdFNwYW4gKz0gYXJnc2xlbjsKICAgICAgICAgbWFwID0g
ZW1wdHk7CiAKICAgICAgICAgaWYgKCFlbnN1cmVJbnN0YW5jZVJlc2VydmVkU2xvdHMoY3gsIGFy
Z3NsZW4pKQogICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogCiAgICAgICAgIEpTX0FTU0VSVChu
dW1TbG90cygpID49IGFyZ3NsZW4gKyBGVU5fQ0xBU1NfUkVTRVJWRURfU0xPVFMpOwotICAgICAg
ICBtZW1jcHkoZ2V0U2xvdHMoKSArIEZVTl9DTEFTU19SRVNFUlZFRF9TTE9UUywgYXJncywgYXJn
c2xlbiAqIHNpemVvZihWYWx1ZSkpOworICAgICAgICBjb3B5U2xvdFJhbmdlKEZVTl9DTEFTU19S
RVNFUlZFRF9TTE9UUywgYXJncywgYXJnc2xlbik7CiAgICAgfQogICAgIHJldHVybiB0cnVlOwog
fQogCiBpbmxpbmUgSlNPYmplY3QgKgogSlNPYmplY3Q6OmdldEJvdW5kRnVuY3Rpb25UYXJnZXQo
KSBjb25zdAogewogICAgIEpTX0FTU0VSVChpc0Z1bmN0aW9uKCkpOwpAQCAtMjI2NywyNiArMjI2
NiwzMyBAQCBpbmxpbmUgY29uc3QganM6OlZhbHVlICYKIEpTT2JqZWN0OjpnZXRCb3VuZEZ1bmN0
aW9uVGhpcygpIGNvbnN0CiB7CiAgICAgSlNfQVNTRVJUKGlzRnVuY3Rpb24oKSk7CiAgICAgSlNf
QVNTRVJUKGlzQm91bmRGdW5jdGlvbigpKTsKIAogICAgIHJldHVybiBnZXRTbG90KEpTU0xPVF9C
T1VORF9GVU5DVElPTl9USElTKTsKIH0KIAotaW5saW5lIGNvbnN0IGpzOjpWYWx1ZSAqCi1KU09i
amVjdDo6Z2V0Qm91bmRGdW5jdGlvbkFyZ3VtZW50cyh1aW50TiAmYXJnc2xlbikgY29uc3QKK2lu
bGluZSBjb25zdCBqczo6VmFsdWUgJgorSlNPYmplY3Q6OmdldEJvdW5kRnVuY3Rpb25Bcmd1bWVu
dCh1aW50TiB3aGljaCkgY29uc3QKIHsKICAgICBKU19BU1NFUlQoaXNGdW5jdGlvbigpKTsKICAg
ICBKU19BU1NFUlQoaXNCb3VuZEZ1bmN0aW9uKCkpOwotCi0gICAgYXJnc2xlbiA9IGdldFNsb3Qo
SlNTTE9UX0JPVU5EX0ZVTkNUSU9OX0FSR1NfQ09VTlQpLnRvUHJpdmF0ZVVpbnQzMigpOwotICAg
IEpTX0FTU0VSVF9JRihhcmdzbGVuID4gMCwgbnVtU2xvdHMoKSA+PSBhcmdzbGVuKTsKLQotICAg
IHJldHVybiBnZXRTbG90cygpICsgRlVOX0NMQVNTX1JFU0VSVkVEX1NMT1RTOworICAgIEpTX0FT
U0VSVCh3aGljaCA8IGdldEJvdW5kRnVuY3Rpb25Bcmd1bWVudENvdW50KCkpOworCisgICAgcmV0
dXJuIGdldFNsb3QoRlVOX0NMQVNTX1JFU0VSVkVEX1NMT1RTICsgd2hpY2gpOworfQorCitpbmxp
bmUgc2l6ZV90CitKU09iamVjdDo6Z2V0Qm91bmRGdW5jdGlvbkFyZ3VtZW50Q291bnQoKSBjb25z
dAoreworICAgIEpTX0FTU0VSVChpc0Z1bmN0aW9uKCkpOworICAgIEpTX0FTU0VSVChpc0JvdW5k
RnVuY3Rpb24oKSk7CisKKyAgICByZXR1cm4gZ2V0U2xvdChKU1NMT1RfQk9VTkRfRlVOQ1RJT05f
QVJHU19DT1VOVCkudG9Qcml2YXRlVWludDMyKCk7CiB9CiAKIG5hbWVzcGFjZSBqcyB7CiAKIC8q
IEVTNSAxNS4zLjQuNS4xIGFuZCAxNS4zLjQuNS4yLiAqLwogSlNCb29sCiBDYWxsT3JDb25zdHJ1
Y3RCb3VuZEZ1bmN0aW9uKEpTQ29udGV4dCAqY3gsIHVpbnROIGFyZ2MsIFZhbHVlICp2cCkKIHsK
QEAgLTIyOTQsMTggKzIzMDAsMTcgQEAgQ2FsbE9yQ29uc3RydWN0Qm91bmRGdW5jdGlvbihKU0Nv
bnRleHQgKgogICAgIEpTX0FTU0VSVChvYmotPmlzRnVuY3Rpb24oKSk7CiAgICAgSlNfQVNTRVJU
KG9iai0+aXNCb3VuZEZ1bmN0aW9uKCkpOwogCiAgICAgTGVhdmVUcmFjZShjeCk7CiAKICAgICBi
b29sIGNvbnN0cnVjdGluZyA9IElzQ29uc3RydWN0aW5nKHZwKTsKIAogICAgIC8qIDE1LjMuNC41
LjEgc3RlcCAxLCAxNS4zLjQuNS4yIHN0ZXAgMy4gKi8KLSAgICB1aW50TiBhcmdzbGVuOwotICAg
IGNvbnN0IFZhbHVlICpib3VuZEFyZ3MgPSBvYmotPmdldEJvdW5kRnVuY3Rpb25Bcmd1bWVudHMo
YXJnc2xlbik7CisgICAgdWludE4gYXJnc2xlbiA9IG9iai0+Z2V0Qm91bmRGdW5jdGlvbkFyZ3Vt
ZW50Q291bnQoKTsKIAogICAgIGlmIChhcmdjICsgYXJnc2xlbiA+IEpTX0FSR1NfTEVOR1RIX01B
WCkgewogICAgICAgICBqc19SZXBvcnRBbGxvY2F0aW9uT3ZlcmZsb3coY3gpOwogICAgICAgICBy
ZXR1cm4gZmFsc2U7CiAgICAgfQogCiAgICAgLyogMTUuMy40LjUuMSBzdGVwIDMsIDE1LjMuNC41
LjIgc3RlcCAxLiAqLwogICAgIEpTT2JqZWN0ICp0YXJnZXQgPSBvYmotPmdldEJvdW5kRnVuY3Rp
b25UYXJnZXQoKTsKQEAgLTIzMTMsMTcgKzIzMTgsMTggQEAgQ2FsbE9yQ29uc3RydWN0Qm91bmRG
dW5jdGlvbihKU0NvbnRleHQgKgogICAgIC8qIDE1LjMuNC41LjEgc3RlcCAyLiAqLwogICAgIGNv
bnN0IFZhbHVlICZib3VuZFRoaXMgPSBvYmotPmdldEJvdW5kRnVuY3Rpb25UaGlzKCk7CiAKICAg
ICBJbnZva2VBcmdzR3VhcmQgYXJnczsKICAgICBpZiAoIWN4LT5zdGFjaygpLnB1c2hJbnZva2VB
cmdzKGN4LCBhcmdjICsgYXJnc2xlbiwgJmFyZ3MpKQogICAgICAgICByZXR1cm4gZmFsc2U7CiAK
ICAgICAvKiAxNS4zLjQuNS4xLCAxNS4zLjQuNS4yIHN0ZXAgNC4gKi8KLSAgICBtZW1jcHkoYXJn
cy5hcmd2KCksIGJvdW5kQXJncywgYXJnc2xlbiAqIHNpemVvZihWYWx1ZSkpOworICAgIGZvciAo
dWludE4gaSA9IDA7IGkgPCBhcmdzbGVuOyBpKyspCisgICAgICAgIGFyZ3NbaV0gPSBvYmotPmdl
dEJvdW5kRnVuY3Rpb25Bcmd1bWVudChpKTsKICAgICBtZW1jcHkoYXJncy5hcmd2KCkgKyBhcmdz
bGVuLCB2cCArIDIsIGFyZ2MgKiBzaXplb2YoVmFsdWUpKTsKIAogICAgIC8qIDE1LjMuNC41LjEs
IDE1LjMuNC41LjIgc3RlcCA1LiAqLwogICAgIGFyZ3MuY2FsbGVlKCkuc2V0T2JqZWN0KCp0YXJn
ZXQpOwogCiAgICAgaWYgKCFjb25zdHJ1Y3RpbmcpCiAgICAgICAgIGFyZ3MudGhpc3YoKSA9IGJv
dW5kVGhpczsKIApkaWZmIC0tZ2l0IGEvanMvc3JjL2pzZ2MuY3BwIGIvanMvc3JjL2pzZ2MuY3Bw
Ci0tLSBhL2pzL3NyYy9qc2djLmNwcAorKysgYi9qcy9zcmMvanNnYy5jcHAKQEAgLTI2MzMsMzEg
KzI2MzMsNDAgQEAganNfR0MoSlNDb250ZXh0ICpjeCwgSlNDb21wYXJ0bWVudCAqY29tcAogICAg
ICAgICAgKi8KICAgICB9IHdoaWxlIChnY2tpbmQgPT0gR0NfTEFTVF9DT05URVhUICYmIHJ0LT5n
Y1Bva2UpOwogI2lmZGVmIEpTX0dDTUVURVIKICAgICBqc19EdW1wR0NTdGF0cyhjeC0+cnVudGlt
ZSwgc3RkZXJyKTsKICNlbmRpZgogICAgIEdDVElNRVJfRU5EKGdja2luZCA9PSBHQ19MQVNUX0NP
TlRFWFQpOwogfQogCi1uYW1lc3BhY2UganMgewotbmFtZXNwYWNlIGdjIHsKLQogdm9pZAotTWFy
a09iamVjdFNsb3RzKEpTVHJhY2VyICp0cmMsIEpTT2JqZWN0ICpvYmopCitKU09iamVjdDo6bWFy
a1Nsb3RzKEpTVHJhY2VyICp0cmMpCiB7Ci0gICAgSlNfQVNTRVJUKG9iai0+c2xvdFNwYW4oKSA8
PSBvYmotPm51bVNsb3RzKCkpOwotICAgIHVpbnQzMiBuc2xvdHMgPSBvYmotPnNsb3RTcGFuKCk7
Ci0gICAgZm9yICh1aW50MzIgaSA9IDA7IGkgIT0gbnNsb3RzOyArK2kpIHsKLSAgICAgICAgY29u
c3QgVmFsdWUgJnYgPSBvYmotPmdldFNsb3QoaSk7Ci0gICAgICAgIEpTX1NFVF9UUkFDSU5HX0RF
VEFJTFModHJjLCBqc19QcmludE9iamVjdFNsb3ROYW1lLCBvYmosIGkpOworICAgIEpTX0FTU0VS
VChpc05hdGl2ZSgpKTsKKyAgICBKU19BU1NFUlQoc2xvdFNwYW4oKSA8PSBudW1TbG90cygpKTsK
KyAgICB1aW50MzIgbmZpeGVkID0gbnVtRml4ZWRTbG90cygpOworICAgIHVpbnQzMiBuc2xvdHMg
PSBzbG90U3BhbigpOworICAgIHVpbnQzMiBpOworICAgIGZvciAoaSA9IDA7IGkgPCBuc2xvdHMg
JiYgaSA8IG5maXhlZDsgaSsrKSB7CisgICAgICAgIGNvbnN0IFZhbHVlICZ2ID0gZml4ZWRTbG90
cygpW2ldOworICAgICAgICBKU19TRVRfVFJBQ0lOR19ERVRBSUxTKHRyYywganNfUHJpbnRPYmpl
Y3RTbG90TmFtZSwgdGhpcywgaSk7CisgICAgICAgIE1hcmtWYWx1ZVJhdyh0cmMsIHYpOworICAg
IH0KKyAgICBmb3IgKDsgaSA8IG5zbG90czsgaSsrKSB7CisgICAgICAgIGNvbnN0IFZhbHVlICZ2
ID0gc2xvdHNbaSAtIG5maXhlZF07CisgICAgICAgIEpTX1NFVF9UUkFDSU5HX0RFVEFJTFModHJj
LCBqc19QcmludE9iamVjdFNsb3ROYW1lLCB0aGlzLCBpKTsKICAgICAgICAgTWFya1ZhbHVlUmF3
KHRyYywgdik7CiAgICAgfQogfQogCisKK25hbWVzcGFjZSBqcyB7CituYW1lc3BhY2UgZ2Mgewor
CiBib29sCiBTZXRQcm90b0NoZWNraW5nRm9yQ3ljbGVzKEpTQ29udGV4dCAqY3gsIEpTT2JqZWN0
ICpvYmosIEpTT2JqZWN0ICpwcm90bykKIHsKICAgICAvKgogICAgICAqIFRoaXMgZnVuY3Rpb24g
Y2Fubm90IGJlIGNhbGxlZCBkdXJpbmcgdGhlIEdDIGFuZCBhbHdheXMgcmVxdWlyZXMgYQogICAg
ICAqIHJlcXVlc3QuCiAgICAgICovCiAjaWZkZWYgSlNfVEhSRUFEU0FGRQpkaWZmIC0tZ2l0IGEv
anMvc3JjL2pzZ2NpbmxpbmVzLmggYi9qcy9zcmMvanNnY2lubGluZXMuaAotLS0gYS9qcy9zcmMv
anNnY2lubGluZXMuaAorKysgYi9qcy9zcmMvanNnY2lubGluZXMuaApAQCAtMTE1LDI0ICsxMTUs
MjggQEAgR2V0R0NUaGluZ1RyYWNlS2luZChjb25zdCB2b2lkICp0aGluZykKICAgICAgICAgcmV0
dXJuIEpTVFJBQ0VfU1RSSU5HOwogICAgIGNvbnN0IENlbGwgKmNlbGwgPSByZWludGVycHJldF9j
YXN0PGNvbnN0IENlbGwgKj4odGhpbmcpOwogICAgIHJldHVybiBHZXRGaW5hbGl6YWJsZVRyYWNl
S2luZChjZWxsLT5hcmVuYSgpLT5oZWFkZXIoKS0+dGhpbmdLaW5kKTsKIH0KIAogLyogQ2FwYWNp
dHkgZm9yIHNsb3RzVG9UaGluZ0tpbmQgKi8KIGNvbnN0IHNpemVfdCBTTE9UU19UT19USElOR19L
SU5EX0xJTUlUID0gMTc7CiAKLS8qIEdldCB0aGUgYmVzdCBraW5kIHRvIHVzZSB3aGVuIG1ha2lu
ZyBhbiBvYmplY3Qgd2l0aCB0aGUgZ2l2ZW4gc2xvdCBjb3VudC4gKi8KKy8qCisgKiBHZXQgdGhl
IGJlc3Qga2luZCB0byB1c2Ugd2hlbiBtYWtpbmcgYW4gb2JqZWN0IHdpdGggdGhlIGdpdmVuIHNs
b3QgY291bnQuCisgKiBmYWxsYmFjayBpcyB0aGUga2luZCB0byB1c2UgaWYgdGhlIG51bWJlciBv
ZiBzbG90cyBleGNlZWRzIHRoZSBtYXhpbXVtCisgKiBudW1iZXIgb2YgZml4ZWQgc2xvdHMgZm9y
IGFuIG9iamVjdC4KKyAqLwogc3RhdGljIGlubGluZSBGaW5hbGl6ZUtpbmQKLUdldEdDT2JqZWN0
S2luZChzaXplX3QgbnVtU2xvdHMpCitHZXRHQ09iamVjdEtpbmQoc2l6ZV90IG51bVNsb3RzLCBG
aW5hbGl6ZUtpbmQgZmFsbGJhY2sgPSBGSU5BTElaRV9PQkpFQ1QwKQogewogICAgIGV4dGVybiBG
aW5hbGl6ZUtpbmQgc2xvdHNUb1RoaW5nS2luZFtdOwogCiAgICAgaWYgKG51bVNsb3RzID49IFNM
T1RTX1RPX1RISU5HX0tJTkRfTElNSVQpCi0gICAgICAgIHJldHVybiBGSU5BTElaRV9PQkpFQ1Qw
OworICAgICAgICByZXR1cm4gRklOQUxJWkVfT0JKRUNUMTY7CiAgICAgcmV0dXJuIHNsb3RzVG9U
aGluZ0tpbmRbbnVtU2xvdHNdOwogfQogCiAvKiBHZXQgdGhlIG51bWJlciBvZiBmaXhlZCBzbG90
cyBhbmQgaW5pdGlhbCBjYXBhY2l0eSBhc3NvY2lhdGVkIHdpdGggYSBraW5kLiAqLwogc3RhdGlj
IGlubGluZSBzaXplX3QKIEdldEdDS2luZFNsb3RzKEZpbmFsaXplS2luZCB0aGluZ0tpbmQpCiB7
CiAgICAgLyogVXNpbmcgYSBzd2l0Y2ggaW4gaG9wZXMgdGhhdCB0aGluZ0tpbmQgd2lsbCB1c3Vh
bGx5IGJlIGEgY29tcGlsZS10aW1lIGNvbnN0YW50LiAqLwpAQCAtMzcyLDE5ICszNzYsMTYgQEAg
SlNPYmplY3Q6OnRyYWNlKEpTVHJhY2VyICp0cmMpCiAgICAgICAgIH0KICAgICAgICAgb2JqU2hh
cGUgPSBuZXdTaGFwZTsKICAgICB9CiB9CiAKIG5hbWVzcGFjZSBqcyB7CiBuYW1lc3BhY2UgZ2Mg
ewogCi12b2lkCi1NYXJrT2JqZWN0U2xvdHMoSlNUcmFjZXIgKnRyYywgSlNPYmplY3QgKm9iaik7
Ci0KIHN0YXRpYyBpbmxpbmUgdm9pZAogTWFya0NoaWxkcmVuKEpTVHJhY2VyICp0cmMsIEpTT2Jq
ZWN0ICpvYmopCiB7CiAgICAgLyogSWYgb2JqIGhhcyBubyBtYXAsIGl0IG11c3QgYmUgYSBuZXdi
b3JuLiAqLwogICAgIGlmICghb2JqLT5tYXApCiAgICAgICAgIHJldHVybjsKIAogICAgIC8qIFRy
YWNlIHVuaXZlcnNhbCAob3BzLWluZGVwZW5kZW50KSBtZW1iZXJzLiAqLwpAQCAtNDA4LDE3ICs0
MDksMTcgQEAgTWFya0NoaWxkcmVuKEpTVHJhY2VyICp0cmMsIEpTT2JqZWN0ICpvYgogICAgIGlm
IChvYmotPmlzTmF0aXZlKCkpIHsKICNpZmRlZiBKU19EVU1QX1NDT1BFX01FVEVSUwogICAgICAg
ICBqczo6TWV0ZXJFbnRyeUNvdW50KG9iai0+cHJvcGVydHlDb3VudCk7CiAjZW5kaWYKIAogICAg
ICAgICBvYmotPnRyYWNlKHRyYyk7CiAKICAgICAgICAgaWYgKG9iai0+c2xvdFNwYW4oKSA+IDAp
Ci0gICAgICAgICAgICBNYXJrT2JqZWN0U2xvdHModHJjLCBvYmopOworICAgICAgICAgICAgb2Jq
LT5tYXJrU2xvdHModHJjKTsKICAgICB9CiB9CiAKIHN0YXRpYyBpbmxpbmUgdm9pZAogTWFya0No
aWxkcmVuKEpTVHJhY2VyICp0cmMsIEpTU3RyaW5nICpzdHIpCiB7CiAgICAgaWYgKHN0ci0+aXNE
ZXBlbmRlbnQoKSkKICAgICAgICAgTWFya1N0cmluZyh0cmMsIHN0ci0+YXNEZXBlbmRlbnQoKS5i
YXNlKCksICJiYXNlIik7CmRpZmYgLS1naXQgYS9qcy9zcmMvanNvYmouY3BwIGIvanMvc3JjL2pz
b2JqLmNwcAotLS0gYS9qcy9zcmMvanNvYmouY3BwCisrKyBiL2pzL3NyYy9qc29iai5jcHAKQEAg
LTMyNDksMTcgKzMyNDksMTcgQEAganNfTmV3QmxvY2tPYmplY3QoSlNDb250ZXh0ICpjeCkKIH0K
IAogSlNPYmplY3QgKgoganNfQ2xvbmVCbG9ja09iamVjdChKU0NvbnRleHQgKmN4LCBKU09iamVj
dCAqcHJvdG8sIEpTU3RhY2tGcmFtZSAqZnApCiB7CiAgICAgSlNfQVNTRVJUKHByb3RvLT5pc1N0
YXRpY0Jsb2NrKCkpOwogCiAgICAgc2l6ZV90IGNvdW50ID0gT0JKX0JMT0NLX0NPVU5UKGN4LCBw
cm90byk7Ci0gICAgZ2M6OkZpbmFsaXplS2luZCBraW5kID0gZ2M6OkdldEdDT2JqZWN0S2luZChj
b3VudCArIDEpOworICAgIGdjOjpGaW5hbGl6ZUtpbmQga2luZCA9IGdjOjpHZXRHQ09iamVjdEtp
bmQoY291bnQgKyAxLCBnYzo6RklOQUxJWkVfT0JKRUNUMik7CiAKICAgICBKU09iamVjdCAqY2xv
bmUgPSBqc19OZXdHQ09iamVjdChjeCwga2luZCk7CiAgICAgaWYgKCFjbG9uZSkKICAgICAgICAg
cmV0dXJuIE5VTEw7CiAKICAgICBKU1N0YWNrRnJhbWUgKnByaXYgPSBqc19GbG9hdGluZ0ZyYW1l
SWZHZW5lcmF0b3IoY3gsIGZwKTsKIAogICAgIC8qIFRoZSBjYWxsZXIgc2V0cyBwYXJlbnQgb24g
aXRzIG93bi4gKi8KQEAgLTMyOTIsMTcgKzMyOTIsMTcgQEAganNfUHV0QmxvY2tPYmplY3QoSlND
b250ZXh0ICpjeCwgSlNCb29sIAogICAgIEpTX0FTU0VSVChjb3VudCA8PSBzaXplX3QoY3gtPnJl
Z3MtPnNwIC0gZnAtPmJhc2UoKSAtIGRlcHRoKSk7CiAKICAgICAvKiBTZWUgY29tbWVudHMgaW4g
Q2hlY2tEZXN0cnVjdHVyaW5nIGZyb20ganNwYXJzZS5jcHAuICovCiAgICAgSlNfQVNTRVJUKGNv
dW50ID49IDEpOwogCiAgICAgaWYgKG5vcm1hbFVud2luZCkgewogICAgICAgICB1aW50TiBzbG90
ID0gSlNTTE9UX0JMT0NLX0ZJUlNUX0ZSRUVfU0xPVDsKICAgICAgICAgZGVwdGggKz0gZnAtPm51
bUZpeGVkKCk7Ci0gICAgICAgIG1lbWNweShvYmotPmdldFNsb3RzKCkgKyBzbG90LCBmcC0+c2xv
dHMoKSArIGRlcHRoLCBjb3VudCAqIHNpemVvZihWYWx1ZSkpOworICAgICAgICBvYmotPmNvcHlT
bG90UmFuZ2Uoc2xvdCwgZnAtPnNsb3RzKCkgKyBkZXB0aCwgY291bnQpOwogICAgIH0KIAogICAg
IC8qIFdlIG11c3QgY2xlYXIgdGhlIHByaXZhdGUgc2xvdCBldmVuIHdpdGggZXJyb3JzLiAqLwog
ICAgIG9iai0+c2V0UHJpdmF0ZShOVUxMKTsKICAgICBmcC0+c2V0U2NvcGVDaGFpbk5vQ2FsbE9i
aigqb2JqLT5nZXRQYXJlbnQoKSk7CiAgICAgcmV0dXJuIG5vcm1hbFVud2luZDsKIH0KIApAQCAt
MzM2OCwyNCArMzM2OCwxNiBAQCBKU09iamVjdDo6ZGVmaW5lQmxvY2tWYXJpYWJsZShKU0NvbnRl
eHQgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgU2hhcGU6OkhBU19TSE9S
VElELCBpbmRleCk7CiAgICAgaWYgKCFzaGFwZSkKICAgICAgICAgcmV0dXJuIE5VTEw7CiAgICAg
aWYgKHNsb3QgPj0gbnVtU2xvdHMoKSAmJiAhZ3Jvd1Nsb3RzKGN4LCBzbG90ICsgMSkpCiAgICAg
ICAgIHJldHVybiBOVUxMOwogICAgIHJldHVybiBzaGFwZTsKIH0KIAotc3RhdGljIHNpemVfdAot
R2V0T2JqZWN0U2l6ZShKU09iamVjdCAqb2JqKQotewotICAgIHJldHVybiAob2JqLT5pc0Z1bmN0
aW9uKCkgJiYgIW9iai0+Z2V0UHJpdmF0ZSgpKQotICAgICAgICAgICA/IHNpemVvZihKU0Z1bmN0
aW9uKQotICAgICAgICAgICA6IHNpemVvZihKU09iamVjdCkgKyBzaXplb2YoanM6OlZhbHVlKSAq
IG9iai0+bnVtRml4ZWRTbG90cygpOwotfQotCiBib29sCiBKU09iamVjdDo6Y29weVByb3BlcnRp
ZXNGcm9tKEpTQ29udGV4dCAqY3gsIEpTT2JqZWN0ICpvYmopCiB7CiAgICAgLy8gSWYgd2UncmUg
bm90IG5hdGl2ZSwgdGhlbiB3ZSBjYW5ub3QgY29weSBwcm9wZXJ0aWVzLgogICAgIEpTX0FTU0VS
VChpc05hdGl2ZSgpID09IG9iai0+aXNOYXRpdmUoKSk7CiAgICAgaWYgKCFpc05hdGl2ZSgpKQog
ICAgICAgICByZXR1cm4gdHJ1ZTsKIApAQCAtMzQyMCwyNiArMzQxMiwyNiBAQCBDb3B5U2xvdHMo
SlNDb250ZXh0ICpjeCwgSlNPYmplY3QgKmZyb20sCiAgICAgSlNfQVNTRVJUKCFmcm9tLT5pc05h
dGl2ZSgpICYmICF0by0+aXNOYXRpdmUoKSk7CiAgICAgc2l6ZV90IG5zbG90cyA9IGZyb20tPm51
bVNsb3RzKCk7CiAgICAgaWYgKHRvLT5lbnN1cmVTbG90cyhjeCwgbnNsb3RzKSkKICAgICAgICAg
cmV0dXJuIGZhbHNlOwogCiAgICAgc2l6ZV90IG4gPSAwOwogICAgIGlmICh0by0+aXNXcmFwcGVy
KCkgJiYKICAgICAgICAgKEpTV3JhcHBlcjo6d3JhcHBlckhhbmRsZXIodG8pLT5mbGFncygpICYg
SlNXcmFwcGVyOjpDUk9TU19DT01QQVJUTUVOVCkpIHsKLSAgICAgICAgdG8tPnNsb3RzWzBdID0g
ZnJvbS0+c2xvdHNbMF07Ci0gICAgICAgIHRvLT5zbG90c1sxXSA9IGZyb20tPnNsb3RzWzFdOwor
ICAgICAgICB0by0+c2V0U2xvdCgwLCBmcm9tLT5nZXRTbG90KDApKTsKKyAgICAgICAgdG8tPnNl
dFNsb3QoMSwgZnJvbS0+Z2V0U2xvdCgxKSk7CiAgICAgICAgIG4gPSAyOwogICAgIH0KIAogICAg
IGZvciAoOyBuIDwgbnNsb3RzOyArK24pIHsKLSAgICAgICAgVmFsdWUgdiA9IGZyb20tPnNsb3Rz
W25dOworICAgICAgICBWYWx1ZSB2ID0gZnJvbS0+Z2V0U2xvdChuKTsKICAgICAgICAgaWYgKCFj
eC0+Y29tcGFydG1lbnQtPndyYXAoY3gsICZ2KSkKICAgICAgICAgICAgIHJldHVybiBmYWxzZTsK
LSAgICAgICAgdG8tPnNsb3RzW25dID0gdjsKKyAgICAgICAgdG8tPnNldFNsb3Qobiwgdik7CiAg
ICAgfQogICAgIHJldHVybiB0cnVlOwogfQogCiBKU09iamVjdCAqCiBKU09iamVjdDo6Y2xvbmUo
SlNDb250ZXh0ICpjeCwgSlNPYmplY3QgKnByb3RvLCBKU09iamVjdCAqcGFyZW50KQogewogICAg
IC8qCkBAIC0zNDczLDEwMyArMzQ2NSwxMDEgQEAgSlNPYmplY3Q6OmNsb25lKEpTQ29udGV4dCAq
Y3gsIEpTT2JqZWN0IAogICAgIH0gZWxzZSB7CiAgICAgICAgIEpTX0FTU0VSVChpc1Byb3h5KCkp
OwogICAgICAgICBpZiAoIUNvcHlTbG90cyhjeCwgdGhpcywgY2xvbmUpKQogICAgICAgICAgICAg
cmV0dXJuIE5VTEw7CiAgICAgfQogICAgIHJldHVybiBjbG9uZTsKIH0KIAotc3RhdGljIHZvaWQK
LVRyYWRlR3V0cyhKU09iamVjdCAqYSwgSlNPYmplY3QgKmIpCitib29sCitKU09iamVjdDo6VHJh
ZGVHdXRzKEpTQ29udGV4dCAqY3gsIEpTT2JqZWN0ICphLCBKU09iamVjdCAqYikKIHsKICAgICBK
U19BU1NFUlQoYS0+Y29tcGFydG1lbnQoKSA9PSBiLT5jb21wYXJ0bWVudCgpKTsKICAgICBKU19B
U1NFUlQoYS0+aXNGdW5jdGlvbigpID09IGItPmlzRnVuY3Rpb24oKSk7CiAKICAgICAvKgogICAg
ICAqIFJlZ2V4cCBndXRzIGFyZSBtb3JlIGNvbXBsaWNhdGVkIC0tIHdlIHdvdWxkIG5lZWQgdG8g
bWlncmF0ZSB0aGUKICAgICAgKiByZWZjb3VudGVkIEpJVCBjb2RlIGJsb2IgZm9yIHRoZW0gYWNy
b3NzIGNvbXBhcnRtZW50cyBpbnN0ZWFkIG9mIGp1c3QKICAgICAgKiBzd2FwcGluZyBndXRzLgog
ICAgICAqLwogICAgIEpTX0FTU0VSVCghYS0+aXNSZWdFeHAoKSAmJiAhYi0+aXNSZWdFeHAoKSk7
CiAKLSAgICBib29sIGFJbmxpbmUgPSAhYS0+aGFzU2xvdHNBcnJheSgpOwotICAgIGJvb2wgYklu
bGluZSA9ICFiLT5oYXNTbG90c0FycmF5KCk7CisgICAgLyoKKyAgICAgKiBDYWxsZXJzIHNob3Vs
ZCBub3QgdHJ5IHRvIHN3YXAgZGVuc2UgYXJyYXlzLCB0aGVzZSB1c2UgYSBkaWZmZXJlbnQgc2xv
dAorICAgICAqIHJlcHJlc2VudGF0aW9uIGZyb20gb3RoZXIgb2JqZWN0cy4KKyAgICAgKi8KKyAg
ICBKU19BU1NFUlQoIWEtPmlzRGVuc2VBcnJheSgpICYmICFiLT5pc0RlbnNlQXJyYXkoKSk7CiAK
ICAgICAvKiBUcmFkZSB0aGUgZ3V0cyBvZiB0aGUgb2JqZWN0cy4gKi8KLSAgICBjb25zdCBzaXpl
X3Qgc2l6ZSA9IEdldE9iamVjdFNpemUoYSk7Ci0gICAgaWYgKHNpemUgPT0gR2V0T2JqZWN0U2l6
ZShiKSkgeworICAgIGNvbnN0IHNpemVfdCBzaXplID0gYS0+c3RydWN0U2l6ZSgpOworICAgIGlm
IChzaXplID09IGItPnN0cnVjdFNpemUoKSkgewogICAgICAgICAvKgogICAgICAgICAgKiBJZiB0
aGUgb2JqZWN0cyBhcmUgdGhlIHNhbWUgc2l6ZSwgdGhlbiB3ZSBtYWtlIG5vIGFzc3VtcHRpb25z
IGFib3V0CiAgICAgICAgICAqIHdoZXRoZXIgdGhleSBoYXZlIGR5bmFtaWNhbGx5IGFsbG9jYXRl
ZCBzbG90cyBhbmQgaW5zdGVhZCBqdXN0IGNvcHkKICAgICAgICAgICogdGhlbSBvdmVyIHdob2xl
c2FsZS4KICAgICAgICAgICovCiAgICAgICAgIGNoYXIgdG1wW3RsOjpNYXg8c2l6ZW9mKEpTRnVu
Y3Rpb24pLCBzaXplb2YoSlNPYmplY3RfU2xvdHMxNik+OjpyZXN1bHRdOwogICAgICAgICBKU19B
U1NFUlQoc2l6ZSA8PSBzaXplb2YodG1wKSk7CiAKICAgICAgICAgbWVtY3B5KHRtcCwgYSwgc2l6
ZSk7CiAgICAgICAgIG1lbWNweShhLCBiLCBzaXplKTsKICAgICAgICAgbWVtY3B5KGIsIHRtcCwg
c2l6ZSk7Ci0KLSAgICAgICAgLyogRml4dXAgcG9pbnRlcnMgZm9yIGlubGluZSBzbG90cyBvbiB0
aGUgb2JqZWN0cy4gKi8KLSAgICAgICAgaWYgKGFJbmxpbmUpCi0gICAgICAgICAgICBiLT5zbG90
cyA9IGItPmZpeGVkU2xvdHMoKTsKLSAgICAgICAgaWYgKGJJbmxpbmUpCi0gICAgICAgICAgICBh
LT5zbG90cyA9IGEtPmZpeGVkU2xvdHMoKTsKICAgICB9IGVsc2UgewogICAgICAgICAvKgotICAg
ICAgICAgKiBJZiB0aGUgb2JqZWN0cyBhcmUgb2YgZGlmZmVyaW5nIHNpemVzLCB0aGVuIHdlIG9u
bHkgY29weSBvdmVyIHRoZQotICAgICAgICAgKiBKU09iamVjdCBwb3J0aW9uICh0aGluZ3MgbGlr
ZSBjbGFzcywgZXRjLikgYW5kIGxlYXZlIGl0IHRvCi0gICAgICAgICAqIEpTT2JqZWN0OjpjbG9u
ZSB0byBjb3B5IG92ZXIgdGhlIGR5bmFtaWMgc2xvdHMgZm9yIHVzLgorICAgICAgICAgKiBJZiB0
aGUgb2JqZWN0cyBhcmUgb2YgZGlmZmVyaW5nIHNpemVzLCB0aGVuIHdlIG5lZWQgdG8gZ2V0IGFy
cmF5cyBvZgorICAgICAgICAgKiBhbGwgdGhlIHNsb3RzIGFuZCBjb3B5IHRoZW0gb3ZlciBtYW51
YWxseTsgd2hldGhlciBhIGdpdmVuIHNsb3QgaXMKKyAgICAgICAgICogaW5saW5lIG9yIG5vdCB3
aWxsIHZhcnkgYmV0d2VlbiB0aGUgb2JqZWN0cy4gVGhpcyBzaXR1YXRpb24gbXVzdAorICAgICAg
ICAgKiBvbmx5IGhhcHBlbiB3aGVuIHdlIGFyZSBzd2FwcGluZyBwcm94aWVzLCB3aGljaCBhcmUg
bm9uLW5hdGl2ZSBhbmQKKyAgICAgICAgICogdGh1cyBkbyBub3QgaGF2ZSBzaGFwZXMgZGVwZW5k
aW5nIG9uIHRoZSBudW1iZXIgb2YgaW5saW5lIHNsb3RzLgogICAgICAgICAgKi8KKyAgICAgICAg
SlNfQVNTRVJUKGEtPmlzUHJveHkoKSAmJiBiLT5pc1Byb3h5KCkpOworCisgICAgICAgIEF1dG9W
YWx1ZVZlY3RvciBhdmFscyhjeCk7CisgICAgICAgIGlmICghYXZhbHMucmVzZXJ2ZShhLT5udW1T
bG90cygpKSkKKyAgICAgICAgICAgIHJldHVybiBmYWxzZTsKKyAgICAgICAgZm9yIChzaXplX3Qg
aSA9IDA7IGkgPCBhLT5udW1TbG90cygpOyBpKyspCisgICAgICAgICAgICBhdmFscy5pbmZhbGxp
YmxlQXBwZW5kKGEtPmdldFNsb3QoaSkpOworCisgICAgICAgIEF1dG9WYWx1ZVZlY3RvciBidmFs
cyhjeCk7CisgICAgICAgIGlmICghYnZhbHMucmVzZXJ2ZShiLT5udW1TbG90cygpKSkKKyAgICAg
ICAgICAgIHJldHVybiBmYWxzZTsKKyAgICAgICAgZm9yIChzaXplX3QgaSA9IDA7IGkgPCBiLT5u
dW1TbG90cygpOyBpKyspCisgICAgICAgICAgICBidmFscy5pbmZhbGxpYmxlQXBwZW5kKGItPmdl
dFNsb3QoaSkpOworCiAgICAgICAgIGlmIChhLT5pc0Z1bmN0aW9uKCkpIHsKICAgICAgICAgICAg
IEpTRnVuY3Rpb24gdG1wOwogICAgICAgICAgICAgbWVtY3B5KCZ0bXAsIGEsIHNpemVvZiB0bXAp
OwogICAgICAgICAgICAgbWVtY3B5KGEsIGIsIHNpemVvZiB0bXApOwogICAgICAgICAgICAgbWVt
Y3B5KGIsICZ0bXAsIHNpemVvZiB0bXApOwogICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAg
SlNPYmplY3QgdG1wOwogICAgICAgICAgICAgbWVtY3B5KCZ0bXAsIGEsIHNpemVvZiB0bXApOwog
ICAgICAgICAgICAgbWVtY3B5KGEsIGIsIHNpemVvZiB0bXApOwogICAgICAgICAgICAgbWVtY3B5
KGIsICZ0bXAsIHNpemVvZiB0bXApOwogICAgICAgICB9CiAKLSAgICAgICAgSlNfQVNTRVJUKCFh
SW5saW5lKTsKLSAgICAgICAgSlNfQVNTRVJUKCFiSW5saW5lKTsKLSAgICB9CisgICAgICAgIGEt
PmNvcHlTbG90UmFuZ2UoMCwgYnZhbHMuYmVnaW4oKSwgYS0+bnVtU2xvdHMoKSk7CisgICAgICAg
IGItPmNvcHlTbG90UmFuZ2UoMCwgYXZhbHMuYmVnaW4oKSwgYi0+bnVtU2xvdHMoKSk7CisgICAg
fQorCisgICAgcmV0dXJuIHRydWU7CiB9CiAKIC8qCiAgKiBVc2UgdGhpcyBtZXRob2Qgd2l0aCBl
eHRyZW1lIGNhdXRpb24uIEl0IHRyYWRlcyB0aGUgZ3V0cyBvZiB0d28gb2JqZWN0cyBhbmQgdXBk
YXRlcwogICogc2NvcGUgb3duZXJzaGlwLiBUaGlzIG9wZXJhdGlvbiBpcyBub3QgdGhyZWFkLXNh
ZmUsIGp1c3QgYXMgZmFzdCBhcnJheSB0byBzbG93IGFycmF5CiAgKiB0cmFuc2l0aW9ucyBhcmUg
aW5oZXJlbnRseSBub3QgdGhyZWFkLXNhZmUuIERvbid0IHBlcmZvcm0gYSBzd2FwIG9wZXJhdGlv
biBvbiBvYmplY3RzCiAgKiBzaGFyZWQgYWNyb3NzIHRocmVhZHMgb3IsIG9yIGJhZCB0aGluZ3Mg
d2lsbCBoYXBwZW4uIFlvdSBoYXZlIGJlZW4gd2FybmVkLgogICovCiBib29sCiBKU09iamVjdDo6
c3dhcChKU0NvbnRleHQgKmN4LCBKU09iamVjdCAqb3RoZXIpCiB7Ci0gICAgLyoKLSAgICAgKiBJ
ZiB3ZSBhcmUgc3dhcHBpbmcgb2JqZWN0cyB3aXRoIGEgZGlmZmVyZW50IG51bWJlciBvZiBidWls
dGluIHNsb3RzLCBmb3JjZQotICAgICAqIGJvdGggdG8gbm90IHVzZSB0aGVpciBpbmxpbmUgc2xv
dHMuCi0gICAgICovCi0gICAgaWYgKEdldE9iamVjdFNpemUodGhpcykgIT0gR2V0T2JqZWN0U2l6
ZShvdGhlcikpIHsKLSAgICAgICAgaWYgKCFoYXNTbG90c0FycmF5KCkpIHsKLSAgICAgICAgICAg
IGlmICghYWxsb2NTbG90cyhjeCwgbnVtU2xvdHMoKSkpCi0gICAgICAgICAgICAgICAgcmV0dXJu
IGZhbHNlOwotICAgICAgICB9Ci0gICAgICAgIGlmICghb3RoZXItPmhhc1Nsb3RzQXJyYXkoKSkg
ewotICAgICAgICAgICAgaWYgKCFvdGhlci0+YWxsb2NTbG90cyhjeCwgb3RoZXItPm51bVNsb3Rz
KCkpKQotICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTsKLSAgICAgICAgfQotICAgIH0KLQot
ICAgIGlmICh0aGlzLT5jb21wYXJ0bWVudCgpID09IG90aGVyLT5jb21wYXJ0bWVudCgpKSB7Ci0g
ICAgICAgIFRyYWRlR3V0cyh0aGlzLCBvdGhlcik7Ci0gICAgICAgIHJldHVybiB0cnVlOwotICAg
IH0KKyAgICBpZiAodGhpcy0+Y29tcGFydG1lbnQoKSA9PSBvdGhlci0+Y29tcGFydG1lbnQoKSkK
KyAgICAgICAgcmV0dXJuIFRyYWRlR3V0cyhjeCwgdGhpcywgb3RoZXIpOwogCiAgICAgSlNPYmpl
Y3QgKnRoaXNDbG9uZTsKICAgICBKU09iamVjdCAqb3RoZXJDbG9uZTsKICAgICB7CiAgICAgICAg
IEF1dG9Db21wYXJ0bWVudCBhYyhjeCwgb3RoZXIpOwogICAgICAgICBpZiAoIWFjLmVudGVyKCkp
CiAgICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgIHRoaXNDbG9uZSA9IHRoaXMtPmNs
b25lKGN4LCBvdGhlci0+Z2V0UHJvdG8oKSwgb3RoZXItPmdldFBhcmVudCgpKTsKQEAgLTM1Nzks
MTggKzM1NjksMjAgQEAgSlNPYmplY3Q6OnN3YXAoSlNDb250ZXh0ICpjeCwgSlNPYmplY3QgKgog
ICAgIHsKICAgICAgICAgQXV0b0NvbXBhcnRtZW50IGFjKGN4LCB0aGlzKTsKICAgICAgICAgaWYg
KCFhYy5lbnRlcigpKQogICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgICBvdGhlckNs
b25lID0gb3RoZXItPmNsb25lKGN4LCBvdGhlci0+Z2V0UHJvdG8oKSwgb3RoZXItPmdldFBhcmVu
dCgpKTsKICAgICAgICAgaWYgKCFvdGhlckNsb25lIHx8ICFvdGhlckNsb25lLT5jb3B5UHJvcGVy
dGllc0Zyb20oY3gsIG90aGVyKSkKICAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICB9Ci0g
ICAgVHJhZGVHdXRzKHRoaXMsIG90aGVyQ2xvbmUpOwotICAgIFRyYWRlR3V0cyhvdGhlciwgdGhp
c0Nsb25lKTsKKyAgICBpZiAoIVRyYWRlR3V0cyhjeCwgdGhpcywgb3RoZXJDbG9uZSkpCisgICAg
ICAgIHJldHVybiBmYWxzZTsKKyAgICBpZiAoIVRyYWRlR3V0cyhjeCwgb3RoZXIsIHRoaXNDbG9u
ZSkpCisgICAgICAgIHJldHVybiBmYWxzZTsKIAogICAgIHJldHVybiB0cnVlOwogfQogCiAjaWYg
SlNfSEFTX1hEUgogCiAjZGVmaW5lIE5PX1BBUkVOVF9JTkRFWCAoKHVpbnQzMiktMSkKIApAQCAt
Mzk3NiwzOCArMzk2OCw5MCBAQCBqc19Jbml0Q2xhc3MoSlNDb250ZXh0ICpjeCwgSlNPYmplY3Qg
Km9iCiAgICAgICAgICFqc19HZXRDbGFzc1Byb3RvdHlwZShjeCwgb2JqLCBKU1Byb3RvX09iamVj
dCwgJnByb3RvUHJvdG8pKSB7CiAgICAgICAgIHJldHVybiBOVUxMOwogICAgIH0KIAogICAgIHJl
dHVybiBEZWZpbmVDb25zdHJ1Y3RvckFuZFByb3RvdHlwZShjeCwgb2JqLCBrZXksIGF0b20sIHBy
b3RvUHJvdG8sIGNsYXNwLCBjb25zdHJ1Y3RvciwgbmFyZ3MsCiAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgIHBzLCBmcywgc3RhdGljX3BzLCBzdGF0aWNfZnMpOwogfQog
Cit2b2lkCitKU09iamVjdDo6Y2xlYXJTbG90UmFuZ2Uoc2l6ZV90IHN0YXJ0LCBzaXplX3QgbGVu
Z3RoKQoreworICAgIEpTX0FTU0VSVChzdGFydCArIGxlbmd0aCA8PSBjYXBhY2l0eSk7CisgICAg
aWYgKGlzRGVuc2VBcnJheSgpKSB7CisgICAgICAgIENsZWFyVmFsdWVSYW5nZShzbG90cyArIHN0
YXJ0LCBsZW5ndGgsIHRydWUpOworICAgIH0gZWxzZSB7CisgICAgICAgIHNpemVfdCBmaXhlZCA9
IG51bUZpeGVkU2xvdHMoKTsKKyAgICAgICAgaWYgKHN0YXJ0IDwgZml4ZWQpIHsKKyAgICAgICAg
ICAgIGlmIChzdGFydCArIGxlbmd0aCA8IGZpeGVkKSB7CisgICAgICAgICAgICAgICAgQ2xlYXJW
YWx1ZVJhbmdlKGZpeGVkU2xvdHMoKSArIHN0YXJ0LCBsZW5ndGgsIGZhbHNlKTsKKyAgICAgICAg
ICAgIH0gZWxzZSB7CisgICAgICAgICAgICAgICAgc2l6ZV90IGxvY2FsQ2xlYXIgPSBmaXhlZCAt
IHN0YXJ0OworICAgICAgICAgICAgICAgIENsZWFyVmFsdWVSYW5nZShmaXhlZFNsb3RzKCkgKyBz
dGFydCwgbG9jYWxDbGVhciwgZmFsc2UpOworICAgICAgICAgICAgICAgIENsZWFyVmFsdWVSYW5n
ZShzbG90cywgbGVuZ3RoIC0gbG9jYWxDbGVhciwgZmFsc2UpOworICAgICAgICAgICAgfQorICAg
ICAgICB9IGVsc2UgeworICAgICAgICAgICAgQ2xlYXJWYWx1ZVJhbmdlKHNsb3RzICsgc3RhcnQg
LSBmaXhlZCwgbGVuZ3RoLCBmYWxzZSk7CisgICAgICAgIH0KKyAgICB9Cit9CisKK3ZvaWQKK0pT
T2JqZWN0Ojpjb3B5U2xvdFJhbmdlKHNpemVfdCBzdGFydCwgY29uc3QgVmFsdWUgKnZlY3Rvciwg
c2l6ZV90IGxlbmd0aCkKK3sKKyAgICBKU19BU1NFUlQoc3RhcnQgKyBsZW5ndGggPD0gY2FwYWNp
dHkpOworICAgIGlmIChpc0RlbnNlQXJyYXkoKSkgeworICAgICAgICBtZW1jcHkoc2xvdHMgKyBz
dGFydCwgdmVjdG9yLCBsZW5ndGggKiBzaXplb2YoVmFsdWUpKTsKKyAgICB9IGVsc2UgeworICAg
ICAgICBzaXplX3QgZml4ZWQgPSBudW1GaXhlZFNsb3RzKCk7CisgICAgICAgIGlmIChzdGFydCA8
IGZpeGVkKSB7CisgICAgICAgICAgICBpZiAoc3RhcnQgKyBsZW5ndGggPCBmaXhlZCkgeworICAg
ICAgICAgICAgICAgIG1lbWNweShmaXhlZFNsb3RzKCkgKyBzdGFydCwgdmVjdG9yLCBsZW5ndGgg
KiBzaXplb2YoVmFsdWUpKTsKKyAgICAgICAgICAgIH0gZWxzZSB7CisgICAgICAgICAgICAgICAg
c2l6ZV90IGxvY2FsQ29weSA9IGZpeGVkIC0gc3RhcnQ7CisgICAgICAgICAgICAgICAgbWVtY3B5
KGZpeGVkU2xvdHMoKSArIHN0YXJ0LCB2ZWN0b3IsIGxvY2FsQ29weSAqIHNpemVvZihWYWx1ZSkp
OworICAgICAgICAgICAgICAgIG1lbWNweShzbG90cywgdmVjdG9yICsgbG9jYWxDb3B5LCAobGVu
Z3RoIC0gbG9jYWxDb3B5KSAqIHNpemVvZihWYWx1ZSkpOworICAgICAgICAgICAgfQorICAgICAg
ICB9IGVsc2UgeworICAgICAgICAgICAgbWVtY3B5KHNsb3RzICsgc3RhcnQgLSBmaXhlZCwgdmVj
dG9yLCBsZW5ndGggKiBzaXplb2YoVmFsdWUpKTsKKyAgICAgICAgfQorICAgIH0KK30KKwogYm9v
bAogSlNPYmplY3Q6OmFsbG9jU2xvdHMoSlNDb250ZXh0ICpjeCwgc2l6ZV90IG5ld2NhcCkKIHsK
ICAgICB1aW50MzIgb2xkY2FwID0gbnVtU2xvdHMoKTsKIAogICAgIEpTX0FTU0VSVChuZXdjYXAg
Pj0gb2xkY2FwICYmICFoYXNTbG90c0FycmF5KCkpOwogCiAgICAgaWYgKG5ld2NhcCA+IE5TTE9U
U19MSU1JVCkgewogICAgICAgICBpZiAoIUpTX09OX1RSQUNFKGN4KSkKICAgICAgICAgICAgIGpz
X1JlcG9ydEFsbG9jYXRpb25PdmVyZmxvdyhjeCk7CiAgICAgICAgIHJldHVybiBmYWxzZTsKICAg
ICB9CiAKLSAgICBWYWx1ZSAqdG1wc2xvdHMgPSAoVmFsdWUqKSBjeC0+bWFsbG9jXyhuZXdjYXAg
KiBzaXplb2YoVmFsdWUpKTsKKyAgICB1aW50MzIgYWxsb2NDb3VudCA9IGlzRGVuc2VBcnJheSgp
ID8gbmV3Y2FwIDogbmV3Y2FwIC0gbnVtRml4ZWRTbG90cygpOworCisgICAgVmFsdWUgKnRtcHNs
b3RzID0gKFZhbHVlKikgY3gtPm1hbGxvY18oYWxsb2NDb3VudCAqIHNpemVvZihWYWx1ZSkpOwog
ICAgIGlmICghdG1wc2xvdHMpCiAgICAgICAgIHJldHVybiBmYWxzZTsgIC8qIExlYXZlIHNsb3Rz
IGF0IGlubGluZSBidWZmZXIuICovCiAgICAgc2xvdHMgPSB0bXBzbG90czsKICAgICBjYXBhY2l0
eSA9IG5ld2NhcDsKIAotICAgIC8qIENvcHkgb3ZlciBhbnl0aGluZyBmcm9tIHRoZSBpbmxpbmUg
YnVmZmVyLiAqLwotICAgIG1lbWNweShzbG90cywgZml4ZWRTbG90cygpLCBvbGRjYXAgKiBzaXpl
b2YoVmFsdWUpKTsKLSAgICBDbGVhclZhbHVlUmFuZ2Uoc2xvdHMgKyBvbGRjYXAsIG5ld2NhcCAt
IG9sZGNhcCwgaXNEZW5zZUFycmF5KCkpOworICAgIGlmIChpc0RlbnNlQXJyYXkoKSkgeworICAg
ICAgICAvKiBDb3B5IG92ZXIgYW55dGhpbmcgZnJvbSB0aGUgaW5saW5lIGJ1ZmZlci4gKi8KKyAg
ICAgICAgbWVtY3B5KHNsb3RzLCBmaXhlZFNsb3RzKCksIG9sZGNhcCAqIHNpemVvZihWYWx1ZSkp
OworICAgICAgICBDbGVhclZhbHVlUmFuZ2Uoc2xvdHMgKyBvbGRjYXAsIG5ld2NhcCAtIG9sZGNh
cCwgdHJ1ZSk7CisgICAgfSBlbHNlIHsKKyAgICAgICAgLyogQ2xlYXIgb3V0IHRoZSBuZXcgc2xv
dHMgd2l0aG91dCBjb3B5aW5nLiAqLworICAgICAgICBDbGVhclZhbHVlUmFuZ2Uoc2xvdHMsIGFs
bG9jQ291bnQsIGZhbHNlKTsKKyAgICB9CisKICAgICByZXR1cm4gdHJ1ZTsKIH0KIAogYm9vbAog
SlNPYmplY3Q6Omdyb3dTbG90cyhKU0NvbnRleHQgKmN4LCBzaXplX3QgbmV3Y2FwKQogewogICAg
IC8qCiAgICAgICogV2hlbiBhbiBvYmplY3Qgd2l0aCBDQVBBQ0lUWV9ET1VCTElOR19NQVggb3Ig
ZmV3ZXIgc2xvdHMgbmVlZHMgdG8KQEAgLTQwMzcsNTUgKzQwODEsNjEgQEAgSlNPYmplY3Q6Omdy
b3dTbG90cyhKU0NvbnRleHQgKmN4LCBzaXplXwogICAgICAgICBKU19SZXBvcnRPdXRPZk1lbW9y
eShjeCk7CiAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICB9CiAKICAgICAvKiBJZiBub3RoaW5n
IHdhcyBhbGxvY2F0ZWQgeWV0LCB0cmVhdCBpdCBhcyBpbml0aWFsIGFsbG9jYXRpb24uICovCiAg
ICAgaWYgKCFoYXNTbG90c0FycmF5KCkpCiAgICAgICAgIHJldHVybiBhbGxvY1Nsb3RzKGN4LCBh
Y3R1YWxDYXBhY2l0eSk7CiAKLSAgICBWYWx1ZSAqdG1wc2xvdHMgPSAoVmFsdWUqKSBjeC0+cmVh
bGxvY18oc2xvdHMsIG9sZGNhcCAqIHNpemVvZihWYWx1ZSksIGFjdHVhbENhcGFjaXR5ICogc2l6
ZW9mKFZhbHVlKSk7CisgICAgdWludDMyIG9sZEFsbG9jQ291bnQgPSBpc0RlbnNlQXJyYXkoKSA/
IG9sZGNhcCA6IG9sZGNhcCAtIG51bUZpeGVkU2xvdHMoKTsKKyAgICB1aW50MzIgYWxsb2NDb3Vu
dCA9IGlzRGVuc2VBcnJheSgpID8gYWN0dWFsQ2FwYWNpdHkgOiBhY3R1YWxDYXBhY2l0eSAtIG51
bUZpeGVkU2xvdHMoKTsKKworICAgIFZhbHVlICp0bXBzbG90cyA9IChWYWx1ZSopIGN4LT5yZWFs
bG9jXyhzbG90cywgb2xkQWxsb2NDb3VudCAqIHNpemVvZihWYWx1ZSksCisgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFsbG9jQ291bnQgKiBzaXplb2YoVmFsdWUp
KTsKICAgICBpZiAoIXRtcHNsb3RzKQogICAgICAgICByZXR1cm4gZmFsc2U7ICAgIC8qIExlYXZl
IGRzbG90cyBhcyBpdHMgb2xkIHNpemUuICovCiAgICAgc2xvdHMgPSB0bXBzbG90czsKICAgICBj
YXBhY2l0eSA9IGFjdHVhbENhcGFjaXR5OwogCiAgICAgLyogSW5pdGlhbGl6ZSB0aGUgYWRkaXRp
b25hbCBzbG90cyB3ZSBhZGRlZC4gKi8KLSAgICBDbGVhclZhbHVlUmFuZ2Uoc2xvdHMgKyBvbGRj
YXAsIGFjdHVhbENhcGFjaXR5IC0gb2xkY2FwLCBpc0RlbnNlQXJyYXkoKSk7CisgICAgQ2xlYXJW
YWx1ZVJhbmdlKHNsb3RzICsgb2xkQWxsb2NDb3VudCwgYWxsb2NDb3VudCAtIG9sZEFsbG9jQ291
bnQsIGlzRGVuc2VBcnJheSgpKTsKICAgICByZXR1cm4gdHJ1ZTsKIH0KIAogdm9pZAogSlNPYmpl
Y3Q6OnNocmlua1Nsb3RzKEpTQ29udGV4dCAqY3gsIHNpemVfdCBuZXdjYXApCiB7CiAgICAgdWlu
dDMyIG9sZGNhcCA9IG51bVNsb3RzKCk7CiAgICAgSlNfQVNTRVJUKG5ld2NhcCA8PSBvbGRjYXAp
OwogICAgIEpTX0FTU0VSVChuZXdjYXAgPj0gc2xvdFNwYW4oKSk7CiAKKyAgICBzaXplX3QgZml4
ZWQgPSBudW1GaXhlZFNsb3RzKCk7CisKICAgICBpZiAob2xkY2FwIDw9IFNMT1RfQ0FQQUNJVFlf
TUlOIHx8ICFoYXNTbG90c0FycmF5KCkpIHsKLSAgICAgICAgLyogV2Ugd29uJ3Qgc2hyaW5rIHRo
ZSBzbG90cyBhbnkgbW9yZS4gIENsZWFyIGV4Y2VzcyBob2xlcy4gKi8KLSAgICAgICAgQ2xlYXJW
YWx1ZVJhbmdlKHNsb3RzICsgbmV3Y2FwLCBvbGRjYXAgLSBuZXdjYXAsIGlzRGVuc2VBcnJheSgp
KTsKKyAgICAgICAgLyogV2Ugd29uJ3Qgc2hyaW5rIHRoZSBzbG90cyBhbnkgbW9yZS4gQ2xlYXIg
ZXhjZXNzIGVudHJpZXMuICovCisgICAgICAgIGNsZWFyU2xvdFJhbmdlKG5ld2NhcCwgb2xkY2Fw
IC0gbmV3Y2FwKTsKICAgICAgICAgcmV0dXJuOwogICAgIH0KIAogICAgIHVpbnQzMiBmaWxsID0g
bmV3Y2FwOwogICAgIGlmIChuZXdjYXAgPCBTTE9UX0NBUEFDSVRZX01JTikKICAgICAgICAgbmV3
Y2FwID0gU0xPVF9DQVBBQ0lUWV9NSU47Ci0gICAgaWYgKG5ld2NhcCA8IG51bUZpeGVkU2xvdHMo
KSkKLSAgICAgICAgbmV3Y2FwID0gbnVtRml4ZWRTbG90cygpOworICAgIGlmIChuZXdjYXAgPCBm
aXhlZCkKKyAgICAgICAgbmV3Y2FwID0gZml4ZWQ7CiAKICAgICBWYWx1ZSAqdG1wc2xvdHMgPSAo
VmFsdWUqKSBjeC0+cmVhbGxvY18oc2xvdHMsIG5ld2NhcCAqIHNpemVvZihWYWx1ZSkpOwogICAg
IGlmICghdG1wc2xvdHMpCiAgICAgICAgIHJldHVybjsgIC8qIExlYXZlIHNsb3RzIGF0IGl0cyBv
bGQgc2l6ZS4gKi8KICAgICBzbG90cyA9IHRtcHNsb3RzOwogICAgIGNhcGFjaXR5ID0gbmV3Y2Fw
OwogCiAgICAgaWYgKGZpbGwgPCBuZXdjYXApIHsKICAgICAgICAgLyogQ2xlYXIgYW55IGV4Y2Vz
cyBob2xlcyBpZiB3ZSB0cmllZCB0byBzaHJpbmsgYmVsb3cgU0xPVF9DQVBBQ0lUWV9NSU4uICov
Ci0gICAgICAgIENsZWFyVmFsdWVSYW5nZShzbG90cyArIGZpbGwsIG5ld2NhcCAtIGZpbGwsIGlz
RGVuc2VBcnJheSgpKTsKKyAgICAgICAgY2xlYXJTbG90UmFuZ2UoZmlsbCwgbmV3Y2FwIC0gZmls
bCk7CiAgICAgfQogfQogCiBib29sCiBKU09iamVjdDo6ZW5zdXJlSW5zdGFuY2VSZXNlcnZlZFNs
b3RzKEpTQ29udGV4dCAqY3gsIHNpemVfdCBucmVzZXJ2ZWQpCiB7CiAgICAgSlNfQVNTRVJUX0lG
KGlzTmF0aXZlKCksCiAgICAgICAgICAgICAgICAgIGlzQmxvY2soKSB8fCBpc0NhbGwoKSB8fCAo
aXNGdW5jdGlvbigpICYmIGlzQm91bmRGdW5jdGlvbigpKSk7CmRpZmYgLS1naXQgYS9qcy9zcmMv
anNvYmouaCBiL2pzL3NyYy9qc29iai5oCi0tLSBhL2pzL3NyYy9qc29iai5oCisrKyBiL2pzL3Ny
Yy9qc29iai5oCkBAIC0zMDUsMzYgKzMwNSw0NSBAQCBjbGFzcyBWYWxpZGF0ZVdyaXRlcjsKICAq
IGJ1dCBpdCBoYXMgbm8gaW50cmluc2ljIG1lYW5pbmcgdG8gU3BpZGVyTW9ua2V5LiBGdXJ0aGVy
LCBKU0ZJTEVOQU1FX1NZU1RFTQogICogYW5kIEpTX0ZsYWdTY3JpcHRGaWxlbmFtZVByZWZpeCAo
YWxzbyBleHBvcnRlZCB2aWEganNkYmdhcGkuaCkgYXJlIGludGVuZGVkCiAgKiB0byBiZSBjb21w
bGVtZW50YXJ5IHRvIHRoaXMgYml0LCBidXQgaXQgaXMgdXAgdG8gdGhlIEFQSSBjbGllbnQgdG8g
aW1wbGVtZW50CiAgKiBhbnkgc3VjaCBhc3NvY2lhdGlvbi4KICAqCiAgKiBCb3RoIHRoZXNlIGZs
YWcgYml0cyBhcmUgaW5pdGlhbGx5IHplcm87IHRoZXkgbWF5IGJlIHNldCBvciBxdWVyaWVkIHVz
aW5nCiAgKiB0aGUgKGlzfHNldCkoRGVsZWdhdGV8U3lzdGVtKSBpbmxpbmUgbWV0aG9kcy4KICAq
Ci0gKiBUaGUgc2xvdHMgbWVtYmVyIGlzIGEgcG9pbnRlciB0byB0aGUgc2xvdCB2ZWN0b3IgZm9y
IHRoZSBvYmplY3QuCi0gKiBUaGlzIGNhbiBiZSBlaXRoZXIgYSBmaXhlZCBhcnJheSBhbGxvY2F0
ZWQgaW1tZWRpYXRlbHkgYWZ0ZXIgdGhlIG9iamVjdCwKLSAqIG9yIGEgZHluYW1pY2FsbHkgYWxs
b2NhdGVkIGFycmF5LiAgQSBkeW5hbWljIGFycmF5IGNhbiBiZSB0ZXN0ZWQgZm9yIHdpdGgKLSAq
IGhhc1Nsb3RzQXJyYXkoKS4gIEluIGFsbCBjYXNlcywgY2FwYWNpdHkgZ2l2ZXMgdGhlIG51bWJl
ciBvZiB1c2FibGUgc2xvdHMuCi0gKiBUd28gb2JqZWN0cyB3aXRoIHRoZSBzYW1lIHNoYXBlIGhh
dmUgdGhlIHNhbWUgbnVtYmVyIG9mIGZpeGVkIHNsb3RzLAotICogYW5kIGVpdGhlciBib3RoIGhh
dmUgb3IgbmVpdGhlciBoYXZlIGR5bmFtaWNhbGx5IGFsbG9jYXRlZCBzbG90IGFycmF5cy4KKyAq
IE9iamVjdHMgY2FuIGhhdmUgc2xvdHMgYWxsb2NhdGVkIGVpdGhlciBpbiBhIGZpeGVkIGFycmF5
IGltbWVkaWF0ZWx5CisgKiBmb2xsb3dpbmcgdGhlIG9iamVjdCwgaW4gZHluYW1pY2FsbHkgYWxs
b2NhdGVkIHNsb3RzLCBvciBib3RoLiBJbiBhbGwgY2FzZXMsCisgKiAnY2FwYWNpdHknIGdpdmVz
IHRoZSBudW1iZXIgb2YgdXNhYmxlIHNsb3RzLiBIb3cgdGhlIHNsb3RzIGFyZSBvcmdhbml6ZWQK
KyAqIGlzIGRpZmZlcmVudCBmb3IgZGVuc2UgYXJyYXlzIHZzLiBvdGhlciBvYmplY3RzLgorICoK
KyAqIEZvciBkZW5zZSBhcnJheXMgKGFycmF5cyB3aXRoIG9ubHkgbm9ybWFsIGludGVnZXIgcHJv
cGVydGllcyksIHRoZSAnc2xvdHMnCisgKiBtZW1iZXIgcG9pbnRzIGVpdGhlciB0byB0aGUgZml4
ZWQgYXJyYXkgb3IgdG8gYSBkeW5hbWljIGFycmF5LCBhbmQgaW4KKyAqIGFsbCBjYXNlcyBpcyBp
bmRleGVkIGJ5IHRoZSBhc3NvY2lhdGVkIHByb3BlcnR5IChlLmcuIG9iai0+c2xvdHNbNV0gc3Rv
cmVzCisgKiB0aGUgdmFsdWUgZm9yIHByb3BlcnR5ICc1JykuIElmIGEgZHluYW1pYyBhcnJheSBp
cyBpbiB1c2UsIHNsb3RzIGluIHRoZQorICogZml4ZWQgYXJyYXkgYXJlIG5vdCB1c2VkLgorICoK
KyAqIEZvciBvYmplY3RzIG90aGVyIHRoYW4gZGVuc2UgYXJyYXlzLCBpZiB0aGUgb2JqZWN0IGhh
cyBOIGZpeGVkIHNsb3RzIHRoZW4KKyAqIHRob3NlIGFyZSBhbHdheXMgdGhlIGZpcnN0IE4gc2xv
dHMgb2YgdGhlIG9iamVjdC4gVGhlIGR5bmFtaWMgc2xvdHMgcG9pbnRlcgorICogaXMgdXNlZCBp
ZiB0aG9zZSBmaXhlZCBzbG90cyBvdmVyZmxvdywgYW5kIHN0b3JlcyBhbGwgcmVtYWluaW5nIHNs
b3RzLgorICogVW5saWtlIGRlbnNlIGFycmF5cywgdGhlIGZpeGVkIHNsb3RzIGNhbiBhbHdheXMg
YmUgYWNjZXNzZWQuIFR3byBvYmplY3RzCisgKiB3aXRoIHRoZSBzYW1lIHNoYXBlIGhhdmUgdGhl
IHNhbWUgbnVtYmVyIG9mIGZpeGVkIHNsb3RzLgogICoKICAqIElmIHlvdSBjaGFuZ2UgdGhpcyBz
dHJ1Y3QsIHlvdSdsbCBwcm9iYWJseSBuZWVkIHRvIGNoYW5nZSB0aGUgQWNjU2V0IHZhbHVlcwog
ICogaW4ganNidWlsdGlucy5oLgogICovCiBzdHJ1Y3QgSlNPYmplY3QgOiBqczo6Z2M6OkNlbGwg
ewogICAgIC8qCiAgICAgICogVHJhY2VSZWNvcmRlciBtdXN0IGJlIGEgZnJpZW5kIGJlY2F1c2Ug
aXQgZ2VuZXJhdGVzIGNvZGUgdGhhdAogICAgICAqIG1hbmlwdWxhdGVzIEpTT2JqZWN0cywgd2hp
Y2ggcmVxdWlyZXMgcGVla2luZyB1bmRlciBhbnkgZW5jYXBzdWxhdGlvbi4KICAgICAgKiBWYWxp
ZGF0ZVdyaXRlciBtdXN0IGJlIGEgZnJpZW5kIGJlY2F1c2UgaXQgd29ya3MgaW4gdGFuZGVtIHdp
dGgKICAgICAgKiBUcmFjZVJlY29yZGVyLgogICAgICAqLwogICAgIGZyaWVuZCBjbGFzcyBqczo6
VHJhY2VSZWNvcmRlcjsKICAgICBmcmllbmQgY2xhc3MgbmFub2ppdDo6VmFsaWRhdGVXcml0ZXI7
Ci0gICAgZnJpZW5kIGNsYXNzIEdldFByb3BDb21waWxlcjsKIAogICAgIC8qCiAgICAgICogUHJp
dmF0ZSBwb2ludGVyIHRvIHRoZSBsYXN0IGFkZGVkIHByb3BlcnR5IGFuZCBtZXRob2RzIHRvIG1h
bmlwdWxhdGUgdGhlCiAgICAgICogbGlzdCBpdCBsaW5rcyBhbW9uZyBwcm9wZXJ0aWVzIGluIHRo
aXMgc2NvcGUuIFRoZSB7cmVtb3ZlLGluc2VydH0gcGFpcgogICAgICAqIGZvciBEaWN0aW9uYXJ5
UHJvcGVydGllcyBhc3NlcnQgdGhhdCB0aGUgc2NvcGUgaXMgaW4gZGljdGlvbmFyeSBtb2RlIGFu
ZAogICAgICAqIGFueSByZWFjaGFibGUgcHJvcGVydGllcyBhcmUgZmxhZ2dlZCBhcyBkaWN0aW9u
YXJ5IHByb3BlcnRpZXMuCiAgICAgICoKICAgICAgKiBGb3IgbmF0aXZlIG9iamVjdHMsIHRoaXMg
ZmllbGQgaXMgYWx3YXlzIGEgU2hhcGUuIEZvciBub24tbmF0aXZlIG9iamVjdHMsCkBAIC0zNzgs
MTcgKzM4NywyNSBAQCBzdHJ1Y3QgSlNPYmplY3QgOiBqczo6Z2M6OkNlbGwgewogICAgICAgICBH
RU5FUklDICAgICAgICAgICAgICAgICAgID0gIDB4MTAsCiAgICAgICAgIE1FVEhPRF9CQVJSSUVS
ICAgICAgICAgICAgPSAgMHgyMCwKICAgICAgICAgSU5ERVhFRCAgICAgICAgICAgICAgICAgICA9
ICAweDQwLAogICAgICAgICBPV05fU0hBUEUgICAgICAgICAgICAgICAgID0gIDB4ODAsCiAgICAg
ICAgIEJPVU5EX0ZVTkNUSU9OICAgICAgICAgICAgPSAweDEwMCwKICAgICAgICAgSEFTX0VRVUFM
SVRZICAgICAgICAgICAgICA9IDB4MjAwLAogICAgICAgICBNRVRIT0RfVEhSQVNIX0NPVU5UX01B
U0sgID0gMHhjMDAsCiAgICAgICAgIE1FVEhPRF9USFJBU0hfQ09VTlRfU0hJRlQgPSAgICAxMCwK
LSAgICAgICAgTUVUSE9EX1RIUkFTSF9DT1VOVF9NQVggICA9IE1FVEhPRF9USFJBU0hfQ09VTlRf
TUFTSyA+PiBNRVRIT0RfVEhSQVNIX0NPVU5UX1NISUZUCisgICAgICAgIE1FVEhPRF9USFJBU0hf
Q09VTlRfTUFYICAgPSBNRVRIT0RfVEhSQVNIX0NPVU5UX01BU0sgPj4gTUVUSE9EX1RIUkFTSF9D
T1VOVF9TSElGVCwKKworICAgICAgICAvKiBUaGUgdG9wIDUgYml0cyBvZiBhbiBvYmplY3QncyBm
bGFncyBhcmUgaXRzIG51bWJlciBvZiBmaXhlZCBzbG90cy4gKi8KKyAgICAgICAgRklYRURfU0xP
VFNfU0hJRlQgICAgICAgICA9ICAgIDI3LAorICAgICAgICBGSVhFRF9TTE9UU19CSVQwICAgICAg
ICAgID0gMHgwMSA8PCBGSVhFRF9TTE9UU19TSElGVCwKKyAgICAgICAgRklYRURfU0xPVFNfQklU
MSAgICAgICAgICA9IDB4MDIgPDwgRklYRURfU0xPVFNfU0hJRlQsCisgICAgICAgIEZJWEVEX1NM
T1RTX0JJVDIgICAgICAgICAgPSAweDA0IDw8IEZJWEVEX1NMT1RTX1NISUZULAorICAgICAgICBG
SVhFRF9TTE9UU19CSVQzICAgICAgICAgID0gMHgwOCA8PCBGSVhFRF9TTE9UU19TSElGVCwKKyAg
ICAgICAgRklYRURfU0xPVFNfQklUNCAgICAgICAgICA9IDB4MTAgPDwgRklYRURfU0xPVFNfU0hJ
RlQKICAgICB9OwogCiAgICAgLyoKICAgICAgKiBJbXBvc2UgYSBzYW5lIHVwcGVyIGJvdW5kLCBv
cmlnaW5hbGx5IGNoZWNrZWQgb25seSBmb3IgZGVuc2UgYXJyYXlzLCBvbgogICAgICAqIG51bWJl
ciBvZiBzbG90cyBpbiBhbiBvYmplY3QuCiAgICAgICovCiAgICAgZW51bSB7CiAgICAgICAgIE5T
TE9UU19CSVRTICAgICA9IDI5LApAQCAtMzk5LDE5ICs0MTYsMjQgQEAgc3RydWN0IEpTT2JqZWN0
IDoganM6OmdjOjpDZWxsIHsKICAgICB1aW50MzIgICAgICBvYmpTaGFwZTsgICAgICAgICAgICAg
ICAgICAgLyogY29weSBvZiBsYXN0UHJvcC0+c2hhcGUsIG9yIG92ZXJyaWRlIGlmIGRpZmZlcmVu
dCAqLwogCiAgICAgLyogSWYgcHJvdG90eXBlLCBsYXppbHkgZmlsbGVkIGFycmF5IG9mIGVtcHR5
IHNoYXBlcyBmb3IgZWFjaCBvYmplY3Qgc2l6ZS4gKi8KICAgICBqczo6RW1wdHlTaGFwZSAqKmVt
cHR5U2hhcGVzOwogCiAgICAgSlNPYmplY3QgICAgKnByb3RvOyAgICAgICAgICAgICAgICAgICAg
IC8qIG9iamVjdCdzIHByb3RvdHlwZSAqLwogICAgIEpTT2JqZWN0ICAgICpwYXJlbnQ7ICAgICAg
ICAgICAgICAgICAgICAvKiBvYmplY3QncyBwYXJlbnQgKi8KICAgICB2b2lkICAgICAgICAqcHJp
dmF0ZURhdGE7ICAgICAgICAgICAgICAgLyogcHJpdmF0ZSBkYXRhICovCi0gICAganN1d29yZCAg
ICAgY2FwYWNpdHk7ICAgICAgICAgICAgICAgICAgIC8qIGNhcGFjaXR5IG9mIHNsb3RzICovCisg
ICAganN1d29yZCAgICAgY2FwYWNpdHk7ICAgICAgICAgICAgICAgICAgIC8qIHRvdGFsIG51bWJl
ciBvZiBhdmFpbGFibGUgc2xvdHMgKi8KKworICBwcml2YXRlOgogICAgIGpzOjpWYWx1ZSAgICpz
bG90czsgICAgICAgICAgICAgICAgICAgICAvKiBkeW5hbWljYWxseSBhbGxvY2F0ZWQgc2xvdHMs
Ci0gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9yIHBvaW50
ZXIgdG8gZml4ZWRTbG90cygpICovCisgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgIG9yIHBvaW50ZXIgdG8gZml4ZWRTbG90cygpIGZvcgorICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBkZW5zZSBhcnJheXMuICovCisKKyAg
cHVibGljOgogCiAgICAgLyoKICAgICAgKiBSZXR1cm4gYW4gaW1tdXRhYmxlLCBzaGFyZWFibGUs
IGVtcHR5IHNoYXBlIHdpdGggdGhlIHNhbWUgY2xhc3AgYXMgdGhpcwogICAgICAqIGFuZCB0aGUg
c2FtZSBzbG90U3BhbiBhcyB0aGlzIGhhZCB3aGVuIGVtcHR5LgogICAgICAqCiAgICAgICogSWYg
fHRoaXN8IGlzIHRoZSBzY29wZSBvZiBhbiBvYmplY3QgfHByb3RvfCwgdGhlIHJlc3VsdGluZyBz
Y29wZSBjYW4gYmUKICAgICAgKiB1c2VkIGFzIHRoZSBzY29wZSBvZiBhIG5ldyBvYmplY3Qgd2hv
c2UgcHJvdG90eXBlIGlzIHxwcm90b3wuCiAgICAgICovCkBAIC00MjgsMTYgKzQ1MCwxNyBAQCBz
dHJ1Y3QgSlNPYmplY3QgOiBqczo6Z2M6OkNlbGwgewogICAgICAgICByZXR1cm4gYyA9PSBjbGFz
cDsKICAgICB9CiAKICAgICBjb25zdCBqczo6T2JqZWN0T3BzICpnZXRPcHMoKSBjb25zdCB7CiAg
ICAgICAgIHJldHVybiAmZ2V0Q2xhc3MoKS0+b3BzOwogICAgIH0KIAogICAgIGlubGluZSB2b2lk
IHRyYWNlKEpTVHJhY2VyICp0cmMpOworICAgIHZvaWQgbWFya1Nsb3RzKEpTVHJhY2VyICp0cmMp
OwogCiAgICAgdWludDMyIHNoYXBlKCkgY29uc3QgewogICAgICAgICBKU19BU1NFUlQob2JqU2hh
cGUgIT0gSlNPYmplY3RNYXA6OklOVkFMSURfU0hBUEUpOwogICAgICAgICByZXR1cm4gb2JqU2hh
cGU7CiAgICAgfQogCiAgICAgYm9vbCBpc0RlbGVnYXRlKCkgY29uc3QgICAgIHsgcmV0dXJuICEh
KGZsYWdzICYgREVMRUdBVEUpOyB9CiAgICAgdm9pZCBzZXREZWxlZ2F0ZSgpICAgICAgICAgIHsg
ZmxhZ3MgfD0gREVMRUdBVEU7IH0KQEAgLTYwOCwzOSArNjMxLDcwIEBAIHN0cnVjdCBKU09iamVj
dCA6IGpzOjpnYzo6Q2VsbCB7CiAgICAgaW5saW5lIHVpbnQzMiBwcm9wZXJ0eUNvdW50KCkgY29u
c3Q7CiAKICAgICBpbmxpbmUgYm9vbCBoYXNQcm9wZXJ0eVRhYmxlKCkgY29uc3Q7CiAKICAgICAv
KiBnYzo6RmluYWxpemVLaW5kICovIHVuc2lnbmVkIGZpbmFsaXplS2luZCgpIGNvbnN0OwogCiAg
ICAgdWludDMyIG51bVNsb3RzKCkgY29uc3QgeyByZXR1cm4gY2FwYWNpdHk7IH0KIAotICAgIHNp
emVfdCBzbG90c0FuZFN0cnVjdFNpemUodWludDMyIG5zbG90cykgY29uc3Q7Ci0gICAgc2l6ZV90
IHNsb3RzQW5kU3RydWN0U2l6ZSgpIGNvbnN0IHsgcmV0dXJuIHNsb3RzQW5kU3RydWN0U2l6ZShu
dW1TbG90cygpKTsgfQorICAgIGlubGluZSBzaXplX3Qgc3RydWN0U2l6ZSgpIGNvbnN0OworICAg
IGlubGluZSBzaXplX3Qgc2xvdHNBbmRTdHJ1Y3RTaXplKCkgY29uc3Q7CiAKKyAgICAvKiBTbG90
IGFjY2Vzc29ycyBmb3IgSklUcy4gKi8KKworICAgIHN0YXRpYyBpbmxpbmUgc2l6ZV90IGdldEZp
eGVkU2xvdE9mZnNldChzaXplX3Qgc2xvdCk7CisgICAgc3RhdGljIGlubGluZSBzaXplX3Qgb2Zm
c2V0T2ZDYXBhY2l0eSgpIHsgcmV0dXJuIG9mZnNldG9mKEpTT2JqZWN0LCBjYXBhY2l0eSk7IH0K
KyAgICBzdGF0aWMgaW5saW5lIHNpemVfdCBvZmZzZXRPZlNsb3RzKCkgeyByZXR1cm4gb2Zmc2V0
b2YoSlNPYmplY3QsIHNsb3RzKTsgfQorCisgICAgLyoKKyAgICAgKiBHZXQgYSByYXcgcG9pbnRl
ciB0byB0aGUgb2JqZWN0J3Mgc2xvdHMsIG9yIGEgc2xvdCBvZiB0aGUgb2JqZWN0IGdpdmVuCisg
ICAgICogYSBwcmV2aW91cyB2YWx1ZSBmb3IgaXRzIHNpbmNlLXJlYWxsb2NhdGVkIGR5bmFtaWMg
c2xvdHMuCisgICAgICovCisgICAgaW5saW5lIGpzOjpWYWx1ZSAqZ2V0UmF3U2xvdHMoKTsKKyAg
ICBpbmxpbmUganM6OlZhbHVlICpnZXRSYXdTbG90KHNpemVfdCBzbG90LCBqczo6VmFsdWUgKnNs
b3RzKTsKKworICAgIC8qIFdoZXRoZXIgYSBzbG90IGlzIGF0IGEgZml4ZWQgb2Zmc2V0IGZyb20g
dGhpcyBvYmplY3QuICovCisgICAgaW5saW5lIGJvb2wgaXNGaXhlZFNsb3Qoc2l6ZV90IHNsb3Qp
OworCisgICAgLyogSW5kZXggaW50byB0aGUgZHluYW1pYyBzbG90cyBhcnJheSB0byB1c2UgZm9y
IGEgZHluYW1pYyBzbG90LiAqLworICAgIGlubGluZSBzaXplX3QgZHluYW1pY1Nsb3RJbmRleChz
aXplX3Qgc2xvdCk7CisKKyAgcHJpdmF0ZToKICAgICBpbmxpbmUganM6OlZhbHVlKiBmaXhlZFNs
b3RzKCkgY29uc3Q7CiAgICAgaW5saW5lIHNpemVfdCBudW1GaXhlZFNsb3RzKCkgY29uc3Q7Ci0K
LSAgICBzdGF0aWMgaW5saW5lIHNpemVfdCBnZXRGaXhlZFNsb3RPZmZzZXQoc2l6ZV90IHNsb3Qp
OworICAgIGlubGluZSBib29sIGhhc1Nsb3RzQXJyYXkoKSBjb25zdDsKIAogICBwdWJsaWM6CiAg
ICAgLyogTWluaW11bSBzaXplIGZvciBkeW5hbWljYWxseSBhbGxvY2F0ZWQgc2xvdHMuICovCiAg
ICAgc3RhdGljIGNvbnN0IHVpbnQzMiBTTE9UX0NBUEFDSVRZX01JTiA9IDg7CiAKICAgICBib29s
IGFsbG9jU2xvdHMoSlNDb250ZXh0ICpjeCwgc2l6ZV90IG5zbG90cyk7CiAgICAgYm9vbCBncm93
U2xvdHMoSlNDb250ZXh0ICpjeCwgc2l6ZV90IG5zbG90cyk7CiAgICAgdm9pZCBzaHJpbmtTbG90
cyhKU0NvbnRleHQgKmN4LCBzaXplX3QgbnNsb3RzKTsKIAogICAgIGJvb2wgZW5zdXJlU2xvdHMo
SlNDb250ZXh0ICpjeCwgc2l6ZV90IG5zbG90cykgewogICAgICAgICBpZiAobnVtU2xvdHMoKSA8
IG5zbG90cykKICAgICAgICAgICAgIHJldHVybiBncm93U2xvdHMoY3gsIG5zbG90cyk7CiAgICAg
ICAgIHJldHVybiB0cnVlOwogICAgIH0KIAogICAgIC8qCisgICAgICogRmlsbCBhIHJhbmdlIG9m
IHNsb3RzIHdpdGggaG9sZXMgb3IgdW5kZWZpbmVkLCBkZXBlbmRpbmcgb24gd2hldGhlciB0aGlz
CisgICAgICogaXMgYSBkZW5zZSBhcnJheS4KKyAgICAgKi8KKyAgICB2b2lkIGNsZWFyU2xvdFJh
bmdlKHNpemVfdCBzdGFydCwgc2l6ZV90IGxlbmd0aCk7CisKKyAgICAvKgorICAgICAqIENvcHkg
YSBmbGF0IGFycmF5IG9mIHNsb3RzIHRvIHRoaXMgb2JqZWN0IGF0IGEgc3RhcnQgc2xvdC4gQ2Fs
bGVyIG11c3QKKyAgICAgKiBlbnN1cmUgdGhlcmUgYXJlIGVub3VnaCBzbG90cyBpbiB0aGlzIG9i
amVjdC4KKyAgICAgKi8KKyAgICB2b2lkIGNvcHlTbG90UmFuZ2Uoc2l6ZV90IHN0YXJ0LCBjb25z
dCBqczo6VmFsdWUgKnZlY3Rvciwgc2l6ZV90IGxlbmd0aCk7CisKKyAgICAvKgogICAgICAqIEVu
c3VyZSB0aGF0IHRoZSBvYmplY3QgaGFzIGF0IGxlYXN0IEpTQ0xBU1NfUkVTRVJWRURfU0xPVFMo
Y2xhc3ApICsKICAgICAgKiBucmVzZXJ2ZWQgc2xvdHMuCiAgICAgICoKICAgICAgKiBUaGlzIG1l
dGhvZCBtYXkgYmUgY2FsbGVkIG9ubHkgZm9yIG5hdGl2ZSBvYmplY3RzIGZyZXNobHkgY3JlYXRl
ZCB1c2luZwogICAgICAqIE5ld09iamVjdCBvciBvbmUgb2YgaXRzIHZhcmlhbnQgd2hlcmUgdGhl
IG5ldyBvYmplY3Qgd2lsbCBib3RoIChhKSBuZXZlcgogICAgICAqIGVzY2FwZSB0byBzY3JpcHQg
YW5kIChiKSBuZXZlciBiZSBleHRlbmRlZCB3aXRoIGFkLWhvYyBwcm9wZXJ0aWVzIHRoYXQKICAg
ICAgKiB3b3VsZCB0cnkgdG8gYWxsb2NhdGUgaGlnaGVyIHNsb3RzIHdpdGhvdXQgdGhlIGZyZXNo
IG9iamVjdCBmaXJzdCBoYXZpbmcKICAgICAgKiBpdHMgbWFwIHNldCB0byBhIHNoYXBlIHBhdGgg
dGhhdCBtYXBzIHRob3NlIHNsb3RzLgpAQCAtNjQ5LDcxICs3MDMsODYgQEAgc3RydWN0IEpTT2Jq
ZWN0IDoganM6OmdjOjpDZWxsIHsKICAgICAgKiBhZGQgYWQtaG9jIHByb3BlcnRpZXMgdG8gYSBC
bG9jayBpbnN0YW5jZS4gQ2FsbCBvYmplY3RzIHNhdGlzZnkgKGEpIGFuZAogICAgICAqIChiKSBh
cyB3ZWxsLCBiZWNhdXNlIHRoZSBjb21waWxlci1jcmVhdGVkIFNoYXBlIHBhdGggdGhhdCBjb3Zl
cnMgYXJncywKICAgICAgKiB2YXJzLCBhbmQgdXB2YXJzLCBzdG9yZWQgaW4gdGhlaXIgY2FsbGVl
IGZ1bmN0aW9uIGluIHUuaS5uYW1lcywgYmVjb21lcwogICAgICAqIHRoZWlyIGluaXRpYWwgbWFw
LgogICAgICAqLwogICAgIGJvb2wgZW5zdXJlSW5zdGFuY2VSZXNlcnZlZFNsb3RzKEpTQ29udGV4
dCAqY3gsIHNpemVfdCBucmVzZXJ2ZWQpOwogCiAgICAgLyoKLSAgICAgKiBHZXQgYSBkaXJlY3Qg
cG9pbnRlciB0byB0aGUgb2JqZWN0J3Mgc2xvdHMuCi0gICAgICogVGhpcyBjYW4gYmUgcmVhbGxv
Y2F0ZWQgaWYgdGhlIG9iamVjdCBpcyBtb2RpZmllZCwgd2F0Y2ggb3V0IQotICAgICAqLwotICAg
IGpzOjpWYWx1ZSAqZ2V0U2xvdHMoKSBjb25zdCB7Ci0gICAgICAgIHJldHVybiBzbG90czsKLSAg
ICB9Ci0KLSAgICAvKgogICAgICAqIE5COiBlbnN1cmVDbGFzc1Jlc2VydmVkU2xvdHNGb3JFbXB0
eU9iamVjdCBhc3NlcnRzIHRoYXQgbmF0aXZlRW1wdHkoKQogICAgICAqIFVzZSBlbnN1cmVDbGFz
c1Jlc2VydmVkU2xvdHMgZm9yIGFueSBvYmplY3QsIGVpdGhlciBlbXB0eSBvciBhbHJlYWR5CiAg
ICAgICogZXh0ZW5kZWQgd2l0aCBwcm9wZXJ0aWVzLgogICAgICAqLwogICAgIGJvb2wgZW5zdXJl
Q2xhc3NSZXNlcnZlZFNsb3RzRm9yRW1wdHlPYmplY3QoSlNDb250ZXh0ICpjeCk7CiAKICAgICBp
bmxpbmUgYm9vbCBlbnN1cmVDbGFzc1Jlc2VydmVkU2xvdHMoSlNDb250ZXh0ICpjeCk7CiAKICAg
ICB1aW50MzIgc2xvdFNwYW4oKSBjb25zdCB7IHJldHVybiBtYXAtPnNsb3RTcGFuOyB9CiAKICAg
ICBib29sIGNvbnRhaW5zU2xvdCh1aW50MzIgc2xvdCkgY29uc3QgeyByZXR1cm4gc2xvdCA8IHNs
b3RTcGFuKCk7IH0KIAogICAgIGpzOjpWYWx1ZSYgZ2V0U2xvdFJlZih1aW50TiBzbG90KSB7CiAg
ICAgICAgIEpTX0FTU0VSVChzbG90IDwgY2FwYWNpdHkpOwotICAgICAgICByZXR1cm4gc2xvdHNb
c2xvdF07CisgICAgICAgIHNpemVfdCBmaXhlZCA9IG51bUZpeGVkU2xvdHMoKTsKKyAgICAgICAg
aWYgKHNsb3QgPCBmaXhlZCkKKyAgICAgICAgICAgIHJldHVybiBmaXhlZFNsb3RzKClbc2xvdF07
CisgICAgICAgIHJldHVybiBzbG90c1tzbG90IC0gZml4ZWRdOwogICAgIH0KIAogICAgIGpzOjpW
YWx1ZSAmbmF0aXZlR2V0U2xvdFJlZih1aW50TiBzbG90KSB7CiAgICAgICAgIEpTX0FTU0VSVChp
c05hdGl2ZSgpKTsKICAgICAgICAgSlNfQVNTRVJUKGNvbnRhaW5zU2xvdChzbG90KSk7CiAgICAg
ICAgIHJldHVybiBnZXRTbG90UmVmKHNsb3QpOwogICAgIH0KIAogICAgIGNvbnN0IGpzOjpWYWx1
ZSAmZ2V0U2xvdCh1aW50TiBzbG90KSBjb25zdCB7CiAgICAgICAgIEpTX0FTU0VSVChzbG90IDwg
Y2FwYWNpdHkpOwotICAgICAgICByZXR1cm4gc2xvdHNbc2xvdF07CisgICAgICAgIHNpemVfdCBm
aXhlZCA9IG51bUZpeGVkU2xvdHMoKTsKKyAgICAgICAgaWYgKHNsb3QgPCBmaXhlZCkKKyAgICAg
ICAgICAgIHJldHVybiBmaXhlZFNsb3RzKClbc2xvdF07CisgICAgICAgIHJldHVybiBzbG90c1tz
bG90IC0gZml4ZWRdOwogICAgIH0KIAogICAgIGNvbnN0IGpzOjpWYWx1ZSAmbmF0aXZlR2V0U2xv
dCh1aW50TiBzbG90KSBjb25zdCB7CiAgICAgICAgIEpTX0FTU0VSVChpc05hdGl2ZSgpKTsKICAg
ICAgICAgSlNfQVNTRVJUKGNvbnRhaW5zU2xvdChzbG90KSk7CiAgICAgICAgIHJldHVybiBnZXRT
bG90KHNsb3QpOwogICAgIH0KIAogICAgIHZvaWQgc2V0U2xvdCh1aW50TiBzbG90LCBjb25zdCBq
czo6VmFsdWUgJnZhbHVlKSB7CiAgICAgICAgIEpTX0FTU0VSVChzbG90IDwgY2FwYWNpdHkpOwot
ICAgICAgICBzbG90c1tzbG90XSA9IHZhbHVlOworICAgICAgICBnZXRTbG90UmVmKHNsb3QpID0g
dmFsdWU7CiAgICAgfQogCiAgICAgdm9pZCBuYXRpdmVTZXRTbG90KHVpbnROIHNsb3QsIGNvbnN0
IGpzOjpWYWx1ZSAmdmFsdWUpIHsKICAgICAgICAgSlNfQVNTRVJUKGlzTmF0aXZlKCkpOwogICAg
ICAgICBKU19BU1NFUlQoY29udGFpbnNTbG90KHNsb3QpKTsKLSAgICAgICAgcmV0dXJuIHNldFNs
b3Qoc2xvdCwgdmFsdWUpOworICAgICAgICBzZXRTbG90KHNsb3QsIHZhbHVlKTsKICAgICB9CiAK
ICAgICBpbmxpbmUganM6OlZhbHVlIGdldFJlc2VydmVkU2xvdCh1aW50TiBpbmRleCkgY29uc3Q7
CiAKKyAgICAvKiBGb3Igc2xvdHMgd2hpY2ggYXJlIGtub3duIHRvIGFsd2F5cyBiZSBmaXhlZCwg
ZHVlIHRvIHRoZSB3YXkgdGhleSBhcmUgYWxsb2NhdGVkLiAqLworCisgICAganM6OlZhbHVlICZn
ZXRGaXhlZFNsb3RSZWYodWludE4gc2xvdCkgeworICAgICAgICBKU19BU1NFUlQoaXNOYXRpdmUo
KSAmJiBzbG90IDwgbnVtRml4ZWRTbG90cygpKTsKKyAgICAgICAgcmV0dXJuIGZpeGVkU2xvdHMo
KVtzbG90XTsKKyAgICB9CisKKyAgICBjb25zdCBqczo6VmFsdWUgJmdldEZpeGVkU2xvdCh1aW50
TiBzbG90KSBjb25zdCB7CisgICAgICAgIEpTX0FTU0VSVChpc05hdGl2ZSgpICYmIHNsb3QgPCBu
dW1GaXhlZFNsb3RzKCkpOworICAgICAgICByZXR1cm4gZml4ZWRTbG90cygpW3Nsb3RdOworICAg
IH0KKworICAgIHZvaWQgc2V0Rml4ZWRTbG90KHVpbnROIHNsb3QsIGNvbnN0IGpzOjpWYWx1ZSAm
dmFsdWUpIHsKKyAgICAgICAgSlNfQVNTRVJUKGlzTmF0aXZlKCkgJiYgc2xvdCA8IG51bUZpeGVk
U2xvdHMoKSk7CisgICAgICAgIGZpeGVkU2xvdHMoKVtzbG90XSA9IHZhbHVlOworICAgIH0KKwog
ICAgIC8qIERlZmluZWQgaW4ganNzY29wZWlubGluZXMuaCB0byBhdm9pZCBpbmNsdWRpbmcgaW1w
bGVtZW50YXRpb24gZGVwZW5kZW5jaWVzIGhlcmUuICovCiAgICAgaW5saW5lIHZvaWQgdXBkYXRl
U2hhcGUoSlNDb250ZXh0ICpjeCk7CiAgICAgaW5saW5lIHZvaWQgdXBkYXRlRmxhZ3MoY29uc3Qg
anM6OlNoYXBlICpzaGFwZSwgYm9vbCBpc0RlZmluaXRlbHlBdG9tID0gZmFsc2UpOwogCiAgICAg
LyogRXh0ZW5kIHRoaXMgb2JqZWN0IHRvIGhhdmUgc2hhcGUgYXMgaXRzIGxhc3QtYWRkZWQgcHJv
cGVydHkuICovCiAgICAgaW5saW5lIHZvaWQgZXh0ZW5kKEpTQ29udGV4dCAqY3gsIGNvbnN0IGpz
OjpTaGFwZSAqc2hhcGUsIGJvb2wgaXNEZWZpbml0ZWx5QXRvbSA9IGZhbHNlKTsKIAogICAgIEpT
T2JqZWN0ICpnZXRQcm90bygpIGNvbnN0ICB7IHJldHVybiBwcm90bzsgfQpAQCAtNzkyLDI5ICs4
NjEsMzUgQEAgc3RydWN0IEpTT2JqZWN0IDoganM6OmdjOjpDZWxsIHsKIAogICBwcml2YXRlOgog
ICAgIHN0YXRpYyBjb25zdCB1aW50MzIgSlNTTE9UX1BSSU1JVElWRV9USElTID0gMDsKIAogICBw
dWJsaWM6CiAgICAgaW5saW5lIGNvbnN0IGpzOjpWYWx1ZSAmZ2V0UHJpbWl0aXZlVGhpcygpIGNv
bnN0OwogICAgIGlubGluZSB2b2lkIHNldFByaW1pdGl2ZVRoaXMoY29uc3QganM6OlZhbHVlICZw
dGhpcyk7CiAKKyAgICBzdGF0aWMgc2l6ZV90IGdldFByaW1pdGl2ZVRoaXNPZmZzZXQoKSB7Cisg
ICAgICAgIC8qIEFsbCBwcmltaXRpdmUgb2JqZWN0cyBoYXZlIHRoZWlyIHZhbHVlIGluIGEgZml4
ZWQgc2xvdC4gKi8KKyAgICAgICAgcmV0dXJuIGdldEZpeGVkU2xvdE9mZnNldChKU1NMT1RfUFJJ
TUlUSVZFX1RISVMpOworICAgIH0KKwogICAgIC8qCiAgICAgICogQXJyYXktc3BlY2lmaWMgZ2V0
dGVycyBhbmQgc2V0dGVycyAoZm9yIGJvdGggZGVuc2UgYW5kIHNsb3cgYXJyYXlzKS4KICAgICAg
Ki8KIAogICAgIGlubGluZSB1aW50MzIgZ2V0QXJyYXlMZW5ndGgoKSBjb25zdDsKICAgICBpbmxp
bmUgdm9pZCBzZXRBcnJheUxlbmd0aCh1aW50MzIgbGVuZ3RoKTsKIAogICAgIGlubGluZSB1aW50
MzIgZ2V0RGVuc2VBcnJheUNhcGFjaXR5KCk7CiAgICAgaW5saW5lIGpzOjpWYWx1ZSogZ2V0RGVu
c2VBcnJheUVsZW1lbnRzKCk7CiAgICAgaW5saW5lIGNvbnN0IGpzOjpWYWx1ZSAmZ2V0RGVuc2VB
cnJheUVsZW1lbnQodWludE4gaWR4KTsKICAgICBpbmxpbmUganM6OlZhbHVlKiBhZGRyZXNzT2ZE
ZW5zZUFycmF5RWxlbWVudCh1aW50TiBpZHgpOwogICAgIGlubGluZSB2b2lkIHNldERlbnNlQXJy
YXlFbGVtZW50KHVpbnROIGlkeCwgY29uc3QganM6OlZhbHVlICZ2YWwpOwogICAgIGlubGluZSB2
b2lkIHNocmlua0RlbnNlQXJyYXlFbGVtZW50cyhKU0NvbnRleHQgKmN4LCB1aW50TiBjYXApOwor
ICAgIGlubGluZSBib29sIGRlbnNlQXJyYXlIYXNJbmxpbmVTbG90cygpIGNvbnN0OwogCiAgICAg
LyoKICAgICAgKiBlbnN1cmVEZW5zZUFycmF5RWxlbWVudHMgZW5zdXJlcyB0aGF0IHRoZSBkZW5z
ZSBhcnJheSBjYW4gaG9sZCBhdCBsZWFzdAogICAgICAqIGluZGV4ICsgZXh0cmEgZWxlbWVudHMu
IEl0IHJldHVybnMgRURfT0sgb24gc3VjY2VzcywgRURfRkFJTEVEIG9uCiAgICAgICogZmFpbHVy
ZSB0byBncm93IHRoZSBhcnJheSwgRURfU1BBUlNFIHdoZW4gdGhlIGFycmF5IGlzIHRvbyBzcGFy
c2UgdG8KICAgICAgKiBncm93ICh0aGlzIGluY2x1ZGVzIHRoZSBjYXNlIG9mIGluZGV4ICsgZXh0
cmEgb3ZlcmZsb3cpLiBJbiB0aGUgbGFzdAogICAgICAqIHR3byBjYXNlcyB0aGUgYXJyYXkgaXMg
a2VwdCBpbnRhY3QuCiAgICAgICovCkBAIC04ODcsMTYgKzk2MiwyMSBAQCBzdHJ1Y3QgSlNPYmpl
Y3QgOiBqczo6Z2M6OkNlbGwgewogICAgIHN0YXRpYyBjb25zdCB1aW50MzIgSlNTTE9UX0FSR1Nf
TEVOR1RIID0gMDsKICAgICBzdGF0aWMgY29uc3QgdWludDMyIEFSR1NfQ0xBU1NfUkVTRVJWRURf
U0xPVFMgPSAyOwogICAgIHN0YXRpYyBjb25zdCB1aW50MzIgQVJHU19GSVJTVF9GUkVFX1NMT1Qg
PSBBUkdTX0NMQVNTX1JFU0VSVkVEX1NMT1RTICsgMTsKIAogICAgIC8qIExvd2VyLW9yZGVyIGJp
dCBzdG9sZW4gZnJvbSB0aGUgbGVuZ3RoIHNsb3QuICovCiAgICAgc3RhdGljIGNvbnN0IHVpbnQz
MiBBUkdTX0xFTkdUSF9PVkVSUklEREVOX0JJVCA9IDB4MTsKICAgICBzdGF0aWMgY29uc3QgdWlu
dDMyIEFSR1NfUEFDS0VEX0JJVFNfQ09VTlQgPSAxOwogCisgICAgc3RhdGljIHNpemVfdCBnZXRB
cmd1bWVudHNMZW5ndGhPZmZzZXQoKSB7CisgICAgICAgIC8qIEFsbCBhcmd1bWVudHMgb2JqZWN0
cyBoYXZlIHRoZWlyIGxlbmd0aCBpbiBhIGZpeGVkIHNsb3QuICovCisgICAgICAgIHJldHVybiBn
ZXRGaXhlZFNsb3RPZmZzZXQoSlNTTE9UX0FSR1NfTEVOR1RIKTsKKyAgICB9CisKICAgICAvKgog
ICAgICAqIFNldCB0aGUgaW5pdGlhbCBsZW5ndGggb2YgdGhlIGFyZ3VtZW50cywgYW5kIG1hcmsg
aXQgYXMgbm90IG92ZXJyaWRkZW4uCiAgICAgICovCiAgICAgaW5saW5lIHZvaWQgc2V0QXJnc0xl
bmd0aCh1aW50MzIgYXJnYyk7CiAKICAgICAvKgogICAgICAqIFJldHVybiB0aGUgaW5pdGlhbCBs
ZW5ndGggb2YgdGhlIGFyZ3VtZW50cy4gIFRoaXMgbWF5IGRpZmZlciBmcm9tIHRoZQogICAgICAq
IGN1cnJlbnQgdmFsdWUgb2YgYXJndW1lbnRzLmxlbmd0aCEKQEAgLTEwMTEsMzIgKzEwOTEsMzcg
QEAgc3RydWN0IEpTT2JqZWN0IDoganM6OmdjOjpDZWxsIHsKICAgICBzdGF0aWMgY29uc3QgdWlu
dDMyIEpTU0xPVF9GVU5fTUVUSE9EX09CSiAgPSAxOwogCiAgICAgc3RhdGljIGNvbnN0IHVpbnQz
MiBKU1NMT1RfQk9VTkRfRlVOQ1RJT05fVEhJUyAgICAgICA9IDA7CiAgICAgc3RhdGljIGNvbnN0
IHVpbnQzMiBKU1NMT1RfQk9VTkRfRlVOQ1RJT05fQVJHU19DT1VOVCA9IDE7CiAKICAgcHVibGlj
OgogICAgIHN0YXRpYyBjb25zdCB1aW50MzIgRlVOX0NMQVNTX1JFU0VSVkVEX1NMT1RTID0gMjsK
IAorICAgIHN0YXRpYyBzaXplX3QgZ2V0RmxhdENsb3N1cmVVcHZhcnNPZmZzZXQoKSB7CisgICAg
ICAgIHJldHVybiBnZXRGaXhlZFNsb3RPZmZzZXQoSlNTTE9UX0ZMQVRfQ0xPU1VSRV9VUFZBUlMp
OworICAgIH0KKwogICAgIGlubGluZSBKU0Z1bmN0aW9uICpnZXRGdW5jdGlvblByaXZhdGUoKSBj
b25zdDsKIAogICAgIGlubGluZSBqczo6VmFsdWUgKmdldEZsYXRDbG9zdXJlVXB2YXJzKCkgY29u
c3Q7CiAgICAgaW5saW5lIGpzOjpWYWx1ZSBnZXRGbGF0Q2xvc3VyZVVwdmFyKHVpbnQzMiBpKSBj
b25zdDsKICAgICBpbmxpbmUganM6OlZhbHVlICZnZXRGbGF0Q2xvc3VyZVVwdmFyKHVpbnQzMiBp
KTsKICAgICBpbmxpbmUgdm9pZCBzZXRGbGF0Q2xvc3VyZVVwdmFycyhqczo6VmFsdWUgKnVwdmFy
cyk7CiAKICAgICBpbmxpbmUgYm9vbCBoYXNNZXRob2RPYmooY29uc3QgSlNPYmplY3QmIG9iaikg
Y29uc3Q7CiAgICAgaW5saW5lIHZvaWQgc2V0TWV0aG9kT2JqKEpTT2JqZWN0JiBvYmopOwogCiAg
ICAgaW5saW5lIGJvb2wgaW5pdEJvdW5kRnVuY3Rpb24oSlNDb250ZXh0ICpjeCwgY29uc3QganM6
OlZhbHVlICZ0aGlzQXJnLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0
IGpzOjpWYWx1ZSAqYXJncywgdWludE4gYXJnc2xlbik7CiAKICAgICBpbmxpbmUgSlNPYmplY3Qg
KmdldEJvdW5kRnVuY3Rpb25UYXJnZXQoKSBjb25zdDsKICAgICBpbmxpbmUgY29uc3QganM6OlZh
bHVlICZnZXRCb3VuZEZ1bmN0aW9uVGhpcygpIGNvbnN0OwotICAgIGlubGluZSBjb25zdCBqczo6
VmFsdWUgKmdldEJvdW5kRnVuY3Rpb25Bcmd1bWVudHModWludE4gJmFyZ3NsZW4pIGNvbnN0Owor
ICAgIGlubGluZSBjb25zdCBqczo6VmFsdWUgJmdldEJvdW5kRnVuY3Rpb25Bcmd1bWVudCh1aW50
TiB3aGljaCkgY29uc3Q7CisgICAgaW5saW5lIHNpemVfdCBnZXRCb3VuZEZ1bmN0aW9uQXJndW1l
bnRDb3VudCgpIGNvbnN0OwogCiAgICAgLyoKICAgICAgKiBSZWdFeHAtc3BlY2lmaWMgZ2V0dGVy
cyBhbmQgc2V0dGVycy4KICAgICAgKi8KIAogICBwcml2YXRlOgogICAgIHN0YXRpYyBjb25zdCB1
aW50MzIgSlNTTE9UX1JFR0VYUF9MQVNUX0lOREVYID0gMDsKICAgICBzdGF0aWMgY29uc3QgdWlu
dDMyIEpTU0xPVF9SRUdFWFBfU09VUkNFID0gMTsKQEAgLTExNTQsMjQgKzEyMzksMTYgQEAgc3Ry
dWN0IEpTT2JqZWN0IDoganM6OmdjOjpDZWxsIHsKICAgICAgKi8KICAgICBpbmxpbmUgYm9vbCBp
bml0U2hhcmluZ0VtcHR5U2hhcGUoSlNDb250ZXh0ICpjeCwKICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAganM6OkNsYXNzICpjbGFzcCwKICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgSlNPYmplY3QgKnByb3RvLAogICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICBKU09iamVjdCAqcGFyZW50LAogICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICB2b2lkICpwcml2LAogICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAvKiBnYzo6RmluYWxpemVLaW5kICovIHVuc2lnbmVkIGtpbmQpOwogCi0gICAg
aW5saW5lIGJvb2wgaGFzU2xvdHNBcnJheSgpIGNvbnN0OwotCi0gICAgLyogVGhpcyBtZXRob2Qg
Y2FuIG9ubHkgYmUgY2FsbGVkIHdoZW4gaGFzU2xvdHNBcnJheSgpIHJldHVybnMgdHJ1ZS4gKi8K
LSAgICBpbmxpbmUgdm9pZCBmcmVlU2xvdHNBcnJheShKU0NvbnRleHQgKmN4KTsKLQotICAgIC8q
IEZyZWUgdGhlIHNsb3RzIGFycmF5IGFuZCBjb3B5IHNsb3RzIHRoYXQgZml0IGludG8gdGhlIGZp
eGVkIGFycmF5LiAqLwotICAgIGlubGluZSB2b2lkIHJldmVydFRvRml4ZWRTbG90cyhKU0NvbnRl
eHQgKmN4KTsKLQogICAgIGlubGluZSBib29sIGhhc1Byb3BlcnR5KEpTQ29udGV4dCAqY3gsIGpz
aWQgaWQsIGJvb2wgKmZvdW5kcCwgdWludE4gZmxhZ3MgPSAwKTsKIAogICAgIC8qCiAgICAgICog
QWxsb2NhdGUgYW5kIGZyZWUgYW4gb2JqZWN0IHNsb3QuIE5vdGUgdGhhdCBmcmVlU2xvdCBpcyBp
bmZhbGxpYmxlOiBpdAogICAgICAqIHJldHVybnMgdHJ1ZSBpZmYgdGhpcyBpcyBhIGRpY3Rpb25h
cnktbW9kZSBvYmplY3QgYW5kIHRoZSBmcmVlZCBzbG90IHdhcwogICAgICAqIGFkZGVkIHRvIHRo
ZSBmcmVlbGlzdC4KICAgICAgKgogICAgICAqIEZJWE1FOiBidWcgNTkzMTI5IC0tIHNsb3QgYWxs
b2NhdGlvbiBzaG91bGQgYmUgZG9uZSBieSBvYmplY3QgbWV0aG9kcwpAQCAtMTIwNywxNiArMTI4
NCwxOCBAQCBzdHJ1Y3QgSlNPYmplY3QgOiBqczo6Z2M6OkNlbGwgewogICAgIGNvbnN0IGpzOjpT
aGFwZSAqYWRkUHJvcGVydHlJbnRlcm5hbChKU0NvbnRleHQgKmN4LCBqc2lkIGlkLAogICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBqczo6UHJvcGVydHlPcCBnZXR0ZXIs
IGpzOjpTdHJpY3RQcm9wZXJ0eU9wIHNldHRlciwKICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgdWludDMyIHNsb3QsIHVpbnROIGF0dHJzLAogICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICB1aW50TiBmbGFncywgaW50TiBzaG9ydGlkLAogICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBqczo6U2hhcGUgKipzcHApOwog
CiAgICAgYm9vbCB0b0RpY3Rpb25hcnlNb2RlKEpTQ29udGV4dCAqY3gpOwogCisgICAgc3RhdGlj
IGJvb2wgVHJhZGVHdXRzKEpTQ29udGV4dCAqY3gsIEpTT2JqZWN0ICphLCBKU09iamVjdCAqYik7
CisKICAgcHVibGljOgogICAgIC8qIEFkZCBhIHByb3BlcnR5IHdob3NlIGlkIGlzIG5vdCB5ZXQg
aW4gdGhpcyBzY29wZS4gKi8KICAgICBjb25zdCBqczo6U2hhcGUgKmFkZFByb3BlcnR5KEpTQ29u
dGV4dCAqY3gsIGpzaWQgaWQsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBqczo6
UHJvcGVydHlPcCBnZXR0ZXIsIGpzOjpTdHJpY3RQcm9wZXJ0eU9wIHNldHRlciwKICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgIHVpbnQzMiBzbG90LCB1aW50TiBhdHRycywKICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgIHVpbnROIGZsYWdzLCBpbnROIHNob3J0aWQpOwog
CiAgICAgLyogQWRkIGEgZGF0YSBwcm9wZXJ0eSB3aG9zZSBpZCBpcyBub3QgeWV0IGluIHRoaXMg
c2NvcGUuICovCkBAIC0xMzUxLDE4ICsxNDMwLDIxIEBAIHN0cnVjdCBKU09iamVjdCA6IGpzOjpn
Yzo6Q2VsbCB7CiAvKiBDaGVjayBhbGlnbm1lbnQgZm9yIGFueSBmaXhlZCBzbG90cyBhbGxvY2F0
ZWQgYWZ0ZXIgdGhlIG9iamVjdC4gKi8KIEpTX1NUQVRJQ19BU1NFUlQoc2l6ZW9mKEpTT2JqZWN0
KSAlIHNpemVvZihqczo6VmFsdWUpID09IDApOwogCiBpbmxpbmUganM6OlZhbHVlKgogSlNPYmpl
Y3Q6OmZpeGVkU2xvdHMoKSBjb25zdCB7CiAgICAgcmV0dXJuIChqczo6VmFsdWUqKSAoanN1d29y
ZCh0aGlzKSArIHNpemVvZihKU09iamVjdCkpOwogfQogCi1pbmxpbmUgYm9vbAotSlNPYmplY3Q6
Omhhc1Nsb3RzQXJyYXkoKSBjb25zdCB7IHJldHVybiB0aGlzLT5zbG90cyAhPSBmaXhlZFNsb3Rz
KCk7IH0KK2lubGluZSBzaXplX3QKK0pTT2JqZWN0OjpudW1GaXhlZFNsb3RzKCkgY29uc3QKK3sK
KyAgICByZXR1cm4gZmxhZ3MgPj4gRklYRURfU0xPVFNfU0hJRlQ7Cit9CiAKIC8qIHN0YXRpYyAq
LyBpbmxpbmUgc2l6ZV90CiBKU09iamVjdDo6Z2V0Rml4ZWRTbG90T2Zmc2V0KHNpemVfdCBzbG90
KSB7CiAgICAgcmV0dXJuIHNpemVvZihKU09iamVjdCkgKyAoc2xvdCAqIHNpemVvZihqczo6VmFs
dWUpKTsKIH0KIAogc3RydWN0IEpTT2JqZWN0X1Nsb3RzMiA6IEpTT2JqZWN0IHsganM6OlZhbHVl
IGZzbG90c1syXTsgfTsKIHN0cnVjdCBKU09iamVjdF9TbG90czQgOiBKU09iamVjdCB7IGpzOjpW
YWx1ZSBmc2xvdHNbNF07IH07CkBAIC0xNDU1LDE5ICsxNTM3LDE5IEBAIEpTT2JqZWN0Ojppc0Ns
b25lZEJsb2NrKCkgY29uc3QKICAgICByZXR1cm4gaXNCbG9jaygpICYmICEhZ2V0UHJvdG8oKTsK
IH0KIAogc3RhdGljIGNvbnN0IHVpbnQzMiBKU1NMT1RfV0lUSF9USElTID0gMTsKIAogI2RlZmlu
ZSBPQkpfQkxPQ0tfQ09VTlQoY3gsb2JqKSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgXAogICAgIChvYmopLT5wcm9wZXJ0eUNvdW50KCkKICNkZWZpbmUgT0JK
X0JMT0NLX0RFUFRIKGN4LG9iaikgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgIFwKLSAgICAob2JqKS0+Z2V0U2xvdChKU1NMT1RfQkxPQ0tfREVQVEgpLnRvSW50
MzIoKQorICAgIChvYmopLT5nZXRGaXhlZFNsb3QoSlNTTE9UX0JMT0NLX0RFUFRIKS50b0ludDMy
KCkKICNkZWZpbmUgT0JKX1NFVF9CTE9DS19ERVBUSChjeCxvYmosZGVwdGgpICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgIFwKLSAgICAob2JqKS0+c2V0U2xvdChKU1NMT1RfQkxP
Q0tfREVQVEgsIFZhbHVlKEludDMyVmFsdWUoZGVwdGgpKSkKKyAgICAob2JqKS0+c2V0Rml4ZWRT
bG90KEpTU0xPVF9CTE9DS19ERVBUSCwgVmFsdWUoSW50MzJWYWx1ZShkZXB0aCkpKQogCiAvKgog
ICogVG8gbWFrZSBzdXJlIHRoaXMgc2xvdCBpcyB3ZWxsLWRlZmluZWQsIGFsd2F5cyBjYWxsIGpz
X05ld1dpdGhPYmplY3QgdG8KICAqIGNyZWF0ZSBhIFdpdGggb2JqZWN0LCBkb24ndCBjYWxsIGpz
X05ld09iamVjdCBkaXJlY3RseS4gIFdoZW4gY3JlYXRpbmcgYQogICogV2l0aCBvYmplY3QgdGhh
dCBkb2VzIG5vdCBjb3JyZXNwb25kIHRvIGEgc3RhY2sgc2xvdCwgcGFzcyAtMSBmb3IgZGVwdGgu
CiAgKgogICogV2hlbiBwb3BwaW5nIHRoZSBzdGFjayBhY3Jvc3MgdGhpcyBvYmplY3QncyAid2l0
aCIgc3RhdGVtZW50LCBjbGllbnQgY29kZQogICogbXVzdCBjYWxsIHdpdGhvYmotPnNldFByaXZh
dGUoTlVMTCkuCmRpZmYgLS1naXQgYS9qcy9zcmMvanNvYmppbmxpbmVzLmggYi9qcy9zcmMvanNv
YmppbmxpbmVzLmgKLS0tIGEvanMvc3JjL2pzb2JqaW5saW5lcy5oCisrKyBiL2pzL3NyYy9qc29i
amlubGluZXMuaApAQCAtMjc5LDE2ICsyNzksNDcgQEAgSlNPYmplY3Q6Om1ldGhvZFdyaXRlQmFy
cmllcihKU0NvbnRleHQgKgogICAgICAgICBpZiAoQ2hhbmdlc01ldGhvZFZhbHVlKHByZXYsIHYp
KSB7CiAgICAgICAgICAgICBKU19GVU5DVElPTl9NRVRFUihjeCwgbXdzbG90YmFycmllcik7CiAg
ICAgICAgICAgICByZXR1cm4gbWV0aG9kU2hhcGVDaGFuZ2UoY3gsIHNsb3QpOwogICAgICAgICB9
CiAgICAgfQogICAgIHJldHVybiB0cnVlOwogfQogCitpbmxpbmUganM6OlZhbHVlICoKK0pTT2Jq
ZWN0OjpnZXRSYXdTbG90cygpCit7CisgICAgSlNfQVNTRVJUKGlzR2xvYmFsKCkpOworICAgIHJl
dHVybiBzbG90czsKK30KKworaW5saW5lIGpzOjpWYWx1ZSAqCitKU09iamVjdDo6Z2V0UmF3U2xv
dChzaXplX3Qgc2xvdCwganM6OlZhbHVlICpzbG90cykKK3sKKyAgICBKU19BU1NFUlQoaXNHbG9i
YWwoKSk7CisgICAgc2l6ZV90IGZpeGVkID0gbnVtRml4ZWRTbG90cygpOworICAgIGlmIChzbG90
IDwgZml4ZWQpCisgICAgICAgIHJldHVybiBmaXhlZFNsb3RzKCkgKyBzbG90OworICAgIHJldHVy
biBzbG90cyArIHNsb3QgLSBmaXhlZDsKK30KKworaW5saW5lIGJvb2wKK0pTT2JqZWN0Ojppc0Zp
eGVkU2xvdChzaXplX3Qgc2xvdCkKK3sKKyAgICBKU19BU1NFUlQoIWlzRGVuc2VBcnJheSgpKTsK
KyAgICByZXR1cm4gc2xvdCA8IG51bUZpeGVkU2xvdHMoKTsKK30KKworaW5saW5lIHNpemVfdAor
SlNPYmplY3Q6OmR5bmFtaWNTbG90SW5kZXgoc2l6ZV90IHNsb3QpCit7CisgICAgSlNfQVNTRVJU
KCFpc0RlbnNlQXJyYXkoKSAmJiBzbG90ID49IG51bUZpeGVkU2xvdHMoKSk7CisgICAgcmV0dXJu
IHNsb3QgLSBudW1GaXhlZFNsb3RzKCk7Cit9CisKIGlubGluZSBib29sCiBKU09iamVjdDo6ZW5z
dXJlQ2xhc3NSZXNlcnZlZFNsb3RzKEpTQ29udGV4dCAqY3gpCiB7CiAgICAgcmV0dXJuICFuYXRp
dmVFbXB0eSgpIHx8IGVuc3VyZUNsYXNzUmVzZXJ2ZWRTbG90c0ZvckVtcHR5T2JqZWN0KGN4KTsK
IH0KIAogaW5saW5lIGpzOjpWYWx1ZQogSlNPYmplY3Q6OmdldFJlc2VydmVkU2xvdCh1aW50TiBp
bmRleCkgY29uc3QKQEAgLTMwNyw1MiArMzM4LDYxIEBAIEpTT2JqZWN0Ojppc1ByaW1pdGl2ZSgp
IGNvbnN0CiB7CiAgICAgcmV0dXJuIGlzTnVtYmVyKCkgfHwgaXNTdHJpbmcoKSB8fCBpc0Jvb2xl
YW4oKTsKIH0KIAogaW5saW5lIGNvbnN0IGpzOjpWYWx1ZSAmCiBKU09iamVjdDo6Z2V0UHJpbWl0
aXZlVGhpcygpIGNvbnN0CiB7CiAgICAgSlNfQVNTRVJUKGlzUHJpbWl0aXZlKCkpOwotICAgIHJl
dHVybiBnZXRTbG90KEpTU0xPVF9QUklNSVRJVkVfVEhJUyk7CisgICAgcmV0dXJuIGdldEZpeGVk
U2xvdChKU1NMT1RfUFJJTUlUSVZFX1RISVMpOwogfQogCiBpbmxpbmUgdm9pZAogSlNPYmplY3Q6
OnNldFByaW1pdGl2ZVRoaXMoY29uc3QganM6OlZhbHVlICZwdGhpcykKIHsKICAgICBKU19BU1NF
UlQoaXNQcmltaXRpdmUoKSk7Ci0gICAgc2V0U2xvdChKU1NMT1RfUFJJTUlUSVZFX1RISVMsIHB0
aGlzKTsKKyAgICBzZXRGaXhlZFNsb3QoSlNTTE9UX1BSSU1JVElWRV9USElTLCBwdGhpcyk7CiB9
CiAKIGlubGluZSAvKiBnYzo6RmluYWxpemVLaW5kICovIHVuc2lnbmVkCiBKU09iamVjdDo6Zmlu
YWxpemVLaW5kKCkgY29uc3QKIHsKICAgICByZXR1cm4ganM6OmdjOjpGaW5hbGl6ZUtpbmQoYXJl
bmEoKS0+aGVhZGVyKCktPnRoaW5nS2luZCk7CiB9CiAKLWlubGluZSBzaXplX3QKLUpTT2JqZWN0
OjpudW1GaXhlZFNsb3RzKCkgY29uc3QKK2lubGluZSBib29sCitKU09iamVjdDo6aGFzU2xvdHNB
cnJheSgpIGNvbnN0CiB7Ci0gICAgaWYgKGlzRnVuY3Rpb24oKSkKLSAgICAgICAgcmV0dXJuIEpT
T2JqZWN0OjpGVU5fQ0xBU1NfUkVTRVJWRURfU0xPVFM7Ci0gICAgaWYgKCFoYXNTbG90c0FycmF5
KCkpCi0gICAgICAgIHJldHVybiBjYXBhY2l0eTsKLSAgICByZXR1cm4ganM6OmdjOjpHZXRHQ0tp
bmRTbG90cyhqczo6Z2M6OkZpbmFsaXplS2luZChmaW5hbGl6ZUtpbmQoKSkpOworICAgIEpTX0FT
U0VSVF9JRighc2xvdHMsICFpc0RlbnNlQXJyYXkoKSk7CisgICAgSlNfQVNTRVJUX0lGKHNsb3Rz
ID09IGZpeGVkU2xvdHMoKSwgaXNEZW5zZUFycmF5KCkpOworICAgIHJldHVybiBzbG90cyAmJiBz
bG90cyAhPSBmaXhlZFNsb3RzKCk7CiB9CiAKIGlubGluZSBzaXplX3QKLUpTT2JqZWN0OjpzbG90
c0FuZFN0cnVjdFNpemUodWludDMyIG5zbG90cykgY29uc3QKK0pTT2JqZWN0OjpzdHJ1Y3RTaXpl
KCkgY29uc3QKIHsKLSAgICBib29sIGlzRnVuID0gaXNGdW5jdGlvbigpICYmIHRoaXMgPT0gKEpT
T2JqZWN0KikgZ2V0UHJpdmF0ZSgpOworICAgIHJldHVybiAoaXNGdW5jdGlvbigpICYmICFnZXRQ
cml2YXRlKCkpCisgICAgICAgICAgID8gc2l6ZW9mKEpTRnVuY3Rpb24pCisgICAgICAgICAgIDog
c2l6ZW9mKEpTT2JqZWN0KSArIHNpemVvZihqczo6VmFsdWUpICogbnVtRml4ZWRTbG90cygpOwor
fQogCi0gICAgaW50IG5kc2xvdHMgPSBoYXNTbG90c0FycmF5KCkgPyBuc2xvdHMgOiAwOwotICAg
IGludCBuZnNsb3RzID0gaXNGdW4gPyAwIDogbnVtRml4ZWRTbG90cygpOworaW5saW5lIHNpemVf
dAorSlNPYmplY3Q6OnNsb3RzQW5kU3RydWN0U2l6ZSgpIGNvbnN0Cit7CisgICAgaW50IG5kc2xv
dHMgPSAwOworICAgIGlmIChpc0RlbnNlQXJyYXkoKSkgeworICAgICAgICBpZiAoIWRlbnNlQXJy
YXlIYXNJbmxpbmVTbG90cygpKQorICAgICAgICAgICAgbmRzbG90cyA9IG51bVNsb3RzKCk7Cisg
ICAgfSBlbHNlIHsKKyAgICAgICAgaWYgKHNsb3RzKQorICAgICAgICAgICAgbmRzbG90cyA9IG51
bVNsb3RzKCkgLSBudW1GaXhlZFNsb3RzKCk7CisgICAgfQogCi0gICAgcmV0dXJuIHNpemVvZihq
czo6VmFsdWUpICogKG5kc2xvdHMgKyBuZnNsb3RzKQotICAgICAgICAgICArIGlzRnVuID8gc2l6
ZW9mKEpTRnVuY3Rpb24pIDogc2l6ZW9mKEpTT2JqZWN0KTsKKyAgICByZXR1cm4gc3RydWN0U2l6
ZSgpICsgc2l6ZW9mKGpzOjpWYWx1ZSkgKiBuZHNsb3RzOwogfQogCiBpbmxpbmUgdWludDMyCiBK
U09iamVjdDo6Z2V0QXJyYXlMZW5ndGgoKSBjb25zdAogewogICAgIEpTX0FTU0VSVChpc0FycmF5
KCkpOwogICAgIHJldHVybiAodWludDMyKShzaXplX3QpIGdldFByaXZhdGUoKTsKIH0KQEAgLTM3
MCw5MyArNDEwLDEwMCBAQCBKU09iamVjdDo6Z2V0RGVuc2VBcnJheUNhcGFjaXR5KCkKICAgICBK
U19BU1NFUlQoaXNEZW5zZUFycmF5KCkpOwogICAgIHJldHVybiBudW1TbG90cygpOwogfQogCiBp
bmxpbmUganM6OlZhbHVlKgogSlNPYmplY3Q6OmdldERlbnNlQXJyYXlFbGVtZW50cygpCiB7CiAg
ICAgSlNfQVNTRVJUKGlzRGVuc2VBcnJheSgpKTsKLSAgICByZXR1cm4gZ2V0U2xvdHMoKTsKKyAg
ICByZXR1cm4gc2xvdHM7CiB9CiAKIGlubGluZSBjb25zdCBqczo6VmFsdWUgJgogSlNPYmplY3Q6
OmdldERlbnNlQXJyYXlFbGVtZW50KHVpbnROIGlkeCkKIHsKLSAgICBKU19BU1NFUlQoaXNEZW5z
ZUFycmF5KCkpOwotICAgIHJldHVybiBnZXRTbG90KGlkeCk7CisgICAgSlNfQVNTRVJUKGlzRGVu
c2VBcnJheSgpICYmIGlkeCA8IGNhcGFjaXR5KTsKKyAgICByZXR1cm4gc2xvdHNbaWR4XTsKIH0K
IAogaW5saW5lIGpzOjpWYWx1ZSAqCiBKU09iamVjdDo6YWRkcmVzc09mRGVuc2VBcnJheUVsZW1l
bnQodWludE4gaWR4KQogewotICAgIEpTX0FTU0VSVChpc0RlbnNlQXJyYXkoKSk7Ci0gICAgcmV0
dXJuICZnZXRTbG90UmVmKGlkeCk7CisgICAgSlNfQVNTRVJUKGlzRGVuc2VBcnJheSgpICYmIGlk
eCA8IGNhcGFjaXR5KTsKKyAgICByZXR1cm4gJnNsb3RzW2lkeF07CiB9CiAKIGlubGluZSB2b2lk
CiBKU09iamVjdDo6c2V0RGVuc2VBcnJheUVsZW1lbnQodWludE4gaWR4LCBjb25zdCBqczo6VmFs
dWUgJnZhbCkKIHsKLSAgICBKU19BU1NFUlQoaXNEZW5zZUFycmF5KCkpOwotICAgIHNldFNsb3Qo
aWR4LCB2YWwpOworICAgIEpTX0FTU0VSVChpc0RlbnNlQXJyYXkoKSAmJiBpZHggPCBjYXBhY2l0
eSk7CisgICAgc2xvdHNbaWR4XSA9IHZhbDsKIH0KIAogaW5saW5lIHZvaWQKIEpTT2JqZWN0Ojpz
aHJpbmtEZW5zZUFycmF5RWxlbWVudHMoSlNDb250ZXh0ICpjeCwgdWludE4gY2FwKQogewogICAg
IEpTX0FTU0VSVChpc0RlbnNlQXJyYXkoKSk7CiAgICAgc2hyaW5rU2xvdHMoY3gsIGNhcCk7CiB9
CiAKK2lubGluZSBib29sCitKU09iamVjdDo6ZGVuc2VBcnJheUhhc0lubGluZVNsb3RzKCkgY29u
c3QKK3sKKyAgICBKU19BU1NFUlQoaXNEZW5zZUFycmF5KCkgJiYgc2xvdHMpOworICAgIHJldHVy
biBzbG90cyA9PSBmaXhlZFNsb3RzKCk7Cit9CisKIGlubGluZSB2b2lkCiBKU09iamVjdDo6c2V0
QXJnc0xlbmd0aCh1aW50MzIgYXJnYykKIHsKICAgICBKU19BU1NFUlQoaXNBcmd1bWVudHMoKSk7
CiAgICAgSlNfQVNTRVJUKGFyZ2MgPD0gSlNfQVJHU19MRU5HVEhfTUFYKTsKICAgICBKU19BU1NF
UlQoVUlOVDMyX01BWCA+ICh1aW50NjQoYXJnYykgPDwgQVJHU19QQUNLRURfQklUU19DT1VOVCkp
OwotICAgIGdldFNsb3RSZWYoSlNTTE9UX0FSR1NfTEVOR1RIKS5zZXRJbnQzMihhcmdjIDw8IEFS
R1NfUEFDS0VEX0JJVFNfQ09VTlQpOworICAgIGdldEZpeGVkU2xvdFJlZihKU1NMT1RfQVJHU19M
RU5HVEgpLnNldEludDMyKGFyZ2MgPDwgQVJHU19QQUNLRURfQklUU19DT1VOVCk7CiAgICAgSlNf
QVNTRVJUKCFpc0FyZ3NMZW5ndGhPdmVycmlkZGVuKCkpOwogfQogCiBpbmxpbmUgdWludDMyCiBK
U09iamVjdDo6Z2V0QXJnc0luaXRpYWxMZW5ndGgoKSBjb25zdAogewogICAgIEpTX0FTU0VSVChp
c0FyZ3VtZW50cygpKTsKLSAgICB1aW50MzIgYXJnYyA9IHVpbnQzMihnZXRTbG90KEpTU0xPVF9B
UkdTX0xFTkdUSCkudG9JbnQzMigpKSA+PiBBUkdTX1BBQ0tFRF9CSVRTX0NPVU5UOworICAgIHVp
bnQzMiBhcmdjID0gdWludDMyKGdldEZpeGVkU2xvdChKU1NMT1RfQVJHU19MRU5HVEgpLnRvSW50
MzIoKSkgPj4gQVJHU19QQUNLRURfQklUU19DT1VOVDsKICAgICBKU19BU1NFUlQoYXJnYyA8PSBK
U19BUkdTX0xFTkdUSF9NQVgpOwogICAgIHJldHVybiBhcmdjOwogfQogCiBpbmxpbmUgdm9pZAog
SlNPYmplY3Q6OnNldEFyZ3NMZW5ndGhPdmVycmlkZGVuKCkKIHsKICAgICBKU19BU1NFUlQoaXNB
cmd1bWVudHMoKSk7Ci0gICAgZ2V0U2xvdFJlZihKU1NMT1RfQVJHU19MRU5HVEgpLmdldEludDMy
UmVmKCkgfD0gQVJHU19MRU5HVEhfT1ZFUlJJRERFTl9CSVQ7CisgICAgZ2V0Rml4ZWRTbG90UmVm
KEpTU0xPVF9BUkdTX0xFTkdUSCkuZ2V0SW50MzJSZWYoKSB8PSBBUkdTX0xFTkdUSF9PVkVSUklE
REVOX0JJVDsKIH0KIAogaW5saW5lIGJvb2wKIEpTT2JqZWN0Ojppc0FyZ3NMZW5ndGhPdmVycmlk
ZGVuKCkgY29uc3QKIHsKICAgICBKU19BU1NFUlQoaXNBcmd1bWVudHMoKSk7Ci0gICAgY29uc3Qg
anM6OlZhbHVlICZ2ID0gZ2V0U2xvdChKU1NMT1RfQVJHU19MRU5HVEgpOworICAgIGNvbnN0IGpz
OjpWYWx1ZSAmdiA9IGdldEZpeGVkU2xvdChKU1NMT1RfQVJHU19MRU5HVEgpOwogICAgIHJldHVy
biB2LnRvSW50MzIoKSAmIEFSR1NfTEVOR1RIX09WRVJSSURERU5fQklUOwogfQogCiBpbmxpbmUg
anM6OkFyZ3VtZW50c0RhdGEgKgogSlNPYmplY3Q6OmdldEFyZ3NEYXRhKCkgY29uc3QKIHsKICAg
ICBKU19BU1NFUlQoaXNBcmd1bWVudHMoKSk7Ci0gICAgcmV0dXJuIChqczo6QXJndW1lbnRzRGF0
YSAqKSBnZXRTbG90KEpTU0xPVF9BUkdTX0RBVEEpLnRvUHJpdmF0ZSgpOworICAgIHJldHVybiAo
anM6OkFyZ3VtZW50c0RhdGEgKikgZ2V0Rml4ZWRTbG90KEpTU0xPVF9BUkdTX0RBVEEpLnRvUHJp
dmF0ZSgpOwogfQogCiBpbmxpbmUgdm9pZAogSlNPYmplY3Q6OnNldEFyZ3NEYXRhKGpzOjpBcmd1
bWVudHNEYXRhICpkYXRhKQogewogICAgIEpTX0FTU0VSVChpc0FyZ3VtZW50cygpKTsKLSAgICBn
ZXRTbG90UmVmKEpTU0xPVF9BUkdTX0RBVEEpLnNldFByaXZhdGUoZGF0YSk7CisgICAgZ2V0Rml4
ZWRTbG90UmVmKEpTU0xPVF9BUkdTX0RBVEEpLnNldFByaXZhdGUoZGF0YSk7CiB9CiAKIGlubGlu
ZSBjb25zdCBqczo6VmFsdWUgJgogSlNPYmplY3Q6OmdldEFyZ3NDYWxsZWUoKSBjb25zdAogewog
ICAgIHJldHVybiBnZXRBcmdzRGF0YSgpLT5jYWxsZWU7CiB9CiAKQEAgLTQ5Niw2NSArNTQzLDY1
IEBAIEpTT2JqZWN0OjpzZXRBcmdzRWxlbWVudCh1aW50MzIgaSwgY29uc3QKICAgICBKU19BU1NF
UlQoaSA8IGdldEFyZ3NJbml0aWFsTGVuZ3RoKCkpOwogICAgIGdldEFyZ3NEYXRhKCktPnNsb3Rz
W2ldID0gdjsKIH0KIAogaW5saW5lIGJvb2wKIEpTT2JqZWN0OjpjYWxsSXNGb3JFdmFsKCkgY29u
c3QKIHsKICAgICBKU19BU1NFUlQoaXNDYWxsKCkpOwotICAgIEpTX0FTU0VSVChnZXRTbG90KEpT
U0xPVF9DQUxMX0NBTExFRSkuaXNPYmplY3RPck51bGwoKSk7Ci0gICAgSlNfQVNTRVJUX0lGKGdl
dFNsb3QoSlNTTE9UX0NBTExfQ0FMTEVFKS5pc09iamVjdCgpLAotICAgICAgICAgICAgICAgICBn
ZXRTbG90KEpTU0xPVF9DQUxMX0NBTExFRSkudG9PYmplY3QoKS5pc0Z1bmN0aW9uKCkpOwotICAg
IHJldHVybiBnZXRTbG90KEpTU0xPVF9DQUxMX0NBTExFRSkuaXNOdWxsKCk7CisgICAgSlNfQVNT
RVJUKGdldEZpeGVkU2xvdChKU1NMT1RfQ0FMTF9DQUxMRUUpLmlzT2JqZWN0T3JOdWxsKCkpOwor
ICAgIEpTX0FTU0VSVF9JRihnZXRGaXhlZFNsb3QoSlNTTE9UX0NBTExfQ0FMTEVFKS5pc09iamVj
dCgpLAorICAgICAgICAgICAgICAgICBnZXRGaXhlZFNsb3QoSlNTTE9UX0NBTExfQ0FMTEVFKS50
b09iamVjdCgpLmlzRnVuY3Rpb24oKSk7CisgICAgcmV0dXJuIGdldEZpeGVkU2xvdChKU1NMT1Rf
Q0FMTF9DQUxMRUUpLmlzTnVsbCgpOwogfQogCiBpbmxpbmUgSlNTdGFja0ZyYW1lICoKIEpTT2Jq
ZWN0OjptYXliZUNhbGxPYmpTdGFja0ZyYW1lKCkgY29uc3QKIHsKICAgICBKU19BU1NFUlQoaXND
YWxsKCkpOwogICAgIHJldHVybiByZWludGVycHJldF9jYXN0PEpTU3RhY2tGcmFtZSAqPihnZXRQ
cml2YXRlKCkpOwogfQogCiBpbmxpbmUgdm9pZAogSlNPYmplY3Q6OnNldENhbGxPYmpDYWxsZWUo
SlNPYmplY3QgKmNhbGxlZSkKIHsKICAgICBKU19BU1NFUlQoaXNDYWxsKCkpOwogICAgIEpTX0FT
U0VSVF9JRihjYWxsZWUsIGNhbGxlZS0+aXNGdW5jdGlvbigpKTsKLSAgICByZXR1cm4gZ2V0U2xv
dFJlZihKU1NMT1RfQ0FMTF9DQUxMRUUpLnNldE9iamVjdE9yTnVsbChjYWxsZWUpOworICAgIHJl
dHVybiBnZXRGaXhlZFNsb3RSZWYoSlNTTE9UX0NBTExfQ0FMTEVFKS5zZXRPYmplY3RPck51bGwo
Y2FsbGVlKTsKIH0KIAogaW5saW5lIEpTT2JqZWN0ICoKIEpTT2JqZWN0OjpnZXRDYWxsT2JqQ2Fs
bGVlKCkgY29uc3QKIHsKICAgICBKU19BU1NFUlQoaXNDYWxsKCkpOwotICAgIHJldHVybiBnZXRT
bG90KEpTU0xPVF9DQUxMX0NBTExFRSkudG9PYmplY3RPck51bGwoKTsKKyAgICByZXR1cm4gZ2V0
Rml4ZWRTbG90KEpTU0xPVF9DQUxMX0NBTExFRSkudG9PYmplY3RPck51bGwoKTsKIH0KIAogaW5s
aW5lIEpTRnVuY3Rpb24gKgogSlNPYmplY3Q6OmdldENhbGxPYmpDYWxsZWVGdW5jdGlvbigpIGNv
bnN0CiB7CiAgICAgSlNfQVNTRVJUKGlzQ2FsbCgpKTsKLSAgICByZXR1cm4gZ2V0U2xvdChKU1NM
T1RfQ0FMTF9DQUxMRUUpLnRvT2JqZWN0KCkuZ2V0RnVuY3Rpb25Qcml2YXRlKCk7CisgICAgcmV0
dXJuIGdldEZpeGVkU2xvdChKU1NMT1RfQ0FMTF9DQUxMRUUpLnRvT2JqZWN0KCkuZ2V0RnVuY3Rp
b25Qcml2YXRlKCk7CiB9CiAKIGlubGluZSBjb25zdCBqczo6VmFsdWUgJgogSlNPYmplY3Q6Omdl
dENhbGxPYmpBcmd1bWVudHMoKSBjb25zdAogewogICAgIEpTX0FTU0VSVChpc0NhbGwoKSk7CiAg
ICAgSlNfQVNTRVJUKCFjYWxsSXNGb3JFdmFsKCkpOwotICAgIHJldHVybiBnZXRTbG90KEpTU0xP
VF9DQUxMX0FSR1VNRU5UUyk7CisgICAgcmV0dXJuIGdldEZpeGVkU2xvdChKU1NMT1RfQ0FMTF9B
UkdVTUVOVFMpOwogfQogCiBpbmxpbmUgdm9pZAogSlNPYmplY3Q6OnNldENhbGxPYmpBcmd1bWVu
dHMoY29uc3QganM6OlZhbHVlICZ2KQogewogICAgIEpTX0FTU0VSVChpc0NhbGwoKSk7CiAgICAg
SlNfQVNTRVJUKCFjYWxsSXNGb3JFdmFsKCkpOwotICAgIHNldFNsb3QoSlNTTE9UX0NBTExfQVJH
VU1FTlRTLCB2KTsKKyAgICBzZXRGaXhlZFNsb3QoSlNTTE9UX0NBTExfQVJHVU1FTlRTLCB2KTsK
IH0KIAogaW5saW5lIGNvbnN0IGpzOjpWYWx1ZSAmCiBKU09iamVjdDo6Y2FsbE9iakFyZyh1aW50
TiBpKSBjb25zdAogewogICAgIEpTX0FTU0VSVChpc0NhbGwoKSk7CiAgICAgSlNfQVNTRVJUKGkg
PCBnZXRDYWxsT2JqQ2FsbGVlRnVuY3Rpb24oKS0+bmFyZ3MpOwogICAgIHJldHVybiBnZXRTbG90
KEpTT2JqZWN0OjpDQUxMX1JFU0VSVkVEX1NMT1RTICsgaSk7CkBAIC01ODUsMzUgKzYzMiwzNSBA
QCBKU09iamVjdDo6Y2FsbE9ialZhcih1aW50TiBpKQogICAgIEpTX0FTU0VSVChpIDwgZnVuLT5z
Y3JpcHQoKS0+YmluZGluZ3MuY291bnRWYXJzKCkpOwogICAgIHJldHVybiBnZXRTbG90UmVmKEpT
T2JqZWN0OjpDQUxMX1JFU0VSVkVEX1NMT1RTICsgZnVuLT5uYXJncyArIGkpOwogfQogCiBpbmxp
bmUgY29uc3QganM6OlZhbHVlICYKIEpTT2JqZWN0OjpnZXREYXRlVVRDVGltZSgpIGNvbnN0CiB7
CiAgICAgSlNfQVNTRVJUKGlzRGF0ZSgpKTsKLSAgICByZXR1cm4gZ2V0U2xvdChKU1NMT1RfREFU
RV9VVENfVElNRSk7CisgICAgcmV0dXJuIGdldEZpeGVkU2xvdChKU1NMT1RfREFURV9VVENfVElN
RSk7CiB9CiAKIGlubGluZSB2b2lkIAogSlNPYmplY3Q6OnNldERhdGVVVENUaW1lKGNvbnN0IGpz
OjpWYWx1ZSAmdGltZSkKIHsKICAgICBKU19BU1NFUlQoaXNEYXRlKCkpOwotICAgIHNldFNsb3Qo
SlNTTE9UX0RBVEVfVVRDX1RJTUUsIHRpbWUpOworICAgIHNldEZpeGVkU2xvdChKU1NMT1RfREFU
RV9VVENfVElNRSwgdGltZSk7CiB9CiAKIGlubGluZSBqczo6VmFsdWUgKgogSlNPYmplY3Q6Omdl
dEZsYXRDbG9zdXJlVXB2YXJzKCkgY29uc3QKIHsKICNpZmRlZiBERUJVRwogICAgIEpTRnVuY3Rp
b24gKmZ1biA9IGdldEZ1bmN0aW9uUHJpdmF0ZSgpOwogICAgIEpTX0FTU0VSVChmdW4tPmlzRmxh
dENsb3N1cmUoKSk7CiAgICAgSlNfQVNTRVJUKGZ1bi0+c2NyaXB0KCktPmJpbmRpbmdzLmNvdW50
VXB2YXJzKCkgPT0gZnVuLT5zY3JpcHQoKS0+dXB2YXJzKCktPmxlbmd0aCk7CiAjZW5kaWYKLSAg
ICByZXR1cm4gKGpzOjpWYWx1ZSAqKSBnZXRTbG90KEpTU0xPVF9GTEFUX0NMT1NVUkVfVVBWQVJT
KS50b1ByaXZhdGUoKTsKKyAgICByZXR1cm4gKGpzOjpWYWx1ZSAqKSBnZXRGaXhlZFNsb3QoSlNT
TE9UX0ZMQVRfQ0xPU1VSRV9VUFZBUlMpLnRvUHJpdmF0ZSgpOwogfQogCiBpbmxpbmUganM6OlZh
bHVlCiBKU09iamVjdDo6Z2V0RmxhdENsb3N1cmVVcHZhcih1aW50MzIgaSkgY29uc3QKIHsKICAg
ICBKU19BU1NFUlQoaSA8IGdldEZ1bmN0aW9uUHJpdmF0ZSgpLT5zY3JpcHQoKS0+YmluZGluZ3Mu
Y291bnRVcHZhcnMoKSk7CiAgICAgcmV0dXJuIGdldEZsYXRDbG9zdXJlVXB2YXJzKClbaV07CiB9
CkBAIC02MjUsMzEgKzY3MiwzMSBAQCBKU09iamVjdDo6Z2V0RmxhdENsb3N1cmVVcHZhcih1aW50
MzIgaSkKICAgICByZXR1cm4gZ2V0RmxhdENsb3N1cmVVcHZhcnMoKVtpXTsKIH0KIAogaW5saW5l
IHZvaWQKIEpTT2JqZWN0OjpzZXRGbGF0Q2xvc3VyZVVwdmFycyhqczo6VmFsdWUgKnVwdmFycykK
IHsKICAgICBKU19BU1NFUlQoaXNGdW5jdGlvbigpKTsKICAgICBKU19BU1NFUlQoRlVOX0ZMQVRf
Q0xPU1VSRShnZXRGdW5jdGlvblByaXZhdGUoKSkpOwotICAgIGdldFNsb3RSZWYoSlNTTE9UX0ZM
QVRfQ0xPU1VSRV9VUFZBUlMpLnNldFByaXZhdGUodXB2YXJzKTsKKyAgICBnZXRGaXhlZFNsb3RS
ZWYoSlNTTE9UX0ZMQVRfQ0xPU1VSRV9VUFZBUlMpLnNldFByaXZhdGUodXB2YXJzKTsKIH0KIAog
aW5saW5lIGJvb2wKIEpTT2JqZWN0OjpoYXNNZXRob2RPYmooY29uc3QgSlNPYmplY3QmIG9iaikg
Y29uc3QKIHsKICAgICByZXR1cm4gSlNTTE9UX0ZVTl9NRVRIT0RfT0JKIDwgbnVtU2xvdHMoKSAm
JgotICAgICAgICAgICBnZXRTbG90KEpTU0xPVF9GVU5fTUVUSE9EX09CSikuaXNPYmplY3QoKSAm
JgotICAgICAgICAgICAmZ2V0U2xvdChKU1NMT1RfRlVOX01FVEhPRF9PQkopLnRvT2JqZWN0KCkg
PT0gJm9iajsKKyAgICAgICAgICAgZ2V0Rml4ZWRTbG90KEpTU0xPVF9GVU5fTUVUSE9EX09CSiku
aXNPYmplY3QoKSAmJgorICAgICAgICAgICAmZ2V0Rml4ZWRTbG90KEpTU0xPVF9GVU5fTUVUSE9E
X09CSikudG9PYmplY3QoKSA9PSAmb2JqOwogfQogCiBpbmxpbmUgdm9pZAogSlNPYmplY3Q6OnNl
dE1ldGhvZE9iaihKU09iamVjdCYgb2JqKQogewotICAgIGdldFNsb3RSZWYoSlNTTE9UX0ZVTl9N
RVRIT0RfT0JKKS5zZXRPYmplY3Qob2JqKTsKKyAgICBnZXRGaXhlZFNsb3RSZWYoSlNTTE9UX0ZV
Tl9NRVRIT0RfT0JKKS5zZXRPYmplY3Qob2JqKTsKIH0KIAogaW5saW5lIGpzOjpOYXRpdmVJdGVy
YXRvciAqCiBKU09iamVjdDo6Z2V0TmF0aXZlSXRlcmF0b3IoKSBjb25zdAogewogICAgIHJldHVy
biAoanM6Ok5hdGl2ZUl0ZXJhdG9yICopIGdldFByaXZhdGUoKTsKIH0KIApAQCAtNzQ0LDY2ICs3
OTEsNjUgQEAgSlNPYmplY3Q6OnNldFFOYW1lTG9jYWxOYW1lKEpTTGluZWFyU3RyaQogewogICAg
IEpTX0FTU0VSVChpc1FOYW1lKCkpOwogICAgIHNldFNsb3QoSlNTTE9UX1FOQU1FX0xPQ0FMX05B
TUUsIG5hbWUgPyBqczo6U3RyaW5nVmFsdWUobmFtZSkgOiBqczo6VW5kZWZpbmVkVmFsdWUoKSk7
CiB9CiAKIGlubGluZSBKU09iamVjdCAqCiBKU09iamVjdDo6Z2V0V2l0aFRoaXMoKSBjb25zdAog
ewotICAgIHJldHVybiAmZ2V0U2xvdChKU1NMT1RfV0lUSF9USElTKS50b09iamVjdCgpOworICAg
IHJldHVybiAmZ2V0Rml4ZWRTbG90KEpTU0xPVF9XSVRIX1RISVMpLnRvT2JqZWN0KCk7CiB9CiAK
IGlubGluZSB2b2lkCiBKU09iamVjdDo6c2V0V2l0aFRoaXMoSlNPYmplY3QgKnRoaXNwKQogewot
ICAgIGdldFNsb3RSZWYoSlNTTE9UX1dJVEhfVEhJUykuc2V0T2JqZWN0KCp0aGlzcCk7CisgICAg
Z2V0Rml4ZWRTbG90UmVmKEpTU0xPVF9XSVRIX1RISVMpLnNldE9iamVjdCgqdGhpc3ApOwogfQog
CiBpbmxpbmUgdm9pZAogSlNPYmplY3Q6OmluaXQoSlNDb250ZXh0ICpjeCwganM6OkNsYXNzICph
Y2xhc3AsIEpTT2JqZWN0ICpwcm90bywgSlNPYmplY3QgKnBhcmVudCwKICAgICAgICAgICAgICAg
IHZvaWQgKnByaXYsIGJvb2wgdXNlSG9sZXMpCiB7CiAgICAgY2xhc3AgPSBhY2xhc3A7Ci0gICAg
ZmxhZ3MgPSAwOworICAgIGZsYWdzID0gY2FwYWNpdHkgPDwgRklYRURfU0xPVFNfU0hJRlQ7CiAK
ICNpZmRlZiBERUJVRwogICAgIC8qCiAgICAgICogTkI6IG9ialNoYXBlIG11c3Qgbm90IGJlIHNl
dCBoZXJlOyByYXRoZXIsIHRoZSBjYWxsZXIgbXVzdCBjYWxsIHNldE1hcAogICAgICAqIG9yIHNl
dFNoYXJlZE5vbk5hdGl2ZU1hcCBhZnRlciBjYWxsaW5nIGluaXQuIFRvIGRlZmVuZCB0aGlzIHJl
cXVpcmVtZW50CiAgICAgICogd2Ugc2V0IG9ialNoYXBlIHRvIGEgdmFsdWUgdGhhdCBvYmotPnNo
YXBlKCkgaXMgYXNzZXJ0ZWQgbmV2ZXIgdG8gcmV0dXJuLgogICAgICAqLwogICAgIG9ialNoYXBl
ID0gSlNPYmplY3RNYXA6OklOVkFMSURfU0hBUEU7CiAjZW5kaWYKIAogICAgIHNldFByb3RvKHBy
b3RvKTsKICAgICBzZXRQYXJlbnQocGFyZW50KTsKIAogICAgIHByaXZhdGVEYXRhID0gcHJpdjsK
LSAgICBzbG90cyA9IGZpeGVkU2xvdHMoKTsKIAogICAgIC8qCiAgICAgICogRmlsbCB0aGUgZml4
ZWQgc2xvdHMgd2l0aCB1bmRlZmluZWQgb3IgYXJyYXkgaG9sZXMuICBUaGlzIG9iamVjdCBtdXN0
CiAgICAgICogYWxyZWFkeSBoYXZlIGl0cyBjYXBhY2l0eSBmaWxsZWQgaW4sIGFzIGJ5IGpzX05l
d0dDT2JqZWN0LgogICAgICAqLwotICAgIEpTX0FTU0VSVChjYXBhY2l0eSA9PSBudW1GaXhlZFNs
b3RzKCkpOwotICAgIENsZWFyVmFsdWVSYW5nZShzbG90cywgY2FwYWNpdHksIHVzZUhvbGVzKTsK
KyAgICBzbG90cyA9IHVzZUhvbGVzID8gZml4ZWRTbG90cygpIDogTlVMTDsKKyAgICBDbGVhclZh
bHVlUmFuZ2UoZml4ZWRTbG90cygpLCBjYXBhY2l0eSwgdXNlSG9sZXMpOwogCiAgICAgZW1wdHlT
aGFwZXMgPSBOVUxMOwogfQogCiBpbmxpbmUgdm9pZAogSlNPYmplY3Q6OmZpbmlzaChKU0NvbnRl
eHQgKmN4KQogewogI2lmZGVmIERFQlVHCiAgICAgaWYgKGlzTmF0aXZlKCkpCiAgICAgICAgIEpT
X0xPQ0tfUlVOVElNRV9WT0lEKGN4LT5ydW50aW1lLCBjeC0+cnVudGltZS0+bGl2ZU9iamVjdFBy
b3BzIC09IHByb3BlcnR5Q291bnQoKSk7CiAjZW5kaWYKICAgICBpZiAoaGFzU2xvdHNBcnJheSgp
KQotICAgICAgICBmcmVlU2xvdHNBcnJheShjeCk7CisgICAgICAgIGN4LT5mcmVlXyhzbG90cyk7
CiAgICAgaWYgKGVtcHR5U2hhcGVzKQogICAgICAgICBjeC0+ZnJlZV8oZW1wdHlTaGFwZXMpOwog
fQogCiBpbmxpbmUgYm9vbAogSlNPYmplY3Q6OmluaXRTaGFyaW5nRW1wdHlTaGFwZShKU0NvbnRl
eHQgKmN4LAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBqczo6Q2xhc3MgKmFjbGFz
cCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgSlNPYmplY3QgKnByb3RvLApAQCAt
ODE4LDM1ICs4NjQsMTYgQEAgSlNPYmplY3Q6OmluaXRTaGFyaW5nRW1wdHlTaGFwZShKU0NvbnRl
eAogICAgIGpzOjpFbXB0eVNoYXBlICplbXB0eSA9IHByb3RvLT5nZXRFbXB0eVNoYXBlKGN4LCBh
Y2xhc3AsIGtpbmQpOwogICAgIGlmICghZW1wdHkpCiAgICAgICAgIHJldHVybiBmYWxzZTsKIAog
ICAgIHNldE1hcChlbXB0eSk7CiAgICAgcmV0dXJuIHRydWU7CiB9CiAKLWlubGluZSB2b2lkCi1K
U09iamVjdDo6ZnJlZVNsb3RzQXJyYXkoSlNDb250ZXh0ICpjeCkKLXsKLSAgICBKU19BU1NFUlQo
aGFzU2xvdHNBcnJheSgpKTsKLSAgICBjeC0+ZnJlZV8oc2xvdHMpOwotfQotCi1pbmxpbmUgdm9p
ZAotSlNPYmplY3Q6OnJldmVydFRvRml4ZWRTbG90cyhKU0NvbnRleHQgKmN4KQotewotICAgIEpT
X0FTU0VSVChoYXNTbG90c0FycmF5KCkpOwotICAgIHNpemVfdCBmaXhlZCA9IG51bUZpeGVkU2xv
dHMoKTsKLSAgICBKU19BU1NFUlQoY2FwYWNpdHkgPj0gZml4ZWQpOwotICAgIG1lbWNweShmaXhl
ZFNsb3RzKCksIHNsb3RzLCBmaXhlZCAqIHNpemVvZihqczo6VmFsdWUpKTsKLSAgICBmcmVlU2xv
dHNBcnJheShjeCk7Ci0gICAgc2xvdHMgPSBmaXhlZFNsb3RzKCk7Ci0gICAgY2FwYWNpdHkgPSBm
aXhlZDsKLX0KLQogaW5saW5lIGJvb2wKIEpTT2JqZWN0OjpoYXNQcm9wZXJ0eShKU0NvbnRleHQg
KmN4LCBqc2lkIGlkLCBib29sICpmb3VuZHAsIHVpbnROIGZsYWdzKQogewogICAgIEpTT2JqZWN0
ICpwb2JqOwogICAgIEpTUHJvcGVydHkgKnByb3A7CiAgICAgSlNBdXRvUmVzb2x2ZUZsYWdzIHJm
KGN4LCBmbGFncyk7CiAgICAgaWYgKCFsb29rdXBQcm9wZXJ0eShjeCwgaWQsICZwb2JqLCAmcHJv
cCkpCiAgICAgICAgIHJldHVybiBmYWxzZTsKQEAgLTExOTIsMTcgKzEyMTksMTggQEAgc3RhdGlj
IEpTX0FMV0FZU19JTkxJTkUgSlNPYmplY3QgKgogTmV3T2JqZWN0KEpTQ29udGV4dCAqY3gsIGpz
OjpDbGFzcyAqY2xhc3AsIEpTT2JqZWN0ICpwcm90bywgSlNPYmplY3QgKnBhcmVudCkKIHsKICAg
ICBnYzo6RmluYWxpemVLaW5kIGtpbmQgPSBnYzo6R2V0R0NPYmplY3RLaW5kKEpTQ0xBU1NfUkVT
RVJWRURfU0xPVFMoY2xhc3ApKTsKICAgICByZXR1cm4gTmV3T2JqZWN0PHdpdGhQcm90bz4oY3gs
IGNsYXNwLCBwcm90bywgcGFyZW50LCBraW5kKTsKIH0KIAogLyoKICAqIEFzIGZvciBnYzo6R2V0
R0NPYmplY3RLaW5kLCB3aGVyZSBudW1TbG90cyBpcyBhIGd1ZXNzIGF0IHRoZSBmaW5hbCBzaXpl
IG9mCi0gKiB0aGUgb2JqZWN0LCB6ZXJvIGlmIHRoZSBmaW5hbCBzaXplIGlzIHVua25vd24uCisg
KiB0aGUgb2JqZWN0LCB6ZXJvIGlmIHRoZSBmaW5hbCBzaXplIGlzIHVua25vd24uIFRoaXMgc2hv
dWxkIG9ubHkgYmUgdXNlZCBmb3IKKyAqIG9iamVjdHMgdGhhdCBkbyBub3QgcmVxdWlyZSBhbnkg
Zml4ZWQgc2xvdHMuCiAgKi8KIHN0YXRpYyBpbmxpbmUgZ2M6OkZpbmFsaXplS2luZAogR3Vlc3NP
YmplY3RHQ0tpbmQoc2l6ZV90IG51bVNsb3RzLCBib29sIGlzQXJyYXkpCiB7CiAgICAgaWYgKG51
bVNsb3RzKQogICAgICAgICByZXR1cm4gZ2M6OkdldEdDT2JqZWN0S2luZChudW1TbG90cyk7CiAg
ICAgcmV0dXJuIGlzQXJyYXkgPyBnYzo6RklOQUxJWkVfT0JKRUNUOCA6IGdjOjpGSU5BTElaRV9P
QkpFQ1Q0OwogfQpkaWZmIC0tZ2l0IGEvanMvc3JjL2pzc2NvcGUuY3BwIGIvanMvc3JjL2pzc2Nv
cGUuY3BwCi0tLSBhL2pzL3NyYy9qc3Njb3BlLmNwcAorKysgYi9qcy9zcmMvanNzY29wZS5jcHAK
QEAgLTExOTMsMjggKzExOTMsMTYgQEAgSlNPYmplY3Q6OnJlbW92ZVByb3BlcnR5KEpTQ29udGV4
dCAqY3gsIAogICAgIH0gZWxzZSB7CiAgICAgICAgIC8qCiAgICAgICAgICAqIE5vbi1kaWN0aW9u
YXJ5LW1vZGUgcHJvcGVydHkgdGFibGVzIGFyZSBzaGFyZWQgaW1tdXRhYmxlcywgc28gYWxsIHdl
CiAgICAgICAgICAqIG5lZWQgZG8gaXMgcmV0cmFjdCBsYXN0UHJvcCBhbmQgd2UnbGwgZWl0aGVy
IGdldCBvciBlbHNlIGxhemlseSBtYWtlCiAgICAgICAgICAqIHZpYSBhIGxhdGVyIGhhc2hpZnkg
dGhlIGV4YWN0IHRhYmxlIGZvciB0aGUgbmV3IHByb3BlcnR5IGxpbmVhZ2UuCiAgICAgICAgICAq
LwogICAgICAgICBKU19BU1NFUlQoc2hhcGUgPT0gbGFzdFByb3ApOwogICAgICAgICByZW1vdmVM
YXN0UHJvcGVydHkoKTsKLQotICAgICAgICAvKgotICAgICAgICAgKiBSZXZlcnQgdG8gZml4ZWQg
c2xvdHMgaWYgdGhpcyB3YXMgdGhlIGZpcnN0IGR5bmFtaWNhbGx5IGFsbG9jYXRlZCBzbG90LAot
ICAgICAgICAgKiBwcmVzZXJ2aW5nIGludmFyaWFudCB0aGF0IG9iamVjdHMgd2l0aCB0aGUgc2Ft
ZSBzaGFwZSB1c2UgdGhlIGZpeGVkCi0gICAgICAgICAqIHNsb3RzIGluIHRoZSBzYW1lIHdheS4K
LSAgICAgICAgICovCi0gICAgICAgIHNpemVfdCBmaXhlZCA9IG51bUZpeGVkU2xvdHMoKTsKLSAg
ICAgICAgaWYgKHNoYXBlLT5zbG90ID09IGZpeGVkKSB7Ci0gICAgICAgICAgICBKU19BU1NFUlRf
SUYoIWxhc3RQcm9wLT5pc0VtcHR5U2hhcGUoKSAmJiBsYXN0UHJvcC0+aGFzU2xvdCgpLAotICAg
ICAgICAgICAgICAgICAgICAgICAgIGxhc3RQcm9wLT5zbG90ID09IGZpeGVkIC0gMSk7Ci0gICAg
ICAgICAgICByZXZlcnRUb0ZpeGVkU2xvdHMoY3gpOwotICAgICAgICB9CiAgICAgfQogICAgIHVw
ZGF0ZVNoYXBlKGN4KTsKIAogICAgIC8qIE9uIHRoZSB3YXkgb3V0LCBjb25zaWRlciBzaHJpbmtp
bmcgdGFibGUgaWYgaXRzIGxvYWQgZmFjdG9yIGlzIDw9IC4yNS4gKi8KICAgICBpZiAobGFzdFBy
b3AtPmhhc1RhYmxlKCkpIHsKICAgICAgICAgUHJvcGVydHlUYWJsZSAqdGFibGUgPSBsYXN0UHJv
cC0+Z2V0VGFibGUoKTsKICAgICAgICAgdWludDMyIHNpemUgPSB0YWJsZS0+Y2FwYWNpdHkoKTsK
ICAgICAgICAgaWYgKHNpemUgPiBQcm9wZXJ0eVRhYmxlOjpNSU5fU0laRSAmJiB0YWJsZS0+ZW50
cnlDb3VudCA8PSBzaXplID4+IDIpIHsKQEAgLTEyNDksMjQgKzEyMzcsMTYgQEAgSlNPYmplY3Q6
OmNsZWFyKEpTQ29udGV4dCAqY3gpCiAgICAgICAgIEpTX0FTU0VSVChpbkRpY3Rpb25hcnlNb2Rl
KCkgPT0gc2hhcGUtPmluRGljdGlvbmFyeSgpKTsKICAgICB9CiAgICAgSlNfQVNTRVJUKHNoYXBl
LT5pc0VtcHR5U2hhcGUoKSk7CiAKICAgICBpZiAoaW5EaWN0aW9uYXJ5TW9kZSgpKQogICAgICAg
ICBzaGFwZS0+bGlzdHAgPSAmbGFzdFByb3A7CiAKICAgICAvKgotICAgICAqIFJldmVydCB0byBm
aXhlZCBzbG90cyBpZiB3ZSBoYXZlIGNsZWFyZWQgYmVsb3cgdGhlIGZpcnN0IGR5bmFtaWNhbGx5
Ci0gICAgICogYWxsb2NhdGVkIHNsb3QsIHByZXNlcnZpbmcgaW52YXJpYW50IHRoYXQgb2JqZWN0
cyB3aXRoIHRoZSBzYW1lIHNoYXBlCi0gICAgICogdXNlIHRoZSBmaXhlZCBzbG90cyBpbiB0aGUg
c2FtZSB3YXkuCi0gICAgICovCi0gICAgaWYgKGhhc1Nsb3RzQXJyYXkoKSAmJiBKU1NMT1RfRlJF
RShnZXRDbGFzcygpKSA8PSBudW1GaXhlZFNsb3RzKCkpCi0gICAgICAgIHJldmVydFRvRml4ZWRT
bG90cyhjeCk7Ci0KLSAgICAvKgogICAgICAqIFdlIGhhdmUgcmV3b3VuZCB0byBhIHVuaXF1ZWx5
LXNoYXBlZCBlbXB0eSBzY29wZSwgc28gd2UgZG9uJ3QgbmVlZCBhbgogICAgICAqIG92ZXJyaWRl
IGZvciB0aGlzIG9iamVjdCdzIHNoYXBlLgogICAgICAqLwogICAgIGNsZWFyT3duU2hhcGUoKTsK
ICAgICBzZXRNYXAoc2hhcGUpOwogCiAgICAgTGVhdmVUcmFjZUlmR2xvYmFsT2JqZWN0KGN4LCB0
aGlzKTsKICAgICBKU19BVE9NSUNfSU5DUkVNRU5UKCZjeC0+cnVudGltZS0+cHJvcGVydHlSZW1v
dmFscyk7CmRpZmYgLS1naXQgYS9qcy9zcmMvanN0cmFjZXIuY3BwIGIvanMvc3JjL2pzdHJhY2Vy
LmNwcAotLS0gYS9qcy9zcmMvanN0cmFjZXIuY3BwCisrKyBiL2pzL3NyYy9qc3RyYWNlci5jcHAK
QEAgLTI1ODMsMzEgKzI1ODMsMzEgQEAgVHJhY2VSZWNvcmRlcjo6d19pbW1wSWRHQyhqc2lkIGlk
KQogICAgICAgICB0cmVlLT5nY3RoaW5ncy5hZGRVbmlxdWUoSWRUb1ZhbHVlKGlkKSk7CiAgICAg
cmV0dXJuIHcuaW1tcE5vbkdDKCh2b2lkKilKU0lEX0JJVFMoaWQpKTsKIH0KIAogcHRyZGlmZl90
CiBUcmFjZVJlY29yZGVyOjpuYXRpdmVHbG9iYWxTbG90KGNvbnN0IFZhbHVlKiBwKSBjb25zdAog
ewogICAgIEpTX0FTU0VSVChpc0dsb2JhbChwKSk7Ci0gICAgcmV0dXJuIHB0cmRpZmZfdChwIC0g
Z2xvYmFsT2JqLT5zbG90cyk7CisgICAgcmV0dXJuIHB0cmRpZmZfdChwIC0gZ2xvYmFsT2JqLT5z
bG90cyArIGdsb2JhbE9iai0+bnVtRml4ZWRTbG90cygpKTsKIH0KIAogLyogRGV0ZXJtaW5lIHRo
ZSBvZmZzZXQgaW4gdGhlIG5hdGl2ZSBnbG9iYWwgZnJhbWUgZm9yIGEganN2YWwgd2UgdHJhY2su
ICovCiBwdHJkaWZmX3QKIFRyYWNlUmVjb3JkZXI6Om5hdGl2ZUdsb2JhbE9mZnNldChjb25zdCBW
YWx1ZSogcCkgY29uc3QKIHsKICAgICByZXR1cm4gbmF0aXZlR2xvYmFsU2xvdChwKSAqIHNpemVv
Zihkb3VibGUpOwogfQogCiAvKiBEZXRlcm1pbmUgd2hldGhlciBhIHZhbHVlIGlzIGEgZ2xvYmFs
IHN0YWNrIHNsb3QuICovCiBib29sCiBUcmFjZVJlY29yZGVyOjppc0dsb2JhbChjb25zdCBWYWx1
ZSogcCkgY29uc3QKIHsKLSAgICByZXR1cm4gKHNpemVfdChwIC0gZ2xvYmFsT2JqLT5zbG90cykg
PCBnbG9iYWxPYmotPm51bVNsb3RzKCkpOworICAgIHJldHVybiAoc2l6ZV90KHAgLSBnbG9iYWxP
YmotPnNsb3RzKSA8IGdsb2JhbE9iai0+bnVtU2xvdHMoKSAtIGdsb2JhbE9iai0+bnVtRml4ZWRT
bG90cygpKTsKIH0KIAogYm9vbAogVHJhY2VSZWNvcmRlcjo6aXNWb2lkUHRyR2xvYmFsKGNvbnN0
IHZvaWQqIHApIGNvbnN0CiB7CiAgICAgcmV0dXJuIGlzR2xvYmFsKChjb25zdCBWYWx1ZSAqKXAp
OwogfQogCkBAIC0zOTQwLDI2ICszOTQwLDI5IEBAIFRyYWNlUmVjb3JkZXI6Omtub3duKEpTT2Jq
ZWN0KiogcCkKICAqIFRoaXMgZnVuY3Rpb24gY2hlY2sgZm9yIHRoYXQgY29uZGl0aW9uIGFuZCBy
ZS1tYXBzIHRoZSBlbnRyaWVzIG9mIHRoZSB0cmFja2VyCiAgKiBhY2NvcmRpbmdseS4KICAqLwog
SlNfUkVRVUlSRVNfU1RBQ0sgdm9pZAogVHJhY2VSZWNvcmRlcjo6Y2hlY2tGb3JHbG9iYWxPYmpl
Y3RSZWFsbG9jYXRpb25IZWxwZXIoKQogewogICAgIGRlYnVnX29ubHlfcHJpbnQwKExDX1RNVHJh
Y2VyLCAiZ2xvYmFsT2JqLT5zbG90cyByZWxvY2F0ZWQsIHVwZGF0aW5nIHRyYWNrZXJcbiIpOwog
ICAgIFZhbHVlKiBzcmMgPSBnbG9iYWxfc2xvdHM7Ci0gICAgVmFsdWUqIGRzdCA9IGdsb2JhbE9i
ai0+Z2V0U2xvdHMoKTsKKyAgICBWYWx1ZSogZHN0ID0gZ2xvYmFsT2JqLT5nZXRSYXdTbG90cygp
OwogICAgIGpzdWludCBsZW5ndGggPSBnbG9iYWxPYmotPmNhcGFjaXR5OwogICAgIExJbnMqKiBt
YXAgPSAoTElucyoqKWFsbG9jYShzaXplb2YoTElucyopICogbGVuZ3RoKTsKICAgICBmb3IgKGpz
dWludCBuID0gMDsgbiA8IGxlbmd0aDsgKytuKSB7Ci0gICAgICAgIG1hcFtuXSA9IHRyYWNrZXIu
Z2V0KHNyYyk7Ci0gICAgICAgIHRyYWNrZXIuc2V0KHNyYysrLCBOVUxMKTsKLSAgICB9Ci0gICAg
Zm9yIChqc3VpbnQgbiA9IDA7IG4gPCBsZW5ndGg7ICsrbikKLSAgICAgICAgdHJhY2tlci5zZXQo
ZHN0KyssIG1hcFtuXSk7Ci0gICAgZ2xvYmFsX3Nsb3RzID0gZ2xvYmFsT2JqLT5nZXRTbG90cygp
OworICAgICAgICBWYWx1ZSAqc2xvdCA9IGdsb2JhbE9iai0+Z2V0UmF3U2xvdChuLCBzcmMpOwor
ICAgICAgICBtYXBbbl0gPSB0cmFja2VyLmdldChzbG90KTsKKyAgICAgICAgdHJhY2tlci5zZXQo
c2xvdCwgTlVMTCk7CisgICAgfQorICAgIGZvciAoanN1aW50IG4gPSAwOyBuIDwgbGVuZ3RoOyAr
K24pIHsKKyAgICAgICAgVmFsdWUgKnNsb3QgPSBnbG9iYWxPYmotPmdldFJhd1Nsb3QobiwgZHN0
KTsKKyAgICAgICAgdHJhY2tlci5zZXQoc2xvdCwgbWFwW25dKTsKKyAgICB9CisgICAgZ2xvYmFs
X3Nsb3RzID0gZ2xvYmFsT2JqLT5nZXRSYXdTbG90cygpOwogfQogCiAvKiBEZXRlcm1pbmUgd2hl
dGhlciB0aGUgY3VycmVudCBicmFuY2ggaXMgYSBsb29wIGVkZ2UgKHRha2VuIG9yIG5vdCB0YWtl
bikuICovCiBzdGF0aWMgSlNfUkVRVUlSRVNfU1RBQ0sgYm9vbAogSXNMb29wRWRnZShqc2J5dGVj
b2RlKiBwYywganNieXRlY29kZSogaGVhZGVyKQogewogICAgIHN3aXRjaCAoKnBjKSB7CiAgICAg
ICBjYXNlIEpTT1BfSUZFUToKQEAgLTk2NzAsMzEgKzk2NzMsMzEgQEAgVHJhY2VSZWNvcmRlcjo6
c3RvYmpfc2V0X2RzbG90KExJbnMgKm9iagogdm9pZAogVHJhY2VSZWNvcmRlcjo6c3RvYmpfc2V0
X3Nsb3QoSlNPYmplY3QgKm9iaiwgTElucyogb2JqX2lucywgdW5zaWduZWQgc2xvdCwgTElucyom
IHNsb3RzX2lucywKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IFZhbHVlICZ2
LCBMSW5zKiB2X2lucykKIHsKICAgICAvKgogICAgICAqIEEgc2hhcGUgZ3VhcmQgbXVzdCBoYXZl
IGFscmVhZHkgYmVlbiBnZW5lcmF0ZWQgZm9yIG9iaiwgd2hpY2ggd2lsbAogICAgICAqIGVuc3Vy
ZSB0aGF0IGZ1dHVyZSBvYmplY3RzIGhhdmUgdGhlIHNhbWUgbnVtYmVyIG9mIGZpeGVkIHNsb3Rz
LgogICAgICAqLwotICAgIGlmICghb2JqLT5oYXNTbG90c0FycmF5KCkpIHsKKyAgICBpZiAob2Jq
LT5pc0ZpeGVkU2xvdChzbG90KSkgewogICAgICAgICBKU19BU1NFUlQoc2xvdCA8IG9iai0+bnVt
U2xvdHMoKSk7CiAgICAgICAgIHN0b2JqX3NldF9mc2xvdChvYmpfaW5zLCBzbG90LCB2LCB2X2lu
cyk7CiAgICAgfSBlbHNlIHsKLSAgICAgICAgc3RvYmpfc2V0X2RzbG90KG9ial9pbnMsIHNsb3Qs
IHNsb3RzX2lucywgdiwgdl9pbnMpOworICAgICAgICBzdG9ial9zZXRfZHNsb3Qob2JqX2lucywg
b2JqLT5keW5hbWljU2xvdEluZGV4KHNsb3QpLCBzbG90c19pbnMsIHYsIHZfaW5zKTsKICAgICB9
CiB9CiAKIExJbnMqCiBUcmFjZVJlY29yZGVyOjp1bmJveF9zbG90KEpTT2JqZWN0ICpvYmosIExJ
bnMgKm9ial9pbnMsIHVpbnQzMiBzbG90LCBWTVNpZGVFeGl0ICpleGl0KQogewogICAgIC8qIFNh
bWUgZ3VhcmFudGVlIGFib3V0IGZpeGVkIHNsb3RzIGFzIHN0b2JqX3NldF9zbG90LiAqLwotICAg
IEFkZHJlc3MgYWRkciA9ICghb2JqLT5oYXNTbG90c0FycmF5KCkpCisgICAgQWRkcmVzcyBhZGRy
ID0gb2JqLT5pc0ZpeGVkU2xvdChzbG90KQogICAgICAgICAgICAgICAgICA/IChBZGRyZXNzKUZT
bG90c0FkZHJlc3Mob2JqX2lucywgc2xvdCkKLSAgICAgICAgICAgICAgICAgOiAoQWRkcmVzcylE
U2xvdHNBZGRyZXNzKHcubGRwT2JqU2xvdHMob2JqX2lucyksIHNsb3QpOworICAgICAgICAgICAg
ICAgICA6IChBZGRyZXNzKURTbG90c0FkZHJlc3Mody5sZHBPYmpTbG90cyhvYmpfaW5zKSwgb2Jq
LT5keW5hbWljU2xvdEluZGV4KHNsb3QpKTsKIAogICAgIHJldHVybiB1bmJveF92YWx1ZShvYmot
PmdldFNsb3Qoc2xvdCksIGFkZHIsIGV4aXQpOwogfQogCiAjaWYgSlNfQklUU19QRVJfV09SRCA9
PSAzMgogCiB2b2lkCiBUcmFjZVJlY29yZGVyOjpib3hfdW5kZWZpbmVkX2ludG8oQWRkcmVzcyBh
ZGRyKQpAQCAtMTIyMzgsMTcgKzEyMjQxLDE3IEBAIFRyYWNlUmVjb3JkZXI6OnNldENhbGxQcm9w
KEpTT2JqZWN0ICpjYWwKICAgICAgICAgfQogCiAgICAgICAgIC8vIE5vdyBhc3NlcnQgdGhhdCB0
aGUgc2hvcnRpZCBnZXQgd2UgZGlkIGFib3ZlIHdhcyBvay4gSGF2ZSB0byBkbyBpdAogICAgICAg
ICAvLyBhZnRlciB0aGUgUkVUVVJOX1NUT1AgYWJvdmUsIHNpbmNlIGluIHRoYXQgY2FzZSB3ZSBt
YXkgaW4gZmFjdCBub3QKICAgICAgICAgLy8gaGF2ZSBhIHZhbGlkIHNob3J0aWQ7IGJ1dCB3ZSBk
b24ndCB1c2UgaXQgaW4gdGhhdCBjYXNlIGFueXdheS4KICAgICAgICAgSlNfQVNTRVJUKHNoYXBl
LT5oYXNTaG9ydElEKCkpOwogCiAgICAgICAgIExJbnMqIHNsb3RzX2lucyA9IE5VTEw7Ci0gICAg
ICAgIHN0b2JqX3NldF9kc2xvdChjYWxsb2JqX2lucywgc2xvdCwgc2xvdHNfaW5zLCB2LCB2X2lu
cyk7CisgICAgICAgIHN0b2JqX3NldF9zbG90KGNhbGxvYmosIGNhbGxvYmpfaW5zLCBzbG90LCBz
bG90c19pbnMsIHYsIHZfaW5zKTsKICAgICAgICAgcmV0dXJuIFJFQ09SRF9DT05USU5VRTsKICAg
ICB9CiAKICAgICAvLyBUaGlzIGlzIHRoZSBoYXJkIGNhc2U6IHdlIGhhdmUgYSBKU1N0YWNrRnJh
bWUgcHJpdmF0ZSwgYnV0IGl0J3Mgbm90IGluCiAgICAgLy8gcmFuZ2UuICBEdXJpbmcgdHJhY2Ug
ZXhlY3V0aW9uIHdlIG1heSBvciBtYXkgbm90IGhhdmUgYSBKU1N0YWNrRnJhbWUKICAgICAvLyBh
bnltb3JlLiAgQ2FsbCB0aGUgc3RhbmRhcmQgYnVpbHRpbnMsIHdoaWNoIGhhbmRsZSB0aGF0IHNp
dHVhdGlvbi4KIAogICAgIC8vIFNldCB2YXJpYWJsZXMgaW4gb2ZmLXRyYWNlLXN0YWNrIGNhbGwg
b2JqZWN0cyBieSBjYWxsaW5nIHN0YW5kYXJkIGJ1aWx0aW5zLgpkaWZmIC0tZ2l0IGEvanMvc3Jj
L2pzdHJhY2VyLmggYi9qcy9zcmMvanN0cmFjZXIuaAotLS0gYS9qcy9zcmMvanN0cmFjZXIuaAor
KysgYi9qcy9zcmMvanN0cmFjZXIuaApAQCAtMTIzNiwxNyArMTIzNiwxNyBAQCBjbGFzcyBUcmFj
ZVJlY29yZGVyCiAgICAgSlNfUkVRVUlSRVNfU1RBQ0sgYm9vbCBrbm93bihjb25zdCBWYWx1ZSog
cCk7CiAgICAgSlNfUkVRVUlSRVNfU1RBQ0sgYm9vbCBrbm93bihKU09iamVjdCoqIHApOwogICAg
IC8qCiAgICAgICogVGhlIHNsb3RzIG9mIHRoZSBnbG9iYWwgb2JqZWN0IGFyZSBzb21ldGltZXMg
cmVhbGxvY2F0ZWQgYnkgdGhlCiAgICAgICogaW50ZXJwcmV0ZXIuICBUaGlzIGZ1bmN0aW9uIGNo
ZWNrcyBmb3IgdGhhdCBjb25kaXRpb24gYW5kIHJlLW1hcHMgdGhlCiAgICAgICogZW50cmllcyBv
ZiB0aGUgdHJhY2tlciBhY2NvcmRpbmdseS4KICAgICAgKi8KICAgICBKU19SRVFVSVJFU19TVEFD
SyB2b2lkIGNoZWNrRm9yR2xvYmFsT2JqZWN0UmVhbGxvY2F0aW9uKCkgewotICAgICAgICBpZiAo
Z2xvYmFsX3Nsb3RzICE9IGdsb2JhbE9iai0+Z2V0U2xvdHMoKSkKKyAgICAgICAgaWYgKGdsb2Jh
bF9zbG90cyAhPSBnbG9iYWxPYmotPmdldFJhd1Nsb3RzKCkpCiAgICAgICAgICAgICBjaGVja0Zv
ckdsb2JhbE9iamVjdFJlYWxsb2NhdGlvbkhlbHBlcigpOwogICAgIH0KICAgICBKU19SRVFVSVJF
U19TVEFDSyB2b2lkIGNoZWNrRm9yR2xvYmFsT2JqZWN0UmVhbGxvY2F0aW9uSGVscGVyKCk7CiAK
ICAgICBKU19SRVFVSVJFU19TVEFDSyBUeXBlQ29uc2Vuc3VzIHNlbGZUeXBlU3RhYmlsaXR5KFNs
b3RNYXAmIHNtYXApOwogICAgIEpTX1JFUVVJUkVTX1NUQUNLIFR5cGVDb25zZW5zdXMgcGVlclR5
cGVTdGFiaWxpdHkoU2xvdE1hcCYgc21hcCwgY29uc3Qgdm9pZCogaXAsCiAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBUcmVlRnJhZ21lbnQqKiBw
ZWVyKTsKIApAQCAtMTYzNCwxNyArMTYzNCwxNyBAQCBjbGFzcyBUcmFjZVJlY29yZGVyCiAKICAg
ICBib29sIGdsb2JhbFNldEV4cGVjdGVkKHVuc2lnbmVkIHNsb3QpIHsKICAgICAgICAgdW5zaWdu
ZWQgKnBpID0gRmluZChwZW5kaW5nR2xvYmFsU2xvdHNUb1NldCwgc2xvdCk7CiAgICAgICAgIGlm
IChwaSA9PSBwZW5kaW5nR2xvYmFsU2xvdHNUb1NldC5lbmQoKSkgewogICAgICAgICAgICAgLyoK
ICAgICAgICAgICAgICAqIERvIHNsb3QgYXJpdGhtZXRpYyBtYW51YWxseSB0byBhdm9pZCBnZXRT
bG90UmVmIGFzc2VydGlvbnMgd2hpY2gKICAgICAgICAgICAgICAqIGRvIG5vdCBuZWVkIHRvIGJl
IHNhdGlzZmllZCBmb3IgdGhpcyBwdXJwb3NlLgogICAgICAgICAgICAgICovCi0gICAgICAgICAg
ICBWYWx1ZSAqdnAgPSBnbG9iYWxPYmotPmdldFNsb3RzKCkgKyBzbG90OworICAgICAgICAgICAg
VmFsdWUgKnZwID0gZ2xvYmFsT2JqLT5nZXRSYXdTbG90KHNsb3QsIGdsb2JhbE9iai0+Z2V0UmF3
U2xvdHMoKSk7CiAKICAgICAgICAgICAgIC8qIElmIHRoaXMgZ2xvYmFsIGlzIGRlZmluaXRlbHkg
YmVpbmcgdHJhY2tlZCwgdGhlbiB0aGUgd3JpdGUgaXMgdW5leHBlY3RlZC4gKi8KICAgICAgICAg
ICAgIGlmICh0cmFja2VyLmhhcyh2cCkpCiAgICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwog
ICAgICAgICAgICAgCiAgICAgICAgICAgICAvKgogICAgICAgICAgICAgICogT3RoZXJ3aXNlLCBv
bmx5IGFib3J0IGlmIHRoZSBnbG9iYWwgaXMgbm90IHByZXNlbnQgaW4gdGhlCiAgICAgICAgICAg
ICAgKiBpbXBvcnQgdHlwZW1hcC4gSnVzdCBkZWVwIGFib3J0aW5nIGZhbHNlIGhlcmUgaXMgbm90
IGFjY2VwdGFibGUsCmRpZmYgLS1naXQgYS9qcy9zcmMvanN3cmFwcGVyLmNwcCBiL2pzL3NyYy9q
c3dyYXBwZXIuY3BwCi0tLSBhL2pzL3NyYy9qc3dyYXBwZXIuY3BwCisrKyBiL2pzL3NyYy9qc3dy
YXBwZXIuY3BwCkBAIC0zMDgsMTYgKzMwOCwyOCBAQCBKU1dyYXBwZXI6OmZ1bl90b1N0cmluZyhK
U0NvbnRleHQgKmN4LCBKCiB9CiAKIHZvaWQKIEpTV3JhcHBlcjo6dHJhY2UoSlNUcmFjZXIgKnRy
YywgSlNPYmplY3QgKndyYXBwZXIpCiB7CiAgICAgTWFya09iamVjdCh0cmMsICp3cmFwcGVkT2Jq
ZWN0KHdyYXBwZXIpLCAid3JhcHBlZE9iamVjdCIpOwogfQogCitKU09iamVjdCAqCitKU1dyYXBw
ZXI6OndyYXBwZWRPYmplY3QoY29uc3QgSlNPYmplY3QgKndyYXBwZXIpCit7CisgICAgcmV0dXJu
IHdyYXBwZXItPmdldFByb3h5UHJpdmF0ZSgpLnRvT2JqZWN0T3JOdWxsKCk7Cit9CisKK0pTV3Jh
cHBlciAqCitKU1dyYXBwZXI6OndyYXBwZXJIYW5kbGVyKGNvbnN0IEpTT2JqZWN0ICp3cmFwcGVy
KQoreworICAgIHJldHVybiBzdGF0aWNfY2FzdDxKU1dyYXBwZXIgKj4od3JhcHBlci0+Z2V0UHJv
eHlIYW5kbGVyKCkpOworfQorCiBib29sCiBKU1dyYXBwZXI6OmVudGVyKEpTQ29udGV4dCAqY3gs
IEpTT2JqZWN0ICp3cmFwcGVyLCBqc2lkIGlkLCBBY3Rpb24gYWN0LCBib29sICpicCkKIHsKICAg
ICAqYnAgPSB0cnVlOwogICAgIHJldHVybiB0cnVlOwogfQogCiB2b2lkCmRpZmYgLS1naXQgYS9q
cy9zcmMvanN3cmFwcGVyLmggYi9qcy9zcmMvanN3cmFwcGVyLmgKLS0tIGEvanMvc3JjL2pzd3Jh
cHBlci5oCisrKyBiL2pzL3NyYy9qc3dyYXBwZXIuaApAQCAtOTYsMjIgKzk2LDE4IEBAIGNsYXNz
IEpTX0ZSSUVORF9BUEkoSlNXcmFwcGVyKSA6IHB1YmxpYyAKICAgICB2aXJ0dWFsIGJvb2wgZW50
ZXIoSlNDb250ZXh0ICpjeCwgSlNPYmplY3QgKndyYXBwZXIsIGpzaWQgaWQsIEFjdGlvbiBhY3Qs
IGJvb2wgKmJwKTsKICAgICB2aXJ0dWFsIHZvaWQgbGVhdmUoSlNDb250ZXh0ICpjeCwgSlNPYmpl
Y3QgKndyYXBwZXIpOwogCiAgICAgc3RhdGljIEpTV3JhcHBlciBzaW5nbGV0b247CiAKICAgICBz
dGF0aWMgSlNPYmplY3QgKk5ldyhKU0NvbnRleHQgKmN4LCBKU09iamVjdCAqb2JqLCBKU09iamVj
dCAqcHJvdG8sIEpTT2JqZWN0ICpwYXJlbnQsCiAgICAgICAgICAgICAgICAgICAgICAgICAgSlNX
cmFwcGVyICpoYW5kbGVyKTsKIAotICAgIHN0YXRpYyBpbmxpbmUgSlNPYmplY3QgKndyYXBwZWRP
YmplY3QoY29uc3QgSlNPYmplY3QgKndyYXBwZXIpIHsKLSAgICAgICAgcmV0dXJuIHdyYXBwZXIt
PmdldFByb3h5UHJpdmF0ZSgpLnRvT2JqZWN0T3JOdWxsKCk7Ci0gICAgfQotICAgIHN0YXRpYyBp
bmxpbmUgSlNXcmFwcGVyICp3cmFwcGVySGFuZGxlcihjb25zdCBKU09iamVjdCAqd3JhcHBlcikg
ewotICAgICAgICByZXR1cm4gc3RhdGljX2Nhc3Q8SlNXcmFwcGVyICo+KHdyYXBwZXItPmdldFBy
b3h5SGFuZGxlcigpKTsKLSAgICB9CisgICAgc3RhdGljIEpTT2JqZWN0ICp3cmFwcGVkT2JqZWN0
KGNvbnN0IEpTT2JqZWN0ICp3cmFwcGVyKTsKKyAgICBzdGF0aWMgSlNXcmFwcGVyICp3cmFwcGVy
SGFuZGxlcihjb25zdCBKU09iamVjdCAqd3JhcHBlcik7CiAKICAgICBlbnVtIHsKICAgICAgICAg
Q1JPU1NfQ09NUEFSVE1FTlQgPSAxIDw8IDAsCiAgICAgICAgIExBU1RfVVNFRF9GTEFHID0gQ1JP
U1NfQ09NUEFSVE1FTlQKICAgICB9OwogCiAgICAgc3RhdGljIHZvaWQgKmdldFdyYXBwZXJGYW1p
bHkoKTsKIH07CmRpZmYgLS1naXQgYS9qcy9zcmMvbWV0aG9kaml0L0Jhc2VBc3NlbWJsZXIuaCBi
L2pzL3NyYy9tZXRob2RqaXQvQmFzZUFzc2VtYmxlci5oCi0tLSBhL2pzL3NyYy9tZXRob2RqaXQv
QmFzZUFzc2VtYmxlci5oCisrKyBiL2pzL3NyYy9tZXRob2RqaXQvQmFzZUFzc2VtYmxlci5oCkBA
IC0yNDgsMTkgKzI0OCwyMyBAQCBzdGF0aWMgY29uc3QgSlNDOjpNYWNyb0Fzc2VtYmxlcjo6UmVn
aXN0CiAgICAgICAgIHJldHVybiBicmFuY2hQdHIoY29uZCwgQWRkcmVzcyhmdW4sIG9mZnNldG9m
KEpTT2JqZWN0LCBjbGFzcCkpLAogICAgICAgICAgICAgICAgICAgICAgICAgIEltbVB0cigmanNf
RnVuY3Rpb25DbGFzcykpOwogICAgIH0KIAogICAgIC8qCiAgICAgICogRmluZHMgYW5kIHJldHVy
bnMgdGhlIGFkZHJlc3Mgb2YgYSBrbm93biBvYmplY3QgYW5kIHNsb3QuCiAgICAgICovCiAgICAg
QWRkcmVzcyBvYmpTbG90UmVmKEpTT2JqZWN0ICpvYmosIFJlZ2lzdGVySUQgcmVnLCB1aW50MzIg
c2xvdCkgewotICAgICAgICBtb3ZlKEltbVB0cigmb2JqLT5zbG90cyksIHJlZyk7Ci0gICAgICAg
IGxvYWRQdHIocmVnLCByZWcpOwotICAgICAgICByZXR1cm4gQWRkcmVzcyhyZWcsIHNsb3QgKiBz
aXplb2YoVmFsdWUpKTsKKyAgICAgICAgbW92ZShJbW1QdHIob2JqKSwgcmVnKTsKKyAgICAgICAg
aWYgKG9iai0+aXNGaXhlZFNsb3Qoc2xvdCkpIHsKKyAgICAgICAgICAgIHJldHVybiBBZGRyZXNz
KHJlZywgSlNPYmplY3Q6OmdldEZpeGVkU2xvdE9mZnNldChzbG90KSk7CisgICAgICAgIH0gZWxz
ZSB7CisgICAgICAgICAgICBsb2FkUHRyKEFkZHJlc3MocmVnLCBKU09iamVjdDo6b2Zmc2V0T2ZT
bG90cygpKSwgcmVnKTsKKyAgICAgICAgICAgIHJldHVybiBBZGRyZXNzKHJlZywgb2JqLT5keW5h
bWljU2xvdEluZGV4KHNsb3QpICogc2l6ZW9mKFZhbHVlKSk7CisgICAgICAgIH0KICAgICB9CiAK
ICNpZmRlZiBKU19DUFVfWDg2CiAgICAgdm9pZCBpZGl2KFJlZ2lzdGVySUQgcmVnKSB7CiAgICAg
ICAgIG1fYXNzZW1ibGVyLmNkcSgpOwogICAgICAgICBtX2Fzc2VtYmxlci5pZGl2bF9yKHJlZyk7
CiAgICAgfQogI2VuZGlmCkBAIC02NjAsMTcgKzY2NCwxNyBAQCBzdGF0aWMgY29uc3QgSlNDOjpN
YWNyb0Fzc2VtYmxlcjo6UmVnaXN0CiAgICAgRmFzdEFycmF5TG9hZEZhaWxzIGZhc3RBcnJheUxv
YWQoUmVnaXN0ZXJJRCBvYmpSZWcsIGNvbnN0IEludDMyS2V5ICZrZXksCiAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgUmVnaXN0ZXJJRCB0eXBlUmVnLCBSZWdpc3RlcklEIGRh
dGFSZWcpIHsKICAgICAgICAgSlNfQVNTRVJUKG9ialJlZyAhPSB0eXBlUmVnKTsKIAogICAgICAg
ICBGYXN0QXJyYXlMb2FkRmFpbHMgZmFpbHM7CiAgICAgICAgIGZhaWxzLnJhbmdlQ2hlY2sgPSBn
dWFyZEFycmF5Q2FwYWNpdHkob2JqUmVnLCBrZXkpOwogCiAgICAgICAgIFJlZ2lzdGVySUQgZHNs
b3RzUmVnID0gb2JqUmVnOwotICAgICAgICBsb2FkUHRyKEFkZHJlc3Mob2JqUmVnLCBvZmZzZXRv
ZihKU09iamVjdCwgc2xvdHMpKSwgZHNsb3RzUmVnKTsKKyAgICAgICAgbG9hZFB0cihBZGRyZXNz
KG9ialJlZywgSlNPYmplY3Q6Om9mZnNldE9mU2xvdHMoKSksIGRzbG90c1JlZyk7CiAKICAgICAg
ICAgLy8gTG9hZCB0aGUgc2xvdCBvdXQgb2YgdGhlIGFycmF5LgogICAgICAgICBpZiAoa2V5Lmlz
Q29uc3RhbnQoKSkgewogICAgICAgICAgICAgQWRkcmVzcyBzbG90KG9ialJlZywga2V5LmluZGV4
KCkgKiBzaXplb2YoVmFsdWUpKTsKICAgICAgICAgICAgIGZhaWxzLmhvbGVDaGVjayA9IGZhc3RB
cnJheUxvYWRTbG90KHNsb3QsIHR5cGVSZWcsIGRhdGFSZWcpOwogICAgICAgICB9IGVsc2Ugewog
ICAgICAgICAgICAgQmFzZUluZGV4IHNsb3Qob2JqUmVnLCBrZXkucmVnKCksIEpTVkFMX1NDQUxF
KTsKICAgICAgICAgICAgIGZhaWxzLmhvbGVDaGVjayA9IGZhc3RBcnJheUxvYWRTbG90KHNsb3Qs
IHR5cGVSZWcsIGRhdGFSZWcpOwpAQCAtNjkzLDMyICs2OTcsNDAgQEAgc3RhdGljIGNvbnN0IEpT
Qzo6TWFjcm9Bc3NlbWJsZXI6OlJlZ2lzdAogCiAgICAgdm9pZCByZW1hdFBheWxvYWQoY29uc3Qg
U3RhdGVSZW1hdCAmcmVtYXQsIFJlZ2lzdGVySUQgcmVnKSB7CiAgICAgICAgIGlmIChyZW1hdC5p
bk1lbW9yeSgpKQogICAgICAgICAgICAgbG9hZFBheWxvYWQocmVtYXQuYWRkcmVzcygpLCByZWcp
OwogICAgICAgICBlbHNlCiAgICAgICAgICAgICBtb3ZlKHJlbWF0LnJlZygpLCByZWcpOwogICAg
IH0KIAotICAgIHZvaWQgbG9hZER5bmFtaWNTbG90KFJlZ2lzdGVySUQgb2JqUmVnLCB1aW50MzIg
c2xvdCwKKyAgICB2b2lkIGxvYWREeW5hbWljU2xvdChSZWdpc3RlcklEIG9ialJlZywgdWludDMy
IGluZGV4LAogICAgICAgICAgICAgICAgICAgICAgICAgIFJlZ2lzdGVySUQgdHlwZVJlZywgUmVn
aXN0ZXJJRCBkYXRhUmVnKSB7Ci0gICAgICAgIGxvYWRQdHIoQWRkcmVzcyhvYmpSZWcsIG9mZnNl
dG9mKEpTT2JqZWN0LCBzbG90cykpLCBkYXRhUmVnKTsKLSAgICAgICAgbG9hZFZhbHVlQXNDb21w
b25lbnRzKEFkZHJlc3MoZGF0YVJlZywgc2xvdCAqIHNpemVvZihWYWx1ZSkpLCB0eXBlUmVnLCBk
YXRhUmVnKTsKKyAgICAgICAgbG9hZFB0cihBZGRyZXNzKG9ialJlZywgSlNPYmplY3Q6Om9mZnNl
dE9mU2xvdHMoKSksIGRhdGFSZWcpOworICAgICAgICBsb2FkVmFsdWVBc0NvbXBvbmVudHMoQWRk
cmVzcyhkYXRhUmVnLCBpbmRleCAqIHNpemVvZihWYWx1ZSkpLCB0eXBlUmVnLCBkYXRhUmVnKTsK
ICAgICB9CiAKICAgICB2b2lkIGxvYWRPYmpQcm9wKEpTT2JqZWN0ICpvYmosIFJlZ2lzdGVySUQg
b2JqUmVnLAogICAgICAgICAgICAgICAgICAgICAgY29uc3QganM6OlNoYXBlICpzaGFwZSwKICAg
ICAgICAgICAgICAgICAgICAgIFJlZ2lzdGVySUQgdHlwZVJlZywgUmVnaXN0ZXJJRCBkYXRhUmVn
KQogICAgIHsKICAgICAgICAgaWYgKHNoYXBlLT5pc01ldGhvZCgpKQogICAgICAgICAgICAgbG9h
ZFZhbHVlQXNDb21wb25lbnRzKE9iamVjdFZhbHVlKHNoYXBlLT5tZXRob2RPYmplY3QoKSksIHR5
cGVSZWcsIGRhdGFSZWcpOwotICAgICAgICBlbHNlIGlmIChvYmotPmhhc1Nsb3RzQXJyYXkoKSkK
LSAgICAgICAgICAgIGxvYWREeW5hbWljU2xvdChvYmpSZWcsIHNoYXBlLT5zbG90LCB0eXBlUmVn
LCBkYXRhUmVnKTsKKyAgICAgICAgZWxzZSBpZiAob2JqLT5pc0ZpeGVkU2xvdChzaGFwZS0+c2xv
dCkpCisgICAgICAgICAgICBsb2FkSW5saW5lU2xvdChvYmpSZWcsIHNoYXBlLT5zbG90LCB0eXBl
UmVnLCBkYXRhUmVnKTsKICAgICAgICAgZWxzZQotICAgICAgICAgICAgbG9hZElubGluZVNsb3Qo
b2JqUmVnLCBzaGFwZS0+c2xvdCwgdHlwZVJlZywgZGF0YVJlZyk7CisgICAgICAgICAgICBsb2Fk
RHluYW1pY1Nsb3Qob2JqUmVnLCBvYmotPmR5bmFtaWNTbG90SW5kZXgoc2hhcGUtPnNsb3QpLCB0
eXBlUmVnLCBkYXRhUmVnKTsKKyAgICB9CisKKyAgICBBZGRyZXNzIG9ialByb3BBZGRyZXNzKEpT
T2JqZWN0ICpvYmosIFJlZ2lzdGVySUQgb2JqUmVnLCB1aW50MzIgc2xvdCkKKyAgICB7CisgICAg
ICAgIGlmIChvYmotPmlzRml4ZWRTbG90KHNsb3QpKQorICAgICAgICAgICAgcmV0dXJuIEFkZHJl
c3Mob2JqUmVnLCBKU09iamVjdDo6Z2V0Rml4ZWRTbG90T2Zmc2V0KHNsb3QpKTsKKyAgICAgICAg
bG9hZFB0cihBZGRyZXNzKG9ialJlZywgSlNPYmplY3Q6Om9mZnNldE9mU2xvdHMoKSksIG9ialJl
Zyk7CisgICAgICAgIHJldHVybiBBZGRyZXNzKG9ialJlZywgb2JqLT5keW5hbWljU2xvdEluZGV4
KHNsb3QpICogc2l6ZW9mKFZhbHVlKSk7CiAgICAgfQogCiAgICAgc3RhdGljIHVpbnQzMiBtYXNr
QWRkcmVzcyhBZGRyZXNzIGFkZHJlc3MpIHsKICAgICAgICAgcmV0dXJuIFJlZ2lzdGVyczo6bWFz
a1JlZyhhZGRyZXNzLmJhc2UpOwogICAgIH0KIAogICAgIHN0YXRpYyB1aW50MzIgbWFza0FkZHJl
c3MoQmFzZUluZGV4IGFkZHJlc3MpIHsKICAgICAgICAgcmV0dXJuIFJlZ2lzdGVyczo6bWFza1Jl
ZyhhZGRyZXNzLmJhc2UpIHwKZGlmZiAtLWdpdCBhL2pzL3NyYy9tZXRob2RqaXQvQ29tcGlsZXIu
Y3BwIGIvanMvc3JjL21ldGhvZGppdC9Db21waWxlci5jcHAKLS0tIGEvanMvc3JjL21ldGhvZGpp
dC9Db21waWxlci5jcHAKKysrIGIvanMvc3JjL21ldGhvZGppdC9Db21waWxlci5jcHAKQEAgLTE4
NTAsMTggKzE4NTAsMTcgQEAgbWppdDo6Q29tcGlsZXI6OmdlbmVyYXRlTWV0aG9kKCkKICAgICAg
ICAgICAgIHVpbnROIGluZGV4ID0gR0VUX1VJTlQxNihQQyk7CiAKICAgICAgICAgICAgIC8vIExv
YWQgdGhlIGNhbGxlZSdzIHBheWxvYWQgaW50byBhIHJlZ2lzdGVyLgogICAgICAgICAgICAgZnJh
bWUucHVzaENhbGxlZSgpOwogICAgICAgICAgICAgUmVnaXN0ZXJJRCByZWcgPSBmcmFtZS5jb3B5
RGF0YUludG9SZWcoZnJhbWUucGVlaygtMSkpOwogICAgICAgICAgICAgZnJhbWUucG9wKCk7CiAK
ICAgICAgICAgICAgIC8vIG9iai0+Z2V0RmxhdENsb3N1cmVVcHZhcnMoKQotICAgICAgICAgICAg
bWFzbS5sb2FkUHRyKEFkZHJlc3MocmVnLCBvZmZzZXRvZihKU09iamVjdCwgc2xvdHMpKSwgcmVn
KTsKLSAgICAgICAgICAgIEFkZHJlc3MgdXB2YXJBZGRyZXNzKHJlZywgSlNPYmplY3Q6OkpTU0xP
VF9GTEFUX0NMT1NVUkVfVVBWQVJTICogc2l6ZW9mKFZhbHVlKSk7CisgICAgICAgICAgICBBZGRy
ZXNzIHVwdmFyQWRkcmVzcyhyZWcsIEpTT2JqZWN0OjpnZXRGbGF0Q2xvc3VyZVVwdmFyc09mZnNl
dCgpKTsKICAgICAgICAgICAgIG1hc20ubG9hZFByaXZhdGUodXB2YXJBZGRyZXNzLCByZWcpOwog
ICAgICAgICAgICAgLy8gcHVzaCAoKFZhbHVlICopIHJlZylbaW5kZXhdCiAgICAgICAgICAgICBm
cmFtZS5mcmVlUmVnKHJlZyk7CiAgICAgICAgICAgICBmcmFtZS5wdXNoKEFkZHJlc3MocmVnLCBp
bmRleCAqIHNpemVvZihWYWx1ZSkpKTsKICAgICAgICAgICAgIGlmIChvcCA9PSBKU09QX0NBTExG
Q1NMT1QpCiAgICAgICAgICAgICAgICAgZnJhbWUucHVzaChVbmRlZmluZWRWYWx1ZSgpKTsKICAg
ICAgICAgICB9CiAgICAgICAgICAgRU5EX0NBU0UoSlNPUF9DQUxMRkNTTE9UKQpkaWZmIC0tZ2l0
IGEvanMvc3JjL21ldGhvZGppdC9GYXN0T3BzLmNwcCBiL2pzL3NyYy9tZXRob2RqaXQvRmFzdE9w
cy5jcHAKLS0tIGEvanMvc3JjL21ldGhvZGppdC9GYXN0T3BzLmNwcAorKysgYi9qcy9zcmMvbWV0
aG9kaml0L0Zhc3RPcHMuY3BwCkBAIC0xODA0LDIxICsxODA0LDIxIEBAIG1qaXQ6OkNvbXBpbGVy
Ojpqc29wX2luaXRwcm9wKCkKICNpZmRlZiBERUJVRwogICAgIGludCByZXMgPQogI2VuZGlmCiAg
ICAganNfTG9va3VwUHJvcGVydHlXaXRoRmxhZ3MoY3gsIGJhc2VvYmosIEFUT01fVE9fSlNJRChh
dG9tKSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBKU1JFU09MVkVfUVVBTElGSUVE
LCAmaG9sZGVyLCAmcHJvcCk7CiAgICAgSlNfQVNTRVJUKHJlcyA+PSAwICYmIHByb3AgJiYgaG9s
ZGVyID09IGJhc2VvYmopOwogCiAgICAgUmVnaXN0ZXJJRCBvYmpSZWcgPSBmcmFtZS5jb3B5RGF0
YUludG9SZWcob2JqKTsKLSAgICBtYXNtLmxvYWRQdHIoQWRkcmVzcyhvYmpSZWcsIG9mZnNldG9m
KEpTT2JqZWN0LCBzbG90cykpLCBvYmpSZWcpOwogCiAgICAgLyogUGVyZm9ybSB0aGUgc3RvcmUu
ICovCiAgICAgU2hhcGUgKnNoYXBlID0gKFNoYXBlICopIHByb3A7Ci0gICAgZnJhbWUuc3RvcmVU
byhmZSwgQWRkcmVzcyhvYmpSZWcsIHNoYXBlLT5zbG90ICogc2l6ZW9mKFZhbHVlKSkpOworICAg
IEFkZHJlc3MgYWRkcmVzcyA9IG1hc20ub2JqUHJvcEFkZHJlc3MoYmFzZW9iaiwgb2JqUmVnLCBz
aGFwZS0+c2xvdCk7CisgICAgZnJhbWUuc3RvcmVUbyhmZSwgYWRkcmVzcyk7CiAgICAgZnJhbWUu
ZnJlZVJlZyhvYmpSZWcpOwogfQogCiB2b2lkCiBtaml0OjpDb21waWxlcjo6anNvcF9pbml0ZWxl
bSgpCiB7CiAgICAgRnJhbWVFbnRyeSAqb2JqID0gZnJhbWUucGVlaygtMyk7CiAgICAgRnJhbWVF
bnRyeSAqaWQgPSBmcmFtZS5wZWVrKC0yKTsKZGlmZiAtLWdpdCBhL2pzL3NyYy9tZXRob2RqaXQv
TW9ub0lDLmNwcCBiL2pzL3NyYy9tZXRob2RqaXQvTW9ub0lDLmNwcAotLS0gYS9qcy9zcmMvbWV0
aG9kaml0L01vbm9JQy5jcHAKKysrIGIvanMvc3JjL21ldGhvZGppdC9Nb25vSUMuY3BwCkBAIC05
OSwxOCArOTksMTkgQEAgaWM6OkdldEdsb2JhbE5hbWUoVk1GcmFtZSAmZiwgaWM6OkdldEdsbwog
ICAgIH0KICAgICB1aW50MzIgc2xvdCA9IHNoYXBlLT5zbG90OwogCiAgICAgLyogUGF0Y2ggc2hh
cGUgZ3VhcmQuICovCiAgICAgUmVwYXRjaGVyIHJlcGF0Y2hlcihmLmppdCgpKTsKICAgICByZXBh
dGNoZXIucmVwYXRjaChpYy0+ZmFzdFBhdGhTdGFydC5kYXRhTGFiZWwzMkF0T2Zmc2V0KGljLT5z
aGFwZU9mZnNldCksIG9iai0+c2hhcGUoKSk7CiAKICAgICAvKiBQYXRjaCBsb2Fkcy4gKi8KKyAg
ICB1aW50MzIgaW5kZXggPSBvYmotPmR5bmFtaWNTbG90SW5kZXgoc2xvdCk7CiAgICAgSlNDOjpD
b2RlTG9jYXRpb25MYWJlbCBsYWJlbCA9IGljLT5mYXN0UGF0aFN0YXJ0LmxhYmVsQXRPZmZzZXQo
aWMtPmxvYWRTdG9yZU9mZnNldCk7Ci0gICAgcmVwYXRjaGVyLnBhdGNoQWRkcmVzc09mZnNldEZv
clZhbHVlTG9hZChsYWJlbCwgc2xvdCAqIHNpemVvZihWYWx1ZSkpOworICAgIHJlcGF0Y2hlci5w
YXRjaEFkZHJlc3NPZmZzZXRGb3JWYWx1ZUxvYWQobGFiZWwsIGluZGV4ICogc2l6ZW9mKFZhbHVl
KSk7CiAKICAgICAvKiBEbyBsb2FkIGFueXdheS4uLiB0aGlzIHRpbWUuICovCiAgICAgc3R1YnM6
OkdldEdsb2JhbE5hbWUoZik7CiB9CiAKIHRlbXBsYXRlIDxKU0Jvb2wgc3RyaWN0Pgogc3RhdGlj
IHZvaWQgSlNfRkFTVENBTEwKIERpc2FibGVkU2V0R2xvYmFsKFZNRnJhbWUgJmYsIGljOjpTZXRH
bG9iYWxOYW1lSUMgKmljKQpAQCAtMTY2LDE5ICsxNjcsMjAgQEAgU2V0R2xvYmFsTmFtZUlDOjpw
YXRjaElubGluZVNoYXBlR3VhcmQoUgogCiBzdGF0aWMgTG9va3VwU3RhdHVzCiBVcGRhdGVTZXRH
bG9iYWxOYW1lU3R1YihWTUZyYW1lICZmLCBpYzo6U2V0R2xvYmFsTmFtZUlDICppYywgSlNPYmpl
Y3QgKm9iaiwgY29uc3QgU2hhcGUgKnNoYXBlKQogewogICAgIFJlcGF0Y2hlciByZXBhdGNoZXIo
aWMtPmV4dHJhU3R1Yik7CiAKICAgICBpYy0+cGF0Y2hFeHRyYVNoYXBlR3VhcmQocmVwYXRjaGVy
LCBvYmotPnNoYXBlKCkpOwogCisgICAgdWludDMyIGluZGV4ID0gb2JqLT5keW5hbWljU2xvdElu
ZGV4KHNoYXBlLT5zbG90KTsKICAgICBKU0M6OkNvZGVMb2NhdGlvbkxhYmVsIGxhYmVsKEpTQzo6
TWFjcm9Bc3NlbWJsZXJDb2RlUHRyKGljLT5leHRyYVN0dWIuc3RhcnQoKSkpOwogICAgIGxhYmVs
ID0gbGFiZWwubGFiZWxBdE9mZnNldChpYy0+ZXh0cmFTdG9yZU9mZnNldCk7Ci0gICAgcmVwYXRj
aGVyLnBhdGNoQWRkcmVzc09mZnNldEZvclZhbHVlU3RvcmUobGFiZWwsIHNoYXBlLT5zbG90ICog
c2l6ZW9mKFZhbHVlKSwKKyAgICByZXBhdGNoZXIucGF0Y2hBZGRyZXNzT2Zmc2V0Rm9yVmFsdWVT
dG9yZShsYWJlbCwgaW5kZXggKiBzaXplb2YoVmFsdWUpLAogICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgIGljLT52ci5pc1R5cGVLbm93bigpKTsKIAogICAgIHJl
dHVybiBMb29rdXBfQ2FjaGVhYmxlOwogfQogCiBzdGF0aWMgTG9va3VwU3RhdHVzCiBBdHRhY2hT
ZXRHbG9iYWxOYW1lU3R1YihWTUZyYW1lICZmLCBpYzo6U2V0R2xvYmFsTmFtZUlDICppYywgSlNP
YmplY3QgKm9iaiwgY29uc3QgU2hhcGUgKnNoYXBlKQogewpAQCAtMTk1LDMwICsxOTcsMzEgQEAg
QXR0YWNoU2V0R2xvYmFsTmFtZVN0dWIoVk1GcmFtZSAmZiwgaWM6OgogICAgICAgICBtYXNtLm1v
dmUoSW1tUHRyKG9iaiksIGljLT5vYmpSZWcpOwogCiAgICAgSlNfQVNTRVJUKG9iai0+YnJhbmRl
ZCgpKTsKIAogICAgIC8qCiAgICAgICogTG9hZCBvYmotPnNsb3RzLiBJZiBpYy0+b2JqQ29uc3Qs
IHRoZW4gdGhpcyBjbG9iYmVycyBvYmpSZWcsIGJlY2F1c2UKICAgICAgKiBpYy0+b2JqUmVnID09
IGljLT5zaGFwZVJlZy4KICAgICAgKi8KLSAgICBtYXNtLmxvYWRQdHIoQWRkcmVzcyhpYy0+b2Jq
UmVnLCBvZmZzZXRvZihKU09iamVjdCwgc2xvdHMpKSwgaWMtPnNoYXBlUmVnKTsKKyAgICBKU19B
U1NFUlQoIW9iai0+aXNGaXhlZFNsb3Qoc2hhcGUtPnNsb3QpKTsKKyAgICBtYXNtLmxvYWRQdHIo
QWRkcmVzcyhpYy0+b2JqUmVnLCBKU09iamVjdDo6b2Zmc2V0T2ZTbG90cygpKSwgaWMtPnNoYXBl
UmVnKTsKIAogICAgIC8qIFRlc3QgaWYgb3ZlcndyaXRpbmcgYSBmdW5jdGlvbi10YWdnZWQgc2xv
dC4gKi8KLSAgICBBZGRyZXNzIHNsb3QoaWMtPnNoYXBlUmVnLCBzaXplb2YoVmFsdWUpICogc2hh
cGUtPnNsb3QpOworICAgIEFkZHJlc3Mgc2xvdChpYy0+c2hhcGVSZWcsIHNpemVvZihWYWx1ZSkg
KiBvYmotPmR5bmFtaWNTbG90SW5kZXgoc2hhcGUtPnNsb3QpKTsKICAgICBKdW1wIGlzTm90T2Jq
ZWN0ID0gbWFzbS50ZXN0T2JqZWN0KEFzc2VtYmxlcjo6Tm90RXF1YWwsIHNsb3QpOwogCiAgICAg
LyogTm93LCB0ZXN0IGlmIHRoZSBvYmplY3QgaXMgYSBmdW5jdGlvbiBvYmplY3QuICovCiAgICAg
bWFzbS5sb2FkUGF5bG9hZChzbG90LCBpYy0+c2hhcGVSZWcpOwogICAgIEp1bXAgaXNGdW4gPSBt
YXNtLnRlc3RGdW5jdGlvbihBc3NlbWJsZXI6OkVxdWFsLCBpYy0+c2hhcGVSZWcpOwogCiAgICAg
LyogUmVzdG9yZSBzaGFwZVJlZyB0byBvYmotPnNsb3RzLCBzaW5jZSB3ZSBjbG9iYmVyZWQgaXQu
ICovCiAgICAgaWYgKGljLT5vYmpDb25zdCkKICAgICAgICAgbWFzbS5tb3ZlKEltbVB0cihvYmop
LCBpYy0+b2JqUmVnKTsKLSAgICBtYXNtLmxvYWRQdHIoQWRkcmVzcyhpYy0+b2JqUmVnLCBvZmZz
ZXRvZihKU09iamVjdCwgc2xvdHMpKSwgaWMtPnNoYXBlUmVnKTsKKyAgICBtYXNtLmxvYWRQdHIo
QWRkcmVzcyhpYy0+b2JqUmVnLCBKU09iamVjdDo6b2Zmc2V0T2ZTbG90cygpKSwgaWMtPnNoYXBl
UmVnKTsKIAogICAgIC8qIElmIHRoZSBvYmplY3QgdGVzdCBmYWlscywgc2hhcGVSZWcgaXMgc3Rp
bGwgb2JqLT5zbG90cy4gKi8KICAgICBpc05vdE9iamVjdC5saW5rVG8obWFzbS5sYWJlbCgpLCAm
bWFzbSk7CiAgICAgRGF0YUxhYmVsMzIgc3RvcmUgPSBtYXNtLnN0b3JlVmFsdWVXaXRoQWRkcmVz
c09mZnNldFBhdGNoKGljLT52ciwgc2xvdCk7CiAKICAgICBKdW1wIGRvbmUgPSBtYXNtLmp1bXAo
KTsKIAogICAgIEpJVFNjcmlwdCAqaml0ID0gZi5qaXQoKTsKQEAgLTMwMCwxOCArMzAzLDE5IEBA
IFVwZGF0ZVNldEdsb2JhbE5hbWUoVk1GcmFtZSAmZiwgaWM6OlNldEcKIAogICAgICAgICByZXR1
cm4gQXR0YWNoU2V0R2xvYmFsTmFtZVN0dWIoZiwgaWMsIG9iaiwgc2hhcGUpOwogICAgIH0KIAog
ICAgIC8qIE9iamVjdCBpcyBub3QgYnJhbmRlZCwgc28gd2UgY2FuIHVzZSB0aGUgaW5saW5lIHBh
dGguICovCiAgICAgUmVwYXRjaGVyIHJlcGF0Y2hlcihmLmppdCgpKTsKICAgICBpYy0+cGF0Y2hJ
bmxpbmVTaGFwZUd1YXJkKHJlcGF0Y2hlciwgb2JqLT5zaGFwZSgpKTsKIAorICAgIHVpbnQzMiBp
bmRleCA9IG9iai0+ZHluYW1pY1Nsb3RJbmRleChzaGFwZS0+c2xvdCk7CiAgICAgSlNDOjpDb2Rl
TG9jYXRpb25MYWJlbCBsYWJlbCA9IGljLT5mYXN0UGF0aFN0YXJ0LmxhYmVsQXRPZmZzZXQoaWMt
PmxvYWRTdG9yZU9mZnNldCk7Ci0gICAgcmVwYXRjaGVyLnBhdGNoQWRkcmVzc09mZnNldEZvclZh
bHVlU3RvcmUobGFiZWwsIHNoYXBlLT5zbG90ICogc2l6ZW9mKFZhbHVlKSwKKyAgICByZXBhdGNo
ZXIucGF0Y2hBZGRyZXNzT2Zmc2V0Rm9yVmFsdWVTdG9yZShsYWJlbCwgaW5kZXggKiBzaXplb2Yo
VmFsdWUpLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlj
LT52ci5pc1R5cGVLbm93bigpKTsKIAogICAgIHJldHVybiBMb29rdXBfQ2FjaGVhYmxlOwogfQog
CiB2b2lkIEpTX0ZBU1RDQUxMCiBpYzo6U2V0R2xvYmFsTmFtZShWTUZyYW1lICZmLCBpYzo6U2V0
R2xvYmFsTmFtZUlDICppYykKIHsKZGlmZiAtLWdpdCBhL2pzL3NyYy9tZXRob2RqaXQvUG9seUlD
LmNwcCBiL2pzL3NyYy9tZXRob2RqaXQvUG9seUlDLmNwcAotLS0gYS9qcy9zcmMvbWV0aG9kaml0
L1BvbHlJQy5jcHAKKysrIGIvanMvc3JjL21ldGhvZGppdC9Qb2x5SUMuY3BwCkBAIC0yMDYsNDIg
KzIwNiw0MiBAQCBjbGFzcyBTZXRQcm9wQ29tcGlsZXIgOiBwdWJsaWMgUElDU3R1YkNvCiAgICAg
ICAgICAgICAgICAgICAgICAgICAgIGludDMyKEpTT2JqZWN0TWFwOjpJTlZBTElEX1NIQVBFKSk7
CiAgICAgICAgIHJlcGF0Y2hlci5yZWxpbmsobGFiZWxzLmdldElubGluZVNoYXBlSnVtcChwaWMu
ZmFzdFBhdGhTdGFydC5sYWJlbEF0T2Zmc2V0KHBpYy5zaGFwZUd1YXJkKSksCiAgICAgICAgICAg
ICAgICAgICAgICAgICAgcGljLnNsb3dQYXRoU3RhcnQpOwogCiAgICAgICAgIEZ1bmN0aW9uUHRy
IHRhcmdldChKU19GVU5DX1RPX0RBVEFfUFRSKHZvaWQgKiwgaWM6OlNldFByb3ApKTsKICAgICAg
ICAgcmVwYXRjaGVyLnJlbGluayhwaWMuc2xvd1BhdGhDYWxsLCB0YXJnZXQpOwogICAgIH0KIAot
ICAgIExvb2t1cFN0YXR1cyBwYXRjaElubGluZShjb25zdCBTaGFwZSAqc2hhcGUsIGJvb2wgaW5s
aW5lU2xvdCkKKyAgICBMb29rdXBTdGF0dXMgcGF0Y2hJbmxpbmUoY29uc3QgU2hhcGUgKnNoYXBl
KQogICAgIHsKICAgICAgICAgSlNfQVNTRVJUKCFwaWMuaW5saW5lUGF0aFBhdGNoZWQpOwogICAg
ICAgICBKYWVnZXJTcGV3KEpTcGV3X1BJQ3MsICJwYXRjaCBzZXRwcm9wIGlubGluZSBhdCAlcFxu
IiwgcGljLmZhc3RQYXRoU3RhcnQuZXhlY3V0YWJsZUFkZHJlc3MoKSk7CiAKICAgICAgICAgUmVw
YXRjaGVyIHJlcGF0Y2hlcihmLmppdCgpKTsKICAgICAgICAgU2V0UHJvcExhYmVscyAmbGFiZWxz
ID0gcGljLnNldFByb3BMYWJlbHMoKTsKIAogICAgICAgICBpbnQzMiBvZmZzZXQ7Ci0gICAgICAg
IGlmIChpbmxpbmVTbG90KSB7CisgICAgICAgIGlmIChvYmotPmlzRml4ZWRTbG90KHNoYXBlLT5z
bG90KSkgewogICAgICAgICAgICAgQ29kZUxvY2F0aW9uSW5zdHJ1Y3Rpb24gaXN0ciA9IGxhYmVs
cy5nZXREc2xvdHNMb2FkKHBpYy5mYXN0UGF0aFJlam9pbiwgcGljLnUudnIpOwogICAgICAgICAg
ICAgcmVwYXRjaGVyLnJlcGF0Y2hMb2FkUHRyVG9MRUEoaXN0cik7CiAKICAgICAgICAgICAgIC8v
IAogICAgICAgICAgICAgLy8gV2UndmUgcGF0Y2hlZCB8IG1vdiBkc2xvdHMsIFtvYmogKyBEU0xP
VFNfT0ZGU0VUXQogICAgICAgICAgICAgLy8gVG86ICAgICAgICAgICB8IGxlYSBmc2xvdHMsIFtv
YmogKyBEU0xPVFNfT0ZGU0VUXQogICAgICAgICAgICAgLy8KICAgICAgICAgICAgIC8vIEJlY2F1
c2UgdGhlIG9mZnNldCBpcyB3cm9uZywgaXQncyBuZWNlc3NhcnkgdG8gY29ycmVjdCBpdAogICAg
ICAgICAgICAgLy8gYmVsb3cuCiAgICAgICAgICAgICAvLwogICAgICAgICAgICAgaW50MzIgZGlm
ZiA9IGludDMyKEpTT2JqZWN0OjpnZXRGaXhlZFNsb3RPZmZzZXQoMCkpIC0KLSAgICAgICAgICAg
ICAgICAgICAgICAgICBpbnQzMihvZmZzZXRvZihKU09iamVjdCwgc2xvdHMpKTsKKyAgICAgICAg
ICAgICAgICAgICAgICAgICBpbnQzMihKU09iamVjdDo6b2Zmc2V0T2ZTbG90cygpKTsKICAgICAg
ICAgICAgIEpTX0FTU0VSVChkaWZmICE9IDApOwogICAgICAgICAgICAgb2Zmc2V0ICA9IChpbnQz
MihzaGFwZS0+c2xvdCkgKiBzaXplb2YoVmFsdWUpKSArIGRpZmY7CiAgICAgICAgIH0gZWxzZSB7
Ci0gICAgICAgICAgICBvZmZzZXQgPSBzaGFwZS0+c2xvdCAqIHNpemVvZihWYWx1ZSk7CisgICAg
ICAgICAgICBvZmZzZXQgPSBvYmotPmR5bmFtaWNTbG90SW5kZXgoc2hhcGUtPnNsb3QpICogc2l6
ZW9mKFZhbHVlKTsKICAgICAgICAgfQogCiAgICAgICAgIHJlcGF0Y2hlci5yZXBhdGNoKGxhYmVs
cy5nZXRJbmxpbmVTaGFwZURhdGEocGljLmZhc3RQYXRoU3RhcnQsIHBpYy5zaGFwZUd1YXJkKSwK
ICAgICAgICAgICAgICAgICAgICAgICAgICAgb2JqLT5zaGFwZSgpKTsKICAgICAgICAgcmVwYXRj
aGVyLnBhdGNoQWRkcmVzc09mZnNldEZvclZhbHVlU3RvcmUobGFiZWxzLmdldElubGluZVZhbHVl
U3RvcmUocGljLmZhc3RQYXRoUmVqb2luLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBwaWMudS52ciks
CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9mZnNl
dCwgcGljLnUudnIuaXNUeXBlS25vd24oKSk7CiAKQEAgLTI2NywxNyArMjY3LDE3IEBAIGNsYXNz
IFNldFByb3BDb21waWxlciA6IHB1YmxpYyBQSUNTdHViQ28KICAgICAgICAgfSBlbHNlIHsKICAg
ICAgICAgICAgIENvZGVMb2NhdGlvbkxhYmVsIHNoYXBlR3VhcmQgPSBsYWJlbC5sYWJlbEF0T2Zm
c2V0KHBpYy5zaGFwZUd1YXJkKTsKICAgICAgICAgICAgIHJlcGF0Y2hlci5yZWxpbmsocGljLnNl
dFByb3BMYWJlbHMoKS5nZXRJbmxpbmVTaGFwZUp1bXAoc2hhcGVHdWFyZCksIGNzKTsKICAgICAg
ICAgfQogICAgICAgICBpZiAoaW50IHNlY29uZEd1YXJkT2Zmc2V0ID0gZ2V0TGFzdFN0dWJTZWNv
bmRTaGFwZUd1YXJkKCkpCiAgICAgICAgICAgICByZXBhdGNoZXIucmVsaW5rKGxhYmVsLmp1bXBB
dE9mZnNldChzZWNvbmRHdWFyZE9mZnNldCksIGNzKTsKICAgICB9CiAKLSAgICBMb29rdXBTdGF0
dXMgZ2VuZXJhdGVTdHViKHVpbnQzMiBpbml0aWFsU2hhcGUsIGNvbnN0IFNoYXBlICpzaGFwZSwg
Ym9vbCBhZGRpbmcsIGJvb2wgaW5saW5lU2xvdCkKKyAgICBMb29rdXBTdGF0dXMgZ2VuZXJhdGVT
dHViKHVpbnQzMiBpbml0aWFsU2hhcGUsIGNvbnN0IFNoYXBlICpzaGFwZSwgYm9vbCBhZGRpbmcp
CiAgICAgewogICAgICAgICAvKiBFeGl0cyB0byB0aGUgc2xvdyBwYXRoLiAqLwogICAgICAgICBW
ZWN0b3I8SnVtcCwgOD4gc2xvd0V4aXRzKGN4KTsKICAgICAgICAgVmVjdG9yPEp1bXAsIDg+IG90
aGVyR3VhcmRzKGN4KTsKIAogICAgICAgICBBc3NlbWJsZXIgbWFzbTsKIAogICAgICAgICAvLyBT
aGFwZSBndWFyZC4KQEAgLTMyNywzMSArMzI3LDMxIEBAIGNsYXNzIFNldFByb3BDb21waWxlciA6
IHB1YmxpYyBQSUNTdHViQ28KICAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAg
ICAgICAgICBKdW1wIG1pc21hdGNoZWRGdW5jdGlvbiA9CiAgICAgICAgICAgICAgICAgICAgICAg
ICBtYXNtLmJyYW5jaFB0cihBc3NlbWJsZXI6Ok5vdEVxdWFsLCBwaWMudS52ci5kYXRhUmVnKCks
IEltbVB0cihmdW5vYmopKTsKICAgICAgICAgICAgICAgICAgICAgaWYgKCFzbG93RXhpdHMuYXBw
ZW5kKG1pc21hdGNoZWRGdW5jdGlvbikpCiAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4g
ZXJyb3IoKTsKICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICB9CiAKLSAgICAgICAgICAg
IGlmIChpbmxpbmVTbG90KSB7CisgICAgICAgICAgICBpZiAob2JqLT5pc0ZpeGVkU2xvdChzaGFw
ZS0+c2xvdCkpIHsKICAgICAgICAgICAgICAgICBBZGRyZXNzIGFkZHJlc3MocGljLm9ialJlZywK
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgSlNPYmplY3Q6OmdldEZpeGVkU2xvdE9m
ZnNldChzaGFwZS0+c2xvdCkpOwogICAgICAgICAgICAgICAgIG1hc20uc3RvcmVWYWx1ZShwaWMu
dS52ciwgYWRkcmVzcyk7CiAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgIC8q
IENoZWNrIGNhcGFjaXR5LiAqLwogICAgICAgICAgICAgICAgIEFkZHJlc3MgY2FwYWNpdHkocGlj
Lm9ialJlZywgb2Zmc2V0b2YoSlNPYmplY3QsIGNhcGFjaXR5KSk7CiAgICAgICAgICAgICAgICAg
bWFzbS5sb2FkMzIobWFzbS5wYXlsb2FkT2YoY2FwYWNpdHkpLCBwaWMuc2hhcGVSZWcpOwogICAg
ICAgICAgICAgICAgIEp1bXAgb3ZlckNhcGFjaXR5ID0gbWFzbS5icmFuY2gzMihBc3NlbWJsZXI6
Okxlc3NUaGFuT3JFcXVhbCwgcGljLnNoYXBlUmVnLAogICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICBJbW0zMihzaGFwZS0+c2xvdCkpOwogICAgICAgICAg
ICAgICAgIGlmICghc2xvd0V4aXRzLmFwcGVuZChvdmVyQ2FwYWNpdHkpKQogICAgICAgICAgICAg
ICAgICAgICByZXR1cm4gZXJyb3IoKTsKIAotICAgICAgICAgICAgICAgIG1hc20ubG9hZFB0cihB
ZGRyZXNzKHBpYy5vYmpSZWcsIG9mZnNldG9mKEpTT2JqZWN0LCBzbG90cykpLCBwaWMuc2hhcGVS
ZWcpOwotICAgICAgICAgICAgICAgIEFkZHJlc3MgYWRkcmVzcyhwaWMuc2hhcGVSZWcsIHNoYXBl
LT5zbG90ICogc2l6ZW9mKFZhbHVlKSk7CisgICAgICAgICAgICAgICAgbWFzbS5sb2FkUHRyKEFk
ZHJlc3MocGljLm9ialJlZywgSlNPYmplY3Q6Om9mZnNldE9mU2xvdHMoKSksIHBpYy5zaGFwZVJl
Zyk7CisgICAgICAgICAgICAgICAgQWRkcmVzcyBhZGRyZXNzKHBpYy5zaGFwZVJlZywgb2JqLT5k
eW5hbWljU2xvdEluZGV4KHNoYXBlLT5zbG90KSAqIHNpemVvZihWYWx1ZSkpOwogICAgICAgICAg
ICAgICAgIG1hc20uc3RvcmVWYWx1ZShwaWMudS52ciwgYWRkcmVzcyk7CiAgICAgICAgICAgICB9
CiAKICAgICAgICAgICAgIHVpbnQzMiBuZXdTaGFwZSA9IG9iai0+c2hhcGUoKTsKICAgICAgICAg
ICAgIEpTX0FTU0VSVChuZXdTaGFwZSAhPSBpbml0aWFsU2hhcGUpOwogCiAgICAgICAgICAgICAv
KiBXcml0ZSB0aGUgb2JqZWN0J3MgbmV3IHNoYXBlLiAqLwogICAgICAgICAgICAgbWFzbS5zdG9y
ZVB0cihJbW1QdHIoc2hhcGUpLCBBZGRyZXNzKHBpYy5vYmpSZWcsIG9mZnNldG9mKEpTT2JqZWN0
LCBsYXN0UHJvcCkpKTsKQEAgLTM2MiwyMSArMzYyLDE3IEBAIGNsYXNzIFNldFByb3BDb21waWxl
ciA6IHB1YmxpYyBQSUNTdHViQ28KICAgICAgICAgICAgICAgICBBZGRyZXNzIGZsYWdzKHBpYy5v
YmpSZWcsIG9mZnNldG9mKEpTT2JqZWN0LCBmbGFncykpOwogCiAgICAgICAgICAgICAgICAgLyog
VXNlIHNoYXBlUmVnIHRvIGxvYWQsIGJpdHdpc2Utb3IsIGFuZCBzdG9yZSBmbGFncy4gKi8KICAg
ICAgICAgICAgICAgICBtYXNtLmxvYWQzMihmbGFncywgcGljLnNoYXBlUmVnKTsKICAgICAgICAg
ICAgICAgICBtYXNtLm9yMzIoSW1tMzIoSlNPYmplY3Q6Ok1FVEhPRF9CQVJSSUVSKSwgcGljLnNo
YXBlUmVnKTsKICAgICAgICAgICAgICAgICBtYXNtLnN0b3JlMzIocGljLnNoYXBlUmVnLCBmbGFn
cyk7CiAgICAgICAgICAgICB9CiAgICAgICAgIH0gZWxzZSBpZiAoc2hhcGUtPmhhc0RlZmF1bHRT
ZXR0ZXIoKSkgewotICAgICAgICAgICAgQWRkcmVzcyBhZGRyZXNzKHBpYy5vYmpSZWcsIEpTT2Jq
ZWN0OjpnZXRGaXhlZFNsb3RPZmZzZXQoc2hhcGUtPnNsb3QpKTsKLSAgICAgICAgICAgIGlmICgh
aW5saW5lU2xvdCkgewotICAgICAgICAgICAgICAgIG1hc20ubG9hZFB0cihBZGRyZXNzKHBpYy5v
YmpSZWcsIG9mZnNldG9mKEpTT2JqZWN0LCBzbG90cykpLCBwaWMub2JqUmVnKTsKLSAgICAgICAg
ICAgICAgICBhZGRyZXNzID0gQWRkcmVzcyhwaWMub2JqUmVnLCBzaGFwZS0+c2xvdCAqIHNpemVv
ZihWYWx1ZSkpOwotICAgICAgICAgICAgfQorICAgICAgICAgICAgQWRkcmVzcyBhZGRyZXNzID0g
bWFzbS5vYmpQcm9wQWRkcmVzcyhvYmosIHBpYy5vYmpSZWcsIHNoYXBlLT5zbG90KTsKIAogICAg
ICAgICAgICAgLy8gSWYgdGhlIHNjb3BlIGlzIGJyYW5kZWQsIG9yIGhhcyBhIG1ldGhvZCBiYXJy
aWVyLiBJdCdzIG5vdyBuZWNlc3NhcnkKICAgICAgICAgICAgIC8vIHRvIGd1YXJkIHRoYXQgd2Un
cmUgbm90IG92ZXJ3cml0aW5nIGEgZnVuY3Rpb24tdmFsdWVkIHByb3BlcnR5LgogICAgICAgICAg
ICAgaWYgKG9iai0+YnJhbmRlZE9ySGFzTWV0aG9kQmFycmllcigpKSB7CiAgICAgICAgICAgICAg
ICAgbWFzbS5sb2FkVHlwZVRhZyhhZGRyZXNzLCBwaWMuc2hhcGVSZWcpOwogICAgICAgICAgICAg
ICAgIEp1bXAgc2tpcCA9IG1hc20udGVzdE9iamVjdChBc3NlbWJsZXI6Ok5vdEVxdWFsLCBwaWMu
c2hhcGVSZWcpOwogICAgICAgICAgICAgICAgIG1hc20ubG9hZFBheWxvYWQoYWRkcmVzcywgcGlj
LnNoYXBlUmVnKTsKICAgICAgICAgICAgICAgICBKdW1wIHJlYnJhbmQgPSBtYXNtLnRlc3RGdW5j
dGlvbihBc3NlbWJsZXI6OkVxdWFsLCBwaWMuc2hhcGVSZWcpOwpAQCAtNDA5LDIwICs0MDUsMjEg
QEAgY2xhc3MgU2V0UHJvcENvbXBpbGVyIDogcHVibGljIFBJQ1N0dWJDbwogICAgICAgICAgICAg
ICAgIG1hc20uc3RvcmVWYWx1ZShwaWMudS52ciwgYWRkcik7CiAgICAgICAgICAgICAgICAgc2tp
cE92ZXIgPSBtYXNtLmp1bXAoKTsKICAgICAgICAgICAgIH0KIAogICAgICAgICAgICAgZXNjYXBl
ZEZyYW1lLmxpbmtUbyhtYXNtLmxhYmVsKCksICZtYXNtKTsKICAgICAgICAgICAgIHsKICAgICAg
ICAgICAgICAgICBpZiAoc2hhcGUtPnNldHRlck9wKCkgPT0gU2V0Q2FsbFZhcikKICAgICAgICAg
ICAgICAgICAgICAgc2xvdCArPSBmdW4tPm5hcmdzOwotICAgICAgICAgICAgICAgIG1hc20ubG9h
ZFB0cihBZGRyZXNzKHBpYy5vYmpSZWcsIG9mZnNldG9mKEpTT2JqZWN0LCBzbG90cykpLCBwaWMu
b2JqUmVnKTsKLQotICAgICAgICAgICAgICAgIEFkZHJlc3MgZHNsb3QocGljLm9ialJlZywgKHNs
b3QgKyBKU09iamVjdDo6Q0FMTF9SRVNFUlZFRF9TTE9UUykgKiBzaXplb2YoVmFsdWUpKTsKLSAg
ICAgICAgICAgICAgICBtYXNtLnN0b3JlVmFsdWUocGljLnUudnIsIGRzbG90KTsKKworICAgICAg
ICAgICAgICAgIHNsb3QgKz0gSlNPYmplY3Q6OkNBTExfUkVTRVJWRURfU0xPVFM7CisgICAgICAg
ICAgICAgICAgQWRkcmVzcyBhZGRyZXNzID0gbWFzbS5vYmpQcm9wQWRkcmVzcyhvYmosIHBpYy5v
YmpSZWcsIHNsb3QpOworCisgICAgICAgICAgICAgICAgbWFzbS5zdG9yZVZhbHVlKHBpYy51LnZy
LCBhZGRyZXNzKTsKICAgICAgICAgICAgIH0KIAogICAgICAgICAgICAgcGljLnNoYXBlUmVnSGFz
QmFzZVNoYXBlID0gZmFsc2U7CiAgICAgICAgIH0KIAogICAgICAgICBKdW1wIGRvbmUgPSBtYXNt
Lmp1bXAoKTsKIAogICAgICAgICAvLyBDb21tb24gYWxsIHNlY29uZGFyeSBndWFyZHMgaW50byBv
bmUgYmlnIGV4aXQuCkBAIC01OTIsMTcgKzU4OSwxNyBAQCBjbGFzcyBTZXRQcm9wQ29tcGlsZXIg
OiBwdWJsaWMgUElDU3R1YkNvCiAgICAgICAgICAgICAgKiBEb2luZyB0aGlzIHdvdWxkIGNhdXNl
IHVzIHRvIHdhbGsgZG93biB0aGlzIHNhbWUgdXBkYXRlIHBhdGgKICAgICAgICAgICAgICAqIGV2
ZXJ5IHRpbWUgYSByZWFsbG9jYXRpb24gaXMgbmVlZGVkLCBob3dldmVyLCB3aGljaCB3aWxsCiAg
ICAgICAgICAgICAgKiB1c3VhbGx5IGJlIGEgc2xvd2Rvd24gZXZlbiBpZiB0aGVyZSAqYXJlKiBv
dGhlciBzaGFwZXMgdGhhdAogICAgICAgICAgICAgICogZG9uJ3QgcmVhbGxvYy4KICAgICAgICAg
ICAgICAqLwogICAgICAgICAgICAgaWYgKG9iai0+bnVtU2xvdHMoKSAhPSBzbG90cykKICAgICAg
ICAgICAgICAgICByZXR1cm4gZGlzYWJsZSgiaW5zdWZmaWNpZW50IHNsb3QgY2FwYWNpdHkiKTsK
IAotICAgICAgICAgICAgcmV0dXJuIGdlbmVyYXRlU3R1Yihpbml0aWFsU2hhcGUsIHNoYXBlLCB0
cnVlLCAhb2JqLT5oYXNTbG90c0FycmF5KCkpOworICAgICAgICAgICAgcmV0dXJuIGdlbmVyYXRl
U3R1Yihpbml0aWFsU2hhcGUsIHNoYXBlLCB0cnVlKTsKICAgICAgICAgfQogCiAgICAgICAgIGNv
bnN0IFNoYXBlICpzaGFwZSA9IChjb25zdCBTaGFwZSAqKSBwcm9wOwogICAgICAgICBpZiAocGlj
LmtpbmQgPT0gaWM6OlBJQ0luZm86OlNFVE1FVEhPRCAmJiAhc2hhcGUtPmlzTWV0aG9kKCkpCiAg
ICAgICAgICAgICByZXR1cm4gZGlzYWJsZSgic2V0IG1ldGhvZCBvbiBub24tbWV0aG9kIHNoYXBl
Iik7CiAgICAgICAgIGlmICghc2hhcGUtPndyaXRhYmxlKCkpCiAgICAgICAgICAgICByZXR1cm4g
ZGlzYWJsZSgicmVhZG9ubHkiKTsKIApAQCAtNjE4LDIwICs2MTUsMjAgQEAgY2xhc3MgU2V0UHJv
cENvbXBpbGVyIDogcHVibGljIFBJQ1N0dWJDbwogICAgICAgICAgICAgfQogICAgICAgICB9CiAK
ICAgICAgICAgSlNfQVNTRVJUKG9iaiA9PSBob2xkZXIpOwogICAgICAgICBpZiAoIXBpYy5pbmxp
bmVQYXRoUGF0Y2hlZCAmJgogICAgICAgICAgICAgIW9iai0+YnJhbmRlZE9ySGFzTWV0aG9kQmFy
cmllcigpICYmCiAgICAgICAgICAgICBzaGFwZS0+aGFzRGVmYXVsdFNldHRlcigpICYmCiAgICAg
ICAgICAgICAhb2JqLT5pc0RlbnNlQXJyYXkoKSkgewotICAgICAgICAgICAgcmV0dXJuIHBhdGNo
SW5saW5lKHNoYXBlLCAhb2JqLT5oYXNTbG90c0FycmF5KCkpOwotICAgICAgICB9IAotCi0gICAg
ICAgIHJldHVybiBnZW5lcmF0ZVN0dWIob2JqLT5zaGFwZSgpLCBzaGFwZSwgZmFsc2UsICFvYmot
Pmhhc1Nsb3RzQXJyYXkoKSk7CisgICAgICAgICAgICByZXR1cm4gcGF0Y2hJbmxpbmUoc2hhcGUp
OworICAgICAgICB9CisKKyAgICAgICAgcmV0dXJuIGdlbmVyYXRlU3R1YihvYmotPnNoYXBlKCks
IHNoYXBlLCBmYWxzZSk7CiAgICAgfQogfTsKIAogc3RhdGljIGJvb2wKIElzQ2FjaGVhYmxlUHJv
dG9DaGFpbihKU09iamVjdCAqb2JqLCBKU09iamVjdCAqaG9sZGVyKQogewogICAgIHdoaWxlIChv
YmogIT0gaG9sZGVyKSB7CiAgICAgICAgIEpTT2JqZWN0ICpwcm90byA9IG9iai0+Z2V0UHJvdG8o
KTsKQEAgLTc2NCwxOSArNzYxLDE3IEBAIGNsYXNzIEdldFByb3BDb21waWxlciA6IHB1YmxpYyBQ
SUNTdHViQ28KICAgICB9CiAKICAgICBMb29rdXBTdGF0dXMgZ2VuZXJhdGVBcmdzTGVuZ3RoU3R1
YigpCiAgICAgewogICAgICAgICBBc3NlbWJsZXIgbWFzbTsKIAogICAgICAgICBKdW1wIG5vdEFy
Z3MgPSBtYXNtLnRlc3RPYmpDbGFzcyhBc3NlbWJsZXI6Ok5vdEVxdWFsLCBwaWMub2JqUmVnLCBv
YmotPmdldENsYXNzKCkpOwogCi0gICAgICAgIG1hc20ubG9hZFB0cihBZGRyZXNzKHBpYy5vYmpS
ZWcsIG9mZnNldG9mKEpTT2JqZWN0LCBzbG90cykpLCBwaWMub2JqUmVnKTsKLSAgICAgICAgbWFz
bS5sb2FkMzIoQWRkcmVzcyhwaWMub2JqUmVnLCBKU09iamVjdDo6SlNTTE9UX0FSR1NfTEVOR1RI
ICogc2l6ZW9mKFZhbHVlKSksCi0gICAgICAgICAgICAgICAgICAgIHBpYy5vYmpSZWcpOworICAg
ICAgICBtYXNtLmxvYWQzMihBZGRyZXNzKHBpYy5vYmpSZWcsIEpTT2JqZWN0OjpnZXRBcmd1bWVu
dHNMZW5ndGhPZmZzZXQoKSksIHBpYy5vYmpSZWcpOwogICAgICAgICBtYXNtLm1vdmUocGljLm9i
alJlZywgcGljLnNoYXBlUmVnKTsKICAgICAgICAgSnVtcCBvdmVycmlkZGVuID0gbWFzbS5icmFu
Y2hUZXN0MzIoQXNzZW1ibGVyOjpOb25aZXJvLCBwaWMuc2hhcGVSZWcsCiAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIEltbTMyKEpTT2JqZWN0OjpBUkdTX0xFTkdU
SF9PVkVSUklEREVOX0JJVCkpOwogICAgICAgICBtYXNtLnJzaGlmdDMyKEltbTMyKEpTT2JqZWN0
OjpBUkdTX1BBQ0tFRF9CSVRTX0NPVU5UKSwgcGljLm9ialJlZyk7CiAgICAgICAgIAogICAgICAg
ICBtYXNtLm1vdmUoSW1tVHlwZShKU1ZBTF9UWVBFX0lOVDMyKSwgcGljLnNoYXBlUmVnKTsKICAg
ICAgICAgSnVtcCBkb25lID0gbWFzbS5qdW1wKCk7CiAKQEAgLTg0MiwxOSArODM3LDE5IEBAIGNs
YXNzIEdldFByb3BDb21waWxlciA6IHB1YmxpYyBQSUNTdHViQ28KICAgICAgICAgcmV0dXJuIExv
b2t1cF9DYWNoZWFibGU7CiAgICAgfQogCiAgICAgTG9va3VwU3RhdHVzIGdlbmVyYXRlU3RyaW5n
T2JqTGVuZ3RoU3R1YigpCiAgICAgewogICAgICAgICBBc3NlbWJsZXIgbWFzbTsKIAogICAgICAg
ICBKdW1wIG5vdFN0cmluZ09iaiA9IG1hc20udGVzdE9iakNsYXNzKEFzc2VtYmxlcjo6Tm90RXF1
YWwsIHBpYy5vYmpSZWcsIG9iai0+Z2V0Q2xhc3MoKSk7Ci0gICAgICAgIG1hc20ubG9hZFB0cihB
ZGRyZXNzKHBpYy5vYmpSZWcsIG9mZnNldG9mKEpTT2JqZWN0LCBzbG90cykpLCBwaWMub2JqUmVn
KTsKLSAgICAgICAgbWFzbS5sb2FkUGF5bG9hZChBZGRyZXNzKHBpYy5vYmpSZWcsIEpTT2JqZWN0
OjpKU1NMT1RfUFJJTUlUSVZFX1RISVMgKiBzaXplb2YoVmFsdWUpKSwKLSAgICAgICAgICAgICAg
ICAgICAgICAgICBwaWMub2JqUmVnKTsKKworCisgICAgICAgIG1hc20ubG9hZFBheWxvYWQoQWRk
cmVzcyhwaWMub2JqUmVnLCBKU09iamVjdDo6Z2V0UHJpbWl0aXZlVGhpc09mZnNldCgpKSwgcGlj
Lm9ialJlZyk7CiAgICAgICAgIG1hc20ubG9hZFB0cihBZGRyZXNzKHBpYy5vYmpSZWcsIEpTU3Ry
aW5nOjpvZmZzZXRPZkxlbmd0aEFuZEZsYWdzKCkpLCBwaWMub2JqUmVnKTsKICAgICAgICAgbWFz
bS51cnNoaWZ0MzIoSW1tMzIoSlNTdHJpbmc6OkxFTkdUSF9TSElGVCksIHBpYy5vYmpSZWcpOwog
ICAgICAgICBtYXNtLm1vdmUoSW1tVHlwZShKU1ZBTF9UWVBFX0lOVDMyKSwgcGljLnNoYXBlUmVn
KTsKICAgICAgICAgSnVtcCBkb25lID0gbWFzbS5qdW1wKCk7CiAKICAgICAgICAgUElDTGlua2Vy
IGJ1ZmZlcihtYXNtLCBwaWMpOwogICAgICAgICBpZiAoIWJ1ZmZlci5pbml0KGN4KSkKICAgICAg
ICAgICAgIHJldHVybiBlcnJvcigpOwpAQCAtOTk1LDMzICs5OTAsMzMgQEAgY2xhc3MgR2V0UHJv
cENvbXBpbGVyIDogcHVibGljIFBJQ1N0dWJDbwogCiAgICAgTG9va3VwU3RhdHVzIHBhdGNoSW5s
aW5lKEpTT2JqZWN0ICpob2xkZXIsIGNvbnN0IFNoYXBlICpzaGFwZSkKICAgICB7CiAgICAgICAg
IHNwZXcoInBhdGNoIiwgImlubGluZSIpOwogICAgICAgICBSZXBhdGNoZXIgcmVwYXRjaGVyKGYu
aml0KCkpOwogICAgICAgICBHZXRQcm9wTGFiZWxzICZsYWJlbHMgPSBwaWMuZ2V0UHJvcExhYmVs
cygpOwogCiAgICAgICAgIGludDMyIG9mZnNldDsKLSAgICAgICAgaWYgKCFob2xkZXItPmhhc1Ns
b3RzQXJyYXkoKSkgeworICAgICAgICBpZiAoaG9sZGVyLT5pc0ZpeGVkU2xvdChzaGFwZS0+c2xv
dCkpIHsKICAgICAgICAgICAgIENvZGVMb2NhdGlvbkluc3RydWN0aW9uIGlzdHIgPSBsYWJlbHMu
Z2V0RHNsb3RzTG9hZChwaWMuZmFzdFBhdGhSZWpvaW4pOwogICAgICAgICAgICAgcmVwYXRjaGVy
LnJlcGF0Y2hMb2FkUHRyVG9MRUEoaXN0cik7CiAKICAgICAgICAgICAgIC8vIAogICAgICAgICAg
ICAgLy8gV2UndmUgcGF0Y2hlZCB8IG1vdiBkc2xvdHMsIFtvYmogKyBEU0xPVFNfT0ZGU0VUXQog
ICAgICAgICAgICAgLy8gVG86ICAgICAgICAgICB8IGxlYSBmc2xvdHMsIFtvYmogKyBEU0xPVFNf
T0ZGU0VUXQogICAgICAgICAgICAgLy8KICAgICAgICAgICAgIC8vIEJlY2F1c2UgdGhlIG9mZnNl
dCBpcyB3cm9uZywgaXQncyBuZWNlc3NhcnkgdG8gY29ycmVjdCBpdAogICAgICAgICAgICAgLy8g
YmVsb3cuCiAgICAgICAgICAgICAvLwogICAgICAgICAgICAgaW50MzIgZGlmZiA9IGludDMyKEpT
T2JqZWN0OjpnZXRGaXhlZFNsb3RPZmZzZXQoMCkpIC0KLSAgICAgICAgICAgICAgICAgICAgICAg
ICBpbnQzMihvZmZzZXRvZihKU09iamVjdCwgc2xvdHMpKTsKKyAgICAgICAgICAgICAgICAgICAg
ICAgICBpbnQzMihKU09iamVjdDo6b2Zmc2V0T2ZTbG90cygpKTsKICAgICAgICAgICAgIEpTX0FT
U0VSVChkaWZmICE9IDApOwogICAgICAgICAgICAgb2Zmc2V0ICA9IChpbnQzMihzaGFwZS0+c2xv
dCkgKiBzaXplb2YoVmFsdWUpKSArIGRpZmY7CiAgICAgICAgIH0gZWxzZSB7Ci0gICAgICAgICAg
ICBvZmZzZXQgPSBzaGFwZS0+c2xvdCAqIHNpemVvZihWYWx1ZSk7CisgICAgICAgICAgICBvZmZz
ZXQgPSBob2xkZXItPmR5bmFtaWNTbG90SW5kZXgoc2hhcGUtPnNsb3QpICogc2l6ZW9mKFZhbHVl
KTsKICAgICAgICAgfQogCiAgICAgICAgIHJlcGF0Y2hlci5yZXBhdGNoKGxhYmVscy5nZXRJbmxp
bmVTaGFwZURhdGEocGljLmdldEZhc3RTaGFwZUd1YXJkKCkpLCBvYmotPnNoYXBlKCkpOwogICAg
ICAgICByZXBhdGNoZXIucGF0Y2hBZGRyZXNzT2Zmc2V0Rm9yVmFsdWVMb2FkKGxhYmVscy5nZXRW
YWx1ZUxvYWQocGljLmZhc3RQYXRoUmVqb2luKSwgb2Zmc2V0KTsKIAogICAgICAgICBwaWMuaW5s
aW5lUGF0aFBhdGNoZWQgPSB0cnVlOwogCiAgICAgICAgIHJldHVybiBMb29rdXBfQ2FjaGVhYmxl
OwpAQCAtMTM1NywyNCArMTM1MiwyNCBAQCBjbGFzcyBTY29wZU5hbWVDb21waWxlciA6IHB1Ymxp
YyBQSUNTdHViCiAgICAgICAgICAgICBtYXNtLmxvYWRQYXlsb2FkKGFkZHIsIHBpYy5vYmpSZWcp
OwogICAgICAgICAgICAgbWFzbS5sb2FkVHlwZVRhZyhhZGRyLCBwaWMuc2hhcGVSZWcpOwogICAg
ICAgICAgICAgc2tpcE92ZXIgPSBtYXNtLmp1bXAoKTsKICAgICAgICAgfQogCiAgICAgICAgIGVz
Y2FwZWRGcmFtZS5saW5rVG8obWFzbS5sYWJlbCgpLCAmbWFzbSk7CiAKICAgICAgICAgewotICAg
ICAgICAgICAgbWFzbS5sb2FkUHRyKEFkZHJlc3MocGljLm9ialJlZywgb2Zmc2V0b2YoSlNPYmpl
Y3QsIHNsb3RzKSksIHBpYy5vYmpSZWcpOwotCiAgICAgICAgICAgICBpZiAoa2luZCA9PSBWQVIp
CiAgICAgICAgICAgICAgICAgc2xvdCArPSBmdW4tPm5hcmdzOwotICAgICAgICAgICAgQWRkcmVz
cyBkc2xvdChwaWMub2JqUmVnLCAoc2xvdCArIEpTT2JqZWN0OjpDQUxMX1JFU0VSVkVEX1NMT1RT
KSAqIHNpemVvZihWYWx1ZSkpOworCisgICAgICAgICAgICBzbG90ICs9IEpTT2JqZWN0OjpDQUxM
X1JFU0VSVkVEX1NMT1RTOworICAgICAgICAgICAgQWRkcmVzcyBhZGRyZXNzID0gbWFzbS5vYmpQ
cm9wQWRkcmVzcyhvYmosIHBpYy5vYmpSZWcsIHNsb3QpOwogCiAgICAgICAgICAgICAvKiBTYWZl
IGJlY2F1c2UgdHlwZSBpcyBsb2FkZWQgZmlyc3QuICovCi0gICAgICAgICAgICBtYXNtLmxvYWRW
YWx1ZUFzQ29tcG9uZW50cyhkc2xvdCwgcGljLnNoYXBlUmVnLCBwaWMub2JqUmVnKTsKKyAgICAg
ICAgICAgIG1hc20ubG9hZFZhbHVlQXNDb21wb25lbnRzKGFkZHJlc3MsIHBpYy5zaGFwZVJlZywg
cGljLm9ialJlZyk7CiAgICAgICAgIH0KIAogICAgICAgICBza2lwT3Zlci5saW5rVG8obWFzbS5s
YWJlbCgpLCAmbWFzbSk7CiAgICAgICAgIEp1bXAgZG9uZSA9IG1hc20uanVtcCgpOwogCiAgICAg
ICAgIC8vIEFsbCBmYWlsdXJlcyBmbG93IHRvIGhlcmUsIHNvIHRoZXJlIGlzIGEgY29tbW9uIHBv
aW50IHRvIHBhdGNoLgogICAgICAgICBmb3IgKEp1bXAgKnBqID0gZmFpbHMuYmVnaW4oKTsgcGog
IT0gZmFpbHMuZW5kKCk7ICsrcGopCiAgICAgICAgICAgICBwai0+bGlua1RvKG1hc20ubGFiZWwo
KSwgJm1hc20pOwpAQCAtMjUxNiwxNyArMjUxMSwxNyBAQCBTZXRFbGVtZW50SUM6OmF0dGFjaEhv
bGVTdHViKEpTQ29udGV4dCAqCiAgICAgICAgIHNraXBVcGRhdGUgPSBtYXNtLmJyYW5jaDMyKEFz
c2VtYmxlcjo6QWJvdmUsIGFycmF5TGVuZ3RoLCBrZXlSZWcpOwogICAgICAgICBtYXNtLmFkZDMy
KEltbTMyKDEpLCBrZXlSZWcpOwogICAgICAgICBtYXNtLnN0b3JlMzIoa2V5UmVnLCBhcnJheUxl
bmd0aCk7CiAgICAgICAgIG1hc20uc3ViMzIoSW1tMzIoMSksIGtleVJlZyk7CiAgICAgfQogICAg
IHNraXBVcGRhdGUubGlua1RvKG1hc20ubGFiZWwoKSwgJm1hc20pOwogCiAgICAgLy8gU3RvcmUg
dGhlIHZhbHVlIGJhY2suCi0gICAgbWFzbS5sb2FkUHRyKEFkZHJlc3Mob2JqUmVnLCBvZmZzZXRv
ZihKU09iamVjdCwgc2xvdHMpKSwgb2JqUmVnKTsKKyAgICBtYXNtLmxvYWRQdHIoQWRkcmVzcyhv
YmpSZWcsIEpTT2JqZWN0OjpvZmZzZXRPZlNsb3RzKCkpLCBvYmpSZWcpOwogICAgIGlmIChoYXND
b25zdGFudEtleSkgewogICAgICAgICBBZGRyZXNzIHNsb3Qob2JqUmVnLCBrZXlWYWx1ZSAqIHNp
emVvZihWYWx1ZSkpOwogICAgICAgICBtYXNtLnN0b3JlVmFsdWUodnIsIHNsb3QpOwogICAgIH0g
ZWxzZSB7CiAgICAgICAgIEJhc2VJbmRleCBzbG90KG9ialJlZywga2V5UmVnLCBBc3NlbWJsZXI6
OkpTVkFMX1NDQUxFKTsKICAgICAgICAgbWFzbS5zdG9yZVZhbHVlKHZyLCBzbG90KTsKICAgICB9
CiAKZGlmZiAtLWdpdCBhL2pzL3NyYy90cmFjZWppdC9Xcml0ZXIuY3BwIGIvanMvc3JjL3RyYWNl
aml0L1dyaXRlci5jcHAKLS0tIGEvanMvc3JjL3RyYWNlaml0L1dyaXRlci5jcHAKKysrIGIvanMv
c3JjL3RyYWNlaml0L1dyaXRlci5jcHAKQEAgLTI2MCwyNSArMjYwLDMxIEBAIGNvdWxkQmVPYmpl
Y3RPclN0cmluZyhMSW5zICppbnMpCiAgICAgfQogCiAgICAgcmV0dXJuIHJldDsKIH0KIAogc3Rh
dGljIGJvb2wKIGlzQ29uc3RQcml2YXRlUHRyKExJbnMgKmlucywgdW5zaWduZWQgc2xvdCkKIHsK
KyAgICAvLyBtYXRjaCBib3RoIGlubGluZSBhbmQgaW5kaXJlY3Qgc2xvdCBhY2Nlc3Nlcy4KKyAg
ICB1aW50MzIgaW5saW5lT2Zmc2V0ID0gSlNPYmplY3Q6OmdldEZpeGVkU2xvdE9mZnNldChzbG90
KSArIHNQYXlsb2FkT2Zmc2V0OworICAgIHVpbnQzMiBvb2xPZmZzZXQgPSAoc2xvdCAqIHNpemVv
ZihWYWx1ZSkpICsgc1BheWxvYWRPZmZzZXQ7CisKICNpZiBKU19CSVRTX1BFUl9XT1JEID09IDMy
CiAgICAgLy8gaW5zID0gbGRwLnNsb3RzL2MgLi4uWzxvZmZzZXQgb2Ygc2xvdD5dCi0gICAgcmV0
dXJuIG1hdGNoKGlucywgTElSX2xkcCwgQUNDU0VUX1NMT1RTLCBMT0FEX0NPTlNULCBzbG90ICog
c2l6ZW9mKFZhbHVlKSArIHNQYXlsb2FkT2Zmc2V0KTsKKyAgICByZXR1cm4gbWF0Y2goaW5zLCBM
SVJfbGRwLCBBQ0NTRVRfU0xPVFMsIExPQURfQ09OU1QsIGlubGluZU9mZnNldCkKKyAgICAgICAg
fHwgbWF0Y2goaW5zLCBMSVJfbGRwLCBBQ0NTRVRfU0xPVFMsIExPQURfQ09OU1QsIG9vbE9mZnNl
dCk7CiAjZWxpZiBKU19CSVRTX1BFUl9XT1JEID09IDY0CiAgICAgLy8gaW5zX29wcm5kMSA9IGxk
cC5zbG90cy9jIC4uLls8b2Zmc2V0IG9mIHNsb3Q+XQogICAgIC8vIGluc19vcHJuZDIgPSBpbW1p
IDEKICAgICAvLyBpbnMgPSBsc2hxIGluc19vcHJuZDEsIGluc19vcHJuZDIKICAgICByZXR1cm4g
aW5zLT5pc29wKExJUl9sc2hxKSAmJgotICAgICAgICAgICBtYXRjaChpbnMtPm9wcm5kMSgpLCBM
SVJfbGRwLCBBQ0NTRVRfU0xPVFMsIExPQURfQ09OU1QsIHNsb3QgKiBzaXplb2YoVmFsdWUpKSAm
JgorICAgICAgICAgICAobWF0Y2goaW5zLT5vcHJuZDEoKSwgTElSX2xkcCwgQUNDU0VUX1NMT1RT
LCBMT0FEX0NPTlNULCBpbmxpbmVPZmZzZXQpCisgICAgICAgICB8fCBtYXRjaChpbnMtPm9wcm5k
MSgpLCBMSVJfbGRwLCBBQ0NTRVRfU0xPVFMsIExPQURfQ09OU1QsIG9vbE9mZnNldCkpICYmCiAg
ICAgICAgICAgIGlucy0+b3BybmQyKCktPmlzSW1tSSgxKTsKICNlbmRpZgogfQogCiAvKgogICog
QW55IHRpbWUgeW91IHVzZSBhbiBBY2NTZXQgYW5ub3RhdGlvbiBvdGhlciB0aGFuIEFDQ1NFVF9B
TEwsIHlvdSBhcmUgbWFraW5nCiAgKiBhIHByb21pc2UgdG8gTmFub2ppdCBhYm91dCB0aGUgcHJv
cGVydGllcyBvZiB0aGUgYW5ub3RhdGVkIGxvYWQvc3RvcmUvY2FsbC4KICAqIElmIHRoYXQgYW5u
b3RhdGlvbiBpcyB3cm9uZywgaXQgY291bGQgY2F1c2UgcmFyZSBhbmQgc3VidGxlIGJ1Z3MuICBT
byB0aGlzCmRpZmYgLS1naXQgYS9qcy9zcmMvdHJhY2VqaXQvV3JpdGVyLmggYi9qcy9zcmMvdHJh
Y2VqaXQvV3JpdGVyLmgKLS0tIGEvanMvc3JjL3RyYWNlaml0L1dyaXRlci5oCisrKyBiL2pzL3Ny
Yy90cmFjZWppdC9Xcml0ZXIuaApAQCAtNTExLDIzICs1MTEsMjMgQEAgY2xhc3MgV3JpdGVyCiAK
ICAgICBuajo6TElucyAqc3R1aU9ialByaXZhdGUobmo6OkxJbnMgKm9iaiwgbmo6OkxJbnMgKnZh
bHVlKSBjb25zdCB7CiAgICAgICAgIHJldHVybiBuYW1lKGxpci0+aW5zU3RvcmUobmo6OkxJUl9z
dGksIHZhbHVlLCBvYmosIG9mZnNldG9mKEpTT2JqZWN0LCBwcml2YXRlRGF0YSksCiAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgQUNDU0VUX09CSl9QUklWQVRFKSwKICAgICAgICAg
ICAgICAgICAgICAgInByaXZhdGVfdWludDMyIik7CiAgICAgfQogCiAgICAgbmo6OkxJbnMgKmxk
aURlbnNlQXJyYXlDYXBhY2l0eShuajo6TElucyAqYXJyYXkpIGNvbnN0IHsKLSAgICAgICAgcmV0
dXJuIG5hbWUobGlyLT5pbnNMb2FkKG5qOjpMSVJfbGRpLCBhcnJheSwgb2Zmc2V0b2YoSlNPYmpl
Y3QsIGNhcGFjaXR5KSwKKyAgICAgICAgcmV0dXJuIG5hbWUobGlyLT5pbnNMb2FkKG5qOjpMSVJf
bGRpLCBhcnJheSwgSlNPYmplY3Q6Om9mZnNldE9mQ2FwYWNpdHkoKSwKICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgIEFDQ1NFVF9PQkpfQ0FQQUNJVFkpLAogICAgICAgICAgICAgICAg
ICAgICAiY2FwYWNpdHkiKTsKICAgICB9CiAKICAgICBuajo6TElucyAqbGRwT2JqU2xvdHMobmo6
OkxJbnMgKm9iaikgY29uc3QgewotICAgICAgICByZXR1cm4gbmFtZShsaXItPmluc0xvYWQobmo6
OkxJUl9sZHAsIG9iaiwgb2Zmc2V0b2YoSlNPYmplY3QsIHNsb3RzKSwgQUNDU0VUX09CSl9TTE9U
UyksCisgICAgICAgIHJldHVybiBuYW1lKGxpci0+aW5zTG9hZChuajo6TElSX2xkcCwgb2JqLCBK
U09iamVjdDo6b2Zmc2V0T2ZTbG90cygpLCBBQ0NTRVRfT0JKX1NMT1RTKSwKICAgICAgICAgICAg
ICAgICAgICAgInNsb3RzIik7CiAgICAgfQogCiAgICAgbmo6OkxJbnMgKmxkaUNvbnN0VHlwZWRB
cnJheUxlbmd0aChuajo6TElucyAqYXJyYXkpIGNvbnN0IHsKICAgICAgICAgcmV0dXJuIG5hbWUo
bGlyLT5pbnNMb2FkKG5qOjpMSVJfbGRpLCBhcnJheSwganM6OlR5cGVkQXJyYXk6Omxlbmd0aE9m
ZnNldCgpLCBBQ0NTRVRfVEFSUkFZLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
bmo6OkxPQURfQ09OU1QpLAogICAgICAgICAgICAgICAgICAgICAidHlwZWRBcnJheUxlbmd0aCIp
OwogICAgIH0KQEAgLTExNzIsMjggKzExNzIsMjUgQEAgY2xhc3MgV3JpdGVyCiAgICAgICAgIHJl
dHVybiBsaXItPmluczIob3AsIHgsIHkpOwogICAgIH0KIAogICAgIC8qIE9wZXJhdGlvbnMgaW52
b2x2aW5nIG5vbi10cml2aWFsIGNvbWJpbmF0aW9ucyBvZiBtdWx0aXBsZSBpbnN0cnVjdGlvbnMu
ICovCiAKICAgICAvKgogICAgICAqIE5iOiB0aGlzICJQcml2YXRpemVkIiByZWZlcnMgdG8gdGhl
IFByaXZhdGUgQVBJIGluIGpzdmFsdWUuaC4gIEl0CiAgICAgICogZG9lc24ndCByZWZlciB0byB0
aGUgSlNPYmo6OnByaXZhdGVEYXRhIHNsb3QhICBDb25mdXNpbmcuCisgICAgICogVGhpcyBzaG91
bGQgb25seSBiZSB1c2VkIGZvciBzbG90cyB3aGljaCBhcmUga25vd24gdG8gYWx3YXlzIGJlIGZp
eGVkLgogICAgICAqLwogICAgIG5qOjpMSW5zICpnZXRPYmpQcml2YXRpemVkU2xvdChuajo6TElu
cyAqb2JqLCB1aW50MzIgc2xvdCkgY29uc3QgeworICAgICAgICB1aW50MzIgb2Zmc2V0ID0gSlNP
YmplY3Q6OmdldEZpeGVkU2xvdE9mZnNldChzbG90KSArIHNQYXlsb2FkT2Zmc2V0OwogI2lmIEpT
X0JJVFNfUEVSX1dPUkQgPT0gMzIKLSAgICAgICAgbmo6OkxJbnMgKnZhZGRyX2lucyA9IGxkcE9i
alNsb3RzKG9iaik7Ci0gICAgICAgIHJldHVybiBsaXItPmluc0xvYWQobmo6OkxJUl9sZGksIHZh
ZGRyX2lucywKLSAgICAgICAgICAgICAgICAgICAgICAgICAgICBzbG90ICogc2l6ZW9mKFZhbHVl
KSArIHNQYXlsb2FkT2Zmc2V0LCBBQ0NTRVRfU0xPVFMsIG5qOjpMT0FEX0NPTlNUKTsKLQorICAg
ICAgICByZXR1cm4gbGlyLT5pbnNMb2FkKG5qOjpMSVJfbGRpLCBvYmosIG9mZnNldCwgQUNDU0VU
X1NMT1RTLCBuajo6TE9BRF9DT05TVCk7CiAjZWxpZiBKU19CSVRTX1BFUl9XT1JEID09IDY0CiAg
ICAgICAgIC8qIE4uQi4gT24gNjQtYml0LCBwcml2YXRpemVkIHZhbHVlIGFyZSBlbmNvZGVkIGRp
ZmZlcmVudGx5IGZyb20gb3RoZXIgcG9pbnRlcnMuICovCi0gICAgICAgIG5qOjpMSW5zICp2YWRk
cl9pbnMgPSBsZHBPYmpTbG90cyhvYmopOwotICAgICAgICBuajo6TElucyAqdl9pbnMgPSBsaXIt
Pmluc0xvYWQobmo6OkxJUl9sZHEsIHZhZGRyX2lucywKLSAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgIHNsb3QgKiBzaXplb2YoVmFsdWUpICsgc1BheWxvYWRPZmZzZXQsCisg
ICAgICAgIG5qOjpMSW5zICp2X2lucyA9IGxpci0+aW5zTG9hZChuajo6TElSX2xkcSwgb2JqLCBv
ZmZzZXQsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBBQ0NTRVRfU0xP
VFMsIG5qOjpMT0FEX0NPTlNUKTsKICAgICAgICAgcmV0dXJuIGxzaHFOKHZfaW5zLCAxKTsKICNl
bmRpZgogICAgIH0KIAogICAgIG5qOjpMSW5zICpnZXREc2xvdEFkZHJlc3Mobmo6OkxJbnMgKm9i
aiwgbmo6OkxJbnMgKmlkeCkgY29uc3QgewogICAgICAgICBKU19BU1NFUlQoc2l6ZW9mKFZhbHVl
KSA9PSA4KTsgLy8gVGhlIHwzfCBpbiB0aGUgZm9sbG93aW5nIHN0YXRlbWVudCByZXF1aXJlcyB0
aGlzLgogICAgICAgICBuajo6TElucyAqb2Zmc2V0ID0gbHNocE4odWkycChpZHgpLCAzKTsKQEAg
LTEyMDksMjAgKzEyMDYsMTggQEAgY2xhc3MgV3JpdGVyCiAgICAgbmo6OkxJbnMgKmdldFN0cmlu
Z0NoYXIobmo6OkxJbnMgKnN0ciwgbmo6OkxJbnMgKmlkeCkgY29uc3QgewogICAgICAgICBuajo6
TElucyAqY2hhcnMgPSBsZHBTdHJpbmdDaGFycyhzdHIpOwogICAgICAgICByZXR1cm4gbmFtZShs
aXItPmluc0xvYWQobmo6OkxJUl9sZHVzMnVpLCBhZGRwKGNoYXJzLCBsc2hwTihpZHgsIDEpKSwg
MCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIEFDQ1NFVF9TVFJJTkdfTUNIQVJT
LCBuajo6TE9BRF9DT05TVCksCiAgICAgICAgICAgICAgICAgICAgICJzdHJDaGFyIik7CiAgICAg
fQogCiAgICAgbmo6OkxJbnMgKmdldEFyZ3NMZW5ndGgobmo6OkxJbnMgKmFyZ3MpIGNvbnN0IHsK
LSAgICAgICAgdWludDMyIHNsb3QgPSBKU09iamVjdDo6SlNTTE9UX0FSR1NfTEVOR1RIOwotICAg
ICAgICBuajo6TElucyAqdmFkZHJfaW5zID0gbGRwT2JqU2xvdHMoYXJncyk7Ci0gICAgICAgIHJl
dHVybiBuYW1lKGxpci0+aW5zTG9hZChuajo6TElSX2xkaSwgdmFkZHJfaW5zLCBzbG90ICogc2l6
ZW9mKFZhbHVlKSArIHNQYXlsb2FkT2Zmc2V0LAotICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgQUNDU0VUX1NMT1RTKSwKKyAgICAgICAgdWludDMyIG9mZnNldCA9IEpTT2JqZWN0Ojpn
ZXRBcmd1bWVudHNMZW5ndGhPZmZzZXQoKSArIHNQYXlsb2FkT2Zmc2V0OworICAgICAgICByZXR1
cm4gbmFtZShsaXItPmluc0xvYWQobmo6OkxJUl9sZGksIGFyZ3MsIG9mZnNldCwgQUNDU0VUX1NM
T1RTKSwKICAgICAgICAgICAgICAgICAgICAgImFyZ3NMZW5ndGgiKTsKICAgICB9CiB9OwogCiB9
ICAgLyogbmFtZXNwYWNlIHRqaXQgKi8KIH0gICAvKiBuYW1lc3BhY2UganMgKi8KIAogI2VuZGlm
IC8qIHRyYWNlaml0X1dyaXRlcl9oX19fICovCg==
</data>
<flag name="review"
          id="438383"
          type_id="4"
          status="?"
          setter="bhackett1024"
          requestee="jorendorff"
    />
          </attachment>
          <attachment
              isobsolete="0"
              ispatch="1"
              isprivate="0"
              isurl="0"
          >
            <attachid>524773</attachid>
            <date>2011-04-08 15:43:00 -0700</date>
            <delta_ts>2011-04-08 15:43:52 -0700</delta_ts>
            <desc>before/after benchmark comparison</desc>
            <filename>compare.txt</filename>
            <type>text/plain</type>
            <size>6667</size>
            <attacher>bhackett1024</attacher>
            
              <data encoding="base64">CnN1bnNwaWRlLTAuOS4xCgpPTEQKCj09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09
PT09PT09PT09ClJFU1VMVFMgKG1lYW5zIGFuZCA5NSUgY29uZmlkZW5jZSBpbnRlcnZhbHMpCi0t
LS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tClRvdGFsOiAgICAgICAg
ICAgICAgICAgMjU0LjJtcyArLy0gMC4yJQotLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0t
LS0tLS0tLS0tLS0tLQoKICAzZDogICAgICAgICAgICAgICAgICAgMzkuN21zICsvLSAwLjUlCiAg
ICBjdWJlOiAgICAgICAgICAgICAgIDE1LjJtcyArLy0gMC43JQogICAgbW9ycGg6ICAgICAgICAg
ICAgICAgOC42bXMgKy8tIDEuMiUKICAgIHJheXRyYWNlOiAgICAgICAgICAgMTYuMG1zICsvLSAw
LjYlCgogIGFjY2VzczogICAgICAgICAgICAgICAzNS45bXMgKy8tIDAuNCUKICAgIGJpbmFyeS10
cmVlczogICAgICAgIDYuNm1zICsvLSAxLjUlCiAgICBmYW5ua3VjaDogICAgICAgICAgIDE1Ljht
cyArLy0gMC41JQogICAgbmJvZHk6ICAgICAgICAgICAgICAgNi41bXMgKy8tIDEuNSUKICAgIG5z
aWV2ZTogICAgICAgICAgICAgIDcuMG1zICsvLSAwLjMlCgogIGJpdG9wczogICAgICAgICAgICAg
ICAxNy45bXMgKy8tIDEuNiUKICAgIDNiaXQtYml0cy1pbi1ieXRlOiAgIDAuN21zICsvLSAxMi4x
JQogICAgYml0cy1pbi1ieXRlOiAgICAgICAgNy41bXMgKy8tIDEuMyUKICAgIGJpdHdpc2UtYW5k
OiAgICAgICAgIDEuOW1zICsvLSAzLjclCiAgICBuc2lldmUtYml0czogICAgICAgICA3LjhtcyAr
Ly0gMS4wJQoKICBjb250cm9sZmxvdzogICAgICAgICAgIDIuNm1zICsvLSAzLjYlCiAgICByZWN1
cnNpdmU6ICAgICAgICAgICAyLjZtcyArLy0gMy42JQoKICBjcnlwdG86ICAgICAgICAgICAgICAg
MTguOG1zICsvLSAwLjYlCiAgICBhZXM6ICAgICAgICAgICAgICAgIDEwLjFtcyArLy0gMC41JQog
ICAgbWQ1OiAgICAgICAgICAgICAgICAgNS4xbXMgKy8tIDEuMyUKICAgIHNoYTE6ICAgICAgICAg
ICAgICAgIDMuNm1zICsvLSAyLjclCgogIGRhdGU6ICAgICAgICAgICAgICAgICAzMS4ybXMgKy8t
IDAuNCUKICAgIGZvcm1hdC10b2Z0ZTogICAgICAgMTkuM21zICsvLSAwLjUlCiAgICBmb3JtYXQt
eHBhcmI6ICAgICAgIDExLjhtcyArLy0gMC42JQoKICBtYXRoOiAgICAgICAgICAgICAgICAgMjIu
NW1zICsvLSAwLjYlCiAgICBjb3JkaWM6ICAgICAgICAgICAgICA2LjRtcyArLy0gMS41JQogICAg
cGFydGlhbC1zdW1zOiAgICAgICAxMS4wbXMgKy8tIDAuMiUKICAgIHNwZWN0cmFsLW5vcm06ICAg
ICAgIDUuMW1zICsvLSAxLjElCgogIHJlZ2V4cDogICAgICAgICAgICAgICAxNS44bXMgKy8tIDAu
NSUKICAgIGRuYTogICAgICAgICAgICAgICAgMTUuOG1zICsvLSAwLjUlCgogIHN0cmluZzogICAg
ICAgICAgICAgICA2OS43bXMgKy8tIDAuMyUKICAgIGJhc2U2NDogICAgICAgICAgICAgIDQuNm1z
ICsvLSAyLjIlCiAgICBmYXN0YTogICAgICAgICAgICAgIDExLjdtcyArLy0gMC44JQogICAgdGFn
Y2xvdWQ6ICAgICAgICAgICAyMS43bXMgKy8tIDAuNCUKICAgIHVucGFjay1jb2RlOiAgICAgICAg
MjMuNm1zICsvLSAwLjQlCiAgICB2YWxpZGF0ZS1pbnB1dDogICAgICA4LjFtcyArLy0gMC44JQoK
TkVXCgo9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PQpSRVNVTFRT
IChtZWFucyBhbmQgOTUlIGNvbmZpZGVuY2UgaW50ZXJ2YWxzKQotLS0tLS0tLS0tLS0tLS0tLS0t
LS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQpUb3RhbDogICAgICAgICAgICAgICAgIDI1NC44bXMg
Ky8tIDAuMyUKLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KCiAg
M2Q6ICAgICAgICAgICAgICAgICAgIDM5LjZtcyArLy0gMC44JQogICAgY3ViZTogICAgICAgICAg
ICAgICAxNS4ybXMgKy8tIDEuNiUKICAgIG1vcnBoOiAgICAgICAgICAgICAgIDguNW1zICsvLSAx
LjQlCiAgICByYXl0cmFjZTogICAgICAgICAgIDE1LjhtcyArLy0gMC43JQoKICBhY2Nlc3M6ICAg
ICAgICAgICAgICAgMzcuNG1zICsvLSAwLjYlCiAgICBiaW5hcnktdHJlZXM6ICAgICAgICA2LjVt
cyArLy0gMS42JQogICAgZmFubmt1Y2g6ICAgICAgICAgICAxNy41bXMgKy8tIDAuNiUKICAgIG5i
b2R5OiAgICAgICAgICAgICAgIDYuNW1zICsvLSAxLjYlCiAgICBuc2lldmU6ICAgICAgICAgICAg
ICA2LjltcyArLy0gMS4zJQoKICBiaXRvcHM6ICAgICAgICAgICAgICAgMTUuNm1zICsvLSAyLjAl
CiAgICAzYml0LWJpdHMtaW4tYnl0ZTogICAwLjdtcyArLy0gMTMuMCUKICAgIGJpdHMtaW4tYnl0
ZTogICAgICAgIDcuNW1zICsvLSAxLjUlCiAgICBiaXR3aXNlLWFuZDogICAgICAgICAxLjhtcyAr
Ly0gNC42JQogICAgbnNpZXZlLWJpdHM6ICAgICAgICAgNS43bXMgKy8tIDEuOCUKCiAgY29udHJv
bGZsb3c6ICAgICAgICAgICAyLjVtcyArLy0gMy45JQogICAgcmVjdXJzaXZlOiAgICAgICAgICAg
Mi41bXMgKy8tIDMuOSUKCiAgY3J5cHRvOiAgICAgICAgICAgICAgIDE4LjltcyArLy0gMC43JQog
ICAgYWVzOiAgICAgICAgICAgICAgICAxMC4xbXMgKy8tIDAuNiUKICAgIG1kNTogICAgICAgICAg
ICAgICAgIDUuMW1zICsvLSAxLjAlCiAgICBzaGExOiAgICAgICAgICAgICAgICAzLjhtcyArLy0g
Mi4yJQoKICBkYXRlOiAgICAgICAgICAgICAgICAgMzEuN21zICsvLSAwLjUlCiAgICBmb3JtYXQt
dG9mdGU6ICAgICAgIDIwLjVtcyArLy0gMC42JQogICAgZm9ybWF0LXhwYXJiOiAgICAgICAxMS4x
bXMgKy8tIDAuNiUKCiAgbWF0aDogICAgICAgICAgICAgICAgIDIzLjFtcyArLy0gMC44JQogICAg
Y29yZGljOiAgICAgICAgICAgICAgNi41bXMgKy8tIDEuNSUKICAgIHBhcnRpYWwtc3VtczogICAg
ICAgMTEuMG1zICsvLSAwLjQlCiAgICBzcGVjdHJhbC1ub3JtOiAgICAgICA1LjZtcyArLy0gMS44
JQoKICByZWdleHA6ICAgICAgICAgICAgICAgMTUuOG1zICsvLSAwLjUlCiAgICBkbmE6ICAgICAg
ICAgICAgICAgIDE1LjhtcyArLy0gMC41JQoKICBzdHJpbmc6ICAgICAgICAgICAgICAgNzAuMm1z
ICsvLSAwLjQlCiAgICBiYXNlNjQ6ICAgICAgICAgICAgICA0LjVtcyArLy0gMi4yJQogICAgZmFz
dGE6ICAgICAgICAgICAgICAxMS44bXMgKy8tIDAuNyUKICAgIHRhZ2Nsb3VkOiAgICAgICAgICAg
MjEuNG1zICsvLSAwLjUlCiAgICB1bnBhY2stY29kZTogICAgICAgIDI0LjNtcyArLy0gMC40JQog
ICAgdmFsaWRhdGUtaW5wdXQ6ICAgICAgOC4ybXMgKy8tIDEuMCUKCnY4LXY0CgpPTEQKCj09PT09
PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09ClJFU1VMVFMgKG1lYW5zIGFu
ZCA5NSUgY29uZmlkZW5jZSBpbnRlcnZhbHMpCi0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0t
LS0tLS0tLS0tLS0tLS0tClRvdGFsOiAgICAgICAgICAgICAxNDMzLjdtcyArLy0gMC41JQotLS0t
LS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQoKICB2ODogICAgICAgICAg
ICAgIDE0MzMuN21zICsvLSAwLjUlCiAgICBjcnlwdG86ICAgICAgICAgMjM1LjRtcyArLy0gMC45
JQogICAgZGVsdGFibHVlOiAgICAgIDI3My4xbXMgKy8tIDEuOSUKICAgIGVhcmxleS1ib3llcjog
ICAyNDkuMW1zICsvLSAyLjIlCiAgICByYXl0cmFjZTogICAgICAgMTI3LjdtcyArLy0gMC4zJQog
ICAgcmVnZXhwOiAgICAgICAgIDIyMi44bXMgKy8tIDAuNiUKICAgIHJpY2hhcmRzOiAgICAgICAy
MDMuMG1zICsvLSAwLjklCiAgICBzcGxheTogICAgICAgICAgMTIyLjZtcyArLy0gMC40JQoKTkVX
Cgo9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PQpSRVNVTFRTICht
ZWFucyBhbmQgOTUlIGNvbmZpZGVuY2UgaW50ZXJ2YWxzKQotLS0tLS0tLS0tLS0tLS0tLS0tLS0t
LS0tLS0tLS0tLS0tLS0tLS0tLS0tLQpUb3RhbDogICAgICAgICAgICAgMTQxMi44bXMgKy8tIDEu
MSUKLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KCiAgdjg6ICAg
ICAgICAgICAgICAxNDEyLjhtcyArLy0gMS4xJQogICAgY3J5cHRvOiAgICAgICAgIDIzMy45bXMg
Ky8tIDEuMiUKICAgIGRlbHRhYmx1ZTogICAgICAyNTYuMW1zICsvLSAwLjIlCiAgICBlYXJsZXkt
Ym95ZXI6ICAgMjQ1LjBtcyArLy0gMC4yJQogICAgcmF5dHJhY2U6ICAgICAgIDEzMS45bXMgKy8t
IDcuMCUKICAgIHJlZ2V4cDogICAgICAgICAyMjUuMG1zICsvLSAwLjIlCiAgICByaWNoYXJkczog
ICAgICAgMjAwLjJtcyArLy0gMi40JQogICAgc3BsYXk6ICAgICAgICAgIDEyMC43bXMgKy8tIDAu
NCUKCmtyYWtlbi0xLjEKCk9MRAoKPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09
PT09PT09PT09PT0KUkVTVUxUUyAobWVhbnMgYW5kIDk1JSBjb25maWRlbmNlIGludGVydmFscykK
LS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KVG90YWw6ICAg
ICAgICAgICAgICAgICAgICAgICAgNTM1OS42bXMgKy8tIDAuOSUKLS0tLS0tLS0tLS0tLS0tLS0t
LS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KCiAgYWk6ICAgICAgICAgICAgICAgICAgICAg
ICAgICA4ODMuMG1zICsvLSA0LjElCiAgICBhc3RhcjogICAgICAgICAgICAgICAgICAgICA4ODMu
MG1zICsvLSA0LjElCgogIGF1ZGlvOiAgICAgICAgICAgICAgICAgICAgICAxNjEwLjZtcyArLy0g
MS41JQogICAgYmVhdC1kZXRlY3Rpb246ICAgICAgICAgICAgNDQ1LjZtcyArLy0gNS4wJQogICAg
ZGZ0OiAgICAgICAgICAgICAgICAgICAgICAgNDEyLjhtcyArLy0gMC43JQogICAgZmZ0OiAgICAg
ICAgICAgICAgICAgICAgICAgMzAzLjJtcyArLy0gMS4xJQogICAgb3NjaWxsYXRvcjogICAgICAg
ICAgICAgICAgNDQ5LjBtcyArLy0gMC44JQoKICBpbWFnaW5nOiAgICAgICAgICAgICAgICAgICAg
MTc4MC4wbXMgKy8tIDAuNSUKICAgIGdhdXNzaWFuLWJsdXI6ICAgICAgICAgICAgIDc1Mi44bXMg
Ky8tIDEuMCUKICAgIGRhcmtyb29tOiAgICAgICAgICAgICAgICAgIDM1Mi4wbXMgKy8tIDAuNCUK
ICAgIGRlc2F0dXJhdGU6ICAgICAgICAgICAgICAgIDY3NS4ybXMgKy8tIDAuMiUKCiAganNvbjog
ICAgICAgICAgICAgICAgICAgICAgICAyMDUuNm1zICsvLSAwLjglCiAgICBwYXJzZS1maW5hbmNp
YWw6ICAgICAgICAgICAxMTQuNm1zICsvLSAxLjUlCiAgICBzdHJpbmdpZnktdGluZGVyYm94OiAg
ICAgICAgOTEuMG1zICsvLSAwLjAlCgogIHN0YW5mb3JkOiAgICAgICAgICAgICAgICAgICAgODgw
LjRtcyArLy0gMC4xJQogICAgY3J5cHRvLWFlczogICAgICAgICAgICAgICAgMjU4LjRtcyArLy0g
MC4zJQogICAgY3J5cHRvLWNjbTogICAgICAgICAgICAgICAgMTU4LjhtcyArLy0gMC40JQogICAg
Y3J5cHRvLXBia2RmMjogICAgICAgICAgICAgMzMxLjRtcyArLy0gMC4yJQogICAgY3J5cHRvLXNo
YTI1Ni1pdGVyYXRpdmU6ICAgMTMxLjhtcyArLy0gMC40JQoKTkVXCgo9PT09PT09PT09PT09PT09
PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PQpSRVNVTFRTIChtZWFucyBhbmQgOTUlIGNv
bmZpZGVuY2UgaW50ZXJ2YWxzKQotLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0t
LS0tLS0tLS0tLQpUb3RhbDogICAgICAgICAgICAgICAgICAgICAgICA1MTk4LjRtcyArLy0gMC40
JQotLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQoKICBhaTog
ICAgICAgICAgICAgICAgICAgICAgICAgIDY0My4ybXMgKy8tIDIuNyUKICAgIGFzdGFyOiAgICAg
ICAgICAgICAgICAgICAgIDY0My4ybXMgKy8tIDIuNyUKCiAgYXVkaW86ICAgICAgICAgICAgICAg
ICAgICAgIDE2MzMuMm1zICsvLSAxLjUlCiAgICBiZWF0LWRldGVjdGlvbjogICAgICAgICAgICA0
NjguNG1zICsvLSA1LjQlCiAgICBkZnQ6ICAgICAgICAgICAgICAgICAgICAgICA0MDcuNG1zICsv
LSAwLjglCiAgICBmZnQ6ICAgICAgICAgICAgICAgICAgICAgICAzMDguMG1zICsvLSAzLjElCiAg
ICBvc2NpbGxhdG9yOiAgICAgICAgICAgICAgICA0NDkuNG1zICsvLSAwLjIlCgogIGltYWdpbmc6
ICAgICAgICAgICAgICAgICAgICAxODM2LjJtcyArLy0gMC42JQogICAgZ2F1c3NpYW4tYmx1cjog
ICAgICAgICAgICAgNzU4LjRtcyArLy0gMC44JQogICAgZGFya3Jvb206ICAgICAgICAgICAgICAg
ICAgMzU0LjhtcyArLy0gMS40JQogICAgZGVzYXR1cmF0ZTogICAgICAgICAgICAgICAgNzIzLjBt
cyArLy0gMS4yJQoKICBqc29uOiAgICAgICAgICAgICAgICAgICAgICAgIDIwNS4wbXMgKy8tIDAu
NCUKICAgIHBhcnNlLWZpbmFuY2lhbDogICAgICAgICAgIDExNC40bXMgKy8tIDAuNiUKICAgIHN0
cmluZ2lmeS10aW5kZXJib3g6ICAgICAgICA5MC42bXMgKy8tIDAuOCUKCiAgc3RhbmZvcmQ6ICAg
ICAgICAgICAgICAgICAgICA4ODAuOG1zICsvLSAxLjQlCiAgICBjcnlwdG8tYWVzOiAgICAgICAg
ICAgICAgICAyNjIuOG1zICsvLSAwLjYlCiAgICBjcnlwdG8tY2NtOiAgICAgICAgICAgICAgICAx
NjAuMm1zICsvLSAxLjMlCiAgICBjcnlwdG8tcGJrZGYyOiAgICAgICAgICAgICAzMjguMm1zICsv
LSA0LjIlCiAgICBjcnlwdG8tc2hhMjU2LWl0ZXJhdGl2ZTogICAxMjkuNm1zICsvLSAyLjklCg==
</data>

          </attachment>
      

    </bug>

</bugzilla>