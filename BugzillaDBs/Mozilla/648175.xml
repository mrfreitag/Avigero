<?xml version="1.0" encoding="UTF-8" standalone="yes" ?>
<!DOCTYPE bugzilla SYSTEM "https://bugzilla.mozilla.org/bugzilla.dtd">

<bugzilla version="3.6.4+"
          urlbase="https://bugzilla.mozilla.org/"
          
          maintainer="bugzilla-admin@mozilla.org"
>

    <bug>
          <bug_id>648175</bug_id>
          
          <creation_ts>2011-04-06 17:32:00 -0700</creation_ts>
          <short_desc>Get rid of JSOP_FOR* opcodes</short_desc>
          <delta_ts>2011-04-10 15:57:27 -0700</delta_ts>
          <reporter_accessible>1</reporter_accessible>
          <cclist_accessible>1</cclist_accessible>
          <classification_id>3</classification_id>
          <classification>Components</classification>
          <product>Core</product>
          <component>JavaScript Engine</component>
          <version>Other Branch</version>
          <rep_platform>All</rep_platform>
          <op_sys>All</op_sys>
          <bug_status>NEW</bug_status>
          
          
          
          
          
          
          <priority>--</priority>
          <bug_severity>normal</bug_severity>
          <target_milestone>---</target_milestone>
          
          <blocked>647620</blocked>
          <votes>1</votes>
          <everconfirmed>1</everconfirmed>
          <reporter name="Jason Orendorff">jorendorff</reporter>
          <assigned_to name="Jason Orendorff">jorendorff</assigned_to>
          <cc>bhackett1024</cc>
    
    <cc>dmandelin</cc>
    
    <cc>dvander</cc>
    
    <cc>matjk7</cc>
    
    <cc>ryanvm</cc>
          <qa_contact>general</qa_contact>
          <cf_blocking_fennec>---</cf_blocking_fennec>
          <cf_blocking_fx>---</cf_blocking_fx>
          <cf_blocking_20>---</cf_blocking_20>
          <cf_status_20>---</cf_status_20>
          <cf_blocking_192>---</cf_blocking_192>
          <cf_status_192>---</cf_status_192>
          <cf_blocking_191>---</cf_blocking_191>
          <cf_status_191>---</cf_status_191>
          
          
          
          
          
          
          
          
          
          

      

      

      

          <long_desc isprivate="0">
            <commentid>5393687</commentid>
            <who name="Jason Orendorff">jorendorff</who>
            <bug_when>2011-04-06 17:32:47 -0700</bug_when>
            <thetext>Currently we compile this

    for (TARGET in OBJ)
       STMT

to something like:

    for (let __iter = JSOP_ITER(OBJ); JSOP_MOREITER(__iter);) {
        JSOP_FORNAME(&amp;TARGET, __iter);
        STMT
    }

where JSOP_FORNAME could end up being optimized to some other opcode, or deoptimized to JSOP_NEXTELEM in certain cases (such as a destructuring TARGET).

We should just always use JSOP_NEXTELEM, and rename it to JSOP_NEXT:

    for (let __iter = JSOP_ITER(OBJ); JSOP_MOREITER(__iter);) {
        TARGET = JSOP_NEXT(__iter);
        STMT
    }

Jaeger already treats the FOR* opcodes this way, and it&apos;ll be simpler to analyze.</thetext>
          </long_desc>
          <long_desc isprivate="0">
            <commentid>5393719</commentid>
              <attachid>524321</attachid>
            <who name="Jason Orendorff">jorendorff</who>
            <bug_when>2011-04-06 17:41:43 -0700</bug_when>
            <thetext>Created attachment 524321
WIP 1 - not working

Remaining to be done:

  - I need to flip the TARGET opcodes from GET to SET on some parse nodes
    before emitting the assignment. (Gross, but it would work, I think.)

  - Decompiler.

This goes on top of bug 646807 and bug 646820 ...which I really should land sometime.

Sorry if this patch is disgusting; I know a bit more about the emitter now than I did when I started on this.</thetext>
          </long_desc>
          <long_desc isprivate="0">
            <commentid>5398328</commentid>
            <who name="Jason Orendorff">jorendorff</who>
            <bug_when>2011-04-09 07:17:37 -0700</bug_when>
            <thetext>Taking. That patch has too much flailing around in it. There&apos;s no way that was going to succeed all the way through to the decompiler. Writing a new one.</thetext>
          </long_desc>
          <long_desc isprivate="0">
            <commentid>5398829</commentid>
              <attachid>524903</attachid>
            <who name="Jason Orendorff">jorendorff</who>
            <bug_when>2011-04-09 18:44:44 -0700</bug_when>
            <thetext>Created attachment 524903
WIP 2 - decompiler not working

This is much better. I have not touched the decompiler, so that will be super crashy -- but a wide variety of for-in loops at least get through the parser and interpreter.</thetext>
          </long_desc>
          <long_desc isprivate="0">
            <commentid>5399318</commentid>
              <attachid>524962</attachid>
            <who name="Jason Orendorff">jorendorff</who>
            <bug_when>2011-04-10 09:50:43 -0700</bug_when>
            <thetext>Created attachment 524962
WIP 3 - not quite working in decompiler

This fixes several runtime bugs in WIP 2 and gets some decompiler basics working. I&apos;m still seeing some assertions under DecompileValueGenerator.</thetext>
          </long_desc>
          <long_desc isprivate="0">
            <commentid>5399612</commentid>
              <attachid>524999</attachid>
            <who name="Jason Orendorff">jorendorff</who>
            <bug_when>2011-04-10 15:57:27 -0700</bug_when>
            <thetext>Created attachment 524999
WIP 4 - failing 6 tests

Now with enhanced not-crashing.

The patch is around -250 lines net.</thetext>
          </long_desc>
      
          <attachment
              isobsolete="1"
              ispatch="1"
              isprivate="0"
              isurl="0"
          >
            <attachid>524321</attachid>
            <date>2011-04-06 17:41:00 -0700</date>
            <delta_ts>2011-04-09 18:44:44 -0700</delta_ts>
            <desc>WIP 1 - not working</desc>
            <filename>bug-648175-rm-jsop-for-v1.patch</filename>
            <type>text/plain</type>
            <size>107146</size>
            <attacher>jorendorff</attacher>
            
              <data encoding="base64">ZGlmZiAtLWdpdCBhL2pzL3NyYy9qc2FuYWx5emUuY3BwIGIvanMvc3JjL2pzYW5hbHl6ZS5jcHAK
LS0tIGEvanMvc3JjL2pzYW5hbHl6ZS5jcHAKKysrIGIvanMvc3JjL2pzYW5hbHl6ZS5jcHAKQEAg
LTQ1MiwxNyArNDUyLDE2IEBAIFNjcmlwdDo6YW5hbHl6ZShKU0NvbnRleHQgKmN4LCBKU1Njcmlw
dCAKICAgICAgICAgICBjYXNlIEpTT1BfQ0FMTE5BTUU6CiAgICAgICAgICAgY2FzZSBKU09QX0JJ
TkROQU1FOgogICAgICAgICAgIGNhc2UgSlNPUF9TRVROQU1FOgogICAgICAgICAgIGNhc2UgSlNP
UF9ERUxOQU1FOgogICAgICAgICAgIGNhc2UgSlNPUF9JTkNOQU1FOgogICAgICAgICAgIGNhc2Ug
SlNPUF9ERUNOQU1FOgogICAgICAgICAgIGNhc2UgSlNPUF9OQU1FSU5DOgogICAgICAgICAgIGNh
c2UgSlNPUF9OQU1FREVDOgotICAgICAgICAgIGNhc2UgSlNPUF9GT1JOQU1FOgogICAgICAgICAg
ICAgdXNlc1Njb3BlID0gdHJ1ZTsKICAgICAgICAgICAgIGJyZWFrOwogCiAgICAgICAgICAgLyog
V2F0Y2ggZm9yIG9wY29kZXMgdGhlIG1ldGhvZCBKSVQgZG9lc24ndCBjb21waWxlLiAqLwogICAg
ICAgICAgIGNhc2UgSlNPUF9HT1NVQjoKICAgICAgICAgICBjYXNlIEpTT1BfR09TVUJYOgogICAg
ICAgICAgIGNhc2UgSlNPUF9JRlBSSU1UT1A6CiAgICAgICAgICAgY2FzZSBKU09QX0ZJTFRFUjoK
QEAgLTU3NCwxOCArNTczLDE3IEBAIFNjcmlwdDo6YW5hbHl6ZShKU0NvbnRleHQgKmN4LCBKU1Nj
cmlwdCAKICAgICAgICAgICBjYXNlIEpTT1BfTE9DQUxJTkM6CiAgICAgICAgICAgY2FzZSBKU09Q
X0xPQ0FMREVDOiB7CiAgICAgICAgICAgICB1aW50MzIgbG9jYWwgPSBHRVRfU0xPVE5PKHBjKTsK
ICAgICAgICAgICAgIGlmIChsb2NhbCA8IG5maXhlZCAmJiAhbG9jYWxEZWZpbmVkKGxvY2FsLCBv
ZmZzZXQpKQogICAgICAgICAgICAgICAgIHNldExvY2FsKGxvY2FsLCBMT0NBTF9VU0VfQkVGT1JF
X0RFRik7CiAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICB9CiAKLSAgICAgICAgICBjYXNl
IEpTT1BfU0VUTE9DQUw6Ci0gICAgICAgICAgY2FzZSBKU09QX0ZPUkxPQ0FMOiB7CisgICAgICAg
ICAgY2FzZSBKU09QX1NFVExPQ0FMOiB7CiAgICAgICAgICAgICB1aW50MzIgbG9jYWwgPSBHRVRf
U0xPVE5PKHBjKTsKIAogICAgICAgICAgICAgLyoKICAgICAgICAgICAgICAqIFRoZSBsb2NhbCB2
YXJpYWJsZSBtYXkgYWxyZWFkeSBoYXZlIGJlZW4gbWFya2VkIGFzIHVuY29uZGl0aW9uYWxseQog
ICAgICAgICAgICAgICogZGVmaW5lZCBhdCBhIGxhdGVyIHBvaW50IGluIHRoZSBzY3JpcHQsIGlm
IHRoYXQgZGVmaW5pdGlvbiB3YXMgaW4gdGhlCiAgICAgICAgICAgICAgKiBjb25kaXRpb24gZm9y
IGEgbG9vcCB3aGljaCB0aGVuIGp1bXBlZCBiYWNrIGhlcmUuICBJbiBzdWNoIGNhc2VzIHdlCiAg
ICAgICAgICAgICAgKiB3aWxsIG5vdCB0cmVhdCB0aGUgdmFyaWFibGUgYXMgZXZlciBiZWluZyBk
ZWZpbmVkIGluIHRoZSBsb29wIGJvZHkKICAgICAgICAgICAgICAqIChzZWUgc2V0TG9jYWwpLgpk
aWZmIC0tZ2l0IGEvanMvc3JjL2pzY250eHQuaCBiL2pzL3NyYy9qc2NudHh0LmgKLS0tIGEvanMv
c3JjL2pzY250eHQuaAorKysgYi9qcy9zcmMvanNjbnR4dC5oCkBAIC0xOTM5LDE3ICsxOTM5LDE3
IEBAIHN0cnVjdCBKU0NvbnRleHQKICAgICBKU1NlY3VyaXR5Q2FsbGJhY2tzICpzZWN1cml0eUNh
bGxiYWNrczsKIAogICAgIC8qIFN0b3JlZCBoZXJlIHRvIGF2b2lkIHBhc3NpbmcgaXQgYXJvdW5k
IGFzIGEgcGFyYW1ldGVyLiAqLwogICAgIHVpbnROICAgICAgICAgICAgICAgcmVzb2x2ZUZsYWdz
OwogCiAgICAgLyogUmFuZG9tIG51bWJlciBnZW5lcmF0b3Igc3RhdGUsIHVzZWQgYnkganNtYXRo
LmNwcC4gKi8KICAgICBpbnQ2NCAgICAgICAgICAgICAgIHJuZ1NlZWQ7CiAKLSAgICAvKiBMb2Nh
dGlvbiB0byBzdGFzaCB0aGUgaXRlcmF0aW9uIHZhbHVlIGJldHdlZW4gSlNPUF9NT1JFSVRFUiBh
bmQgSlNPUF9GT1IqLiAqLworICAgIC8qIExvY2F0aW9uIHRvIHN0YXNoIHRoZSBpdGVyYXRpb24g
dmFsdWUgYmV0d2VlbiBKU09QX0hBU05FWFQgYW5kIEpTT1BfTkVYVC4gKi8KICAgICBqczo6VmFs
dWUgICAgICAgICAgIGl0ZXJWYWx1ZTsKIAogI2lmZGVmIEpTX1RSQUNFUgogICAgIC8qCiAgICAg
ICogVHJ1ZSBpZiB0cmFjZXMgbWF5IGJlIGV4ZWN1dGVkLiBJbnZhcmlhbnQ6IFRoZSB2YWx1ZSBv
ZiB0cmFjZUppdGVuYWJsZWQKICAgICAgKiBpcyBhbHdheXMgZXF1YWwgdG8gdGhlIGV4cHJlc3Np
b24gaW4gdXBkYXRlSklURW5hYmxlZCBiZWxvdy4KICAgICAgKgogICAgICAqIFRoaXMgZmxhZyBh
bmQgdGhlIGZpZWxkcyBhY2Nlc3NlZCBieSB1cGRhdGVKSVRFbmFibGVkIGFyZSB3cml0dGVuIG9u
bHkKZGlmZiAtLWdpdCBhL2pzL3NyYy9qc2VtaXQuY3BwIGIvanMvc3JjL2pzZW1pdC5jcHAKLS0t
IGEvanMvc3JjL2pzZW1pdC5jcHAKKysrIGIvanMvc3JjL2pzZW1pdC5jcHAKQEAgLTE5NjksMTcg
KzE5NjksMTcgQEAgRW1pdEVudGVyQmxvY2soSlNDb250ZXh0ICpjeCwgSlNQYXJzZU5vZAogfQog
CiBzdGF0aWMgSlNCb29sCiBFbWl0TGVhdmVCbG9jayhKU0NvbnRleHQgKmN4LCBKU0NvZGVHZW5l
cmF0b3IgKmNnLCBKU09wIG9wLAogICAgICAgICAgICAgICAgSlNPYmplY3RCb3ggKmJveCkKIHsK
ICAgICBKU09wIGJpZ1N1ZmZpeDsKICAgICB1aW50TiBjb3VudCA9IE9CSl9CTE9DS19DT1VOVChj
eCwgYm94LT5vYmplY3QpOwotICAgIAorCiAgICAgYmlnU3VmZml4ID0gRW1pdEJpZ0luZGV4UHJl
Zml4KGN4LCBjZywgYm94LT5pbmRleCk7CiAgICAgaWYgKGJpZ1N1ZmZpeCA9PSBKU09QX0ZBTFNF
KQogICAgICAgICByZXR1cm4gSlNfRkFMU0U7CiAgICAgaWYgKGpzX0VtaXQ1KGN4LCBjZywgb3As
IGNvdW50LCBib3gtPmluZGV4KSA8IDApCiAgICAgICAgIHJldHVybiBKU19GQUxTRTsKICAgICBy
ZXR1cm4gYmlnU3VmZml4ID09IEpTT1BfTk9QIHx8IGpzX0VtaXQxKGN4LCBjZywgYmlnU3VmZml4
KSA+PSAwOwogfQogCkBAIC0yMDAyLDI5ICsyMDAyLDI4IEBAIEVtaXRMZWF2ZUJsb2NrKEpTQ29u
dGV4dCAqY3gsIEpTQ29kZUdlbmUKICAqICAgewogICogICAgIHVuZGVjbGFyZWQgPSAxNzsgLy8g
dGhyb3dzIFJlZmVyZW5jZUVycm9yCiAgKiAgIH0KICAqICAgZm9vKCk7CiAgKi8KIHN0YXRpYyBi
b29sCiBUcnlDb252ZXJ0VG9HbmFtZShKU0NvZGVHZW5lcmF0b3IgKmNnLCBKU1BhcnNlTm9kZSAq
cG4sIEpTT3AgKm9wKQogewotICAgIGlmIChjZy0+Y29tcGlsZUFuZEdvKCkgJiYgCisgICAgaWYg
KGNnLT5jb21waWxlQW5kR28oKSAmJgogICAgICAgICBjZy0+Y29tcGlsZXIoKS0+Z2xvYmFsU2Nv
cGUtPmdsb2JhbE9iaiAmJgogICAgICAgICAhY2ctPm1pZ2h0QWxpYXNMb2NhbHMoKSAmJgogICAg
ICAgICAhcG4tPmlzRGVvcHRpbWl6ZWQoKSAmJgotICAgICAgICAhKGNnLT5mbGFncyAmIFRDRl9T
VFJJQ1RfTU9ERV9DT0RFKSkgeyAKKyAgICAgICAgIShjZy0+ZmxhZ3MgJiBUQ0ZfU1RSSUNUX01P
REVfQ09ERSkpIHsKICAgICAgICAgc3dpdGNoICgqb3ApIHsKICAgICAgICAgICBjYXNlIEpTT1Bf
TkFNRTogICAgICpvcCA9IEpTT1BfR0VUR05BTUU7IGJyZWFrOwogICAgICAgICAgIGNhc2UgSlNP
UF9TRVROQU1FOiAgKm9wID0gSlNPUF9TRVRHTkFNRTsgYnJlYWs7CiAgICAgICAgICAgY2FzZSBK
U09QX0lOQ05BTUU6ICAqb3AgPSBKU09QX0lOQ0dOQU1FOyBicmVhazsKICAgICAgICAgICBjYXNl
IEpTT1BfTkFNRUlOQzogICpvcCA9IEpTT1BfR05BTUVJTkM7IGJyZWFrOwogICAgICAgICAgIGNh
c2UgSlNPUF9ERUNOQU1FOiAgKm9wID0gSlNPUF9ERUNHTkFNRTsgYnJlYWs7CiAgICAgICAgICAg
Y2FzZSBKU09QX05BTUVERUM6ICAqb3AgPSBKU09QX0dOQU1FREVDOyBicmVhazsKLSAgICAgICAg
ICBjYXNlIEpTT1BfRk9STkFNRTogICpvcCA9IEpTT1BfRk9SR05BTUU7IGJyZWFrOwogICAgICAg
ICAgIGNhc2UgSlNPUF9TRVRDT05TVDoKICAgICAgICAgICBjYXNlIEpTT1BfREVMTkFNRToKICAg
ICAgICAgICAgIC8qIE5vdCBzdXBwb3J0ZWQuICovCiAgICAgICAgICAgICByZXR1cm4gZmFsc2U7
CiAgICAgICAgICAgZGVmYXVsdDogSlNfTk9UX1JFQUNIRUQoImduYW1lIik7CiAgICAgICAgIH0K
ICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgfQpAQCAtMjIxMSwyNCArMjIxMCwxNiBAQCBCaW5k
TmFtZVRvU2xvdChKU0NvbnRleHQgKmN4LCBKU0NvZGVHZW5lCiAgICAgICAgICAqLwogICAgICAg
ICBjb29raWUubWFrZUZyZWUoKTsKICAgICB9CiAKICAgICBpZiAoY29va2llLmlzRnJlZSgpKSB7
CiAgICAgICAgIEpTU3RhY2tGcmFtZSAqY2FsbGVyID0gY2ctPnBhcnNlci0+Y2FsbGVyRnJhbWU7
CiAgICAgICAgIGlmIChjYWxsZXIpIHsKICAgICAgICAgICAgIEpTX0FTU0VSVChjZy0+Y29tcGls
ZUFuZEdvKCkpOwotCi0gICAgICAgICAgICAvKgotICAgICAgICAgICAgICogRG9uJ3QgZ2VuZXJh
dGUgdXB2YXJzIG9uIHRoZSBsZWZ0IHNpZGUgb2YgYSBmb3IgbG9vcC4gU2VlCi0gICAgICAgICAg
ICAgKiBidWcgNDcwNzU4LgotICAgICAgICAgICAgICovCi0gICAgICAgICAgICBpZiAoY2ctPmZs
YWdzICYgVENGX0lOX0ZPUl9JTklUKQotICAgICAgICAgICAgICAgIHJldHVybiBKU19UUlVFOwot
CiAgICAgICAgICAgICBKU19BU1NFUlQoY2FsbGVyLT5pc1NjcmlwdEZyYW1lKCkpOwogCiAgICAg
ICAgICAgICAvKgogICAgICAgICAgICAgICogSWYgdGhpcyBpcyBhbiBldmFsIGluIHRoZSBnbG9i
YWwgc2NvcGUsIHRoZW4gdW5ib3VuZCB2YXJpYWJsZXMKICAgICAgICAgICAgICAqIG11c3QgYmUg
Z2xvYmFscywgc28gdHJ5IHRvIHVzZSBHTkFNRSBvcHMuCiAgICAgICAgICAgICAgKi8KICAgICAg
ICAgICAgIGlmIChjYWxsZXItPmlzR2xvYmFsRnJhbWUoKSAmJiBUcnlDb252ZXJ0VG9HbmFtZShj
ZywgcG4sICZvcCkpIHsKICAgICAgICAgICAgICAgICBhbGUgPSBjZy0+YXRvbUxpc3QuYWRkKGNn
LT5wYXJzZXIsIGF0b20pOwpAQCAtMjM0MywzMCArMjMzNCwyOCBAQCBCaW5kTmFtZVRvU2xvdChK
U0NvbnRleHQgKmN4LCBKU0NvZGVHZW5lCiAgICAgICBjYXNlIEpTRGVmaW5pdGlvbjo6TEVUOgog
ICAgICAgICBzd2l0Y2ggKG9wKSB7CiAgICAgICAgICAgY2FzZSBKU09QX05BTUU6ICAgICBvcCA9
IEpTT1BfR0VUTE9DQUw7IGJyZWFrOwogICAgICAgICAgIGNhc2UgSlNPUF9TRVROQU1FOiAgb3Ag
PSBKU09QX1NFVExPQ0FMOyBicmVhazsKICAgICAgICAgICBjYXNlIEpTT1BfSU5DTkFNRTogIG9w
ID0gSlNPUF9JTkNMT0NBTDsgYnJlYWs7CiAgICAgICAgICAgY2FzZSBKU09QX05BTUVJTkM6ICBv
cCA9IEpTT1BfTE9DQUxJTkM7IGJyZWFrOwogICAgICAgICAgIGNhc2UgSlNPUF9ERUNOQU1FOiAg
b3AgPSBKU09QX0RFQ0xPQ0FMOyBicmVhazsKICAgICAgICAgICBjYXNlIEpTT1BfTkFNRURFQzog
IG9wID0gSlNPUF9MT0NBTERFQzsgYnJlYWs7Ci0gICAgICAgICAgY2FzZSBKU09QX0ZPUk5BTUU6
ICBvcCA9IEpTT1BfRk9STE9DQUw7IGJyZWFrOwogICAgICAgICAgIGRlZmF1bHQ6IEpTX05PVF9S
RUFDSEVEKCJsZXQiKTsKICAgICAgICAgfQogICAgICAgICBicmVhazsKIAogICAgICAgY2FzZSBK
U0RlZmluaXRpb246OkFSRzoKICAgICAgICAgc3dpdGNoIChvcCkgewogICAgICAgICAgIGNhc2Ug
SlNPUF9OQU1FOiAgICAgb3AgPSBKU09QX0dFVEFSRzsgYnJlYWs7CiAgICAgICAgICAgY2FzZSBK
U09QX1NFVE5BTUU6ICBvcCA9IEpTT1BfU0VUQVJHOyBicmVhazsKICAgICAgICAgICBjYXNlIEpT
T1BfSU5DTkFNRTogIG9wID0gSlNPUF9JTkNBUkc7IGJyZWFrOwogICAgICAgICAgIGNhc2UgSlNP
UF9OQU1FSU5DOiAgb3AgPSBKU09QX0FSR0lOQzsgYnJlYWs7CiAgICAgICAgICAgY2FzZSBKU09Q
X0RFQ05BTUU6ICBvcCA9IEpTT1BfREVDQVJHOyBicmVhazsKICAgICAgICAgICBjYXNlIEpTT1Bf
TkFNRURFQzogIG9wID0gSlNPUF9BUkdERUM7IGJyZWFrOwotICAgICAgICAgIGNhc2UgSlNPUF9G
T1JOQU1FOiAgb3AgPSBKU09QX0ZPUkFSRzsgYnJlYWs7CiAgICAgICAgICAgZGVmYXVsdDogSlNf
Tk9UX1JFQUNIRUQoImFyZyIpOwogICAgICAgICB9CiAgICAgICAgIEpTX0FTU0VSVCghcG4tPmlz
Q29uc3QoKSk7CiAgICAgICAgIGJyZWFrOwogCiAgICAgICBjYXNlIEpTRGVmaW5pdGlvbjo6VkFS
OgogICAgICAgICBpZiAoUE5fT1AoZG4pID09IEpTT1BfQ0FMTEVFKSB7CiAgICAgICAgICAgICBK
U19BU1NFUlQob3AgIT0gSlNPUF9DQUxMRUUpOwpAQCAtMjQxNSwxNyArMjQwNCwxNiBAQCBCaW5k
TmFtZVRvU2xvdChKU0NvbnRleHQgKmN4LCBKU0NvZGVHZW5lCiAgICAgICAgIHN3aXRjaCAob3Ap
IHsKICAgICAgICAgICBjYXNlIEpTT1BfTkFNRTogICAgIG9wID0gSlNPUF9HRVRMT0NBTDsgYnJl
YWs7CiAgICAgICAgICAgY2FzZSBKU09QX1NFVE5BTUU6ICBvcCA9IEpTT1BfU0VUTE9DQUw7IGJy
ZWFrOwogICAgICAgICAgIGNhc2UgSlNPUF9TRVRDT05TVDogb3AgPSBKU09QX1NFVExPQ0FMOyBi
cmVhazsKICAgICAgICAgICBjYXNlIEpTT1BfSU5DTkFNRTogIG9wID0gSlNPUF9JTkNMT0NBTDsg
YnJlYWs7CiAgICAgICAgICAgY2FzZSBKU09QX05BTUVJTkM6ICBvcCA9IEpTT1BfTE9DQUxJTkM7
IGJyZWFrOwogICAgICAgICAgIGNhc2UgSlNPUF9ERUNOQU1FOiAgb3AgPSBKU09QX0RFQ0xPQ0FM
OyBicmVhazsKICAgICAgICAgICBjYXNlIEpTT1BfTkFNRURFQzogIG9wID0gSlNPUF9MT0NBTERF
QzsgYnJlYWs7Ci0gICAgICAgICAgY2FzZSBKU09QX0ZPUk5BTUU6ICBvcCA9IEpTT1BfRk9STE9D
QUw7IGJyZWFrOwogICAgICAgICAgIGRlZmF1bHQ6IEpTX05PVF9SRUFDSEVEKCJsb2NhbCIpOwog
ICAgICAgICB9CiAgICAgICAgIEpTX0FTU0VSVF9JRihkbl9raW5kID09IEpTRGVmaW5pdGlvbjo6
Q09OU1QsIHBuLT5wbl9kZmxhZ3MgJiBQTkRfQ09OU1QpOwogICAgICAgICBicmVhazsKICAgICB9
CiAKICAgICBKU19BU1NFUlQob3AgIT0gUE5fT1AocG4pKTsKICAgICBwbi0+cG5fb3AgPSBvcDsK
QEAgLTM3NTYsNTcgKzM3NDQsMzcgQEAgTWF5YmVFbWl0VmFyRGVjbChKU0NvbnRleHQgKmN4LCBK
U0NvZGVHZQogCiAgICAgaWYgKHJlc3VsdCkKICAgICAgICAgKnJlc3VsdCA9IGF0b21JbmRleDsK
ICAgICByZXR1cm4gSlNfVFJVRTsKIH0KIAogI2lmIEpTX0hBU19ERVNUUlVDVFVSSU5HCiAKLXR5
cGVkZWYgSlNCb29sCi0oKkRlc3RydWN0dXJpbmdEZWNsRW1pdHRlcikoSlNDb250ZXh0ICpjeCwg
SlNDb2RlR2VuZXJhdG9yICpjZywgSlNPcCBwcm9sb2dPcCwKLSAgICAgICAgICAgICAgICAgICAg
ICAgICAgICBKU1BhcnNlTm9kZSAqcG4pOwotCi1zdGF0aWMgSlNCb29sCi1FbWl0RGVzdHJ1Y3R1
cmluZ0RlY2woSlNDb250ZXh0ICpjeCwgSlNDb2RlR2VuZXJhdG9yICpjZywgSlNPcCBwcm9sb2dP
cCwKLSAgICAgICAgICAgICAgICAgICAgICBKU1BhcnNlTm9kZSAqcG4pCi17Ci0gICAgSlNfQVNT
RVJUKHBuLT5wbl90eXBlID09IFRPS19OQU1FKTsKLSAgICBpZiAoIUJpbmROYW1lVG9TbG90KGN4
LCBjZywgcG4pKQotICAgICAgICByZXR1cm4gSlNfRkFMU0U7Ci0KLSAgICBKU19BU1NFUlQoUE5f
T1AocG4pICE9IEpTT1BfQVJHVU1FTlRTICYmIFBOX09QKHBuKSAhPSBKU09QX0NBTExFRSk7Ci0g
ICAgcmV0dXJuIE1heWJlRW1pdFZhckRlY2woY3gsIGNnLCBwcm9sb2dPcCwgcG4sIE5VTEwpOwot
fQotCiBzdGF0aWMgSlNCb29sCiBFbWl0RGVzdHJ1Y3R1cmluZ0RlY2xzKEpTQ29udGV4dCAqY3gs
IEpTQ29kZUdlbmVyYXRvciAqY2csIEpTT3AgcHJvbG9nT3AsCiAgICAgICAgICAgICAgICAgICAg
ICAgIEpTUGFyc2VOb2RlICpwbikKIHsKLSAgICBKU1BhcnNlTm9kZSAqcG4yLCAqcG4zOwotICAg
IERlc3RydWN0dXJpbmdEZWNsRW1pdHRlciBlbWl0dGVyOwotCi0gICAgaWYgKHBuLT5wbl90eXBl
ID09IFRPS19SQikgewotICAgICAgICBmb3IgKHBuMiA9IHBuLT5wbl9oZWFkOyBwbjI7IHBuMiA9
IHBuMi0+cG5fbmV4dCkgeworICAgIGlmIChwbi0+cG5fdHlwZSA9PSBUT0tfTkFNRSkgeworICAg
ICAgICBpZiAoIUJpbmROYW1lVG9TbG90KGN4LCBjZywgcG4pKQorICAgICAgICAgICAgcmV0dXJu
IEpTX0ZBTFNFOworCisgICAgICAgIEpTX0FTU0VSVChQTl9PUChwbikgIT0gSlNPUF9BUkdVTUVO
VFMgJiYgUE5fT1AocG4pICE9IEpTT1BfQ0FMTEVFKTsKKyAgICAgICAgcmV0dXJuIE1heWJlRW1p
dFZhckRlY2woY3gsIGNnLCBwcm9sb2dPcCwgcG4sIE5VTEwpOworICAgIH0gZWxzZSBpZiAocG4t
PnBuX3R5cGUgPT0gVE9LX1JCKSB7CisgICAgICAgIGZvciAoSlNQYXJzZU5vZGUgKnBuMiA9IHBu
LT5wbl9oZWFkOyBwbjI7IHBuMiA9IHBuMi0+cG5fbmV4dCkgewogICAgICAgICAgICAgaWYgKHBu
Mi0+cG5fdHlwZSA9PSBUT0tfQ09NTUEpCiAgICAgICAgICAgICAgICAgY29udGludWU7Ci0gICAg
ICAgICAgICBlbWl0dGVyID0gKHBuMi0+cG5fdHlwZSA9PSBUT0tfTkFNRSkKLSAgICAgICAgICAg
ICAgICAgICAgICA/IEVtaXREZXN0cnVjdHVyaW5nRGVjbAotICAgICAgICAgICAgICAgICAgICAg
IDogRW1pdERlc3RydWN0dXJpbmdEZWNsczsKLSAgICAgICAgICAgIGlmICghZW1pdHRlcihjeCwg
Y2csIHByb2xvZ09wLCBwbjIpKQorICAgICAgICAgICAgaWYgKCFFbWl0RGVzdHJ1Y3R1cmluZ0Rl
Y2xzKGN4LCBjZywgcHJvbG9nT3AsIHBuMikpCiAgICAgICAgICAgICAgICAgcmV0dXJuIEpTX0ZB
TFNFOwogICAgICAgICB9CiAgICAgfSBlbHNlIHsKICAgICAgICAgSlNfQVNTRVJUKHBuLT5wbl90
eXBlID09IFRPS19SQyk7Ci0gICAgICAgIGZvciAocG4yID0gcG4tPnBuX2hlYWQ7IHBuMjsgcG4y
ID0gcG4yLT5wbl9uZXh0KSB7Ci0gICAgICAgICAgICBwbjMgPSBwbjItPnBuX3JpZ2h0OwotICAg
ICAgICAgICAgZW1pdHRlciA9IChwbjMtPnBuX3R5cGUgPT0gVE9LX05BTUUpCi0gICAgICAgICAg
ICAgICAgICAgICAgPyBFbWl0RGVzdHJ1Y3R1cmluZ0RlY2wKLSAgICAgICAgICAgICAgICAgICAg
ICA6IEVtaXREZXN0cnVjdHVyaW5nRGVjbHM7Ci0gICAgICAgICAgICBpZiAoIWVtaXR0ZXIoY3gs
IGNnLCBwcm9sb2dPcCwgcG4zKSkKKyAgICAgICAgZm9yIChKU1BhcnNlTm9kZSAqcG4yID0gcG4t
PnBuX2hlYWQ7IHBuMjsgcG4yID0gcG4yLT5wbl9uZXh0KSB7CisgICAgICAgICAgICBpZiAoIUVt
aXREZXN0cnVjdHVyaW5nRGVjbHMoY3gsIGNnLCBwcm9sb2dPcCwgcG4yLT5wbl9yaWdodCkpCiAg
ICAgICAgICAgICAgICAgcmV0dXJuIEpTX0ZBTFNFOwogICAgICAgICB9CiAgICAgfQogICAgIHJl
dHVybiBKU19UUlVFOwogfQogCiBzdGF0aWMgSlNCb29sCiBFbWl0RGVzdHJ1Y3R1cmluZ09wc0hl
bHBlcihKU0NvbnRleHQgKmN4LCBKU0NvZGVHZW5lcmF0b3IgKmNnLCBKU1BhcnNlTm9kZSAqcG4p
OwpAQCAtNDA5MiwyNCArNDA2MCwyMyBAQCBNYXliZUVtaXRHcm91cEFzc2lnbm1lbnQoSlNDb250
ZXh0ICpjeCwgCiAgICAgICAgICEocmhzLT5wbl94ZmxhZ3MgJiBQTlhfSE9MRVkpICYmCiAgICAg
ICAgIGxocy0+cG5fY291bnQgPD0gcmhzLT5wbl9jb3VudCkgewogICAgICAgICBpZiAoIUVtaXRH
cm91cEFzc2lnbm1lbnQoY3gsIGNnLCBwcm9sb2dPcCwgbGhzLCByaHMpKQogICAgICAgICAgICAg
cmV0dXJuIEpTX0ZBTFNFOwogICAgICAgICAqcG9wID0gSlNPUF9OT1A7CiAgICAgfQogICAgIHJl
dHVybiBKU19UUlVFOwogfQotCiAjZW5kaWYgLyogSlNfSEFTX0RFU1RSVUNUVVJJTkcgKi8KIAog
c3RhdGljIEpTQm9vbAogRW1pdFZhcmlhYmxlcyhKU0NvbnRleHQgKmN4LCBKU0NvZGVHZW5lcmF0
b3IgKmNnLCBKU1BhcnNlTm9kZSAqcG4sCi0gICAgICAgICAgICAgIEpTQm9vbCBpbkxldEhlYWQs
IHB0cmRpZmZfdCAqaGVhZE5vdGVJbmRleCkKKyAgICAgICAgICAgICAgYm9vbCBmb3JJblZhciwg
SlNCb29sIGluTGV0SGVhZCwgcHRyZGlmZl90ICpoZWFkTm90ZUluZGV4KQogewotICAgIGJvb2wg
bGV0LCBmb3JJblZhciwgZmlyc3Q7CisgICAgYm9vbCBsZXQsIGZpcnN0OwogI2lmIEpTX0hBU19C
TE9DS19TQ09QRQogICAgIGJvb2wgZm9ySW5MZXQsIHBvcFNjb3BlOwogICAgIEpTU3RtdEluZm8g
KnN0bXQsICpzY29wZVN0bXQ7CiAjZW5kaWYKICAgICBwdHJkaWZmX3Qgb2ZmLCBub3RlSW5kZXgs
IHRtcDsKICAgICBKU1BhcnNlTm9kZSAqcG4yLCAqcG4zLCAqbmV4dDsKICAgICBKU09wIG9wOwog
ICAgIGpzYXRvbWlkIGF0b21JbmRleDsKQEAgLTQxMTksODggKzQwODYsNzUgQEAgRW1pdFZhcmlh
YmxlcyhKU0NvbnRleHQgKmN4LCBKU0NvZGVHZW5lcgogICAgICpoZWFkTm90ZUluZGV4ID0gLTE7
CiAKICAgICAvKgogICAgICAqIExldCBibG9ja3MgYW5kIGV4cHJlc3Npb25zIGhhdmUgYSBwYXJl
bnRoZXNpemVkIGhlYWQgaW4gd2hpY2ggdGhlIG5ldwogICAgICAqIHNjb3BlIGlzIG5vdCB5ZXQg
b3Blbi4gSW5pdGlhbGl6ZXIgZXZhbHVhdGlvbiB1c2VzIHRoZSBwYXJlbnQgbm9kZSdzCiAgICAg
ICogbGV4aWNhbCBzY29wZS4gSWYgcG9wU2NvcGUgaXMgdHJ1ZSBiZWxvdywgdGhlbiB3ZSBoaWRl
IHRoZSB0b3AgbGV4aWNhbAogICAgICAqIGJsb2NrIGZyb20gYW55IGNhbGxzIHRvIEJpbmROYW1l
VG9TbG90IGhpZGluZyBpbiBwbjItPnBuX2V4cHIgc28gdGhhdAogICAgICAqIGl0IHdvbid0IGZp
bmQgYW55IG5hbWVzIGluIHRoZSBuZXcgbGV0IGJsb2NrLgotICAgICAqCi0gICAgICogVGhlIHNh
bWUgZ29lcyBmb3IgbGV0IGRlY2xhcmF0aW9ucyBpbiB0aGUgaGVhZCBvZiBhbnkga2luZCBvZiBm
b3IgbG9vcC4KLSAgICAgKiBVbmxpa2UgYSBsZXQgZGVjbGFyYXRpb24gJ2xldCB4ID0gaScgd2l0
aGluIGEgYmxvY2ssIHdoZXJlIHggaXMgaG9pc3RlZAotICAgICAqIHRvIHRoZSBzdGFydCBvZiB0
aGUgYmxvY2ssIGEgJ2ZvciAobGV0IHggPSBpLi4uKSAuLi4nIGxvb3AgZXZhbHVhdGVzIGkKLSAg
ICAgKiBpbiB0aGUgY29udGFpbmluZyBzY29wZSwgYW5kIHB1dHMgeCBpbiB0aGUgbG9vcCBib2R5
J3Mgc2NvcGUuCiAgICAgICovCiAgICAgbGV0ID0gKHBuLT5wbl9vcCA9PSBKU09QX05PUCk7Ci0g
ICAgZm9ySW5WYXIgPSAocG4tPnBuX3hmbGFncyAmIFBOWF9GT1JJTlZBUikgIT0gMDsKICNpZiBK
U19IQVNfQkxPQ0tfU0NPUEUKICAgICBmb3JJbkxldCA9IGxldCAmJiBmb3JJblZhcjsKICAgICBw
b3BTY29wZSA9IChpbkxldEhlYWQgfHwgKGxldCAmJiAoY2ctPmZsYWdzICYgVENGX0lOX0ZPUl9J
TklUKSkpOwogICAgIGlmIChwb3BTY29wZSkgewogICAgICAgICBzdG10ID0gY2ctPnRvcFN0bXQ7
CiAgICAgICAgIHNjb3BlU3RtdCA9IGNnLT50b3BTY29wZVN0bXQ7CiAgICAgfQogIyBpZmRlZiBf
X0dOVUNfXwogICAgIGVsc2Ugc3RtdCA9IHNjb3BlU3RtdCA9IE5VTEw7ICAgLyogcXVlbGwgR0ND
IG92ZXJ3YXJuaW5nICovCiAjIGVuZGlmCiAgICAgSlNfQVNTRVJUKCFwb3BTY29wZSB8fCBsZXQp
OwogI2VuZGlmCiAKKyAgICBpbnROIGJhc2VTdGFja0RlcHRoID0gY2ctPnN0YWNrRGVwdGg7CiAg
ICAgb2ZmID0gbm90ZUluZGV4ID0gLTE7CiAgICAgZm9yIChwbjIgPSBwbi0+cG5faGVhZDsgOyBw
bjIgPSBuZXh0KSB7CiAgICAgICAgIGZpcnN0ID0gcG4yID09IHBuLT5wbl9oZWFkOwogICAgICAg
ICBuZXh0ID0gcG4yLT5wbl9uZXh0OwogCi0gICAgICAgIGlmIChwbjItPnBuX3R5cGUgIT0gVE9L
X05BTUUpIHsKLSNpZiBKU19IQVNfREVTVFJVQ1RVUklORwotICAgICAgICAgICAgaWYgKHBuMi0+
cG5fdHlwZSA9PSBUT0tfUkIgfHwgcG4yLT5wbl90eXBlID09IFRPS19SQykgewotICAgICAgICAg
ICAgICAgIC8qCi0gICAgICAgICAgICAgICAgICogRW1pdCB2YXJpYWJsZSBiaW5kaW5nIG9wcywg
YnV0IG5vdCBkZXN0cnVjdHVyaW5nIG9wcy4KLSAgICAgICAgICAgICAgICAgKiBUaGUgcGFyc2Vy
IChzZWUgVmFyaWFibGVzLCBqc3BhcnNlLmMpIGhhcyBlbnN1cmVkIHRoYXQKLSAgICAgICAgICAg
ICAgICAgKiBvdXIgY2FsbGVyIHdpbGwgYmUgdGhlIFRPS19GT1IvVE9LX0lOIGNhc2UgaW4ganNf
RW1pdFRyZWUsCi0gICAgICAgICAgICAgICAgICogYW5kIHRoYXQgY2FzZSB3aWxsIGVtaXQgdGhl
IGRlc3RydWN0dXJpbmcgY29kZSBvbmx5IGFmdGVyCi0gICAgICAgICAgICAgICAgICogZW1pdHRp
bmcgYW4gZW51bWVyYXRpbmcgb3Bjb2RlIGFuZCBhIGJyYW5jaCB0aGF0IHRlc3RzCi0gICAgICAg
ICAgICAgICAgICogd2hldGhlciB0aGUgZW51bWVyYXRpb24gZW5kZWQuCi0gICAgICAgICAgICAg
ICAgICovCi0gICAgICAgICAgICAgICAgSlNfQVNTRVJUKGZvckluVmFyKTsKLSAgICAgICAgICAg
ICAgICBKU19BU1NFUlQocG4tPnBuX2NvdW50ID09IDEpOwotICAgICAgICAgICAgICAgIGlmICgh
RW1pdERlc3RydWN0dXJpbmdEZWNscyhjeCwgY2csIFBOX09QKHBuKSwgcG4yKSkKLSAgICAgICAg
ICAgICAgICAgICAgcmV0dXJuIEpTX0ZBTFNFOwotICAgICAgICAgICAgICAgIGJyZWFrOwotICAg
ICAgICAgICAgfQotI2VuZGlmCi0KKyAgICAgICAgaWYgKHBuMi0+cG5fdHlwZSAhPSBUT0tfTkFN
RSB8fCBmb3JJblZhcikgewogICAgICAgICAgICAgLyoKLSAgICAgICAgICAgICAqIEEgZGVzdHJ1
Y3R1cmluZyBpbml0aWFsaXNlciBhc3NpZ25tZW50IHByZWNlZGVkIGJ5IHZhciB3aWxsCi0gICAg
ICAgICAgICAgKiBuZXZlciBvY2N1ciB0byB0aGUgbGVmdCBvZiAnaW4nIGluIGEgZm9yLWluIGxv
b3AuICBBcyB3aXRoICdmb3IKLSAgICAgICAgICAgICAqICh2YXIgeCA9IGkgaW4gbykuLi4nLCB0
aGlzIHdpbGwgY2F1c2UgdGhlIGVudGlyZSAndmFyIFthLCBiXSA9Ci0gICAgICAgICAgICAgKiBp
JyB0byBiZSBob2lzdGVkIG91dCBvZiB0aGUgbG9vcC4KKyAgICAgICAgICAgICAqIHBuMi0+cG5f
dHlwZSAhPSBUT0tfTkFNRSBpbmRpY2F0ZXMgYSBkZXN0cnVjdHVyaW5nIGRlY2xhcmF0aW9uCisg
ICAgICAgICAgICAgKiBsaWtlICd2YXIgW2EsIGJdID0gZTsnLiBmb3JJblZhciBpbmRpY2F0ZXMg
YSBkZWNsIGluIHRoZSBoZWFkIG9mCisgICAgICAgICAgICAgKiBhIGZvciBzdGF0ZW1lbnQgb3Ig
Zm9yLWluIHN0YXRlbWVudC4KKyAgICAgICAgICAgICAqCisgICAgICAgICAgICAgKiBJbiB0aGUg
bGF0dGVyIGNhc2UsIHBuMiBpcyBmb3IgUCB3aXRob3V0IGFuIGFzc2lnbm1lbnQsIGJ1dAorICAg
ICAgICAgICAgICogd2UgZW1pdCBjb2RlIGFzIGZvciBhbiBhc3NpZ25tZW50IGFueXdheS4gVGhl
IHZhbHVlIGJlaW5nIGFzc2lnbmVkCisgICAgICAgICAgICAgKiBpcyB0aGUgcmVzdWx0IG9mIEpT
T1BfTkVYVC4KKyAgICAgICAgICAgICAqCisgICAgICAgICAgICAgKiBOb3RlIHRoYXQgdGhlIHBh
cnNlciByZXdyaXRlcyAnZm9yICh2YXIgeCA9IGkgaW4gbykgUycgdG8KKyAgICAgICAgICAgICAq
ICd2YXIgeCA9IGk7IGZvciAoeCBpbiBvKSBTJywgc28gdGhlcmUgaXMgZGVmaW5pdGVseSBub3Qg
YW4gJz0gaScKKyAgICAgICAgICAgICAqIG5vZGUgdG8gd29ycnkgYWJvdXQgaGVyZS4KICAgICAg
ICAgICAgICAqLwotICAgICAgICAgICAgSlNfQVNTRVJUKHBuMi0+cG5fdHlwZSA9PSBUT0tfQVNT
SUdOKTsKLSAgICAgICAgICAgIEpTX0FTU0VSVCghZm9ySW5WYXIpOworICAgICAgICAgICAgSlNf
QVNTRVJUX0lGKGZvckluVmFyLCBwbi0+cG5fY291bnQgPT0gMSk7CisgICAgICAgICAgICBKU19B
U1NFUlRfSUYoZm9ySW5WYXIsIHBuMi0+cG5fdHlwZSAhPSBUT0tfQVNTSUdOKTsKKyAgICAgICAg
ICAgIEpTX0FTU0VSVF9JRighZm9ySW5WYXIsIHBuMi0+cG5fdHlwZSA9PSBUT0tfQVNTSUdOKTsK
KworICAgICAgICAgICAgSlNQYXJzZU5vZGUgKnBubGVmdCA9IGZvckluVmFyID8gcG4yIDogcG4y
LT5wbl9sZWZ0OwogCiAgICAgICAgICAgICAvKgogICAgICAgICAgICAgICogVG8gYWxsb3cgdGhl
IGZyb250IGVuZCB0byByZXdyaXRlIHZhciBmID0geDsgYXMgZiA9IHg7IHdoZW4gYQogICAgICAg
ICAgICAgICogZnVuY3Rpb24gZigpe30gcHJlY2VkZXMgdGhlIHZhciwgZGV0ZWN0IHNpbXBsZSBu
YW1lIGFzc2lnbm1lbnQKICAgICAgICAgICAgICAqIGhlcmUgYW5kIGluaXRpYWxpemUgdGhlIG5h
bWUuCiAgICAgICAgICAgICAgKi8KICNpZiAhSlNfSEFTX0RFU1RSVUNUVVJJTkcKLSAgICAgICAg
ICAgIEpTX0FTU0VSVChwbjItPnBuX2xlZnQtPnBuX3R5cGUgPT0gVE9LX05BTUUpOworICAgICAg
ICAgICAgSlNfQVNTRVJUKHBubGVmdC0+cG5fdHlwZSA9PSBUT0tfTkFNRSk7CiAjZWxzZQotICAg
ICAgICAgICAgaWYgKHBuMi0+cG5fbGVmdC0+cG5fdHlwZSA9PSBUT0tfTkFNRSkKKyAgICAgICAg
ICAgIGlmIChwbmxlZnQtPnBuX3R5cGUgPT0gVE9LX05BTUUpCiAjZW5kaWYKICAgICAgICAgICAg
IHsKLSAgICAgICAgICAgICAgICBwbjMgPSBwbjItPnBuX3JpZ2h0OwotICAgICAgICAgICAgICAg
IHBuMiA9IHBuMi0+cG5fbGVmdDsKKyAgICAgICAgICAgICAgICBwbjMgPSBmb3JJblZhciA/IE5V
TEwgOiBwbjItPnBuX3JpZ2h0OworICAgICAgICAgICAgICAgIHBuMiA9IHBubGVmdDsKICAgICAg
ICAgICAgICAgICBnb3RvIGRvX25hbWU7CiAgICAgICAgICAgICB9CiAKICNpZiBKU19IQVNfREVT
VFJVQ1RVUklORwotICAgICAgICAgICAgaWYgKHBuLT5wbl9jb3VudCA9PSAxKSB7CisgICAgICAg
ICAgICBpZiAocG4tPnBuX2NvdW50ID09IDEgJiYgIWZvckluVmFyKSB7CiAgICAgICAgICAgICAg
ICAgLyoKICAgICAgICAgICAgICAgICAgKiBJZiB0aGlzIGlzIHRoZSBvbmx5IGRlc3RydWN0dXJp
bmcgYXNzaWdubWVudCBpbiB0aGUgbGlzdCwKICAgICAgICAgICAgICAgICAgKiB0cnkgdG8gb3B0
aW1pemUgdG8gYSBncm91cCBhc3NpZ25tZW50LiAgSWYgd2UncmUgaW4gYSBsZXQKICAgICAgICAg
ICAgICAgICAgKiBoZWFkLCBwYXNzIEpTT1BfUE9QIHJhdGhlciB0aGFuIHRoZSBwc2V1ZG8tcHJv
bG9nIEpTT1BfTk9QCiAgICAgICAgICAgICAgICAgICogaW4gcG4tPnBuX29wLCB0byBzdXBwcmVz
cyBhIHNlY29uZCAoYW5kIG1pc3BsYWNlZCkgJ2xldCcuCiAgICAgICAgICAgICAgICAgICovCiAg
ICAgICAgICAgICAgICAgSlNfQVNTRVJUKG5vdGVJbmRleCA8IDAgJiYgIXBuMi0+cG5fbmV4dCk7
CiAgICAgICAgICAgICAgICAgb3AgPSBKU09QX1BPUDsKQEAgLTQyMTAsMzEgKzQxNjQsMzAgQEAg
RW1pdFZhcmlhYmxlcyhKU0NvbnRleHQgKmN4LCBKU0NvZGVHZW5lcgogICAgICAgICAgICAgICAg
ICAgICByZXR1cm4gSlNfRkFMU0U7CiAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAg
IGlmIChvcCA9PSBKU09QX05PUCkgewogICAgICAgICAgICAgICAgICAgICBwbi0+cG5feGZsYWdz
ID0gKHBuLT5wbl94ZmxhZ3MgJiB+UE5YX1BPUFZBUikgfCBQTlhfR1JPVVBJTklUOwogICAgICAg
ICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICB9CiAK
LSAgICAgICAgICAgIHBuMyA9IHBuMi0+cG5fbGVmdDsKLSAgICAgICAgICAgIGlmICghRW1pdERl
c3RydWN0dXJpbmdEZWNscyhjeCwgY2csIFBOX09QKHBuKSwgcG4zKSkKKyAgICAgICAgICAgIGlm
ICghRW1pdERlc3RydWN0dXJpbmdEZWNscyhjeCwgY2csIFBOX09QKHBuKSwgcG5sZWZ0KSkKICAg
ICAgICAgICAgICAgICByZXR1cm4gSlNfRkFMU0U7CiAKICAgICAgICAgICAgIGlmICghanNfRW1p
dFRyZWUoY3gsIGNnLCBwbjItPnBuX3JpZ2h0KSkKICAgICAgICAgICAgICAgICByZXR1cm4gSlNf
RkFMU0U7CiAKICAgICAgICAgICAgIC8qCiAgICAgICAgICAgICAgKiBWZXRvIHBuLT5wbl9vcCBp
ZiBpbkxldEhlYWQgdG8gYXZvaWQgZW1pdHRpbmcgYSBTUkNfREVTVFJVQ1QKICAgICAgICAgICAg
ICAqIHRoYXQncyByZWR1bmRhbnQgd2l0aCByZXNwZWN0IHRvIHRoZSBTUkNfREVDTC9TUkNfREVD
TF9MRVQgdGhhdAogICAgICAgICAgICAgICogd2Ugd2lsbCBlbWl0IGF0IHRoZSBib3R0b20gb2Yg
dGhpcyBmdW5jdGlvbi4KICAgICAgICAgICAgICAqLwogICAgICAgICAgICAgaWYgKCFFbWl0RGVz
dHJ1Y3R1cmluZ09wcyhjeCwgY2csCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgIGluTGV0SGVhZCA/IEpTT1BfUE9QIDogUE5fT1AocG4pLAotICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICBwbjMpKSB7CisgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgIHBubGVmdCkpIHsKICAgICAgICAgICAgICAgICByZXR1cm4gSlNfRkFMU0U7CiAg
ICAgICAgICAgICB9CiAgICAgICAgICAgICBnb3RvIGVtaXRfbm90ZV9wb3A7CiAjZW5kaWYKICAg
ICAgICAgfQogCiAgICAgICAgIC8qCiAgICAgICAgICAqIExvYWQgaW5pdGlhbGl6ZXIgZWFybHkg
dG8gc2hhcmUgY29kZSBhYm92ZSB0aGF0IGp1bXBzIHRvIGRvX25hbWUuCkBAIC00MjU3LDY5ICs0
MjEwLDYwIEBAIEVtaXRWYXJpYWJsZXMoSlNDb250ZXh0ICpjeCwgSlNDb2RlR2VuZXIKICAgICAg
ICAgICAgIGF0b21JbmRleCA9IDA7ICAgICAgICAgICAgLyogcXVlbGwgR0NDIG92ZXJ3YXJuaW5n
ICovCiAjZW5kaWYKICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgIEpTX0FTU0VSVChvcCAh
PSBKU09QX0NBTExFRSk7CiAgICAgICAgICAgICBKU19BU1NFUlQoIXBuMi0+cG5fY29va2llLmlz
RnJlZSgpIHx8ICFsZXQpOwogICAgICAgICAgICAgaWYgKCFNYXliZUVtaXRWYXJEZWNsKGN4LCBj
ZywgUE5fT1AocG4pLCBwbjIsICZhdG9tSW5kZXgpKQogICAgICAgICAgICAgICAgIHJldHVybiBK
U19GQUxTRTsKIAotICAgICAgICAgICAgaWYgKHBuMykgewotICAgICAgICAgICAgICAgIEpTX0FT
U0VSVCghZm9ySW5WYXIpOworICAgICAgICAgICAgaWYgKHBuMyB8fCBmb3JJblZhcikgewogICAg
ICAgICAgICAgICAgIGlmIChvcCA9PSBKU09QX1NFVE5BTUUpIHsKICAgICAgICAgICAgICAgICAg
ICAgSlNfQVNTRVJUKCFsZXQpOwogICAgICAgICAgICAgICAgICAgICBFTUlUX0lOREVYX09QKEpT
T1BfQklORE5BTUUsIGF0b21JbmRleCk7CiAgICAgICAgICAgICAgICAgfSBlbHNlIGlmIChvcCA9
PSBKU09QX1NFVEdOQU1FKSB7CiAgICAgICAgICAgICAgICAgICAgIEpTX0FTU0VSVCghbGV0KTsK
ICAgICAgICAgICAgICAgICAgICAgRU1JVF9JTkRFWF9PUChKU09QX0JJTkRHTkFNRSwgYXRvbUlu
ZGV4KTsKICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgaWYgKHBuLT5wbl9vcCA9
PSBKU09QX0RFRkNPTlNUICYmCisgICAgICAgICAgICAgICAgICAgIHBuMyAmJgogICAgICAgICAg
ICAgICAgICAgICAhanNfRGVmaW5lQ29tcGlsZVRpbWVDb25zdGFudChjeCwgY2csIHBuMi0+cG5f
YXRvbSwgcG4zKSkgewogICAgICAgICAgICAgICAgICAgICByZXR1cm4gSlNfRkFMU0U7CiAgICAg
ICAgICAgICAgICAgfQogCiAjaWYgSlNfSEFTX0JMT0NLX1NDT1BFCiAgICAgICAgICAgICAgICAg
LyogRXZhbHVhdGUgZXhwciBpbiB0aGUgb3V0ZXIgbGV4aWNhbCBzY29wZSBpZiByZXF1ZXN0ZWQu
ICovCiAgICAgICAgICAgICAgICAgaWYgKHBvcFNjb3BlKSB7CiAgICAgICAgICAgICAgICAgICAg
IGNnLT50b3BTdG10ID0gc3RtdC0+ZG93bjsKICAgICAgICAgICAgICAgICAgICAgY2ctPnRvcFNj
b3BlU3RtdCA9IHNjb3BlU3RtdC0+ZG93blNjb3BlOwogICAgICAgICAgICAgICAgIH0KICNlbmRp
ZgogCiAgICAgICAgICAgICAgICAgb2xkZmxhZ3MgPSBjZy0+ZmxhZ3M7CiAgICAgICAgICAgICAg
ICAgY2ctPmZsYWdzICY9IH5UQ0ZfSU5fRk9SX0lOSVQ7Ci0gICAgICAgICAgICAgICAgaWYgKCFq
c19FbWl0VHJlZShjeCwgY2csIHBuMykpCi0gICAgICAgICAgICAgICAgICAgIHJldHVybiBKU19G
QUxTRTsKKyAgICAgICAgICAgICAgICBpZiAoZm9ySW5WYXIpIHsKKyAgICAgICAgICAgICAgICAg
ICAgSlNfQVNTRVJUKGNnLT5zdGFja0RlcHRoIC0gYmFzZVN0YWNrRGVwdGggPCAyNTYpOworICAg
ICAgICAgICAgICAgICAgICBpZiAoanNfRW1pdDIoY3gsIGNnLCBKU09QX05FWFQsIGNnLT5zdGFj
a0RlcHRoICsgMSAtIGJhc2VTdGFja0RlcHRoKSA8IDApCisgICAgICAgICAgICAgICAgICAgICAg
ICByZXR1cm4gSlNfRkFMU0U7CisgICAgICAgICAgICAgICAgfSBlbHNlIHsKKyAgICAgICAgICAg
ICAgICAgICAgaWYgKCFqc19FbWl0VHJlZShjeCwgY2csIHBuMykpCisgICAgICAgICAgICAgICAg
ICAgICAgICByZXR1cm4gSlNfRkFMU0U7CisgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAg
ICAgIGNnLT5mbGFncyB8PSBvbGRmbGFncyAmIFRDRl9JTl9GT1JfSU5JVDsKIAogI2lmIEpTX0hB
U19CTE9DS19TQ09QRQogICAgICAgICAgICAgICAgIGlmIChwb3BTY29wZSkgewogICAgICAgICAg
ICAgICAgICAgICBjZy0+dG9wU3RtdCA9IHN0bXQ7CiAgICAgICAgICAgICAgICAgICAgIGNnLT50
b3BTY29wZVN0bXQgPSBzY29wZVN0bXQ7CiAgICAgICAgICAgICAgICAgICAgIEpTX0FTU0VSVChj
Zy0+YmxvY2tDaGFpbkJveCA9PSBzY29wZVN0bXQtPmJsb2NrQm94KTsKICAgICAgICAgICAgICAg
ICB9CiAjZW5kaWYKICAgICAgICAgICAgIH0KICAgICAgICAgfQogCi0gICAgICAgIC8qCi0gICAg
ICAgICAqIFRoZSBwYXJzZXIgcmV3cml0ZXMgJ2ZvciAodmFyIHggPSBpIGluIG8pJyB0byBob2lz
dCAndmFyIHggPSBpJyAtLQotICAgICAgICAgKiBsaWtld2lzZSAnZm9yIChsZXQgeCA9IGkgaW4g
byknIGJlY29tZXMgJ2k7IGZvciAobGV0IHggaW4gbyknIHVzaW5nCi0gICAgICAgICAqIGEgVE9L
X1NFUSBub2RlIHRvIG1ha2UgdGhlIHR3byBzdGF0ZW1lbnRzIGFwcGVhciBhcyBvbmUuIFRoZXJl
Zm9yZQotICAgICAgICAgKiBpZiB0aGlzIGRlY2xhcmF0aW9uIGlzIHBhcnQgb2YgYSBmb3ItaW4g
bG9vcCBoZWFkLCB3ZSBkbyBub3QgbmVlZCB0bwotICAgICAgICAgKiBlbWl0IG9wIG9yIGFueSBz
b3VyY2Ugbm90ZS4gT3VyIGNhbGxlciwgdGhlIFRPS19GT1IvVE9LX0lOIGNhc2UgaW4KLSAgICAg
ICAgICoganNfRW1pdFRyZWUsIHdpbGwgYW5ub3RhdGUgYXBwcm9wcmlhdGVseS4KLSAgICAgICAg
ICovCi0gICAgICAgIEpTX0FTU0VSVF9JRihwbjItPnBuX2RlZm4sIHBuMyA9PSBwbjItPnBuX2V4
cHIpOwotICAgICAgICBpZiAoZm9ySW5WYXIpIHsKLSAgICAgICAgICAgIEpTX0FTU0VSVChwbi0+
cG5fY291bnQgPT0gMSk7Ci0gICAgICAgICAgICBKU19BU1NFUlQoIXBuMyk7Ci0gICAgICAgICAg
ICBicmVhazsKLSAgICAgICAgfQotCiAgICAgICAgIGlmIChmaXJzdCAmJgogICAgICAgICAgICAg
IWluTGV0SGVhZCAmJgogICAgICAgICAgICAganNfTmV3U3JjTm90ZTIoY3gsIGNnLCBTUkNfREVD
TCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIChwbi0+cG5fb3AgPT0gSlNPUF9ERUZDT05T
VCkKICAgICAgICAgICAgICAgICAgICAgICAgICAgID8gU1JDX0RFQ0xfQ09OU1QKICAgICAgICAg
ICAgICAgICAgICAgICAgICAgIDogKHBuLT5wbl9vcCA9PSBKU09QX0RFRlZBUikKICAgICAgICAg
ICAgICAgICAgICAgICAgICAgID8gU1JDX0RFQ0xfVkFSCiAgICAgICAgICAgICAgICAgICAgICAg
ICAgICA6IFNSQ19ERUNMX0xFVCkgPCAwKSB7CkBAIC00NDQwLDE3ICs0Mzg0LDE3IEBAIEpTUGFy
c2VOb2RlOjpnZXRDb25zdGFudFZhbHVlKEpTQ29udGV4dCAKICAgICAgICAgICAgIHZwLT5zZXRC
b29sZWFuKHRydWUpOwogICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgICAgZGVmYXVs
dDoKICAgICAgICAgICAgIEpTX05PVF9SRUFDSEVEKCJVbmV4cGVjdGVkIG5vZGUiKTsKICAgICAg
ICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICAgfQogICAgICAgY2FzZSBUT0tfUkI6IHsKICAg
ICAgICAgSlNfQVNTRVJUKChwbl9vcCA9PSBKU09QX05FV0lOSVQpICYmICEocG5feGZsYWdzICYg
UE5YX05PTkNPTlNUKSk7Ci0gCisKICAgICAgICAgSlNPYmplY3QgKm9iaiA9IE5ld0RlbnNlQWxs
b2NhdGVkQXJyYXkoY3gsIHBuX2NvdW50KTsKICAgICAgICAgaWYgKCFvYmogfHwgIW9iai0+ZW5z
dXJlU2xvdHMoY3gsIHBuX2NvdW50KSkKICAgICAgICAgICAgIHJldHVybiBmYWxzZTsKIAogICAg
ICAgICB1bnNpZ25lZCBpZHggPSAwOwogICAgICAgICBmb3IgKEpTUGFyc2VOb2RlICpwbiA9IHBu
X2hlYWQ7IHBuOyBpZHgrKywgcG4gPSBwbi0+cG5fbmV4dCkgewogICAgICAgICAgICAgVmFsdWUg
dmFsdWU7CiAgICAgICAgICAgICBpZiAoIXBuLT5nZXRDb25zdGFudFZhbHVlKGN4LCBzdHJpY3RD
aGVja3MsICZ2YWx1ZSkpCkBAIC00NTE3LDI1ICs0NDYxLDIyMyBAQCBFbWl0U2luZ2xldG9uSW5p
dGlhbGlzZXIoSlNDb250ZXh0ICpjeCwgCiAgICAgSlNfQVNTRVJUKHZhbHVlLmlzT2JqZWN0KCkp
OwogICAgIEpTT2JqZWN0Qm94ICpvYmpib3ggPSBjZy0+cGFyc2VyLT5uZXdPYmplY3RCb3goJnZh
bHVlLnRvT2JqZWN0KCkpOwogICAgIGlmICghb2JqYm94KQogICAgICAgICByZXR1cm4gZmFsc2U7
CiAKICAgICByZXR1cm4gRW1pdE9iamVjdE9wKGN4LCBvYmpib3gsIEpTT1BfT0JKRUNULCBjZyk7
CiB9CiAKK3N0YXRpYyBib29sCitFbWl0QXNzaWdubWVudChKU0NvbnRleHQgKmN4LCBKU0NvZGVH
ZW5lcmF0b3IgKmNnLCBKU1BhcnNlTm9kZSAqcG4pCit7CisgICAgcHRyZGlmZl90IHRvcCA9IENH
X09GRlNFVChjZyk7CisgICAgaW50TiBiYXNlU3RhY2tEZXB0aCA9IGNnLT5zdGFja0RlcHRoOwor
CisgICAgLyoKKyAgICAgKiBDaGVjayBsZWZ0IG9wZXJhbmQgdHlwZSBhbmQgZ2VuZXJhdGUgc3Bl
Y2lhbGl6ZWQgY29kZSBmb3IgaXQuCisgICAgICogU3BlY2lhbGl6ZSB0byBhdm9pZCBFQ01BICJy
ZWZlcmVuY2UgdHlwZSIgdmFsdWVzIG9uIHRoZSBvcGVyYW5kCisgICAgICogc3RhY2ssIHdoaWNo
IGltcG9zZSBwZXJ2YXNpdmUgcnVudGltZSAiR2V0VmFsdWUiIGNvc3RzLgorICAgICAqLworICAg
IEpTUGFyc2VOb2RlICpwbjIgPSBwbi0+cG5fbGVmdDsKKyAgICBKU19BU1NFUlQoIVRva2VuS2lu
ZElzRGVjbChQTl9UWVBFKHBuMikpKTsKKworICAgIGpzYXRvbWlkIGF0b21JbmRleCA9IChqc2F0
b21pZCkgLTE7ICAgICAgICAgICAgIC8qIHF1ZWxsIEdDQyBvdmVyd2FybmluZyAqLworICAgIHN3
aXRjaCAoUE5fVFlQRShwbjIpKSB7CisgICAgICBjYXNlIFRPS19OQU1FOgorICAgICAgICBpZiAo
IUJpbmROYW1lVG9TbG90KGN4LCBjZywgcG4yKSkKKyAgICAgICAgICAgIHJldHVybiBKU19GQUxT
RTsKKyAgICAgICAgaWYgKCFwbjItPnBuX2Nvb2tpZS5pc0ZyZWUoKSkgeworICAgICAgICAgICAg
YXRvbUluZGV4ID0gKGpzYXRvbWlkKSBwbjItPnBuX2Nvb2tpZS5hc0ludGVnZXIoKTsKKyAgICAg
ICAgfSBlbHNlIHsKKyAgICAgICAgICAgIEpTQXRvbUxpc3RFbGVtZW50ICphbGUgPSBjZy0+YXRv
bUxpc3QuYWRkKGNnLT5wYXJzZXIsIHBuMi0+cG5fYXRvbSk7CisgICAgICAgICAgICBpZiAoIWFs
ZSkKKyAgICAgICAgICAgICAgICByZXR1cm4gSlNfRkFMU0U7CisgICAgICAgICAgICBhdG9tSW5k
ZXggPSBBTEVfSU5ERVgoYWxlKTsKKyAgICAgICAgICAgIGlmICghcG4yLT5pc0NvbnN0KCkpIHsK
KyAgICAgICAgICAgICAgICBKU09wIG9wID0gUE5fT1AocG4yKSA9PSBKU09QX1NFVEdOQU1FID8g
SlNPUF9CSU5ER05BTUUgOiBKU09QX0JJTkROQU1FOworICAgICAgICAgICAgICAgIEVNSVRfSU5E
RVhfT1Aob3AsIGF0b21JbmRleCk7CisgICAgICAgICAgICB9CisgICAgICAgIH0KKyAgICAgICAg
YnJlYWs7CisgICAgICBjYXNlIFRPS19ET1Q6IHsKKyAgICAgICAgaWYgKCFqc19FbWl0VHJlZShj
eCwgY2csIHBuMi0+ZXhwcigpKSkKKyAgICAgICAgICAgIHJldHVybiBKU19GQUxTRTsKKyAgICAg
ICAgSlNBdG9tTGlzdEVsZW1lbnQgKmFsZSA9IGNnLT5hdG9tTGlzdC5hZGQoY2ctPnBhcnNlciwg
cG4yLT5wbl9hdG9tKTsKKyAgICAgICAgaWYgKCFhbGUpCisgICAgICAgICAgICByZXR1cm4gSlNf
RkFMU0U7CisgICAgICAgIGF0b21JbmRleCA9IEFMRV9JTkRFWChhbGUpOworICAgICAgICBicmVh
azsKKyAgICAgIH0KKyAgICAgIGNhc2UgVE9LX0xCOgorICAgICAgICBKU19BU1NFUlQocG4yLT5w
bl9hcml0eSA9PSBQTl9CSU5BUlkpOworICAgICAgICBpZiAoIWpzX0VtaXRUcmVlKGN4LCBjZywg
cG4yLT5wbl9sZWZ0KSkKKyAgICAgICAgICAgIHJldHVybiBKU19GQUxTRTsKKyAgICAgICAgaWYg
KCFqc19FbWl0VHJlZShjeCwgY2csIHBuMi0+cG5fcmlnaHQpKQorICAgICAgICAgICAgcmV0dXJu
IEpTX0ZBTFNFOworICAgICAgICBicmVhazsKKyNpZiBKU19IQVNfREVTVFJVQ1RVUklORworICAg
ICAgY2FzZSBUT0tfUkI6CisgICAgICBjYXNlIFRPS19SQzoKKyAgICAgICAgYnJlYWs7CisjZW5k
aWYKKyAgICAgIGNhc2UgVE9LX0xQOgorICAgICAgICBpZiAoIWpzX0VtaXRUcmVlKGN4LCBjZywg
cG4yKSkKKyAgICAgICAgICAgIHJldHVybiBKU19GQUxTRTsKKyAgICAgICAgYnJlYWs7CisjaWYg
SlNfSEFTX1hNTF9TVVBQT1JUCisgICAgICBjYXNlIFRPS19VTkFSWU9QOgorICAgICAgICBKU19B
U1NFUlQocG4yLT5wbl9vcCA9PSBKU09QX1NFVFhNTE5BTUUpOworICAgICAgICBpZiAoIWpzX0Vt
aXRUcmVlKGN4LCBjZywgcG4yLT5wbl9raWQpKQorICAgICAgICAgICAgcmV0dXJuIEpTX0ZBTFNF
OworICAgICAgICBpZiAoanNfRW1pdDEoY3gsIGNnLCBKU09QX0JJTkRYTUxOQU1FKSA8IDApCisg
ICAgICAgICAgICByZXR1cm4gSlNfRkFMU0U7CisgICAgICAgIGJyZWFrOworI2VuZGlmCisgICAg
ICBkZWZhdWx0OgorICAgICAgICBKU19BU1NFUlQoMCk7CisgICAgfQorCisgICAgSlNPcCBvcCA9
IFBOX09QKHBuKTsKKyAgICBKU19BU1NFUlRfSUYocG4tPnBuX3R5cGUgPT0gVE9LX0lOLCBvcCA9
PSBKU09QX05PUCk7CisgICAgaWYgKG9wICE9IEpTT1BfTk9QKSB7CisgICAgICAgIHN3aXRjaCAo
cG4yLT5wbl90eXBlKSB7CisgICAgICAgICAgY2FzZSBUT0tfTkFNRToKKyAgICAgICAgICAgIGlm
IChwbjItPmlzQ29uc3QoKSkgeworICAgICAgICAgICAgICAgIGlmIChQTl9PUChwbjIpID09IEpT
T1BfQ0FMTEVFKSB7CisgICAgICAgICAgICAgICAgICAgIGlmIChqc19FbWl0MShjeCwgY2csIEpT
T1BfQ0FMTEVFKSA8IDApCisgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gSlNfRkFMU0U7
CisgICAgICAgICAgICAgICAgfSBlbHNlIHsKKyAgICAgICAgICAgICAgICAgICAgRU1JVF9JTkRF
WF9PUChQTl9PUChwbjIpLCBhdG9tSW5kZXgpOworICAgICAgICAgICAgICAgIH0KKyAgICAgICAg
ICAgIH0gZWxzZSBpZiAoUE5fT1AocG4yKSA9PSBKU09QX1NFVE5BTUUpIHsKKyAgICAgICAgICAg
ICAgICBpZiAoanNfRW1pdDEoY3gsIGNnLCBKU09QX0RVUCkgPCAwKQorICAgICAgICAgICAgICAg
ICAgICByZXR1cm4gSlNfRkFMU0U7CisgICAgICAgICAgICAgICAgRU1JVF9JTkRFWF9PUChKU09Q
X0dFVFhQUk9QLCBhdG9tSW5kZXgpOworICAgICAgICAgICAgfSBlbHNlIGlmIChQTl9PUChwbjIp
ID09IEpTT1BfU0VUR05BTUUpIHsKKyAgICAgICAgICAgICAgICBpZiAoIUJpbmRHbG9iYWwoY3gs
IGNnLCBwbjIsIHBuMi0+cG5fYXRvbSkpCisgICAgICAgICAgICAgICAgICAgIHJldHVybiBKU19G
QUxTRTsKKyAgICAgICAgICAgICAgICBpZiAocG4yLT5wbl9jb29raWUuaXNGcmVlKCkpCisgICAg
ICAgICAgICAgICAgICAgIEVtaXRBdG9tT3AoY3gsIHBuMiwgSlNPUF9HRVRHTkFNRSwgY2cpOwor
ICAgICAgICAgICAgICAgIGVsc2UKKyAgICAgICAgICAgICAgICAgICAgRU1JVF9VSU5UMTZfSU1N
X09QKEpTT1BfR0VUR0xPQkFMLCBwbjItPnBuX2Nvb2tpZS5hc0ludGVnZXIoKSk7CisgICAgICAg
ICAgICB9IGVsc2UgeworICAgICAgICAgICAgICAgIEVNSVRfVUlOVDE2X0lNTV9PUCgoUE5fT1Ao
cG4yKSA9PSBKU09QX1NFVEFSRykKKyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
PyBKU09QX0dFVEFSRworICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA6IEpTT1Bf
R0VUTE9DQUwsCisgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGF0b21JbmRleCk7
CisgICAgICAgICAgICB9CisgICAgICAgICAgICBicmVhazsKKyAgICAgICAgICBjYXNlIFRPS19E
T1Q6CisgICAgICAgICAgICBpZiAoanNfRW1pdDEoY3gsIGNnLCBKU09QX0RVUCkgPCAwKQorICAg
ICAgICAgICAgICAgIHJldHVybiBKU19GQUxTRTsKKyAgICAgICAgICAgIGlmIChwbjItPnBuX2F0
b20gPT0gY3gtPnJ1bnRpbWUtPmF0b21TdGF0ZS5sZW5ndGhBdG9tKSB7CisgICAgICAgICAgICAg
ICAgaWYgKGpzX0VtaXQxKGN4LCBjZywgSlNPUF9MRU5HVEgpIDwgMCkKKyAgICAgICAgICAgICAg
ICAgICAgcmV0dXJuIEpTX0ZBTFNFOworICAgICAgICAgICAgfSBlbHNlIGlmIChwbjItPnBuX2F0
b20gPT0gY3gtPnJ1bnRpbWUtPmF0b21TdGF0ZS5wcm90b0F0b20pIHsKKyAgICAgICAgICAgICAg
ICBpZiAoIUVtaXRJbmRleE9wKGN4LCBKU09QX1FOQU1FUEFSVCwgYXRvbUluZGV4LCBjZykpCisg
ICAgICAgICAgICAgICAgICAgIHJldHVybiBKU19GQUxTRTsKKyAgICAgICAgICAgICAgICBpZiAo
anNfRW1pdDEoY3gsIGNnLCBKU09QX0dFVEVMRU0pIDwgMCkKKyAgICAgICAgICAgICAgICAgICAg
cmV0dXJuIEpTX0ZBTFNFOworICAgICAgICAgICAgfSBlbHNlIHsKKyAgICAgICAgICAgICAgICBF
TUlUX0lOREVYX09QKEpTT1BfR0VUUFJPUCwgYXRvbUluZGV4KTsKKyAgICAgICAgICAgIH0KKyAg
ICAgICAgICAgIGJyZWFrOworICAgICAgICAgIGNhc2UgVE9LX0xCOgorICAgICAgICAgIGNhc2Ug
VE9LX0xQOgorI2lmIEpTX0hBU19YTUxfU1VQUE9SVAorICAgICAgICAgIGNhc2UgVE9LX1VOQVJZ
T1A6CisjZW5kaWYKKyAgICAgICAgICAgIGlmIChqc19FbWl0MShjeCwgY2csIEpTT1BfRFVQMikg
PCAwKQorICAgICAgICAgICAgICAgIHJldHVybiBKU19GQUxTRTsKKyAgICAgICAgICAgIGlmIChq
c19FbWl0MShjeCwgY2csIEpTT1BfR0VURUxFTSkgPCAwKQorICAgICAgICAgICAgICAgIHJldHVy
biBKU19GQUxTRTsKKyAgICAgICAgICAgIGJyZWFrOworICAgICAgICAgIGRlZmF1bHQ6OworICAg
ICAgICB9CisgICAgfQorCisgICAgLyogTm93IGVtaXQgdGhlIHJpZ2h0IG9wZXJhbmQgKGl0IG1h
eSBhZmZlY3QgdGhlIG5hbWVzcGFjZSkuICovCisgICAgaWYgKHBuLT5wbl90eXBlID09IFRPS19B
U1NJR04pIHsKKyAgICAgICAgaWYgKCFqc19FbWl0VHJlZShjeCwgY2csIHBuLT5wbl9yaWdodCkp
CisgICAgICAgICAgICByZXR1cm4gSlNfRkFMU0U7CisgICAgfSBlbHNlIHsKKyAgICAgICAgSlNf
QVNTRVJUKHBuLT5wbl90eXBlID09IFRPS19JTik7CisgICAgICAgIEpTX0FTU0VSVChjZy0+c3Rh
Y2tEZXB0aCAtIGJhc2VTdGFja0RlcHRoIDwgMjU2KTsKKyAgICAgICAgaWYgKGpzX0VtaXQyKGN4
LCBjZywgSlNPUF9ORVhULCBjZy0+c3RhY2tEZXB0aCArIDEgLSBiYXNlU3RhY2tEZXB0aCkgPCAw
KQorICAgICAgICAgICAgcmV0dXJuIEpTX0ZBTFNFOworICAgIH0KKworICAgIC8qIElmICs9IGV0
Yy4sIGVtaXQgdGhlIGJpbmFyeSBvcGVyYXRvciB3aXRoIGEgZGVjb21waWxlciBub3RlLiAqLwor
ICAgIGlmIChvcCAhPSBKU09QX05PUCkgeworICAgICAgICAvKgorICAgICAgICAgKiBUYWtlIGNh
cmUgdG8gYXZvaWQgU1JDX0FTU0lHTk9QIGlmIHRoZSBsZWZ0LWhhbmQgc2lkZSBpcyBhIGNvbnN0
CisgICAgICAgICAqIGRlY2xhcmVkIGluIHRoZSBjdXJyZW50IGNvbXBpbGF0aW9uIHVuaXQsIGFz
IGluIHRoaXMgY2FzZSAoanVzdAorICAgICAgICAgKiBhIGJpdCBmdXJ0aGVyIGJlbG93KSB3ZSB3
aWxsIGF2b2lkIGVtaXR0aW5nIHRoZSBhc3NpZ25tZW50IG9wLgorICAgICAgICAgKi8KKyAgICAg
ICAgaWYgKHBuMi0+cG5fdHlwZSAhPSBUT0tfTkFNRSB8fCAhcG4yLT5pc0NvbnN0KCkpIHsKKyAg
ICAgICAgICAgIGlmIChqc19OZXdTcmNOb3RlKGN4LCBjZywgU1JDX0FTU0lHTk9QKSA8IDApCisg
ICAgICAgICAgICAgICAgcmV0dXJuIEpTX0ZBTFNFOworICAgICAgICB9CisgICAgICAgIGlmIChq
c19FbWl0MShjeCwgY2csIG9wKSA8IDApCisgICAgICAgICAgICByZXR1cm4gSlNfRkFMU0U7Cisg
ICAgfQorCisgICAgLyogTGVmdCBwYXJ0cyBzdWNoIGFzIGEuYi5jIGFuZCBhW2JdLmMgbmVlZCBh
IGRlY29tcGlsZXIgbm90ZS4gKi8KKyAgICBpZiAocG4yLT5wbl90eXBlICE9IFRPS19OQU1FICYm
CisjaWYgSlNfSEFTX0RFU1RSVUNUVVJJTkcKKyAgICAgICAgcG4yLT5wbl90eXBlICE9IFRPS19S
QiAmJgorICAgICAgICBwbjItPnBuX3R5cGUgIT0gVE9LX1JDICYmCisjZW5kaWYKKyAgICAgICAg
anNfTmV3U3JjTm90ZTIoY3gsIGNnLCBTUkNfUENCQVNFLCBDR19PRkZTRVQoY2cpIC0gdG9wKSA8
IDApIHsKKyAgICAgICAgcmV0dXJuIEpTX0ZBTFNFOworICAgIH0KKworICAgIC8qIEZpbmFsbHks
IGVtaXQgdGhlIHNwZWNpYWxpemVkIGFzc2lnbm1lbnQgYnl0ZWNvZGUuICovCisgICAgc3dpdGNo
IChwbjItPnBuX3R5cGUpIHsKKyAgICAgIGNhc2UgVE9LX05BTUU6CisgICAgICAgIGlmIChwbjIt
PmlzQ29uc3QoKSkKKyAgICAgICAgICAgIGJyZWFrOworICAgICAgICAvKiBGQUxMIFRIUk9VR0gg
Ki8KKyAgICAgIGNhc2UgVE9LX0RPVDoKKyAgICAgICAgRU1JVF9JTkRFWF9PUChQTl9PUChwbjIp
LCBhdG9tSW5kZXgpOworICAgICAgICBicmVhazsKKyAgICAgIGNhc2UgVE9LX0xCOgorICAgICAg
Y2FzZSBUT0tfTFA6CisgICAgICAgIGlmIChqc19FbWl0MShjeCwgY2csIEpTT1BfU0VURUxFTSkg
PCAwKQorICAgICAgICAgICAgcmV0dXJuIEpTX0ZBTFNFOworICAgICAgICBicmVhazsKKyNpZiBK
U19IQVNfREVTVFJVQ1RVUklORworICAgICAgY2FzZSBUT0tfUkI6CisgICAgICBjYXNlIFRPS19S
QzoKKyAgICAgICAgaWYgKCFFbWl0RGVzdHJ1Y3R1cmluZ09wcyhjeCwgY2csIEpTT1BfU0VUTkFN
RSwgcG4yKSkKKyAgICAgICAgICAgIHJldHVybiBKU19GQUxTRTsKKyAgICAgICAgYnJlYWs7Cisj
ZW5kaWYKKyNpZiBKU19IQVNfWE1MX1NVUFBPUlQKKyAgICAgIGNhc2UgVE9LX1VOQVJZT1A6Cisg
ICAgICAgIGlmIChqc19FbWl0MShjeCwgY2csIEpTT1BfU0VUWE1MTkFNRSkgPCAwKQorICAgICAg
ICAgICAgcmV0dXJuIEpTX0ZBTFNFOworICAgICAgICBicmVhazsKKyNlbmRpZgorICAgICAgZGVm
YXVsdDoKKyAgICAgICAgSlNfQVNTRVJUKDApOworICAgIH0KKyAgICByZXR1cm4gdHJ1ZTsKK30K
KwogLyogU2VlIHRoZSBTUkNfRk9SIHNvdXJjZSBub3RlIG9mZnNldEJpYXMgY29tbWVudHMgbGF0
ZXIgaW4gdGhpcyBmaWxlLiAqLwogSlNfU1RBVElDX0FTU0VSVChKU09QX05PUF9MRU5HVEggPT0g
MSk7CiBKU19TVEFUSUNfQVNTRVJUKEpTT1BfUE9QX0xFTkdUSCA9PSAxKTsKIAogY2xhc3MgRW1p
dExldmVsTWFuYWdlcgogewogcHJpdmF0ZToKICAgICBKU0NvZGVHZW5lcmF0b3IgKmNnOwotICAg
IAorCiBwdWJsaWM6CiAgICAgRW1pdExldmVsTWFuYWdlcihKU0NvZGVHZW5lcmF0b3IgKmNnKSA6
IGNnKGNnKSB7IGNnLT5lbWl0TGV2ZWwrKzsgfQogCiAgICAgfkVtaXRMZXZlbE1hbmFnZXIoKSB7
IGNnLT5lbWl0TGV2ZWwtLTsgfQogfTsKIAogSlNCb29sCiBqc19FbWl0VHJlZShKU0NvbnRleHQg
KmN4LCBKU0NvZGVHZW5lcmF0b3IgKmNnLCBKU1BhcnNlTm9kZSAqcG4pCkBAIC00OTM2LDQ2ICs1
MDc4LDUzIEBAIGpzX0VtaXRUcmVlKEpTQ29udGV4dCAqY3gsIEpTQ29kZUdlbmVyYXQKICAgICAg
ICAgcG4yID0gcG4tPnBuX2xlZnQ7CiAgICAgICAgIGpzX1B1c2hTdGF0ZW1lbnQoY2csICZzdG10
SW5mbywgU1RNVF9GT1JfTE9PUCwgdG9wKTsKIAogICAgICAgICBpZiAocG4yLT5wbl90eXBlID09
IFRPS19JTikgewogICAgICAgICAgICAgLyogU2V0IHN0bXRJbmZvIHR5cGUgZm9yIGxhdGVyIHRl
c3RpbmcuICovCiAgICAgICAgICAgICBzdG10SW5mby50eXBlID0gU1RNVF9GT1JfSU5fTE9PUDsK
IAogICAgICAgICAgICAgLyoKLSAgICAgICAgICAgICAqIElmIHRoZSBsZWZ0IHBhcnQgaXMgJ3Zh
ciB4JywgZW1pdCBjb2RlIHRvIGRlZmluZSB4IGlmIG5lY2Vzc2FyeQotICAgICAgICAgICAgICog
dXNpbmcgYSBwcm9sb2cgb3Bjb2RlLCBidXQgZG8gbm90IGVtaXQgYSBwb3AuICBJZiB0aGUgbGVm
dCBwYXJ0Ci0gICAgICAgICAgICAgKiBpcyAndmFyIHggPSBpJywgZW1pdCBwcm9sb2cgY29kZSB0
byBkZWZpbmUgeCBpZiBuZWNlc3Nhcnk7IHRoZW4KLSAgICAgICAgICAgICAqIGVtaXQgY29kZSB0
byBldmFsdWF0ZSBpLCBhc3NpZ24gdGhlIHJlc3VsdCB0byB4LCBhbmQgcG9wIHRoZQotICAgICAg
ICAgICAgICogcmVzdWx0IG9mZiB0aGUgc3RhY2suCisgICAgICAgICAgICAgKiBUaGUgZm9yLWlu
IGxvb3A6CisgICAgICAgICAgICAgKiAgICAgZm9yIChMSFMgaW4gT0JKKQorICAgICAgICAgICAg
ICogICAgICAgICBTOwogICAgICAgICAgICAgICoKLSAgICAgICAgICAgICAqIEFsbCB0aGUgbG9n
aWMgdG8gZG8gdGhpcyBpcyBpbXBsZW1lbnRlZCBpbiB0aGUgb3V0ZXIgc3dpdGNoJ3MKLSAgICAg
ICAgICAgICAqIFRPS19WQVIgY2FzZSwgY29uZGl0aW9uZWQgb24gcG5feGZsYWdzIGZsYWdzIHNl
dCBieSB0aGUgcGFyc2VyLgorICAgICAgICAgICAgICogd2hlcmUgTEhTIGlzIGVpdGhlciBhbiBl
eHByZXNzaW9uIG9yIGEgdmFyaWFibGUgZGVjbGFyYXRpb24KKyAgICAgICAgICAgICAqIHdpdGhv
dXQgYW4gaW5pdGlhbGl6ZXIsIGNvbXBpbGVzIHRvIHNvbWV0aGluZyBsaWtlIHRoaXM6CiAgICAg
ICAgICAgICAgKgotICAgICAgICAgICAgICogSW4gdGhlICdmb3IgKHZhciB4ID0gaSBpbiBvKSAu
Li4nIGNhc2UsIHRoZSBqc19FbWl0VHJlZSguLi5wbjMpCi0gICAgICAgICAgICAgKiBjYWxsZWQg
aGVyZSB3aWxsIGdlbmVyYXRlIHRoZSBwcm9wZXIgbm90ZSBmb3IgdGhlIGFzc2lnbm1lbnQKLSAg
ICAgICAgICAgICAqIG9wIHRoYXQgc2V0cyB4ID0gaSwgaG9pc3RpbmcgdGhlIGluaXRpYWxpemVk
IHZhciBkZWNsYXJhdGlvbgotICAgICAgICAgICAgICogb3V0IG9mIHRoZSBsb29wOiAndmFyIHgg
PSBpOyBmb3IgKHggaW4gbykgLi4uJy4KKyAgICAgICAgICAgICAqICAgICBsZXQgKCRpdGVyID0g
SlNPUF9JVEVSKE9CSikpIHsKKyAgICAgICAgICAgICAqICAgICAgICAgd2hpbGUgKEpTT1BfSEFT
TkVYVCgkaXRlcikpIHsKKyAgICAgICAgICAgICAqICAgICAgICAgICAgIExIUyA9IEpTT1BfTkVY
VCgkaXRlcik7CisgICAgICAgICAgICAgKiAgICAgICAgICAgICBTOworICAgICAgICAgICAgICog
ICAgICAgICB9CisgICAgICAgICAgICAgKiAgICAgICAgIEpTT1BfRU5ESVRFUigkaXRlcik7Cisg
ICAgICAgICAgICAgKiAgICAgfQogICAgICAgICAgICAgICoKLSAgICAgICAgICAgICAqIEluIHRo
ZSAnZm9yICh2YXIgeCBpbiBvKSAuLi4nIGNhc2UsIG5vdGhpbmcgYnV0IHRoZSBwcm9sb2cgb3AK
LSAgICAgICAgICAgICAqIChpZiBuZWVkZWQpIHNob3VsZCBiZSBnZW5lcmF0ZWQgaGVyZSwgd2Ug
bXVzdCBlbWl0IHRoZSBub3RlCi0gICAgICAgICAgICAgKiBqdXN0IGJlZm9yZSB0aGUgSlNPUF9G
T1IqIG9wY29kZSBpbiB0aGUgc3dpdGNoIG9uIHBuMy0+cG5fdHlwZQotICAgICAgICAgICAgICog
YSBiaXQgYmVsb3csIHNvIG5vdGhpbmcgaXMgaG9pc3RlZDogJ2ZvciAodmFyIHggaW4gbykgLi4u
Jy4KKyAgICAgICAgICAgICAqIGV4Y2VwdCB0aGF0IGlmIExIUyBpcyBhIGxldC1kZWNsYXJhdGlv
biwgaXRzIHNjb3BlIGlzIHRoZSBvdXRlcgorICAgICAgICAgICAgICogYmxvY2sgKG5vdCBpbmNs
dWRpbmcgT0JKLCBub3RlKSByYXRoZXIgdGhhbiB0aGUgaW5uZXIgYmxvY2suCiAgICAgICAgICAg
ICAgKgotICAgICAgICAgICAgICogQSAnZm9yIChsZXQgeCA9IGkgaW4gbyknIGxvb3AgbXVzdCBu
b3QgYmUgaG9pc3RlZCwgc2luY2UgaW4KLSAgICAgICAgICAgICAqIHRoaXMgZm9ybSB0aGUgbGV0
IHZhcmlhYmxlIGlzIHNjb3BlZCBieSB0aGUgbG9vcCBib2R5IChidXQgbm90Ci0gICAgICAgICAg
ICAgKiB0aGUgaGVhZCkuICBUaGUgaW5pdGlhbGl6ZXIgZXhwcmVzc2lvbiBpIG11c3QgYmUgZXZh
bHVhdGVkIGZvcgotICAgICAgICAgICAgICogYW55IHNpZGUgZWZmZWN0cy4gIFNvIHdlIGhvaXN0
IG9ubHkgaSBpbiB0aGUgbGV0IGNhc2UuCisgICAgICAgICAgICAgKiBJbiB0aGUgb2RkYmFsbCBj
YXNlIHdoZXJlIExIUyBoYXMgYW4gaW5pdGlhbGl6ZXI6CisgICAgICAgICAgICAgKiAgICAgZm9y
ICh2YXIvY29uc3QgTEhTID0gSU5JVCBpbiBPQkopCisgICAgICAgICAgICAgKiAgICAgICAgIFM7
CisgICAgICAgICAgICAgKiB3ZSBlbWl0IGNvZGUgbGlrZSB0aGlzOgorICAgICAgICAgICAgICog
ICAgIHZhci9jb25zdCBMSFMgPSBJTklUOworICAgICAgICAgICAgICogICAgIGZvciAoTEhTIGlu
IE9CSikKKyAgICAgICAgICAgICAqICAgICAgICAgUzsKKyAgICAgICAgICAgICAqCisgICAgICAg
ICAgICAgKiBmb3IgKGxldCB4ID0gaSBpbiBPQkopIGlzIG1lcmNpZnVsbHkgYmFubmVkLgogICAg
ICAgICAgICAgICovCiAgICAgICAgICAgICBwbjMgPSBwbjItPnBuX2xlZnQ7CiAgICAgICAgICAg
ICB0eXBlID0gUE5fVFlQRShwbjMpOwotICAgICAgICAgICAgY2ctPmZsYWdzIHw9IFRDRl9JTl9G
T1JfSU5JVDsKLSAgICAgICAgICAgIGlmIChUb2tlbktpbmRJc0RlY2wodHlwZSkgJiYgIWpzX0Vt
aXRUcmVlKGN4LCBjZywgcG4zKSkKLSAgICAgICAgICAgICAgICByZXR1cm4gSlNfRkFMU0U7Ci0g
ICAgICAgICAgICBjZy0+ZmxhZ3MgJj0gflRDRl9JTl9GT1JfSU5JVDsKKyAgICAgICAgICAgIGlm
IChUb2tlbktpbmRJc0RlY2wodHlwZSkpIHsKKyAgICAgICAgICAgICAgICBjZy0+ZmxhZ3MgfD0g
VENGX0lOX0ZPUl9JTklUOworICAgICAgICAgICAgICAgIHB0cmRpZmZfdCBub3RlSW5kZXgzOwor
ICAgICAgICAgICAgICAgIGlmICghRW1pdFZhcmlhYmxlcyhjeCwgY2csIHBuMi0+cG5fbGVmdCwg
dHJ1ZSwgZmFsc2UsICZub3RlSW5kZXgzKSkKKyAgICAgICAgICAgICAgICAgICAgcmV0dXJuIEpT
X0ZBTFNFOworICAgICAgICAgICAgICAgIGNnLT5mbGFncyAmPSB+VENGX0lOX0ZPUl9JTklUOwor
ICAgICAgICAgICAgfQogCiAgICAgICAgICAgICAvKiBDb21waWxlIHRoZSBvYmplY3QgZXhwcmVz
c2lvbiB0byB0aGUgcmlnaHQgb2YgJ2luJy4gKi8KICAgICAgICAgICAgIGlmICghanNfRW1pdFRy
ZWUoY3gsIGNnLCBwbjItPnBuX3JpZ2h0KSkKICAgICAgICAgICAgICAgICByZXR1cm4gSlNfRkFM
U0U7CiAKICAgICAgICAgICAgIC8qCiAgICAgICAgICAgICAgKiBFbWl0IGEgYnl0ZWNvZGUgdG8g
Y29udmVydCB0b3Agb2Ygc3RhY2sgdmFsdWUgdG8gdGhlIGl0ZXJhdG9yCiAgICAgICAgICAgICAg
KiBvYmplY3QgZGVwZW5kaW5nIG9uIHRoZSBsb29wIHZhcmlhbnQgKGZvci1pbiwgZm9yLWVhY2gt
aW4sIG9yCkBAIC00OTk2LDE5MiArNTE0NSw2MCBAQCBqc19FbWl0VHJlZShKU0NvbnRleHQgKmN4
LCBKU0NvZGVHZW5lcmF0CiAgICAgICAgICAgICAgKi8KICAgICAgICAgICAgIGptcCA9IEVtaXRK
dW1wKGN4LCBjZywgSlNPUF9HT1RPLCAwKTsKICAgICAgICAgICAgIGlmIChqbXAgPCAwKQogICAg
ICAgICAgICAgICAgIHJldHVybiBKU19GQUxTRTsKIAogICAgICAgICAgICAgbm90ZUluZGV4MiA9
IGpzX05ld1NyY05vdGUoY3gsIGNnLCBTUkNfVFJBQ0UpOwogICAgICAgICAgICAgaWYgKG5vdGVJ
bmRleDIgPCAwKQogICAgICAgICAgICAgICAgIHJldHVybiBKU19GQUxTRTsKLSAgICAgICAgICAg
IAorCiAgICAgICAgICAgICB0b3AgPSBDR19PRkZTRVQoY2cpOwogICAgICAgICAgICAgU0VUX1NU
QVRFTUVOVF9UT1AoJnN0bXRJbmZvLCB0b3ApOwogICAgICAgICAgICAgaWYgKEVtaXRUcmFjZU9w
KGN4LCBjZykgPCAwKQogICAgICAgICAgICAgICAgIHJldHVybiBKU19GQUxTRTsKIAogI2lmZGVm
IERFQlVHCiAgICAgICAgICAgICBpbnROIGxvb3BEZXB0aCA9IGNnLT5zdGFja0RlcHRoOwogI2Vu
ZGlmCiAKICAgICAgICAgICAgIC8qCi0gICAgICAgICAgICAgKiBDb21waWxlIGEgSlNPUF9GT1Iq
IGJ5dGVjb2RlIGJhc2VkIG9uIHRoZSBsZWZ0IGhhbmQgc2lkZS4KLSAgICAgICAgICAgICAqCi0g
ICAgICAgICAgICAgKiBJbml0aWFsaXplIG9wIHRvIEpTT1BfU0VUTkFNRSBpbiBjYXNlIG9mIHxm
b3IgKFthLCBiXSBpbiBvKS4uLnwKLSAgICAgICAgICAgICAqIG9yIHNpbWlsYXIsIHRvIHNpZ25p
ZnkgYXNzaWdubWVudCwgcmF0aGVyIHRoYW4gZGVjbGFyYXRpb24sIHRvCi0gICAgICAgICAgICAg
KiB0aGUgZGVjb21waWxlci4gIEVtaXREZXN0cnVjdHVyaW5nT3BzIHRha2VzIGEgcHJvbG9nIGJ5
dGVjb2RlCi0gICAgICAgICAgICAgKiBwYXJhbWV0ZXIgYW5kIGVtaXRzIHRoZSBhcHByb3ByaWF0
ZSBzb3VyY2Ugbm90ZSwgZGVmYXVsdGluZyB0bwotICAgICAgICAgICAgICogYXNzaWdubWVudCwg
c28gSlNPUF9TRVROQU1FIGlzIG5vdCBjcml0aWNhbCBoZXJlOyBtYW55IHNpbWlsYXIKLSAgICAg
ICAgICAgICAqIG9wcyBjb3VsZCBiZSB1c2VkIC0tIGp1c3Qgbm90IEpTT1BfTk9QICh3aGljaCBt
ZWFucyAnbGV0JykuCisgICAgICAgICAgICAgKiBBc3NpZ24gdGhlIG5leHQgdmFsdWUgdG8gcG4y
LT5wbl9sZWZ0LiBCb3RoIEVtaXRWYXJpYWJsZXMgYW5kCisgICAgICAgICAgICAgKiBqc19FbWl0
VHJlZSBUT0tfSU4gc3BlY2lhbGx5IGVtaXQgSlNPUF9ORVhUIGZvciB0aGUKKyAgICAgICAgICAg
ICAqIHJpZ2h0LWhhbmQgc2lkZSB3aGVuIGVtaXR0aW5nIGEgZm9yLWxvb3AgaGVhZC4KICAgICAg
ICAgICAgICAqLwotICAgICAgICAgICAgb3AgPSBKU09QX1NFVE5BTUU7Ci0gICAgICAgICAgICBz
d2l0Y2ggKHR5cGUpIHsKLSNpZiBKU19IQVNfQkxPQ0tfU0NPUEUKLSAgICAgICAgICAgICAgY2Fz
ZSBUT0tfTEVUOgotI2VuZGlmCi0gICAgICAgICAgICAgIGNhc2UgVE9LX1ZBUjoKLSAgICAgICAg
ICAgICAgICBKU19BU1NFUlQocG4zLT5wbl9hcml0eSA9PSBQTl9MSVNUICYmIHBuMy0+cG5fY291
bnQgPT0gMSk7Ci0gICAgICAgICAgICAgICAgcG4zID0gcG4zLT5wbl9oZWFkOwotI2lmIEpTX0hB
U19ERVNUUlVDVFVSSU5HCi0gICAgICAgICAgICAgICAgaWYgKHBuMy0+cG5fdHlwZSA9PSBUT0tf
QVNTSUdOKSB7Ci0gICAgICAgICAgICAgICAgICAgIHBuMyA9IHBuMy0+cG5fbGVmdDsKLSAgICAg
ICAgICAgICAgICAgICAgSlNfQVNTRVJUKHBuMy0+cG5fdHlwZSA9PSBUT0tfUkIgfHwgcG4zLT5w
bl90eXBlID09IFRPS19SQyk7Ci0gICAgICAgICAgICAgICAgfQotICAgICAgICAgICAgICAgIGlm
IChwbjMtPnBuX3R5cGUgPT0gVE9LX1JCIHx8IHBuMy0+cG5fdHlwZSA9PSBUT0tfUkMpIHsKLSAg
ICAgICAgICAgICAgICAgICAgb3AgPSBQTl9PUChwbjItPnBuX2xlZnQpOwotICAgICAgICAgICAg
ICAgICAgICBnb3RvIGRlc3RydWN0dXJpbmdfZm9yOwotICAgICAgICAgICAgICAgIH0KLSNlbHNl
Ci0gICAgICAgICAgICAgICAgSlNfQVNTRVJUKHBuMy0+cG5fdHlwZSA9PSBUT0tfTkFNRSk7Ci0j
ZW5kaWYKLSAgICAgICAgICAgICAgICAvKiBGQUxMIFRIUk9VR0ggKi8KLQotICAgICAgICAgICAg
ICBjYXNlIFRPS19OQU1FOgotICAgICAgICAgICAgICB7Ci0gICAgICAgICAgICAgICAgLyoKLSAg
ICAgICAgICAgICAgICAgKiBBbHdheXMgYW5ub3RhdGUgSlNPUF9GT1JMT0NBTCBpZiBnaXZlbiBp
bnB1dCBvZiB0aGUgZm9ybQotICAgICAgICAgICAgICAgICAqICdmb3IgKGxldCB4IGluICogbykn
IC0tIHRoZSBkZWNvbXBpbGVyIG11c3Qgbm90IGhvaXN0IHRoZQotICAgICAgICAgICAgICAgICAq
ICdsZXQgeCcgb3V0IG9mIHRoZSBsb29wIGhlYWQsIG9yIHggd2lsbCBiZSBib3VuZCBpbiB0aGUK
LSAgICAgICAgICAgICAgICAgKiB3cm9uZyBzY29wZS4gIExpa2V3aXNlLCBidXQgaW4gdGhpcyBj
YXNlIG9ubHkgZm9yIHRoZSBzYWtlCi0gICAgICAgICAgICAgICAgICogb2YgaGlnaGVyIGRlY29t
cGlsYXRpb24gZmlkZWxpdHkgb25seSwgZG8gbm90IGhvaXN0ICd2YXIgeCcKLSAgICAgICAgICAg
ICAgICAgKiB3aGVuIGdpdmVuICdmb3IgKHZhciB4IGluIG8pJy4KLSAgICAgICAgICAgICAgICAg
Ki8KLSAgICAgICAgICAgICAgICBpZiAoKAotI2lmIEpTX0hBU19CTE9DS19TQ09QRQotICAgICAg
ICAgICAgICAgICAgICAgdHlwZSA9PSBUT0tfTEVUIHx8Ci0jZW5kaWYKLSAgICAgICAgICAgICAg
ICAgICAgICh0eXBlID09IFRPS19WQVIgJiYgIXBuMy0+bWF5YmVFeHByKCkpKSAmJgotICAgICAg
ICAgICAgICAgICAgICBqc19OZXdTcmNOb3RlMihjeCwgY2csIFNSQ19ERUNMLAotICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAodHlwZSA9PSBUT0tfVkFSKQotICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICA/IFNSQ19ERUNMX1ZBUgotICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICA6IFNSQ19ERUNMX0xFVCkgPCAwKSB7CisgICAgICAgICAgICBpZiAo
VG9rZW5LaW5kSXNEZWNsKFBOX1RZUEUocG4yLT5wbl9sZWZ0KSkpIHsKKyAgICAgICAgICAgICAg
ICBwdHJkaWZmX3Qgbm90ZTsKKyAgICAgICAgICAgICAgICBpZiAoIUVtaXRWYXJpYWJsZXMoY3gs
IGNnLCBwbjItPnBuX2xlZnQsIHRydWUsIHBuMi0+cG5fbGVmdC0+cG5fdHlwZSA9PSBUT0tfTEVU
LCAmbm90ZSkpCiAgICAgICAgICAgICAgICAgICAgIHJldHVybiBKU19GQUxTRTsKLSAgICAgICAg
ICAgICAgICB9Ci0gICAgICAgICAgICAgICAgVXB2YXJDb29raWUgY29va2llID0gcG4zLT5wbl9j
b29raWU7Ci0gICAgICAgICAgICAgICAgaWYgKCFjb29raWUuaXNGcmVlKCkpIHsKLSAgICAgICAg
ICAgICAgICAgICAgb3AgPSBQTl9PUChwbjMpOwotICAgICAgICAgICAgICAgICAgICBzd2l0Y2gg
KG9wKSB7Ci0gICAgICAgICAgICAgICAgICAgICAgY2FzZSBKU09QX0dFVEFSRzoKLSAgICAgICAg
ICAgICAgICAgICAgICBjYXNlIEpTT1BfU0VUQVJHOgotICAgICAgICAgICAgICAgICAgICAgICAg
b3AgPSBKU09QX0ZPUkFSRzsKLSAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwotICAgICAg
ICAgICAgICAgICAgICAgIGNhc2UgSlNPUF9HRVRMT0NBTDoKLSAgICAgICAgICAgICAgICAgICAg
ICBjYXNlIEpTT1BfU0VUTE9DQUw6Ci0gICAgICAgICAgICAgICAgICAgICAgICBvcCA9IEpTT1Bf
Rk9STE9DQUw7Ci0gICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKLSAgICAgICAgICAgICAg
ICAgICAgICBjYXNlIEpTT1BfR0VUR0xPQkFMOgotICAgICAgICAgICAgICAgICAgICAgICAgb3Ag
PSBKU09QX0ZPUkdOQU1FOwotICAgICAgICAgICAgICAgICAgICAgICAgY29va2llLm1ha2VGcmVl
KCk7Ci0gICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKLSAgICAgICAgICAgICAgICAgICAg
ICBkZWZhdWx0OgotICAgICAgICAgICAgICAgICAgICAgICAgSlNfTk9UX1JFQUNIRUQoInVuZXhw
ZWN0ZWQgb3Bjb2RlIik7Ci0gICAgICAgICAgICAgICAgICAgIH0KLSAgICAgICAgICAgICAgICB9
IGVsc2UgewotICAgICAgICAgICAgICAgICAgICBwbjMtPnBuX29wID0gSlNPUF9GT1JOQU1FOwot
ICAgICAgICAgICAgICAgICAgICBpZiAoIUJpbmROYW1lVG9TbG90KGN4LCBjZywgcG4zKSkKLSAg
ICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBKU19GQUxTRTsKLSAgICAgICAgICAgICAgICAg
ICAgb3AgPSBQTl9PUChwbjMpOwotICAgICAgICAgICAgICAgICAgICBjb29raWUgPSBwbjMtPnBu
X2Nvb2tpZTsKLSAgICAgICAgICAgICAgICB9Ci0gICAgICAgICAgICAgICAgaWYgKHBuMy0+aXND
b25zdCgpKSB7Ci0gICAgICAgICAgICAgICAgICAgIFJlcG9ydENvbXBpbGVFcnJvck51bWJlcihj
eCwgQ0dfVFMoY2cpLCBwbjMsIEpTUkVQT1JUX0VSUk9SLAotICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgSlNNU0dfQkFEX0ZPUl9MRUZUU0lERSk7CisgICAgICAg
ICAgICB9IGVsc2UgeworICAgICAgICAgICAgICAgIGlmICghRW1pdEFzc2lnbm1lbnQoY3gsIGNn
LCBwbjIpIHx8IGpzX0VtaXQxKGN4LCBjZywgSlNPUF9QT1ApIDwgMCkKICAgICAgICAgICAgICAg
ICAgICAgcmV0dXJuIEpTX0ZBTFNFOwotICAgICAgICAgICAgICAgIH0KLSAgICAgICAgICAgICAg
ICBpZiAoIWNvb2tpZS5pc0ZyZWUoKSkgewotICAgICAgICAgICAgICAgICAgICBhdG9tSW5kZXgg
PSAoanNhdG9taWQpIGNvb2tpZS5hc0ludGVnZXIoKTsKLSAgICAgICAgICAgICAgICAgICAgRU1J
VF9VSU5UMTZfSU1NX09QKG9wLCBhdG9tSW5kZXgpOwotICAgICAgICAgICAgICAgIH0gZWxzZSB7
Ci0gICAgICAgICAgICAgICAgICAgIGlmICghRW1pdEF0b21PcChjeCwgcG4zLCBvcCwgY2cpKQot
ICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIEpTX0ZBTFNFOwotICAgICAgICAgICAgICAg
IH0KLSAgICAgICAgICAgICAgICBicmVhazsKLSAgICAgICAgICAgICAgfQotCi0gICAgICAgICAg
ICAgIGNhc2UgVE9LX0RPVDoKLSAgICAgICAgICAgICAgICAvKgotICAgICAgICAgICAgICAgICAq
ICdmb3IgKG8ucCBpbiBxKScgY2FuIHVzZSBKU09QX0ZPUlBST1Agb25seSBpZiBldmFsdWF0aW5n
ICdvJwotICAgICAgICAgICAgICAgICAqIGhhcyBubyBzaWRlIGVmZmVjdHMuCi0gICAgICAgICAg
ICAgICAgICovCi0gICAgICAgICAgICAgICAgdXNlZnVsID0gSlNfRkFMU0U7Ci0gICAgICAgICAg
ICAgICAgaWYgKCFDaGVja1NpZGVFZmZlY3RzKGN4LCBjZywgcG4zLT5leHByKCksICZ1c2VmdWwp
KQotICAgICAgICAgICAgICAgICAgICByZXR1cm4gSlNfRkFMU0U7Ci0gICAgICAgICAgICAgICAg
aWYgKCF1c2VmdWwpIHsKLSAgICAgICAgICAgICAgICAgICAgaWYgKCFFbWl0UHJvcE9wKGN4LCBw
bjMsIEpTT1BfRk9SUFJPUCwgY2csIEpTX0ZBTFNFKSkKLSAgICAgICAgICAgICAgICAgICAgICAg
IHJldHVybiBKU19GQUxTRTsKLSAgICAgICAgICAgICAgICAgICAgYnJlYWs7Ci0gICAgICAgICAg
ICAgICAgfQotICAgICAgICAgICAgICAgIC8qIEZBTEwgVEhST1VHSCAqLwotCi0jaWYgSlNfSEFT
X0RFU1RSVUNUVVJJTkcKLSAgICAgICAgICAgICAgZGVzdHJ1Y3R1cmluZ19mb3I6Ci0jZW5kaWYK
LSAgICAgICAgICAgICAgZGVmYXVsdDoKLSAgICAgICAgICAgICAgICBpZiAoanNfRW1pdDEoY3gs
IGNnLCBKU09QX0ZPUkVMRU0pIDwgMCkKLSAgICAgICAgICAgICAgICAgICAgcmV0dXJuIEpTX0ZB
TFNFOwotICAgICAgICAgICAgICAgIEpTX0FTU0VSVChjZy0+c3RhY2tEZXB0aCA+PSAyKTsKLQot
I2lmIEpTX0hBU19ERVNUUlVDVFVSSU5HCi0gICAgICAgICAgICAgICAgaWYgKHBuMy0+cG5fdHlw
ZSA9PSBUT0tfUkIgfHwgcG4zLT5wbl90eXBlID09IFRPS19SQykgewotICAgICAgICAgICAgICAg
ICAgICBpZiAoIUVtaXREZXN0cnVjdHVyaW5nT3BzKGN4LCBjZywgb3AsIHBuMykpCi0gICAgICAg
ICAgICAgICAgICAgICAgICByZXR1cm4gSlNfRkFMU0U7Ci0gICAgICAgICAgICAgICAgICAgIGlm
IChqc19FbWl0MShjeCwgY2csIEpTT1BfUE9QKSA8IDApCi0gICAgICAgICAgICAgICAgICAgICAg
ICByZXR1cm4gSlNfRkFMU0U7Ci0gICAgICAgICAgICAgICAgfSBlbHNlCi0jZW5kaWYKLSAgICAg
ICAgICAgICAgICBpZiAocG4zLT5wbl90eXBlID09IFRPS19MUCkgewotICAgICAgICAgICAgICAg
ICAgICBKU19BU1NFUlQocG4zLT5wbl94ZmxhZ3MgJiBQTlhfU0VUQ0FMTCk7Ci0gICAgICAgICAg
ICAgICAgICAgIGlmICghanNfRW1pdFRyZWUoY3gsIGNnLCBwbjMpKQotICAgICAgICAgICAgICAg
ICAgICAgICAgcmV0dXJuIEpTX0ZBTFNFOwotICAgICAgICAgICAgICAgICAgICBpZiAoanNfRW1p
dDEoY3gsIGNnLCBKU09QX0VOVU1FTEVNKSA8IDApCi0gICAgICAgICAgICAgICAgICAgICAgICBy
ZXR1cm4gSlNfRkFMU0U7Ci0gICAgICAgICAgICAgICAgfSBlbHNlCi0jaWYgSlNfSEFTX1hNTF9T
VVBQT1JUCi0gICAgICAgICAgICAgICAgaWYgKHBuMy0+cG5fdHlwZSA9PSBUT0tfVU5BUllPUCkg
ewotICAgICAgICAgICAgICAgICAgICBKU19BU1NFUlQocG4zLT5wbl9vcCA9PSBKU09QX0JJTkRY
TUxOQU1FKTsKLSAgICAgICAgICAgICAgICAgICAgaWYgKCFqc19FbWl0VHJlZShjeCwgY2csIHBu
MykpCi0gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gSlNfRkFMU0U7Ci0gICAgICAgICAg
ICAgICAgICAgIGlmIChqc19FbWl0MShjeCwgY2csIEpTT1BfRU5VTUVMRU0pIDwgMCkKLSAgICAg
ICAgICAgICAgICAgICAgICAgIHJldHVybiBKU19GQUxTRTsKLSAgICAgICAgICAgICAgICB9IGVs
c2UKLSNlbmRpZgotICAgICAgICAgICAgICAgIGlmICghRW1pdEVsZW1PcChjeCwgcG4zLCBKU09Q
X0VOVU1FTEVNLCBjZykpCi0gICAgICAgICAgICAgICAgICAgIHJldHVybiBKU19GQUxTRTsKLSAg
ICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgIH0KIAotICAgICAgICAgICAgLyogVGhl
IHN0YWNrIHNob3VsZCBiZSBiYWxhbmNlZCBhcm91bmQgdGhlIEpTT1BfRk9SKiBvcGNvZGUgc2Vx
dWVuY2UuICovCisgICAgICAgICAgICAvKiBUaGUgc3RhY2sgc2hvdWxkIGJlIGJhbGFuY2VkIGFy
b3VuZCB0aGUgYXNzaWdubWVudCBvcGNvZGUgc2VxdWVuY2UuICovCiAgICAgICAgICAgICBKU19B
U1NFUlQoY2ctPnN0YWNrRGVwdGggPT0gbG9vcERlcHRoKTsKIAogICAgICAgICAgICAgdG1wMiA9
IENHX09GRlNFVChjZyk7CiAKICAgICAgICAgICAgIC8qIEVtaXQgY29kZSBmb3IgdGhlIGxvb3Ag
Ym9keS4gKi8KICAgICAgICAgICAgIGlmICghanNfRW1pdFRyZWUoY3gsIGNnLCBwbi0+cG5fcmln
aHQpKQogICAgICAgICAgICAgICAgIHJldHVybiBKU19GQUxTRTsKIAogICAgICAgICAgICAgLyog
U2V0IGxvb3AgYW5kIGVuY2xvc2luZyAidXBkYXRlIiBvZmZzZXRzLCBmb3IgY29udGludWUuICov
CiAgICAgICAgICAgICBzdG10ID0gJnN0bXRJbmZvOwogICAgICAgICAgICAgZG8gewogICAgICAg
ICAgICAgICAgIHN0bXQtPnVwZGF0ZSA9IENHX09GRlNFVChjZyk7CiAgICAgICAgICAgICB9IHdo
aWxlICgoc3RtdCA9IHN0bXQtPmRvd24pICE9IE5VTEwgJiYgc3RtdC0+dHlwZSA9PSBTVE1UX0xB
QkVMKTsKIAogICAgICAgICAgICAgLyoKLSAgICAgICAgICAgICAqIEZpeHVwIHRoZSBnb3RvIHRo
YXQgc3RhcnRzIHRoZSBsb29wIHRvIGp1bXAgZG93biB0byBKU09QX01PUkVJVEVSLgorICAgICAg
ICAgICAgICogRml4dXAgdGhlIGdvdG8gdGhhdCBzdGFydHMgdGhlIGxvb3AgdG8ganVtcCBkb3du
IHRvIEpTT1BfSEFTTkVYVC4KICAgICAgICAgICAgICAqLwogICAgICAgICAgICAgQ0hFQ0tfQU5E
X1NFVF9KVU1QX09GRlNFVF9BVChjeCwgY2csIGptcCk7Ci0gICAgICAgICAgICBpZiAoanNfRW1p
dDEoY3gsIGNnLCBKU09QX01PUkVJVEVSKSA8IDApCisgICAgICAgICAgICBpZiAoanNfRW1pdDEo
Y3gsIGNnLCBKU09QX0hBU05FWFQpIDwgMCkKICAgICAgICAgICAgICAgICByZXR1cm4gSlNfRkFM
U0U7CiAgICAgICAgICAgICBiZXEgPSBFbWl0SnVtcChjeCwgY2csIEpTT1BfSUZORSwgdG9wIC0g
Q0dfT0ZGU0VUKGNnKSk7CiAgICAgICAgICAgICBpZiAoYmVxIDwgMCkKICAgICAgICAgICAgICAg
ICByZXR1cm4gSlNfRkFMU0U7CiAKICAgICAgICAgICAgIC8qCiAgICAgICAgICAgICAgKiBCZSBj
YXJlZnVsOiBXZSBtdXN0IHNldCBub3RlSW5kZXgyIGJlZm9yZSBub3RlSW5kZXggaW4gY2FzZSB0
aGUgbm90ZUluZGV4CiAgICAgICAgICAgICAgKiBub3RlIGdldHMgYmlnZ2VyLgpAQCAtNTI0Niwx
NyArNTI2MywxNyBAQCBqc19FbWl0VHJlZShKU0NvbnRleHQgKmN4LCBKU0NvZGVHZW5lcmF0CiAg
ICAgICAgICAgICB9CiAKICAgICAgICAgICAgIHRvcCA9IENHX09GRlNFVChjZyk7CiAgICAgICAg
ICAgICBTRVRfU1RBVEVNRU5UX1RPUCgmc3RtdEluZm8sIHRvcCk7CiAKICAgICAgICAgICAgIG5v
dGVJbmRleDIgPSBqc19OZXdTcmNOb3RlKGN4LCBjZywgU1JDX1RSQUNFKTsKICAgICAgICAgICAg
IGlmIChub3RlSW5kZXgyIDwgMCkKICAgICAgICAgICAgICAgICByZXR1cm4gSlNfRkFMU0U7Ci0g
ICAgICAgICAgICAKKwogICAgICAgICAgICAgLyogRW1pdCBjb2RlIGZvciB0aGUgbG9vcCBib2R5
LiAqLwogICAgICAgICAgICAgaWYgKEVtaXRUcmFjZU9wKGN4LCBjZykgPCAwKQogICAgICAgICAg
ICAgICAgIHJldHVybiBKU19GQUxTRTsKICAgICAgICAgICAgIGlmICghanNfRW1pdFRyZWUoY3gs
IGNnLCBwbi0+cG5fcmlnaHQpKQogICAgICAgICAgICAgICAgIHJldHVybiBKU19GQUxTRTsKIAog
ICAgICAgICAgICAgLyogU2V0IHRoZSBzZWNvbmQgbm90ZSBvZmZzZXQgc28gd2UgY2FuIGZpbmQg
dGhlIHVwZGF0ZSBwYXJ0LiAqLwogICAgICAgICAgICAgSlNfQVNTRVJUKG5vdGVJbmRleCAhPSAt
MSk7CkBAIC01NDc2LDE3ICs1NDkzLDE3IEBAIGpzX0VtaXRUcmVlKEpTQ29udGV4dCAqY3gsIEpT
Q29kZUdlbmVyYXQKICAgICAgICAgdHJ5RW5kID0gQ0dfT0ZGU0VUKGNnKTsKIAogICAgICAgICBK
U09iamVjdEJveCAqcHJldkJveCA9IE5VTEw7CiAgICAgICAgIC8qIElmIHRoaXMgdHJ5IGhhcyBh
IGNhdGNoIGJsb2NrLCBlbWl0IGl0LiAqLwogICAgICAgICBwbjIgPSBwbi0+cG5fa2lkMjsKICAg
ICAgICAgbGFzdENhdGNoID0gTlVMTDsKICAgICAgICAgaWYgKHBuMikgewogICAgICAgICAgICAg
dWludE4gY291bnQgPSAwOyAgICAvKiBwcmV2aW91cyBjYXRjaCBibG9jaydzIHBvcHVsYXRpb24g
Ki8KLSAgICAgICAgICAgIAorCiAgICAgICAgICAgICAvKgogICAgICAgICAgICAgICogVGhlIGVt
aXR0ZWQgY29kZSBmb3IgYSBjYXRjaCBibG9jayBsb29rcyBsaWtlOgogICAgICAgICAgICAgICoK
ICAgICAgICAgICAgICAqIGJsb2NrY2hhaW4KICAgICAgICAgICAgICAqIFt0aHJvd2luZ10gICAg
ICAgICAgICAgICAgICAgICAgICAgIG9ubHkgaWYgMm5kKyBjYXRjaCBibG9jawogICAgICAgICAg
ICAgICogW2xlYXZlYmxvY2tdICAgICAgICAgICAgICAgICAgICAgICAgb25seSBpZiAybmQrIGNh
dGNoIGJsb2NrCiAgICAgICAgICAgICAgKiBlbnRlcmJsb2NrICAgICAgICAgICAgICAgICAgICAg
ICAgICB3aXRoIFNSQ19DQVRDSAogICAgICAgICAgICAgICogZXhjZXB0aW9uCkBAIC01NTA4LDE3
ICs1NTI1LDE3IEBAIGpzX0VtaXRUcmVlKEpTQ29udGV4dCAqY3gsIEpTQ29kZUdlbmVyYXQKICAg
ICAgICAgICAgIGZvciAocG4zID0gcG4yLT5wbl9oZWFkOyBwbjM7IHBuMyA9IHBuMy0+cG5fbmV4
dCkgewogICAgICAgICAgICAgICAgIHB0cmRpZmZfdCBndWFyZEp1bXAsIGNhdGNoTm90ZTsKIAog
ICAgICAgICAgICAgICAgIEpTX0FTU0VSVChjZy0+c3RhY2tEZXB0aCA9PSBkZXB0aCk7CiAgICAg
ICAgICAgICAgICAgZ3VhcmRKdW1wID0gR1VBUkRKVU1QKHN0bXRJbmZvKTsKICAgICAgICAgICAg
ICAgICBpZiAoZ3VhcmRKdW1wICE9IC0xKSB7CiAgICAgICAgICAgICAgICAgICAgIGlmIChFbWl0
S25vd25CbG9ja0NoYWluKGN4LCBjZywgcHJldkJveCkgPCAwKQogICAgICAgICAgICAgICAgICAg
ICAgICAgcmV0dXJuIEpTX0ZBTFNFOwotICAgICAgICAgICAgICAgIAorCiAgICAgICAgICAgICAg
ICAgICAgIC8qIEZpeCB1cCBhbmQgY2xlYW4gdXAgcHJldmlvdXMgY2F0Y2ggYmxvY2suICovCiAg
ICAgICAgICAgICAgICAgICAgIENIRUNLX0FORF9TRVRfSlVNUF9PRkZTRVRfQVQoY3gsIGNnLCBn
dWFyZEp1bXApOwogCiAgICAgICAgICAgICAgICAgICAgIC8qCiAgICAgICAgICAgICAgICAgICAg
ICAqIEFjY291bnQgZm9yIEpTT1BfRU5URVJCTE9DSyAod2hvc2UgYmxvY2sgb2JqZWN0IGNvdW50
CiAgICAgICAgICAgICAgICAgICAgICAqIGlzIHNhdmVkIGJlbG93KSBhbmQgcHVzaGVkIGV4Y2Vw
dGlvbiBvYmplY3QgdGhhdCB3ZQogICAgICAgICAgICAgICAgICAgICAgKiBzdGlsbCBoYXZlIGFm
dGVyIHRoZSBqdW1waW5nIGZyb20gdGhlIHByZXZpb3VzIGd1YXJkLgogICAgICAgICAgICAgICAg
ICAgICAgKi8KQEAgLTU1OTUsMTcgKzU2MTIsMTcgQEAganNfRW1pdFRyZWUoSlNDb250ZXh0ICpj
eCwgSlNDb2RlR2VuZXJhdAogICAgICAgICAgKiBMYXN0IGNhdGNoIGd1YXJkIGp1bXBzIHRvIHRo
ZSByZXRocm93IGNvZGUgc2VxdWVuY2UgaWYgbm9uZSBvZiB0aGUKICAgICAgICAgICogZ3VhcmRz
IG1hdGNoLiBUYXJnZXQgZ3VhcmRKdW1wIGF0IHRoZSBiZWdpbm5pbmcgb2YgdGhlIHJldGhyb3cK
ICAgICAgICAgICogc2VxdWVuY2UsIGp1c3QgaW4gY2FzZSBhIGd1YXJkIGV4cHJlc3Npb24gdGhy
b3dzIGFuZCBsZWF2ZXMgdGhlCiAgICAgICAgICAqIHN0YWNrIHVuYmFsYW5jZWQuCiAgICAgICAg
ICAqLwogICAgICAgICBpZiAobGFzdENhdGNoICYmIGxhc3RDYXRjaC0+cG5fa2lkMikgewogICAg
ICAgICAgICAgaWYgKEVtaXRLbm93bkJsb2NrQ2hhaW4oY3gsIGNnLCBwcmV2Qm94KSA8IDApCiAg
ICAgICAgICAgICAgICAgcmV0dXJuIEpTX0ZBTFNFOwotICAgICAgICAgICAgCisKICAgICAgICAg
ICAgIENIRUNLX0FORF9TRVRfSlVNUF9PRkZTRVRfQVQoY3gsIGNnLCBHVUFSREpVTVAoc3RtdElu
Zm8pKTsKIAogICAgICAgICAgICAgLyogU3luYyB0aGUgc3RhY2sgdG8gdGFrZSBpbnRvIGFjY291
bnQgcHVzaGVkIGV4Y2VwdGlvbi4gKi8KICAgICAgICAgICAgIEpTX0FTU0VSVChjZy0+c3RhY2tE
ZXB0aCA9PSBkZXB0aCk7CiAgICAgICAgICAgICBjZy0+c3RhY2tEZXB0aCA9IGRlcHRoICsgMTsK
IAogICAgICAgICAgICAgLyoKICAgICAgICAgICAgICAqIFJldGhyb3cgdGhlIGV4Y2VwdGlvbiwg
ZGVsZWdhdGluZyBleGVjdXRpbmcgb2YgZmluYWxseSBpZiBhbnkKQEAgLTU3NTksMTcgKzU3NzYs
MTcgQEAganNfRW1pdFRyZWUoSlNDb250ZXh0ICpjeCwgSlNDb2RlR2VuZXJhdAogICAgICAgICAg
Ki8KICAgICAgICAgb2ZmID0gY2ctPnN0YWNrRGVwdGg7CiAgICAgICAgIGlmIChqc19OZXdTcmNO
b3RlMihjeCwgY2csIFNSQ19DQVRDSCwgb2ZmKSA8IDApCiAgICAgICAgICAgICByZXR1cm4gSlNf
RkFMU0U7CiAgICAgICAgIGJyZWFrOwogICAgICAgfQogCiAgICAgICBjYXNlIFRPS19WQVI6Ci0g
ICAgICAgIGlmICghRW1pdFZhcmlhYmxlcyhjeCwgY2csIHBuLCBKU19GQUxTRSwgJm5vdGVJbmRl
eCkpCisgICAgICAgIGlmICghRW1pdFZhcmlhYmxlcyhjeCwgY2csIHBuLCBmYWxzZSwgZmFsc2Us
ICZub3RlSW5kZXgpKQogICAgICAgICAgICAgcmV0dXJuIEpTX0ZBTFNFOwogICAgICAgICBicmVh
azsKIAogICAgICAgY2FzZSBUT0tfUkVUVVJOOgogICAgICAgICAvKiBQdXNoIGEgcmV0dXJuIHZh
bHVlICovCiAgICAgICAgIHBuMiA9IHBuLT5wbl9raWQ7CiAgICAgICAgIGlmIChwbjIpIHsKICAg
ICAgICAgICAgIGlmICghanNfRW1pdFRyZWUoY3gsIGNnLCBwbjIpKQpAQCAtNjA1MywxOTQgKzYw
NzAsMTggQEAganNfRW1pdFRyZWUoSlNDb250ZXh0ICpjeCwgSlNDb2RlR2VuZXJhdAogICAgICAg
ICAgICAgaWYgKG5vdGVJbmRleCA8IDAgfHwKICAgICAgICAgICAgICAgICBqc19FbWl0MShjeCwg
Y2csIEpTT1BfUE9QKSA8IDApIHsKICAgICAgICAgICAgICAgICByZXR1cm4gSlNfRkFMU0U7CiAg
ICAgICAgICAgICB9CiAgICAgICAgIH0KICAgICAgICAgYnJlYWs7CiAKICAgICAgIGNhc2UgVE9L
X0FTU0lHTjoKLSAgICAgICAgLyoKLSAgICAgICAgICogQ2hlY2sgbGVmdCBvcGVyYW5kIHR5cGUg
YW5kIGdlbmVyYXRlIHNwZWNpYWxpemVkIGNvZGUgZm9yIGl0LgotICAgICAgICAgKiBTcGVjaWFs
aXplIHRvIGF2b2lkIEVDTUEgInJlZmVyZW5jZSB0eXBlIiB2YWx1ZXMgb24gdGhlIG9wZXJhbmQK
LSAgICAgICAgICogc3RhY2ssIHdoaWNoIGltcG9zZSBwZXJ2YXNpdmUgcnVudGltZSAiR2V0VmFs
dWUiIGNvc3RzLgotICAgICAgICAgKi8KLSAgICAgICAgcG4yID0gcG4tPnBuX2xlZnQ7Ci0gICAg
ICAgIGF0b21JbmRleCA9IChqc2F0b21pZCkgLTE7ICAgICAgICAgICAgICAvKiBxdWVsbCBHQ0Mg
b3Zlcndhcm5pbmcgKi8KLSAgICAgICAgc3dpdGNoIChQTl9UWVBFKHBuMikpIHsKLSAgICAgICAg
ICBjYXNlIFRPS19OQU1FOgotICAgICAgICAgICAgaWYgKCFCaW5kTmFtZVRvU2xvdChjeCwgY2cs
IHBuMikpCi0gICAgICAgICAgICAgICAgcmV0dXJuIEpTX0ZBTFNFOwotICAgICAgICAgICAgaWYg
KCFwbjItPnBuX2Nvb2tpZS5pc0ZyZWUoKSkgewotICAgICAgICAgICAgICAgIGF0b21JbmRleCA9
IChqc2F0b21pZCkgcG4yLT5wbl9jb29raWUuYXNJbnRlZ2VyKCk7Ci0gICAgICAgICAgICB9IGVs
c2UgewotICAgICAgICAgICAgICAgIGFsZSA9IGNnLT5hdG9tTGlzdC5hZGQoY2ctPnBhcnNlciwg
cG4yLT5wbl9hdG9tKTsKLSAgICAgICAgICAgICAgICBpZiAoIWFsZSkKLSAgICAgICAgICAgICAg
ICAgICAgcmV0dXJuIEpTX0ZBTFNFOwotICAgICAgICAgICAgICAgIGF0b21JbmRleCA9IEFMRV9J
TkRFWChhbGUpOwotICAgICAgICAgICAgICAgIGlmICghcG4yLT5pc0NvbnN0KCkpIHsKLSAgICAg
ICAgICAgICAgICAgICAgSlNPcCBvcCA9IFBOX09QKHBuMikgPT0gSlNPUF9TRVRHTkFNRSA/IEpT
T1BfQklOREdOQU1FIDogSlNPUF9CSU5ETkFNRTsKLSAgICAgICAgICAgICAgICAgICAgRU1JVF9J
TkRFWF9PUChvcCwgYXRvbUluZGV4KTsKLSAgICAgICAgICAgICAgICB9Ci0gICAgICAgICAgICB9
Ci0gICAgICAgICAgICBicmVhazsKLSAgICAgICAgICBjYXNlIFRPS19ET1Q6Ci0gICAgICAgICAg
ICBpZiAoIWpzX0VtaXRUcmVlKGN4LCBjZywgcG4yLT5leHByKCkpKQotICAgICAgICAgICAgICAg
IHJldHVybiBKU19GQUxTRTsKLSAgICAgICAgICAgIGFsZSA9IGNnLT5hdG9tTGlzdC5hZGQoY2ct
PnBhcnNlciwgcG4yLT5wbl9hdG9tKTsKLSAgICAgICAgICAgIGlmICghYWxlKQotICAgICAgICAg
ICAgICAgIHJldHVybiBKU19GQUxTRTsKLSAgICAgICAgICAgIGF0b21JbmRleCA9IEFMRV9JTkRF
WChhbGUpOwotICAgICAgICAgICAgYnJlYWs7Ci0gICAgICAgICAgY2FzZSBUT0tfTEI6Ci0gICAg
ICAgICAgICBKU19BU1NFUlQocG4yLT5wbl9hcml0eSA9PSBQTl9CSU5BUlkpOwotICAgICAgICAg
ICAgaWYgKCFqc19FbWl0VHJlZShjeCwgY2csIHBuMi0+cG5fbGVmdCkpCi0gICAgICAgICAgICAg
ICAgcmV0dXJuIEpTX0ZBTFNFOwotICAgICAgICAgICAgaWYgKCFqc19FbWl0VHJlZShjeCwgY2cs
IHBuMi0+cG5fcmlnaHQpKQotICAgICAgICAgICAgICAgIHJldHVybiBKU19GQUxTRTsKLSAgICAg
ICAgICAgIGJyZWFrOwotI2lmIEpTX0hBU19ERVNUUlVDVFVSSU5HCi0gICAgICAgICAgY2FzZSBU
T0tfUkI6Ci0gICAgICAgICAgY2FzZSBUT0tfUkM6Ci0gICAgICAgICAgICBicmVhazsKLSNlbmRp
ZgotICAgICAgICAgIGNhc2UgVE9LX0xQOgotICAgICAgICAgICAgaWYgKCFqc19FbWl0VHJlZShj
eCwgY2csIHBuMikpCi0gICAgICAgICAgICAgICAgcmV0dXJuIEpTX0ZBTFNFOwotICAgICAgICAg
ICAgYnJlYWs7Ci0jaWYgSlNfSEFTX1hNTF9TVVBQT1JUCi0gICAgICAgICAgY2FzZSBUT0tfVU5B
UllPUDoKLSAgICAgICAgICAgIEpTX0FTU0VSVChwbjItPnBuX29wID09IEpTT1BfU0VUWE1MTkFN
RSk7Ci0gICAgICAgICAgICBpZiAoIWpzX0VtaXRUcmVlKGN4LCBjZywgcG4yLT5wbl9raWQpKQot
ICAgICAgICAgICAgICAgIHJldHVybiBKU19GQUxTRTsKLSAgICAgICAgICAgIGlmIChqc19FbWl0
MShjeCwgY2csIEpTT1BfQklORFhNTE5BTUUpIDwgMCkKLSAgICAgICAgICAgICAgICByZXR1cm4g
SlNfRkFMU0U7Ci0gICAgICAgICAgICBicmVhazsKLSNlbmRpZgotICAgICAgICAgIGRlZmF1bHQ6
Ci0gICAgICAgICAgICBKU19BU1NFUlQoMCk7Ci0gICAgICAgIH0KLQotICAgICAgICBvcCA9IFBO
X09QKHBuKTsKLSAgICAgICAgaWYgKG9wICE9IEpTT1BfTk9QKSB7Ci0gICAgICAgICAgICBzd2l0
Y2ggKHBuMi0+cG5fdHlwZSkgewotICAgICAgICAgICAgICBjYXNlIFRPS19OQU1FOgotICAgICAg
ICAgICAgICAgIGlmIChwbjItPmlzQ29uc3QoKSkgewotICAgICAgICAgICAgICAgICAgICBpZiAo
UE5fT1AocG4yKSA9PSBKU09QX0NBTExFRSkgewotICAgICAgICAgICAgICAgICAgICAgICAgaWYg
KGpzX0VtaXQxKGN4LCBjZywgSlNPUF9DQUxMRUUpIDwgMCkKLSAgICAgICAgICAgICAgICAgICAg
ICAgICAgICByZXR1cm4gSlNfRkFMU0U7Ci0gICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7Ci0g
ICAgICAgICAgICAgICAgICAgICAgICBFTUlUX0lOREVYX09QKFBOX09QKHBuMiksIGF0b21JbmRl
eCk7Ci0gICAgICAgICAgICAgICAgICAgIH0KLSAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKFBO
X09QKHBuMikgPT0gSlNPUF9TRVROQU1FKSB7Ci0gICAgICAgICAgICAgICAgICAgIGlmIChqc19F
bWl0MShjeCwgY2csIEpTT1BfRFVQKSA8IDApCi0gICAgICAgICAgICAgICAgICAgICAgICByZXR1
cm4gSlNfRkFMU0U7Ci0gICAgICAgICAgICAgICAgICAgIEVNSVRfSU5ERVhfT1AoSlNPUF9HRVRY
UFJPUCwgYXRvbUluZGV4KTsKLSAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKFBOX09QKHBuMikg
PT0gSlNPUF9TRVRHTkFNRSkgewotICAgICAgICAgICAgICAgICAgICBpZiAoIUJpbmRHbG9iYWwo
Y3gsIGNnLCBwbjIsIHBuMi0+cG5fYXRvbSkpCi0gICAgICAgICAgICAgICAgICAgICAgICByZXR1
cm4gSlNfRkFMU0U7Ci0gICAgICAgICAgICAgICAgICAgIGlmIChwbjItPnBuX2Nvb2tpZS5pc0Zy
ZWUoKSkKLSAgICAgICAgICAgICAgICAgICAgICAgIEVtaXRBdG9tT3AoY3gsIHBuMiwgSlNPUF9H
RVRHTkFNRSwgY2cpOwotICAgICAgICAgICAgICAgICAgICBlbHNlCi0gICAgICAgICAgICAgICAg
ICAgICAgICBFTUlUX1VJTlQxNl9JTU1fT1AoSlNPUF9HRVRHTE9CQUwsIHBuMi0+cG5fY29va2ll
LmFzSW50ZWdlcigpKTsKLSAgICAgICAgICAgICAgICB9IGVsc2UgewotICAgICAgICAgICAgICAg
ICAgICBFTUlUX1VJTlQxNl9JTU1fT1AoKFBOX09QKHBuMikgPT0gSlNPUF9TRVRBUkcpCi0gICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA/IEpTT1BfR0VUQVJHCi0gICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA6IEpTT1BfR0VUTE9DQUwsCi0gICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhdG9tSW5kZXgpOwotICAgICAgICAgICAg
ICAgIH0KLSAgICAgICAgICAgICAgICBicmVhazsKLSAgICAgICAgICAgICAgY2FzZSBUT0tfRE9U
OgotICAgICAgICAgICAgICAgIGlmIChqc19FbWl0MShjeCwgY2csIEpTT1BfRFVQKSA8IDApCi0g
ICAgICAgICAgICAgICAgICAgIHJldHVybiBKU19GQUxTRTsKLSAgICAgICAgICAgICAgICBpZiAo
cG4yLT5wbl9hdG9tID09IGN4LT5ydW50aW1lLT5hdG9tU3RhdGUubGVuZ3RoQXRvbSkgewotICAg
ICAgICAgICAgICAgICAgICBpZiAoanNfRW1pdDEoY3gsIGNnLCBKU09QX0xFTkdUSCkgPCAwKQot
ICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIEpTX0ZBTFNFOwotICAgICAgICAgICAgICAg
IH0gZWxzZSBpZiAocG4yLT5wbl9hdG9tID09IGN4LT5ydW50aW1lLT5hdG9tU3RhdGUucHJvdG9B
dG9tKSB7Ci0gICAgICAgICAgICAgICAgICAgIGlmICghRW1pdEluZGV4T3AoY3gsIEpTT1BfUU5B
TUVQQVJULCBhdG9tSW5kZXgsIGNnKSkKLSAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBK
U19GQUxTRTsKLSAgICAgICAgICAgICAgICAgICAgaWYgKGpzX0VtaXQxKGN4LCBjZywgSlNPUF9H
RVRFTEVNKSA8IDApCi0gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gSlNfRkFMU0U7Ci0g
ICAgICAgICAgICAgICAgfSBlbHNlIHsKLSAgICAgICAgICAgICAgICAgICAgRU1JVF9JTkRFWF9P
UChKU09QX0dFVFBST1AsIGF0b21JbmRleCk7Ci0gICAgICAgICAgICAgICAgfQotICAgICAgICAg
ICAgICAgIGJyZWFrOwotICAgICAgICAgICAgICBjYXNlIFRPS19MQjoKLSAgICAgICAgICAgICAg
Y2FzZSBUT0tfTFA6Ci0jaWYgSlNfSEFTX1hNTF9TVVBQT1JUCi0gICAgICAgICAgICAgIGNhc2Ug
VE9LX1VOQVJZT1A6Ci0jZW5kaWYKLSAgICAgICAgICAgICAgICBpZiAoanNfRW1pdDEoY3gsIGNn
LCBKU09QX0RVUDIpIDwgMCkKLSAgICAgICAgICAgICAgICAgICAgcmV0dXJuIEpTX0ZBTFNFOwot
ICAgICAgICAgICAgICAgIGlmIChqc19FbWl0MShjeCwgY2csIEpTT1BfR0VURUxFTSkgPCAwKQot
ICAgICAgICAgICAgICAgICAgICByZXR1cm4gSlNfRkFMU0U7Ci0gICAgICAgICAgICAgICAgYnJl
YWs7Ci0gICAgICAgICAgICAgIGRlZmF1bHQ6OwotICAgICAgICAgICAgfQotICAgICAgICB9Ci0K
LSAgICAgICAgLyogTm93IGVtaXQgdGhlIHJpZ2h0IG9wZXJhbmQgKGl0IG1heSBhZmZlY3QgdGhl
IG5hbWVzcGFjZSkuICovCi0gICAgICAgIGlmICghanNfRW1pdFRyZWUoY3gsIGNnLCBwbi0+cG5f
cmlnaHQpKQotICAgICAgICAgICAgcmV0dXJuIEpTX0ZBTFNFOwotCi0gICAgICAgIC8qIElmICs9
IGV0Yy4sIGVtaXQgdGhlIGJpbmFyeSBvcGVyYXRvciB3aXRoIGEgZGVjb21waWxlciBub3RlLiAq
LwotICAgICAgICBpZiAob3AgIT0gSlNPUF9OT1ApIHsKLSAgICAgICAgICAgIC8qCi0gICAgICAg
ICAgICAgKiBUYWtlIGNhcmUgdG8gYXZvaWQgU1JDX0FTU0lHTk9QIGlmIHRoZSBsZWZ0LWhhbmQg
c2lkZSBpcyBhIGNvbnN0Ci0gICAgICAgICAgICAgKiBkZWNsYXJlZCBpbiB0aGUgY3VycmVudCBj
b21waWxhdGlvbiB1bml0LCBhcyBpbiB0aGlzIGNhc2UgKGp1c3QKLSAgICAgICAgICAgICAqIGEg
Yml0IGZ1cnRoZXIgYmVsb3cpIHdlIHdpbGwgYXZvaWQgZW1pdHRpbmcgdGhlIGFzc2lnbm1lbnQg
b3AuCi0gICAgICAgICAgICAgKi8KLSAgICAgICAgICAgIGlmIChwbjItPnBuX3R5cGUgIT0gVE9L
X05BTUUgfHwgIXBuMi0+aXNDb25zdCgpKSB7Ci0gICAgICAgICAgICAgICAgaWYgKGpzX05ld1Ny
Y05vdGUoY3gsIGNnLCBTUkNfQVNTSUdOT1ApIDwgMCkKLSAgICAgICAgICAgICAgICAgICAgcmV0
dXJuIEpTX0ZBTFNFOwotICAgICAgICAgICAgfQotICAgICAgICAgICAgaWYgKGpzX0VtaXQxKGN4
LCBjZywgb3ApIDwgMCkKLSAgICAgICAgICAgICAgICByZXR1cm4gSlNfRkFMU0U7Ci0gICAgICAg
IH0KLQotICAgICAgICAvKiBMZWZ0IHBhcnRzIHN1Y2ggYXMgYS5iLmMgYW5kIGFbYl0uYyBuZWVk
IGEgZGVjb21waWxlciBub3RlLiAqLwotICAgICAgICBpZiAocG4yLT5wbl90eXBlICE9IFRPS19O
QU1FICYmCi0jaWYgSlNfSEFTX0RFU1RSVUNUVVJJTkcKLSAgICAgICAgICAgIHBuMi0+cG5fdHlw
ZSAhPSBUT0tfUkIgJiYKLSAgICAgICAgICAgIHBuMi0+cG5fdHlwZSAhPSBUT0tfUkMgJiYKLSNl
bmRpZgotICAgICAgICAgICAganNfTmV3U3JjTm90ZTIoY3gsIGNnLCBTUkNfUENCQVNFLCBDR19P
RkZTRVQoY2cpIC0gdG9wKSA8IDApIHsKLSAgICAgICAgICAgIHJldHVybiBKU19GQUxTRTsKLSAg
ICAgICAgfQotCi0gICAgICAgIC8qIEZpbmFsbHksIGVtaXQgdGhlIHNwZWNpYWxpemVkIGFzc2ln
bm1lbnQgYnl0ZWNvZGUuICovCi0gICAgICAgIHN3aXRjaCAocG4yLT5wbl90eXBlKSB7Ci0gICAg
ICAgICAgY2FzZSBUT0tfTkFNRToKLSAgICAgICAgICAgIGlmIChwbjItPmlzQ29uc3QoKSkKLSAg
ICAgICAgICAgICAgICBicmVhazsKLSAgICAgICAgICAgIC8qIEZBTEwgVEhST1VHSCAqLwotICAg
ICAgICAgIGNhc2UgVE9LX0RPVDoKLSAgICAgICAgICAgIEVNSVRfSU5ERVhfT1AoUE5fT1AocG4y
KSwgYXRvbUluZGV4KTsKLSAgICAgICAgICAgIGJyZWFrOwotICAgICAgICAgIGNhc2UgVE9LX0xC
OgotICAgICAgICAgIGNhc2UgVE9LX0xQOgotICAgICAgICAgICAgaWYgKGpzX0VtaXQxKGN4LCBj
ZywgSlNPUF9TRVRFTEVNKSA8IDApCi0gICAgICAgICAgICAgICAgcmV0dXJuIEpTX0ZBTFNFOwot
ICAgICAgICAgICAgYnJlYWs7Ci0jaWYgSlNfSEFTX0RFU1RSVUNUVVJJTkcKLSAgICAgICAgICBj
YXNlIFRPS19SQjoKLSAgICAgICAgICBjYXNlIFRPS19SQzoKLSAgICAgICAgICAgIGlmICghRW1p
dERlc3RydWN0dXJpbmdPcHMoY3gsIGNnLCBKU09QX1NFVE5BTUUsIHBuMikpCi0gICAgICAgICAg
ICAgICAgcmV0dXJuIEpTX0ZBTFNFOwotICAgICAgICAgICAgYnJlYWs7Ci0jZW5kaWYKLSNpZiBK
U19IQVNfWE1MX1NVUFBPUlQKLSAgICAgICAgICBjYXNlIFRPS19VTkFSWU9QOgotICAgICAgICAg
ICAgaWYgKGpzX0VtaXQxKGN4LCBjZywgSlNPUF9TRVRYTUxOQU1FKSA8IDApCi0gICAgICAgICAg
ICAgICAgcmV0dXJuIEpTX0ZBTFNFOwotICAgICAgICAgICAgYnJlYWs7Ci0jZW5kaWYKLSAgICAg
ICAgICBkZWZhdWx0OgotICAgICAgICAgICAgSlNfQVNTRVJUKDApOwotICAgICAgICB9CisgICAg
ICAgICAgaWYgKCFFbWl0QXNzaWdubWVudChjeCwgY2csIHBuKSkKKyAgICAgICAgICAgIHJldHVy
biBKU19GQUxTRTsKICAgICAgICAgYnJlYWs7CiAKICAgICAgIGNhc2UgVE9LX0hPT0s6CiAgICAg
ICAgIC8qIEVtaXQgdGhlIGNvbmRpdGlvbiwgdGhlbiBicmFuY2ggaWYgZmFsc2UgdG8gdGhlIGVs
c2UgcGFydC4gKi8KICAgICAgICAgaWYgKCFqc19FbWl0VHJlZShjeCwgY2csIHBuLT5wbl9raWQx
KSkKICAgICAgICAgICAgIHJldHVybiBKU19GQUxTRTsKICAgICAgICAgbm90ZUluZGV4ID0ganNf
TmV3U3JjTm90ZShjeCwgY2csIFNSQ19DT05EKTsKICAgICAgICAgaWYgKG5vdGVJbmRleCA8IDAp
CkBAIC02NzYzLDE3ICs2NjA0LDE3IEBAIGpzX0VtaXRUcmVlKEpTQ29udGV4dCAqY3gsIEpTQ29k
ZUdlbmVyYXQKICAgICAgICAgICAgIHBuMiA9IHBuLT5wbl9yaWdodDsKICAgICAgICAgICAgIHBu
ID0gcG4tPnBuX2xlZnQ7CiAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICBwbjIgPSBOVUxM
OwogICAgICAgICB9CiAKICAgICAgICAgLyogTm9uLW51bGwgcG4yIG1lYW5zIHRoYXQgcG4gaXMg
dGhlIHZhcmlhYmxlIGxpc3QgZnJvbSBhIGxldCBoZWFkLiAqLwogICAgICAgICBKU19BU1NFUlQo
cG4tPnBuX2FyaXR5ID09IFBOX0xJU1QpOwotICAgICAgICBpZiAoIUVtaXRWYXJpYWJsZXMoY3gs
IGNnLCBwbiwgcG4yICE9IE5VTEwsICZub3RlSW5kZXgpKQorICAgICAgICBpZiAoIUVtaXRWYXJp
YWJsZXMoY3gsIGNnLCBwbiwgZmFsc2UsIHBuMiAhPSBOVUxMLCAmbm90ZUluZGV4KSkKICAgICAg
ICAgICAgIHJldHVybiBKU19GQUxTRTsKIAogICAgICAgICAvKiBUaHVzIG5vbi1udWxsIHBuMiBp
cyB0aGUgYm9keSBvZiB0aGUgbGV0IGJsb2NrIG9yIGV4cHJlc3Npb24uICovCiAgICAgICAgIHRt
cCA9IENHX09GRlNFVChjZyk7CiAgICAgICAgIGlmIChwbjIgJiYgIWpzX0VtaXRUcmVlKGN4LCBj
ZywgcG4yKSkKICAgICAgICAgICAgIHJldHVybiBKU19GQUxTRTsKIAogICAgICAgICBpZiAobm90
ZUluZGV4ID49IDAgJiYKZGlmZiAtLWdpdCBhL2pzL3NyYy9qc2ludGVycC5jcHAgYi9qcy9zcmMv
anNpbnRlcnAuY3BwCi0tLSBhL2pzL3NyYy9qc2ludGVycC5jcHAKKysrIGIvanMvc3JjL2pzaW50
ZXJwLmNwcApAQCAtMzEzMywxMTggKzMxMzMsNTAgQEAgQkVHSU5fQ0FTRShKU09QX0lURVIpCiAg
ICAgdWludE4gZmxhZ3MgPSByZWdzLnBjWzFdOwogICAgIGlmICghanNfVmFsdWVUb0l0ZXJhdG9y
KGN4LCBmbGFncywgJnJlZ3Muc3BbLTFdKSkKICAgICAgICAgZ290byBlcnJvcjsKICAgICBDSEVD
S19JTlRFUlJVUFRfSEFORExFUigpOwogICAgIEpTX0FTU0VSVCghcmVncy5zcFstMV0uaXNQcmlt
aXRpdmUoKSk7CiB9CiBFTkRfQ0FTRShKU09QX0lURVIpCiAKLUJFR0lOX0NBU0UoSlNPUF9NT1JF
SVRFUikKK0JFR0lOX0NBU0UoSlNPUF9IQVNORVhUKQogewogICAgIEpTX0FTU0VSVChyZWdzLnNw
IC0gMSA+PSByZWdzLmZwLT5iYXNlKCkpOwogICAgIEpTX0FTU0VSVChyZWdzLnNwWy0xXS5pc09i
amVjdCgpKTsKICAgICBQVVNIX05VTEwoKTsKICAgICBib29sIGNvbmQ7CiAgICAgaWYgKCFJdGVy
YXRvck1vcmUoY3gsICZyZWdzLnNwWy0yXS50b09iamVjdCgpLCAmY29uZCwgJnJlZ3Muc3BbLTFd
KSkKICAgICAgICAgZ290byBlcnJvcjsKICAgICBDSEVDS19JTlRFUlJVUFRfSEFORExFUigpOwog
ICAgIHJlZ3Muc3BbLTFdLnNldEJvb2xlYW4oY29uZCk7CiB9Ci1FTkRfQ0FTRShKU09QX01PUkVJ
VEVSKQorRU5EX0NBU0UoSlNPUF9IQVNORVhUKQorCitCRUdJTl9DQVNFKEpTT1BfTkVYVCkKK3sK
KyAgICBWYWx1ZSAqaXRlcnZwID0gcmVncy5zcCAtIEdFVF9JTlQ4KHJlZ3MucGMpOworICAgIEpT
X0FTU0VSVChpdGVydnAgPj0gcmVncy5mcC0+YmFzZSgpKTsKKyAgICBKU19BU1NFUlQoaXRlcnZw
LT5pc09iamVjdCgpKTsKKyAgICBQVVNIX05VTEwoKTsKKyAgICBpZiAoIUl0ZXJhdG9yTmV4dChj
eCwgJml0ZXJ2cC0+dG9PYmplY3QoKSwgJnJlZ3Muc3BbLTFdKSkKKyAgICAgICAgZ290byBlcnJv
cjsKK30KK0VORF9DQVNFKEpTT1BfTkVYVCkKIAogQkVHSU5fQ0FTRShKU09QX0VORElURVIpCiB7
CiAgICAgSlNfQVNTRVJUKHJlZ3Muc3AgLSAxID49IHJlZ3MuZnAtPmJhc2UoKSk7CiAgICAgYm9v
bCBvayA9ICEhanNfQ2xvc2VJdGVyYXRvcihjeCwgJnJlZ3Muc3BbLTFdLnRvT2JqZWN0KCkpOwog
ICAgIHJlZ3Muc3AtLTsKICAgICBpZiAoIW9rKQogICAgICAgICBnb3RvIGVycm9yOwogfQogRU5E
X0NBU0UoSlNPUF9FTkRJVEVSKQogCi1CRUdJTl9DQVNFKEpTT1BfRk9SQVJHKQotewotICAgIEpT
X0FTU0VSVChyZWdzLnNwIC0gMSA+PSByZWdzLmZwLT5iYXNlKCkpOwotICAgIHVpbnROIHNsb3Qg
PSBHRVRfQVJHTk8ocmVncy5wYyk7Ci0gICAgSlNfQVNTRVJUKHNsb3QgPCByZWdzLmZwLT5udW1G
b3JtYWxBcmdzKCkpOwotICAgIEpTX0FTU0VSVChyZWdzLnNwWy0xXS5pc09iamVjdCgpKTsKLSAg
ICBpZiAoIUl0ZXJhdG9yTmV4dChjeCwgJnJlZ3Muc3BbLTFdLnRvT2JqZWN0KCksICZhcmd2W3Ns
b3RdKSkKLSAgICAgICAgZ290byBlcnJvcjsKLX0KLUVORF9DQVNFKEpTT1BfRk9SQVJHKQotCi1C
RUdJTl9DQVNFKEpTT1BfRk9STE9DQUwpCi17Ci0gICAgSlNfQVNTRVJUKHJlZ3Muc3AgLSAxID49
IHJlZ3MuZnAtPmJhc2UoKSk7Ci0gICAgdWludE4gc2xvdCA9IEdFVF9TTE9UTk8ocmVncy5wYyk7
Ci0gICAgSlNfQVNTRVJUKHNsb3QgPCByZWdzLmZwLT5udW1TbG90cygpKTsKLSAgICBKU19BU1NF
UlQocmVncy5zcFstMV0uaXNPYmplY3QoKSk7Ci0gICAgaWYgKCFJdGVyYXRvck5leHQoY3gsICZy
ZWdzLnNwWy0xXS50b09iamVjdCgpLCAmcmVncy5mcC0+c2xvdHMoKVtzbG90XSkpCi0gICAgICAg
IGdvdG8gZXJyb3I7Ci19Ci1FTkRfQ0FTRShKU09QX0ZPUkxPQ0FMKQotCi1CRUdJTl9DQVNFKEpT
T1BfRk9STkFNRSkKLUJFR0lOX0NBU0UoSlNPUF9GT1JHTkFNRSkKLXsKLSAgICBKU19BU1NFUlQo
cmVncy5zcCAtIDEgPj0gcmVncy5mcC0+YmFzZSgpKTsKLSAgICBKU0F0b20gKmF0b207Ci0gICAg
TE9BRF9BVE9NKDAsIGF0b20pOwotICAgIGpzaWQgaWQgPSBBVE9NX1RPX0pTSUQoYXRvbSk7Ci0g
ICAgSlNPYmplY3QgKm9iaiwgKm9iajI7Ci0gICAgSlNQcm9wZXJ0eSAqcHJvcDsKLSAgICBpZiAo
IWpzX0ZpbmRQcm9wZXJ0eShjeCwgaWQsICZvYmosICZvYmoyLCAmcHJvcCkpCi0gICAgICAgIGdv
dG8gZXJyb3I7Ci0KLSAgICB7Ci0gICAgICAgIEF1dG9WYWx1ZVJvb3RlciB0dnIoY3gpOwotICAg
ICAgICBKU19BU1NFUlQocmVncy5zcFstMV0uaXNPYmplY3QoKSk7Ci0gICAgICAgIGlmICghSXRl
cmF0b3JOZXh0KGN4LCAmcmVncy5zcFstMV0udG9PYmplY3QoKSwgdHZyLmFkZHIoKSkpCi0gICAg
ICAgICAgICBnb3RvIGVycm9yOwotICAgICAgICBpZiAoIW9iai0+c2V0UHJvcGVydHkoY3gsIGlk
LCB0dnIuYWRkcigpLCBzY3JpcHQtPnN0cmljdE1vZGVDb2RlKSkKLSAgICAgICAgICAgIGdvdG8g
ZXJyb3I7Ci0gICAgfQotfQotRU5EX0NBU0UoSlNPUF9GT1JOQU1FKQotCi1CRUdJTl9DQVNFKEpT
T1BfRk9SUFJPUCkKLXsKLSAgICBKU19BU1NFUlQocmVncy5zcCAtIDIgPj0gcmVncy5mcC0+YmFz
ZSgpKTsKLSAgICBKU0F0b20gKmF0b207Ci0gICAgTE9BRF9BVE9NKDAsIGF0b20pOwotICAgIGpz
aWQgaWQgPSBBVE9NX1RPX0pTSUQoYXRvbSk7Ci0gICAgSlNPYmplY3QgKm9iajsKLSAgICBGRVRD
SF9PQkpFQ1QoY3gsIC0xLCBvYmopOwotICAgIHsKLSAgICAgICAgQXV0b1ZhbHVlUm9vdGVyIHR2
cihjeCk7Ci0gICAgICAgIEpTX0FTU0VSVChyZWdzLnNwWy0yXS5pc09iamVjdCgpKTsKLSAgICAg
ICAgaWYgKCFJdGVyYXRvck5leHQoY3gsICZyZWdzLnNwWy0yXS50b09iamVjdCgpLCB0dnIuYWRk
cigpKSkKLSAgICAgICAgICAgIGdvdG8gZXJyb3I7Ci0gICAgICAgIGlmICghb2JqLT5zZXRQcm9w
ZXJ0eShjeCwgaWQsIHR2ci5hZGRyKCksIHNjcmlwdC0+c3RyaWN0TW9kZUNvZGUpKQotICAgICAg
ICAgICAgZ290byBlcnJvcjsKLSAgICB9Ci0gICAgcmVncy5zcC0tOwotfQotRU5EX0NBU0UoSlNP
UF9GT1JQUk9QKQotCi1CRUdJTl9DQVNFKEpTT1BfRk9SRUxFTSkKLSAgICAvKgotICAgICAqIEpT
T1BfRk9SRUxFTSBzaW1wbHkgZHVwcyB0aGUgcHJvcGVydHkgaWRlbnRpZmllciBhdCB0b3Agb2Yg
c3RhY2sgYW5kCi0gICAgICogbGV0cyB0aGUgc3Vic2VxdWVudCBKU09QX0VOVU1FTEVNIG9wY29k
ZSBzZXF1ZW5jZSBoYW5kbGUgdGhlIGxlZnQtaGFuZAotICAgICAqIHNpZGUgZXhwcmVzc2lvbiBl
dmFsdWF0aW9uIGFuZCBhc3NpZ25tZW50LiBUaGlzIG9wY29kZSBleGlzdHMgc29sZWx5IHRvCi0g
ICAgICogaGVscCB0aGUgZGVjb21waWxlci4KLSAgICAgKi8KLSAgICBKU19BU1NFUlQocmVncy5z
cCAtIDEgPj0gcmVncy5mcC0+YmFzZSgpKTsKLSAgICBKU19BU1NFUlQocmVncy5zcFstMV0uaXNP
YmplY3QoKSk7Ci0gICAgUFVTSF9OVUxMKCk7Ci0gICAgaWYgKCFJdGVyYXRvck5leHQoY3gsICZy
ZWdzLnNwWy0yXS50b09iamVjdCgpLCAmcmVncy5zcFstMV0pKQotICAgICAgICBnb3RvIGVycm9y
OwotRU5EX0NBU0UoSlNPUF9GT1JFTEVNKQotCiBCRUdJTl9DQVNFKEpTT1BfRFVQKQogewogICAg
IEpTX0FTU0VSVChyZWdzLnNwID4gcmVncy5mcC0+YmFzZSgpKTsKICAgICBjb25zdCBWYWx1ZSAm
cnJlZiA9IHJlZ3Muc3BbLTFdOwogICAgIFBVU0hfQ09QWShycmVmKTsKIH0KIEVORF9DQVNFKEpT
T1BfRFVQKQogCkBAIC02NjE3LDE2ICs2NTQ5LDIwIEBAIEJFR0lOX0NBU0UoSlNPUF9BUlJBWVBV
U0gpCiAgICAgaWYgKCFqc19BcnJheUNvbXBQdXNoKGN4LCBvYmosIHJlZ3Muc3BbLTFdKSkKICAg
ICAgICAgZ290byBlcnJvcjsKICAgICByZWdzLnNwLS07CiB9CiBFTkRfQ0FTRShKU09QX0FSUkFZ
UFVTSCkKICNlbmRpZiAvKiBKU19IQVNfR0VORVJBVE9SUyAqLwogCiAjaWYgSlNfVEhSRUFERURf
SU5URVJQCisgIExfSlNPUF9VTlVTRUQxMToKKyAgTF9KU09QX1VOVVNFRDEwNjoKKyAgTF9KU09Q
X1VOVVNFRDEwNzoKKyAgTF9KU09QX1VOVVNFRDEwODoKICAgTF9KU09QX0JBQ0tQQVRDSDoKICAg
TF9KU09QX0JBQ0tQQVRDSF9QT1A6CiAKICMgaWYgIUpTX0hBU19HRU5FUkFUT1JTCiAgIExfSlNP
UF9HRU5FUkFUT1I6CiAgIExfSlNPUF9ZSUVMRDoKICAgTF9KU09QX0FSUkFZUFVTSDoKICMgZW5k
aWYKQEAgLTY2NjYsMTcgKzY2MDIsMTcgQEAgRU5EX0NBU0UoSlNPUF9BUlJBWVBVU0gpCiAgIExf
SlNPUF9UT0FUVFJOQU1FOgogICBMX0pTT1BfUU5BTUU6CiAgIExfSlNPUF9RTkFNRUNPTlNUOgog
ICBMX0pTT1BfUU5BTUVQQVJUOgogICBMX0pTT1BfQU5ZTkFNRToKICAgTF9KU09QX0RFRlhNTE5T
OgogIyBlbmRpZgogCi0jZW5kaWYgLyogIUpTX1RIUkVBREVEX0lOVEVSUCAqLworI2VuZGlmIC8q
IEpTX1RIUkVBREVEX0lOVEVSUCAqLwogI2lmICFKU19USFJFQURFRF9JTlRFUlAKICAgICAgICAg
ICBkZWZhdWx0OgogI2VuZGlmCiAgICAgICAgICAgewogICAgICAgICAgICAgY2hhciBudW1CdWZb
MTJdOwogICAgICAgICAgICAgSlNfc25wcmludGYobnVtQnVmLCBzaXplb2YgbnVtQnVmLCAiJWQi
LCBvcCk7CiAgICAgICAgICAgICBKU19SZXBvcnRFcnJvck51bWJlcihjeCwganNfR2V0RXJyb3JN
ZXNzYWdlLCBOVUxMLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgSlNNU0dfQkFE
X0JZVEVDT0RFLCBudW1CdWYpOwpkaWZmIC0tZ2l0IGEvanMvc3JjL2pzaXRlci5jcHAgYi9qcy9z
cmMvanNpdGVyLmNwcAotLS0gYS9qcy9zcmMvanNpdGVyLmNwcAorKysgYi9qcy9zcmMvanNpdGVy
LmNwcApAQCAtNzQwLDE3ICs3NDAsMTcgQEAgSlNfRlJJRU5EX0FQSShKU0Jvb2wpCiBqc19WYWx1
ZVRvSXRlcmF0b3IoSlNDb250ZXh0ICpjeCwgdWludE4gZmxhZ3MsIFZhbHVlICp2cCkKIHsKICAg
ICAvKiBKU0lURVJfS0VZVkFMVUUgbXVzdCBhbHdheXMgY29tZSB3aXRoIEpTSVRFUl9GT1JFQUNI
ICovCiAgICAgSlNfQVNTRVJUX0lGKGZsYWdzICYgSlNJVEVSX0tFWVZBTFVFLCBmbGFncyAmIEpT
SVRFUl9GT1JFQUNIKTsKIAogICAgIC8qCiAgICAgICogTWFrZSBzdXJlIHRoZSBtb3JlL25leHQg
c3RhdGUgbWFjaGluZSBkb2Vzbid0IGdldCBzdHVjay4gQSB2YWx1ZSBtaWdodCBiZQogICAgICAq
IGxlZnQgaW4gaXRlclZhbHVlIHdoZW4gYSB0cmFjZSBpcyBsZWZ0IGR1ZSB0byBhbiBvcGVyYXRp
b24gdGltZS1vdXQgYWZ0ZXIKLSAgICAgKiBKU09QX01PUkVJVEVSIGJ1dCBiZWZvcmUgdGhlIHZh
bHVlIGlzIHBpY2tlZCB1cCBieSBGT1IqLgorICAgICAqIEpTT1BfSEFTTkVYVCBidXQgYmVmb3Jl
IHRoZSB2YWx1ZSBpcyBwaWNrZWQgdXAgYnkgSlNPUF9ORVhULgogICAgICAqLwogICAgIGN4LT5p
dGVyVmFsdWUuc2V0TWFnaWMoSlNfTk9fSVRFUl9WQUxVRSk7CiAKICAgICBKU09iamVjdCAqb2Jq
OwogICAgIGlmICh2cC0+aXNPYmplY3QoKSkgewogICAgICAgICAvKiBDb21tb24gY2FzZS4gKi8K
ICAgICAgICAgb2JqID0gJnZwLT50b09iamVjdCgpOwogICAgIH0gZWxzZSB7CmRpZmYgLS1naXQg
YS9qcy9zcmMvanNvcGNvZGUuY3BwIGIvanMvc3JjL2pzb3Bjb2RlLmNwcAotLS0gYS9qcy9zcmMv
anNvcGNvZGUuY3BwCisrKyBiL2pzL3NyYy9qc29wY29kZS5jcHAKQEAgLTE4ODMsMTcgKzE4ODMs
MTcgQEAgRGVjb21waWxlKFNwcmludFN0YWNrICpzcywganNieXRlY29kZSAqcAogICAgIEpTQm9v
bCBmb3JlYWNoLCBpblhNTCwgcXVvdGVBdHRyOwogI2Vsc2UKICNkZWZpbmUgaW5YTUwgSlNfRkFM
U0UKICNlbmRpZgogICAgIGpzdmFsIHZhbDsKIAogICAgIHN0YXRpYyBjb25zdCBjaGFyIGV4Y2Vw
dGlvbl9jb29raWVbXSA9ICIvKkVYQ0VQVElPTiovIjsKICAgICBzdGF0aWMgY29uc3QgY2hhciBy
ZXRzdWJfcGNfY29va2llW10gPSAiLypSRVRTVUJfUEMqLyI7Ci0gICAgc3RhdGljIGNvbnN0IGNo
YXIgZm9yZWxlbV9jb29raWVbXSAgID0gIi8qRk9SRUxFTSovIjsKKyAgICBzdGF0aWMgY29uc3Qg
Y2hhciBuZXh0X2Nvb2tpZVtdICAgPSAiLypORVhUKi8iOwogICAgIHN0YXRpYyBjb25zdCBjaGFy
IHdpdGhfY29va2llW10gICAgICA9ICIvKldJVEgqLyI7CiAgICAgc3RhdGljIGNvbnN0IGNoYXIg
ZG90X2Zvcm1hdFtdICAgICAgID0gIiVzLiVzIjsKICAgICBzdGF0aWMgY29uc3QgY2hhciBpbmRl
eF9mb3JtYXRbXSAgICAgPSAiJXNbJXNdIjsKICAgICBzdGF0aWMgY29uc3QgY2hhciBwcmVkb3Rf
Zm9ybWF0W10gICAgPSAiJXMlcy4lcyI7CiAgICAgc3RhdGljIGNvbnN0IGNoYXIgcG9zdGRvdF9m
b3JtYXRbXSAgID0gIiVzLiVzJXMiOwogICAgIHN0YXRpYyBjb25zdCBjaGFyIHByZWluZGV4X2Zv
cm1hdFtdICA9ICIlcyVzWyVzXSI7CiAgICAgc3RhdGljIGNvbnN0IGNoYXIgcG9zdGluZGV4X2Zv
cm1hdFtdID0gIiVzWyVzXSVzIjsKICAgICBzdGF0aWMgY29uc3QgY2hhciBzc19mb3JtYXRbXSAg
ICAgICAgPSAiJXMlcyI7CkBAIC0zMDYyLDE5ICszMDYyLDE5IEBAIERlY29tcGlsZShTcHJpbnRT
dGFjayAqc3MsIGpzYnl0ZWNvZGUgKnAKIAogICAgICAgICAgICAgICAgIC8qIFR1cm4gb2ZmIG1v
c3QgcGFyZW5zLiAqLwogICAgICAgICAgICAgICAgIG9wID0gSlNPUF9TRVROQU1FOwogCiAgICAg
ICAgICAgICAgICAgLyogUG9wIHRoZSBleHByZXNzaW9uIGJlaW5nIHB1c2hlZCBvciB5aWVsZGVk
LiAqLwogICAgICAgICAgICAgICAgIHJ2YWwgPSBQT1BfU1RSKCk7CiAKICAgICAgICAgICAgICAg
ICAvKgotICAgICAgICAgICAgICAgICAqIFNraXAgdGhlIGZvciBsb29wIGhlYWQgc3RhY2tlZCBi
eSBKU09QX0ZPUkxPQ0FMIHVudGlsIHdlIGhpdAotICAgICAgICAgICAgICAgICAqIGEgYmxvY2sg
bG9jYWwgc2xvdCAobm90ZSBlbXB0eSBkZXN0cnVjdHVyaW5nIHBhdHRlcm5zIHJlc3VsdAotICAg
ICAgICAgICAgICAgICAqIGluIHVuaXQtY291bnQgYmxvY2tzKS4KKyAgICAgICAgICAgICAgICAg
KiBTa2lwIHRoZSBmb3IgbG9vcCBoZWFkIHN0YWNrZWQgYnkgSlNPUF9ORVhUOyBKU09QX0ZPUkxP
Q0FMCisgICAgICAgICAgICAgICAgICogdW50aWwgd2UgaGl0IGEgYmxvY2sgbG9jYWwgc2xvdCAo
bm90ZSBlbXB0eSBkZXN0cnVjdHVyaW5nCisgICAgICAgICAgICAgICAgICogcGF0dGVybnMgcmVz
dWx0IGluIHVuaXQtY291bnQgYmxvY2tzKS4KICAgICAgICAgICAgICAgICAgKi8KICAgICAgICAg
ICAgICAgICBwb3MgPSBzcy0+dG9wOwogICAgICAgICAgICAgICAgIHdoaWxlIChwb3MgIT0gMCkg
ewogICAgICAgICAgICAgICAgICAgICBvcCA9IChKU09wKSBzcy0+b3Bjb2Rlc1stLXBvc107CiAg
ICAgICAgICAgICAgICAgICAgIGlmIChvcCA9PSBKU09QX0VOVEVSQkxPQ0spCiAgICAgICAgICAg
ICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAg
SlNfQVNTRVJUKG9wID09IEpTT1BfRU5URVJCTE9DSyk7CkBAIC0zMTU3LDE4ICszMTU3LDE4IEBA
IERlY29tcGlsZShTcHJpbnRTdGFjayAqc3MsIGpzYnl0ZWNvZGUgKnAKICAgICAgICAgICAgICAg
ICBicmVhazsKIAogICAgICAgICAgICAgICBjYXNlIEpTT1BfSVRFUjoKICAgICAgICAgICAgICAg
ICBmb3JlYWNoID0gKHBjWzFdICYgKEpTSVRFUl9GT1JFQUNIIHwgSlNJVEVSX0tFWVZBTFVFKSkg
PT0KICAgICAgICAgICAgICAgICAgICAgICAgICAgSlNJVEVSX0ZPUkVBQ0g7CiAgICAgICAgICAg
ICAgICAgdG9kbyA9IC0yOwogICAgICAgICAgICAgICAgIGJyZWFrOwogCi0gICAgICAgICAgICAg
IGNhc2UgSlNPUF9NT1JFSVRFUjoKLSAgICAgICAgICAgICAgICBKU19OT1RfUkVBQ0hFRCgiSlNP
UF9NT1JFSVRFUiIpOworICAgICAgICAgICAgICBjYXNlIEpTT1BfSEFTTkVYVDoKKyAgICAgICAg
ICAgICAgICBKU19OT1RfUkVBQ0hFRCgiSlNPUF9IQVNORVhUIik7CiAgICAgICAgICAgICAgICAg
YnJlYWs7CiAKICAgICAgICAgICAgICAgY2FzZSBKU09QX0VORElURVI6CiAgICAgICAgICAgICAg
ICAgc24gPSBqc19HZXRTcmNOb3RlKGpwLT5zY3JpcHQsIHBjKTsKICAgICAgICAgICAgICAgICB0
b2RvID0gLTI7CiAgICAgICAgICAgICAgICAgaWYgKHNuICYmIFNOX1RZUEUoc24pID09IFNSQ19I
SURERU4pCiAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICh2b2lk
KSBQb3BPZmYoc3MsIG9wKTsKQEAgLTMxNzgsMzAgKzMxNzgsMjkgQEAgRGVjb21waWxlKFNwcmlu
dFN0YWNrICpzcywganNieXRlY29kZSAqcAogICAgICAgICAgICAgICBjYXNlIEpTT1BfR09UT1g6
CiAgICAgICAgICAgICAgICAgc24gPSBqc19HZXRTcmNOb3RlKGpwLT5zY3JpcHQsIHBjKTsKICAg
ICAgICAgICAgICAgICBzd2l0Y2ggKHNuID8gU05fVFlQRShzbikgOiBTUkNfTlVMTCkgewogICAg
ICAgICAgICAgICAgICAgY2FzZSBTUkNfRk9SX0lOOgogICAgICAgICAgICAgICAgICAgICAvKgog
ICAgICAgICAgICAgICAgICAgICAgKiBUaGUgbG9vcCBiYWNrLWVkZ2UgY2FycmllcyArMSBzdGFj
ayBiYWxhbmNlLCBmb3IgdGhlCiAgICAgICAgICAgICAgICAgICAgICAqIGZsYWcgcHJvY2Vzc2Vk
IGJ5IEpTT1BfSUZORS4gV2UgZG8gbm90IGRlY29tcGlsZSB0aGUKICAgICAgICAgICAgICAgICAg
ICAgICogSlNPUF9JRk5FLCBhbmQgaW5zdGVhZCBwdXNoIHRoZSBsZWZ0LWhhbmQgc2lkZSBvZiAn
aW4nCi0gICAgICAgICAgICAgICAgICAgICAqIGFmdGVyIHRoZSBsb29wIGVkZ2UgaW4gdGhpcyBz
dGFjayBzbG90ICh0aGUgSlNPUF9GT1IqCi0gICAgICAgICAgICAgICAgICAgICAqIG9wY29kZXMn
IGRlY29tcGlsZXJzIGRvIHRoaXMgcHVzaGluZykuCisgICAgICAgICAgICAgICAgICAgICAqIGFm
dGVyIHRoZSBsb29wIGVkZ2UgaW4gdGhpcyBzdGFjayBzbG90ICg/Pz8pLgogICAgICAgICAgICAg
ICAgICAgICAgKi8KICAgICAgICAgICAgICAgICAgICAgY29uZCA9IEdldEp1bXBPZmZzZXQocGMs
IHBjKTsKICAgICAgICAgICAgICAgICAgICAgbmV4dCA9IGpzX0dldFNyY05vdGVPZmZzZXQoc24s
IDApOwogICAgICAgICAgICAgICAgICAgICB0YWlsID0ganNfR2V0U3JjTm90ZU9mZnNldChzbiwg
MSk7Ci0gICAgICAgICAgICAgICAgICAgIEpTX0FTU0VSVChwY1tjb25kXSA9PSBKU09QX01PUkVJ
VEVSKTsKKyAgICAgICAgICAgICAgICAgICAgSlNfQVNTRVJUKHBjW2NvbmRdID09IEpTT1BfSEFT
TkVYVCk7CiAgICAgICAgICAgICAgICAgICAgIERFQ09NUElMRV9DT0RFKHBjICsgb3BsZW4sIG5l
eHQgLSBvcGxlbik7CiAgICAgICAgICAgICAgICAgICAgIGx2YWwgPSBQT1BfU1RSKCk7CiAgICAg
ICAgICAgICAgICAgICAgIExPQ0FMX0FTU0VSVChzcy0+dG9wID49IDEpOwogCiAgICAgICAgICAg
ICAgICAgICAgIGlmIChzcy0+aW5BcnJheUluaXQgfHwgc3MtPmluR2VuRXhwKSB7CiAgICAgICAg
ICAgICAgICAgICAgICAgICBydmFsID0gUE9QX1NUUigpOwotICAgICAgICAgICAgICAgICAgICAg
ICAgaWYgKHNzLT50b3AgPj0gMSAmJiBzcy0+b3Bjb2Rlc1tzcy0+dG9wIC0gMV0gPT0gSlNPUF9G
T1JMT0NBTCkgeworICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHNzLT50b3AgPj0gMSAmJiBz
cy0+b3Bjb2Rlc1tzcy0+dG9wIC0gMV0gPT0gSlNPUF9TRVRMT0NBTCkgeyAvLz8/PwogICAgICAg
ICAgICAgICAgICAgICAgICAgICAgIHNzLT5zcHJpbnRlci5vZmZzZXQgPSBzcy0+b2Zmc2V0c1tz
cy0+dG9wXSAtIFBBUkVOX1NMT1A7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKFNw
cmludCgmc3MtPnNwcmludGVyLCAiICVzICglcyBpbiAlcykiLAogICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgZm9yZWFjaCA/IGpzX2Zvcl9lYWNoX3N0ciA6IGpzX2Zvcl9z
dHIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBsdmFsLCBydmFsKSA8
IDApIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIE5VTEw7CiAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgfQogCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
LyoKQEAgLTMyMTEsMTcgKzMyMTAsMTcgQEAgRGVjb21waWxlKFNwcmludFN0YWNrICpzcywganNi
eXRlY29kZSAqcAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAqIHdoZW4gbmVzdGluZyBm
b3IgaGVhZHMgaW4gYSBjb21wcmVoZW5zaW9uLgogICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAqLwogICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRvZG8gPSBzcy0+b2Zmc2V0c1tzcy0+
dG9wIC0gMV07CiAgICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAg
ICAgICAgICAgICAgICAgIHRvZG8gPSBTcHJpbnQoJnNzLT5zcHJpbnRlciwgIiAlcyAoJXMgaW4g
JXMpIiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZvcmVhY2gg
PyBqc19mb3JfZWFjaF9zdHIgOiBqc19mb3Jfc3RyLAogICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgbHZhbCwgcnZhbCk7CiAgICAgICAgICAgICAgICAgICAgICAgICB9
Ci0gICAgICAgICAgICAgICAgICAgICAgICBpZiAodG9kbyA8IDAgfHwgIVB1c2hPZmYoc3MsIHRv
ZG8sIEpTT1BfRk9STE9DQUwpKQorICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHRvZG8gPCAw
IHx8ICFQdXNoT2ZmKHNzLCB0b2RvLCBKU09QX1NFVExPQ0FMKSkgLy8/Pz8KICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICByZXR1cm4gTlVMTDsKICAgICAgICAgICAgICAgICAgICAgICAgIERF
Q09NUElMRV9DT0RFKHBjICsgbmV4dCwgY29uZCAtIG5leHQpOwogICAgICAgICAgICAgICAgICAg
ICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgICAgICAgLyoKICAgICAgICAgICAgICAgICAg
ICAgICAgICAqIEFzIGFib3ZlLCBydmFsIG9yIGFuIGV4dGVuc2lvbiBvZiBpdCBtdXN0IHJlbWFp
bgogICAgICAgICAgICAgICAgICAgICAgICAgICogc3RhY2tlZCBkdXJpbmcgbG9vcCBib2R5IGRl
Y29tcGlsYXRpb24uCiAgICAgICAgICAgICAgICAgICAgICAgICAgKi8KICAgICAgICAgICAgICAg
ICAgICAgICAgIHJ2YWwgPSBHZXRTdHIoc3MsIHNzLT50b3AgLSAxKTsKQEAgLTM0MjUsOTAgKzM0
MjQsMzcgQEAgRGVjb21waWxlKFNwcmludFN0YWNrICpzcywganNieXRlY29kZSAqcAogICAgICAg
ICAgICAgICAgIGN4LT5mcmVlXygoY2hhciAqKWx2YWwpOwogICAgICAgICAgICAgICAgIGJyZWFr
OwogCiAgICAgICAgICAgICAgIGNhc2UgSlNPUF9BTkQ6CiAgICAgICAgICAgICAgIGNhc2UgSlNP
UF9BTkRYOgogICAgICAgICAgICAgICAgIHh2YWwgPSAiJiYiOwogICAgICAgICAgICAgICAgIGdv
dG8gZG9fbG9naWNhbF9jb25uZWN0aXZlOwogCi0gICAgICAgICAgICAgIGNhc2UgSlNPUF9GT1JB
Ukc6Ci0gICAgICAgICAgICAgICAgc24gPSBOVUxMOwotICAgICAgICAgICAgICAgIGkgPSBHRVRf
QVJHTk8ocGMpOwotICAgICAgICAgICAgICAgIGdvdG8gZG9fZm9ydmFyc2xvdDsKLQotICAgICAg
ICAgICAgICBjYXNlIEpTT1BfRk9STE9DQUw6Ci0gICAgICAgICAgICAgICAgc24gPSBqc19HZXRT
cmNOb3RlKGpwLT5zY3JpcHQsIHBjKTsKLSAgICAgICAgICAgICAgICBpZiAoIUlzVmFyU2xvdChq
cCwgcGMsICZpKSkgewotICAgICAgICAgICAgICAgICAgICBKU19BU1NFUlQob3AgPT0gSlNPUF9G
T1JMT0NBTCk7Ci0gICAgICAgICAgICAgICAgICAgIHRvZG8gPSBTcHJpbnQoJnNzLT5zcHJpbnRl
ciwgc3NfZm9ybWF0LCBWYXJQcmVmaXgoc24pLCBHZXRTdHIoc3MsIGkpKTsKLSAgICAgICAgICAg
ICAgICAgICAgYnJlYWs7Ci0gICAgICAgICAgICAgICAgfQotCi0gICAgICAgICAgICAgIGRvX2Zv
cnZhcnNsb3Q6Ci0gICAgICAgICAgICAgICAgYXRvbSA9IEdldEFyZ09yVmFyQXRvbShqcCwgaSk7
Ci0gICAgICAgICAgICAgICAgTE9DQUxfQVNTRVJUKGF0b20pOwotICAgICAgICAgICAgICAgIHRv
ZG8gPSBTcHJpbnRDU3RyaW5nKCZzcy0+c3ByaW50ZXIsIFZhclByZWZpeChzbikpOwotICAgICAg
ICAgICAgICAgIGlmICh0b2RvIDwgMCB8fCAhUXVvdGVTdHJpbmcoJnNzLT5zcHJpbnRlciwgYXRv
bSwgMCkpCi0gICAgICAgICAgICAgICAgICAgIHJldHVybiBOVUxMOwotICAgICAgICAgICAgICAg
IGJyZWFrOwotCi0gICAgICAgICAgICAgIGNhc2UgSlNPUF9GT1JOQU1FOgotICAgICAgICAgICAg
ICBjYXNlIEpTT1BfRk9SR05BTUU6Ci0gICAgICAgICAgICAgICAgTE9BRF9BVE9NKDApOwotCi0g
ICAgICAgICAgICAgICAgc24gPSBqc19HZXRTcmNOb3RlKGpwLT5zY3JpcHQsIHBjKTsKLSAgICAg
ICAgICAgICAgICB0b2RvID0gU3ByaW50Q1N0cmluZygmc3MtPnNwcmludGVyLCBWYXJQcmVmaXgo
c24pKTsKLSAgICAgICAgICAgICAgICBpZiAodG9kbyA8IDAgfHwgIVF1b3RlU3RyaW5nKCZzcy0+
c3ByaW50ZXIsIGF0b20sIDApKQotICAgICAgICAgICAgICAgICAgICByZXR1cm4gTlVMTDsKLSAg
ICAgICAgICAgICAgICBicmVhazsKLQotICAgICAgICAgICAgICBjYXNlIEpTT1BfRk9SUFJPUDoK
LSAgICAgICAgICAgICAgICB4dmFsID0gTlVMTDsKLSAgICAgICAgICAgICAgICBMT0FEX0FUT00o
MCk7Ci0gICAgICAgICAgICAgICAgaWYgKCFBVE9NX0lTX0lERU5USUZJRVIoYXRvbSkpIHsKLSAg
ICAgICAgICAgICAgICAgICAgeHZhbCA9IFF1b3RlU3RyaW5nKCZzcy0+c3ByaW50ZXIsIGF0b20s
Ci0gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAoanNjaGFyKSdcJycpOwot
ICAgICAgICAgICAgICAgICAgICBpZiAoIXh2YWwpCi0gICAgICAgICAgICAgICAgICAgICAgICBy
ZXR1cm4gTlVMTDsKLSAgICAgICAgICAgICAgICB9Ci0gICAgICAgICAgICAgICAgbHZhbCA9IFBP
UF9TVFIoKTsKLSAgICAgICAgICAgICAgICBpZiAoeHZhbCkgewotICAgICAgICAgICAgICAgICAg
ICBKU19BU1NFUlQoKmx2YWwpOwotICAgICAgICAgICAgICAgICAgICB0b2RvID0gU3ByaW50KCZz
cy0+c3ByaW50ZXIsIGluZGV4X2Zvcm1hdCwgbHZhbCwgeHZhbCk7Ci0gICAgICAgICAgICAgICAg
fSBlbHNlIHsKLSAgICAgICAgICAgICAgICAgICAgdG9kbyA9IFNwcmludCgmc3MtPnNwcmludGVy
LCBzc19mb3JtYXQsIGx2YWwsICpsdmFsID8gIi4iIDogIiIpOwotICAgICAgICAgICAgICAgICAg
ICBpZiAodG9kbyA8IDApCi0gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gTlVMTDsKLSAg
ICAgICAgICAgICAgICAgICAgaWYgKCFRdW90ZVN0cmluZygmc3MtPnNwcmludGVyLCBhdG9tLCAw
KSkKLSAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBOVUxMOwotICAgICAgICAgICAgICAg
IH0KLSAgICAgICAgICAgICAgICBicmVhazsKLQotICAgICAgICAgICAgICBjYXNlIEpTT1BfRk9S
RUxFTToKLSAgICAgICAgICAgICAgICB0b2RvID0gU3ByaW50Q1N0cmluZygmc3MtPnNwcmludGVy
LCBmb3JlbGVtX2Nvb2tpZSk7CisgICAgICAgICAgICAgIGNhc2UgSlNPUF9ORVhUOgorICAgICAg
ICAgICAgICAgIHRvZG8gPSBTcHJpbnRDU3RyaW5nKCZzcy0+c3ByaW50ZXIsIG5leHRfY29va2ll
KTsKICAgICAgICAgICAgICAgICBicmVhazsKIAogICAgICAgICAgICAgICBjYXNlIEpTT1BfRU5V
TUVMRU06CiAgICAgICAgICAgICAgIGNhc2UgSlNPUF9FTlVNQ09OU1RFTEVNOgogICAgICAgICAg
ICAgICAgIC8qCiAgICAgICAgICAgICAgICAgICogVGhlIHN0YWNrIGhhcyB0aGUgb2JqZWN0IHVu
ZGVyIHRoZSAodG9wKSBpbmRleCBleHByZXNzaW9uLgogICAgICAgICAgICAgICAgICAqIFRoZSAi
cnZhbCIgcHJvcGVydHkgaWQgaXMgdW5kZXJuZWF0aCB0aG9zZSB0d28gb24gdGhlIHN0YWNrLgog
ICAgICAgICAgICAgICAgICAqIFRoZSBmb3IgbG9vcCBib2R5IG5ldCBhbmQgZ3Jvc3MgbGVuZ3Ro
cyBjYW4gbm93IGJlIGFkanVzdGVkCiAgICAgICAgICAgICAgICAgICogdG8gYWNjb3VudCBmb3Ig
dGhlIGxlbmd0aCBvZiB0aGUgaW5kZXhpbmcgZXhwcmVzc2lvbiB0aGF0Ci0gICAgICAgICAgICAg
ICAgICogY2FtZSBhZnRlciBKU09QX0ZPUkVMRU0gYW5kIGJlZm9yZSBKU09QX0VOVU1FTEVNLgor
ICAgICAgICAgICAgICAgICAqIGNhbWUgYWZ0ZXIgSlNPUF9ORVhUIGFuZCBiZWZvcmUgSlNPUF9F
TlVNRUxFTS4gPz8/CiAgICAgICAgICAgICAgICAgICovCiAgICAgICAgICAgICAgICAgYXRvbSA9
IE5VTEw7CiAgICAgICAgICAgICAgICAgb3AgPSBKU09QX05PUDsgICAgICAgICAgLyogdHVybiBv
ZmYgcGFyZW5zIGFyb3VuZCB4dmFsICovCiAgICAgICAgICAgICAgICAgeHZhbCA9IFBPUF9TVFIo
KTsKICAgICAgICAgICAgICAgICBvcCA9IEpTT1BfR0VURUxFTTsgICAgICAvKiBsdmFsIG11c3Qg
aGF2ZSBoaWdoIHByZWNlZGVuY2UgKi8KICAgICAgICAgICAgICAgICBsdmFsID0gUE9QX1NUUigp
OwogICAgICAgICAgICAgICAgIG9wID0gc2F2ZW9wOwogICAgICAgICAgICAgICAgIHJ2YWwgPSBQ
T1BfU1RSKCk7Ci0gICAgICAgICAgICAgICAgTE9DQUxfQVNTRVJUKHN0cmNtcChydmFsLCBmb3Jl
bGVtX2Nvb2tpZSkgPT0gMCk7CisgICAgICAgICAgICAgICAgTE9DQUxfQVNTRVJUKHN0cmNtcChy
dmFsLCBuZXh0X2Nvb2tpZSkgPT0gMCk7CiAgICAgICAgICAgICAgICAgaWYgKCp4dmFsID09ICdc
MCcpIHsKICAgICAgICAgICAgICAgICAgICAgdG9kbyA9IFNwcmludENTdHJpbmcoJnNzLT5zcHJp
bnRlciwgbHZhbCk7CiAgICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAg
ICAgdG9kbyA9IFNwcmludCgmc3MtPnNwcmludGVyLAogICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgIChKT0ZfT1BNT0RFKGxhc3RvcCkgPT0gSk9GX1hNTE5BTUUpCiAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgPyBkb3RfZm9ybWF0CiAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgOiBpbmRleF9mb3JtYXQsCiAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgbHZhbCwgeHZhbCk7CkBAIC0zNTM3LDE3ICszNDgzLDE3IEBAIERlY29tcGlsZShT
cHJpbnRTdGFjayAqc3MsIGpzYnl0ZWNvZGUgKnAKICAgICAgICAgICAgICAgICAgICAgcGMgPSBE
ZWNvbXBpbGVEZXN0cnVjdHVyaW5nKHNzLCBwYywgZW5kcGMpOwogICAgICAgICAgICAgICAgICAg
ICBpZiAoIXBjKQogICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIE5VTEw7CiAgICAgICAg
ICAgICAgICAgICAgIGxlbiA9IDA7CiAgICAgICAgICAgICAgICAgICAgIGx2YWwgPSBQT1BfU1RS
KCk7CiAgICAgICAgICAgICAgICAgICAgIG9wID0gc2F2ZW9wID0gSlNPUF9FTlVNRUxFTTsKICAg
ICAgICAgICAgICAgICAgICAgcnZhbCA9IFBPUF9TVFIoKTsKIAotICAgICAgICAgICAgICAgICAg
ICBpZiAoc3RyY21wKHJ2YWwsIGZvcmVsZW1fY29va2llKSA9PSAwKSB7CisgICAgICAgICAgICAg
ICAgICAgIGlmIChzdHJjbXAocnZhbCwgbmV4dF9jb29raWUpID09IDApIHsKICAgICAgICAgICAg
ICAgICAgICAgICAgIHRvZG8gPSBTcHJpbnQoJnNzLT5zcHJpbnRlciwgc3NfZm9ybWF0LAogICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBWYXJQcmVmaXgoc24pLCBsdmFsKTsK
IAogICAgICAgICAgICAgICAgICAgICAgICAgLy8gU2tpcCBQT1Agc28gdGhlIFNSQ19GT1JfSU4g
Y29kZSBjYW4gcG9wIGZvciBpdHNlbGYuCiAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoKnBj
ID09IEpTT1BfUE9QKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxlbiA9IEpTT1BfUE9Q
X0xFTkdUSDsKICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAg
ICAgICAgIHRvZG8gPSBTcHJpbnQoJnNzLT5zcHJpbnRlciwgIiVzJXMgPSAlcyIsCmRpZmYgLS1n
aXQgYS9qcy9zcmMvanNvcGNvZGUudGJsIGIvanMvc3JjL2pzb3Bjb2RlLnRibAotLS0gYS9qcy9z
cmMvanNvcGNvZGUudGJsCisrKyBiL2pzL3NyYy9qc29wY29kZS50YmwKQEAgLTEyMCwxOSArMTIw
LDE5IEBAIE9QREVGKEpTT1BfTEVBVkVXSVRILCA0LCAgImxlYXZld2l0aCIsICAKIE9QREVGKEpT
T1BfUkVUVVJOLCAgICA1LCAgInJldHVybiIsICAgICBOVUxMLCAgICAgICAgIDEsICAxLCAgMCwg
IDIsICBKT0ZfQllURSkKIE9QREVGKEpTT1BfR09UTywgICAgICA2LCAgImdvdG8iLCAgICAgICBO
VUxMLCAgICAgICAgIDMsICAwLCAgMCwgIDAsICBKT0ZfSlVNUCkKIE9QREVGKEpTT1BfSUZFUSwg
ICAgICA3LCAgImlmZXEiLCAgICAgICBOVUxMLCAgICAgICAgIDMsICAxLCAgMCwgIDQsICBKT0Zf
SlVNUHxKT0ZfREVURUNUSU5HKQogT1BERUYoSlNPUF9JRk5FLCAgICAgIDgsICAiaWZuZSIsICAg
ICAgIE5VTEwsICAgICAgICAgMywgIDEsICAwLCAgMCwgIEpPRl9KVU1QfEpPRl9QQVJFTkhFQUQp
CiAKIC8qIEdldCB0aGUgYXJndW1lbnRzIG9iamVjdCBmb3IgdGhlIGN1cnJlbnQsIGxpZ2h0d2Vp
Z2h0IGZ1bmN0aW9uIGFjdGl2YXRpb24uICovCiBPUERFRihKU09QX0FSR1VNRU5UUywgOSwganNf
YXJndW1lbnRzX3N0ciwganNfYXJndW1lbnRzX3N0ciwgMSwgMCwgMSwgMTgsIEpPRl9CWVRFKQog
Ci0vKiBFQ01BLWNvbXBsaWFudCBmb3ItaW4gbG9vcCB3aXRoIGFyZ3VtZW50IG9yIGxvY2FsIGxv
b3AgY29udHJvbC4gKi8KLU9QREVGKEpTT1BfRk9SQVJHLCAgICAxMCwgImZvcmFyZyIsICAgICBO
VUxMLCAgICAgICAgIDMsICAxLCAgMSwgMTksICBKT0ZfUUFSR3xKT0ZfTkFNRXxKT0ZfRk9SfEpP
Rl9UTVBTTE9UKQotT1BERUYoSlNPUF9GT1JMT0NBTCwgIDExLCAiZm9ybG9jYWwiLCAgIE5VTEws
ICAgICAgICAgMywgIDEsICAxLCAxOSwgIEpPRl9MT0NBTHxKT0ZfTkFNRXxKT0ZfRk9SfEpPRl9U
TVBTTE9UKQorLyogUHVzaCB0aGUgbmV4dCBpdGVyYXRpb24gdmFsdWUgaW4gYSBmb3ItaW4gbG9v
cC4gKi8KK09QREVGKEpTT1BfU1dBUCwgICAgICAxMCwgInN3YXAiLCAgICAgICBOVUxMLCAgICAg
ICAgIDEsICAyLCAgMiwgIDAsICBKT0ZfQllURSkKK09QREVGKEpTT1BfVU5VU0VEMTEsICAxMSwg
TlVMTCwgICAgICAgICBOVUxMLCAgICAgICAgIDAsICAwLCAgMCwgIDAsICAwKQogCiAvKiBNb3Jl
IGxvbmctc3RhbmRpbmcgYnl0ZWNvZGVzLiAqLwogT1BERUYoSlNPUF9EVVAsICAgICAgIDEyLCAi
ZHVwIiwgICAgICAgIE5VTEwsICAgICAgICAgMSwgIDEsICAyLCAgMCwgIEpPRl9CWVRFKQogT1BE
RUYoSlNPUF9EVVAyLCAgICAgIDEzLCAiZHVwMiIsICAgICAgIE5VTEwsICAgICAgICAgMSwgIDIs
ICA0LCAgMCwgIEpPRl9CWVRFKQogT1BERUYoSlNPUF9TRVRDT05TVCwgIDE0LCAic2V0Y29uc3Qi
LCAgIE5VTEwsICAgICAgICAgMywgIDEsICAxLCAgMywgIEpPRl9BVE9NfEpPRl9OQU1FfEpPRl9T
RVQpCiBPUERFRihKU09QX0JJVE9SLCAgICAgMTUsICJiaXRvciIsICAgICAgInwiLCAgICAgICAg
ICAxLCAgMiwgIDEsICA3LCAgSk9GX0JZVEV8Sk9GX0xFRlRBU1NPQykKIE9QREVGKEpTT1BfQklU
WE9SLCAgICAxNiwgImJpdHhvciIsICAgICAiXiIsICAgICAgICAgIDEsICAyLCAgMSwgIDgsICBK
T0ZfQllURXxKT0ZfTEVGVEFTU09DKQogT1BERUYoSlNPUF9CSVRBTkQsICAgIDE3LCAiYml0YW5k
IiwgICAgICImIiwgICAgICAgICAgMSwgIDIsICAxLCAgOSwgIEpPRl9CWVRFfEpPRl9MRUZUQVNT
T0MpCkBAIC0yMDUsMjkgKzIwNSwzMiBAQCBPUERFRihKU09QX1NUUklDVE5FLCAgNzMsICJzdHJp
Y3RuZSIsICAgCiAgKi8KIE9QREVGKEpTT1BfU0VUQ0FMTCwgICA3NCwgInNldGNhbGwiLCAgICBO
VUxMLCAgICAgICAgIDEsICAxLCAgMiwgMTgsICBKT0ZfQllURSkKIAogLyoKICAqIEpTT1BfSVRF
UiBzZXRzIHVwIGEgZm9yLWluIG9yIGZvci1lYWNoLWluIGxvb3AgdXNpbmcgdGhlIEpTSVRFUl8q
IGZsYWcgYml0cwogICogaW4gdGhpcyBvcCdzIHVpbnQ4IGltbWVkaWF0ZSBvcGVyYW5kLiBJdCBy
ZXBsYWNlcyB0aGUgdG9wIG9mIHN0YWNrIHZhbHVlCiAgKiB3aXRoIGFuIGl0ZXJhdG9yIGZvciB0
aGF0IHZhbHVlLgogICoKLSAqIEpTT1BfTU9SRUlURVIgc3RvcmVzIHRoZSBuZXh0IGl0ZXJhdGVk
IHZhbHVlIGludG8gY3gtPml0ZXJWYWx1ZSBhbmQgcHVzaGVzCisgKiBKU09QX0hBU05FWFQgc3Rv
cmVzIHRoZSBuZXh0IGl0ZXJhdGVkIHZhbHVlIGludG8gY3gtPml0ZXJWYWx1ZSBhbmQgcHVzaGVz
CiAgKiB0cnVlIGlmIGFub3RoZXIgdmFsdWUgaXMgYXZhaWxhYmxlLCBhbmQgZmFsc2Ugb3RoZXJ3
aXNlLiBJdCBpcyBmb2xsb3dlZAogICogaW1tZWRpYXRlbHkgYnkgSlNPUF9JRk5FeyxYfS4KICAq
CisgKiBKU09QX05FWFQgcHVzaGVzIHRoZSBuZXh0IGl0ZXJhdGVkIHZhbHVlIGRldGVybWluZWQg
YnkgSlNPUF9IQVNORVhULiBJdAorICogaXMgb3JkaW5hcmlseSBmb2xsb3dlZCBieSBhIEpTT1Bf
U0VUKiBpbnN0cnVjdGlvbi4KKyAqCiAgKiBKU09QX0VORElURVIgY2xlYW5zIHVwIGFmdGVyIHRo
ZSBsb29wLiBJdCB1c2VzIHRoZSBzbG90IGFib3ZlIHRoZSBpdGVyYXRvcgogICogZm9yIHRlbXBv
cmFyeSBHQyByb290aW5nLgogICovCiBPUERFRihKU09QX0lURVIsICAgICAgNzUsICJpdGVyIiwg
ICAgICAgTlVMTCwgICAgICAgICAyLCAgMSwgIDEsICAwLCAgSk9GX1VJTlQ4KQotT1BERUYoSlNP
UF9NT1JFSVRFUiwgIDc2LCAibW9yZWl0ZXIiLCAgIE5VTEwsICAgICAgICAgMSwgIDEsICAyLCAg
MCwgIEpPRl9CWVRFKQotT1BERUYoSlNPUF9FTkRJVEVSLCAgIDc3LCAiZW5kaXRlciIsICAgIE5V
TEwsICAgICAgICAgMSwgIDEsICAwLCAgMCwgIEpPRl9CWVRFKQorT1BERUYoSlNPUF9IQVNORVhU
LCAgIDc2LCAiaGFzbmV4dCIsICAgIE5VTEwsICAgICAgICAgMSwgIDEsICAyLCAgMCwgIEpPRl9C
WVRFKQorT1BERUYoSlNPUF9ORVhULCAgICAgIDc3LCAibmV4dCIsICAgICAgIE5VTEwsICAgICAg
ICAgMiwgIDAsICAxLCAgMCwgIEpPRl9VSU5UOCkKK09QREVGKEpTT1BfRU5ESVRFUiwgICA3OCwg
ImVuZGl0ZXIiLCAgICBOVUxMLCAgICAgICAgIDEsICAxLCAgMCwgIDAsICBKT0ZfQllURSkKIAot
T1BERUYoSlNPUF9GVU5BUFBMWSwgIDc4LCAiZnVuYXBwbHkiLCAgIE5VTEwsICAgICAgICAgMywg
LTEsICAxLCAxOCwgIEpPRl9VSU5UMTZ8Sk9GX0lOVk9LRSkKLU9QREVGKEpTT1BfU1dBUCwgICAg
ICA3OSwgInN3YXAiLCAgICAgICBOVUxMLCAgICAgICAgIDEsICAyLCAgMiwgIDAsICBKT0ZfQllU
RSkKK09QREVGKEpTT1BfRlVOQVBQTFksICA3OSwgImZ1bmFwcGx5IiwgICBOVUxMLCAgICAgICAg
IDMsIC0xLCAgMSwgMTgsICBKT0ZfVUlOVDE2fEpPRl9JTlZPS0UpCiAKIC8qIFB1c2ggb2JqZWN0
IGxpdGVyYWw6IGVpdGhlciBhbiBYTUwgb2JqZWN0IG9yIGluaXRpYWxpc2VyIG9iamVjdC4gKi8K
IE9QREVGKEpTT1BfT0JKRUNULCAgICA4MCwgIm9iamVjdCIsICAgICBOVUxMLCAgICAgICAgIDMs
ICAwLCAgMSwgMTksICBKT0ZfT0JKRUNUKQogCiAvKiBQb3AgdmFsdWUgYW5kIGRpc2NhcmQgaXQu
ICovCiBPUERFRihKU09QX1BPUCwgICAgICAgODEsICJwb3AiLCAgICAgICAgTlVMTCwgICAgICAg
ICAxLCAgMSwgIDAsICAyLCAgSk9GX0JZVEUpCiAKIC8qIENhbGwgYSBmdW5jdGlvbiBhcyBhIGNv
bnN0cnVjdG9yOyBvcGVyYW5kIGlzIGFyZ2MuICovCkBAIC0yNjgsMjIgKzI3MSwyMyBAQCBPUERF
RihKU09QX0RFQ0FSRywgICAgOTgsICJkZWNhcmciLCAgICAgCiBPUERFRihKU09QX0FSR0lOQywg
ICAgOTksICJhcmdpbmMiLCAgICAgTlVMTCwgICAgICAgICAzLCAgMCwgIDEsIDE1LCAgSk9GX1FB
UkcgfEpPRl9OQU1FfEpPRl9JTkN8Sk9GX1BPU1R8Sk9GX1RNUFNMT1QzKQogT1BERUYoSlNPUF9B
UkdERUMsICAgMTAwLCAiYXJnZGVjIiwgICAgIE5VTEwsICAgICAgICAgMywgIDAsICAxLCAxNSwg
IEpPRl9RQVJHIHxKT0ZfTkFNRXxKT0ZfREVDfEpPRl9QT1NUfEpPRl9UTVBTTE9UMykKIAogT1BE
RUYoSlNPUF9JTkNMT0NBTCwgIDEwMSwiaW5jbG9jYWwiLCAgIE5VTEwsICAgICAgICAgMywgIDAs
ICAxLCAxNSwgIEpPRl9MT0NBTHxKT0ZfTkFNRXxKT0ZfSU5DfEpPRl9UTVBTTE9UMykKIE9QREVG
KEpTT1BfREVDTE9DQUwsICAxMDIsImRlY2xvY2FsIiwgICBOVUxMLCAgICAgICAgIDMsICAwLCAg
MSwgMTUsICBKT0ZfTE9DQUx8Sk9GX05BTUV8Sk9GX0RFQ3xKT0ZfVE1QU0xPVDMpCiBPUERFRihK
U09QX0xPQ0FMSU5DLCAgMTAzLCJsb2NhbGluYyIsICAgTlVMTCwgICAgICAgICAzLCAgMCwgIDEs
IDE1LCAgSk9GX0xPQ0FMfEpPRl9OQU1FfEpPRl9JTkN8Sk9GX1BPU1R8Sk9GX1RNUFNMT1QzKQog
T1BERUYoSlNPUF9MT0NBTERFQywgIDEwNCwibG9jYWxkZWMiLCAgIE5VTEwsICAgICAgICAgMywg
IDAsICAxLCAxNSwgIEpPRl9MT0NBTHxKT0ZfTkFNRXxKT0ZfREVDfEpPRl9QT1NUfEpPRl9UTVBT
TE9UMykKIAorLyogPz8/LiAqLwogT1BERUYoSlNPUF9JTUFDT1AsICAgIDEwNSwiaW1hY29wIiwg
ICAgIE5VTEwsICAgICAgICAgMSwgIDAsICAwLCAgMCwgIEpPRl9CWVRFKQogCi0vKiBFQ01BLWNv
bXBsaWFudCBmb3IvaW4gb3BzLiAqLwotT1BERUYoSlNPUF9GT1JOQU1FLCAgIDEwNiwiZm9ybmFt
ZSIsICAgIE5VTEwsICAgICAgICAgMywgIDEsICAxLCAxOSwgIEpPRl9BVE9NfEpPRl9OQU1FfEpP
Rl9GT1J8Sk9GX1RNUFNMT1QzKQotT1BERUYoSlNPUF9GT1JQUk9QLCAgIDEwNywiZm9ycHJvcCIs
ICAgIE5VTEwsICAgICAgICAgMywgIDIsICAxLCAxOCwgIEpPRl9BVE9NfEpPRl9QUk9QfEpPRl9G
T1J8Sk9GX1RNUFNMT1QzKQotT1BERUYoSlNPUF9GT1JFTEVNLCAgIDEwOCwiZm9yZWxlbSIsICAg
IE5VTEwsICAgICAgICAgMSwgIDEsICAyLCAxOCwgIEpPRl9CWVRFIHxKT0ZfRUxFTXxKT0ZfRk9S
KQorLyogPz8/LiAqLworT1BERUYoSlNPUF9VTlVTRUQxMDYsIDEwNixOVUxMLCAgICAgICAgIE5V
TEwsICAgICAgICAgMCwgIDAsICAwLCAgMCwgIDApCitPUERFRihKU09QX1VOVVNFRDEwNywgMTA3
LE5VTEwsICAgICAgICAgTlVMTCwgICAgICAgICAwLCAgMCwgIDAsICAwLCAgMCkKK09QREVGKEpT
T1BfVU5VU0VEMTA4LCAxMDgsTlVMTCwgICAgICAgICBOVUxMLCAgICAgICAgIDAsICAwLCAgMCwg
IDAsICAwKQogT1BERUYoSlNPUF9QT1BOLCAgICAgIDEwOSwicG9wbiIsICAgICAgIE5VTEwsICAg
ICAgICAgMywgLTEsICAwLCAgMCwgIEpPRl9VSU5UMTYpCiAKIC8qIEVDTUEtY29tcGxpYW50IGFz
c2lnbm1lbnQgb3BzLiAqLwogT1BERUYoSlNPUF9CSU5ETkFNRSwgIDExMCwiYmluZG5hbWUiLCAg
IE5VTEwsICAgICAgICAgMywgIDAsICAxLCAgMCwgIEpPRl9BVE9NfEpPRl9OQU1FfEpPRl9TRVQp
CiBPUERFRihKU09QX1NFVE5BTUUsICAgMTExLCJzZXRuYW1lIiwgICAgTlVMTCwgICAgICAgICAz
LCAgMiwgIDEsICAzLCAgSk9GX0FUT018Sk9GX05BTUV8Sk9GX1NFVHxKT0ZfREVURUNUSU5HKQog
CiAvKiBFeGNlcHRpb24gaGFuZGxpbmcgb3BzLiAqLwogT1BERUYoSlNPUF9USFJPVywgICAgIDEx
Mixqc190aHJvd19zdHIsIE5VTEwsICAgICAgICAgMSwgIDEsICAwLCAgMCwgIEpPRl9CWVRFKQpA
QCAtNjA5LDEwICs2MTMsOCBAQCBPUERFRihKU09QX1VOQlJBTkRUSElTLCAgIDIzOCwidW5icmFu
ZHRoCiBPUERFRihKU09QX1NIQVJQSU5JVCwgICAgIDIzOSwic2hhcnBpbml0IiwgICAgIE5VTEws
ICAzLCAgMCwgIDAsICAwLCAgSk9GX1VJTlQxNnxKT0ZfU0hBUlBTTE9UKQogCiAvKiBTdGF0aWMg
YmluZGluZyBmb3IgZ2xvYmFscy4gKi8KIE9QREVGKEpTT1BfR0VUR0xPQkFMLCAgICAgMjQwLCJn
ZXRnbG9iYWwiLCAgICAgTlVMTCwgIDMsICAwLCAgMSwgMTksICBKT0ZfR0xPQkFMfEpPRl9OQU1F
KQogT1BERUYoSlNPUF9DQUxMR0xPQkFMLCAgICAyNDEsImNhbGxnbG9iYWwiLCAgICBOVUxMLCAg
MywgIDAsICAyLCAxOSwgIEpPRl9HTE9CQUx8Sk9GX05BTUV8Sk9GX0NBTExPUCkKIAogLyogTGlr
ZSBKU09QX0ZVTkFQUExZIGJ1dCBmb3IgZi5jYWxsIGluc3RlYWQgb2YgZi5hcHBseS4gKi8KIE9Q
REVGKEpTT1BfRlVOQ0FMTCwgICAgICAgMjQyLCJmdW5jYWxsIiwgICAgICAgTlVMTCwgIDMsIC0x
LCAgMSwgMTgsICBKT0ZfVUlOVDE2fEpPRl9JTlZPS0UpCi0KLU9QREVGKEpTT1BfRk9SR05BTUUs
ICAgICAgMjQzLCJmb3JnbmFtZSIsICAgICAgTlVMTCwgIDMsICAxLCAgMSwgMTksICBKT0ZfQVRP
TXxKT0ZfR05BTUV8Sk9GX0ZPUnxKT0ZfVE1QU0xPVDMpCmRpZmYgLS1naXQgYS9qcy9zcmMvanNw
YXJzZS5jcHAgYi9qcy9zcmMvanNwYXJzZS5jcHAKLS0tIGEvanMvc3JjL2pzcGFyc2UuY3BwCisr
KyBiL2pzL3NyYy9qc3BhcnNlLmNwcApAQCAtNTExNCwxNyArNTExNCwxNyBAQCBQYXJzZXI6OmZv
clN0YXRlbWVudCgpCiAgICAgICogYXMgd2UndmUgZXhjbHVkZWQgJ2luJyBmcm9tIGJlaW5nIHBh
cnNlZCBpbiBSZWxFeHByIGJ5IHNldHRpbmcKICAgICAgKiB0aGUgVENGX0lOX0ZPUl9JTklUIGZs
YWcgaW4gb3VyIEpTVHJlZUNvbnRleHQuCiAgICAgICovCiAgICAgaWYgKHBuMSAmJiB0b2tlblN0
cmVhbS5tYXRjaFRva2VuKFRPS19JTikpIHsKICAgICAgICAgcG4tPnBuX2lmbGFncyB8PSBKU0lU
RVJfRU5VTUVSQVRFOwogICAgICAgICBzdG10SW5mby50eXBlID0gU1RNVF9GT1JfSU5fTE9PUDsK
IAogICAgICAgICAvKiBDaGVjayB0aGF0IHRoZSBsZWZ0IHNpZGUgb2YgdGhlICdpbicgaXMgdmFs
aWQuICovCi0gICAgICAgIEpTX0FTU0VSVCghVG9rZW5LaW5kSXNEZWNsKHR0KSB8fCBQTl9UWVBF
KHBuMSkgPT0gdHQpOworICAgICAgICBKU19BU1NFUlRfSUYoVG9rZW5LaW5kSXNEZWNsKHR0KSwg
UE5fVFlQRShwbjEpID09IHR0KTsKICAgICAgICAgaWYgKFRva2VuS2luZElzRGVjbCh0dCkKICAg
ICAgICAgICAgID8gKHBuMS0+cG5fY291bnQgPiAxIHx8IHBuMS0+cG5fb3AgPT0gSlNPUF9ERUZD
T05TVAogI2lmIEpTX0hBU19ERVNUUlVDVFVSSU5HCiAgICAgICAgICAgICAgICB8fCAodmVyc2lv
bk51bWJlcigpID09IEpTVkVSU0lPTl8xXzcgJiYKICAgICAgICAgICAgICAgICAgICBwbi0+cG5f
b3AgPT0gSlNPUF9JVEVSICYmCiAgICAgICAgICAgICAgICAgICAgIShwbi0+cG5faWZsYWdzICYg
SlNJVEVSX0ZPUkVBQ0gpICYmCiAgICAgICAgICAgICAgICAgICAgKHBuMS0+cG5faGVhZC0+cG5f
dHlwZSA9PSBUT0tfUkMgfHwKICAgICAgICAgICAgICAgICAgICAgKHBuMS0+cG5faGVhZC0+cG5f
dHlwZSA9PSBUT0tfUkIgJiYKQEAgLTUxNTMsODkgKzUxNTMsNDAgQEAgUGFyc2VyOjpmb3JTdGF0
ZW1lbnQoKQogICAgICAgICAgICAgcmV0dXJuIE5VTEw7CiAgICAgICAgIH0KIAogICAgICAgICAv
KiBwbjIgcG9pbnRzIHRvIHRoZSBuYW1lIG9yIGRlc3RydWN0dXJpbmcgcGF0dGVybiBvbiBpbidz
IGxlZnQuICovCiAgICAgICAgIEpTUGFyc2VOb2RlICpwbjIgPSBOVUxMOwogICAgICAgICB1aW50
TiBkZmxhZyA9IFBORF9BU1NJR05FRDsKIAogICAgICAgICBpZiAoVG9rZW5LaW5kSXNEZWNsKHR0
KSkgewotICAgICAgICAgICAgLyogVGVsbCBqc19FbWl0VHJlZShUT0tfVkFSKSB0aGF0IHBuMSBp
cyBwYXJ0IG9mIGEgZm9yL2luLiAqLwotICAgICAgICAgICAgcG4xLT5wbl94ZmxhZ3MgfD0gUE5Y
X0ZPUklOVkFSOwotCiAgICAgICAgICAgICAvKgotICAgICAgICAgICAgICogUmV3cml0ZSAnZm9y
ICg8ZGVjbD4geCA9IGkgaW4gbyknIHdoZXJlIDxkZWNsPiBpcyAndmFyJyBvcgotICAgICAgICAg
ICAgICogJ2NvbnN0JyB0byBob2lzdCB0aGUgaW5pdGlhbGl6ZXIgb3IgdGhlIGVudGlyZSBkZWNs
IG91dCBvZgotICAgICAgICAgICAgICogdGhlIGxvb3AgaGVhZC4gVE9LX1ZBUiBpcyB0aGUgdHlw
ZSBmb3IgYm90aCAndmFyJyBhbmQgJ2NvbnN0Jy4KKyAgICAgICAgICAgICAqIFRlbGwganNlbWl0
LmNwcDpFbWl0VmFyaWFibGVzIHRoYXQgdGhlIGJ5dGVjb2RlIGZvciB0aGlzIGRlY2wKKyAgICAg
ICAgICAgICAqIHNob3VsZCBub3QgbGVhdmUgYSB2YWx1ZSBvbiB0aGUgc3RhY2suCiAgICAgICAg
ICAgICAgKi8KKyAgICAgICAgICAgIHBuMS0+cG5feGZsYWdzIHw9IFBOWF9QT1BWQVI7CisKKyAg
ICAgICAgICAgIC8qIEJhbiAnZm9yIChsZXQgeCA9IGkgaW4gbyknLiAqLwogICAgICAgICAgICAg
cG4yID0gcG4xLT5wbl9oZWFkOwogICAgICAgICAgICAgaWYgKChwbjItPnBuX3R5cGUgPT0gVE9L
X05BTUUgJiYgcG4yLT5tYXliZUV4cHIoKSkKICNpZiBKU19IQVNfREVTVFJVQ1RVUklORwogICAg
ICAgICAgICAgICAgIHx8IHBuMi0+cG5fdHlwZSA9PSBUT0tfQVNTSUdOCiAjZW5kaWYKICAgICAg
ICAgICAgICAgICApIHsKICNpZiBKU19IQVNfQkxPQ0tfU0NPUEUKICAgICAgICAgICAgICAgICBp
ZiAodHQgPT0gVE9LX0xFVCkgewogICAgICAgICAgICAgICAgICAgICByZXBvcnRFcnJvck51bWJl
cihwbjIsIEpTUkVQT1JUX0VSUk9SLCBKU01TR19JTlZBTElEX0ZPUl9JTl9JTklUKTsKICAgICAg
ICAgICAgICAgICAgICAgcmV0dXJuIE5VTEw7CiAgICAgICAgICAgICAgICAgfQogI2VuZGlmIC8q
IEpTX0hBU19CTE9DS19TQ09QRSAqLwotCi0gICAgICAgICAgICAgICAgcG5zZXEgPSBMaXN0Tm9k
ZTo6Y3JlYXRlKHRjKTsKLSAgICAgICAgICAgICAgICBpZiAoIXBuc2VxKQotICAgICAgICAgICAg
ICAgICAgICByZXR1cm4gTlVMTDsKLSAgICAgICAgICAgICAgICBwbnNlcS0+cG5fdHlwZSA9IFRP
S19TRVE7Ci0gICAgICAgICAgICAgICAgcG5zZXEtPnBuX3Bvcy5iZWdpbiA9IHBuLT5wbl9wb3Mu
YmVnaW47Ci0KLSAgICAgICAgICAgICAgICBkZmxhZyA9IFBORF9JTklUSUFMSVpFRDsKLQotICAg
ICAgICAgICAgICAgIC8qCi0gICAgICAgICAgICAgICAgICogQWxsIG9mICd2YXIgeCA9IGknIGlz
IGhvaXN0ZWQgYWJvdmUgJ2ZvciAoeCBpbiBvKScsCi0gICAgICAgICAgICAgICAgICogc28gY2xl
YXIgUE5YX0ZPUklOVkFSLgotICAgICAgICAgICAgICAgICAqCi0gICAgICAgICAgICAgICAgICog
UmVxdWVzdCBKU09QX1BPUCBoZXJlIHNpbmNlIHRoZSB2YXIgaXMgZm9yIGEgc2ltcGxlCi0gICAg
ICAgICAgICAgICAgICogbmFtZSAoaXQgaXMgbm90IGEgZGVzdHJ1Y3R1cmluZyBiaW5kaW5nJ3Mg
bGVmdC1oYW5kCi0gICAgICAgICAgICAgICAgICogc2lkZSkgYW5kIGl0IGhhcyBhbiBpbml0aWFs
aXplci4KLSAgICAgICAgICAgICAgICAgKi8KLSAgICAgICAgICAgICAgICBwbjEtPnBuX3hmbGFn
cyAmPSB+UE5YX0ZPUklOVkFSOwotICAgICAgICAgICAgICAgIHBuMS0+cG5feGZsYWdzIHw9IFBO
WF9QT1BWQVI7Ci0gICAgICAgICAgICAgICAgcG5zZXEtPmluaXRMaXN0KHBuMSk7Ci0KLSNpZiBK
U19IQVNfREVTVFJVQ1RVUklORwotICAgICAgICAgICAgICAgIGlmIChwbjItPnBuX3R5cGUgPT0g
VE9LX0FTU0lHTikgewotICAgICAgICAgICAgICAgICAgICBwbjEgPSBDbG9uZVBhcnNlVHJlZShw
bjItPnBuX2xlZnQsIHRjKTsKLSAgICAgICAgICAgICAgICAgICAgaWYgKCFwbjEpCi0gICAgICAg
ICAgICAgICAgICAgICAgICByZXR1cm4gTlVMTDsKLSAgICAgICAgICAgICAgICB9IGVsc2UKLSNl
bmRpZgotICAgICAgICAgICAgICAgIHsKLSAgICAgICAgICAgICAgICAgICAgSlNfQVNTRVJUKHBu
Mi0+cG5fdHlwZSA9PSBUT0tfTkFNRSk7Ci0gICAgICAgICAgICAgICAgICAgIHBuMSA9IE5hbWVO
b2RlOjpjcmVhdGUocG4yLT5wbl9hdG9tLCB0Yyk7Ci0gICAgICAgICAgICAgICAgICAgIGlmICgh
cG4xKQotICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIE5VTEw7Ci0gICAgICAgICAgICAg
ICAgICAgIHBuMS0+cG5fdHlwZSA9IFRPS19OQU1FOwotICAgICAgICAgICAgICAgICAgICBwbjEt
PnBuX29wID0gSlNPUF9OQU1FOwotICAgICAgICAgICAgICAgICAgICBwbjEtPnBuX3BvcyA9IHBu
Mi0+cG5fcG9zOwotICAgICAgICAgICAgICAgICAgICBpZiAocG4yLT5wbl9kZWZuKQotICAgICAg
ICAgICAgICAgICAgICAgICAgTGlua1VzZVRvRGVmKHBuMSwgKEpTRGVmaW5pdGlvbiAqKSBwbjIs
IHRjKTsKLSAgICAgICAgICAgICAgICB9Ci0gICAgICAgICAgICAgICAgcG4yID0gcG4xOwotICAg
ICAgICAgICAgfQotICAgICAgICB9Ci0KLSAgICAgICAgaWYgKCFwbjIpIHsKKyAgICAgICAgICAg
IH0KKyAgICAgICAgfSBlbHNlIHsKKyAgICAgICAgICAgIGlmICghY29udmVydEFzc2lnbm1lbnRM
aHMocG4xLCBKU09QX05PUCkpCisgICAgICAgICAgICAgICAgcmV0dXJuIE5VTEw7CiAgICAgICAg
ICAgICBwbjIgPSBwbjE7Ci0gICAgICAgICAgICBpZiAocG4yLT5wbl90eXBlID09IFRPS19MUCAm
JgotICAgICAgICAgICAgICAgICFNYWtlU2V0Q2FsbChjb250ZXh0LCBwbjIsIHRjLCBKU01TR19C
QURfTEVGVFNJREVfT0ZfQVNTKSkgewotICAgICAgICAgICAgICAgIHJldHVybiBOVUxMOwotICAg
ICAgICAgICAgfQotI2lmIEpTX0hBU19YTUxfU1VQUE9SVAotICAgICAgICAgICAgaWYgKHBuMi0+
cG5fdHlwZSA9PSBUT0tfVU5BUllPUCkKLSAgICAgICAgICAgICAgICBwbjItPnBuX29wID0gSlNP
UF9CSU5EWE1MTkFNRTsKLSNlbmRpZgogICAgICAgICB9CiAKICAgICAgICAgc3dpdGNoIChwbjIt
PnBuX3R5cGUpIHsKICAgICAgICAgICBjYXNlIFRPS19OQU1FOgogICAgICAgICAgICAgLyogQmV3
YXJlICdmb3IgKGFyZ3VtZW50cyBpbiAuLi4pJyB3aXRoIG9yIHdpdGhvdXQgYSAndmFyJy4gKi8K
ICAgICAgICAgICAgIE5vdGVMVmFsdWUoY29udGV4dCwgcG4yLCB0YywgZGZsYWcpOwogICAgICAg
ICAgICAgYnJlYWs7CiAKQEAgLTYxNzgsMTggKzYxMjksMTcgQEAgUGFyc2VyOjp2YXJpYWJsZXMo
Ym9vbCBpbkxldEhlYWQpCiAgICAgICAgICAgICB0Yy0+ZmxhZ3MgfD0gVENGX0RFQ0xfREVTVFJV
Q1RVUklORzsKICAgICAgICAgICAgIHBuMiA9IHByaW1hcnlFeHByKHR0LCBKU19GQUxTRSk7CiAg
ICAgICAgICAgICB0Yy0+ZmxhZ3MgJj0gflRDRl9ERUNMX0RFU1RSVUNUVVJJTkc7CiAgICAgICAg
ICAgICBpZiAoIXBuMikKICAgICAgICAgICAgICAgICByZXR1cm4gTlVMTDsKIAogICAgICAgICAg
ICAgaWYgKCFDaGVja0Rlc3RydWN0dXJpbmcoY29udGV4dCwgJmRhdGEsIHBuMiwgdGMpKQogICAg
ICAgICAgICAgICAgIHJldHVybiBOVUxMOwotICAgICAgICAgICAgaWYgKCh0Yy0+ZmxhZ3MgJiBU
Q0ZfSU5fRk9SX0lOSVQpICYmCi0gICAgICAgICAgICAgICAgdG9rZW5TdHJlYW0ucGVla1Rva2Vu
KCkgPT0gVE9LX0lOKSB7CisgICAgICAgICAgICBpZiAoKHRjLT5mbGFncyAmIFRDRl9JTl9GT1Jf
SU5JVCkgJiYgdG9rZW5TdHJlYW0ucGVla1Rva2VuKCkgPT0gVE9LX0lOKSB7CiAgICAgICAgICAg
ICAgICAgcG4tPmFwcGVuZChwbjIpOwogICAgICAgICAgICAgICAgIGNvbnRpbnVlOwogICAgICAg
ICAgICAgfQogCiAgICAgICAgICAgICBNVVNUX01BVENIX1RPS0VOKFRPS19BU1NJR04sIEpTTVNH
X0JBRF9ERVNUUlVDVF9ERUNMKTsKICAgICAgICAgICAgIGlmICh0b2tlblN0cmVhbS5jdXJyZW50
VG9rZW4oKS50X29wICE9IEpTT1BfTk9QKQogICAgICAgICAgICAgICAgIGdvdG8gYmFkX3Zhcl9p
bml0OwogCkBAIC02NTAxLDc5ICs2NDUxLDg4IEBAIFBhcnNlcjo6Y29uZEV4cHIxKCkKICAgICAg
ICAgcG4tPnBuX2tpZDEgPSBwbjE7CiAgICAgICAgIHBuLT5wbl9raWQyID0gcG4yOwogICAgICAg
ICBwbi0+cG5fa2lkMyA9IHBuMzsKICAgICAgICAgdG9rZW5TdHJlYW0uZ2V0VG9rZW4oKTsgICAg
IC8qIG5lZWQgdG8gcmVhZCBvbmUgdG9rZW4gcGFzdCB0aGUgZW5kICovCiAgICAgfQogICAgIHJl
dHVybiBwbjsKIH0KIAotSlNQYXJzZU5vZGUgKgotUGFyc2VyOjphc3NpZ25FeHByKCkKLXsKLSAg
ICBKU19DSEVDS19SRUNVUlNJT04oY29udGV4dCwgcmV0dXJuIE5VTEwpOwotCi0jaWYgSlNfSEFT
X0dFTkVSQVRPUlMKLSAgICBpZiAodG9rZW5TdHJlYW0ubWF0Y2hUb2tlbihUT0tfWUlFTEQsIFRT
Rl9PUEVSQU5EKSkKLSAgICAgICAgcmV0dXJuIHJldHVybk9yWWllbGQodHJ1ZSk7Ci0jZW5kaWYK
LQotICAgIEpTUGFyc2VOb2RlICpwbiA9IGNvbmRFeHByMSgpOwotICAgIGlmICghcG4pCi0gICAg
ICAgIHJldHVybiBOVUxMOwotCi0gICAgaWYgKCF0b2tlblN0cmVhbS5pc0N1cnJlbnRUb2tlblR5
cGUoVE9LX0FTU0lHTikpIHsKLSAgICAgICAgdG9rZW5TdHJlYW0udW5nZXRUb2tlbigpOwotICAg
ICAgICByZXR1cm4gcG47Ci0gICAgfQotCi0gICAgSlNPcCBvcCA9IHRva2VuU3RyZWFtLmN1cnJl
bnRUb2tlbigpLnRfb3A7CisvKgorICogRmxpcCB0aGUgcG5fb3Agb2YgcG4gYW5kIGFueSBjaGls
ZHJlbiB0byBTRVQgb3Bjb2Rlcy4KKyAqIElmIHBuIGlzIG5vdCBhIHZhbGlkIGFzc2lnbm1lbnQg
TEhTLCByZXBvcnQgYW4gZXJyb3IuCisgKi8KK2Jvb2wKK1BhcnNlcjo6Y29udmVydEFzc2lnbm1l
bnRMaHMoSlNQYXJzZU5vZGUgKnBuLCBKU09wIG9wKQorewogICAgIHN3aXRjaCAocG4tPnBuX3R5
cGUpIHsKICAgICAgIGNhc2UgVE9LX05BTUU6CiAgICAgICAgIGlmICghQ2hlY2tTdHJpY3RBc3Np
Z25tZW50KGNvbnRleHQsIHRjLCBwbikpCi0gICAgICAgICAgICByZXR1cm4gTlVMTDsKKyAgICAg
ICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICAgcG4tPnBuX29wID0gSlNPUF9TRVROQU1FOwog
ICAgICAgICBOb3RlTFZhbHVlKGNvbnRleHQsIHBuLCB0Yyk7CiAgICAgICAgIGJyZWFrOwogICAg
ICAgY2FzZSBUT0tfRE9UOgogICAgICAgICBwbi0+cG5fb3AgPSBKU09QX1NFVFBST1A7CiAgICAg
ICAgIGJyZWFrOwogICAgICAgY2FzZSBUT0tfTEI6CiAgICAgICAgIHBuLT5wbl9vcCA9IEpTT1Bf
U0VURUxFTTsKICAgICAgICAgYnJlYWs7CiAjaWYgSlNfSEFTX0RFU1RSVUNUVVJJTkcKICAgICAg
IGNhc2UgVE9LX1JCOgogICAgICAgY2FzZSBUT0tfUkM6Ci0gICAgICB7CiAgICAgICAgIGlmIChv
cCAhPSBKU09QX05PUCkgewogICAgICAgICAgICAgcmVwb3J0RXJyb3JOdW1iZXIoTlVMTCwgSlNS
RVBPUlRfRVJST1IsIEpTTVNHX0JBRF9ERVNUUlVDVF9BU1MpOwotICAgICAgICAgICAgcmV0dXJu
IE5VTEw7Ci0gICAgICAgIH0KLSAgICAgICAgSlNQYXJzZU5vZGUgKnJocyA9IGFzc2lnbkV4cHIo
KTsKLSAgICAgICAgaWYgKCFyaHMgfHwgIUNoZWNrRGVzdHJ1Y3R1cmluZyhjb250ZXh0LCBOVUxM
LCBwbiwgdGMpKQotICAgICAgICAgICAgcmV0dXJuIE5VTEw7Ci0gICAgICAgIHJldHVybiBKU1Bh
cnNlTm9kZTo6bmV3QmluYXJ5T3JBcHBlbmQoVE9LX0FTU0lHTiwgb3AsIHBuLCByaHMsIHRjKTsK
LSAgICAgIH0KKyAgICAgICAgICAgIHJldHVybiBmYWxzZTsKKyAgICAgICAgfQorICAgICAgICBp
ZiAoIUNoZWNrRGVzdHJ1Y3R1cmluZyhjb250ZXh0LCBOVUxMLCBwbiwgdGMpKQorICAgICAgICAg
ICAgcmV0dXJuIGZhbHNlOworICAgICAgICBicmVhazsKICNlbmRpZgogICAgICAgY2FzZSBUT0tf
TFA6CiAgICAgICAgIGlmICghTWFrZVNldENhbGwoY29udGV4dCwgcG4sIHRjLCBKU01TR19CQURf
TEVGVFNJREVfT0ZfQVNTKSkKLSAgICAgICAgICAgIHJldHVybiBOVUxMOworICAgICAgICAgICAg
cmV0dXJuIGZhbHNlOwogICAgICAgICBicmVhazsKICNpZiBKU19IQVNfWE1MX1NVUFBPUlQKICAg
ICAgIGNhc2UgVE9LX1VOQVJZT1A6CiAgICAgICAgIGlmIChwbi0+cG5fb3AgPT0gSlNPUF9YTUxO
QU1FKSB7CiAgICAgICAgICAgICBwbi0+cG5fb3AgPSBKU09QX1NFVFhNTE5BTUU7CiAgICAgICAg
ICAgICBicmVhazsKICAgICAgICAgfQogICAgICAgICAvKiBGQUxMIFRIUk9VR0ggKi8KICNlbmRp
ZgogICAgICAgZGVmYXVsdDoKICAgICAgICAgcmVwb3J0RXJyb3JOdW1iZXIoTlVMTCwgSlNSRVBP
UlRfRVJST1IsIEpTTVNHX0JBRF9MRUZUU0lERV9PRl9BU1MpOworICAgICAgICByZXR1cm4gZmFs
c2U7CisgICAgfQorICAgIHJldHVybiB0cnVlOworfQorCitKU1BhcnNlTm9kZSAqCitQYXJzZXI6
OmFzc2lnbkV4cHIoKQoreworICAgIEpTX0NIRUNLX1JFQ1VSU0lPTihjb250ZXh0LCByZXR1cm4g
TlVMTCk7CisKKyNpZiBKU19IQVNfR0VORVJBVE9SUworICAgIGlmICh0b2tlblN0cmVhbS5tYXRj
aFRva2VuKFRPS19ZSUVMRCwgVFNGX09QRVJBTkQpKQorICAgICAgICByZXR1cm4gcmV0dXJuT3JZ
aWVsZCh0cnVlKTsKKyNlbmRpZgorCisgICAgSlNQYXJzZU5vZGUgKnBuID0gY29uZEV4cHIxKCk7
CisgICAgaWYgKCFwbikKICAgICAgICAgcmV0dXJuIE5VTEw7Ci0gICAgfQorCisgICAgaWYgKCF0
b2tlblN0cmVhbS5pc0N1cnJlbnRUb2tlblR5cGUoVE9LX0FTU0lHTikpIHsKKyAgICAgICAgdG9r
ZW5TdHJlYW0udW5nZXRUb2tlbigpOworICAgICAgICByZXR1cm4gcG47CisgICAgfQorCisgICAg
SlNPcCBvcCA9IHRva2VuU3RyZWFtLmN1cnJlbnRUb2tlbigpLnRfb3A7CisgICAgaWYgKCFjb252
ZXJ0QXNzaWdubWVudExocyhwbiwgb3ApKQorICAgICAgICByZXR1cm4gTlVMTDsKIAogICAgIEpT
UGFyc2VOb2RlICpyaHMgPSBhc3NpZ25FeHByKCk7CiAgICAgaWYgKHJocyAmJiBQTl9UWVBFKHBu
KSA9PSBUT0tfTkFNRSAmJiBwbi0+cG5fdXNlZCkgewogICAgICAgICBKU0RlZmluaXRpb24gKmRu
ID0gcG4tPnBuX2xleGRlZjsKIAogICAgICAgICAvKgogICAgICAgICAgKiBJZiB0aGUgZGVmaW5p
dGlvbiBpcyBub3QgZmxhZ2dlZCBhcyBhc3NpZ25lZCwgd2UgbXVzdCBoYXZlIGltcHV0ZWQKICAg
ICAgICAgICogdGhlIGluaXRpYWxpemVkIGZsYWcgdG8gaXQsIHRvIG9wdGltaXplIGZvciBmbGF0
IGNsb3N1cmVzLiBCdXQgdGhhdApkaWZmIC0tZ2l0IGEvanMvc3JjL2pzcGFyc2UuaCBiL2pzL3Ny
Yy9qc3BhcnNlLmgKLS0tIGEvanMvc3JjL2pzcGFyc2UuaAorKysgYi9qcy9zcmMvanNwYXJzZS5o
CkBAIC0xMDEsMTcgKzEwMSwxNiBAQCBKU19CRUdJTl9FWFRFUk5fQwogICogVE9LX0RFRkFVTFQg
ICAgICAgICAgICAgIHBuX3JpZ2h0OiBUT0tfTEMgbm9kZSBmb3IgdGhpcyBjYXNlJ3Mgc3RhdGVt
ZW50cwogICogICAgICAgICAgICAgICAgICAgICAgICAgIHBuX3ZhbDogY29uc3RhbnQgdmFsdWUg
aWYgbG9va3VwIG9yIHRhYmxlIHN3aXRjaAogICogVE9LX1dISUxFICAgIGJpbmFyeSAgICAgIHBu
X2xlZnQ6IGNvbmQsIHBuX3JpZ2h0OiBib2R5CiAgKiBUT0tfRE8gICAgICAgYmluYXJ5ICAgICAg
cG5fbGVmdDogYm9keSwgcG5fcmlnaHQ6IGNvbmQKICAqIFRPS19GT1IgICAgICBiaW5hcnkgICAg
ICBwbl9sZWZ0OiBlaXRoZXIKICAqICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZvci9pbiBs
b29wOiBhIGJpbmFyeSBUT0tfSU4gbm9kZSB3aXRoCiAgKiAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgIHBuX2xlZnQ6ICBUT0tfVkFSIG9yIFRPS19OQU1FIHRvIGxlZnQgb2YgJ2luJwogICog
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIFRPS19WQVIsIGl0cyBwbl94ZmxhZ3Mg
bWF5IGhhdmUgUE5YX1BPUFZBUgotICogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFu
ZCBQTlhfRk9SSU5WQVIgYml0cyBzZXQKICAqICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
cG5fcmlnaHQ6IG9iamVjdCBleHByIHRvIHJpZ2h0IG9mICdpbicKICAqICAgICAgICAgICAgICAg
ICAgICAgICAgICAgIGZvcig7OykgbG9vcDogYSB0ZXJuYXJ5IFRPS19SRVNFUlZFRCBub2RlIHdp
dGgKICAqICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcG5fa2lkMTogIGluaXQgZXhwciBi
ZWZvcmUgZmlyc3QgJzsnCiAgKiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBuX2tpZDI6
ICBjb25kIGV4cHIgYmVmb3JlIHNlY29uZCAnOycKICAqICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgcG5fa2lkMzogIHVwZGF0ZSBleHByIGFmdGVyIHNlY29uZCAnOycKICAqICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgYW55IGtpZCBtYXkgYmUgbnVsbAogICogICAgICAgICAgICAg
ICAgICAgICAgICAgIHBuX3JpZ2h0OiBib2R5CiAgKiBUT0tfVEhST1cgICAgdW5hcnkgICAgICAg
cG5fb3A6IEpTT1BfVEhST1csIHBuX2tpZDogZXhjZXB0aW9uCkBAIC00OTksMTggKzQ5OCwxNiBA
QCBwdWJsaWM6CiAKIC8qIEZsYWdzIHRvIHByb3BhZ2F0ZSBmcm9tIHVzZXMgdG8gZGVmaW5pdGlv
bi4gKi8KICNkZWZpbmUgUE5EX1VTRTJERUZfRkxBR1MgKFBORF9BU1NJR05FRCB8IFBORF9GVU5B
UkcgfCBQTkRfQ0xPU0VEKQogCiAvKiBQTl9MSVNUIHBuX3hmbGFncyBiaXRzLiAqLwogI2RlZmlu
ZSBQTlhfU1RSQ0FUICAgICAgMHgwMSAgICAgICAgICAgIC8qIFRPS19QTFVTIGxpc3QgaGFzIHN0
cmluZyB0ZXJtICovCiAjZGVmaW5lIFBOWF9DQU5URk9MRCAgICAweDAyICAgICAgICAgICAgLyog
VE9LX1BMVVMgbGlzdCBoYXMgdW5mb2xkYWJsZSB0ZXJtICovCiAjZGVmaW5lIFBOWF9QT1BWQVIg
ICAgICAweDA0ICAgICAgICAgICAgLyogVE9LX1ZBUiBsYXN0IHJlc3VsdCBuZWVkcyBwb3BwaW5n
ICovCi0jZGVmaW5lIFBOWF9GT1JJTlZBUiAgICAweDA4ICAgICAgICAgICAgLyogVE9LX1ZBUiBp
cyBsZWZ0IGtpZCBvZiBUT0tfSU4gbm9kZSwKLSAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICB3aGljaCBpcyBsZWZ0IGtpZCBvZiBUT0tfRk9SICovCiAjZGVmaW5lIFBO
WF9FTkRDT01NQSAgICAweDEwICAgICAgICAgICAgLyogYXJyYXkgbGl0ZXJhbCBoYXMgY29tbWEg
YXQgZW5kICovCiAjZGVmaW5lIFBOWF9YTUxST09UICAgICAweDIwICAgICAgICAgICAgLyogdG9w
LW1vc3Qgbm9kZSBpbiBYTUwgbGl0ZXJhbCB0cmVlICovCiAjZGVmaW5lIFBOWF9HUk9VUElOSVQg
ICAweDQwICAgICAgICAgICAgLyogdmFyIFthLCBiXSA9IFtjLCBkXTsgdW5pdCBsaXN0ICovCiAj
ZGVmaW5lIFBOWF9ORUVEQlJBQ0VTICAweDgwICAgICAgICAgICAgLyogYnJhY2VzIG5lY2Vzc2Fy
eSBkdWUgdG8gY2xvc3VyZSAqLwogI2RlZmluZSBQTlhfRlVOQ0RFRlMgICAweDEwMCAgICAgICAg
ICAgIC8qIGNvbnRhaW5zIHRvcC1sZXZlbCBmdW5jdGlvbiBzdGF0ZW1lbnRzICovCiAjZGVmaW5l
IFBOWF9TRVRDQUxMICAgIDB4MTAwICAgICAgICAgICAgLyogY2FsbCBleHByZXNzaW9uIGluIGx2
YWx1ZSBjb250ZXh0ICovCiAjZGVmaW5lIFBOWF9ERVNUUlVDVCAgIDB4MjAwICAgICAgICAgICAg
LyogZGVzdHJ1Y3R1cmluZyBzcGVjaWFsIGNhc2VzOgogICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgIDEuIHNob3J0aGFuZCBzeW50YXggdXNlZCwgYXQgcHJlc2VudApA
QCAtMTIxNiwxNiArMTIxMywxOCBAQCBwcml2YXRlOgogICAgIEpTUGFyc2VOb2RlICp4bWxFeHBy
KEpTQm9vbCBpblRhZyk7CiAgICAgSlNQYXJzZU5vZGUgKnhtbEF0b21Ob2RlKCk7CiAgICAgSlNQ
YXJzZU5vZGUgKnhtbE5hbWVFeHByKCk7CiAgICAgSlNQYXJzZU5vZGUgKnhtbFRhZ0NvbnRlbnQo
anM6OlRva2VuS2luZCB0YWd0eXBlLCBKU0F0b20gKipuYW1lcCk7CiAgICAgSlNCb29sIHhtbEVs
ZW1lbnRDb250ZW50KEpTUGFyc2VOb2RlICpwbik7CiAgICAgSlNQYXJzZU5vZGUgKnhtbEVsZW1l
bnRPckxpc3QoSlNCb29sIGFsbG93TGlzdCk7CiAgICAgSlNQYXJzZU5vZGUgKnhtbEVsZW1lbnRP
ckxpc3RSb290KEpTQm9vbCBhbGxvd0xpc3QpOwogI2VuZGlmIC8qIEpTX0hBU19YTUxfU1VQUE9S
VCAqLworCisgICAgYm9vbCBjb252ZXJ0QXNzaWdubWVudExocyhKU1BhcnNlTm9kZSAqcG4sIEpT
T3Agb3ApOwogfTsKIAogaW5saW5lIGJvb2wKIFBhcnNlcjo6cmVwb3J0RXJyb3JOdW1iZXIoSlNQ
YXJzZU5vZGUgKnBuLCB1aW50TiBmbGFncywgdWludE4gZXJyb3JOdW1iZXIsIC4uLikKIHsKICAg
ICB2YV9saXN0IGFyZ3M7CiAgICAgdmFfc3RhcnQoYXJncywgZXJyb3JOdW1iZXIpOwogICAgIGJv
b2wgcmVzdWx0ID0gdG9rZW5TdHJlYW0ucmVwb3J0Q29tcGlsZUVycm9yTnVtYmVyVkEocG4sIGZs
YWdzLCBlcnJvck51bWJlciwgYXJncyk7CmRpZmYgLS1naXQgYS9qcy9zcmMvanNyZWZsZWN0LmNw
cCBiL2pzL3NyYy9qc3JlZmxlY3QuY3BwCi0tLSBhL2pzL3NyYy9qc3JlZmxlY3QuY3BwCisrKyBi
L2pzL3NyYy9qc3JlZmxlY3QuY3BwCkBAIC0xOTMzLDI2ICsxOTMzLDE2IEBAIGJvb2wKIEFTVFNl
cmlhbGl6ZXI6OnZhcmlhYmxlRGVjbGFyYXRpb24oSlNQYXJzZU5vZGUgKnBuLCBib29sIGxldCwg
VmFsdWUgKmRzdCkKIHsKICAgICBKU19BU1NFUlQobGV0ID8gUE5fVFlQRShwbikgPT0gVE9LX0xF
VCA6IFBOX1RZUEUocG4pID09IFRPS19WQVIpOwogCiAgICAgLyogTGF0ZXIgdXBkYXRlZCB0byBW
QVJERUNMX0NPTlNUIGlmIHdlIGZpbmQgYSBQTkRfQ09OU1QgZGVjbGFyYXRvci4gKi8KICAgICBW
YXJEZWNsS2luZCBraW5kID0gbGV0ID8gVkFSREVDTF9MRVQgOiBWQVJERUNMX1ZBUjsKIAogICAg
IE5vZGVWZWN0b3IgZHRvcnMoY3gpOwotCi0gICAgLyogSW4gYSBmb3ItaW4gY29udGV4dCwgdmFy
aWFibGUgZGVjbGFyYXRpb25zIGNvbnRhaW4ganVzdCBhIHNpbmdsZSBwYXR0ZXJuLiAqLwotICAg
IGlmIChwbi0+cG5feGZsYWdzICYgUE5YX0ZPUklOVkFSKSB7Ci0gICAgICAgIFZhbHVlIHBhdHQs
IGNoaWxkOwotICAgICAgICByZXR1cm4gcGF0dGVybihwbi0+cG5faGVhZCwgJmtpbmQsICZwYXR0
KSAmJgotICAgICAgICAgICAgICAgYnVpbGRlci52YXJpYWJsZURlY2xhcmF0b3IocGF0dCwgTnVs
bFZhbHVlKCksICZwbi0+cG5faGVhZC0+cG5fcG9zLCAmY2hpbGQpICYmCi0gICAgICAgICAgICAg
ICBkdG9ycy5hcHBlbmQoY2hpbGQpICYmCi0gICAgICAgICAgICAgICBidWlsZGVyLnZhcmlhYmxl
RGVjbGFyYXRpb24oZHRvcnMsIGtpbmQsICZwbi0+cG5fcG9zLCBkc3QpOwotICAgIH0KLQogICAg
IGlmICghZHRvcnMucmVzZXJ2ZShwbi0+cG5fY291bnQpKQogICAgICAgICByZXR1cm4gZmFsc2U7
CiAgICAgZm9yIChKU1BhcnNlTm9kZSAqbmV4dCA9IHBuLT5wbl9oZWFkOyBuZXh0OyBuZXh0ID0g
bmV4dC0+cG5fbmV4dCkgewogICAgICAgICBWYWx1ZSBjaGlsZDsKICAgICAgICAgaWYgKCF2YXJp
YWJsZURlY2xhcmF0b3IobmV4dCwgJmtpbmQsICZjaGlsZCkpCiAgICAgICAgICAgICByZXR1cm4g
ZmFsc2U7CiAgICAgICAgIGR0b3JzLmluZmFsbGlibGVBcHBlbmQoY2hpbGQpOwogICAgIH0KQEAg
LTIyMDYsNjkgKzIxOTYsMTYgQEAgQVNUU2VyaWFsaXplcjo6c3RhdGVtZW50KEpTUGFyc2VOb2Rl
ICpwbgogICAgICAgICBWYWx1ZSBpbml0LCB0ZXN0LCB1cGRhdGU7CiAKICAgICAgICAgcmV0dXJu
IGZvckluaXQoaGVhZC0+cG5fa2lkMSwgJmluaXQpICYmCiAgICAgICAgICAgICAgICBvcHRFeHBy
ZXNzaW9uKGhlYWQtPnBuX2tpZDIsICZ0ZXN0KSAmJgogICAgICAgICAgICAgICAgb3B0RXhwcmVz
c2lvbihoZWFkLT5wbl9raWQzLCAmdXBkYXRlKSAmJgogICAgICAgICAgICAgICAgYnVpbGRlci5m
b3JTdGF0ZW1lbnQoaW5pdCwgdGVzdCwgdXBkYXRlLCBzdG10LCAmcG4tPnBuX3BvcywgZHN0KTsK
ICAgICAgIH0KIAotICAgICAgLyogU3ludGhlc2l6ZWQgYnkgdGhlIHBhcnNlciB3aGVuIGEgZm9y
LWluIGxvb3AgY29udGFpbnMgYSB2YXJpYWJsZSBpbml0aWFsaXplci4gKi8KLSAgICAgIGNhc2Ug
VE9LX1NFUToKLSAgICAgIHsKLSAgICAgICAgTE9DQUxfQVNTRVJUKHBuLT5wbl9jb3VudCA9PSAy
KTsKLQotICAgICAgICBKU1BhcnNlTm9kZSAqcHJlbHVkZSA9IHBuLT5wbl9oZWFkOwotICAgICAg
ICBKU1BhcnNlTm9kZSAqYm9keSA9IHByZWx1ZGUtPnBuX25leHQ7Ci0KLSAgICAgICAgTE9DQUxf
QVNTRVJUKChQTl9UWVBFKHByZWx1ZGUpID09IFRPS19WQVIgJiYgUE5fVFlQRShib2R5KSA9PSBU
T0tfRk9SKSB8fAotICAgICAgICAgICAgICAgICAgICAgKFBOX1RZUEUocHJlbHVkZSkgPT0gVE9L
X1NFTUkgJiYgUE5fVFlQRShib2R5KSA9PSBUT0tfTEVYSUNBTFNDT1BFKSk7Ci0KLSAgICAgICAg
SlNQYXJzZU5vZGUgKmxvb3A7Ci0gICAgICAgIFZhbHVlIHZhcjsKLQotICAgICAgICBpZiAoUE5f
VFlQRShwcmVsdWRlKSA9PSBUT0tfVkFSKSB7Ci0gICAgICAgICAgICBsb29wID0gYm9keTsKLQot
ICAgICAgICAgICAgaWYgKCF2YXJpYWJsZURlY2xhcmF0aW9uKHByZWx1ZGUsIGZhbHNlLCAmdmFy
KSkKLSAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7Ci0gICAgICAgIH0gZWxzZSB7Ci0gICAg
ICAgICAgICBsb29wID0gYm9keS0+cG5fZXhwcjsKLQotICAgICAgICAgICAgTE9DQUxfQVNTRVJU
KFBOX1RZUEUobG9vcC0+cG5fbGVmdCkgPT0gVE9LX0lOICYmCi0gICAgICAgICAgICAgICAgICAg
ICAgICAgUE5fVFlQRShsb29wLT5wbl9sZWZ0LT5wbl9sZWZ0KSA9PSBUT0tfTEVUICYmCi0gICAg
ICAgICAgICAgICAgICAgICAgICAgbG9vcC0+cG5fbGVmdC0+cG5fbGVmdC0+cG5fY291bnQgPT0g
MSk7Ci0KLSAgICAgICAgICAgIEpTUGFyc2VOb2RlICpwbmxldCA9IGxvb3AtPnBuX2xlZnQtPnBu
X2xlZnQ7Ci0KLSAgICAgICAgICAgIFZhckRlY2xLaW5kIGtpbmQgPSBWQVJERUNMX0xFVDsKLSAg
ICAgICAgICAgIE5vZGVWZWN0b3IgZHRvcnMoY3gpOwotICAgICAgICAgICAgVmFsdWUgcGF0dCwg
aW5pdCwgZHRvcjsKLQotICAgICAgICAgICAgaWYgKCFwYXR0ZXJuKHBubGV0LT5wbl9oZWFkLCAm
a2luZCwgJnBhdHQpIHx8Ci0gICAgICAgICAgICAgICAgIWV4cHJlc3Npb24ocHJlbHVkZS0+cG5f
a2lkLCAmaW5pdCkgfHwKLSAgICAgICAgICAgICAgICAhYnVpbGRlci52YXJpYWJsZURlY2xhcmF0
b3IocGF0dCwgaW5pdCwgJnBubGV0LT5wbl9wb3MsICZkdG9yKSB8fAotICAgICAgICAgICAgICAg
ICFkdG9ycy5hcHBlbmQoZHRvcikgfHwKLSAgICAgICAgICAgICAgICAhYnVpbGRlci52YXJpYWJs
ZURlY2xhcmF0aW9uKGR0b3JzLCBraW5kLCAmcG5sZXQtPnBuX3BvcywgJnZhcikpIHsKLSAgICAg
ICAgICAgICAgICByZXR1cm4gZmFsc2U7Ci0gICAgICAgICAgICB9Ci0gICAgICAgIH0KLQotICAg
ICAgICBKU1BhcnNlTm9kZSAqaGVhZCA9IGxvb3AtPnBuX2xlZnQ7Ci0gICAgICAgIEpTX0FTU0VS
VChQTl9UWVBFKGhlYWQpID09IFRPS19JTik7Ci0KLSAgICAgICAgYm9vbCBpc0ZvckVhY2ggPSBs
b29wLT5wbl9pZmxhZ3MgJiBKU0lURVJfRk9SRUFDSDsKLQotICAgICAgICBWYWx1ZSBleHByLCBz
dG10OwotCi0gICAgICAgIHJldHVybiBleHByZXNzaW9uKGhlYWQtPnBuX3JpZ2h0LCAmZXhwcikg
JiYKLSAgICAgICAgICAgICAgIHN0YXRlbWVudChsb29wLT5wbl9yaWdodCwgJnN0bXQpICYmCi0g
ICAgICAgICAgICAgICBidWlsZGVyLmZvckluU3RhdGVtZW50KHZhciwgZXhwciwgc3RtdCwgaXNG
b3JFYWNoLCAmcG4tPnBuX3BvcywgZHN0KTsKLSAgICAgIH0KLQogICAgICAgY2FzZSBUT0tfQlJF
QUs6CiAgICAgICBjYXNlIFRPS19DT05USU5VRToKICAgICAgIHsKICAgICAgICAgVmFsdWUgbGFi
ZWw7CiAKICAgICAgICAgcmV0dXJuIG9wdElkZW50aWZpZXIocG4tPnBuX2F0b20sIE5VTEwsICZs
YWJlbCkgJiYKICAgICAgICAgICAgICAgIChQTl9UWVBFKHBuKSA9PSBUT0tfQlJFQUsKICAgICAg
ICAgICAgICAgICA/IGJ1aWxkZXIuYnJlYWtTdGF0ZW1lbnQobGFiZWwsICZwbi0+cG5fcG9zLCBk
c3QpCmRpZmYgLS1naXQgYS9qcy9zcmMvanN0cmFjZXIuY3BwIGIvanMvc3JjL2pzdHJhY2VyLmNw
cAotLS0gYS9qcy9zcmMvanN0cmFjZXIuY3BwCisrKyBiL2pzL3NyYy9qc3RyYWNlci5jcHAKQEAg
LTc5NjgsMTkgKzc5NjgsMTkgQEAgRGVlcEJhaWwoSlNDb250ZXh0ICpjeCkKICAgICAgKiBTVEFU
VVNfRVhJVCBndWFyZCBhbmQgYmFpbCBvdXQuIE1vc3Qgb2YgdGhlIG5hdGl2ZSBzdGFjayB3aWxs
IGp1c3QgYmUKICAgICAgKiB0aHJvd24gYXdheS4gSG93ZXZlciwgTGVhdmVUcmVlIHdpbGwgY29w
eSBhIGZldyBzbG90cyBmcm9tIHRoZSB0b3Agb2YKICAgICAgKiB0aGUgbmF0aXZlIHN0YWNrIHRv
IHRoZSBpbnRlcnByZXRlciBzdGFjay0tb25seSB0aG9zZSBzbG90cyB3cml0dGVuIGJ5CiAgICAg
ICogdGhlIGN1cnJlbnQgYnl0ZWNvZGUgaW5zdHJ1Y3Rpb24uIFRvIG1ha2Ugc3VyZSBMZWF2ZVRy
ZWUgaGFzIGNvcnJlY3QKICAgICAgKiBkYXRhIHRvIGNvcHkgZnJvbSB0aGUgbmF0aXZlIHN0YWNr
IHRvIHRoZSBvcGVyYW5kIHN0YWNrLCB3ZSBoYXZlIHRoaXMKICAgICAgKiBydWxlOiBldmVyeSBj
YWxsZXIgb2YgZW50ZXJEZWVwQmFpbENhbGwgbXVzdCBlbnN1cmUgdGhhdCBiZXR3ZWVuIHRoZQog
ICAgICAqIGRlZXAgYmFpbCBjYWxsIGFuZCB0aGUgU1RBVFVTX0VYSVQgZ3VhcmQsIGFsbCB0aG9z
ZSBzbG90cyBhcmUgd3JpdHRlbi4KICAgICAgKgotICAgICAqIFRoZSBydWxlIGlzIGEgYml0IHN1
YnRsZS4gRm9yIGV4YW1wbGUsIEpTT1BfTU9SRUlURVIgdXNlcyBhIHNsb3Qgd2hpY2gKKyAgICAg
KiBUaGUgcnVsZSBpcyBhIGJpdCBzdWJ0bGUuIEZvciBleGFtcGxlLCBKU09QX0hBU05FWFQgdXNl
cyBhIHNsb3Qgd2hpY2gKICAgICAgKiBpdCBuZXZlciB3cml0ZXMgdG87IGluIG9yZGVyIHRvIHNh
dGlzZnkgdGhlIGFib3ZlIHJ1bGUsCi0gICAgICogcmVjb3JkX0pTT1BfTU9SRUlURVIgZW1pdHMg
Y29kZSB0byB3cml0ZSB0aGUgdmFsdWUgYmFjayB0byB0aGUgc2xvdAorICAgICAqIHJlY29yZF9K
U09QX0hBU05FWFQgZW1pdHMgY29kZSB0byB3cml0ZSB0aGUgdmFsdWUgYmFjayB0byB0aGUgc2xv
dAogICAgICAqIGFueXdheS4KICAgICAgKi8KICAgICBzdGF0ZS0+ZGVlcEJhaWxTcCA9IHN0YXRl
LT5zcDsKIH0KIAogSlNfUkVRVUlSRVNfU1RBQ0sgVmFsdWUmCiBUcmFjZVJlY29yZGVyOjphcmd2
YWwodW5zaWduZWQgbikgY29uc3QKIHsKQEAgLTE0Nzk0LDMwICsxNDc5NCwzMCBAQCBJdGVyYXRv
ck1vcmUoSlNDb250ZXh0ICpjeCwgSlNPYmplY3QgKml0CiAgICAgICAgIHJldHVybiBmYWxzZTsK
ICAgICB9CiAgICAgcmV0dXJuIFdhc0J1aWx0aW5TdWNjZXNzZnVsKHRtKTsKIH0KIEpTX0RFRklO
RV9DQUxMSU5GT18zKGV4dGVybiwgQk9PTF9GQUlMLCBJdGVyYXRvck1vcmUsIENPTlRFWFQsIE9C
SkVDVCwgVkFMVUVQVFIsCiAgICAgICAgICAgICAgICAgICAgICAwLCBBQ0NTRVRfU1RPUkVfQU5Z
KQogCiBKU19SRVFVSVJFU19TVEFDSyBBYm9ydGFibGVSZWNvcmRpbmdTdGF0dXMKLVRyYWNlUmVj
b3JkZXI6OnJlY29yZF9KU09QX01PUkVJVEVSKCkKK1RyYWNlUmVjb3JkZXI6OnJlY29yZF9KU09Q
X0hBU05FWFQoKQogewogICAgIFZhbHVlJiBpdGVyb2JqX3ZhbCA9IHN0YWNrdmFsKC0xKTsKICAg
ICBpZiAoaXRlcm9ial92YWwuaXNQcmltaXRpdmUoKSkKICAgICAgICAgUkVUVVJOX1NUT1BfQSgi
Zm9yLWluIG9uIGEgcHJpbWl0aXZlIHZhbHVlIik7CiAKICAgICBSRVRVUk5fSUZfWE1MX0EoaXRl
cm9ial92YWwpOwogCiAgICAgSlNPYmplY3QqIGl0ZXJvYmogPSAmaXRlcm9ial92YWwudG9PYmpl
Y3QoKTsKICAgICBMSW5zKiBpdGVyb2JqX2lucyA9IGdldCgmaXRlcm9ial92YWwpOwogICAgIExJ
bnMqIGNvbmRfaW5zOwogCiAgICAgLyoKLSAgICAgKiBKU09QX0ZPUiogYWxyZWFkeSBndWFyZHMg
b24gdGhpcywgYnV0IGluIGNlcnRhaW4gcmFyZSBjYXNlcyB3ZSBtaWdodAorICAgICAqIEpTT1Bf
TkVYVCBhbHJlYWR5IGd1YXJkcyBvbiB0aGlzLCBidXQgaW4gY2VydGFpbiByYXJlIGNhc2VzIHdl
IG1pZ2h0CiAgICAgICogcmVjb3JkIG1pc2Zvcm1lZCBsb29wIHRyYWNlcy4gTm90ZSB0aGF0IGl0
J3Mgbm90IG5lY2Vzc2FyeSB0byBndWFyZCBvbgogICAgICAqIG5pLT5mbGFncyAobm9yIGRvIHdl
IGluIHVuYm94TmV4dFZhbHVlKSwgYmVjYXVzZSB0aGUgZGlmZmVyZW50CiAgICAgICogaXRlcmF0
aW9uIHR5cGUgd2lsbCBndWFyYW50ZWUgYSBkaWZmZXJlbnQgZW50cnkgdHlwZW1hcC4KICAgICAg
Ki8KICAgICBpZiAoaXRlcm9iai0+aGFzQ2xhc3MoJmpzX0l0ZXJhdG9yQ2xhc3MpKSB7CiAgICAg
ICAgIGd1YXJkQ2xhc3MoaXRlcm9ial9pbnMsICZqc19JdGVyYXRvckNsYXNzLCBzbmFwc2hvdChC
UkFOQ0hfRVhJVCksIExPQURfTk9STUFMKTsKIAogICAgICAgICBOYXRpdmVJdGVyYXRvciAqbmkg
PSAoTmF0aXZlSXRlcmF0b3IgKikgaXRlcm9iai0+Z2V0UHJpdmF0ZSgpOwpAQCAtMTQ4OTYsMTkg
KzE0ODk2LDE4IEBAIEpTX1JFUVVJUkVTX1NUQUNLIHZvaWQKIFRyYWNlUmVjb3JkZXI6OnN0b3Jl
TWFnaWMoSlNXaHlNYWdpYyB3aHksIEFkZHJlc3MgYWRkcikKIHsKICAgICBMSW5zICptYWdpYyA9
IHcubmFtZUltbXEoQlVJTERfSlNWQUwoSlNWQUxfVEFHX01BR0lDLCB3aHkpKTsKICAgICB3LnN0
cShtYWdpYywgYWRkcik7CiB9CiAjZW5kaWYKIAogSlNfUkVRVUlSRVNfU1RBQ0sgQWJvcnRhYmxl
UmVjb3JkaW5nU3RhdHVzCi1UcmFjZVJlY29yZGVyOjp1bmJveE5leHRWYWx1ZShMSW5zKiAmdl9p
bnMpCi17Ci0gICAgVmFsdWUgJml0ZXJvYmpfdmFsID0gc3RhY2t2YWwoLTEpOworVHJhY2VSZWNv
cmRlcjo6dW5ib3hOZXh0VmFsdWUoVmFsdWUgJml0ZXJvYmpfdmFsLCBMSW5zKiAmdl9pbnMpCit7
CiAgICAgSlNPYmplY3QgKml0ZXJvYmogPSAmaXRlcm9ial92YWwudG9PYmplY3QoKTsKICAgICBM
SW5zKiBpdGVyb2JqX2lucyA9IGdldCgmaXRlcm9ial92YWwpOwogCiAgICAgaWYgKGl0ZXJvYmot
Pmhhc0NsYXNzKCZqc19JdGVyYXRvckNsYXNzKSkgewogICAgICAgICBndWFyZENsYXNzKGl0ZXJv
YmpfaW5zLCAmanNfSXRlcmF0b3JDbGFzcywgc25hcHNob3QoQlJBTkNIX0VYSVQpLCBMT0FEX05P
Uk1BTCk7CiAgICAgICAgIE5hdGl2ZUl0ZXJhdG9yICpuaSA9IChOYXRpdmVJdGVyYXRvciAqKSBp
dGVyb2JqLT5nZXRQcml2YXRlKCk7CiAKICAgICAgICAgTElucyAqbmlfaW5zID0gdy5sZHBPYmpQ
cml2YXRlKGl0ZXJvYmpfaW5zKTsKQEAgLTE0OTU4LDY4ICsxNDk1NywyNSBAQCBUcmFjZVJlY29y
ZGVyOjp1bmJveE5leHRWYWx1ZShMSW5zKiAmdl9pCiAgICAgQWRkcmVzcyBpdGVyVmFsdWVBZGRy
ID0gQ3hBZGRyZXNzKGl0ZXJWYWx1ZSk7CiAgICAgdl9pbnMgPSB1bmJveF92YWx1ZShjeC0+aXRl
clZhbHVlLCBpdGVyVmFsdWVBZGRyLCBzbmFwc2hvdChCUkFOQ0hfRVhJVCkpOwogICAgIHN0b3Jl
TWFnaWMoSlNfTk9fSVRFUl9WQUxVRSwgaXRlclZhbHVlQWRkcik7CiAKICAgICByZXR1cm4gQVJF
Q09SRF9DT05USU5VRTsKIH0KIAogSlNfUkVRVUlSRVNfU1RBQ0sgQWJvcnRhYmxlUmVjb3JkaW5n
U3RhdHVzCi1UcmFjZVJlY29yZGVyOjpyZWNvcmRfSlNPUF9GT1JOQU1FKCkKLXsKLSAgICBWYWx1
ZSogdnA7Ci0gICAgTElucyogeF9pbnM7Ci0gICAgTmFtZVJlc3VsdCBucjsKLSAgICBDSEVDS19T
VEFUVVNfQShuYW1lKHZwLCB4X2lucywgbnIpKTsKLSAgICBpZiAoIW5yLnRyYWNrZWQpCi0gICAg
ICAgIFJFVFVSTl9TVE9QX0EoImZvcm5hbWUgb24gbm9uLXRyYWNrZWQgdmFsdWUgbm90IHN1cHBv
cnRlZCIpOworVHJhY2VSZWNvcmRlcjo6cmVjb3JkX0pTT1BfTkVYVCgpCit7CiAgICAgTElucyog
dl9pbnM7Ci0gICAgQ0hFQ0tfU1RBVFVTX0EodW5ib3hOZXh0VmFsdWUodl9pbnMpKTsKLSAgICBz
ZXQodnAsIHZfaW5zKTsKLSAgICByZXR1cm4gQVJFQ09SRF9DT05USU5VRTsKLX0KLQotSlNfUkVR
VUlSRVNfU1RBQ0sgQWJvcnRhYmxlUmVjb3JkaW5nU3RhdHVzCi1UcmFjZVJlY29yZGVyOjpyZWNv
cmRfSlNPUF9GT1JHTkFNRSgpCi17Ci0gICAgcmV0dXJuIHJlY29yZF9KU09QX0ZPUk5BTUUoKTsK
LX0KLQotSlNfUkVRVUlSRVNfU1RBQ0sgQWJvcnRhYmxlUmVjb3JkaW5nU3RhdHVzCi1UcmFjZVJl
Y29yZGVyOjpyZWNvcmRfSlNPUF9GT1JQUk9QKCkKLXsKLSAgICByZXR1cm4gQVJFQ09SRF9TVE9Q
OwotfQotCi1KU19SRVFVSVJFU19TVEFDSyBBYm9ydGFibGVSZWNvcmRpbmdTdGF0dXMKLVRyYWNl
UmVjb3JkZXI6OnJlY29yZF9KU09QX0ZPUkVMRU0oKQotewotICAgIExJbnMqIHZfaW5zOwotICAg
IENIRUNLX1NUQVRVU19BKHVuYm94TmV4dFZhbHVlKHZfaW5zKSk7CisgICAgVmFsdWUgJml0ZXJv
YmpfdmFsID0gc3RhY2t2YWwoLUdFVF9JTlQ4KGN4LT5yZWdzLT5wYykpOworICAgIENIRUNLX1NU
QVRVU19BKHVuYm94TmV4dFZhbHVlKGl0ZXJvYmpfdmFsLCB2X2lucykpOwogICAgIHN0YWNrKDAs
IHZfaW5zKTsKICAgICByZXR1cm4gQVJFQ09SRF9DT05USU5VRTsKIH0KIAotSlNfUkVRVUlSRVNf
U1RBQ0sgQWJvcnRhYmxlUmVjb3JkaW5nU3RhdHVzCi1UcmFjZVJlY29yZGVyOjpyZWNvcmRfSlNP
UF9GT1JBUkcoKQotewotICAgIExJbnMqIHZfaW5zOwotICAgIENIRUNLX1NUQVRVU19BKHVuYm94
TmV4dFZhbHVlKHZfaW5zKSk7Ci0gICAgYXJnKEdFVF9BUkdOTyhjeC0+cmVncy0+cGMpLCB2X2lu
cyk7Ci0gICAgcmV0dXJuIEFSRUNPUkRfQ09OVElOVUU7Ci19Ci0KLUpTX1JFUVVJUkVTX1NUQUNL
IEFib3J0YWJsZVJlY29yZGluZ1N0YXR1cwotVHJhY2VSZWNvcmRlcjo6cmVjb3JkX0pTT1BfRk9S
TE9DQUwoKQotewotICAgIExJbnMqIHZfaW5zOwotICAgIENIRUNLX1NUQVRVU19BKHVuYm94TmV4
dFZhbHVlKHZfaW5zKSk7Ci0gICAgdmFyKEdFVF9TTE9UTk8oY3gtPnJlZ3MtPnBjKSwgdl9pbnMp
OwotICAgIHJldHVybiBBUkVDT1JEX0NPTlRJTlVFOwotfQogCiBKU19SRVFVSVJFU19TVEFDSyBB
Ym9ydGFibGVSZWNvcmRpbmdTdGF0dXMKIFRyYWNlUmVjb3JkZXI6OnJlY29yZF9KU09QX1BPUE4o
KQogewogICAgIHJldHVybiBBUkVDT1JEX0NPTlRJTlVFOwogfQogCiBzdGF0aWMgaW5saW5lIGJv
b2wKQEAgLTE2NTU0LDE2ICsxNjUxMCwyOSBAQCBUcmFjZVJlY29yZGVyOjpyZWNvcmRfSlNPUF9D
QUxMR05BTUUoKQogICAgIH0KIAogREJHX1NUVUIoSlNPUF9HRVRVUFZBUl9EQkcpCiBEQkdfU1RV
QihKU09QX0NBTExVUFZBUl9EQkcpCiBEQkdfU1RVQihKU09QX0RFRkZVTl9EQkdGQykKIERCR19T
VFVCKEpTT1BfREVGTE9DQUxGVU5fREJHRkMpCiBEQkdfU1RVQihKU09QX0xBTUJEQV9EQkdGQykK
IAorI2RlZmluZSBVTlVTRURfU1RVQihPUCkgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgXAorICAgIEpTX1JFUVVJUkVTX1NUQUNLIEFib3J0YWJs
ZVJlY29yZGluZ1N0YXR1cyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgXAorICAgIFRy
YWNlUmVjb3JkZXI6OnJlY29yZF8jI09QKCkgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgXAorICAgIHsgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgXAorICAgICAgICBKU19OT1Rf
UkVBQ0hFRCgjT1ApOyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgXAorICAgICAgICByZXR1cm4gQVJFQ09SRF9FUlJPUjsgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgXAorICAgIH0KKworVU5VU0VEX1NUVUIoSlNP
UF9VTlVTRUQxMSkKK1VOVVNFRF9TVFVCKEpTT1BfVU5VU0VEMTA2KQorVU5VU0VEX1NUVUIoSlNP
UF9VTlVTRUQxMDcpCitVTlVTRURfU1RVQihKU09QX1VOVVNFRDEwOCkKKwogI2lmZGVmIEpTX0pJ
VF9TUEVXCiAvKgogICogUHJpbnQgaW5mb3JtYXRpb24gYWJvdXQgZW50cnkgdHlwZW1hcHMgYW5k
IHVuc3RhYmxlIGV4aXRzIGZvciBhbGwgcGVlcnMKICAqIGF0IGEgUEMuCiAgKi8KIHZvaWQKIER1
bXBQZWVyU3RhYmlsaXR5KFRyYWNlTW9uaXRvciogdG0sIGNvbnN0IHZvaWQqIGlwLCBKU09iamVj
dCogZ2xvYmFsT2JqLCB1aW50MzIgZ2xvYmFsU2hhcGUsCiAgICAgICAgICAgICAgICAgICB1aW50
MzIgYXJnYykKQEAgLTE3MTk4LDE3ICsxNzE2NywxNyBAQCBMb29wUHJvZmlsZTo6cHJvZmlsZU9w
ZXJhdGlvbihKU0NvbnRleHQqCiAgICAgICAgIHRtLT5wcm9maWxlLT5kZWNpZGUoY3gpOwogICAg
ICAgICBzdG9wUHJvZmlsaW5nKGN4KTsKICAgICAgICAgcmV0dXJuIFByb2ZDb21wbGV0ZTsKICAg
ICB9CiAKICAgICAvKiBUaGVzZSBhcmUgdGhlIHBsYWNlcyB3aGVyZSB0aGUgaW50ZXJwcmV0ZXIg
c2tpcHMgb3ZlciBicmFuY2hlcy4gKi8KICAgICBqc2J5dGVjb2RlICp0ZXN0UEMgPSBjeC0+cmVn
cy0+cGM7CiAgICAgaWYgKG9wID09IEpTT1BfRVEgfHwgb3AgPT0gSlNPUF9ORSB8fCBvcCA9PSBK
U09QX0xUIHx8IG9wID09IEpTT1BfR1QKLSAgICAgICAgfHwgb3AgPT0gSlNPUF9MRSB8fCBvcCA9
PSBKU09QX0dFIHx8IG9wID09IEpTT1BfSU4gfHwgb3AgPT0gSlNPUF9NT1JFSVRFUikKKyAgICAg
ICAgfHwgb3AgPT0gSlNPUF9MRSB8fCBvcCA9PSBKU09QX0dFIHx8IG9wID09IEpTT1BfSU4gfHwg
b3AgPT0gSlNPUF9IQVNORVhUKQogICAgIHsKICAgICAgICAgY29uc3QgSlNDb2RlU3BlYyAqY3Mg
PSAmanNfQ29kZVNwZWNbb3BdOwogICAgICAgICBwdHJkaWZmX3Qgb3BsZW4gPSBjcy0+bGVuZ3Ro
OwogICAgICAgICBKU19BU1NFUlQob3BsZW4gIT0gLTEpOwogCiAgICAgICAgIGlmIChjeC0+cmVn
cy0+cGMgLSBzY3JpcHQtPmNvZGUgKyBvcGxlbiA8IHB0cmRpZmZfdChzY3JpcHQtPmxlbmd0aCkp
CiAgICAgICAgICAgICBpZiAoY3gtPnJlZ3MtPnBjW29wbGVuXSA9PSBKU09QX0lGRVEgfHwgY3gt
PnJlZ3MtPnBjW29wbGVuXSA9PSBKU09QX0lGTkUpCiAgICAgICAgICAgICAgICAgdGVzdFBDID0g
Y3gtPnJlZ3MtPnBjICsgb3BsZW47CmRpZmYgLS1naXQgYS9qcy9zcmMvanN0cmFjZXIuaCBiL2pz
L3NyYy9qc3RyYWNlci5oCi0tLSBhL2pzL3NyYy9qc3RyYWNlci5oCisrKyBiL2pzL3NyYy9qc3Ry
YWNlci5oCkBAIC0xMzY4LDE3ICsxMzY4LDE4IEBAIGNsYXNzIFRyYWNlUmVjb3JkZXIKICAgICBK
U19SRVFVSVJFU19TVEFDSyBuYW5vaml0OjpMSW5zICpjYW5vbmljYWxpemVOYU5zKG5hbm9qaXQ6
OkxJbnMgKmR2YWxfaW5zKTsKICAgICBKU19SRVFVSVJFU19TVEFDSyBBYm9ydGFibGVSZWNvcmRp
bmdTdGF0dXMgdHlwZWRBcnJheUVsZW1lbnQoVmFsdWUmIG92YWwsIFZhbHVlJiBpZHgsIFZhbHVl
KiYgdnAsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgIG5hbm9qaXQ6OkxJbnMqJiB2X2lucyk7CiAgICAgSlNfUkVRVUlSRVNf
U1RBQ0sgQWJvcnRhYmxlUmVjb3JkaW5nU3RhdHVzIGdldFByb3AoSlNPYmplY3QqIG9iaiwgbmFu
b2ppdDo6TElucyogb2JqX2lucyk7CiAgICAgSlNfUkVRVUlSRVNfU1RBQ0sgQWJvcnRhYmxlUmVj
b3JkaW5nU3RhdHVzIGdldFByb3AoVmFsdWUmIHYpOwogICAgIEpTX1JFUVVJUkVTX1NUQUNLIFJl
Y29yZGluZ1N0YXR1cyBnZXRUaGlzKG5hbm9qaXQ6OkxJbnMqJiB0aGlzX2lucyk7CiAKICAgICBK
U19SRVFVSVJFU19TVEFDSyB2b2lkIHN0b3JlTWFnaWMoSlNXaHlNYWdpYyB3aHksIHRqaXQ6OkFk
ZHJlc3MgYWRkcik7Ci0gICAgSlNfUkVRVUlSRVNfU1RBQ0sgQWJvcnRhYmxlUmVjb3JkaW5nU3Rh
dHVzIHVuYm94TmV4dFZhbHVlKG5hbm9qaXQ6OkxJbnMqICZ2X2lucyk7CisgICAgSlNfUkVRVUlS
RVNfU1RBQ0sgQWJvcnRhYmxlUmVjb3JkaW5nU3RhdHVzIHVuYm94TmV4dFZhbHVlKFZhbHVlJiBp
dGVyb2JqX3ZhbCwKKyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgbmFub2ppdDo6TElucyogJnZfaW5zKTsKIAogICAgIEpTX1JFUVVJ
UkVTX1NUQUNLIFZNU2lkZUV4aXQqIGVudGVyRGVlcEJhaWxDYWxsKCk7CiAgICAgSlNfUkVRVUlS
RVNfU1RBQ0sgdm9pZCBsZWF2ZURlZXBCYWlsQ2FsbCgpOwogCiAgICAgSlNfUkVRVUlSRVNfU1RB
Q0sgUmVjb3JkaW5nU3RhdHVzIHByaW1pdGl2ZVRvU3RyaW5nSW5QbGFjZShWYWx1ZSogdnApOwog
ICAgIEpTX1JFUVVJUkVTX1NUQUNLIHZvaWQgZmluaXNoR2V0UHJvcChuYW5vaml0OjpMSW5zKiBv
YmpfaW5zLCBuYW5vaml0OjpMSW5zKiB2cF9pbnMsCiAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgIG5hbm9qaXQ6OkxJbnMqIG9rX2lucywgVmFsdWUqIG91dHApOwogICAg
IEpTX1JFUVVJUkVTX1NUQUNLIFJlY29yZGluZ1N0YXR1cyBnZXRQcm9wZXJ0eUJ5TmFtZShuYW5v
aml0OjpMSW5zKiBvYmpfaW5zLCBWYWx1ZSogaWR2YWxwLApkaWZmIC0tZ2l0IGEvanMvc3JjL2pz
eGRyYXBpLmggYi9qcy9zcmMvanN4ZHJhcGkuaAotLS0gYS9qcy9zcmMvanN4ZHJhcGkuaAorKysg
Yi9qcy9zcmMvanN4ZHJhcGkuaApAQCAtMjI2LDE3ICsyMjYsMTcgQEAgSlNfWERSRmluZENsYXNz
QnlJZChKU1hEUlN0YXRlICp4ZHIsIHVpbgogICogQnl0ZWNvZGUgdmVyc2lvbiBudW1iZXIuIElu
Y3JlbWVudCB0aGUgc3VidHJhaGVuZCB3aGVuZXZlciBKUyBieXRlY29kZQogICogY2hhbmdlcyBp
bmNvbXBhdGlibHkuCiAgKgogICogVGhpcyB2ZXJzaW9uIG51bWJlciBzaG91bGQgYmUgWERSJ2Vk
IG9uY2UgbmVhciB0aGUgZnJvbnQgb2YgYW55IGZpbGUgb3IKICAqIGxhcmdlciBzdG9yYWdlIHVu
aXQgY29udGFpbmluZyBYRFInZWQgYnl0ZWNvZGUgYW5kIG90aGVyIGRhdGEsIGFuZCBjaGVja2Vk
CiAgKiBiZWZvcmUgZGVzZXJpYWxpemF0aW9uIG9mIGJ5dGVjb2RlLiAgSWYgdGhlIHNhdmVkIHZl
cnNpb24gZG9lcyBub3QgbWF0Y2gKICAqIHRoZSBjdXJyZW50IHZlcnNpb24sIGFib3J0IGRlc2Vy
aWFsaXphdGlvbiBhbmQgaW52YWxpZGF0ZSB0aGUgZmlsZS4KICAqLwotI2RlZmluZSBKU1hEUl9C
WVRFQ09ERV9WRVJTSU9OICAgICAgKDB4Yjk3M2MwZGUgLSA4NSkKKyNkZWZpbmUgSlNYRFJfQllU
RUNPREVfVkVSU0lPTiAgICAgICgweGI5NzNjMGRlIC0gODYpCiAKIC8qCiAgKiBMaWJyYXJ5LXBy
aXZhdGUgZnVuY3Rpb25zLgogICovCiBleHRlcm4gSlNCb29sCiBqc19YRFJBdG9tKEpTWERSU3Rh
dGUgKnhkciwgSlNBdG9tICoqYXRvbXApOwogCiBKU19FTkRfRVhURVJOX0MKZGlmZiAtLWdpdCBh
L2pzL3NyYy9tZXRob2RqaXQvQ29tcGlsZXIuY3BwIGIvanMvc3JjL21ldGhvZGppdC9Db21waWxl
ci5jcHAKLS0tIGEvanMvc3JjL21ldGhvZGppdC9Db21waWxlci5jcHAKKysrIGIvanMvc3JjL21l
dGhvZGppdC9Db21waWxlci5jcHAKQEAgLTEwMDksMjggKzEwMDksMTYgQEAgbWppdDo6Q29tcGls
ZXI6OmdlbmVyYXRlTWV0aG9kKCkKICAgICAgICAgICAgICAqLwogICAgICAgICAgICAgaWYgKGNh
blVzZUFwcGx5VHJpY2tzKCkpCiAgICAgICAgICAgICAgICAgYXBwbHlUcmlja3MgPSBMYXp5QXJn
c09iajsKICAgICAgICAgICAgIGVsc2UKICAgICAgICAgICAgICAgICBqc29wX2FyZ3VtZW50cygp
OwogICAgICAgICAgICAgZnJhbWUucHVzaFN5bmNlZCgpOwogICAgICAgICAgIEVORF9DQVNFKEpT
T1BfQVJHVU1FTlRTKQogCi0gICAgICAgICAgQkVHSU5fQ0FTRShKU09QX0ZPUkFSRykKLSAgICAg
ICAgICAgIGl0ZXJOZXh0KCk7Ci0gICAgICAgICAgICBmcmFtZS5zdG9yZUFyZyhHRVRfU0xPVE5P
KFBDKSwgdHJ1ZSk7Ci0gICAgICAgICAgICBmcmFtZS5wb3AoKTsKLSAgICAgICAgICBFTkRfQ0FT
RShKU09QX0ZPUkFSRykKLQotICAgICAgICAgIEJFR0lOX0NBU0UoSlNPUF9GT1JMT0NBTCkKLSAg
ICAgICAgICAgIGl0ZXJOZXh0KCk7Ci0gICAgICAgICAgICBmcmFtZS5zdG9yZUxvY2FsKEdFVF9T
TE9UTk8oUEMpLCB0cnVlKTsKLSAgICAgICAgICAgIGZyYW1lLnBvcCgpOwotICAgICAgICAgIEVO
RF9DQVNFKEpTT1BfRk9STE9DQUwpCi0KICAgICAgICAgICBCRUdJTl9DQVNFKEpTT1BfRFVQKQog
ICAgICAgICAgICAgZnJhbWUuZHVwKCk7CiAgICAgICAgICAgRU5EX0NBU0UoSlNPUF9EVVApCiAK
ICAgICAgICAgICBCRUdJTl9DQVNFKEpTT1BfRFVQMikKICAgICAgICAgICAgIGZyYW1lLmR1cDIo
KTsKICAgICAgICAgICBFTkRfQ0FTRShKU09QX0RVUDIpCiAKQEAgLTE1MDIsMjIgKzE0OTAsMjYg
QEAgbWppdDo6Q29tcGlsZXI6OmdlbmVyYXRlTWV0aG9kKCkKICAgICAgICAgICAgIGpzb3Bfc3Ry
aWN0ZXEob3ApOwogICAgICAgICAgIEVORF9DQVNFKEpTT1BfU1RSSUNUTkUpCiAKICAgICAgICAg
ICBCRUdJTl9DQVNFKEpTT1BfSVRFUikKICAgICAgICAgICAgIGlmICghaXRlcihQQ1sxXSkpCiAg
ICAgICAgICAgICAgICAgcmV0dXJuIENvbXBpbGVfRXJyb3I7CiAgICAgICAgICAgRU5EX0NBU0Uo
SlNPUF9JVEVSKQogCi0gICAgICAgICAgQkVHSU5fQ0FTRShKU09QX01PUkVJVEVSKQorICAgICAg
ICAgIEJFR0lOX0NBU0UoSlNPUF9IQVNORVhUKQogICAgICAgICAgICAgLyogQXQgdGhlIGJ5dGUg
bGV2ZWwsIHRoaXMgaXMgYWx3YXlzIGZ1c2VkIHdpdGggSUZORSBvciBJRk5FWC4gKi8KLSAgICAg
ICAgICAgIGlmICghaXRlck1vcmUoKSkKKyAgICAgICAgICAgIGlmICghaXRlckhhc05leHQoKSkK
ICAgICAgICAgICAgICAgICByZXR1cm4gQ29tcGlsZV9FcnJvcjsKICAgICAgICAgICAgIGJyZWFr
OwotICAgICAgICAgIEVORF9DQVNFKEpTT1BfTU9SRUlURVIpCisgICAgICAgICAgRU5EX0NBU0Uo
SlNPUF9IQVNORVhUKQorCisgICAgICAgICAgQkVHSU5fQ0FTRShKU09QX05FWFQpCisgICAgICAg
ICAgICBpdGVyTmV4dChQQ1sxXSk7CisgICAgICAgICAgRU5EX0NBU0UoSlNPUF9ORVhUKQogCiAg
ICAgICAgICAgQkVHSU5fQ0FTRShKU09QX0VORElURVIpCiAgICAgICAgICAgICBpdGVyRW5kKCk7
CiAgICAgICAgICAgRU5EX0NBU0UoSlNPUF9FTkRJVEVSKQogCiAgICAgICAgICAgQkVHSU5fQ0FT
RShKU09QX1BPUCkKICAgICAgICAgICAgIGZyYW1lLnBvcCgpOwogICAgICAgICAgIEVORF9DQVNF
KEpTT1BfUE9QKQpAQCAtMTY0NSwzNCArMTYzNywxNiBAQCBtaml0OjpDb21waWxlcjo6Z2VuZXJh
dGVNZXRob2QoKQogICAgICAgICAgICAganNvcF9sb2NhbGluYyhvcCwgR0VUX1NMT1ROTyhQQyks
IHBvcHBlZCk7CiAgICAgICAgICAgICBQQyArPSBKU09QX0xPQ0FMSU5DX0xFTkdUSDsKICAgICAg
ICAgICAgIGlmIChwb3BwZWQpCiAgICAgICAgICAgICAgICAgUEMgKz0gSlNPUF9QT1BfTEVOR1RI
OwogICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgfQogICAgICAgICAgIEVORF9DQVNFKEpT
T1BfTE9DQUxERUMpCiAKLSAgICAgICAgICBCRUdJTl9DQVNFKEpTT1BfRk9STkFNRSkKLSAgICAg
ICAgICAgIGpzb3BfZm9ybmFtZShzY3JpcHQtPmdldEF0b20oZnVsbEF0b21JbmRleChQQykpKTsK
LSAgICAgICAgICBFTkRfQ0FTRShKU09QX0ZPUk5BTUUpCi0KLSAgICAgICAgICBCRUdJTl9DQVNF
KEpTT1BfRk9SR05BTUUpCi0gICAgICAgICAgICBqc29wX2ZvcmduYW1lKHNjcmlwdC0+Z2V0QXRv
bShmdWxsQXRvbUluZGV4KFBDKSkpOwotICAgICAgICAgIEVORF9DQVNFKEpTT1BfRk9SR05BTUUp
Ci0KLSAgICAgICAgICBCRUdJTl9DQVNFKEpTT1BfRk9SUFJPUCkKLSAgICAgICAgICAgIGpzb3Bf
Zm9ycHJvcChzY3JpcHQtPmdldEF0b20oZnVsbEF0b21JbmRleChQQykpKTsKLSAgICAgICAgICBF
TkRfQ0FTRShKU09QX0ZPUlBST1ApCi0KLSAgICAgICAgICBCRUdJTl9DQVNFKEpTT1BfRk9SRUxF
TSkKLSAgICAgICAgICAgIC8vIFRoaXMgb3Bjb2RlIGlzIGZvciB0aGUgZGVjb21waWxlcjsgaXQg
aXMgc3VjY2VlZGVkIGJ5IGFuCi0gICAgICAgICAgICAvLyBFTlVNRUxFTSwgd2hpY2ggcGVyZm9y
bXMgdGhlIGFjdHVhbCBhcnJheSBzdG9yZS4KLSAgICAgICAgICAgIGl0ZXJOZXh0KCk7Ci0gICAg
ICAgICAgRU5EX0NBU0UoSlNPUF9GT1JFTEVNKQotCiAgICAgICAgICAgQkVHSU5fQ0FTRShKU09Q
X0JJTkROQU1FKQogICAgICAgICAgICAganNvcF9iaW5kbmFtZShzY3JpcHQtPmdldEF0b20oZnVs
bEF0b21JbmRleChQQykpLCB0cnVlKTsKICAgICAgICAgICBFTkRfQ0FTRShKU09QX0JJTkROQU1F
KQogCiAgICAgICAgICAgQkVHSU5fQ0FTRShKU09QX1NFVFBST1ApCiAgICAgICAgICAgICBpZiAo
IWpzb3Bfc2V0cHJvcChzY3JpcHQtPmdldEF0b20oZnVsbEF0b21JbmRleChQQykpLCB0cnVlKSkK
ICAgICAgICAgICAgICAgICByZXR1cm4gQ29tcGlsZV9FcnJvcjsKICAgICAgICAgICBFTkRfQ0FT
RShKU09QX1NFVFBST1ApCkBAIC00MTEwLDIzICs0MDg0LDIzIEBAIG1qaXQ6OkNvbXBpbGVyOjpp
dGVyKHVpbnROIGZsYWdzKQogICAgIGZyYW1lLnB1c2hUeXBlZFBheWxvYWQoSlNWQUxfVFlQRV9P
QkpFQ1QsIGlvcmVnKTsKIAogICAgIHN0dWJjYy5yZWpvaW4oQ2hhbmdlcygxKSk7CiAKICAgICBy
ZXR1cm4gdHJ1ZTsKIH0KIAogLyoKLSAqIFRoaXMgYmlnIG5hc3R5IGZ1bmN0aW9uIGVtaXRzIGEg
ZmFzdC1wYXRoIGZvciBuYXRpdmUgaXRlcmF0b3JzLCBwcm9kdWNpbmcKLSAqIGEgdGVtcG9yYXJ5
IHZhbHVlIG9uIHRoZSBzdGFjayBmb3IgRk9STE9DQUwsQVJHLEdMT0JBTCxldGMgb3BzIHRvIHVz
ZS4KKyAqIFRoaXMgYmlnIG5hc3R5IGZ1bmN0aW9uIGltcGxlbWVudHMgSlNPUF9ORVhULCB3aGlj
aCBpcyB1c2VkIGluIHRoZSBoZWFkIG9mIGEKKyAqIGZvci1pbiBsb29wIHRvIHB1dCB0aGUgbmV4
dCB2YWx1ZSBvbiB0aGUgc3RhY2suCiAgKi8KIHZvaWQKLW1qaXQ6OkNvbXBpbGVyOjppdGVyTmV4
dCgpCittaml0OjpDb21waWxlcjo6aXRlck5leHQocHRyZGlmZl90IG9mZnNldCkKIHsKLSAgICBG
cmFtZUVudHJ5ICpmZSA9IGZyYW1lLnBlZWsoLTEpOworICAgIEZyYW1lRW50cnkgKmZlID0gZnJh
bWUucGVlaygtb2Zmc2V0KTsKICAgICBSZWdpc3RlcklEIHJlZyA9IGZyYW1lLnRlbXBSZWdGb3JE
YXRhKGZlKTsKIAogICAgIC8qIElzIGl0IHdvcnRoIHRyeWluZyB0byBwaW4gdGhpcyBsb25nZXI/
IFByb2xseSBub3QuICovCiAgICAgZnJhbWUucGluUmVnKHJlZyk7CiAgICAgUmVnaXN0ZXJJRCBU
MSA9IGZyYW1lLmFsbG9jUmVnKCk7CiAgICAgZnJhbWUudW5waW5SZWcocmVnKTsKIAogICAgIC8q
IFRlc3QgY2xhc3AgKi8KQEAgLTQxNjksMTcgKzQxNDMsMTcgQEAgbWppdDo6Q29tcGlsZXI6Oml0
ZXJOZXh0KCkKIAogICAgIGZyYW1lLnB1c2hVbnR5cGVkUGF5bG9hZChKU1ZBTF9UWVBFX1NUUklO
RywgVDMpOwogCiAgICAgLyogSm9pbiB3aXRoIHRoZSBzdHViIGNhbGwuICovCiAgICAgc3R1YmNj
LnJlam9pbihDaGFuZ2VzKDEpKTsKIH0KIAogYm9vbAotbWppdDo6Q29tcGlsZXI6Oml0ZXJNb3Jl
KCkKK21qaXQ6OkNvbXBpbGVyOjppdGVySGFzTmV4dCgpCiB7CiAgICAgRnJhbWVFbnRyeSAqZmUg
PSBmcmFtZS5wZWVrKC0xKTsKICAgICBSZWdpc3RlcklEIHJlZyA9IGZyYW1lLnRlbXBSZWdGb3JE
YXRhKGZlKTsKIAogICAgIGZyYW1lLnBpblJlZyhyZWcpOwogICAgIFJlZ2lzdGVySUQgVDEgPSBm
cmFtZS5hbGxvY1JlZygpOwogICAgIGZyYW1lLnVucGluUmVnKHJlZyk7CiAKQEAgLTQxOTcsMzAg
KzQxNzEsMzAgQEAgbWppdDo6Q29tcGlsZXI6Oml0ZXJNb3JlKCkKIAogICAgIC8qIEdldCBwcm9w
c19jdXJzb3IsIHRlc3QgKi8KICAgICBSZWdpc3RlcklEIFQyID0gZnJhbWUuYWxsb2NSZWcoKTsK
ICAgICBmcmFtZS5zeW5jQW5kRm9yZ2V0RXZlcnl0aGluZygpOwogICAgIG1hc20ubG9hZFB0cihB
ZGRyZXNzKFQxLCBvZmZzZXRvZihOYXRpdmVJdGVyYXRvciwgcHJvcHNfY3Vyc29yKSksIFQyKTsK
ICAgICBtYXNtLmxvYWRQdHIoQWRkcmVzcyhUMSwgb2Zmc2V0b2YoTmF0aXZlSXRlcmF0b3IsIHBy
b3BzX2VuZCkpLCBUMSk7CiAgICAgSnVtcCBqRmFzdCA9IG1hc20uYnJhbmNoUHRyKEFzc2VtYmxl
cjo6TGVzc1RoYW4sIFQyLCBUMSk7CiAKLSAgICBqc2J5dGVjb2RlICp0YXJnZXQgPSAmUENbSlNP
UF9NT1JFSVRFUl9MRU5HVEhdOworICAgIGpzYnl0ZWNvZGUgKnRhcmdldCA9ICZQQ1tKU09QX0hB
U05FWFRfTEVOR1RIXTsKICAgICBKU09wIG5leHQgPSBKU09wKCp0YXJnZXQpOwogICAgIEpTX0FT
U0VSVChuZXh0ID09IEpTT1BfSUZORSB8fCBuZXh0ID09IEpTT1BfSUZORVgpOwogCiAgICAgdGFy
Z2V0ICs9IChuZXh0ID09IEpTT1BfSUZORSkKICAgICAgICAgICAgICAgPyBHRVRfSlVNUF9PRkZT
RVQodGFyZ2V0KQogICAgICAgICAgICAgICA6IEdFVF9KVU1QWF9PRkZTRVQodGFyZ2V0KTsKIAog
ICAgIHN0dWJjYy5sZWF2ZSgpOwogICAgIE9PTF9TVFVCQ0FMTChzdHViczo6SXRlck1vcmUpOwog
ICAgIEp1bXAgaiA9IHN0dWJjYy5tYXNtLmJyYW5jaFRlc3QzMihBc3NlbWJsZXI6Ok5vblplcm8s
IFJlZ2lzdGVyczo6UmV0dXJuUmVnLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICBSZWdpc3RlcnM6OlJldHVyblJlZyk7CiAKLSAgICBQQyArPSBKU09QX01PUkVJVEVSX0xF
TkdUSDsKKyAgICBQQyArPSBKU09QX0hBU05FWFRfTEVOR1RIOwogICAgIFBDICs9IGpzX0NvZGVT
cGVjW25leHRdLmxlbmd0aDsKIAogICAgIHN0dWJjYy5yZWpvaW4oQ2hhbmdlcygxKSk7CiAKICAg
ICByZXR1cm4ganVtcEFuZFRyYWNlKGpGYXN0LCB0YXJnZXQsICZqKTsKIH0KIAogdm9pZApAQCAt
NDk5NCw3MCArNDk2OCw4IEBAIHZvaWQKIG1qaXQ6OkNvbXBpbGVyOjpqc29wX2NhbGxlbGVtX3Ns
b3coKQogewogICAgIHByZXBhcmVTdHViQ2FsbChVc2VzKDIpKTsKICAgICBJTkxJTkVfU1RVQkNB
TEwoc3R1YnM6OkNhbGxFbGVtKTsKICAgICBmcmFtZS5wb3BuKDIpOwogICAgIGZyYW1lLnB1c2hT
eW5jZWQoKTsKICAgICBmcmFtZS5wdXNoU3luY2VkKCk7CiB9Ci0KLXZvaWQKLW1qaXQ6OkNvbXBp
bGVyOjpqc29wX2ZvcnByb3AoSlNBdG9tICphdG9tKQotewotICAgIC8vIEJlZm9yZTogSVRFUiBP
QkoKLSAgICAvLyBBZnRlcjogIElURVIgT0JKIElURVIKLSAgICBmcmFtZS5kdXBBdCgtMik7Ci0K
LSAgICAvLyBCZWZvcmU6IElURVIgT0JKIElURVIgCi0gICAgLy8gQWZ0ZXI6ICBJVEVSIE9CSiBJ
VEVSIFZBTFVFCi0gICAgaXRlck5leHQoKTsKLQotICAgIC8vIEJlZm9yZTogSVRFUiBPQkogSVRF
UiBWQUxVRQotICAgIC8vIEFmdGVyOiAgSVRFUiBPQkogVkFMVUUKLSAgICBmcmFtZS5zaGltbXko
MSk7Ci0KLSAgICAvLyBCZWZvcmU6IElURVIgT0JKIFZBTFVFCi0gICAgLy8gQWZ0ZXI6ICBJVEVS
IFZBTFVFCi0gICAganNvcF9zZXRwcm9wKGF0b20sIGZhbHNlKTsKLQotICAgIC8vIEJlZm9yZTog
SVRFUiBWQUxVRQotICAgIC8vIEFmdGVyOiAgSVRFUgotICAgIGZyYW1lLnBvcCgpOwotfQotCi12
b2lkCi1taml0OjpDb21waWxlcjo6anNvcF9mb3JuYW1lKEpTQXRvbSAqYXRvbSkKLXsKLSAgICAv
LyBCZWZvcmU6IElURVIKLSAgICAvLyBBZnRlcjogIElURVIgU0NPUEVPQkoKLSAgICBqc29wX2Jp
bmRuYW1lKGF0b20sIGZhbHNlKTsKLSAgICBqc29wX2ZvcnByb3AoYXRvbSk7Ci19Ci0KLXZvaWQK
LW1qaXQ6OkNvbXBpbGVyOjpqc29wX2ZvcmduYW1lKEpTQXRvbSAqYXRvbSkKLXsKLSAgICAvLyBC
ZWZvcmU6IElURVIKLSAgICAvLyBBZnRlcjogIElURVIgR0xPQkFMCi0gICAganNvcF9iaW5kZ25h
bWUoKTsKLQotICAgIC8vIEJlZm9yZTogSVRFUiBHTE9CQUwKLSAgICAvLyBBZnRlcjogIElURVIg
R0xPQkFMIElURVIKLSAgICBmcmFtZS5kdXBBdCgtMik7Ci0KLSAgICAvLyBCZWZvcmU6IElURVIg
R0xPQkFMIElURVIgCi0gICAgLy8gQWZ0ZXI6ICBJVEVSIEdMT0JBTCBJVEVSIFZBTFVFCi0gICAg
aXRlck5leHQoKTsKLQotICAgIC8vIEJlZm9yZTogSVRFUiBHTE9CQUwgSVRFUiBWQUxVRQotICAg
IC8vIEFmdGVyOiAgSVRFUiBHTE9CQUwgVkFMVUUKLSAgICBmcmFtZS5zaGltbXkoMSk7Ci0KLSAg
ICAvLyBCZWZvcmU6IElURVIgR0xPQkFMIFZBTFVFCi0gICAgLy8gQWZ0ZXI6ICBJVEVSIFZBTFVF
Ci0gICAganNvcF9zZXRnbmFtZShhdG9tLCBmYWxzZSk7Ci0KLSAgICAvLyBCZWZvcmU6IElURVIg
VkFMVUUKLSAgICAvLyBBZnRlcjogIElURVIKLSAgICBmcmFtZS5wb3AoKTsKLX0KLQpkaWZmIC0t
Z2l0IGEvanMvc3JjL21ldGhvZGppdC9Db21waWxlci5oIGIvanMvc3JjL21ldGhvZGppdC9Db21w
aWxlci5oCi0tLSBhL2pzL3NyYy9tZXRob2RqaXQvQ29tcGlsZXIuaAorKysgYi9qcy9zcmMvbWV0
aG9kaml0L0NvbXBpbGVyLmgKQEAgLTQwMCwxOCArNDAwLDE4IEBAIGNsYXNzIENvbXBpbGVyIDog
cHVibGljIEJhc2VDb21waWxlcgogICAgIGJvb2wganVtcEluU2NyaXB0KEp1bXAgaiwganNieXRl
Y29kZSAqcGMpOwogICAgIGJvb2wgY29tcGFyZVR3b1ZhbHVlcyhKU0NvbnRleHQgKmN4LCBKU09w
IG9wLCBjb25zdCBWYWx1ZSAmbGhzLCBjb25zdCBWYWx1ZSAmcmhzKTsKICAgICBib29sIGNhblVz
ZUFwcGx5VHJpY2tzKCk7CiAKICAgICAvKiBFbWl0dGluZyBoZWxwZXJzLiAqLwogICAgIHZvaWQg
cmVzdG9yZUZyYW1lUmVncyhBc3NlbWJsZXIgJm1hc20pOwogICAgIGJvb2wgZW1pdFN0dWJDbXBP
cChCb29sU3R1YiBzdHViLCBqc2J5dGVjb2RlICp0YXJnZXQsIEpTT3AgZnVzZWQpOwogICAgIGJv
b2wgaXRlcih1aW50TiBmbGFncyk7Ci0gICAgdm9pZCBpdGVyTmV4dCgpOwotICAgIGJvb2wgaXRl
ck1vcmUoKTsKKyAgICB2b2lkIGl0ZXJOZXh0KHB0cmRpZmZfdCBvZmZzZXQpOworICAgIGJvb2wg
aXRlckhhc05leHQoKTsKICAgICB2b2lkIGl0ZXJFbmQoKTsKICAgICBNYXliZUp1bXAgbG9hZERv
dWJsZShGcmFtZUVudHJ5ICpmZSwgRlBSZWdpc3RlcklEIGZwUmVnKTsKICNpZmRlZiBKU19QT0xZ
SUMKICAgICB2b2lkIHBhc3NJQ0FkZHJlc3MoQmFzZUlDSW5mbyAqaWMpOwogI2VuZGlmCiAjaWZk
ZWYgSlNfTU9OT0lDCiAgICAgdm9pZCBwYXNzTUlDQWRkcmVzcyhHbG9iYWxOYW1lSUNJbmZvICZt
aWMpOwogI2VuZGlmCkBAIC00NjYsMTkgKzQ2NiwxNiBAQCBjbGFzcyBDb21waWxlciA6IHB1Ymxp
YyBCYXNlQ29tcGlsZXIKICAgICBib29sIGpzb3BfaW5zdGFuY2VvZigpOwogICAgIHZvaWQganNv
cF9uYW1lKEpTQXRvbSAqYXRvbSk7CiAgICAgYm9vbCBqc29wX3huYW1lKEpTQXRvbSAqYXRvbSk7
CiAgICAgdm9pZCBlbnRlckJsb2NrKEpTT2JqZWN0ICpvYmopOwogICAgIHZvaWQgbGVhdmVCbG9j
aygpOwogICAgIHZvaWQgZW1pdEV2YWwodWludDMyIGFyZ2MpOwogICAgIHZvaWQganNvcF9hcmd1
bWVudHMoKTsKICAgICBib29sIGpzb3BfdGFibGVzd2l0Y2goanNieXRlY29kZSAqcGMpOwotICAg
IHZvaWQganNvcF9mb3Jwcm9wKEpTQXRvbSAqYXRvbSk7Ci0gICAgdm9pZCBqc29wX2Zvcm5hbWUo
SlNBdG9tICphdG9tKTsKLSAgICB2b2lkIGpzb3BfZm9yZ25hbWUoSlNBdG9tICphdG9tKTsKIAog
ICAgIC8qIEZhc3QgYXJpdGhtZXRpYy4gKi8KICAgICB2b2lkIGpzb3BfYmluYXJ5KEpTT3Agb3As
IFZvaWRTdHViIHN0dWIpOwogICAgIHZvaWQganNvcF9iaW5hcnlfZnVsbChGcmFtZUVudHJ5ICps
aHMsIEZyYW1lRW50cnkgKnJocywgSlNPcCBvcCwgVm9pZFN0dWIgc3R1Yik7CiAgICAgdm9pZCBq
c29wX2JpbmFyeV9mdWxsX3NpbXBsZShGcmFtZUVudHJ5ICpmZSwgSlNPcCBvcCwgVm9pZFN0dWIg
c3R1Yik7CiAgICAgdm9pZCBqc29wX2JpbmFyeV9kb3VibGUoRnJhbWVFbnRyeSAqbGhzLCBGcmFt
ZUVudHJ5ICpyaHMsIEpTT3Agb3AsIFZvaWRTdHViIHN0dWIpOwogICAgIHZvaWQgc2xvd0xvYWRD
b25zdGFudERvdWJsZShBc3NlbWJsZXIgJm1hc20sIEZyYW1lRW50cnkgKmZlLAogICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICBGUFJlZ2lzdGVySUQgZnByZWcpOw==
</data>

          </attachment>
          <attachment
              isobsolete="1"
              ispatch="1"
              isprivate="0"
              isurl="0"
          >
            <attachid>524903</attachid>
            <date>2011-04-09 18:44:00 -0700</date>
            <delta_ts>2011-04-10 09:50:43 -0700</delta_ts>
            <desc>WIP 2 - decompiler not working</desc>
            <filename>bug-648175-rm-jsop-for-take-2-v1.patch</filename>
            <type>text/plain</type>
            <size>71275</size>
            <attacher>jorendorff</attacher>
            
              <data encoding="base64">ZGlmZiAtLWdpdCBhL2pzL3NyYy9qc2FuYWx5emUuY3BwIGIvanMvc3JjL2pzYW5hbHl6ZS5jcHAK
LS0tIGEvanMvc3JjL2pzYW5hbHl6ZS5jcHAKKysrIGIvanMvc3JjL2pzYW5hbHl6ZS5jcHAKQEAg
LTQ1MiwxNyArNDUyLDE2IEBAIFNjcmlwdDo6YW5hbHl6ZShKU0NvbnRleHQgKmN4LCBKU1Njcmlw
dCAKICAgICAgICAgICBjYXNlIEpTT1BfQ0FMTE5BTUU6CiAgICAgICAgICAgY2FzZSBKU09QX0JJ
TkROQU1FOgogICAgICAgICAgIGNhc2UgSlNPUF9TRVROQU1FOgogICAgICAgICAgIGNhc2UgSlNP
UF9ERUxOQU1FOgogICAgICAgICAgIGNhc2UgSlNPUF9JTkNOQU1FOgogICAgICAgICAgIGNhc2Ug
SlNPUF9ERUNOQU1FOgogICAgICAgICAgIGNhc2UgSlNPUF9OQU1FSU5DOgogICAgICAgICAgIGNh
c2UgSlNPUF9OQU1FREVDOgotICAgICAgICAgIGNhc2UgSlNPUF9GT1JOQU1FOgogICAgICAgICAg
ICAgdXNlc1Njb3BlID0gdHJ1ZTsKICAgICAgICAgICAgIGJyZWFrOwogCiAgICAgICAgICAgLyog
V2F0Y2ggZm9yIG9wY29kZXMgdGhlIG1ldGhvZCBKSVQgZG9lc24ndCBjb21waWxlLiAqLwogICAg
ICAgICAgIGNhc2UgSlNPUF9HT1NVQjoKICAgICAgICAgICBjYXNlIEpTT1BfR09TVUJYOgogICAg
ICAgICAgIGNhc2UgSlNPUF9JRlBSSU1UT1A6CiAgICAgICAgICAgY2FzZSBKU09QX0ZJTFRFUjoK
QEAgLTU3NCwxOCArNTczLDE3IEBAIFNjcmlwdDo6YW5hbHl6ZShKU0NvbnRleHQgKmN4LCBKU1Nj
cmlwdCAKICAgICAgICAgICBjYXNlIEpTT1BfTE9DQUxJTkM6CiAgICAgICAgICAgY2FzZSBKU09Q
X0xPQ0FMREVDOiB7CiAgICAgICAgICAgICB1aW50MzIgbG9jYWwgPSBHRVRfU0xPVE5PKHBjKTsK
ICAgICAgICAgICAgIGlmIChsb2NhbCA8IG5maXhlZCAmJiAhbG9jYWxEZWZpbmVkKGxvY2FsLCBv
ZmZzZXQpKQogICAgICAgICAgICAgICAgIHNldExvY2FsKGxvY2FsLCBMT0NBTF9VU0VfQkVGT1JF
X0RFRik7CiAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICB9CiAKLSAgICAgICAgICBjYXNl
IEpTT1BfU0VUTE9DQUw6Ci0gICAgICAgICAgY2FzZSBKU09QX0ZPUkxPQ0FMOiB7CisgICAgICAg
ICAgY2FzZSBKU09QX1NFVExPQ0FMOiB7CiAgICAgICAgICAgICB1aW50MzIgbG9jYWwgPSBHRVRf
U0xPVE5PKHBjKTsKIAogICAgICAgICAgICAgLyoKICAgICAgICAgICAgICAqIFRoZSBsb2NhbCB2
YXJpYWJsZSBtYXkgYWxyZWFkeSBoYXZlIGJlZW4gbWFya2VkIGFzIHVuY29uZGl0aW9uYWxseQog
ICAgICAgICAgICAgICogZGVmaW5lZCBhdCBhIGxhdGVyIHBvaW50IGluIHRoZSBzY3JpcHQsIGlm
IHRoYXQgZGVmaW5pdGlvbiB3YXMgaW4gdGhlCiAgICAgICAgICAgICAgKiBjb25kaXRpb24gZm9y
IGEgbG9vcCB3aGljaCB0aGVuIGp1bXBlZCBiYWNrIGhlcmUuICBJbiBzdWNoIGNhc2VzIHdlCiAg
ICAgICAgICAgICAgKiB3aWxsIG5vdCB0cmVhdCB0aGUgdmFyaWFibGUgYXMgZXZlciBiZWluZyBk
ZWZpbmVkIGluIHRoZSBsb29wIGJvZHkKICAgICAgICAgICAgICAqIChzZWUgc2V0TG9jYWwpLgpk
aWZmIC0tZ2l0IGEvanMvc3JjL2pzY250eHQuaCBiL2pzL3NyYy9qc2NudHh0LmgKLS0tIGEvanMv
c3JjL2pzY250eHQuaAorKysgYi9qcy9zcmMvanNjbnR4dC5oCkBAIC0xOTM4LDE3ICsxOTM4LDE3
IEBAIHN0cnVjdCBKU0NvbnRleHQKICAgICBKU1NlY3VyaXR5Q2FsbGJhY2tzICpzZWN1cml0eUNh
bGxiYWNrczsKIAogICAgIC8qIFN0b3JlZCBoZXJlIHRvIGF2b2lkIHBhc3NpbmcgaXQgYXJvdW5k
IGFzIGEgcGFyYW1ldGVyLiAqLwogICAgIHVpbnROICAgICAgICAgICAgICAgcmVzb2x2ZUZsYWdz
OwogCiAgICAgLyogUmFuZG9tIG51bWJlciBnZW5lcmF0b3Igc3RhdGUsIHVzZWQgYnkganNtYXRo
LmNwcC4gKi8KICAgICBpbnQ2NCAgICAgICAgICAgICAgIHJuZ1NlZWQ7CiAKLSAgICAvKiBMb2Nh
dGlvbiB0byBzdGFzaCB0aGUgaXRlcmF0aW9uIHZhbHVlIGJldHdlZW4gSlNPUF9NT1JFSVRFUiBh
bmQgSlNPUF9GT1IqLiAqLworICAgIC8qIExvY2F0aW9uIHRvIHN0YXNoIHRoZSBpdGVyYXRpb24g
dmFsdWUgYmV0d2VlbiBKU09QX01PUkVJVEVSIGFuZCBKU09QX0lURVJORVhULiAqLwogICAgIGpz
OjpWYWx1ZSAgICAgICAgICAgaXRlclZhbHVlOwogCiAjaWZkZWYgSlNfVFJBQ0VSCiAgICAgLyoK
ICAgICAgKiBUcnVlIGlmIHRyYWNlcyBtYXkgYmUgZXhlY3V0ZWQuIEludmFyaWFudDogVGhlIHZh
bHVlIG9mIHRyYWNlSml0ZW5hYmxlZAogICAgICAqIGlzIGFsd2F5cyBlcXVhbCB0byB0aGUgZXhw
cmVzc2lvbiBpbiB1cGRhdGVKSVRFbmFibGVkIGJlbG93LgogICAgICAqCiAgICAgICogVGhpcyBm
bGFnIGFuZCB0aGUgZmllbGRzIGFjY2Vzc2VkIGJ5IHVwZGF0ZUpJVEVuYWJsZWQgYXJlIHdyaXR0
ZW4gb25seQpkaWZmIC0tZ2l0IGEvanMvc3JjL2pzZW1pdC5jcHAgYi9qcy9zcmMvanNlbWl0LmNw
cAotLS0gYS9qcy9zcmMvanNlbWl0LmNwcAorKysgYi9qcy9zcmMvanNlbWl0LmNwcApAQCAtMjAx
NCwxNyArMjAxNCwxNiBAQCBUcnlDb252ZXJ0VG9HbmFtZShKU0NvZGVHZW5lcmF0b3IgKmNnLCBK
CiAgICAgICAgICEoY2ctPmZsYWdzICYgVENGX1NUUklDVF9NT0RFX0NPREUpKSB7IAogICAgICAg
ICBzd2l0Y2ggKCpvcCkgewogICAgICAgICAgIGNhc2UgSlNPUF9OQU1FOiAgICAgKm9wID0gSlNP
UF9HRVRHTkFNRTsgYnJlYWs7CiAgICAgICAgICAgY2FzZSBKU09QX1NFVE5BTUU6ICAqb3AgPSBK
U09QX1NFVEdOQU1FOyBicmVhazsKICAgICAgICAgICBjYXNlIEpTT1BfSU5DTkFNRTogICpvcCA9
IEpTT1BfSU5DR05BTUU7IGJyZWFrOwogICAgICAgICAgIGNhc2UgSlNPUF9OQU1FSU5DOiAgKm9w
ID0gSlNPUF9HTkFNRUlOQzsgYnJlYWs7CiAgICAgICAgICAgY2FzZSBKU09QX0RFQ05BTUU6ICAq
b3AgPSBKU09QX0RFQ0dOQU1FOyBicmVhazsKICAgICAgICAgICBjYXNlIEpTT1BfTkFNRURFQzog
ICpvcCA9IEpTT1BfR05BTUVERUM7IGJyZWFrOwotICAgICAgICAgIGNhc2UgSlNPUF9GT1JOQU1F
OiAgKm9wID0gSlNPUF9GT1JHTkFNRTsgYnJlYWs7CiAgICAgICAgICAgY2FzZSBKU09QX1NFVENP
TlNUOgogICAgICAgICAgIGNhc2UgSlNPUF9ERUxOQU1FOgogICAgICAgICAgICAgLyogTm90IHN1
cHBvcnRlZC4gKi8KICAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICAgICBkZWZhdWx0
OiBKU19OT1RfUkVBQ0hFRCgiZ25hbWUiKTsKICAgICAgICAgfQogICAgICAgICByZXR1cm4gdHJ1
ZTsKICAgICB9CkBAIC0yMzQzLDMwICsyMzQyLDI4IEBAIEJpbmROYW1lVG9TbG90KEpTQ29udGV4
dCAqY3gsIEpTQ29kZUdlbmUKICAgICAgIGNhc2UgSlNEZWZpbml0aW9uOjpMRVQ6CiAgICAgICAg
IHN3aXRjaCAob3ApIHsKICAgICAgICAgICBjYXNlIEpTT1BfTkFNRTogICAgIG9wID0gSlNPUF9H
RVRMT0NBTDsgYnJlYWs7CiAgICAgICAgICAgY2FzZSBKU09QX1NFVE5BTUU6ICBvcCA9IEpTT1Bf
U0VUTE9DQUw7IGJyZWFrOwogICAgICAgICAgIGNhc2UgSlNPUF9JTkNOQU1FOiAgb3AgPSBKU09Q
X0lOQ0xPQ0FMOyBicmVhazsKICAgICAgICAgICBjYXNlIEpTT1BfTkFNRUlOQzogIG9wID0gSlNP
UF9MT0NBTElOQzsgYnJlYWs7CiAgICAgICAgICAgY2FzZSBKU09QX0RFQ05BTUU6ICBvcCA9IEpT
T1BfREVDTE9DQUw7IGJyZWFrOwogICAgICAgICAgIGNhc2UgSlNPUF9OQU1FREVDOiAgb3AgPSBK
U09QX0xPQ0FMREVDOyBicmVhazsKLSAgICAgICAgICBjYXNlIEpTT1BfRk9STkFNRTogIG9wID0g
SlNPUF9GT1JMT0NBTDsgYnJlYWs7CiAgICAgICAgICAgZGVmYXVsdDogSlNfTk9UX1JFQUNIRUQo
ImxldCIpOwogICAgICAgICB9CiAgICAgICAgIGJyZWFrOwogCiAgICAgICBjYXNlIEpTRGVmaW5p
dGlvbjo6QVJHOgogICAgICAgICBzd2l0Y2ggKG9wKSB7CiAgICAgICAgICAgY2FzZSBKU09QX05B
TUU6ICAgICBvcCA9IEpTT1BfR0VUQVJHOyBicmVhazsKICAgICAgICAgICBjYXNlIEpTT1BfU0VU
TkFNRTogIG9wID0gSlNPUF9TRVRBUkc7IGJyZWFrOwogICAgICAgICAgIGNhc2UgSlNPUF9JTkNO
QU1FOiAgb3AgPSBKU09QX0lOQ0FSRzsgYnJlYWs7CiAgICAgICAgICAgY2FzZSBKU09QX05BTUVJ
TkM6ICBvcCA9IEpTT1BfQVJHSU5DOyBicmVhazsKICAgICAgICAgICBjYXNlIEpTT1BfREVDTkFN
RTogIG9wID0gSlNPUF9ERUNBUkc7IGJyZWFrOwogICAgICAgICAgIGNhc2UgSlNPUF9OQU1FREVD
OiAgb3AgPSBKU09QX0FSR0RFQzsgYnJlYWs7Ci0gICAgICAgICAgY2FzZSBKU09QX0ZPUk5BTUU6
ICBvcCA9IEpTT1BfRk9SQVJHOyBicmVhazsKICAgICAgICAgICBkZWZhdWx0OiBKU19OT1RfUkVB
Q0hFRCgiYXJnIik7CiAgICAgICAgIH0KICAgICAgICAgSlNfQVNTRVJUKCFwbi0+aXNDb25zdCgp
KTsKICAgICAgICAgYnJlYWs7CiAKICAgICAgIGNhc2UgSlNEZWZpbml0aW9uOjpWQVI6CiAgICAg
ICAgIGlmIChQTl9PUChkbikgPT0gSlNPUF9DQUxMRUUpIHsKICAgICAgICAgICAgIEpTX0FTU0VS
VChvcCAhPSBKU09QX0NBTExFRSk7CkBAIC0yNDE1LDE3ICsyNDEyLDE2IEBAIEJpbmROYW1lVG9T
bG90KEpTQ29udGV4dCAqY3gsIEpTQ29kZUdlbmUKICAgICAgICAgc3dpdGNoIChvcCkgewogICAg
ICAgICAgIGNhc2UgSlNPUF9OQU1FOiAgICAgb3AgPSBKU09QX0dFVExPQ0FMOyBicmVhazsKICAg
ICAgICAgICBjYXNlIEpTT1BfU0VUTkFNRTogIG9wID0gSlNPUF9TRVRMT0NBTDsgYnJlYWs7CiAg
ICAgICAgICAgY2FzZSBKU09QX1NFVENPTlNUOiBvcCA9IEpTT1BfU0VUTE9DQUw7IGJyZWFrOwog
ICAgICAgICAgIGNhc2UgSlNPUF9JTkNOQU1FOiAgb3AgPSBKU09QX0lOQ0xPQ0FMOyBicmVhazsK
ICAgICAgICAgICBjYXNlIEpTT1BfTkFNRUlOQzogIG9wID0gSlNPUF9MT0NBTElOQzsgYnJlYWs7
CiAgICAgICAgICAgY2FzZSBKU09QX0RFQ05BTUU6ICBvcCA9IEpTT1BfREVDTE9DQUw7IGJyZWFr
OwogICAgICAgICAgIGNhc2UgSlNPUF9OQU1FREVDOiAgb3AgPSBKU09QX0xPQ0FMREVDOyBicmVh
azsKLSAgICAgICAgICBjYXNlIEpTT1BfRk9STkFNRTogIG9wID0gSlNPUF9GT1JMT0NBTDsgYnJl
YWs7CiAgICAgICAgICAgZGVmYXVsdDogSlNfTk9UX1JFQUNIRUQoImxvY2FsIik7CiAgICAgICAg
IH0KICAgICAgICAgSlNfQVNTRVJUX0lGKGRuX2tpbmQgPT0gSlNEZWZpbml0aW9uOjpDT05TVCwg
cG4tPnBuX2RmbGFncyAmIFBORF9DT05TVCk7CiAgICAgICAgIGJyZWFrOwogICAgIH0KIAogICAg
IEpTX0FTU0VSVChvcCAhPSBQTl9PUChwbikpOwogICAgIHBuLT5wbl9vcCA9IG9wOwpAQCAtNDM1
NywxNiArNDM1MywyMTQgQEAgRW1pdFZhcmlhYmxlcyhKU0NvbnRleHQgKmN4LCBKU0NvZGVHZW5l
cgogICAgICAgICAgICAgcmV0dXJuIEpTX0ZBTFNFOwogICAgICAgICBpZiAoIShwbi0+cG5feGZs
YWdzICYgUE5YX1BPUFZBUikpCiAgICAgICAgICAgICByZXR1cm4ganNfRW1pdDEoY3gsIGNnLCBK
U09QX05PUCkgPj0gMDsKICAgICB9CiAKICAgICByZXR1cm4gIShwbi0+cG5feGZsYWdzICYgUE5Y
X1BPUFZBUikgfHwganNfRW1pdDEoY3gsIGNnLCBKU09QX1BPUCkgPj0gMDsKIH0KIAorc3RhdGlj
IGJvb2wKK0VtaXRBc3NpZ25tZW50KEpTQ29udGV4dCAqY3gsIEpTQ29kZUdlbmVyYXRvciAqY2cs
IEpTUGFyc2VOb2RlICpsaHMsIEpTT3Agb3AsIEpTUGFyc2VOb2RlICpyaHMpCit7CisgICAgcHRy
ZGlmZl90IHRvcCA9IENHX09GRlNFVChjZyk7CisKKyAgICAvKgorICAgICAqIENoZWNrIGxlZnQg
b3BlcmFuZCB0eXBlIGFuZCBnZW5lcmF0ZSBzcGVjaWFsaXplZCBjb2RlIGZvciBpdC4KKyAgICAg
KiBTcGVjaWFsaXplIHRvIGF2b2lkIEVDTUEgInJlZmVyZW5jZSB0eXBlIiB2YWx1ZXMgb24gdGhl
IG9wZXJhbmQKKyAgICAgKiBzdGFjaywgd2hpY2ggaW1wb3NlIHBlcnZhc2l2ZSBydW50aW1lICJH
ZXRWYWx1ZSIgY29zdHMuCisgICAgICovCisgICAganNhdG9taWQgYXRvbUluZGV4ID0gKGpzYXRv
bWlkKSAtMTsgICAgICAgICAgICAgIC8qIHF1ZWxsIEdDQyBvdmVyd2FybmluZyAqLworICAgIGpz
Ynl0ZWNvZGUgb2Zmc2V0ID0gMTsKKyAgICBKU0F0b21MaXN0RWxlbWVudCAqYWxlOworICAgIHN3
aXRjaCAoUE5fVFlQRShsaHMpKSB7CisgICAgICBjYXNlIFRPS19OQU1FOgorICAgICAgICBpZiAo
IUJpbmROYW1lVG9TbG90KGN4LCBjZywgbGhzKSkKKyAgICAgICAgICAgIHJldHVybiBmYWxzZTsK
KyAgICAgICAgaWYgKCFsaHMtPnBuX2Nvb2tpZS5pc0ZyZWUoKSkgeworICAgICAgICAgICAgYXRv
bUluZGV4ID0gKGpzYXRvbWlkKSBsaHMtPnBuX2Nvb2tpZS5hc0ludGVnZXIoKTsKKyAgICAgICAg
fSBlbHNlIHsKKyAgICAgICAgICAgIGFsZSA9IGNnLT5hdG9tTGlzdC5hZGQoY2ctPnBhcnNlciwg
bGhzLT5wbl9hdG9tKTsKKyAgICAgICAgICAgIGlmICghYWxlKQorICAgICAgICAgICAgICAgIHJl
dHVybiBmYWxzZTsKKyAgICAgICAgICAgIGF0b21JbmRleCA9IEFMRV9JTkRFWChhbGUpOworICAg
ICAgICAgICAgaWYgKCFsaHMtPmlzQ29uc3QoKSkgeworICAgICAgICAgICAgICAgIEpTT3Agb3Ag
PSBQTl9PUChsaHMpID09IEpTT1BfU0VUR05BTUUgPyBKU09QX0JJTkRHTkFNRSA6IEpTT1BfQklO
RE5BTUU7CisgICAgICAgICAgICAgICAgRU1JVF9JTkRFWF9PUChvcCwgYXRvbUluZGV4KTsKKyAg
ICAgICAgICAgICAgICBvZmZzZXQrKzsKKyAgICAgICAgICAgIH0KKyAgICAgICAgfQorICAgICAg
ICBicmVhazsKKyAgICAgIGNhc2UgVE9LX0RPVDoKKyAgICAgICAgaWYgKCFqc19FbWl0VHJlZShj
eCwgY2csIGxocy0+ZXhwcigpKSkKKyAgICAgICAgICAgIHJldHVybiBmYWxzZTsKKyAgICAgICAg
b2Zmc2V0Kys7CisgICAgICAgIGFsZSA9IGNnLT5hdG9tTGlzdC5hZGQoY2ctPnBhcnNlciwgbGhz
LT5wbl9hdG9tKTsKKyAgICAgICAgaWYgKCFhbGUpCisgICAgICAgICAgICByZXR1cm4gZmFsc2U7
CisgICAgICAgIGF0b21JbmRleCA9IEFMRV9JTkRFWChhbGUpOworICAgICAgICBicmVhazsKKyAg
ICAgIGNhc2UgVE9LX0xCOgorICAgICAgICBKU19BU1NFUlQobGhzLT5wbl9hcml0eSA9PSBQTl9C
SU5BUlkpOworICAgICAgICBpZiAoIWpzX0VtaXRUcmVlKGN4LCBjZywgbGhzLT5wbl9sZWZ0KSkK
KyAgICAgICAgICAgIHJldHVybiBmYWxzZTsKKyAgICAgICAgaWYgKCFqc19FbWl0VHJlZShjeCwg
Y2csIGxocy0+cG5fcmlnaHQpKQorICAgICAgICAgICAgcmV0dXJuIGZhbHNlOworICAgICAgICBv
ZmZzZXQgKz0gMjsKKyAgICAgICAgYnJlYWs7CisjaWYgSlNfSEFTX0RFU1RSVUNUVVJJTkcKKyAg
ICAgIGNhc2UgVE9LX1JCOgorICAgICAgY2FzZSBUT0tfUkM6CisgICAgICAgIGJyZWFrOworI2Vu
ZGlmCisgICAgICBjYXNlIFRPS19MUDoKKyAgICAgICAgaWYgKCFqc19FbWl0VHJlZShjeCwgY2cs
IGxocykpCisgICAgICAgICAgICByZXR1cm4gZmFsc2U7CisgICAgICAgIG9mZnNldCsrOworICAg
ICAgICBicmVhazsKKyNpZiBKU19IQVNfWE1MX1NVUFBPUlQKKyAgICAgIGNhc2UgVE9LX1VOQVJZ
T1A6CisgICAgICAgIEpTX0FTU0VSVChsaHMtPnBuX29wID09IEpTT1BfU0VUWE1MTkFNRSk7Cisg
ICAgICAgIGlmICghanNfRW1pdFRyZWUoY3gsIGNnLCBsaHMtPnBuX2tpZCkpCisgICAgICAgICAg
ICByZXR1cm4gZmFsc2U7CisgICAgICAgIGlmIChqc19FbWl0MShjeCwgY2csIEpTT1BfQklORFhN
TE5BTUUpIDwgMCkKKyAgICAgICAgICAgIHJldHVybiBmYWxzZTsKKyAgICAgICAgb2Zmc2V0Kys7
CisgICAgICAgIGJyZWFrOworI2VuZGlmCisgICAgICBkZWZhdWx0OgorICAgICAgICBKU19BU1NF
UlQoMCk7CisgICAgfQorCisgICAgaWYgKG9wICE9IEpTT1BfTk9QKSB7CisgICAgICAgIEpTX0FT
U0VSVChyaHMpOworICAgICAgICBzd2l0Y2ggKGxocy0+cG5fdHlwZSkgeworICAgICAgICAgIGNh
c2UgVE9LX05BTUU6CisgICAgICAgICAgICBpZiAobGhzLT5pc0NvbnN0KCkpIHsKKyAgICAgICAg
ICAgICAgICBpZiAoUE5fT1AobGhzKSA9PSBKU09QX0NBTExFRSkgeworICAgICAgICAgICAgICAg
ICAgICBpZiAoanNfRW1pdDEoY3gsIGNnLCBKU09QX0NBTExFRSkgPCAwKQorICAgICAgICAgICAg
ICAgICAgICAgICAgcmV0dXJuIGZhbHNlOworICAgICAgICAgICAgICAgIH0gZWxzZSB7CisgICAg
ICAgICAgICAgICAgICAgIEVNSVRfSU5ERVhfT1AoUE5fT1AobGhzKSwgYXRvbUluZGV4KTsKKyAg
ICAgICAgICAgICAgICB9CisgICAgICAgICAgICB9IGVsc2UgaWYgKFBOX09QKGxocykgPT0gSlNP
UF9TRVROQU1FKSB7CisgICAgICAgICAgICAgICAgaWYgKGpzX0VtaXQxKGN4LCBjZywgSlNPUF9E
VVApIDwgMCkKKyAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlOworICAgICAgICAgICAg
ICAgIEVNSVRfSU5ERVhfT1AoSlNPUF9HRVRYUFJPUCwgYXRvbUluZGV4KTsKKyAgICAgICAgICAg
IH0gZWxzZSBpZiAoUE5fT1AobGhzKSA9PSBKU09QX1NFVEdOQU1FKSB7CisgICAgICAgICAgICAg
ICAgaWYgKCFCaW5kR2xvYmFsKGN4LCBjZywgbGhzLCBsaHMtPnBuX2F0b20pKQorICAgICAgICAg
ICAgICAgICAgICByZXR1cm4gZmFsc2U7CisgICAgICAgICAgICAgICAgaWYgKGxocy0+cG5fY29v
a2llLmlzRnJlZSgpKQorICAgICAgICAgICAgICAgICAgICBFbWl0QXRvbU9wKGN4LCBsaHMsIEpT
T1BfR0VUR05BTUUsIGNnKTsKKyAgICAgICAgICAgICAgICBlbHNlCisgICAgICAgICAgICAgICAg
ICAgIEVNSVRfVUlOVDE2X0lNTV9PUChKU09QX0dFVEdMT0JBTCwgbGhzLT5wbl9jb29raWUuYXNJ
bnRlZ2VyKCkpOworICAgICAgICAgICAgfSBlbHNlIHsKKyAgICAgICAgICAgICAgICBFTUlUX1VJ
TlQxNl9JTU1fT1AoKFBOX09QKGxocykgPT0gSlNPUF9TRVRBUkcpCisgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgID8gSlNPUF9HRVRBUkcKKyAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgOiBKU09QX0dFVExPQ0FMLAorICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICBhdG9tSW5kZXgpOworICAgICAgICAgICAgfQorICAgICAgICAgICAgYnJlYWs7Cisg
ICAgICAgICAgY2FzZSBUT0tfRE9UOgorICAgICAgICAgICAgaWYgKGpzX0VtaXQxKGN4LCBjZywg
SlNPUF9EVVApIDwgMCkKKyAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7CisgICAgICAgICAg
ICBpZiAobGhzLT5wbl9hdG9tID09IGN4LT5ydW50aW1lLT5hdG9tU3RhdGUubGVuZ3RoQXRvbSkg
eworICAgICAgICAgICAgICAgIGlmIChqc19FbWl0MShjeCwgY2csIEpTT1BfTEVOR1RIKSA8IDAp
CisgICAgICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTsKKyAgICAgICAgICAgIH0gZWxzZSBp
ZiAobGhzLT5wbl9hdG9tID09IGN4LT5ydW50aW1lLT5hdG9tU3RhdGUucHJvdG9BdG9tKSB7Cisg
ICAgICAgICAgICAgICAgaWYgKCFFbWl0SW5kZXhPcChjeCwgSlNPUF9RTkFNRVBBUlQsIGF0b21J
bmRleCwgY2cpKQorICAgICAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7CisgICAgICAgICAg
ICAgICAgaWYgKGpzX0VtaXQxKGN4LCBjZywgSlNPUF9HRVRFTEVNKSA8IDApCisgICAgICAgICAg
ICAgICAgICAgIHJldHVybiBmYWxzZTsKKyAgICAgICAgICAgIH0gZWxzZSB7CisgICAgICAgICAg
ICAgICAgRU1JVF9JTkRFWF9PUChKU09QX0dFVFBST1AsIGF0b21JbmRleCk7CisgICAgICAgICAg
ICB9CisgICAgICAgICAgICBicmVhazsKKyAgICAgICAgICBjYXNlIFRPS19MQjoKKyAgICAgICAg
ICBjYXNlIFRPS19MUDoKKyNpZiBKU19IQVNfWE1MX1NVUFBPUlQKKyAgICAgICAgICBjYXNlIFRP
S19VTkFSWU9QOgorI2VuZGlmCisgICAgICAgICAgICBpZiAoanNfRW1pdDEoY3gsIGNnLCBKU09Q
X0RVUDIpIDwgMCkKKyAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7CisgICAgICAgICAgICBp
ZiAoanNfRW1pdDEoY3gsIGNnLCBKU09QX0dFVEVMRU0pIDwgMCkKKyAgICAgICAgICAgICAgICBy
ZXR1cm4gZmFsc2U7CisgICAgICAgICAgICBicmVhazsKKyAgICAgICAgICBkZWZhdWx0OjsKKyAg
ICAgICAgfQorICAgIH0KKworICAgIC8qIE5vdyBlbWl0IHRoZSByaWdodCBvcGVyYW5kIChpdCBt
YXkgYWZmZWN0IHRoZSBuYW1lc3BhY2UpLiAqLworICAgIGlmIChyaHMpIHsKKyAgICAgICAgaWYg
KCFqc19FbWl0VHJlZShjeCwgY2csIHJocykpCisgICAgICAgICAgICByZXR1cm4gZmFsc2U7Cisg
ICAgfSBlbHNlIHsKKyAgICAgICAgLyogVGhlIHZhbHVlIHRvIGFzc2lnbiBpcyB0aGUgbmV4dCBl
bnVtZXJhdGlvbiB2YWx1ZSBpbiBhIGZvci1pbiBsb29wLiAqLworICAgICAgICBpZiAoanNfRW1p
dDIoY3gsIGNnLCBKU09QX0lURVJORVhULCBvZmZzZXQpIDwgMCkKKyAgICAgICAgICAgIHJldHVy
biBmYWxzZTsKKyAgICB9CisKKyAgICAvKiBJZiArPSBldGMuLCBlbWl0IHRoZSBiaW5hcnkgb3Bl
cmF0b3Igd2l0aCBhIGRlY29tcGlsZXIgbm90ZS4gKi8KKyAgICBpZiAob3AgIT0gSlNPUF9OT1Ap
IHsKKyAgICAgICAgLyoKKyAgICAgICAgICogVGFrZSBjYXJlIHRvIGF2b2lkIFNSQ19BU1NJR05P
UCBpZiB0aGUgbGVmdC1oYW5kIHNpZGUgaXMgYSBjb25zdAorICAgICAgICAgKiBkZWNsYXJlZCBp
biB0aGUgY3VycmVudCBjb21waWxhdGlvbiB1bml0LCBhcyBpbiB0aGlzIGNhc2UgKGp1c3QKKyAg
ICAgICAgICogYSBiaXQgZnVydGhlciBiZWxvdykgd2Ugd2lsbCBhdm9pZCBlbWl0dGluZyB0aGUg
YXNzaWdubWVudCBvcC4KKyAgICAgICAgICovCisgICAgICAgIGlmIChsaHMtPnBuX3R5cGUgIT0g
VE9LX05BTUUgfHwgIWxocy0+aXNDb25zdCgpKSB7CisgICAgICAgICAgICBpZiAoanNfTmV3U3Jj
Tm90ZShjeCwgY2csIFNSQ19BU1NJR05PUCkgPCAwKQorICAgICAgICAgICAgICAgIHJldHVybiBm
YWxzZTsKKyAgICAgICAgfQorICAgICAgICBpZiAoanNfRW1pdDEoY3gsIGNnLCBvcCkgPCAwKQor
ICAgICAgICAgICAgcmV0dXJuIGZhbHNlOworICAgIH0KKworICAgIC8qIExlZnQgcGFydHMgc3Vj
aCBhcyBhLmIuYyBhbmQgYVtiXS5jIG5lZWQgYSBkZWNvbXBpbGVyIG5vdGUuICovCisgICAgaWYg
KGxocy0+cG5fdHlwZSAhPSBUT0tfTkFNRSAmJgorI2lmIEpTX0hBU19ERVNUUlVDVFVSSU5HCisg
ICAgICAgIGxocy0+cG5fdHlwZSAhPSBUT0tfUkIgJiYKKyAgICAgICAgbGhzLT5wbl90eXBlICE9
IFRPS19SQyAmJgorI2VuZGlmCisgICAgICAgIGpzX05ld1NyY05vdGUyKGN4LCBjZywgU1JDX1BD
QkFTRSwgQ0dfT0ZGU0VUKGNnKSAtIHRvcCkgPCAwKSB7CisgICAgICAgIHJldHVybiBmYWxzZTsK
KyAgICB9CisKKyAgICAvKiBGaW5hbGx5LCBlbWl0IHRoZSBzcGVjaWFsaXplZCBhc3NpZ25tZW50
IGJ5dGVjb2RlLiAqLworICAgIHN3aXRjaCAobGhzLT5wbl90eXBlKSB7CisgICAgICBjYXNlIFRP
S19OQU1FOgorICAgICAgICBpZiAobGhzLT5pc0NvbnN0KCkpCisgICAgICAgICAgICBicmVhazsK
KyAgICAgICAgLyogRkFMTCBUSFJPVUdIICovCisgICAgICBjYXNlIFRPS19ET1Q6CisgICAgICAg
IEVNSVRfSU5ERVhfT1AoUE5fT1AobGhzKSwgYXRvbUluZGV4KTsKKyAgICAgICAgYnJlYWs7Cisg
ICAgICBjYXNlIFRPS19MQjoKKyAgICAgIGNhc2UgVE9LX0xQOgorICAgICAgICBpZiAoanNfRW1p
dDEoY3gsIGNnLCBKU09QX1NFVEVMRU0pIDwgMCkKKyAgICAgICAgICAgIHJldHVybiBmYWxzZTsK
KyAgICAgICAgYnJlYWs7CisjaWYgSlNfSEFTX0RFU1RSVUNUVVJJTkcKKyAgICAgIGNhc2UgVE9L
X1JCOgorICAgICAgY2FzZSBUT0tfUkM6CisgICAgICAgIGlmICghRW1pdERlc3RydWN0dXJpbmdP
cHMoY3gsIGNnLCBKU09QX1NFVE5BTUUsIGxocykpCisgICAgICAgICAgICByZXR1cm4gZmFsc2U7
CisgICAgICAgIGJyZWFrOworI2VuZGlmCisjaWYgSlNfSEFTX1hNTF9TVVBQT1JUCisgICAgICBj
YXNlIFRPS19VTkFSWU9QOgorICAgICAgICBpZiAoanNfRW1pdDEoY3gsIGNnLCBKU09QX1NFVFhN
TE5BTUUpIDwgMCkKKyAgICAgICAgICAgIHJldHVybiBmYWxzZTsKKyAgICAgICAgYnJlYWs7Cisj
ZW5kaWYKKyAgICAgIGRlZmF1bHQ6CisgICAgICAgIEpTX0FTU0VSVCgwKTsKKyAgICB9CisgICAg
cmV0dXJuIHRydWU7Cit9CisKICNpZiBkZWZpbmVkIERFQlVHX2JyZW5kYW4gfHwgZGVmaW5lZCBE
RUJVR19tcmJrYXAKIHN0YXRpYyBKU0Jvb2wKIEdldHRhYmxlTm90ZUZvck5leHRPcChKU0NvZGVH
ZW5lcmF0b3IgKmNnKQogewogICAgIHB0cmRpZmZfdCBvZmZzZXQsIHRhcmdldDsKICAgICBqc3Ny
Y25vdGUgKnNuLCAqZW5kOwogCiAgICAgb2Zmc2V0ID0gMDsKQEAgLTQ5MzYsMTcgKzUxMzAsMTcg
QEAganNfRW1pdFRyZWUoSlNDb250ZXh0ICpjeCwgSlNDb2RlR2VuZXJhdAogICAgICAgICBwbjIg
PSBwbi0+cG5fbGVmdDsKICAgICAgICAganNfUHVzaFN0YXRlbWVudChjZywgJnN0bXRJbmZvLCBT
VE1UX0ZPUl9MT09QLCB0b3ApOwogCiAgICAgICAgIGlmIChwbjItPnBuX3R5cGUgPT0gVE9LX0lO
KSB7CiAgICAgICAgICAgICAvKiBTZXQgc3RtdEluZm8gdHlwZSBmb3IgbGF0ZXIgdGVzdGluZy4g
Ki8KICAgICAgICAgICAgIHN0bXRJbmZvLnR5cGUgPSBTVE1UX0ZPUl9JTl9MT09QOwogCiAgICAg
ICAgICAgICAvKgotICAgICAgICAgICAgICogSWYgdGhlIGxlZnQgcGFydCBpcyAndmFyIHgnLCBl
bWl0IGNvZGUgdG8gZGVmaW5lIHggaWYgbmVjZXNzYXJ5CisgICAgICAgICAgICAgKiA8Pz8/Pklm
IHRoZSBsZWZ0IHBhcnQgaXMgJ3ZhciB4JywgZW1pdCBjb2RlIHRvIGRlZmluZSB4IGlmIG5lY2Vz
c2FyeQogICAgICAgICAgICAgICogdXNpbmcgYSBwcm9sb2cgb3Bjb2RlLCBidXQgZG8gbm90IGVt
aXQgYSBwb3AuICBJZiB0aGUgbGVmdCBwYXJ0CiAgICAgICAgICAgICAgKiBpcyAndmFyIHggPSBp
JywgZW1pdCBwcm9sb2cgY29kZSB0byBkZWZpbmUgeCBpZiBuZWNlc3Nhcnk7IHRoZW4KICAgICAg
ICAgICAgICAqIGVtaXQgY29kZSB0byBldmFsdWF0ZSBpLCBhc3NpZ24gdGhlIHJlc3VsdCB0byB4
LCBhbmQgcG9wIHRoZQogICAgICAgICAgICAgICogcmVzdWx0IG9mZiB0aGUgc3RhY2suCiAgICAg
ICAgICAgICAgKgogICAgICAgICAgICAgICogQWxsIHRoZSBsb2dpYyB0byBkbyB0aGlzIGlzIGlt
cGxlbWVudGVkIGluIHRoZSBvdXRlciBzd2l0Y2gncwogICAgICAgICAgICAgICogVE9LX1ZBUiBj
YXNlLCBjb25kaXRpb25lZCBvbiBwbl94ZmxhZ3MgZmxhZ3Mgc2V0IGJ5IHRoZSBwYXJzZXIuCiAg
ICAgICAgICAgICAgKgpAQCAtNDk1OCwyNyArNTE1MiwyOSBAQCBqc19FbWl0VHJlZShKU0NvbnRl
eHQgKmN4LCBKU0NvZGVHZW5lcmF0CiAgICAgICAgICAgICAgKiBJbiB0aGUgJ2ZvciAodmFyIHgg
aW4gbykgLi4uJyBjYXNlLCBub3RoaW5nIGJ1dCB0aGUgcHJvbG9nIG9wCiAgICAgICAgICAgICAg
KiAoaWYgbmVlZGVkKSBzaG91bGQgYmUgZ2VuZXJhdGVkIGhlcmUsIHdlIG11c3QgZW1pdCB0aGUg
bm90ZQogICAgICAgICAgICAgICoganVzdCBiZWZvcmUgdGhlIEpTT1BfRk9SKiBvcGNvZGUgaW4g
dGhlIHN3aXRjaCBvbiBwbjMtPnBuX3R5cGUKICAgICAgICAgICAgICAqIGEgYml0IGJlbG93LCBz
byBub3RoaW5nIGlzIGhvaXN0ZWQ6ICdmb3IgKHZhciB4IGluIG8pIC4uLicuCiAgICAgICAgICAg
ICAgKgogICAgICAgICAgICAgICogQSAnZm9yIChsZXQgeCA9IGkgaW4gbyknIGxvb3AgbXVzdCBu
b3QgYmUgaG9pc3RlZCwgc2luY2UgaW4KICAgICAgICAgICAgICAqIHRoaXMgZm9ybSB0aGUgbGV0
IHZhcmlhYmxlIGlzIHNjb3BlZCBieSB0aGUgbG9vcCBib2R5IChidXQgbm90CiAgICAgICAgICAg
ICAgKiB0aGUgaGVhZCkuICBUaGUgaW5pdGlhbGl6ZXIgZXhwcmVzc2lvbiBpIG11c3QgYmUgZXZh
bHVhdGVkIGZvcgotICAgICAgICAgICAgICogYW55IHNpZGUgZWZmZWN0cy4gIFNvIHdlIGhvaXN0
IG9ubHkgaSBpbiB0aGUgbGV0IGNhc2UuCisgICAgICAgICAgICAgKiBhbnkgc2lkZSBlZmZlY3Rz
LiAgU28gd2UgaG9pc3Qgb25seSBpIGluIHRoZSBsZXQgY2FzZS48Lz8/Pz4KICAgICAgICAgICAg
ICAqLwotICAgICAgICAgICAgcG4zID0gcG4yLT5wbl9sZWZ0OwotICAgICAgICAgICAgdHlwZSA9
IFBOX1RZUEUocG4zKTsKLSAgICAgICAgICAgIGNnLT5mbGFncyB8PSBUQ0ZfSU5fRk9SX0lOSVQ7
Ci0gICAgICAgICAgICBpZiAoVG9rZW5LaW5kSXNEZWNsKHR5cGUpICYmICFqc19FbWl0VHJlZShj
eCwgY2csIHBuMykpCi0gICAgICAgICAgICAgICAgcmV0dXJuIEpTX0ZBTFNFOwotICAgICAgICAg
ICAgY2ctPmZsYWdzICY9IH5UQ0ZfSU5fRk9SX0lOSVQ7CisgICAgICAgICAgICBpZiAoSlNQYXJz
ZU5vZGUgKmRlY2wgPSBwbjItPnBuX2tpZDEpIHsKKyAgICAgICAgICAgICAgICB0eXBlID0gUE5f
VFlQRShkZWNsKTsKKyAgICAgICAgICAgICAgICBKU19BU1NFUlQoVG9rZW5LaW5kSXNEZWNsKHR5
cGUpKTsKKyAgICAgICAgICAgICAgICBjZy0+ZmxhZ3MgfD0gVENGX0lOX0ZPUl9JTklUOworICAg
ICAgICAgICAgICAgIGlmIChUb2tlbktpbmRJc0RlY2wodHlwZSkgJiYgIWpzX0VtaXRUcmVlKGN4
LCBjZywgZGVjbCkpCisgICAgICAgICAgICAgICAgICAgIHJldHVybiBKU19GQUxTRTsKKyAgICAg
ICAgICAgICAgICBjZy0+ZmxhZ3MgJj0gflRDRl9JTl9GT1JfSU5JVDsKKyAgICAgICAgICAgIH0K
IAogICAgICAgICAgICAgLyogQ29tcGlsZSB0aGUgb2JqZWN0IGV4cHJlc3Npb24gdG8gdGhlIHJp
Z2h0IG9mICdpbicuICovCi0gICAgICAgICAgICBpZiAoIWpzX0VtaXRUcmVlKGN4LCBjZywgcG4y
LT5wbl9yaWdodCkpCisgICAgICAgICAgICBpZiAoIWpzX0VtaXRUcmVlKGN4LCBjZywgcG4yLT5w
bl9raWQzKSkKICAgICAgICAgICAgICAgICByZXR1cm4gSlNfRkFMU0U7CiAKICAgICAgICAgICAg
IC8qCiAgICAgICAgICAgICAgKiBFbWl0IGEgYnl0ZWNvZGUgdG8gY29udmVydCB0b3Agb2Ygc3Rh
Y2sgdmFsdWUgdG8gdGhlIGl0ZXJhdG9yCiAgICAgICAgICAgICAgKiBvYmplY3QgZGVwZW5kaW5n
IG9uIHRoZSBsb29wIHZhcmlhbnQgKGZvci1pbiwgZm9yLWVhY2gtaW4sIG9yCiAgICAgICAgICAg
ICAgKiBkZXN0cnVjdHVyaW5nIGZvci1pbikuCiAgICAgICAgICAgICAgKi8KICAgICAgICAgICAg
IEpTX0FTU0VSVChwbi0+cG5fb3AgPT0gSlNPUF9JVEVSKTsKQEAgLTUwMDcsMTYyICs1MjAzLDMz
IEBAIGpzX0VtaXRUcmVlKEpTQ29udGV4dCAqY3gsIEpTQ29kZUdlbmVyYXQKICAgICAgICAgICAg
IGlmIChFbWl0VHJhY2VPcChjeCwgY2cpIDwgMCkKICAgICAgICAgICAgICAgICByZXR1cm4gSlNf
RkFMU0U7CiAKICNpZmRlZiBERUJVRwogICAgICAgICAgICAgaW50TiBsb29wRGVwdGggPSBjZy0+
c3RhY2tEZXB0aDsKICNlbmRpZgogCiAgICAgICAgICAgICAvKgotICAgICAgICAgICAgICogQ29t
cGlsZSBhIEpTT1BfRk9SKiBieXRlY29kZSBiYXNlZCBvbiB0aGUgbGVmdCBoYW5kIHNpZGUuCisg
ICAgICAgICAgICAgKiBFbWl0IGNvZGUgdG8gZ2V0IHRoZSBuZXh0IGVudW1lcmF0aW9uIHZhbHVl
IGFuZCBhc3NpZ24gaXQgdG8gdGhlCisgICAgICAgICAgICAgKiBsZWZ0IGhhbmQgc2lkZS4KICAg
ICAgICAgICAgICAqCi0gICAgICAgICAgICAgKiBJbml0aWFsaXplIG9wIHRvIEpTT1BfU0VUTkFN
RSBpbiBjYXNlIG9mIHxmb3IgKFthLCBiXSBpbiBvKS4uLnwKKyAgICAgICAgICAgICAqIDw/Pz8+
SW5pdGlhbGl6ZSBvcCB0byBKU09QX1NFVE5BTUUgaW4gY2FzZSBvZiB8Zm9yIChbYSwgYl0gaW4g
bykuLi58CiAgICAgICAgICAgICAgKiBvciBzaW1pbGFyLCB0byBzaWduaWZ5IGFzc2lnbm1lbnQs
IHJhdGhlciB0aGFuIGRlY2xhcmF0aW9uLCB0bwogICAgICAgICAgICAgICogdGhlIGRlY29tcGls
ZXIuICBFbWl0RGVzdHJ1Y3R1cmluZ09wcyB0YWtlcyBhIHByb2xvZyBieXRlY29kZQogICAgICAg
ICAgICAgICogcGFyYW1ldGVyIGFuZCBlbWl0cyB0aGUgYXBwcm9wcmlhdGUgc291cmNlIG5vdGUs
IGRlZmF1bHRpbmcgdG8KICAgICAgICAgICAgICAqIGFzc2lnbm1lbnQsIHNvIEpTT1BfU0VUTkFN
RSBpcyBub3QgY3JpdGljYWwgaGVyZTsgbWFueSBzaW1pbGFyCi0gICAgICAgICAgICAgKiBvcHMg
Y291bGQgYmUgdXNlZCAtLSBqdXN0IG5vdCBKU09QX05PUCAod2hpY2ggbWVhbnMgJ2xldCcpLgor
ICAgICAgICAgICAgICogb3BzIGNvdWxkIGJlIHVzZWQgLS0ganVzdCBub3QgSlNPUF9OT1AgKHdo
aWNoIG1lYW5zICdsZXQnKS48Lz8/Pz4KICAgICAgICAgICAgICAqLwotICAgICAgICAgICAgb3Ag
PSBKU09QX1NFVE5BTUU7Ci0gICAgICAgICAgICBzd2l0Y2ggKHR5cGUpIHsKLSNpZiBKU19IQVNf
QkxPQ0tfU0NPUEUKLSAgICAgICAgICAgICAgY2FzZSBUT0tfTEVUOgotI2VuZGlmCi0gICAgICAg
ICAgICAgIGNhc2UgVE9LX1ZBUjoKLSAgICAgICAgICAgICAgICBKU19BU1NFUlQocG4zLT5wbl9h
cml0eSA9PSBQTl9MSVNUICYmIHBuMy0+cG5fY291bnQgPT0gMSk7Ci0gICAgICAgICAgICAgICAg
cG4zID0gcG4zLT5wbl9oZWFkOwotI2lmIEpTX0hBU19ERVNUUlVDVFVSSU5HCi0gICAgICAgICAg
ICAgICAgaWYgKHBuMy0+cG5fdHlwZSA9PSBUT0tfQVNTSUdOKSB7Ci0gICAgICAgICAgICAgICAg
ICAgIHBuMyA9IHBuMy0+cG5fbGVmdDsKLSAgICAgICAgICAgICAgICAgICAgSlNfQVNTRVJUKHBu
My0+cG5fdHlwZSA9PSBUT0tfUkIgfHwgcG4zLT5wbl90eXBlID09IFRPS19SQyk7Ci0gICAgICAg
ICAgICAgICAgfQotICAgICAgICAgICAgICAgIGlmIChwbjMtPnBuX3R5cGUgPT0gVE9LX1JCIHx8
IHBuMy0+cG5fdHlwZSA9PSBUT0tfUkMpIHsKLSAgICAgICAgICAgICAgICAgICAgb3AgPSBQTl9P
UChwbjItPnBuX2xlZnQpOwotICAgICAgICAgICAgICAgICAgICBnb3RvIGRlc3RydWN0dXJpbmdf
Zm9yOwotICAgICAgICAgICAgICAgIH0KLSNlbHNlCi0gICAgICAgICAgICAgICAgSlNfQVNTRVJU
KHBuMy0+cG5fdHlwZSA9PSBUT0tfTkFNRSk7Ci0jZW5kaWYKLSAgICAgICAgICAgICAgICAvKiBG
QUxMIFRIUk9VR0ggKi8KLQotICAgICAgICAgICAgICBjYXNlIFRPS19OQU1FOgotICAgICAgICAg
ICAgICB7Ci0gICAgICAgICAgICAgICAgLyoKLSAgICAgICAgICAgICAgICAgKiBBbHdheXMgYW5u
b3RhdGUgSlNPUF9GT1JMT0NBTCBpZiBnaXZlbiBpbnB1dCBvZiB0aGUgZm9ybQotICAgICAgICAg
ICAgICAgICAqICdmb3IgKGxldCB4IGluICogbyknIC0tIHRoZSBkZWNvbXBpbGVyIG11c3Qgbm90
IGhvaXN0IHRoZQotICAgICAgICAgICAgICAgICAqICdsZXQgeCcgb3V0IG9mIHRoZSBsb29wIGhl
YWQsIG9yIHggd2lsbCBiZSBib3VuZCBpbiB0aGUKLSAgICAgICAgICAgICAgICAgKiB3cm9uZyBz
Y29wZS4gIExpa2V3aXNlLCBidXQgaW4gdGhpcyBjYXNlIG9ubHkgZm9yIHRoZSBzYWtlCi0gICAg
ICAgICAgICAgICAgICogb2YgaGlnaGVyIGRlY29tcGlsYXRpb24gZmlkZWxpdHkgb25seSwgZG8g
bm90IGhvaXN0ICd2YXIgeCcKLSAgICAgICAgICAgICAgICAgKiB3aGVuIGdpdmVuICdmb3IgKHZh
ciB4IGluIG8pJy4KLSAgICAgICAgICAgICAgICAgKi8KLSAgICAgICAgICAgICAgICBpZiAoKAot
I2lmIEpTX0hBU19CTE9DS19TQ09QRQotICAgICAgICAgICAgICAgICAgICAgdHlwZSA9PSBUT0tf
TEVUIHx8Ci0jZW5kaWYKLSAgICAgICAgICAgICAgICAgICAgICh0eXBlID09IFRPS19WQVIgJiYg
IXBuMy0+bWF5YmVFeHByKCkpKSAmJgotICAgICAgICAgICAgICAgICAgICBqc19OZXdTcmNOb3Rl
MihjeCwgY2csIFNSQ19ERUNMLAotICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAo
dHlwZSA9PSBUT0tfVkFSKQotICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA/IFNS
Q19ERUNMX1ZBUgotICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA6IFNSQ19ERUNM
X0xFVCkgPCAwKSB7Ci0gICAgICAgICAgICAgICAgICAgIHJldHVybiBKU19GQUxTRTsKLSAgICAg
ICAgICAgICAgICB9Ci0gICAgICAgICAgICAgICAgVXB2YXJDb29raWUgY29va2llID0gcG4zLT5w
bl9jb29raWU7Ci0gICAgICAgICAgICAgICAgaWYgKCFjb29raWUuaXNGcmVlKCkpIHsKLSAgICAg
ICAgICAgICAgICAgICAgb3AgPSBQTl9PUChwbjMpOwotICAgICAgICAgICAgICAgICAgICBzd2l0
Y2ggKG9wKSB7Ci0gICAgICAgICAgICAgICAgICAgICAgY2FzZSBKU09QX0dFVEFSRzoKLSAgICAg
ICAgICAgICAgICAgICAgICBjYXNlIEpTT1BfU0VUQVJHOgotICAgICAgICAgICAgICAgICAgICAg
ICAgb3AgPSBKU09QX0ZPUkFSRzsKLSAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwotICAg
ICAgICAgICAgICAgICAgICAgIGNhc2UgSlNPUF9HRVRMT0NBTDoKLSAgICAgICAgICAgICAgICAg
ICAgICBjYXNlIEpTT1BfU0VUTE9DQUw6Ci0gICAgICAgICAgICAgICAgICAgICAgICBvcCA9IEpT
T1BfRk9STE9DQUw7Ci0gICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKLSAgICAgICAgICAg
ICAgICAgICAgICBjYXNlIEpTT1BfR0VUR0xPQkFMOgotICAgICAgICAgICAgICAgICAgICAgICAg
b3AgPSBKU09QX0ZPUkdOQU1FOwotICAgICAgICAgICAgICAgICAgICAgICAgY29va2llLm1ha2VG
cmVlKCk7Ci0gICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKLSAgICAgICAgICAgICAgICAg
ICAgICBkZWZhdWx0OgotICAgICAgICAgICAgICAgICAgICAgICAgSlNfTk9UX1JFQUNIRUQoInVu
ZXhwZWN0ZWQgb3Bjb2RlIik7Ci0gICAgICAgICAgICAgICAgICAgIH0KLSAgICAgICAgICAgICAg
ICB9IGVsc2UgewotICAgICAgICAgICAgICAgICAgICBwbjMtPnBuX29wID0gSlNPUF9GT1JOQU1F
OwotICAgICAgICAgICAgICAgICAgICBpZiAoIUJpbmROYW1lVG9TbG90KGN4LCBjZywgcG4zKSkK
LSAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBKU19GQUxTRTsKLSAgICAgICAgICAgICAg
ICAgICAgb3AgPSBQTl9PUChwbjMpOwotICAgICAgICAgICAgICAgICAgICBjb29raWUgPSBwbjMt
PnBuX2Nvb2tpZTsKLSAgICAgICAgICAgICAgICB9Ci0gICAgICAgICAgICAgICAgaWYgKHBuMy0+
aXNDb25zdCgpKSB7Ci0gICAgICAgICAgICAgICAgICAgIFJlcG9ydENvbXBpbGVFcnJvck51bWJl
cihjeCwgQ0dfVFMoY2cpLCBwbjMsIEpTUkVQT1JUX0VSUk9SLAotICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgSlNNU0dfQkFEX0ZPUl9MRUZUU0lERSk7Ci0gICAg
ICAgICAgICAgICAgICAgIHJldHVybiBKU19GQUxTRTsKLSAgICAgICAgICAgICAgICB9Ci0gICAg
ICAgICAgICAgICAgaWYgKCFjb29raWUuaXNGcmVlKCkpIHsKLSAgICAgICAgICAgICAgICAgICAg
YXRvbUluZGV4ID0gKGpzYXRvbWlkKSBjb29raWUuYXNJbnRlZ2VyKCk7Ci0gICAgICAgICAgICAg
ICAgICAgIEVNSVRfVUlOVDE2X0lNTV9PUChvcCwgYXRvbUluZGV4KTsKLSAgICAgICAgICAgICAg
ICB9IGVsc2UgewotICAgICAgICAgICAgICAgICAgICBpZiAoIUVtaXRBdG9tT3AoY3gsIHBuMywg
b3AsIGNnKSkKLSAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBKU19GQUxTRTsKLSAgICAg
ICAgICAgICAgICB9Ci0gICAgICAgICAgICAgICAgYnJlYWs7Ci0gICAgICAgICAgICAgIH0KLQot
ICAgICAgICAgICAgICBjYXNlIFRPS19ET1Q6Ci0gICAgICAgICAgICAgICAgLyoKLSAgICAgICAg
ICAgICAgICAgKiAnZm9yIChvLnAgaW4gcSknIGNhbiB1c2UgSlNPUF9GT1JQUk9QIG9ubHkgaWYg
ZXZhbHVhdGluZyAnbycKLSAgICAgICAgICAgICAgICAgKiBoYXMgbm8gc2lkZSBlZmZlY3RzLgot
ICAgICAgICAgICAgICAgICAqLwotICAgICAgICAgICAgICAgIHVzZWZ1bCA9IEpTX0ZBTFNFOwot
ICAgICAgICAgICAgICAgIGlmICghQ2hlY2tTaWRlRWZmZWN0cyhjeCwgY2csIHBuMy0+ZXhwcigp
LCAmdXNlZnVsKSkKLSAgICAgICAgICAgICAgICAgICAgcmV0dXJuIEpTX0ZBTFNFOwotICAgICAg
ICAgICAgICAgIGlmICghdXNlZnVsKSB7Ci0gICAgICAgICAgICAgICAgICAgIGlmICghRW1pdFBy
b3BPcChjeCwgcG4zLCBKU09QX0ZPUlBST1AsIGNnLCBKU19GQUxTRSkpCi0gICAgICAgICAgICAg
ICAgICAgICAgICByZXR1cm4gSlNfRkFMU0U7Ci0gICAgICAgICAgICAgICAgICAgIGJyZWFrOwot
ICAgICAgICAgICAgICAgIH0KLSAgICAgICAgICAgICAgICAvKiBGQUxMIFRIUk9VR0ggKi8KLQot
I2lmIEpTX0hBU19ERVNUUlVDVFVSSU5HCi0gICAgICAgICAgICAgIGRlc3RydWN0dXJpbmdfZm9y
OgotI2VuZGlmCi0gICAgICAgICAgICAgIGRlZmF1bHQ6Ci0gICAgICAgICAgICAgICAgaWYgKGpz
X0VtaXQxKGN4LCBjZywgSlNPUF9GT1JFTEVNKSA8IDApCi0gICAgICAgICAgICAgICAgICAgIHJl
dHVybiBKU19GQUxTRTsKLSAgICAgICAgICAgICAgICBKU19BU1NFUlQoY2ctPnN0YWNrRGVwdGgg
Pj0gMik7Ci0KLSNpZiBKU19IQVNfREVTVFJVQ1RVUklORwotICAgICAgICAgICAgICAgIGlmIChw
bjMtPnBuX3R5cGUgPT0gVE9LX1JCIHx8IHBuMy0+cG5fdHlwZSA9PSBUT0tfUkMpIHsKLSAgICAg
ICAgICAgICAgICAgICAgaWYgKCFFbWl0RGVzdHJ1Y3R1cmluZ09wcyhjeCwgY2csIG9wLCBwbjMp
KQotICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIEpTX0ZBTFNFOwotICAgICAgICAgICAg
ICAgICAgICBpZiAoanNfRW1pdDEoY3gsIGNnLCBKU09QX1BPUCkgPCAwKQotICAgICAgICAgICAg
ICAgICAgICAgICAgcmV0dXJuIEpTX0ZBTFNFOwotICAgICAgICAgICAgICAgIH0gZWxzZQotI2Vu
ZGlmCi0gICAgICAgICAgICAgICAgaWYgKHBuMy0+cG5fdHlwZSA9PSBUT0tfTFApIHsKLSAgICAg
ICAgICAgICAgICAgICAgSlNfQVNTRVJUKHBuMy0+cG5feGZsYWdzICYgUE5YX1NFVENBTEwpOwot
ICAgICAgICAgICAgICAgICAgICBpZiAoIWpzX0VtaXRUcmVlKGN4LCBjZywgcG4zKSkKLSAgICAg
ICAgICAgICAgICAgICAgICAgIHJldHVybiBKU19GQUxTRTsKLSAgICAgICAgICAgICAgICAgICAg
aWYgKGpzX0VtaXQxKGN4LCBjZywgSlNPUF9FTlVNRUxFTSkgPCAwKQotICAgICAgICAgICAgICAg
ICAgICAgICAgcmV0dXJuIEpTX0ZBTFNFOwotICAgICAgICAgICAgICAgIH0gZWxzZQotI2lmIEpT
X0hBU19YTUxfU1VQUE9SVAotICAgICAgICAgICAgICAgIGlmIChwbjMtPnBuX3R5cGUgPT0gVE9L
X1VOQVJZT1ApIHsKLSAgICAgICAgICAgICAgICAgICAgSlNfQVNTRVJUKHBuMy0+cG5fb3AgPT0g
SlNPUF9CSU5EWE1MTkFNRSk7Ci0gICAgICAgICAgICAgICAgICAgIGlmICghanNfRW1pdFRyZWUo
Y3gsIGNnLCBwbjMpKQotICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIEpTX0ZBTFNFOwot
ICAgICAgICAgICAgICAgICAgICBpZiAoanNfRW1pdDEoY3gsIGNnLCBKU09QX0VOVU1FTEVNKSA8
IDApCi0gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gSlNfRkFMU0U7Ci0gICAgICAgICAg
ICAgICAgfSBlbHNlCi0jZW5kaWYKLSAgICAgICAgICAgICAgICBpZiAoIUVtaXRFbGVtT3AoY3gs
IHBuMywgSlNPUF9FTlVNRUxFTSwgY2cpKQotICAgICAgICAgICAgICAgICAgICByZXR1cm4gSlNf
RkFMU0U7Ci0gICAgICAgICAgICAgICAgYnJlYWs7CisgICAgICAgICAgICBpZiAoIUVtaXRBc3Np
Z25tZW50KGN4LCBjZywgcG4yLT5wbl9raWQyLCBKU09QX05PUCwgTlVMTCkgfHwKKyAgICAgICAg
ICAgICAgICBqc19FbWl0MShjeCwgY2csIEpTT1BfUE9QKSA8IDApCisgICAgICAgICAgICB7Cisg
ICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgICAgICAgfQogCi0gICAgICAgICAg
ICAvKiBUaGUgc3RhY2sgc2hvdWxkIGJlIGJhbGFuY2VkIGFyb3VuZCB0aGUgSlNPUF9GT1IqIG9w
Y29kZSBzZXF1ZW5jZS4gKi8KKyAgICAgICAgICAgIC8qIFRoZSBzdGFjayBzaG91bGQgYmUgYmFs
YW5jZWQgYXJvdW5kIHRoZSBhc3NpZ25tZW50IG9wY29kZSBzZXF1ZW5jZS4gKi8KICAgICAgICAg
ICAgIEpTX0FTU0VSVChjZy0+c3RhY2tEZXB0aCA9PSBsb29wRGVwdGgpOwogCiAgICAgICAgICAg
ICB0bXAyID0gQ0dfT0ZGU0VUKGNnKTsKIAogICAgICAgICAgICAgLyogRW1pdCBjb2RlIGZvciB0
aGUgbG9vcCBib2R5LiAqLwogICAgICAgICAgICAgaWYgKCFqc19FbWl0VHJlZShjeCwgY2csIHBu
LT5wbl9yaWdodCkpCiAgICAgICAgICAgICAgICAgcmV0dXJuIEpTX0ZBTFNFOwogCkBAIC02MDUz
LDE5NCArNjEyMCwxOCBAQCBqc19FbWl0VHJlZShKU0NvbnRleHQgKmN4LCBKU0NvZGVHZW5lcmF0
CiAgICAgICAgICAgICBpZiAobm90ZUluZGV4IDwgMCB8fAogICAgICAgICAgICAgICAgIGpzX0Vt
aXQxKGN4LCBjZywgSlNPUF9QT1ApIDwgMCkgewogICAgICAgICAgICAgICAgIHJldHVybiBKU19G
QUxTRTsKICAgICAgICAgICAgIH0KICAgICAgICAgfQogICAgICAgICBicmVhazsKIAogICAgICAg
Y2FzZSBUT0tfQVNTSUdOOgotICAgICAgICAvKgotICAgICAgICAgKiBDaGVjayBsZWZ0IG9wZXJh
bmQgdHlwZSBhbmQgZ2VuZXJhdGUgc3BlY2lhbGl6ZWQgY29kZSBmb3IgaXQuCi0gICAgICAgICAq
IFNwZWNpYWxpemUgdG8gYXZvaWQgRUNNQSAicmVmZXJlbmNlIHR5cGUiIHZhbHVlcyBvbiB0aGUg
b3BlcmFuZAotICAgICAgICAgKiBzdGFjaywgd2hpY2ggaW1wb3NlIHBlcnZhc2l2ZSBydW50aW1l
ICJHZXRWYWx1ZSIgY29zdHMuCi0gICAgICAgICAqLwotICAgICAgICBwbjIgPSBwbi0+cG5fbGVm
dDsKLSAgICAgICAgYXRvbUluZGV4ID0gKGpzYXRvbWlkKSAtMTsgICAgICAgICAgICAgIC8qIHF1
ZWxsIEdDQyBvdmVyd2FybmluZyAqLwotICAgICAgICBzd2l0Y2ggKFBOX1RZUEUocG4yKSkgewot
ICAgICAgICAgIGNhc2UgVE9LX05BTUU6Ci0gICAgICAgICAgICBpZiAoIUJpbmROYW1lVG9TbG90
KGN4LCBjZywgcG4yKSkKLSAgICAgICAgICAgICAgICByZXR1cm4gSlNfRkFMU0U7Ci0gICAgICAg
ICAgICBpZiAoIXBuMi0+cG5fY29va2llLmlzRnJlZSgpKSB7Ci0gICAgICAgICAgICAgICAgYXRv
bUluZGV4ID0gKGpzYXRvbWlkKSBwbjItPnBuX2Nvb2tpZS5hc0ludGVnZXIoKTsKLSAgICAgICAg
ICAgIH0gZWxzZSB7Ci0gICAgICAgICAgICAgICAgYWxlID0gY2ctPmF0b21MaXN0LmFkZChjZy0+
cGFyc2VyLCBwbjItPnBuX2F0b20pOwotICAgICAgICAgICAgICAgIGlmICghYWxlKQotICAgICAg
ICAgICAgICAgICAgICByZXR1cm4gSlNfRkFMU0U7Ci0gICAgICAgICAgICAgICAgYXRvbUluZGV4
ID0gQUxFX0lOREVYKGFsZSk7Ci0gICAgICAgICAgICAgICAgaWYgKCFwbjItPmlzQ29uc3QoKSkg
ewotICAgICAgICAgICAgICAgICAgICBKU09wIG9wID0gUE5fT1AocG4yKSA9PSBKU09QX1NFVEdO
QU1FID8gSlNPUF9CSU5ER05BTUUgOiBKU09QX0JJTkROQU1FOwotICAgICAgICAgICAgICAgICAg
ICBFTUlUX0lOREVYX09QKG9wLCBhdG9tSW5kZXgpOwotICAgICAgICAgICAgICAgIH0KLSAgICAg
ICAgICAgIH0KLSAgICAgICAgICAgIGJyZWFrOwotICAgICAgICAgIGNhc2UgVE9LX0RPVDoKLSAg
ICAgICAgICAgIGlmICghanNfRW1pdFRyZWUoY3gsIGNnLCBwbjItPmV4cHIoKSkpCi0gICAgICAg
ICAgICAgICAgcmV0dXJuIEpTX0ZBTFNFOwotICAgICAgICAgICAgYWxlID0gY2ctPmF0b21MaXN0
LmFkZChjZy0+cGFyc2VyLCBwbjItPnBuX2F0b20pOwotICAgICAgICAgICAgaWYgKCFhbGUpCi0g
ICAgICAgICAgICAgICAgcmV0dXJuIEpTX0ZBTFNFOwotICAgICAgICAgICAgYXRvbUluZGV4ID0g
QUxFX0lOREVYKGFsZSk7Ci0gICAgICAgICAgICBicmVhazsKLSAgICAgICAgICBjYXNlIFRPS19M
QjoKLSAgICAgICAgICAgIEpTX0FTU0VSVChwbjItPnBuX2FyaXR5ID09IFBOX0JJTkFSWSk7Ci0g
ICAgICAgICAgICBpZiAoIWpzX0VtaXRUcmVlKGN4LCBjZywgcG4yLT5wbl9sZWZ0KSkKLSAgICAg
ICAgICAgICAgICByZXR1cm4gSlNfRkFMU0U7Ci0gICAgICAgICAgICBpZiAoIWpzX0VtaXRUcmVl
KGN4LCBjZywgcG4yLT5wbl9yaWdodCkpCi0gICAgICAgICAgICAgICAgcmV0dXJuIEpTX0ZBTFNF
OwotICAgICAgICAgICAgYnJlYWs7Ci0jaWYgSlNfSEFTX0RFU1RSVUNUVVJJTkcKLSAgICAgICAg
ICBjYXNlIFRPS19SQjoKLSAgICAgICAgICBjYXNlIFRPS19SQzoKLSAgICAgICAgICAgIGJyZWFr
OwotI2VuZGlmCi0gICAgICAgICAgY2FzZSBUT0tfTFA6Ci0gICAgICAgICAgICBpZiAoIWpzX0Vt
aXRUcmVlKGN4LCBjZywgcG4yKSkKLSAgICAgICAgICAgICAgICByZXR1cm4gSlNfRkFMU0U7Ci0g
ICAgICAgICAgICBicmVhazsKLSNpZiBKU19IQVNfWE1MX1NVUFBPUlQKLSAgICAgICAgICBjYXNl
IFRPS19VTkFSWU9QOgotICAgICAgICAgICAgSlNfQVNTRVJUKHBuMi0+cG5fb3AgPT0gSlNPUF9T
RVRYTUxOQU1FKTsKLSAgICAgICAgICAgIGlmICghanNfRW1pdFRyZWUoY3gsIGNnLCBwbjItPnBu
X2tpZCkpCi0gICAgICAgICAgICAgICAgcmV0dXJuIEpTX0ZBTFNFOwotICAgICAgICAgICAgaWYg
KGpzX0VtaXQxKGN4LCBjZywgSlNPUF9CSU5EWE1MTkFNRSkgPCAwKQotICAgICAgICAgICAgICAg
IHJldHVybiBKU19GQUxTRTsKLSAgICAgICAgICAgIGJyZWFrOwotI2VuZGlmCi0gICAgICAgICAg
ZGVmYXVsdDoKLSAgICAgICAgICAgIEpTX0FTU0VSVCgwKTsKLSAgICAgICAgfQotCi0gICAgICAg
IG9wID0gUE5fT1AocG4pOwotICAgICAgICBpZiAob3AgIT0gSlNPUF9OT1ApIHsKLSAgICAgICAg
ICAgIHN3aXRjaCAocG4yLT5wbl90eXBlKSB7Ci0gICAgICAgICAgICAgIGNhc2UgVE9LX05BTUU6
Ci0gICAgICAgICAgICAgICAgaWYgKHBuMi0+aXNDb25zdCgpKSB7Ci0gICAgICAgICAgICAgICAg
ICAgIGlmIChQTl9PUChwbjIpID09IEpTT1BfQ0FMTEVFKSB7Ci0gICAgICAgICAgICAgICAgICAg
ICAgICBpZiAoanNfRW1pdDEoY3gsIGNnLCBKU09QX0NBTExFRSkgPCAwKQotICAgICAgICAgICAg
ICAgICAgICAgICAgICAgIHJldHVybiBKU19GQUxTRTsKLSAgICAgICAgICAgICAgICAgICAgfSBl
bHNlIHsKLSAgICAgICAgICAgICAgICAgICAgICAgIEVNSVRfSU5ERVhfT1AoUE5fT1AocG4yKSwg
YXRvbUluZGV4KTsKLSAgICAgICAgICAgICAgICAgICAgfQotICAgICAgICAgICAgICAgIH0gZWxz
ZSBpZiAoUE5fT1AocG4yKSA9PSBKU09QX1NFVE5BTUUpIHsKLSAgICAgICAgICAgICAgICAgICAg
aWYgKGpzX0VtaXQxKGN4LCBjZywgSlNPUF9EVVApIDwgMCkKLSAgICAgICAgICAgICAgICAgICAg
ICAgIHJldHVybiBKU19GQUxTRTsKLSAgICAgICAgICAgICAgICAgICAgRU1JVF9JTkRFWF9PUChK
U09QX0dFVFhQUk9QLCBhdG9tSW5kZXgpOwotICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAoUE5f
T1AocG4yKSA9PSBKU09QX1NFVEdOQU1FKSB7Ci0gICAgICAgICAgICAgICAgICAgIGlmICghQmlu
ZEdsb2JhbChjeCwgY2csIHBuMiwgcG4yLT5wbl9hdG9tKSkKLSAgICAgICAgICAgICAgICAgICAg
ICAgIHJldHVybiBKU19GQUxTRTsKLSAgICAgICAgICAgICAgICAgICAgaWYgKHBuMi0+cG5fY29v
a2llLmlzRnJlZSgpKQotICAgICAgICAgICAgICAgICAgICAgICAgRW1pdEF0b21PcChjeCwgcG4y
LCBKU09QX0dFVEdOQU1FLCBjZyk7Ci0gICAgICAgICAgICAgICAgICAgIGVsc2UKLSAgICAgICAg
ICAgICAgICAgICAgICAgIEVNSVRfVUlOVDE2X0lNTV9PUChKU09QX0dFVEdMT0JBTCwgcG4yLT5w
bl9jb29raWUuYXNJbnRlZ2VyKCkpOwotICAgICAgICAgICAgICAgIH0gZWxzZSB7Ci0gICAgICAg
ICAgICAgICAgICAgIEVNSVRfVUlOVDE2X0lNTV9PUCgoUE5fT1AocG4yKSA9PSBKU09QX1NFVEFS
RykKLSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgID8gSlNPUF9HRVRBUkcK
LSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDogSlNPUF9HRVRMT0NBTCwK
LSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGF0b21JbmRleCk7Ci0gICAg
ICAgICAgICAgICAgfQotICAgICAgICAgICAgICAgIGJyZWFrOwotICAgICAgICAgICAgICBjYXNl
IFRPS19ET1Q6Ci0gICAgICAgICAgICAgICAgaWYgKGpzX0VtaXQxKGN4LCBjZywgSlNPUF9EVVAp
IDwgMCkKLSAgICAgICAgICAgICAgICAgICAgcmV0dXJuIEpTX0ZBTFNFOwotICAgICAgICAgICAg
ICAgIGlmIChwbjItPnBuX2F0b20gPT0gY3gtPnJ1bnRpbWUtPmF0b21TdGF0ZS5sZW5ndGhBdG9t
KSB7Ci0gICAgICAgICAgICAgICAgICAgIGlmIChqc19FbWl0MShjeCwgY2csIEpTT1BfTEVOR1RI
KSA8IDApCi0gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gSlNfRkFMU0U7Ci0gICAgICAg
ICAgICAgICAgfSBlbHNlIGlmIChwbjItPnBuX2F0b20gPT0gY3gtPnJ1bnRpbWUtPmF0b21TdGF0
ZS5wcm90b0F0b20pIHsKLSAgICAgICAgICAgICAgICAgICAgaWYgKCFFbWl0SW5kZXhPcChjeCwg
SlNPUF9RTkFNRVBBUlQsIGF0b21JbmRleCwgY2cpKQotICAgICAgICAgICAgICAgICAgICAgICAg
cmV0dXJuIEpTX0ZBTFNFOwotICAgICAgICAgICAgICAgICAgICBpZiAoanNfRW1pdDEoY3gsIGNn
LCBKU09QX0dFVEVMRU0pIDwgMCkKLSAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBKU19G
QUxTRTsKLSAgICAgICAgICAgICAgICB9IGVsc2UgewotICAgICAgICAgICAgICAgICAgICBFTUlU
X0lOREVYX09QKEpTT1BfR0VUUFJPUCwgYXRvbUluZGV4KTsKLSAgICAgICAgICAgICAgICB9Ci0g
ICAgICAgICAgICAgICAgYnJlYWs7Ci0gICAgICAgICAgICAgIGNhc2UgVE9LX0xCOgotICAgICAg
ICAgICAgICBjYXNlIFRPS19MUDoKLSNpZiBKU19IQVNfWE1MX1NVUFBPUlQKLSAgICAgICAgICAg
ICAgY2FzZSBUT0tfVU5BUllPUDoKLSNlbmRpZgotICAgICAgICAgICAgICAgIGlmIChqc19FbWl0
MShjeCwgY2csIEpTT1BfRFVQMikgPCAwKQotICAgICAgICAgICAgICAgICAgICByZXR1cm4gSlNf
RkFMU0U7Ci0gICAgICAgICAgICAgICAgaWYgKGpzX0VtaXQxKGN4LCBjZywgSlNPUF9HRVRFTEVN
KSA8IDApCi0gICAgICAgICAgICAgICAgICAgIHJldHVybiBKU19GQUxTRTsKLSAgICAgICAgICAg
ICAgICBicmVhazsKLSAgICAgICAgICAgICAgZGVmYXVsdDo7Ci0gICAgICAgICAgICB9Ci0gICAg
ICAgIH0KLQotICAgICAgICAvKiBOb3cgZW1pdCB0aGUgcmlnaHQgb3BlcmFuZCAoaXQgbWF5IGFm
ZmVjdCB0aGUgbmFtZXNwYWNlKS4gKi8KLSAgICAgICAgaWYgKCFqc19FbWl0VHJlZShjeCwgY2cs
IHBuLT5wbl9yaWdodCkpCi0gICAgICAgICAgICByZXR1cm4gSlNfRkFMU0U7Ci0KLSAgICAgICAg
LyogSWYgKz0gZXRjLiwgZW1pdCB0aGUgYmluYXJ5IG9wZXJhdG9yIHdpdGggYSBkZWNvbXBpbGVy
IG5vdGUuICovCi0gICAgICAgIGlmIChvcCAhPSBKU09QX05PUCkgewotICAgICAgICAgICAgLyoK
LSAgICAgICAgICAgICAqIFRha2UgY2FyZSB0byBhdm9pZCBTUkNfQVNTSUdOT1AgaWYgdGhlIGxl
ZnQtaGFuZCBzaWRlIGlzIGEgY29uc3QKLSAgICAgICAgICAgICAqIGRlY2xhcmVkIGluIHRoZSBj
dXJyZW50IGNvbXBpbGF0aW9uIHVuaXQsIGFzIGluIHRoaXMgY2FzZSAoanVzdAotICAgICAgICAg
ICAgICogYSBiaXQgZnVydGhlciBiZWxvdykgd2Ugd2lsbCBhdm9pZCBlbWl0dGluZyB0aGUgYXNz
aWdubWVudCBvcC4KLSAgICAgICAgICAgICAqLwotICAgICAgICAgICAgaWYgKHBuMi0+cG5fdHlw
ZSAhPSBUT0tfTkFNRSB8fCAhcG4yLT5pc0NvbnN0KCkpIHsKLSAgICAgICAgICAgICAgICBpZiAo
anNfTmV3U3JjTm90ZShjeCwgY2csIFNSQ19BU1NJR05PUCkgPCAwKQotICAgICAgICAgICAgICAg
ICAgICByZXR1cm4gSlNfRkFMU0U7Ci0gICAgICAgICAgICB9Ci0gICAgICAgICAgICBpZiAoanNf
RW1pdDEoY3gsIGNnLCBvcCkgPCAwKQotICAgICAgICAgICAgICAgIHJldHVybiBKU19GQUxTRTsK
LSAgICAgICAgfQotCi0gICAgICAgIC8qIExlZnQgcGFydHMgc3VjaCBhcyBhLmIuYyBhbmQgYVti
XS5jIG5lZWQgYSBkZWNvbXBpbGVyIG5vdGUuICovCi0gICAgICAgIGlmIChwbjItPnBuX3R5cGUg
IT0gVE9LX05BTUUgJiYKLSNpZiBKU19IQVNfREVTVFJVQ1RVUklORwotICAgICAgICAgICAgcG4y
LT5wbl90eXBlICE9IFRPS19SQiAmJgotICAgICAgICAgICAgcG4yLT5wbl90eXBlICE9IFRPS19S
QyAmJgotI2VuZGlmCi0gICAgICAgICAgICBqc19OZXdTcmNOb3RlMihjeCwgY2csIFNSQ19QQ0JB
U0UsIENHX09GRlNFVChjZykgLSB0b3ApIDwgMCkgewotICAgICAgICAgICAgcmV0dXJuIEpTX0ZB
TFNFOwotICAgICAgICB9Ci0KLSAgICAgICAgLyogRmluYWxseSwgZW1pdCB0aGUgc3BlY2lhbGl6
ZWQgYXNzaWdubWVudCBieXRlY29kZS4gKi8KLSAgICAgICAgc3dpdGNoIChwbjItPnBuX3R5cGUp
IHsKLSAgICAgICAgICBjYXNlIFRPS19OQU1FOgotICAgICAgICAgICAgaWYgKHBuMi0+aXNDb25z
dCgpKQotICAgICAgICAgICAgICAgIGJyZWFrOwotICAgICAgICAgICAgLyogRkFMTCBUSFJPVUdI
ICovCi0gICAgICAgICAgY2FzZSBUT0tfRE9UOgotICAgICAgICAgICAgRU1JVF9JTkRFWF9PUChQ
Tl9PUChwbjIpLCBhdG9tSW5kZXgpOwotICAgICAgICAgICAgYnJlYWs7Ci0gICAgICAgICAgY2Fz
ZSBUT0tfTEI6Ci0gICAgICAgICAgY2FzZSBUT0tfTFA6Ci0gICAgICAgICAgICBpZiAoanNfRW1p
dDEoY3gsIGNnLCBKU09QX1NFVEVMRU0pIDwgMCkKLSAgICAgICAgICAgICAgICByZXR1cm4gSlNf
RkFMU0U7Ci0gICAgICAgICAgICBicmVhazsKLSNpZiBKU19IQVNfREVTVFJVQ1RVUklORwotICAg
ICAgICAgIGNhc2UgVE9LX1JCOgotICAgICAgICAgIGNhc2UgVE9LX1JDOgotICAgICAgICAgICAg
aWYgKCFFbWl0RGVzdHJ1Y3R1cmluZ09wcyhjeCwgY2csIEpTT1BfU0VUTkFNRSwgcG4yKSkKLSAg
ICAgICAgICAgICAgICByZXR1cm4gSlNfRkFMU0U7Ci0gICAgICAgICAgICBicmVhazsKLSNlbmRp
ZgotI2lmIEpTX0hBU19YTUxfU1VQUE9SVAotICAgICAgICAgIGNhc2UgVE9LX1VOQVJZT1A6Ci0g
ICAgICAgICAgICBpZiAoanNfRW1pdDEoY3gsIGNnLCBKU09QX1NFVFhNTE5BTUUpIDwgMCkKLSAg
ICAgICAgICAgICAgICByZXR1cm4gSlNfRkFMU0U7Ci0gICAgICAgICAgICBicmVhazsKLSNlbmRp
ZgotICAgICAgICAgIGRlZmF1bHQ6Ci0gICAgICAgICAgICBKU19BU1NFUlQoMCk7Ci0gICAgICAg
IH0KKyAgICAgICAgaWYgKCFFbWl0QXNzaWdubWVudChjeCwgY2csIHBuLT5wbl9sZWZ0LCBQTl9P
UChwbiksIHBuLT5wbl9yaWdodCkpCisgICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAg
IGJyZWFrOwogCiAgICAgICBjYXNlIFRPS19IT09LOgogICAgICAgICAvKiBFbWl0IHRoZSBjb25k
aXRpb24sIHRoZW4gYnJhbmNoIGlmIGZhbHNlIHRvIHRoZSBlbHNlIHBhcnQuICovCiAgICAgICAg
IGlmICghanNfRW1pdFRyZWUoY3gsIGNnLCBwbi0+cG5fa2lkMSkpCiAgICAgICAgICAgICByZXR1
cm4gSlNfRkFMU0U7CiAgICAgICAgIG5vdGVJbmRleCA9IGpzX05ld1NyY05vdGUoY3gsIGNnLCBT
UkNfQ09ORCk7CiAgICAgICAgIGlmIChub3RlSW5kZXggPCAwKQpkaWZmIC0tZ2l0IGEvanMvc3Jj
L2pzaW50ZXJwLmNwcCBiL2pzL3NyYy9qc2ludGVycC5jcHAKLS0tIGEvanMvc3JjL2pzaW50ZXJw
LmNwcAorKysgYi9qcy9zcmMvanNpbnRlcnAuY3BwCkBAIC0zMTQ2LDEwNSArMzE0NiwzNyBAQCBC
RUdJTl9DQVNFKEpTT1BfTU9SRUlURVIpCiAgICAgYm9vbCBjb25kOwogICAgIGlmICghSXRlcmF0
b3JNb3JlKGN4LCAmcmVncy5zcFstMl0udG9PYmplY3QoKSwgJmNvbmQsICZyZWdzLnNwWy0xXSkp
CiAgICAgICAgIGdvdG8gZXJyb3I7CiAgICAgQ0hFQ0tfSU5URVJSVVBUX0hBTkRMRVIoKTsKICAg
ICByZWdzLnNwWy0xXS5zZXRCb29sZWFuKGNvbmQpOwogfQogRU5EX0NBU0UoSlNPUF9NT1JFSVRF
UikKIAorQkVHSU5fQ0FTRShKU09QX0lURVJORVhUKQoreworICAgIFZhbHVlICppdGVydnAgPSBy
ZWdzLnNwIC0gR0VUX0lOVDgocmVncy5wYyk7CisgICAgSlNfQVNTRVJUKGl0ZXJ2cCA+PSByZWdz
LmZwLT5iYXNlKCkpOworICAgIEpTX0FTU0VSVChpdGVydnAtPmlzT2JqZWN0KCkpOworICAgIFBV
U0hfTlVMTCgpOworICAgIGlmICghSXRlcmF0b3JOZXh0KGN4LCAmaXRlcnZwLT50b09iamVjdCgp
LCAmcmVncy5zcFstMV0pKQorICAgICAgICBnb3RvIGVycm9yOworfQorRU5EX0NBU0UoSlNPUF9J
VEVSTkVYVCkKKwogQkVHSU5fQ0FTRShKU09QX0VORElURVIpCiB7CiAgICAgSlNfQVNTRVJUKHJl
Z3Muc3AgLSAxID49IHJlZ3MuZnAtPmJhc2UoKSk7CiAgICAgYm9vbCBvayA9ICEhanNfQ2xvc2VJ
dGVyYXRvcihjeCwgJnJlZ3Muc3BbLTFdLnRvT2JqZWN0KCkpOwogICAgIHJlZ3Muc3AtLTsKICAg
ICBpZiAoIW9rKQogICAgICAgICBnb3RvIGVycm9yOwogfQogRU5EX0NBU0UoSlNPUF9FTkRJVEVS
KQogCi1CRUdJTl9DQVNFKEpTT1BfRk9SQVJHKQotewotICAgIEpTX0FTU0VSVChyZWdzLnNwIC0g
MSA+PSByZWdzLmZwLT5iYXNlKCkpOwotICAgIHVpbnROIHNsb3QgPSBHRVRfQVJHTk8ocmVncy5w
Yyk7Ci0gICAgSlNfQVNTRVJUKHNsb3QgPCByZWdzLmZwLT5udW1Gb3JtYWxBcmdzKCkpOwotICAg
IEpTX0FTU0VSVChyZWdzLnNwWy0xXS5pc09iamVjdCgpKTsKLSAgICBpZiAoIUl0ZXJhdG9yTmV4
dChjeCwgJnJlZ3Muc3BbLTFdLnRvT2JqZWN0KCksICZhcmd2W3Nsb3RdKSkKLSAgICAgICAgZ290
byBlcnJvcjsKLX0KLUVORF9DQVNFKEpTT1BfRk9SQVJHKQotCi1CRUdJTl9DQVNFKEpTT1BfRk9S
TE9DQUwpCi17Ci0gICAgSlNfQVNTRVJUKHJlZ3Muc3AgLSAxID49IHJlZ3MuZnAtPmJhc2UoKSk7
Ci0gICAgdWludE4gc2xvdCA9IEdFVF9TTE9UTk8ocmVncy5wYyk7Ci0gICAgSlNfQVNTRVJUKHNs
b3QgPCByZWdzLmZwLT5udW1TbG90cygpKTsKLSAgICBKU19BU1NFUlQocmVncy5zcFstMV0uaXNP
YmplY3QoKSk7Ci0gICAgaWYgKCFJdGVyYXRvck5leHQoY3gsICZyZWdzLnNwWy0xXS50b09iamVj
dCgpLCAmcmVncy5mcC0+c2xvdHMoKVtzbG90XSkpCi0gICAgICAgIGdvdG8gZXJyb3I7Ci19Ci1F
TkRfQ0FTRShKU09QX0ZPUkxPQ0FMKQotCi1CRUdJTl9DQVNFKEpTT1BfRk9STkFNRSkKLUJFR0lO
X0NBU0UoSlNPUF9GT1JHTkFNRSkKLXsKLSAgICBKU19BU1NFUlQocmVncy5zcCAtIDEgPj0gcmVn
cy5mcC0+YmFzZSgpKTsKLSAgICBKU0F0b20gKmF0b207Ci0gICAgTE9BRF9BVE9NKDAsIGF0b20p
OwotICAgIGpzaWQgaWQgPSBBVE9NX1RPX0pTSUQoYXRvbSk7Ci0gICAgSlNPYmplY3QgKm9iaiwg
Km9iajI7Ci0gICAgSlNQcm9wZXJ0eSAqcHJvcDsKLSAgICBpZiAoIWpzX0ZpbmRQcm9wZXJ0eShj
eCwgaWQsICZvYmosICZvYmoyLCAmcHJvcCkpCi0gICAgICAgIGdvdG8gZXJyb3I7Ci0KLSAgICB7
Ci0gICAgICAgIEF1dG9WYWx1ZVJvb3RlciB0dnIoY3gpOwotICAgICAgICBKU19BU1NFUlQocmVn
cy5zcFstMV0uaXNPYmplY3QoKSk7Ci0gICAgICAgIGlmICghSXRlcmF0b3JOZXh0KGN4LCAmcmVn
cy5zcFstMV0udG9PYmplY3QoKSwgdHZyLmFkZHIoKSkpCi0gICAgICAgICAgICBnb3RvIGVycm9y
OwotICAgICAgICBpZiAoIW9iai0+c2V0UHJvcGVydHkoY3gsIGlkLCB0dnIuYWRkcigpLCBzY3Jp
cHQtPnN0cmljdE1vZGVDb2RlKSkKLSAgICAgICAgICAgIGdvdG8gZXJyb3I7Ci0gICAgfQotfQot
RU5EX0NBU0UoSlNPUF9GT1JOQU1FKQotCi1CRUdJTl9DQVNFKEpTT1BfRk9SUFJPUCkKLXsKLSAg
ICBKU19BU1NFUlQocmVncy5zcCAtIDIgPj0gcmVncy5mcC0+YmFzZSgpKTsKLSAgICBKU0F0b20g
KmF0b207Ci0gICAgTE9BRF9BVE9NKDAsIGF0b20pOwotICAgIGpzaWQgaWQgPSBBVE9NX1RPX0pT
SUQoYXRvbSk7Ci0gICAgSlNPYmplY3QgKm9iajsKLSAgICBGRVRDSF9PQkpFQ1QoY3gsIC0xLCBv
YmopOwotICAgIHsKLSAgICAgICAgQXV0b1ZhbHVlUm9vdGVyIHR2cihjeCk7Ci0gICAgICAgIEpT
X0FTU0VSVChyZWdzLnNwWy0yXS5pc09iamVjdCgpKTsKLSAgICAgICAgaWYgKCFJdGVyYXRvck5l
eHQoY3gsICZyZWdzLnNwWy0yXS50b09iamVjdCgpLCB0dnIuYWRkcigpKSkKLSAgICAgICAgICAg
IGdvdG8gZXJyb3I7Ci0gICAgICAgIGlmICghb2JqLT5zZXRQcm9wZXJ0eShjeCwgaWQsIHR2ci5h
ZGRyKCksIHNjcmlwdC0+c3RyaWN0TW9kZUNvZGUpKQotICAgICAgICAgICAgZ290byBlcnJvcjsK
LSAgICB9Ci0gICAgcmVncy5zcC0tOwotfQotRU5EX0NBU0UoSlNPUF9GT1JQUk9QKQotCi1CRUdJ
Tl9DQVNFKEpTT1BfRk9SRUxFTSkKLSAgICAvKgotICAgICAqIEpTT1BfRk9SRUxFTSBzaW1wbHkg
ZHVwcyB0aGUgcHJvcGVydHkgaWRlbnRpZmllciBhdCB0b3Agb2Ygc3RhY2sgYW5kCi0gICAgICog
bGV0cyB0aGUgc3Vic2VxdWVudCBKU09QX0VOVU1FTEVNIG9wY29kZSBzZXF1ZW5jZSBoYW5kbGUg
dGhlIGxlZnQtaGFuZAotICAgICAqIHNpZGUgZXhwcmVzc2lvbiBldmFsdWF0aW9uIGFuZCBhc3Np
Z25tZW50LiBUaGlzIG9wY29kZSBleGlzdHMgc29sZWx5IHRvCi0gICAgICogaGVscCB0aGUgZGVj
b21waWxlci4KLSAgICAgKi8KLSAgICBKU19BU1NFUlQocmVncy5zcCAtIDEgPj0gcmVncy5mcC0+
YmFzZSgpKTsKLSAgICBKU19BU1NFUlQocmVncy5zcFstMV0uaXNPYmplY3QoKSk7Ci0gICAgUFVT
SF9OVUxMKCk7Ci0gICAgaWYgKCFJdGVyYXRvck5leHQoY3gsICZyZWdzLnNwWy0yXS50b09iamVj
dCgpLCAmcmVncy5zcFstMV0pKQotICAgICAgICBnb3RvIGVycm9yOwotRU5EX0NBU0UoSlNPUF9G
T1JFTEVNKQotCiBCRUdJTl9DQVNFKEpTT1BfRFVQKQogewogICAgIEpTX0FTU0VSVChyZWdzLnNw
ID4gcmVncy5mcC0+YmFzZSgpKTsKICAgICBjb25zdCBWYWx1ZSAmcnJlZiA9IHJlZ3Muc3BbLTFd
OwogICAgIFBVU0hfQ09QWShycmVmKTsKIH0KIEVORF9DQVNFKEpTT1BfRFVQKQogCkBAIC02NjE3
LDE2ICs2NTQ5LDIwIEBAIEJFR0lOX0NBU0UoSlNPUF9BUlJBWVBVU0gpCiAgICAgaWYgKCFqc19B
cnJheUNvbXBQdXNoKGN4LCBvYmosIHJlZ3Muc3BbLTFdKSkKICAgICAgICAgZ290byBlcnJvcjsK
ICAgICByZWdzLnNwLS07CiB9CiBFTkRfQ0FTRShKU09QX0FSUkFZUFVTSCkKICNlbmRpZiAvKiBK
U19IQVNfR0VORVJBVE9SUyAqLwogCiAjaWYgSlNfVEhSRUFERURfSU5URVJQCisgIExfSlNPUF9V
TlVTRUQxMToKKyAgTF9KU09QX1VOVVNFRDEwNjoKKyAgTF9KU09QX1VOVVNFRDEwNzoKKyAgTF9K
U09QX1VOVVNFRDEwODoKICAgTF9KU09QX0JBQ0tQQVRDSDoKICAgTF9KU09QX0JBQ0tQQVRDSF9Q
T1A6CiAKICMgaWYgIUpTX0hBU19HRU5FUkFUT1JTCiAgIExfSlNPUF9HRU5FUkFUT1I6CiAgIExf
SlNPUF9ZSUVMRDoKICAgTF9KU09QX0FSUkFZUFVTSDoKICMgZW5kaWYKZGlmZiAtLWdpdCBhL2pz
L3NyYy9qc29wY29kZS5oIGIvanMvc3JjL2pzb3Bjb2RlLmgKLS0tIGEvanMvc3JjL2pzb3Bjb2Rl
LmgKKysrIGIvanMvc3JjL2pzb3Bjb2RlLmgKQEAgLTY2LDE2ICs2NiwyNCBAQCB0eXBlZGVmIGVu
dW0gSlNPcCB7CiAKICAgICAvKgogICAgICAqIFRoZXNlIHBzZXVkby1vcHMgaGVscCBqc19EZWNv
bXBpbGVWYWx1ZUdlbmVyYXRvciBkZWNvbXBpbGUgSlNPUF9TRVROQU1FLAogICAgICAqIEpTT1Bf
U0VUUFJPUCwgYW5kIEpTT1BfU0VURUxFTSwgcmVzcGVjdGl2ZWx5LiAgVGhleSBhcmUgbmV2ZXIg
c3RvcmVkIGluCiAgICAgICogYnl0ZWNvZGUsIHNvIHRoZXkgZG9uJ3QgcHJlZW1wdCB2YWxpZCBv
cGNvZGVzLgogICAgICAqLwogICAgIEpTT1BfR0VUUFJPUDIgPSBKU09QX0xJTUlULAogICAgIEpT
T1BfR0VURUxFTTIgPSBKU09QX0xJTUlUICsgMSwKKyAvKiA8Pz8/PiAqLworICAgIEpTT1BfRk9S
TE9DQUwsCisgICAgSlNPUF9GT1JBUkcsCisgICAgSlNPUF9GT1JOQU1FLAorICAgIEpTT1BfRk9S
UFJPUCwKKyAgICBKU09QX0ZPUkVMRU0sCisgICAgSlNPUF9GT1JHTkFNRSwKKy8qIDwvPz8/PiAq
LwogICAgIEpTT1BfRkFLRV9MSU1JVCA9IEpTT1BfR0VURUxFTTIKIH0gSlNPcDsKIAogLyoKICAq
IEpTIGJ5dGVjb2RlIGZvcm1hdHMuCiAgKi8KICNkZWZpbmUgSk9GX0JZVEUgICAgICAgICAgMCAg
ICAgICAvKiBzaW5nbGUgYnl0ZWNvZGUsIG5vIGltbWVkaWF0ZXMgKi8KICNkZWZpbmUgSk9GX0pV
TVAgICAgICAgICAgMSAgICAgICAvKiBzaWduZWQgMTYtYml0IGp1bXAgb2Zmc2V0IGltbWVkaWF0
ZSAqLwpkaWZmIC0tZ2l0IGEvanMvc3JjL2pzb3Bjb2RlLnRibCBiL2pzL3NyYy9qc29wY29kZS50
YmwKLS0tIGEvanMvc3JjL2pzb3Bjb2RlLnRibAorKysgYi9qcy9zcmMvanNvcGNvZGUudGJsCkBA
IC0xMjAsMTkgKzEyMCwxOCBAQCBPUERFRihKU09QX0xFQVZFV0lUSCwgNCwgICJsZWF2ZXdpdGgi
LCAgCiBPUERFRihKU09QX1JFVFVSTiwgICAgNSwgICJyZXR1cm4iLCAgICAgTlVMTCwgICAgICAg
ICAxLCAgMSwgIDAsICAyLCAgSk9GX0JZVEUpCiBPUERFRihKU09QX0dPVE8sICAgICAgNiwgICJn
b3RvIiwgICAgICAgTlVMTCwgICAgICAgICAzLCAgMCwgIDAsICAwLCAgSk9GX0pVTVApCiBPUERF
RihKU09QX0lGRVEsICAgICAgNywgICJpZmVxIiwgICAgICAgTlVMTCwgICAgICAgICAzLCAgMSwg
IDAsICA0LCAgSk9GX0pVTVB8Sk9GX0RFVEVDVElORykKIE9QREVGKEpTT1BfSUZORSwgICAgICA4
LCAgImlmbmUiLCAgICAgICBOVUxMLCAgICAgICAgIDMsICAxLCAgMCwgIDAsICBKT0ZfSlVNUHxK
T0ZfUEFSRU5IRUFEKQogCiAvKiBHZXQgdGhlIGFyZ3VtZW50cyBvYmplY3QgZm9yIHRoZSBjdXJy
ZW50LCBsaWdodHdlaWdodCBmdW5jdGlvbiBhY3RpdmF0aW9uLiAqLwogT1BERUYoSlNPUF9BUkdV
TUVOVFMsIDksIGpzX2FyZ3VtZW50c19zdHIsIGpzX2FyZ3VtZW50c19zdHIsIDEsIDAsIDEsIDE4
LCBKT0ZfQllURSkKIAotLyogRUNNQS1jb21wbGlhbnQgZm9yLWluIGxvb3Agd2l0aCBhcmd1bWVu
dCBvciBsb2NhbCBsb29wIGNvbnRyb2wuICovCi1PUERFRihKU09QX0ZPUkFSRywgICAgMTAsICJm
b3JhcmciLCAgICAgTlVMTCwgICAgICAgICAzLCAgMSwgIDEsIDE5LCAgSk9GX1FBUkd8Sk9GX05B
TUV8Sk9GX0ZPUnxKT0ZfVE1QU0xPVCkKLU9QREVGKEpTT1BfRk9STE9DQUwsICAxMSwgImZvcmxv
Y2FsIiwgICBOVUxMLCAgICAgICAgIDMsICAxLCAgMSwgMTksICBKT0ZfTE9DQUx8Sk9GX05BTUV8
Sk9GX0ZPUnxKT0ZfVE1QU0xPVCkKK09QREVGKEpTT1BfU1dBUCwgICAgICAxMCwgInN3YXAiLCAg
ICAgICBOVUxMLCAgICAgICAgIDEsICAyLCAgMiwgIDAsICBKT0ZfQllURSkKK09QREVGKEpTT1Bf
VU5VU0VEMTEsICAxMSwgInVudXNlZDExIiwgICBOVUxMLCAgICAgICAgIDEsICAwLCAgMCwgIDAs
ICBKT0ZfQllURSkKIAogLyogTW9yZSBsb25nLXN0YW5kaW5nIGJ5dGVjb2Rlcy4gKi8KIE9QREVG
KEpTT1BfRFVQLCAgICAgICAxMiwgImR1cCIsICAgICAgICBOVUxMLCAgICAgICAgIDEsICAxLCAg
MiwgIDAsICBKT0ZfQllURSkKIE9QREVGKEpTT1BfRFVQMiwgICAgICAxMywgImR1cDIiLCAgICAg
ICBOVUxMLCAgICAgICAgIDEsICAyLCAgNCwgIDAsICBKT0ZfQllURSkKIE9QREVGKEpTT1BfU0VU
Q09OU1QsICAxNCwgInNldGNvbnN0IiwgICBOVUxMLCAgICAgICAgIDMsICAxLCAgMSwgIDMsICBK
T0ZfQVRPTXxKT0ZfTkFNRXxKT0ZfU0VUKQogT1BERUYoSlNPUF9CSVRPUiwgICAgIDE1LCAiYml0
b3IiLCAgICAgICJ8IiwgICAgICAgICAgMSwgIDIsICAxLCAgNywgIEpPRl9CWVRFfEpPRl9MRUZU
QVNTT0MpCiBPUERFRihKU09QX0JJVFhPUiwgICAgMTYsICJiaXR4b3IiLCAgICAgIl4iLCAgICAg
ICAgICAxLCAgMiwgIDEsICA4LCAgSk9GX0JZVEV8Sk9GX0xFRlRBU1NPQykKIE9QREVGKEpTT1Bf
QklUQU5ELCAgICAxNywgImJpdGFuZCIsICAgICAiJiIsICAgICAgICAgIDEsICAyLCAgMSwgIDks
ICBKT0ZfQllURXxKT0ZfTEVGVEFTU09DKQpAQCAtMjE0LDIwICsyMTMsMjAgQEAgT1BERUYoSlNP
UF9TRVRDQUxMLCAgIDc0LCAic2V0Y2FsbCIsICAgIAogICogdHJ1ZSBpZiBhbm90aGVyIHZhbHVl
IGlzIGF2YWlsYWJsZSwgYW5kIGZhbHNlIG90aGVyd2lzZS4gSXQgaXMgZm9sbG93ZWQKICAqIGlt
bWVkaWF0ZWx5IGJ5IEpTT1BfSUZORXssWH0uCiAgKgogICogSlNPUF9FTkRJVEVSIGNsZWFucyB1
cCBhZnRlciB0aGUgbG9vcC4gSXQgdXNlcyB0aGUgc2xvdCBhYm92ZSB0aGUgaXRlcmF0b3IKICAq
IGZvciB0ZW1wb3JhcnkgR0Mgcm9vdGluZy4KICAqLwogT1BERUYoSlNPUF9JVEVSLCAgICAgIDc1
LCAiaXRlciIsICAgICAgIE5VTEwsICAgICAgICAgMiwgIDEsICAxLCAgMCwgIEpPRl9VSU5UOCkK
IE9QREVGKEpTT1BfTU9SRUlURVIsICA3NiwgIm1vcmVpdGVyIiwgICBOVUxMLCAgICAgICAgIDEs
ICAxLCAgMiwgIDAsICBKT0ZfQllURSkKLU9QREVGKEpTT1BfRU5ESVRFUiwgICA3NywgImVuZGl0
ZXIiLCAgICBOVUxMLCAgICAgICAgIDEsICAxLCAgMCwgIDAsICBKT0ZfQllURSkKK09QREVGKEpT
T1BfSVRFUk5FWFQsICA3NywgIml0ZXJuZXh0IiwgICBOVUxMLCAgICAgICAgIDIsICAwLCAgMSwg
IDAsICBKT0ZfVUlOVDgpCitPUERFRihKU09QX0VORElURVIsICAgNzgsICJlbmRpdGVyIiwgICAg
TlVMTCwgICAgICAgICAxLCAgMSwgIDAsICAwLCAgSk9GX0JZVEUpCiAKLU9QREVGKEpTT1BfRlVO
QVBQTFksICA3OCwgImZ1bmFwcGx5IiwgICBOVUxMLCAgICAgICAgIDMsIC0xLCAgMSwgMTgsICBK
T0ZfVUlOVDE2fEpPRl9JTlZPS0UpCi1PUERFRihKU09QX1NXQVAsICAgICAgNzksICJzd2FwIiwg
ICAgICAgTlVMTCwgICAgICAgICAxLCAgMiwgIDIsICAwLCAgSk9GX0JZVEUpCitPUERFRihKU09Q
X0ZVTkFQUExZLCAgNzksICJmdW5hcHBseSIsICAgTlVMTCwgICAgICAgICAzLCAtMSwgIDEsIDE4
LCAgSk9GX1VJTlQxNnxKT0ZfSU5WT0tFKQogCiAvKiBQdXNoIG9iamVjdCBsaXRlcmFsOiBlaXRo
ZXIgYW4gWE1MIG9iamVjdCBvciBpbml0aWFsaXNlciBvYmplY3QuICovCiBPUERFRihKU09QX09C
SkVDVCwgICAgODAsICJvYmplY3QiLCAgICAgTlVMTCwgICAgICAgICAzLCAgMCwgIDEsIDE5LCAg
Sk9GX09CSkVDVCkKIAogLyogUG9wIHZhbHVlIGFuZCBkaXNjYXJkIGl0LiAqLwogT1BERUYoSlNP
UF9QT1AsICAgICAgIDgxLCAicG9wIiwgICAgICAgIE5VTEwsICAgICAgICAgMSwgIDEsICAwLCAg
MiwgIEpPRl9CWVRFKQogCiAvKiBDYWxsIGEgZnVuY3Rpb24gYXMgYSBjb25zdHJ1Y3Rvcjsgb3Bl
cmFuZCBpcyBhcmdjLiAqLwpAQCAtMjcwLDIwICsyNjksMTkgQEAgT1BERUYoSlNPUF9BUkdERUMs
ICAgMTAwLCAiYXJnZGVjIiwgICAgIAogCiBPUERFRihKU09QX0lOQ0xPQ0FMLCAgMTAxLCJpbmNs
b2NhbCIsICAgTlVMTCwgICAgICAgICAzLCAgMCwgIDEsIDE1LCAgSk9GX0xPQ0FMfEpPRl9OQU1F
fEpPRl9JTkN8Sk9GX1RNUFNMT1QzKQogT1BERUYoSlNPUF9ERUNMT0NBTCwgIDEwMiwiZGVjbG9j
YWwiLCAgIE5VTEwsICAgICAgICAgMywgIDAsICAxLCAxNSwgIEpPRl9MT0NBTHxKT0ZfTkFNRXxK
T0ZfREVDfEpPRl9UTVBTTE9UMykKIE9QREVGKEpTT1BfTE9DQUxJTkMsICAxMDMsImxvY2FsaW5j
IiwgICBOVUxMLCAgICAgICAgIDMsICAwLCAgMSwgMTUsICBKT0ZfTE9DQUx8Sk9GX05BTUV8Sk9G
X0lOQ3xKT0ZfUE9TVHxKT0ZfVE1QU0xPVDMpCiBPUERFRihKU09QX0xPQ0FMREVDLCAgMTA0LCJs
b2NhbGRlYyIsICAgTlVMTCwgICAgICAgICAzLCAgMCwgIDEsIDE1LCAgSk9GX0xPQ0FMfEpPRl9O
QU1FfEpPRl9ERUN8Sk9GX1BPU1R8Sk9GX1RNUFNMT1QzKQogCiBPUERFRihKU09QX0lNQUNPUCwg
ICAgMTA1LCJpbWFjb3AiLCAgICAgTlVMTCwgICAgICAgICAxLCAgMCwgIDAsICAwLCAgSk9GX0JZ
VEUpCiAKLS8qIEVDTUEtY29tcGxpYW50IGZvci9pbiBvcHMuICovCi1PUERFRihKU09QX0ZPUk5B
TUUsICAgMTA2LCJmb3JuYW1lIiwgICAgTlVMTCwgICAgICAgICAzLCAgMSwgIDEsIDE5LCAgSk9G
X0FUT018Sk9GX05BTUV8Sk9GX0ZPUnxKT0ZfVE1QU0xPVDMpCi1PUERFRihKU09QX0ZPUlBST1As
ICAgMTA3LCJmb3Jwcm9wIiwgICAgTlVMTCwgICAgICAgICAzLCAgMiwgIDEsIDE4LCAgSk9GX0FU
T018Sk9GX1BST1B8Sk9GX0ZPUnxKT0ZfVE1QU0xPVDMpCi1PUERFRihKU09QX0ZPUkVMRU0sICAg
MTA4LCJmb3JlbGVtIiwgICAgTlVMTCwgICAgICAgICAxLCAgMSwgIDIsIDE4LCAgSk9GX0JZVEUg
fEpPRl9FTEVNfEpPRl9GT1IpCitPUERFRihKU09QX1VOVVNFRDEwNiwgMTA2LCAidW51c2VkMTA2
IiwgTlVMTCwgICAgICAgICAxLCAgMCwgIDAsICAwLCAgSk9GX0JZVEUpCitPUERFRihKU09QX1VO
VVNFRDEwNywgMTA3LCAidW51c2VkMTA3IiwgTlVMTCwgICAgICAgICAxLCAgMCwgIDAsICAwLCAg
Sk9GX0JZVEUpCitPUERFRihKU09QX1VOVVNFRDEwOCwgMTA4LCAidW51c2VkMTA4IiwgTlVMTCwg
ICAgICAgICAxLCAgMCwgIDAsICAwLCAgSk9GX0JZVEUpCiBPUERFRihKU09QX1BPUE4sICAgICAg
MTA5LCJwb3BuIiwgICAgICAgTlVMTCwgICAgICAgICAzLCAtMSwgIDAsICAwLCAgSk9GX1VJTlQx
NikKIAogLyogRUNNQS1jb21wbGlhbnQgYXNzaWdubWVudCBvcHMuICovCiBPUERFRihKU09QX0JJ
TkROQU1FLCAgMTEwLCJiaW5kbmFtZSIsICAgTlVMTCwgICAgICAgICAzLCAgMCwgIDEsICAwLCAg
Sk9GX0FUT018Sk9GX05BTUV8Sk9GX1NFVCkKIE9QREVGKEpTT1BfU0VUTkFNRSwgICAxMTEsInNl
dG5hbWUiLCAgICBOVUxMLCAgICAgICAgIDMsICAyLCAgMSwgIDMsICBKT0ZfQVRPTXxKT0ZfTkFN
RXxKT0ZfU0VUfEpPRl9ERVRFQ1RJTkcpCiAKIC8qIEV4Y2VwdGlvbiBoYW5kbGluZyBvcHMuICov
CiBPUERFRihKU09QX1RIUk9XLCAgICAgMTEyLGpzX3Rocm93X3N0ciwgTlVMTCwgICAgICAgICAx
LCAgMSwgIDAsICAwLCAgSk9GX0JZVEUpCkBAIC02MDksMTAgKzYwNyw4IEBAIE9QREVGKEpTT1Bf
VU5CUkFORFRISVMsICAgMjM4LCJ1bmJyYW5kdGgKIE9QREVGKEpTT1BfU0hBUlBJTklULCAgICAg
MjM5LCJzaGFycGluaXQiLCAgICAgTlVMTCwgIDMsICAwLCAgMCwgIDAsICBKT0ZfVUlOVDE2fEpP
Rl9TSEFSUFNMT1QpCiAKIC8qIFN0YXRpYyBiaW5kaW5nIGZvciBnbG9iYWxzLiAqLwogT1BERUYo
SlNPUF9HRVRHTE9CQUwsICAgICAyNDAsImdldGdsb2JhbCIsICAgICBOVUxMLCAgMywgIDAsICAx
LCAxOSwgIEpPRl9HTE9CQUx8Sk9GX05BTUUpCiBPUERFRihKU09QX0NBTExHTE9CQUwsICAgIDI0
MSwiY2FsbGdsb2JhbCIsICAgIE5VTEwsICAzLCAgMCwgIDIsIDE5LCAgSk9GX0dMT0JBTHxKT0Zf
TkFNRXxKT0ZfQ0FMTE9QKQogCiAvKiBMaWtlIEpTT1BfRlVOQVBQTFkgYnV0IGZvciBmLmNhbGwg
aW5zdGVhZCBvZiBmLmFwcGx5LiAqLwogT1BERUYoSlNPUF9GVU5DQUxMLCAgICAgICAyNDIsImZ1
bmNhbGwiLCAgICAgICBOVUxMLCAgMywgLTEsICAxLCAxOCwgIEpPRl9VSU5UMTZ8Sk9GX0lOVk9L
RSkKLQotT1BERUYoSlNPUF9GT1JHTkFNRSwgICAgICAyNDMsImZvcmduYW1lIiwgICAgICBOVUxM
LCAgMywgIDEsICAxLCAxOSwgIEpPRl9BVE9NfEpPRl9HTkFNRXxKT0ZfRk9SfEpPRl9UTVBTTE9U
MykKZGlmZiAtLWdpdCBhL2pzL3NyYy9qc3BhcnNlLmNwcCBiL2pzL3NyYy9qc3BhcnNlLmNwcAot
LS0gYS9qcy9zcmMvanNwYXJzZS5jcHAKKysrIGIvanMvc3JjL2pzcGFyc2UuY3BwCkBAIC00NDQ2
LDE3ICs0NDQ2LDE5IEBAIFBhcnNlcjo6ZGVzdHJ1Y3R1cmluZ0V4cHIoQmluZERhdGEgKmRhdGEK
ICAgICBpZiAoIXBuKQogICAgICAgICByZXR1cm4gTlVMTDsKICAgICBpZiAoIUNoZWNrRGVzdHJ1
Y3R1cmluZyhjb250ZXh0LCBkYXRhLCBwbiwgdGMpKQogICAgICAgICByZXR1cm4gTlVMTDsKICAg
ICByZXR1cm4gcG47CiB9CiAKIC8qCi0gKiBDdXJyZW50bHkgdXNlZCBvbmx5ICNpZiBKU19IQVNf
REVTVFJVQ1RVUklORywgaW4gU3RhdGVtZW50J3MgVE9LX0ZPUiBjYXNlLgorICogQ3VycmVudGx5
IHVzZWQgb25seSBieSBQYXJzZXI6OmZvclN0YXRlbWVudCB0byBjbG9uZSB0aGUgVEFSR0VUIGlu
CisgKiBgZm9yICh2YXIvY29uc3QvbGV0IFRBUkdFVCBpbiBFWFBSKSBTVE1UYC4KKyAqCiAgKiBU
aGlzIGZ1bmN0aW9uIGFzc3VtZXMgdGhlIGNsb25lZCB0cmVlIGlzIGZvciB1c2UgaW4gdGhlIHNh
bWUgc3RhdGVtZW50IGFuZAogICogYmluZGluZyBjb250ZXh0IGFzIHRoZSBvcmlnaW5hbCB0cmVl
LgogICovCiBzdGF0aWMgSlNQYXJzZU5vZGUgKgogQ2xvbmVQYXJzZVRyZWUoSlNQYXJzZU5vZGUg
Km9wbiwgSlNUcmVlQ29udGV4dCAqdGMpCiB7CiAgICAgSlNQYXJzZU5vZGUgKnBuLCAqcG4yLCAq
b3BuMjsKIApAQCAtNTA1NywxOCArNTA1OSwyMCBAQCBQYXJzZXI6OmZvclN0YXRlbWVudCgpCiAg
ICAgVG9rZW5LaW5kIHR0ID0gdG9rZW5TdHJlYW0ucGVla1Rva2VuKFRTRl9PUEVSQU5EKTsKIAog
I2lmIEpTX0hBU19CTE9DS19TQ09QRQogICAgIGJvb2wgbGV0ID0gZmFsc2U7CiAjZW5kaWYKIAog
ICAgIEpTUGFyc2VOb2RlICpwbjE7CiAgICAgaWYgKHR0ID09IFRPS19TRU1JKSB7Ci0gICAgICAg
IGlmIChwbi0+cG5faWZsYWdzICYgSlNJVEVSX0ZPUkVBQ0gpCi0gICAgICAgICAgICBnb3RvIGJh
ZF9mb3JfZWFjaDsKKyAgICAgICAgaWYgKHBuLT5wbl9pZmxhZ3MgJiBKU0lURVJfRk9SRUFDSCkg
eworICAgICAgICAgICAgcmVwb3J0RXJyb3JOdW1iZXIocG4sIEpTUkVQT1JUX0VSUk9SLCBKU01T
R19CQURfRk9SX0VBQ0hfTE9PUCk7CisgICAgICAgICAgICByZXR1cm4gTlVMTDsKKyAgICAgICAg
fQogCiAgICAgICAgIC8qIE5vIGluaXRpYWxpemVyIC0tIHNldCBmaXJzdCBraWQgb2YgbGVmdCBz
dWItbm9kZSB0byBudWxsLiAqLwogICAgICAgICBwbjEgPSBOVUxMOwogICAgIH0gZWxzZSB7CiAg
ICAgICAgIC8qCiAgICAgICAgICAqIFNldCBwbjEgdG8gYSB2YXIgbGlzdCBvciBhbiBpbml0aWFs
aXppbmcgZXhwcmVzc2lvbi4KICAgICAgICAgICoKICAgICAgICAgICogU2V0IHRoZSBUQ0ZfSU5f
Rk9SX0lOSVQgZmxhZyBkdXJpbmcgcGFyc2luZyBvZiB0aGUgZmlyc3QgY2xhdXNlCkBAIC01MTA5
LDE3ICs1MTEzLDI4IEBAIFBhcnNlcjo6Zm9yU3RhdGVtZW50KCkKICAgICB9CiAKICAgICAvKgog
ICAgICAqIFdlIGNhbiBiZSBzdXJlIHRoYXQgaXQncyBhIGZvci9pbiBsb29wIGlmIHRoZXJlJ3Mg
c3RpbGwgYW4gJ2luJwogICAgICAqIGtleXdvcmQgaGVyZSwgZXZlbiBpZiBKYXZhU2NyaXB0IHJl
Y29nbml6ZXMgJ2luJyBhcyBhbiBvcGVyYXRvciwKICAgICAgKiBhcyB3ZSd2ZSBleGNsdWRlZCAn
aW4nIGZyb20gYmVpbmcgcGFyc2VkIGluIFJlbEV4cHIgYnkgc2V0dGluZwogICAgICAqIHRoZSBU
Q0ZfSU5fRk9SX0lOSVQgZmxhZyBpbiBvdXIgSlNUcmVlQ29udGV4dC4KICAgICAgKi8KKyAgICBK
U1BhcnNlTm9kZSAqcG4yLCAqcG4zOworICAgIEpTUGFyc2VOb2RlICpwbjQgPSBUZXJuYXJ5Tm9k
ZTo6Y3JlYXRlKHRjKTsKKyAgICBpZiAoIXBuNCkKKyAgICAgICAgcmV0dXJuIE5VTEw7CiAgICAg
aWYgKHBuMSAmJiB0b2tlblN0cmVhbS5tYXRjaFRva2VuKFRPS19JTikpIHsKKyAgICAgICAgLyoK
KyAgICAgICAgICogUGFyc2UgdGhlIHJlc3Qgb2YgdGhlIGZvci9pbiBoZWFkLgorICAgICAgICAg
KgorICAgICAgICAgKiBIZXJlIHBuMSBpcyBldmVyeXRoaW5nIHRvIHRoZSBsZWZ0IG9mICdpbicu
IEF0IHRoZSBlbmQgb2YgdGhpcyBibG9jaywKKyAgICAgICAgICogcG4xIGlzIGEgZGVjbCBvciBO
VUxMLCBwbjIgaXMgdGhlIGFzc2lnbm1lbnQgdGFyZ2V0IHRoYXQgcmVjZWl2ZXMgdGhlCisgICAg
ICAgICAqIGVudW1lcmF0aW9uIHZhbHVlIGVhY2ggaXRlcmF0aW9uLCBhbmQgcG4zIGlzIHRoZSBy
aHMgb2YgJ2luJy4KKyAgICAgICAgICovCiAgICAgICAgIHBuLT5wbl9pZmxhZ3MgfD0gSlNJVEVS
X0VOVU1FUkFURTsKICAgICAgICAgc3RtdEluZm8udHlwZSA9IFNUTVRfRk9SX0lOX0xPT1A7CiAK
ICAgICAgICAgLyogQ2hlY2sgdGhhdCB0aGUgbGVmdCBzaWRlIG9mIHRoZSAnaW4nIGlzIHZhbGlk
LiAqLwogICAgICAgICBKU19BU1NFUlQoIVRva2VuS2luZElzRGVjbCh0dCkgfHwgUE5fVFlQRShw
bjEpID09IHR0KTsKICAgICAgICAgaWYgKFRva2VuS2luZElzRGVjbCh0dCkKICAgICAgICAgICAg
ID8gKHBuMS0+cG5fY291bnQgPiAxIHx8IHBuMS0+cG5fb3AgPT0gSlNPUF9ERUZDT05TVAogI2lm
IEpTX0hBU19ERVNUUlVDVFVSSU5HCkBAIC01MTQ4LDM1ICs1MTYzLDQxIEBAIFBhcnNlcjo6Zm9y
U3RhdGVtZW50KCkKICAgICAgICAgICAgICAgIChwbjEtPnBuX3R5cGUgIT0gVE9LX1VOQVJZT1Ag
fHwKICAgICAgICAgICAgICAgICBwbjEtPnBuX29wICE9IEpTT1BfWE1MTkFNRSkgJiYKICNlbmRp
ZgogICAgICAgICAgICAgICAgcG4xLT5wbl90eXBlICE9IFRPS19MQikpIHsKICAgICAgICAgICAg
IHJlcG9ydEVycm9yTnVtYmVyKHBuMSwgSlNSRVBPUlRfRVJST1IsIEpTTVNHX0JBRF9GT1JfTEVG
VFNJREUpOwogICAgICAgICAgICAgcmV0dXJuIE5VTEw7CiAgICAgICAgIH0KIAotICAgICAgICAv
KiBwbjIgcG9pbnRzIHRvIHRoZSBuYW1lIG9yIGRlc3RydWN0dXJpbmcgcGF0dGVybiBvbiBpbidz
IGxlZnQuICovCi0gICAgICAgIEpTUGFyc2VOb2RlICpwbjIgPSBOVUxMOworICAgICAgICAvKgor
ICAgICAgICAgKiBBZnRlciB0aGUgZm9sbG93aW5nIGlmLWVsc2UsIHBuMiB3aWxsIHBvaW50IHRv
IHRoZSBuYW1lIG9yCisgICAgICAgICAqIGRlc3RydWN0dXJpbmcgcGF0dGVybiBvbiBpbidzIGxl
ZnQuIHBuMSB3aWxsIHBvaW50IHRvIHRoZSBkZWNsLCBpZgorICAgICAgICAgKiBhbnksIGVsc2Ug
TlVMTC4gTm90ZSB0aGF0IHRoZSAiZGVjbGFyYXRpb24gd2l0aCBpbml0aWFsaXplciIgY2FzZQor
ICAgICAgICAgKiByZXdyaXRlcyB0aGUgbG9vcC1oZWFkLCBtb3ZpbmcgdGhlIGRlY2wgYW5kIHNl
dHRpbmcgcG4xIHRvIE5VTEwuCisgICAgICAgICAqLworICAgICAgICBwbjIgPSBOVUxMOwogICAg
ICAgICB1aW50TiBkZmxhZyA9IFBORF9BU1NJR05FRDsKLQogICAgICAgICBpZiAoVG9rZW5LaW5k
SXNEZWNsKHR0KSkgewotICAgICAgICAgICAgLyogVGVsbCBqc19FbWl0VHJlZShUT0tfVkFSKSB0
aGF0IHBuMSBpcyBwYXJ0IG9mIGEgZm9yL2luLiAqLworICAgICAgICAgICAgLyogVGVsbCBFbWl0
VmFyaWFibGVzIHRoYXQgcG4xIGlzIHBhcnQgb2YgYSBmb3IvaW4uICovCiAgICAgICAgICAgICBw
bjEtPnBuX3hmbGFncyB8PSBQTlhfRk9SSU5WQVI7CiAKLSAgICAgICAgICAgIC8qCi0gICAgICAg
ICAgICAgKiBSZXdyaXRlICdmb3IgKDxkZWNsPiB4ID0gaSBpbiBvKScgd2hlcmUgPGRlY2w+IGlz
ICd2YXInIG9yCi0gICAgICAgICAgICAgKiAnY29uc3QnIHRvIGhvaXN0IHRoZSBpbml0aWFsaXpl
ciBvciB0aGUgZW50aXJlIGRlY2wgb3V0IG9mCi0gICAgICAgICAgICAgKiB0aGUgbG9vcCBoZWFk
LiBUT0tfVkFSIGlzIHRoZSB0eXBlIGZvciBib3RoICd2YXInIGFuZCAnY29uc3QnLgotICAgICAg
ICAgICAgICovCiAgICAgICAgICAgICBwbjIgPSBwbjEtPnBuX2hlYWQ7CiAgICAgICAgICAgICBp
ZiAoKHBuMi0+cG5fdHlwZSA9PSBUT0tfTkFNRSAmJiBwbjItPm1heWJlRXhwcigpKQogI2lmIEpT
X0hBU19ERVNUUlVDVFVSSU5HCiAgICAgICAgICAgICAgICAgfHwgcG4yLT5wbl90eXBlID09IFRP
S19BU1NJR04KICNlbmRpZgogICAgICAgICAgICAgICAgICkgeworICAgICAgICAgICAgICAgIC8q
CisgICAgICAgICAgICAgICAgICogRGVjbGFyYXRpb24gd2l0aCBpbml0aWFsaXplci4KKyAgICAg
ICAgICAgICAgICAgKgorICAgICAgICAgICAgICAgICAqIFJld3JpdGUgJ2ZvciAoPGRlY2w+IHgg
PSBpIGluIG8pJyB3aGVyZSA8ZGVjbD4gaXMgJ3Zhcicgb3IKKyAgICAgICAgICAgICAgICAgKiAn
Y29uc3QnIHRvIGhvaXN0IHRoZSBpbml0aWFsaXplciBvciB0aGUgZW50aXJlIGRlY2wgb3V0IG9m
CisgICAgICAgICAgICAgICAgICogdGhlIGxvb3AgaGVhZC4gVE9LX1ZBUiBpcyB0aGUgdHlwZSBm
b3IgYm90aCAndmFyJyBhbmQgJ2NvbnN0Jy4KKyAgICAgICAgICAgICAgICAgKi8KICNpZiBKU19I
QVNfQkxPQ0tfU0NPUEUKICAgICAgICAgICAgICAgICBpZiAodHQgPT0gVE9LX0xFVCkgewogICAg
ICAgICAgICAgICAgICAgICByZXBvcnRFcnJvck51bWJlcihwbjIsIEpTUkVQT1JUX0VSUk9SLCBK
U01TR19JTlZBTElEX0ZPUl9JTl9JTklUKTsKICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIE5V
TEw7CiAgICAgICAgICAgICAgICAgfQogI2VuZGlmIC8qIEpTX0hBU19CTE9DS19TQ09QRSAqLwog
CiAgICAgICAgICAgICAgICAgcG5zZXEgPSBMaXN0Tm9kZTo6Y3JlYXRlKHRjKTsKQEAgLTUxOTYs
NjUgKzUyMTcsNjIgQEAgUGFyc2VyOjpmb3JTdGF0ZW1lbnQoKQogICAgICAgICAgICAgICAgICAq
IHNpZGUpIGFuZCBpdCBoYXMgYW4gaW5pdGlhbGl6ZXIuCiAgICAgICAgICAgICAgICAgICovCiAg
ICAgICAgICAgICAgICAgcG4xLT5wbl94ZmxhZ3MgJj0gflBOWF9GT1JJTlZBUjsKICAgICAgICAg
ICAgICAgICBwbjEtPnBuX3hmbGFncyB8PSBQTlhfUE9QVkFSOwogICAgICAgICAgICAgICAgIHBu
c2VxLT5pbml0TGlzdChwbjEpOwogCiAjaWYgSlNfSEFTX0RFU1RSVUNUVVJJTkcKICAgICAgICAg
ICAgICAgICBpZiAocG4yLT5wbl90eXBlID09IFRPS19BU1NJR04pIHsKLSAgICAgICAgICAgICAg
ICAgICAgcG4xID0gQ2xvbmVQYXJzZVRyZWUocG4yLT5wbl9sZWZ0LCB0Yyk7Ci0gICAgICAgICAg
ICAgICAgICAgIGlmICghcG4xKQorICAgICAgICAgICAgICAgICAgICBwbjIgPSBDbG9uZVBhcnNl
VHJlZShwbjItPnBuX2xlZnQsIHRjKTsKKyAgICAgICAgICAgICAgICAgICAgaWYgKCFwbjIpCiAg
ICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gTlVMTDsKICAgICAgICAgICAgICAgICB9IGVs
c2UKICNlbmRpZgogICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgICAgSlNfQVNT
RVJUKHBuMi0+cG5fdHlwZSA9PSBUT0tfTkFNRSk7CiAgICAgICAgICAgICAgICAgICAgIHBuMSA9
IE5hbWVOb2RlOjpjcmVhdGUocG4yLT5wbl9hdG9tLCB0Yyk7CiAgICAgICAgICAgICAgICAgICAg
IGlmICghcG4xKQogICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIE5VTEw7CiAgICAgICAg
ICAgICAgICAgICAgIHBuMS0+cG5fdHlwZSA9IFRPS19OQU1FOwogICAgICAgICAgICAgICAgICAg
ICBwbjEtPnBuX29wID0gSlNPUF9OQU1FOwogICAgICAgICAgICAgICAgICAgICBwbjEtPnBuX3Bv
cyA9IHBuMi0+cG5fcG9zOwogICAgICAgICAgICAgICAgICAgICBpZiAocG4yLT5wbl9kZWZuKQog
ICAgICAgICAgICAgICAgICAgICAgICAgTGlua1VzZVRvRGVmKHBuMSwgKEpTRGVmaW5pdGlvbiAq
KSBwbjIsIHRjKTsKKyAgICAgICAgICAgICAgICAgICAgcG4yID0gcG4xOwogICAgICAgICAgICAg
ICAgIH0KLSAgICAgICAgICAgICAgICBwbjIgPSBwbjE7Ci0gICAgICAgICAgICB9Ci0gICAgICAg
IH0KLQotICAgICAgICBpZiAoIXBuMikgeworICAgICAgICAgICAgICAgIHBuMSA9IE5VTEw7Cisg
ICAgICAgICAgICB9IGVsc2UgeworICAgICAgICAgICAgICAgIC8qIERlY2xhcmF0aW9uIHdpdGhv
dXQgaW5pdGlhbGl6ZXIuICovCisgICAgICAgICAgICAgICAgcG4yID0gQ2xvbmVQYXJzZVRyZWUo
cG4xLT5wbl9oZWFkLCB0Yyk7CisgICAgICAgICAgICAgICAgaWYgKCFwbjIpCisgICAgICAgICAg
ICAgICAgICAgIHJldHVybiBOVUxMOworICAgICAgICAgICAgfQorICAgICAgICB9IGVsc2Ugewor
ICAgICAgICAgICAgLyogTm90IGEgZGVjbGFyYXRpb24uICovCiAgICAgICAgICAgICBwbjIgPSBw
bjE7Ci0gICAgICAgICAgICBpZiAocG4yLT5wbl90eXBlID09IFRPS19MUCAmJgotICAgICAgICAg
ICAgICAgICFNYWtlU2V0Q2FsbChjb250ZXh0LCBwbjIsIHRjLCBKU01TR19CQURfTEVGVFNJREVf
T0ZfQVNTKSkgewotICAgICAgICAgICAgICAgIHJldHVybiBOVUxMOwotICAgICAgICAgICAgfQot
I2lmIEpTX0hBU19YTUxfU1VQUE9SVAotICAgICAgICAgICAgaWYgKHBuMi0+cG5fdHlwZSA9PSBU
T0tfVU5BUllPUCkKLSAgICAgICAgICAgICAgICBwbjItPnBuX29wID0gSlNPUF9CSU5EWE1MTkFN
RTsKLSNlbmRpZgotICAgICAgICB9CisgICAgICAgICAgICBwbjEgPSBOVUxMOworICAgICAgICB9
CisKKyAgICAgICAgaWYgKCFzZXRBc3NpZ25tZW50TGhzT3BzKHBuMiwgSlNPUF9OT1ApKQorICAg
ICAgICAgICAgcmV0dXJuIE5VTEw7CiAKICAgICAgICAgc3dpdGNoIChwbjItPnBuX3R5cGUpIHsK
ICAgICAgICAgICBjYXNlIFRPS19OQU1FOgogICAgICAgICAgICAgLyogQmV3YXJlICdmb3IgKGFy
Z3VtZW50cyBpbiAuLi4pJyB3aXRoIG9yIHdpdGhvdXQgYSAndmFyJy4gKi8KICAgICAgICAgICAg
IE5vdGVMVmFsdWUoY29udGV4dCwgcG4yLCB0YywgZGZsYWcpOwogICAgICAgICAgICAgYnJlYWs7
CiAKICNpZiBKU19IQVNfREVTVFJVQ1RVUklORwogICAgICAgICAgIGNhc2UgVE9LX0FTU0lHTjoK
LSAgICAgICAgICAgIHBuMiA9IHBuMi0+cG5fbGVmdDsKLSAgICAgICAgICAgIEpTX0FTU0VSVChw
bjItPnBuX3R5cGUgPT0gVE9LX1JCIHx8IHBuMi0+cG5fdHlwZSA9PSBUT0tfUkMpOwotICAgICAg
ICAgICAgLyogRkFMTCBUSFJPVUdIICovCisgICAgICAgICAgICBKU19OT1RfUkVBQ0hFRCgiZm9y
U3RhdGVtZW50IFRPS19BU1NJR04iKTsKKyAgICAgICAgICAgIGJyZWFrOworCiAgICAgICAgICAg
Y2FzZSBUT0tfUkI6CiAgICAgICAgICAgY2FzZSBUT0tfUkM6Ci0gICAgICAgICAgICAvKiBDaGVj
ayBmb3IgdmFsaWQgbHZhbHVlcyBpbiB2YXItbGVzcyBkZXN0cnVjdHVyaW5nIGZvci1pbi4gKi8K
LSAgICAgICAgICAgIGlmIChwbjEgPT0gcG4yICYmICFDaGVja0Rlc3RydWN0dXJpbmcoY29udGV4
dCwgTlVMTCwgcG4yLCB0YykpCi0gICAgICAgICAgICAgICAgcmV0dXJuIE5VTEw7Ci0KICAgICAg
ICAgICAgIGlmICh2ZXJzaW9uTnVtYmVyKCkgPT0gSlNWRVJTSU9OXzFfNykgewogICAgICAgICAg
ICAgICAgIC8qCiAgICAgICAgICAgICAgICAgICogRGVzdHJ1Y3R1cmluZyBmb3ItaW4gcmVxdWly
ZXMgW2tleSwgdmFsdWVdIGVudW1lcmF0aW9uCiAgICAgICAgICAgICAgICAgICogaW4gSlMxLjcu
CiAgICAgICAgICAgICAgICAgICovCiAgICAgICAgICAgICAgICAgSlNfQVNTRVJUKHBuLT5wbl9v
cCA9PSBKU09QX0lURVIpOwogICAgICAgICAgICAgICAgIGlmICghKHBuLT5wbl9pZmxhZ3MgJiBK
U0lURVJfRk9SRUFDSCkpCiAgICAgICAgICAgICAgICAgICAgIHBuLT5wbl9pZmxhZ3MgfD0gSlNJ
VEVSX0ZPUkVBQ0ggfCBKU0lURVJfS0VZVkFMVUU7CkBAIC01MjcwLDcxICs1Mjg4LDYzIEBAIFBh
cnNlcjo6Zm9yU3RhdGVtZW50KCkKICAgICAgICAgICogcmVtb3ZpbmcgdGhlIHRvcCBzdGF0ZW1l
bnQgZnJvbSB0aGUgc3RhdGVtZW50LXN0YWNrIGlmIHRoaXMgaXMgYQogICAgICAgICAgKiAnZm9y
IChsZXQgeCBpbiB5KScgbG9vcC4KICAgICAgICAgICovCiAjaWYgSlNfSEFTX0JMT0NLX1NDT1BF
CiAgICAgICAgIEpTU3RtdEluZm8gKnNhdmUgPSB0Yy0+dG9wU3RtdDsKICAgICAgICAgaWYgKGxl
dCkKICAgICAgICAgICAgIHRjLT50b3BTdG10ID0gc2F2ZS0+ZG93bjsKICNlbmRpZgotICAgICAg
ICBwbjIgPSBleHByKCk7CisgICAgICAgIHBuMyA9IGV4cHIoKTsKICNpZiBKU19IQVNfQkxPQ0tf
U0NPUEUKICAgICAgICAgaWYgKGxldCkKICAgICAgICAgICAgIHRjLT50b3BTdG10ID0gc2F2ZTsK
ICNlbmRpZgogCi0gICAgICAgIHBuMiA9IEpTUGFyc2VOb2RlOjpuZXdCaW5hcnlPckFwcGVuZChU
T0tfSU4sIEpTT1BfTk9QLCBwbjEsIHBuMiwgdGMpOwotICAgICAgICBpZiAoIXBuMikKLSAgICAg
ICAgICAgIHJldHVybiBOVUxMOwotICAgICAgICBwbi0+cG5fbGVmdCA9IHBuMjsKKyAgICAgICAg
cG40LT5wbl90eXBlID0gVE9LX0lOOwogICAgIH0gZWxzZSB7Ci0gICAgICAgIGlmIChwbi0+cG5f
aWZsYWdzICYgSlNJVEVSX0ZPUkVBQ0gpCi0gICAgICAgICAgICBnb3RvIGJhZF9mb3JfZWFjaDsK
KyAgICAgICAgaWYgKHBuLT5wbl9pZmxhZ3MgJiBKU0lURVJfRk9SRUFDSCkgeworICAgICAgICAg
ICAgcmVwb3J0RXJyb3JOdW1iZXIocG4sIEpTUkVQT1JUX0VSUk9SLCBKU01TR19CQURfRk9SX0VB
Q0hfTE9PUCk7CisgICAgICAgICAgICByZXR1cm4gTlVMTDsKKyAgICAgICAgfQogICAgICAgICBw
bi0+cG5fb3AgPSBKU09QX05PUDsKIAogICAgICAgICAvKiBQYXJzZSB0aGUgbG9vcCBjb25kaXRp
b24gb3IgbnVsbCBpbnRvIHBuMi4gKi8KICAgICAgICAgTVVTVF9NQVRDSF9UT0tFTihUT0tfU0VN
SSwgSlNNU0dfU0VNSV9BRlRFUl9GT1JfSU5JVCk7CiAgICAgICAgIHR0ID0gdG9rZW5TdHJlYW0u
cGVla1Rva2VuKFRTRl9PUEVSQU5EKTsKLSAgICAgICAgSlNQYXJzZU5vZGUgKnBuMjsKICAgICAg
ICAgaWYgKHR0ID09IFRPS19TRU1JKSB7CiAgICAgICAgICAgICBwbjIgPSBOVUxMOwogICAgICAg
ICB9IGVsc2UgewogICAgICAgICAgICAgcG4yID0gZXhwcigpOwogICAgICAgICAgICAgaWYgKCFw
bjIpCiAgICAgICAgICAgICAgICAgcmV0dXJuIE5VTEw7CiAgICAgICAgIH0KIAogICAgICAgICAv
KiBQYXJzZSB0aGUgdXBkYXRlIGV4cHJlc3Npb24gb3IgbnVsbCBpbnRvIHBuMy4gKi8KICAgICAg
ICAgTVVTVF9NQVRDSF9UT0tFTihUT0tfU0VNSSwgSlNNU0dfU0VNSV9BRlRFUl9GT1JfQ09ORCk7
CiAgICAgICAgIHR0ID0gdG9rZW5TdHJlYW0ucGVla1Rva2VuKFRTRl9PUEVSQU5EKTsKLSAgICAg
ICAgSlNQYXJzZU5vZGUgKnBuMzsKICAgICAgICAgaWYgKHR0ID09IFRPS19SUCkgewogICAgICAg
ICAgICAgcG4zID0gTlVMTDsKICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgIHBuMyA9IGV4
cHIoKTsKICAgICAgICAgICAgIGlmICghcG4zKQogICAgICAgICAgICAgICAgIHJldHVybiBOVUxM
OwogICAgICAgICB9CiAKLSAgICAgICAgLyogQnVpbGQgdGhlIEZPUkhFQUQgbm9kZSB0byB1c2Ug
YXMgdGhlIGxlZnQga2lkIG9mIHBuLiAqLwotICAgICAgICBKU1BhcnNlTm9kZSAqcG40ID0gVGVy
bmFyeU5vZGU6OmNyZWF0ZSh0Yyk7Ci0gICAgICAgIGlmICghcG40KQotICAgICAgICAgICAgcmV0
dXJuIE5VTEw7CiAgICAgICAgIHBuNC0+cG5fdHlwZSA9IFRPS19GT1JIRUFEOwotICAgICAgICBw
bjQtPnBuX29wID0gSlNPUF9OT1A7Ci0gICAgICAgIHBuNC0+cG5fa2lkMSA9IHBuMTsKLSAgICAg
ICAgcG40LT5wbl9raWQyID0gcG4yOwotICAgICAgICBwbjQtPnBuX2tpZDMgPSBwbjM7Ci0gICAg
ICAgIHBuLT5wbl9sZWZ0ID0gcG40OwotICAgIH0KKyAgICB9CisgICAgcG40LT5wbl9vcCA9IEpT
T1BfTk9QOworICAgIHBuNC0+cG5fa2lkMSA9IHBuMTsKKyAgICBwbjQtPnBuX2tpZDIgPSBwbjI7
CisgICAgcG40LT5wbl9raWQzID0gcG4zOworICAgIHBuLT5wbl9sZWZ0ID0gcG40OwogCiAgICAg
TVVTVF9NQVRDSF9UT0tFTihUT0tfUlAsIEpTTVNHX1BBUkVOX0FGVEVSX0ZPUl9DVFJMKTsKIAog
ICAgIC8qIFBhcnNlIHRoZSBsb29wIGJvZHkgaW50byBwbi0+cG5fcmlnaHQuICovCi0gICAgSlNQ
YXJzZU5vZGUgKnBuMjsKICAgICBwbjIgPSBzdGF0ZW1lbnQoKTsKICAgICBpZiAoIXBuMikKICAg
ICAgICAgcmV0dXJuIE5VTEw7CiAgICAgcG4tPnBuX3JpZ2h0ID0gcG4yOwogCiAgICAgLyogUmVj
b3JkIHRoZSBhYnNvbHV0ZSBsaW5lIG51bWJlciBmb3Igc291cmNlIG5vdGUgZW1pc3Npb24uICov
CiAgICAgcG4tPnBuX3Bvcy5lbmQgPSBwbjItPnBuX3Bvcy5lbmQ7CiAKQEAgLTUzNDcsMjAgKzUz
NTcsMTYgQEAgUGFyc2VyOjpmb3JTdGF0ZW1lbnQoKQogI2VuZGlmCiAgICAgaWYgKHBuc2VxKSB7
CiAgICAgICAgIHBuc2VxLT5wbl9wb3MuZW5kID0gcG4tPnBuX3Bvcy5lbmQ7CiAgICAgICAgIHBu
c2VxLT5hcHBlbmQocG4pOwogICAgICAgICBwbiA9IHBuc2VxOwogICAgIH0KICAgICBQb3BTdGF0
ZW1lbnQodGMpOwogICAgIHJldHVybiBwbjsKLQotICBiYWRfZm9yX2VhY2g6Ci0gICAgcmVwb3J0
RXJyb3JOdW1iZXIocG4sIEpTUkVQT1JUX0VSUk9SLCBKU01TR19CQURfRk9SX0VBQ0hfTE9PUCk7
Ci0gICAgcmV0dXJuIE5VTEw7CiB9CiAKIEpTUGFyc2VOb2RlICoKIFBhcnNlcjo6dHJ5U3RhdGVt
ZW50KCkKIHsKICAgICBKU1BhcnNlTm9kZSAqY2F0Y2hMaXN0LCAqbGFzdENhdGNoOwogCiAgICAg
LyoKQEAgLTY1MDEsODIgKzY1MDcsODkgQEAgUGFyc2VyOjpjb25kRXhwcjEoKQogICAgICAgICBw
bi0+cG5fa2lkMSA9IHBuMTsKICAgICAgICAgcG4tPnBuX2tpZDIgPSBwbjI7CiAgICAgICAgIHBu
LT5wbl9raWQzID0gcG4zOwogICAgICAgICB0b2tlblN0cmVhbS5nZXRUb2tlbigpOyAgICAgLyog
bmVlZCB0byByZWFkIG9uZSB0b2tlbiBwYXN0IHRoZSBlbmQgKi8KICAgICB9CiAgICAgcmV0dXJu
IHBuOwogfQogCi1KU1BhcnNlTm9kZSAqCi1QYXJzZXI6OmFzc2lnbkV4cHIoKQotewotICAgIEpT
X0NIRUNLX1JFQ1VSU0lPTihjb250ZXh0LCByZXR1cm4gTlVMTCk7Ci0KLSNpZiBKU19IQVNfR0VO
RVJBVE9SUwotICAgIGlmICh0b2tlblN0cmVhbS5tYXRjaFRva2VuKFRPS19ZSUVMRCwgVFNGX09Q
RVJBTkQpKQotICAgICAgICByZXR1cm4gcmV0dXJuT3JZaWVsZCh0cnVlKTsKLSNlbmRpZgotCi0g
ICAgSlNQYXJzZU5vZGUgKnBuID0gY29uZEV4cHIxKCk7Ci0gICAgaWYgKCFwbikKLSAgICAgICAg
cmV0dXJuIE5VTEw7Ci0KLSAgICBpZiAoIXRva2VuU3RyZWFtLmlzQ3VycmVudFRva2VuVHlwZShU
T0tfQVNTSUdOKSkgewotICAgICAgICB0b2tlblN0cmVhbS51bmdldFRva2VuKCk7Ci0gICAgICAg
IHJldHVybiBwbjsKLSAgICB9Ci0KLSAgICBKU09wIG9wID0gdG9rZW5TdHJlYW0uY3VycmVudFRv
a2VuKCkudF9vcDsKK2Jvb2wKK1BhcnNlcjo6c2V0QXNzaWdubWVudExoc09wcyhKU1BhcnNlTm9k
ZSAqcG4sIEpTT3Agb3ApCit7CiAgICAgc3dpdGNoIChwbi0+cG5fdHlwZSkgewogICAgICAgY2Fz
ZSBUT0tfTkFNRToKICAgICAgICAgaWYgKCFDaGVja1N0cmljdEFzc2lnbm1lbnQoY29udGV4dCwg
dGMsIHBuKSkKLSAgICAgICAgICAgIHJldHVybiBOVUxMOwotICAgICAgICBwbi0+cG5fb3AgPSBK
U09QX1NFVE5BTUU7CisgICAgICAgICAgICByZXR1cm4gZmFsc2U7CisgICAgICAgIHBuLT5wbl9v
cCA9IChwbi0+cG5fb3AgPT0gSlNPUF9HRVRMT0NBTCkgPyBKU09QX1NFVExPQ0FMIDogSlNPUF9T
RVROQU1FOwogICAgICAgICBOb3RlTFZhbHVlKGNvbnRleHQsIHBuLCB0Yyk7CiAgICAgICAgIGJy
ZWFrOwogICAgICAgY2FzZSBUT0tfRE9UOgogICAgICAgICBwbi0+cG5fb3AgPSBKU09QX1NFVFBS
T1A7CiAgICAgICAgIGJyZWFrOwogICAgICAgY2FzZSBUT0tfTEI6CiAgICAgICAgIHBuLT5wbl9v
cCA9IEpTT1BfU0VURUxFTTsKICAgICAgICAgYnJlYWs7CiAjaWYgSlNfSEFTX0RFU1RSVUNUVVJJ
TkcKICAgICAgIGNhc2UgVE9LX1JCOgogICAgICAgY2FzZSBUT0tfUkM6Ci0gICAgICB7CiAgICAg
ICAgIGlmIChvcCAhPSBKU09QX05PUCkgewogICAgICAgICAgICAgcmVwb3J0RXJyb3JOdW1iZXIo
TlVMTCwgSlNSRVBPUlRfRVJST1IsIEpTTVNHX0JBRF9ERVNUUlVDVF9BU1MpOwotICAgICAgICAg
ICAgcmV0dXJuIE5VTEw7Ci0gICAgICAgIH0KLSAgICAgICAgSlNQYXJzZU5vZGUgKnJocyA9IGFz
c2lnbkV4cHIoKTsKLSAgICAgICAgaWYgKCFyaHMgfHwgIUNoZWNrRGVzdHJ1Y3R1cmluZyhjb250
ZXh0LCBOVUxMLCBwbiwgdGMpKQotICAgICAgICAgICAgcmV0dXJuIE5VTEw7Ci0gICAgICAgIHJl
dHVybiBKU1BhcnNlTm9kZTo6bmV3QmluYXJ5T3JBcHBlbmQoVE9LX0FTU0lHTiwgb3AsIHBuLCBy
aHMsIHRjKTsKLSAgICAgIH0KKyAgICAgICAgICAgIHJldHVybiBmYWxzZTsKKyAgICAgICAgfQor
ICAgICAgICBpZiAoIUNoZWNrRGVzdHJ1Y3R1cmluZyhjb250ZXh0LCBOVUxMLCBwbiwgdGMpKQor
ICAgICAgICAgICAgcmV0dXJuIGZhbHNlOworICAgICAgICBicmVhazsKICNlbmRpZgogICAgICAg
Y2FzZSBUT0tfTFA6CiAgICAgICAgIGlmICghTWFrZVNldENhbGwoY29udGV4dCwgcG4sIHRjLCBK
U01TR19CQURfTEVGVFNJREVfT0ZfQVNTKSkKLSAgICAgICAgICAgIHJldHVybiBOVUxMOworICAg
ICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgICBicmVhazsKICNpZiBKU19IQVNfWE1MX1NV
UFBPUlQKICAgICAgIGNhc2UgVE9LX1VOQVJZT1A6CiAgICAgICAgIGlmIChwbi0+cG5fb3AgPT0g
SlNPUF9YTUxOQU1FKSB7CiAgICAgICAgICAgICBwbi0+cG5fb3AgPSBKU09QX1NFVFhNTE5BTUU7
CiAgICAgICAgICAgICBicmVhazsKICAgICAgICAgfQogICAgICAgICAvKiBGQUxMIFRIUk9VR0gg
Ki8KICNlbmRpZgogICAgICAgZGVmYXVsdDoKICAgICAgICAgcmVwb3J0RXJyb3JOdW1iZXIoTlVM
TCwgSlNSRVBPUlRfRVJST1IsIEpTTVNHX0JBRF9MRUZUU0lERV9PRl9BU1MpOworICAgICAgICBy
ZXR1cm4gZmFsc2U7CisgICAgfQorICAgIHJldHVybiB0cnVlOworfQorCitKU1BhcnNlTm9kZSAq
CitQYXJzZXI6OmFzc2lnbkV4cHIoKQoreworICAgIEpTX0NIRUNLX1JFQ1VSU0lPTihjb250ZXh0
LCByZXR1cm4gTlVMTCk7CisKKyNpZiBKU19IQVNfR0VORVJBVE9SUworICAgIGlmICh0b2tlblN0
cmVhbS5tYXRjaFRva2VuKFRPS19ZSUVMRCwgVFNGX09QRVJBTkQpKQorICAgICAgICByZXR1cm4g
cmV0dXJuT3JZaWVsZCh0cnVlKTsKKyNlbmRpZgorCisgICAgSlNQYXJzZU5vZGUgKnBuID0gY29u
ZEV4cHIxKCk7CisgICAgaWYgKCFwbikKICAgICAgICAgcmV0dXJuIE5VTEw7Ci0gICAgfQorCisg
ICAgaWYgKCF0b2tlblN0cmVhbS5pc0N1cnJlbnRUb2tlblR5cGUoVE9LX0FTU0lHTikpIHsKKyAg
ICAgICAgdG9rZW5TdHJlYW0udW5nZXRUb2tlbigpOworICAgICAgICByZXR1cm4gcG47CisgICAg
fQorCisgICAgSlNPcCBvcCA9IHRva2VuU3RyZWFtLmN1cnJlbnRUb2tlbigpLnRfb3A7CisgICAg
aWYgKCFzZXRBc3NpZ25tZW50TGhzT3BzKHBuLCBvcCkpCisgICAgICAgIHJldHVybiBOVUxMOwog
CiAgICAgSlNQYXJzZU5vZGUgKnJocyA9IGFzc2lnbkV4cHIoKTsKLSAgICBpZiAocmhzICYmIFBO
X1RZUEUocG4pID09IFRPS19OQU1FICYmIHBuLT5wbl91c2VkKSB7CisgICAgaWYgKCFyaHMpCisg
ICAgICAgIHJldHVybiBOVUxMOworICAgIGlmIChQTl9UWVBFKHBuKSA9PSBUT0tfTkFNRSAmJiBw
bi0+cG5fdXNlZCkgewogICAgICAgICBKU0RlZmluaXRpb24gKmRuID0gcG4tPnBuX2xleGRlZjsK
IAogICAgICAgICAvKgogICAgICAgICAgKiBJZiB0aGUgZGVmaW5pdGlvbiBpcyBub3QgZmxhZ2dl
ZCBhcyBhc3NpZ25lZCwgd2UgbXVzdCBoYXZlIGltcHV0ZWQKICAgICAgICAgICogdGhlIGluaXRp
YWxpemVkIGZsYWcgdG8gaXQsIHRvIG9wdGltaXplIGZvciBmbGF0IGNsb3N1cmVzLiBCdXQgdGhh
dAogICAgICAgICAgKiBvcHRpbWl6YXRpb24gdXNlcyBzb3VyY2UgY29vcmRpbmF0ZXMgdG8gY2hl
Y2sgZG9taW5hbmNlIHJlbGF0aW9ucywKICAgICAgICAgICogc28gd2UgbXVzdCBleHRlbmQgdGhl
IGVuZCBvZiB0aGUgZGVmaW5pdGlvbiB0byBjb3ZlciB0aGUgcmlnaHQtaGFuZAogICAgICAgICAg
KiBzaWRlIG9mIHRoaXMgYXNzaWdubWVudCwgaS5lLiwgdGhlIGluaXRpYWxpemVyLgpAQCAtODM3
MCwyMCArODM4MywxOSBAQCBQYXJzZXI6OnByaW1hcnlFeHByKFRva2VuS2luZCB0dCwgSlNCb29s
CiAgICAgICAgICAgICAgKgogICAgICAgICAgICAgICogICBKU09QX0VOVEVSQkxPQ0sgPG8+IC4u
LiBKU09QX0xFQVZFQkxPQ0sgPG4+CiAgICAgICAgICAgICAgKgogICAgICAgICAgICAgICogd2hl
cmUgPG8+IGlzIGEgbGl0ZXJhbCBvYmplY3QgcmVwcmVzZW50aW5nIHRoZSBibG9jayBzY29wZSwK
ICAgICAgICAgICAgICAqIHdpdGggPG4+IHByb3BlcnRpZXMsIG5hbWluZyBlYWNoIHZhciBkZWNs
YXJlZCBpbiB0aGUgYmxvY2suCiAgICAgICAgICAgICAgKgogICAgICAgICAgICAgICogRWFjaCB2
YXIgZGVjbGFyYXRpb24gaW4gYSBsZXQtYmxvY2sgYmluZHMgYSBuYW1lIGluIDxvPiBhdAogICAg
ICAgICAgICAgICogY29tcGlsZSB0aW1lLCBhbmQgYWxsb2NhdGVzIGEgc2xvdCBvbiB0aGUgb3Bl
cmFuZCBzdGFjayBhdAotICAgICAgICAgICAgICogcnVudGltZSB2aWEgSlNPUF9FTlRFUkJMT0NL
LiAgQSBibG9jay1sb2NhbCB2YXIgaXMgYWNjZXNzZWQKLSAgICAgICAgICAgICAqIGJ5IHRoZSBK
U09QX0dFVExPQ0FMIGFuZCBKU09QX1NFVExPQ0FMIG9wcywgYW5kIGl0ZXJhdGVkIHdpdGgKLSAg
ICAgICAgICAgICAqIEpTT1BfRk9STE9DQUwuICBUaGVzZSBvcHMgYWxsIGhhdmUgYW4gaW1tZWRp
YXRlIG9wZXJhbmQsIHRoZQotICAgICAgICAgICAgICogbG9jYWwgc2xvdCdzIHN0YWNrIGluZGV4
IGZyb20gZnAtPnNwYmFzZS4KKyAgICAgICAgICAgICAqIHJ1bnRpbWUgdmlhIEpTT1BfRU5URVJC
TE9DSy4gIEEgYmxvY2stbG9jYWwgdmFyIGlzIGFjY2Vzc2VkIGJ5CisgICAgICAgICAgICAgKiB0
aGUgSlNPUF9HRVRMT0NBTCBhbmQgSlNPUF9TRVRMT0NBTCBvcHMuICBUaGVzZSBvcHMgYWxsIGhh
dmUgYW4KKyAgICAgICAgICAgICAqIGltbWVkaWF0ZSBvcGVyYW5kLCB0aGUgbG9jYWwgc2xvdCdz
IHN0YWNrIGluZGV4IGZyb20gZnAtPnNwYmFzZS4KICAgICAgICAgICAgICAqCiAgICAgICAgICAg
ICAgKiBUaGUgYXJyYXkgY29tcHJlaGVuc2lvbiBpdGVyYXRpb24gc3RlcCwgYXJyYXkucHVzaChp
ICogaikgaW4KICAgICAgICAgICAgICAqIHRoZSBleGFtcGxlIGFib3ZlLCBpcyBkb25lIGJ5IDxp
ICogaj47IEpTT1BfQVJSQVlDT01QIDxhcnJheT4sCiAgICAgICAgICAgICAgKiB3aGVyZSA8YXJy
YXk+IGlzIHRoZSBpbmRleCBvZiBhcnJheSdzIHN0YWNrIHNsb3QuCiAgICAgICAgICAgICAgKi8K
ICAgICAgICAgICAgIGlmIChpbmRleCA9PSAwICYmIHBuLT5wbl9jb3VudCAhPSAwICYmIHRva2Vu
U3RyZWFtLm1hdGNoVG9rZW4oVE9LX0ZPUikpIHsKICAgICAgICAgICAgICAgICBKU1BhcnNlTm9k
ZSAqcG5leHAsICpwbnRvcDsKIApkaWZmIC0tZ2l0IGEvanMvc3JjL2pzcGFyc2UuaCBiL2pzL3Ny
Yy9qc3BhcnNlLmgKLS0tIGEvanMvc3JjL2pzcGFyc2UuaAorKysgYi9qcy9zcmMvanNwYXJzZS5o
CkBAIC0xMjE2LDE2ICsxMjE2LDE4IEBAIHByaXZhdGU6CiAgICAgSlNQYXJzZU5vZGUgKnhtbEV4
cHIoSlNCb29sIGluVGFnKTsKICAgICBKU1BhcnNlTm9kZSAqeG1sQXRvbU5vZGUoKTsKICAgICBK
U1BhcnNlTm9kZSAqeG1sTmFtZUV4cHIoKTsKICAgICBKU1BhcnNlTm9kZSAqeG1sVGFnQ29udGVu
dChqczo6VG9rZW5LaW5kIHRhZ3R5cGUsIEpTQXRvbSAqKm5hbWVwKTsKICAgICBKU0Jvb2wgeG1s
RWxlbWVudENvbnRlbnQoSlNQYXJzZU5vZGUgKnBuKTsKICAgICBKU1BhcnNlTm9kZSAqeG1sRWxl
bWVudE9yTGlzdChKU0Jvb2wgYWxsb3dMaXN0KTsKICAgICBKU1BhcnNlTm9kZSAqeG1sRWxlbWVu
dE9yTGlzdFJvb3QoSlNCb29sIGFsbG93TGlzdCk7CiAjZW5kaWYgLyogSlNfSEFTX1hNTF9TVVBQ
T1JUICovCisKKyAgICBib29sIHNldEFzc2lnbm1lbnRMaHNPcHMoSlNQYXJzZU5vZGUgKnBuLCBK
U09wIG9wKTsKIH07CiAKIGlubGluZSBib29sCiBQYXJzZXI6OnJlcG9ydEVycm9yTnVtYmVyKEpT
UGFyc2VOb2RlICpwbiwgdWludE4gZmxhZ3MsIHVpbnROIGVycm9yTnVtYmVyLCAuLi4pCiB7CiAg
ICAgdmFfbGlzdCBhcmdzOwogICAgIHZhX3N0YXJ0KGFyZ3MsIGVycm9yTnVtYmVyKTsKICAgICBi
b29sIHJlc3VsdCA9IHRva2VuU3RyZWFtLnJlcG9ydENvbXBpbGVFcnJvck51bWJlclZBKHBuLCBm
bGFncywgZXJyb3JOdW1iZXIsIGFyZ3MpOwpkaWZmIC0tZ2l0IGEvanMvc3JjL2pzcmVmbGVjdC5j
cHAgYi9qcy9zcmMvanNyZWZsZWN0LmNwcAotLS0gYS9qcy9zcmMvanNyZWZsZWN0LmNwcAorKysg
Yi9qcy9zcmMvanNyZWZsZWN0LmNwcApAQCAtMjE4OSwyMSArMjE4OSwyMSBAQCBBU1RTZXJpYWxp
emVyOjpzdGF0ZW1lbnQoSlNQYXJzZU5vZGUgKnBuCiAgICAgICAgIGlmICghc3RhdGVtZW50KHBu
LT5wbl9yaWdodCwgJnN0bXQpKQogICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogCiAgICAgICAg
IGJvb2wgaXNGb3JFYWNoID0gcG4tPnBuX2lmbGFncyAmIEpTSVRFUl9GT1JFQUNIOwogCiAgICAg
ICAgIGlmIChQTl9UWVBFKGhlYWQpID09IFRPS19JTikgewogICAgICAgICAgICAgVmFsdWUgdmFy
LCBleHByOwogCi0gICAgICAgICAgICByZXR1cm4gKFBOX1RZUEUoaGVhZC0+cG5fbGVmdCkgPT0g
VE9LX1ZBUgotICAgICAgICAgICAgICAgICAgICA/IHZhcmlhYmxlRGVjbGFyYXRpb24oaGVhZC0+
cG5fbGVmdCwgZmFsc2UsICZ2YXIpCi0gICAgICAgICAgICAgICAgICAgIDogUE5fVFlQRShoZWFk
LT5wbl9sZWZ0KSA9PSBUT0tfTEVUCi0gICAgICAgICAgICAgICAgICAgID8gdmFyaWFibGVEZWNs
YXJhdGlvbihoZWFkLT5wbl9sZWZ0LCB0cnVlLCAmdmFyKQotICAgICAgICAgICAgICAgICAgICA6
IHBhdHRlcm4oaGVhZC0+cG5fbGVmdCwgTlVMTCwgJnZhcikpICYmCisgICAgICAgICAgICByZXR1
cm4gKCFoZWFkLT5wbl9raWQxCisgICAgICAgICAgICAgICAgICAgID8gcGF0dGVybihoZWFkLT5w
bl9raWQyLCBOVUxMLCAmdmFyKQorICAgICAgICAgICAgICAgICAgICA6IHZhcmlhYmxlRGVjbGFy
YXRpb24oaGVhZC0+cG5fa2lkMSwKKyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgIFBOX1RZUEUoaGVhZC0+cG5fa2lkMSkgPT0gVE9LX0xFVCwKKyAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICZ2YXIpKSAmJgogICAgICAgICAgICAgICAgICAg
IGV4cHJlc3Npb24oaGVhZC0+cG5fcmlnaHQsICZleHByKSAmJgogICAgICAgICAgICAgICAgICAg
IGJ1aWxkZXIuZm9ySW5TdGF0ZW1lbnQodmFyLCBleHByLCBzdG10LCBpc0ZvckVhY2gsICZwbi0+
cG5fcG9zLCBkc3QpOwogICAgICAgICB9CiAKICAgICAgICAgVmFsdWUgaW5pdCwgdGVzdCwgdXBk
YXRlOwogCiAgICAgICAgIHJldHVybiBmb3JJbml0KGhlYWQtPnBuX2tpZDEsICZpbml0KSAmJgog
ICAgICAgICAgICAgICAgb3B0RXhwcmVzc2lvbihoZWFkLT5wbl9raWQyLCAmdGVzdCkgJiYKZGlm
ZiAtLWdpdCBhL2pzL3NyYy9qc3RyYWNlci5jcHAgYi9qcy9zcmMvanN0cmFjZXIuY3BwCi0tLSBh
L2pzL3NyYy9qc3RyYWNlci5jcHAKKysrIGIvanMvc3JjL2pzdHJhY2VyLmNwcApAQCAtMTQ4MDcs
MjAgKzE0ODA3LDIwIEBAIFRyYWNlUmVjb3JkZXI6OnJlY29yZF9KU09QX01PUkVJVEVSKCkKIAog
ICAgIFJFVFVSTl9JRl9YTUxfQShpdGVyb2JqX3ZhbCk7CiAKICAgICBKU09iamVjdCogaXRlcm9i
aiA9ICZpdGVyb2JqX3ZhbC50b09iamVjdCgpOwogICAgIExJbnMqIGl0ZXJvYmpfaW5zID0gZ2V0
KCZpdGVyb2JqX3ZhbCk7CiAgICAgTElucyogY29uZF9pbnM7CiAKICAgICAvKgotICAgICAqIEpT
T1BfRk9SKiBhbHJlYWR5IGd1YXJkcyBvbiB0aGlzLCBidXQgaW4gY2VydGFpbiByYXJlIGNhc2Vz
IHdlIG1pZ2h0CisgICAgICogSlNPUF9JVEVSTkVYVCBhbHJlYWR5IGd1YXJkcyBvbiB0aGlzLCBi
dXQgaW4gY2VydGFpbiByYXJlIGNhc2VzIHdlIG1pZ2h0CiAgICAgICogcmVjb3JkIG1pc2Zvcm1l
ZCBsb29wIHRyYWNlcy4gTm90ZSB0aGF0IGl0J3Mgbm90IG5lY2Vzc2FyeSB0byBndWFyZCBvbgot
ICAgICAqIG5pLT5mbGFncyAobm9yIGRvIHdlIGluIHVuYm94TmV4dFZhbHVlKSwgYmVjYXVzZSB0
aGUgZGlmZmVyZW50Ci0gICAgICogaXRlcmF0aW9uIHR5cGUgd2lsbCBndWFyYW50ZWUgYSBkaWZm
ZXJlbnQgZW50cnkgdHlwZW1hcC4KKyAgICAgKiBuaS0+ZmxhZ3MgKG5vciBkbyB3ZSBpbiB1bmJv
eE5leHRWYWx1ZSksIGJlY2F1c2UgdGhlIGRpZmZlcmVudCBpdGVyYXRpb24KKyAgICAgKiB0eXBl
IHdpbGwgZ3VhcmFudGVlIGEgZGlmZmVyZW50IGVudHJ5IHR5cGVtYXAuCiAgICAgICovCiAgICAg
aWYgKGl0ZXJvYmotPmhhc0NsYXNzKCZqc19JdGVyYXRvckNsYXNzKSkgewogICAgICAgICBndWFy
ZENsYXNzKGl0ZXJvYmpfaW5zLCAmanNfSXRlcmF0b3JDbGFzcywgc25hcHNob3QoQlJBTkNIX0VY
SVQpLCBMT0FEX05PUk1BTCk7CiAKICAgICAgICAgTmF0aXZlSXRlcmF0b3IgKm5pID0gKE5hdGl2
ZUl0ZXJhdG9yICopIGl0ZXJvYmotPmdldFByaXZhdGUoKTsKICAgICAgICAgaWYgKG5pLT5pc0tl
eUl0ZXIoKSkgewogICAgICAgICAgICAgTElucyAqbmlfaW5zID0gdy5sZHBPYmpQcml2YXRlKGl0
ZXJvYmpfaW5zKTsKICAgICAgICAgICAgIExJbnMgKmN1cnNvcl9pbnMgPSB3LmxkcEl0ZXJDdXJz
b3IobmlfaW5zKTsKQEAgLTE0ODQ3LDE2ICsxNDg0NywyNiBAQCBUcmFjZVJlY29yZGVyOjpyZWNv
cmRfSlNPUF9NT1JFSVRFUigpCiAKICAgICAvLyBXcml0ZSB0aGlzIHZhbHVlIGJhY2sgZXZlbiB0
aG91Z2ggd2UgaGF2ZW4ndCBjaGFuZ2VkIGl0LgogICAgIC8vIFNlZSB0aGUgY29tbWVudCBpbiBE
ZWVwQmFpbCBhYm91dCAiY2xvYmJlcmluZyBkZWVwIGJhaWxzIi4KICAgICBzdGFjaygtMSwgaXRl
cm9ial9pbnMpOwogCiAgICAgcmV0dXJuIEFSRUNPUkRfQ09OVElOVUU7CiB9CiAKK0pTX1JFUVVJ
UkVTX1NUQUNLIEFib3J0YWJsZVJlY29yZGluZ1N0YXR1cworVHJhY2VSZWNvcmRlcjo6cmVjb3Jk
X0pTT1BfSVRFUk5FWFQoKQoreworICAgIExJbnMqIHZfaW5zOworICAgIFZhbHVlICZpdGVyb2Jq
X3ZhbCA9IHN0YWNrdmFsKC1HRVRfSU5UOChjeC0+cmVncy0+cGMpKTsKKyAgICBDSEVDS19TVEFU
VVNfQSh1bmJveE5leHRWYWx1ZShpdGVyb2JqX3ZhbCwgdl9pbnMpKTsKKyAgICBzdGFjaygwLCB2
X2lucyk7CisgICAgcmV0dXJuIEFSRUNPUkRfQ09OVElOVUU7Cit9CisKIHN0YXRpYyBKU0Jvb2wg
RkFTVENBTEwKIENsb3NlSXRlcmF0b3IoSlNDb250ZXh0ICpjeCwgSlNPYmplY3QgKml0ZXJvYmop
CiB7CiAgICAgVHJhY2VNb25pdG9yICp0bSA9IEpTX1RSQUNFX01PTklUT1JfT05fVFJBQ0UoY3gp
OwogCiAgICAgaWYgKCFqc19DbG9zZUl0ZXJhdG9yKGN4LCBpdGVyb2JqKSkgewogICAgICAgICBT
ZXRCdWlsdGluRXJyb3IodG0pOwogICAgICAgICByZXR1cm4gZmFsc2U7CkBAIC0xNDg5NiwxOSAr
MTQ5MDYsMTggQEAgSlNfUkVRVUlSRVNfU1RBQ0sgdm9pZAogVHJhY2VSZWNvcmRlcjo6c3RvcmVN
YWdpYyhKU1doeU1hZ2ljIHdoeSwgQWRkcmVzcyBhZGRyKQogewogICAgIExJbnMgKm1hZ2ljID0g
dy5uYW1lSW1tcShCVUlMRF9KU1ZBTChKU1ZBTF9UQUdfTUFHSUMsIHdoeSkpOwogICAgIHcuc3Rx
KG1hZ2ljLCBhZGRyKTsKIH0KICNlbmRpZgogCiBKU19SRVFVSVJFU19TVEFDSyBBYm9ydGFibGVS
ZWNvcmRpbmdTdGF0dXMKLVRyYWNlUmVjb3JkZXI6OnVuYm94TmV4dFZhbHVlKExJbnMqICZ2X2lu
cykKLXsKLSAgICBWYWx1ZSAmaXRlcm9ial92YWwgPSBzdGFja3ZhbCgtMSk7CitUcmFjZVJlY29y
ZGVyOjp1bmJveE5leHRWYWx1ZShWYWx1ZSAmaXRlcm9ial92YWwsIExJbnMqICZ2X2lucykKK3sK
ICAgICBKU09iamVjdCAqaXRlcm9iaiA9ICZpdGVyb2JqX3ZhbC50b09iamVjdCgpOwogICAgIExJ
bnMqIGl0ZXJvYmpfaW5zID0gZ2V0KCZpdGVyb2JqX3ZhbCk7CiAKICAgICBpZiAoaXRlcm9iai0+
aGFzQ2xhc3MoJmpzX0l0ZXJhdG9yQ2xhc3MpKSB7CiAgICAgICAgIGd1YXJkQ2xhc3MoaXRlcm9i
al9pbnMsICZqc19JdGVyYXRvckNsYXNzLCBzbmFwc2hvdChCUkFOQ0hfRVhJVCksIExPQURfTk9S
TUFMKTsKICAgICAgICAgTmF0aXZlSXRlcmF0b3IgKm5pID0gKE5hdGl2ZUl0ZXJhdG9yICopIGl0
ZXJvYmotPmdldFByaXZhdGUoKTsKIAogICAgICAgICBMSW5zICpuaV9pbnMgPSB3LmxkcE9ialBy
aXZhdGUoaXRlcm9ial9pbnMpOwpAQCAtMTQ5NTgsNzAgKzE0OTY3LDE2IEBAIFRyYWNlUmVjb3Jk
ZXI6OnVuYm94TmV4dFZhbHVlKExJbnMqICZ2X2kKICAgICBBZGRyZXNzIGl0ZXJWYWx1ZUFkZHIg
PSBDeEFkZHJlc3MoaXRlclZhbHVlKTsKICAgICB2X2lucyA9IHVuYm94X3ZhbHVlKGN4LT5pdGVy
VmFsdWUsIGl0ZXJWYWx1ZUFkZHIsIHNuYXBzaG90KEJSQU5DSF9FWElUKSk7CiAgICAgc3RvcmVN
YWdpYyhKU19OT19JVEVSX1ZBTFVFLCBpdGVyVmFsdWVBZGRyKTsKIAogICAgIHJldHVybiBBUkVD
T1JEX0NPTlRJTlVFOwogfQogCiBKU19SRVFVSVJFU19TVEFDSyBBYm9ydGFibGVSZWNvcmRpbmdT
dGF0dXMKLVRyYWNlUmVjb3JkZXI6OnJlY29yZF9KU09QX0ZPUk5BTUUoKQotewotICAgIFZhbHVl
KiB2cDsKLSAgICBMSW5zKiB4X2luczsKLSAgICBOYW1lUmVzdWx0IG5yOwotICAgIENIRUNLX1NU
QVRVU19BKG5hbWUodnAsIHhfaW5zLCBucikpOwotICAgIGlmICghbnIudHJhY2tlZCkKLSAgICAg
ICAgUkVUVVJOX1NUT1BfQSgiZm9ybmFtZSBvbiBub24tdHJhY2tlZCB2YWx1ZSBub3Qgc3VwcG9y
dGVkIik7Ci0gICAgTElucyogdl9pbnM7Ci0gICAgQ0hFQ0tfU1RBVFVTX0EodW5ib3hOZXh0VmFs
dWUodl9pbnMpKTsKLSAgICBzZXQodnAsIHZfaW5zKTsKLSAgICByZXR1cm4gQVJFQ09SRF9DT05U
SU5VRTsKLX0KLQotSlNfUkVRVUlSRVNfU1RBQ0sgQWJvcnRhYmxlUmVjb3JkaW5nU3RhdHVzCi1U
cmFjZVJlY29yZGVyOjpyZWNvcmRfSlNPUF9GT1JHTkFNRSgpCi17Ci0gICAgcmV0dXJuIHJlY29y
ZF9KU09QX0ZPUk5BTUUoKTsKLX0KLQotSlNfUkVRVUlSRVNfU1RBQ0sgQWJvcnRhYmxlUmVjb3Jk
aW5nU3RhdHVzCi1UcmFjZVJlY29yZGVyOjpyZWNvcmRfSlNPUF9GT1JQUk9QKCkKLXsKLSAgICBy
ZXR1cm4gQVJFQ09SRF9TVE9QOwotfQotCi1KU19SRVFVSVJFU19TVEFDSyBBYm9ydGFibGVSZWNv
cmRpbmdTdGF0dXMKLVRyYWNlUmVjb3JkZXI6OnJlY29yZF9KU09QX0ZPUkVMRU0oKQotewotICAg
IExJbnMqIHZfaW5zOwotICAgIENIRUNLX1NUQVRVU19BKHVuYm94TmV4dFZhbHVlKHZfaW5zKSk7
Ci0gICAgc3RhY2soMCwgdl9pbnMpOwotICAgIHJldHVybiBBUkVDT1JEX0NPTlRJTlVFOwotfQot
Ci1KU19SRVFVSVJFU19TVEFDSyBBYm9ydGFibGVSZWNvcmRpbmdTdGF0dXMKLVRyYWNlUmVjb3Jk
ZXI6OnJlY29yZF9KU09QX0ZPUkFSRygpCi17Ci0gICAgTElucyogdl9pbnM7Ci0gICAgQ0hFQ0tf
U1RBVFVTX0EodW5ib3hOZXh0VmFsdWUodl9pbnMpKTsKLSAgICBhcmcoR0VUX0FSR05PKGN4LT5y
ZWdzLT5wYyksIHZfaW5zKTsKLSAgICByZXR1cm4gQVJFQ09SRF9DT05USU5VRTsKLX0KLQotSlNf
UkVRVUlSRVNfU1RBQ0sgQWJvcnRhYmxlUmVjb3JkaW5nU3RhdHVzCi1UcmFjZVJlY29yZGVyOjpy
ZWNvcmRfSlNPUF9GT1JMT0NBTCgpCi17Ci0gICAgTElucyogdl9pbnM7Ci0gICAgQ0hFQ0tfU1RB
VFVTX0EodW5ib3hOZXh0VmFsdWUodl9pbnMpKTsKLSAgICB2YXIoR0VUX1NMT1ROTyhjeC0+cmVn
cy0+cGMpLCB2X2lucyk7Ci0gICAgcmV0dXJuIEFSRUNPUkRfQ09OVElOVUU7Ci19Ci0KLUpTX1JF
UVVJUkVTX1NUQUNLIEFib3J0YWJsZVJlY29yZGluZ1N0YXR1cwogVHJhY2VSZWNvcmRlcjo6cmVj
b3JkX0pTT1BfUE9QTigpCiB7CiAgICAgcmV0dXJuIEFSRUNPUkRfQ09OVElOVUU7CiB9CiAKIHN0
YXRpYyBpbmxpbmUgYm9vbAogSXNGaW5kYWJsZUNhbGxPYmooSlNPYmplY3QgKm9iaikKIHsKQEAg
LTE2NTU0LDE2ICsxNjUwOSwyOSBAQCBUcmFjZVJlY29yZGVyOjpyZWNvcmRfSlNPUF9DQUxMR05B
TUUoKQogICAgIH0KIAogREJHX1NUVUIoSlNPUF9HRVRVUFZBUl9EQkcpCiBEQkdfU1RVQihKU09Q
X0NBTExVUFZBUl9EQkcpCiBEQkdfU1RVQihKU09QX0RFRkZVTl9EQkdGQykKIERCR19TVFVCKEpT
T1BfREVGTE9DQUxGVU5fREJHRkMpCiBEQkdfU1RVQihKU09QX0xBTUJEQV9EQkdGQykKIAorI2Rl
ZmluZSBVTlVTRURfU1RVQihPUCkgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgXAorICAgIEpTX1JFUVVJUkVTX1NUQUNLIEFib3J0YWJsZVJlY29y
ZGluZ1N0YXR1cyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgXAorICAgIFRyYWNlUmVj
b3JkZXI6OnJlY29yZF8jI09QKCkgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgXAorICAgIHsgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgXAorICAgICAgICBKU19OT1RfUkVBQ0hF
RCgjT1ApOyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
XAorICAgICAgICByZXR1cm4gQVJFQ09SRF9FUlJPUjsgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgXAorICAgIH0KKworVU5VU0VEX1NUVUIoSlNPUF9VTlVT
RUQxMSkKK1VOVVNFRF9TVFVCKEpTT1BfVU5VU0VEMTA2KQorVU5VU0VEX1NUVUIoSlNPUF9VTlVT
RUQxMDcpCitVTlVTRURfU1RVQihKU09QX1VOVVNFRDEwOCkKKwogI2lmZGVmIEpTX0pJVF9TUEVX
CiAvKgogICogUHJpbnQgaW5mb3JtYXRpb24gYWJvdXQgZW50cnkgdHlwZW1hcHMgYW5kIHVuc3Rh
YmxlIGV4aXRzIGZvciBhbGwgcGVlcnMKICAqIGF0IGEgUEMuCiAgKi8KIHZvaWQKIER1bXBQZWVy
U3RhYmlsaXR5KFRyYWNlTW9uaXRvciogdG0sIGNvbnN0IHZvaWQqIGlwLCBKU09iamVjdCogZ2xv
YmFsT2JqLCB1aW50MzIgZ2xvYmFsU2hhcGUsCiAgICAgICAgICAgICAgICAgICB1aW50MzIgYXJn
YykKZGlmZiAtLWdpdCBhL2pzL3NyYy9qc3RyYWNlci5oIGIvanMvc3JjL2pzdHJhY2VyLmgKLS0t
IGEvanMvc3JjL2pzdHJhY2VyLmgKKysrIGIvanMvc3JjL2pzdHJhY2VyLmgKQEAgLTEzNjgsMTcg
KzEzNjgsMTggQEAgY2xhc3MgVHJhY2VSZWNvcmRlcgogICAgIEpTX1JFUVVJUkVTX1NUQUNLIG5h
bm9qaXQ6OkxJbnMgKmNhbm9uaWNhbGl6ZU5hTnMobmFub2ppdDo6TElucyAqZHZhbF9pbnMpOwog
ICAgIEpTX1JFUVVJUkVTX1NUQUNLIEFib3J0YWJsZVJlY29yZGluZ1N0YXR1cyB0eXBlZEFycmF5
RWxlbWVudChWYWx1ZSYgb3ZhbCwgVmFsdWUmIGlkeCwgVmFsdWUqJiB2cCwKICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbmFu
b2ppdDo6TElucyomIHZfaW5zKTsKICAgICBKU19SRVFVSVJFU19TVEFDSyBBYm9ydGFibGVSZWNv
cmRpbmdTdGF0dXMgZ2V0UHJvcChKU09iamVjdCogb2JqLCBuYW5vaml0OjpMSW5zKiBvYmpfaW5z
KTsKICAgICBKU19SRVFVSVJFU19TVEFDSyBBYm9ydGFibGVSZWNvcmRpbmdTdGF0dXMgZ2V0UHJv
cChWYWx1ZSYgdik7CiAgICAgSlNfUkVRVUlSRVNfU1RBQ0sgUmVjb3JkaW5nU3RhdHVzIGdldFRo
aXMobmFub2ppdDo6TElucyomIHRoaXNfaW5zKTsKIAogICAgIEpTX1JFUVVJUkVTX1NUQUNLIHZv
aWQgc3RvcmVNYWdpYyhKU1doeU1hZ2ljIHdoeSwgdGppdDo6QWRkcmVzcyBhZGRyKTsKLSAgICBK
U19SRVFVSVJFU19TVEFDSyBBYm9ydGFibGVSZWNvcmRpbmdTdGF0dXMgdW5ib3hOZXh0VmFsdWUo
bmFub2ppdDo6TElucyogJnZfaW5zKTsKKyAgICBKU19SRVFVSVJFU19TVEFDSyBBYm9ydGFibGVS
ZWNvcmRpbmdTdGF0dXMgdW5ib3hOZXh0VmFsdWUoVmFsdWUgJml0ZXJvYmpfdmFsLAorICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBu
YW5vaml0OjpMSW5zKiAmdl9pbnMpOwogCiAgICAgSlNfUkVRVUlSRVNfU1RBQ0sgVk1TaWRlRXhp
dCogZW50ZXJEZWVwQmFpbENhbGwoKTsKICAgICBKU19SRVFVSVJFU19TVEFDSyB2b2lkIGxlYXZl
RGVlcEJhaWxDYWxsKCk7CiAKICAgICBKU19SRVFVSVJFU19TVEFDSyBSZWNvcmRpbmdTdGF0dXMg
cHJpbWl0aXZlVG9TdHJpbmdJblBsYWNlKFZhbHVlKiB2cCk7CiAgICAgSlNfUkVRVUlSRVNfU1RB
Q0sgdm9pZCBmaW5pc2hHZXRQcm9wKG5hbm9qaXQ6OkxJbnMqIG9ial9pbnMsIG5hbm9qaXQ6OkxJ
bnMqIHZwX2lucywKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbmFu
b2ppdDo6TElucyogb2tfaW5zLCBWYWx1ZSogb3V0cCk7CiAgICAgSlNfUkVRVUlSRVNfU1RBQ0sg
UmVjb3JkaW5nU3RhdHVzIGdldFByb3BlcnR5QnlOYW1lKG5hbm9qaXQ6OkxJbnMqIG9ial9pbnMs
IFZhbHVlKiBpZHZhbHAsCmRpZmYgLS1naXQgYS9qcy9zcmMvanN4ZHJhcGkuaCBiL2pzL3NyYy9q
c3hkcmFwaS5oCi0tLSBhL2pzL3NyYy9qc3hkcmFwaS5oCisrKyBiL2pzL3NyYy9qc3hkcmFwaS5o
CkBAIC0yMjYsMTcgKzIyNiwxNyBAQCBKU19YRFJGaW5kQ2xhc3NCeUlkKEpTWERSU3RhdGUgKnhk
ciwgdWluCiAgKiBCeXRlY29kZSB2ZXJzaW9uIG51bWJlci4gSW5jcmVtZW50IHRoZSBzdWJ0cmFo
ZW5kIHdoZW5ldmVyIEpTIGJ5dGVjb2RlCiAgKiBjaGFuZ2VzIGluY29tcGF0aWJseS4KICAqCiAg
KiBUaGlzIHZlcnNpb24gbnVtYmVyIHNob3VsZCBiZSBYRFInZWQgb25jZSBuZWFyIHRoZSBmcm9u
dCBvZiBhbnkgZmlsZSBvcgogICogbGFyZ2VyIHN0b3JhZ2UgdW5pdCBjb250YWluaW5nIFhEUidl
ZCBieXRlY29kZSBhbmQgb3RoZXIgZGF0YSwgYW5kIGNoZWNrZWQKICAqIGJlZm9yZSBkZXNlcmlh
bGl6YXRpb24gb2YgYnl0ZWNvZGUuICBJZiB0aGUgc2F2ZWQgdmVyc2lvbiBkb2VzIG5vdCBtYXRj
aAogICogdGhlIGN1cnJlbnQgdmVyc2lvbiwgYWJvcnQgZGVzZXJpYWxpemF0aW9uIGFuZCBpbnZh
bGlkYXRlIHRoZSBmaWxlLgogICovCi0jZGVmaW5lIEpTWERSX0JZVEVDT0RFX1ZFUlNJT04gICAg
ICAoMHhiOTczYzBkZSAtIDg1KQorI2RlZmluZSBKU1hEUl9CWVRFQ09ERV9WRVJTSU9OICAgICAg
KDB4Yjk3M2MwZGUgLSA4NikKIAogLyoKICAqIExpYnJhcnktcHJpdmF0ZSBmdW5jdGlvbnMuCiAg
Ki8KIGV4dGVybiBKU0Jvb2wKIGpzX1hEUkF0b20oSlNYRFJTdGF0ZSAqeGRyLCBKU0F0b20gKiph
dG9tcCk7CiAKIEpTX0VORF9FWFRFUk5fQwpkaWZmIC0tZ2l0IGEvanMvc3JjL21ldGhvZGppdC9D
b21waWxlci5jcHAgYi9qcy9zcmMvbWV0aG9kaml0L0NvbXBpbGVyLmNwcAotLS0gYS9qcy9zcmMv
bWV0aG9kaml0L0NvbXBpbGVyLmNwcAorKysgYi9qcy9zcmMvbWV0aG9kaml0L0NvbXBpbGVyLmNw
cApAQCAtMTAwOSwyNyArMTAwOSwxOSBAQCBtaml0OjpDb21waWxlcjo6Z2VuZXJhdGVNZXRob2Qo
KQogICAgICAgICAgICAgICovCiAgICAgICAgICAgICBpZiAoY2FuVXNlQXBwbHlUcmlja3MoKSkK
ICAgICAgICAgICAgICAgICBhcHBseVRyaWNrcyA9IExhenlBcmdzT2JqOwogICAgICAgICAgICAg
ZWxzZQogICAgICAgICAgICAgICAgIGpzb3BfYXJndW1lbnRzKCk7CiAgICAgICAgICAgICBmcmFt
ZS5wdXNoU3luY2VkKCk7CiAgICAgICAgICAgRU5EX0NBU0UoSlNPUF9BUkdVTUVOVFMpCiAKLSAg
ICAgICAgICBCRUdJTl9DQVNFKEpTT1BfRk9SQVJHKQotICAgICAgICAgICAgaXRlck5leHQoKTsK
LSAgICAgICAgICAgIGZyYW1lLnN0b3JlQXJnKEdFVF9TTE9UTk8oUEMpLCB0cnVlKTsKLSAgICAg
ICAgICAgIGZyYW1lLnBvcCgpOwotICAgICAgICAgIEVORF9DQVNFKEpTT1BfRk9SQVJHKQotCi0g
ICAgICAgICAgQkVHSU5fQ0FTRShKU09QX0ZPUkxPQ0FMKQotICAgICAgICAgICAgaXRlck5leHQo
KTsKLSAgICAgICAgICAgIGZyYW1lLnN0b3JlTG9jYWwoR0VUX1NMT1ROTyhQQyksIHRydWUpOwot
ICAgICAgICAgICAgZnJhbWUucG9wKCk7Ci0gICAgICAgICAgRU5EX0NBU0UoSlNPUF9GT1JMT0NB
TCkKKyAgICAgICAgICBCRUdJTl9DQVNFKEpTT1BfSVRFUk5FWFQpCisgICAgICAgICAgICBpdGVy
TmV4dChQQ1sxXSk7CisgICAgICAgICAgRU5EX0NBU0UoSlNPUF9JVEVSTkVYVCkKIAogICAgICAg
ICAgIEJFR0lOX0NBU0UoSlNPUF9EVVApCiAgICAgICAgICAgICBmcmFtZS5kdXAoKTsKICAgICAg
ICAgICBFTkRfQ0FTRShKU09QX0RVUCkKIAogICAgICAgICAgIEJFR0lOX0NBU0UoSlNPUF9EVVAy
KQogICAgICAgICAgICAgZnJhbWUuZHVwMigpOwogICAgICAgICAgIEVORF9DQVNFKEpTT1BfRFVQ
MikKQEAgLTE2NDUsMzQgKzE2MzcsMTYgQEAgbWppdDo6Q29tcGlsZXI6OmdlbmVyYXRlTWV0aG9k
KCkKICAgICAgICAgICAgIGpzb3BfbG9jYWxpbmMob3AsIEdFVF9TTE9UTk8oUEMpLCBwb3BwZWQp
OwogICAgICAgICAgICAgUEMgKz0gSlNPUF9MT0NBTElOQ19MRU5HVEg7CiAgICAgICAgICAgICBp
ZiAocG9wcGVkKQogICAgICAgICAgICAgICAgIFBDICs9IEpTT1BfUE9QX0xFTkdUSDsKICAgICAg
ICAgICAgIGJyZWFrOwogICAgICAgICAgIH0KICAgICAgICAgICBFTkRfQ0FTRShKU09QX0xPQ0FM
REVDKQogCi0gICAgICAgICAgQkVHSU5fQ0FTRShKU09QX0ZPUk5BTUUpCi0gICAgICAgICAgICBq
c29wX2Zvcm5hbWUoc2NyaXB0LT5nZXRBdG9tKGZ1bGxBdG9tSW5kZXgoUEMpKSk7Ci0gICAgICAg
ICAgRU5EX0NBU0UoSlNPUF9GT1JOQU1FKQotCi0gICAgICAgICAgQkVHSU5fQ0FTRShKU09QX0ZP
UkdOQU1FKQotICAgICAgICAgICAganNvcF9mb3JnbmFtZShzY3JpcHQtPmdldEF0b20oZnVsbEF0
b21JbmRleChQQykpKTsKLSAgICAgICAgICBFTkRfQ0FTRShKU09QX0ZPUkdOQU1FKQotCi0gICAg
ICAgICAgQkVHSU5fQ0FTRShKU09QX0ZPUlBST1ApCi0gICAgICAgICAgICBqc29wX2ZvcnByb3Ao
c2NyaXB0LT5nZXRBdG9tKGZ1bGxBdG9tSW5kZXgoUEMpKSk7Ci0gICAgICAgICAgRU5EX0NBU0Uo
SlNPUF9GT1JQUk9QKQotCi0gICAgICAgICAgQkVHSU5fQ0FTRShKU09QX0ZPUkVMRU0pCi0gICAg
ICAgICAgICAvLyBUaGlzIG9wY29kZSBpcyBmb3IgdGhlIGRlY29tcGlsZXI7IGl0IGlzIHN1Y2Nl
ZWRlZCBieSBhbgotICAgICAgICAgICAgLy8gRU5VTUVMRU0sIHdoaWNoIHBlcmZvcm1zIHRoZSBh
Y3R1YWwgYXJyYXkgc3RvcmUuCi0gICAgICAgICAgICBpdGVyTmV4dCgpOwotICAgICAgICAgIEVO
RF9DQVNFKEpTT1BfRk9SRUxFTSkKLQogICAgICAgICAgIEJFR0lOX0NBU0UoSlNPUF9CSU5ETkFN
RSkKICAgICAgICAgICAgIGpzb3BfYmluZG5hbWUoc2NyaXB0LT5nZXRBdG9tKGZ1bGxBdG9tSW5k
ZXgoUEMpKSwgdHJ1ZSk7CiAgICAgICAgICAgRU5EX0NBU0UoSlNPUF9CSU5ETkFNRSkKIAogICAg
ICAgICAgIEJFR0lOX0NBU0UoSlNPUF9TRVRQUk9QKQogICAgICAgICAgICAgaWYgKCFqc29wX3Nl
dHByb3Aoc2NyaXB0LT5nZXRBdG9tKGZ1bGxBdG9tSW5kZXgoUEMpKSwgdHJ1ZSkpCiAgICAgICAg
ICAgICAgICAgcmV0dXJuIENvbXBpbGVfRXJyb3I7CiAgICAgICAgICAgRU5EX0NBU0UoSlNPUF9T
RVRQUk9QKQpAQCAtNDExMCwyMyArNDA4NCwyMyBAQCBtaml0OjpDb21waWxlcjo6aXRlcih1aW50
TiBmbGFncykKICAgICBmcmFtZS5wdXNoVHlwZWRQYXlsb2FkKEpTVkFMX1RZUEVfT0JKRUNULCBp
b3JlZyk7CiAKICAgICBzdHViY2MucmVqb2luKENoYW5nZXMoMSkpOwogCiAgICAgcmV0dXJuIHRy
dWU7CiB9CiAKIC8qCi0gKiBUaGlzIGJpZyBuYXN0eSBmdW5jdGlvbiBlbWl0cyBhIGZhc3QtcGF0
aCBmb3IgbmF0aXZlIGl0ZXJhdG9ycywgcHJvZHVjaW5nCi0gKiBhIHRlbXBvcmFyeSB2YWx1ZSBv
biB0aGUgc3RhY2sgZm9yIEZPUkxPQ0FMLEFSRyxHTE9CQUwsZXRjIG9wcyB0byB1c2UuCisgKiBU
aGlzIGJpZyBuYXN0eSBmdW5jdGlvbiBpbXBsZW1lbnRzIEpTT1BfSVRFUk5FWFQsIHdoaWNoIGlz
IHVzZWQgaW4gdGhlIGhlYWQKKyAqIG9mIGEgZm9yLWluIGxvb3AgdG8gcHV0IHRoZSBuZXh0IHZh
bHVlIG9uIHRoZSBzdGFjay4KICAqLwogdm9pZAotbWppdDo6Q29tcGlsZXI6Oml0ZXJOZXh0KCkK
K21qaXQ6OkNvbXBpbGVyOjppdGVyTmV4dChwdHJkaWZmX3Qgb2Zmc2V0KQogewotICAgIEZyYW1l
RW50cnkgKmZlID0gZnJhbWUucGVlaygtMSk7CisgICAgRnJhbWVFbnRyeSAqZmUgPSBmcmFtZS5w
ZWVrKC1vZmZzZXQpOwogICAgIFJlZ2lzdGVySUQgcmVnID0gZnJhbWUudGVtcFJlZ0ZvckRhdGEo
ZmUpOwogCiAgICAgLyogSXMgaXQgd29ydGggdHJ5aW5nIHRvIHBpbiB0aGlzIGxvbmdlcj8gUHJv
bGx5IG5vdC4gKi8KICAgICBmcmFtZS5waW5SZWcocmVnKTsKICAgICBSZWdpc3RlcklEIFQxID0g
ZnJhbWUuYWxsb2NSZWcoKTsKICAgICBmcmFtZS51bnBpblJlZyhyZWcpOwogCiAgICAgLyogVGVz
dCBjbGFzcCAqLwpAQCAtNDk5NCw3MCArNDk2OCw4IEBAIHZvaWQKIG1qaXQ6OkNvbXBpbGVyOjpq
c29wX2NhbGxlbGVtX3Nsb3coKQogewogICAgIHByZXBhcmVTdHViQ2FsbChVc2VzKDIpKTsKICAg
ICBJTkxJTkVfU1RVQkNBTEwoc3R1YnM6OkNhbGxFbGVtKTsKICAgICBmcmFtZS5wb3BuKDIpOwog
ICAgIGZyYW1lLnB1c2hTeW5jZWQoKTsKICAgICBmcmFtZS5wdXNoU3luY2VkKCk7CiB9Ci0KLXZv
aWQKLW1qaXQ6OkNvbXBpbGVyOjpqc29wX2ZvcnByb3AoSlNBdG9tICphdG9tKQotewotICAgIC8v
IEJlZm9yZTogSVRFUiBPQkoKLSAgICAvLyBBZnRlcjogIElURVIgT0JKIElURVIKLSAgICBmcmFt
ZS5kdXBBdCgtMik7Ci0KLSAgICAvLyBCZWZvcmU6IElURVIgT0JKIElURVIgCi0gICAgLy8gQWZ0
ZXI6ICBJVEVSIE9CSiBJVEVSIFZBTFVFCi0gICAgaXRlck5leHQoKTsKLQotICAgIC8vIEJlZm9y
ZTogSVRFUiBPQkogSVRFUiBWQUxVRQotICAgIC8vIEFmdGVyOiAgSVRFUiBPQkogVkFMVUUKLSAg
ICBmcmFtZS5zaGltbXkoMSk7Ci0KLSAgICAvLyBCZWZvcmU6IElURVIgT0JKIFZBTFVFCi0gICAg
Ly8gQWZ0ZXI6ICBJVEVSIFZBTFVFCi0gICAganNvcF9zZXRwcm9wKGF0b20sIGZhbHNlKTsKLQot
ICAgIC8vIEJlZm9yZTogSVRFUiBWQUxVRQotICAgIC8vIEFmdGVyOiAgSVRFUgotICAgIGZyYW1l
LnBvcCgpOwotfQotCi12b2lkCi1taml0OjpDb21waWxlcjo6anNvcF9mb3JuYW1lKEpTQXRvbSAq
YXRvbSkKLXsKLSAgICAvLyBCZWZvcmU6IElURVIKLSAgICAvLyBBZnRlcjogIElURVIgU0NPUEVP
QkoKLSAgICBqc29wX2JpbmRuYW1lKGF0b20sIGZhbHNlKTsKLSAgICBqc29wX2ZvcnByb3AoYXRv
bSk7Ci19Ci0KLXZvaWQKLW1qaXQ6OkNvbXBpbGVyOjpqc29wX2ZvcmduYW1lKEpTQXRvbSAqYXRv
bSkKLXsKLSAgICAvLyBCZWZvcmU6IElURVIKLSAgICAvLyBBZnRlcjogIElURVIgR0xPQkFMCi0g
ICAganNvcF9iaW5kZ25hbWUoKTsKLQotICAgIC8vIEJlZm9yZTogSVRFUiBHTE9CQUwKLSAgICAv
LyBBZnRlcjogIElURVIgR0xPQkFMIElURVIKLSAgICBmcmFtZS5kdXBBdCgtMik7Ci0KLSAgICAv
LyBCZWZvcmU6IElURVIgR0xPQkFMIElURVIgCi0gICAgLy8gQWZ0ZXI6ICBJVEVSIEdMT0JBTCBJ
VEVSIFZBTFVFCi0gICAgaXRlck5leHQoKTsKLQotICAgIC8vIEJlZm9yZTogSVRFUiBHTE9CQUwg
SVRFUiBWQUxVRQotICAgIC8vIEFmdGVyOiAgSVRFUiBHTE9CQUwgVkFMVUUKLSAgICBmcmFtZS5z
aGltbXkoMSk7Ci0KLSAgICAvLyBCZWZvcmU6IElURVIgR0xPQkFMIFZBTFVFCi0gICAgLy8gQWZ0
ZXI6ICBJVEVSIFZBTFVFCi0gICAganNvcF9zZXRnbmFtZShhdG9tLCBmYWxzZSk7Ci0KLSAgICAv
LyBCZWZvcmU6IElURVIgVkFMVUUKLSAgICAvLyBBZnRlcjogIElURVIKLSAgICBmcmFtZS5wb3Ao
KTsKLX0KLQpkaWZmIC0tZ2l0IGEvanMvc3JjL21ldGhvZGppdC9Db21waWxlci5oIGIvanMvc3Jj
L21ldGhvZGppdC9Db21waWxlci5oCi0tLSBhL2pzL3NyYy9tZXRob2RqaXQvQ29tcGlsZXIuaAor
KysgYi9qcy9zcmMvbWV0aG9kaml0L0NvbXBpbGVyLmgKQEAgLTQwMCwxNyArNDAwLDE3IEBAIGNs
YXNzIENvbXBpbGVyIDogcHVibGljIEJhc2VDb21waWxlcgogICAgIGJvb2wganVtcEluU2NyaXB0
KEp1bXAgaiwganNieXRlY29kZSAqcGMpOwogICAgIGJvb2wgY29tcGFyZVR3b1ZhbHVlcyhKU0Nv
bnRleHQgKmN4LCBKU09wIG9wLCBjb25zdCBWYWx1ZSAmbGhzLCBjb25zdCBWYWx1ZSAmcmhzKTsK
ICAgICBib29sIGNhblVzZUFwcGx5VHJpY2tzKCk7CiAKICAgICAvKiBFbWl0dGluZyBoZWxwZXJz
LiAqLwogICAgIHZvaWQgcmVzdG9yZUZyYW1lUmVncyhBc3NlbWJsZXIgJm1hc20pOwogICAgIGJv
b2wgZW1pdFN0dWJDbXBPcChCb29sU3R1YiBzdHViLCBqc2J5dGVjb2RlICp0YXJnZXQsIEpTT3Ag
ZnVzZWQpOwogICAgIGJvb2wgaXRlcih1aW50TiBmbGFncyk7Ci0gICAgdm9pZCBpdGVyTmV4dCgp
OworICAgIHZvaWQgaXRlck5leHQocHRyZGlmZl90IG9mZnNldCk7CiAgICAgYm9vbCBpdGVyTW9y
ZSgpOwogICAgIHZvaWQgaXRlckVuZCgpOwogICAgIE1heWJlSnVtcCBsb2FkRG91YmxlKEZyYW1l
RW50cnkgKmZlLCBGUFJlZ2lzdGVySUQgZnBSZWcpOwogI2lmZGVmIEpTX1BPTFlJQwogICAgIHZv
aWQgcGFzc0lDQWRkcmVzcyhCYXNlSUNJbmZvICppYyk7CiAjZW5kaWYKICNpZmRlZiBKU19NT05P
SUMKICAgICB2b2lkIHBhc3NNSUNBZGRyZXNzKEdsb2JhbE5hbWVJQ0luZm8gJm1pYyk7CkBAIC00
NjYsMTkgKzQ2NiwxNiBAQCBjbGFzcyBDb21waWxlciA6IHB1YmxpYyBCYXNlQ29tcGlsZXIKICAg
ICBib29sIGpzb3BfaW5zdGFuY2VvZigpOwogICAgIHZvaWQganNvcF9uYW1lKEpTQXRvbSAqYXRv
bSk7CiAgICAgYm9vbCBqc29wX3huYW1lKEpTQXRvbSAqYXRvbSk7CiAgICAgdm9pZCBlbnRlckJs
b2NrKEpTT2JqZWN0ICpvYmopOwogICAgIHZvaWQgbGVhdmVCbG9jaygpOwogICAgIHZvaWQgZW1p
dEV2YWwodWludDMyIGFyZ2MpOwogICAgIHZvaWQganNvcF9hcmd1bWVudHMoKTsKICAgICBib29s
IGpzb3BfdGFibGVzd2l0Y2goanNieXRlY29kZSAqcGMpOwotICAgIHZvaWQganNvcF9mb3Jwcm9w
KEpTQXRvbSAqYXRvbSk7Ci0gICAgdm9pZCBqc29wX2Zvcm5hbWUoSlNBdG9tICphdG9tKTsKLSAg
ICB2b2lkIGpzb3BfZm9yZ25hbWUoSlNBdG9tICphdG9tKTsKIAogICAgIC8qIEZhc3QgYXJpdGht
ZXRpYy4gKi8KICAgICB2b2lkIGpzb3BfYmluYXJ5KEpTT3Agb3AsIFZvaWRTdHViIHN0dWIpOwog
ICAgIHZvaWQganNvcF9iaW5hcnlfZnVsbChGcmFtZUVudHJ5ICpsaHMsIEZyYW1lRW50cnkgKnJo
cywgSlNPcCBvcCwgVm9pZFN0dWIgc3R1Yik7CiAgICAgdm9pZCBqc29wX2JpbmFyeV9mdWxsX3Np
bXBsZShGcmFtZUVudHJ5ICpmZSwgSlNPcCBvcCwgVm9pZFN0dWIgc3R1Yik7CiAgICAgdm9pZCBq
c29wX2JpbmFyeV9kb3VibGUoRnJhbWVFbnRyeSAqbGhzLCBGcmFtZUVudHJ5ICpyaHMsIEpTT3Ag
b3AsIFZvaWRTdHViIHN0dWIpOwogICAgIHZvaWQgc2xvd0xvYWRDb25zdGFudERvdWJsZShBc3Nl
bWJsZXIgJm1hc20sIEZyYW1lRW50cnkgKmZlLAogICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICBGUFJlZ2lzdGVySUQgZnByZWcpOw==
</data>

          </attachment>
          <attachment
              isobsolete="1"
              ispatch="1"
              isprivate="0"
              isurl="0"
          >
            <attachid>524962</attachid>
            <date>2011-04-10 09:50:00 -0700</date>
            <delta_ts>2011-04-10 15:57:27 -0700</delta_ts>
            <desc>WIP 3 - not quite working in decompiler</desc>
            <filename>bug-648175-rm-jsop-for-take-2-v3.patch</filename>
            <type>text/plain</type>
            <size>83442</size>
            <attacher>jorendorff</attacher>
            
              <data encoding="base64">ZGlmZiAtLWdpdCBhL2pzL3NyYy9qc2FuYWx5emUuY3BwIGIvanMvc3JjL2pzYW5hbHl6ZS5jcHAK
LS0tIGEvanMvc3JjL2pzYW5hbHl6ZS5jcHAKKysrIGIvanMvc3JjL2pzYW5hbHl6ZS5jcHAKQEAg
LTQ1MiwxNyArNDUyLDE2IEBAIFNjcmlwdDo6YW5hbHl6ZShKU0NvbnRleHQgKmN4LCBKU1Njcmlw
dCAKICAgICAgICAgICBjYXNlIEpTT1BfQ0FMTE5BTUU6CiAgICAgICAgICAgY2FzZSBKU09QX0JJ
TkROQU1FOgogICAgICAgICAgIGNhc2UgSlNPUF9TRVROQU1FOgogICAgICAgICAgIGNhc2UgSlNP
UF9ERUxOQU1FOgogICAgICAgICAgIGNhc2UgSlNPUF9JTkNOQU1FOgogICAgICAgICAgIGNhc2Ug
SlNPUF9ERUNOQU1FOgogICAgICAgICAgIGNhc2UgSlNPUF9OQU1FSU5DOgogICAgICAgICAgIGNh
c2UgSlNPUF9OQU1FREVDOgotICAgICAgICAgIGNhc2UgSlNPUF9GT1JOQU1FOgogICAgICAgICAg
ICAgdXNlc1Njb3BlID0gdHJ1ZTsKICAgICAgICAgICAgIGJyZWFrOwogCiAgICAgICAgICAgLyog
V2F0Y2ggZm9yIG9wY29kZXMgdGhlIG1ldGhvZCBKSVQgZG9lc24ndCBjb21waWxlLiAqLwogICAg
ICAgICAgIGNhc2UgSlNPUF9HT1NVQjoKICAgICAgICAgICBjYXNlIEpTT1BfR09TVUJYOgogICAg
ICAgICAgIGNhc2UgSlNPUF9JRlBSSU1UT1A6CiAgICAgICAgICAgY2FzZSBKU09QX0ZJTFRFUjoK
QEAgLTU3NCwxOCArNTczLDE3IEBAIFNjcmlwdDo6YW5hbHl6ZShKU0NvbnRleHQgKmN4LCBKU1Nj
cmlwdCAKICAgICAgICAgICBjYXNlIEpTT1BfTE9DQUxJTkM6CiAgICAgICAgICAgY2FzZSBKU09Q
X0xPQ0FMREVDOiB7CiAgICAgICAgICAgICB1aW50MzIgbG9jYWwgPSBHRVRfU0xPVE5PKHBjKTsK
ICAgICAgICAgICAgIGlmIChsb2NhbCA8IG5maXhlZCAmJiAhbG9jYWxEZWZpbmVkKGxvY2FsLCBv
ZmZzZXQpKQogICAgICAgICAgICAgICAgIHNldExvY2FsKGxvY2FsLCBMT0NBTF9VU0VfQkVGT1JF
X0RFRik7CiAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICB9CiAKLSAgICAgICAgICBjYXNl
IEpTT1BfU0VUTE9DQUw6Ci0gICAgICAgICAgY2FzZSBKU09QX0ZPUkxPQ0FMOiB7CisgICAgICAg
ICAgY2FzZSBKU09QX1NFVExPQ0FMOiB7CiAgICAgICAgICAgICB1aW50MzIgbG9jYWwgPSBHRVRf
U0xPVE5PKHBjKTsKIAogICAgICAgICAgICAgLyoKICAgICAgICAgICAgICAqIFRoZSBsb2NhbCB2
YXJpYWJsZSBtYXkgYWxyZWFkeSBoYXZlIGJlZW4gbWFya2VkIGFzIHVuY29uZGl0aW9uYWxseQog
ICAgICAgICAgICAgICogZGVmaW5lZCBhdCBhIGxhdGVyIHBvaW50IGluIHRoZSBzY3JpcHQsIGlm
IHRoYXQgZGVmaW5pdGlvbiB3YXMgaW4gdGhlCiAgICAgICAgICAgICAgKiBjb25kaXRpb24gZm9y
IGEgbG9vcCB3aGljaCB0aGVuIGp1bXBlZCBiYWNrIGhlcmUuICBJbiBzdWNoIGNhc2VzIHdlCiAg
ICAgICAgICAgICAgKiB3aWxsIG5vdCB0cmVhdCB0aGUgdmFyaWFibGUgYXMgZXZlciBiZWluZyBk
ZWZpbmVkIGluIHRoZSBsb29wIGJvZHkKICAgICAgICAgICAgICAqIChzZWUgc2V0TG9jYWwpLgpk
aWZmIC0tZ2l0IGEvanMvc3JjL2pzY250eHQuaCBiL2pzL3NyYy9qc2NudHh0LmgKLS0tIGEvanMv
c3JjL2pzY250eHQuaAorKysgYi9qcy9zcmMvanNjbnR4dC5oCkBAIC0xOTM4LDE3ICsxOTM4LDE3
IEBAIHN0cnVjdCBKU0NvbnRleHQKICAgICBKU1NlY3VyaXR5Q2FsbGJhY2tzICpzZWN1cml0eUNh
bGxiYWNrczsKIAogICAgIC8qIFN0b3JlZCBoZXJlIHRvIGF2b2lkIHBhc3NpbmcgaXQgYXJvdW5k
IGFzIGEgcGFyYW1ldGVyLiAqLwogICAgIHVpbnROICAgICAgICAgICAgICAgcmVzb2x2ZUZsYWdz
OwogCiAgICAgLyogUmFuZG9tIG51bWJlciBnZW5lcmF0b3Igc3RhdGUsIHVzZWQgYnkganNtYXRo
LmNwcC4gKi8KICAgICBpbnQ2NCAgICAgICAgICAgICAgIHJuZ1NlZWQ7CiAKLSAgICAvKiBMb2Nh
dGlvbiB0byBzdGFzaCB0aGUgaXRlcmF0aW9uIHZhbHVlIGJldHdlZW4gSlNPUF9NT1JFSVRFUiBh
bmQgSlNPUF9GT1IqLiAqLworICAgIC8qIExvY2F0aW9uIHRvIHN0YXNoIHRoZSBpdGVyYXRpb24g
dmFsdWUgYmV0d2VlbiBKU09QX01PUkVJVEVSIGFuZCBKU09QX0lURVJORVhULiAqLwogICAgIGpz
OjpWYWx1ZSAgICAgICAgICAgaXRlclZhbHVlOwogCiAjaWZkZWYgSlNfVFJBQ0VSCiAgICAgLyoK
ICAgICAgKiBUcnVlIGlmIHRyYWNlcyBtYXkgYmUgZXhlY3V0ZWQuIEludmFyaWFudDogVGhlIHZh
bHVlIG9mIHRyYWNlSml0ZW5hYmxlZAogICAgICAqIGlzIGFsd2F5cyBlcXVhbCB0byB0aGUgZXhw
cmVzc2lvbiBpbiB1cGRhdGVKSVRFbmFibGVkIGJlbG93LgogICAgICAqCiAgICAgICogVGhpcyBm
bGFnIGFuZCB0aGUgZmllbGRzIGFjY2Vzc2VkIGJ5IHVwZGF0ZUpJVEVuYWJsZWQgYXJlIHdyaXR0
ZW4gb25seQpkaWZmIC0tZ2l0IGEvanMvc3JjL2pzZW1pdC5jcHAgYi9qcy9zcmMvanNlbWl0LmNw
cAotLS0gYS9qcy9zcmMvanNlbWl0LmNwcAorKysgYi9qcy9zcmMvanNlbWl0LmNwcApAQCAtMjAx
NCwxNyArMjAxNCwxNiBAQCBUcnlDb252ZXJ0VG9HbmFtZShKU0NvZGVHZW5lcmF0b3IgKmNnLCBK
CiAgICAgICAgICEoY2ctPmZsYWdzICYgVENGX1NUUklDVF9NT0RFX0NPREUpKSB7IAogICAgICAg
ICBzd2l0Y2ggKCpvcCkgewogICAgICAgICAgIGNhc2UgSlNPUF9OQU1FOiAgICAgKm9wID0gSlNP
UF9HRVRHTkFNRTsgYnJlYWs7CiAgICAgICAgICAgY2FzZSBKU09QX1NFVE5BTUU6ICAqb3AgPSBK
U09QX1NFVEdOQU1FOyBicmVhazsKICAgICAgICAgICBjYXNlIEpTT1BfSU5DTkFNRTogICpvcCA9
IEpTT1BfSU5DR05BTUU7IGJyZWFrOwogICAgICAgICAgIGNhc2UgSlNPUF9OQU1FSU5DOiAgKm9w
ID0gSlNPUF9HTkFNRUlOQzsgYnJlYWs7CiAgICAgICAgICAgY2FzZSBKU09QX0RFQ05BTUU6ICAq
b3AgPSBKU09QX0RFQ0dOQU1FOyBicmVhazsKICAgICAgICAgICBjYXNlIEpTT1BfTkFNRURFQzog
ICpvcCA9IEpTT1BfR05BTUVERUM7IGJyZWFrOwotICAgICAgICAgIGNhc2UgSlNPUF9GT1JOQU1F
OiAgKm9wID0gSlNPUF9GT1JHTkFNRTsgYnJlYWs7CiAgICAgICAgICAgY2FzZSBKU09QX1NFVENP
TlNUOgogICAgICAgICAgIGNhc2UgSlNPUF9ERUxOQU1FOgogICAgICAgICAgICAgLyogTm90IHN1
cHBvcnRlZC4gKi8KICAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICAgICBkZWZhdWx0
OiBKU19OT1RfUkVBQ0hFRCgiZ25hbWUiKTsKICAgICAgICAgfQogICAgICAgICByZXR1cm4gdHJ1
ZTsKICAgICB9CkBAIC0yMzQzLDMwICsyMzQyLDI4IEBAIEJpbmROYW1lVG9TbG90KEpTQ29udGV4
dCAqY3gsIEpTQ29kZUdlbmUKICAgICAgIGNhc2UgSlNEZWZpbml0aW9uOjpMRVQ6CiAgICAgICAg
IHN3aXRjaCAob3ApIHsKICAgICAgICAgICBjYXNlIEpTT1BfTkFNRTogICAgIG9wID0gSlNPUF9H
RVRMT0NBTDsgYnJlYWs7CiAgICAgICAgICAgY2FzZSBKU09QX1NFVE5BTUU6ICBvcCA9IEpTT1Bf
U0VUTE9DQUw7IGJyZWFrOwogICAgICAgICAgIGNhc2UgSlNPUF9JTkNOQU1FOiAgb3AgPSBKU09Q
X0lOQ0xPQ0FMOyBicmVhazsKICAgICAgICAgICBjYXNlIEpTT1BfTkFNRUlOQzogIG9wID0gSlNP
UF9MT0NBTElOQzsgYnJlYWs7CiAgICAgICAgICAgY2FzZSBKU09QX0RFQ05BTUU6ICBvcCA9IEpT
T1BfREVDTE9DQUw7IGJyZWFrOwogICAgICAgICAgIGNhc2UgSlNPUF9OQU1FREVDOiAgb3AgPSBK
U09QX0xPQ0FMREVDOyBicmVhazsKLSAgICAgICAgICBjYXNlIEpTT1BfRk9STkFNRTogIG9wID0g
SlNPUF9GT1JMT0NBTDsgYnJlYWs7CiAgICAgICAgICAgZGVmYXVsdDogSlNfTk9UX1JFQUNIRUQo
ImxldCIpOwogICAgICAgICB9CiAgICAgICAgIGJyZWFrOwogCiAgICAgICBjYXNlIEpTRGVmaW5p
dGlvbjo6QVJHOgogICAgICAgICBzd2l0Y2ggKG9wKSB7CiAgICAgICAgICAgY2FzZSBKU09QX05B
TUU6ICAgICBvcCA9IEpTT1BfR0VUQVJHOyBicmVhazsKICAgICAgICAgICBjYXNlIEpTT1BfU0VU
TkFNRTogIG9wID0gSlNPUF9TRVRBUkc7IGJyZWFrOwogICAgICAgICAgIGNhc2UgSlNPUF9JTkNO
QU1FOiAgb3AgPSBKU09QX0lOQ0FSRzsgYnJlYWs7CiAgICAgICAgICAgY2FzZSBKU09QX05BTUVJ
TkM6ICBvcCA9IEpTT1BfQVJHSU5DOyBicmVhazsKICAgICAgICAgICBjYXNlIEpTT1BfREVDTkFN
RTogIG9wID0gSlNPUF9ERUNBUkc7IGJyZWFrOwogICAgICAgICAgIGNhc2UgSlNPUF9OQU1FREVD
OiAgb3AgPSBKU09QX0FSR0RFQzsgYnJlYWs7Ci0gICAgICAgICAgY2FzZSBKU09QX0ZPUk5BTUU6
ICBvcCA9IEpTT1BfRk9SQVJHOyBicmVhazsKICAgICAgICAgICBkZWZhdWx0OiBKU19OT1RfUkVB
Q0hFRCgiYXJnIik7CiAgICAgICAgIH0KICAgICAgICAgSlNfQVNTRVJUKCFwbi0+aXNDb25zdCgp
KTsKICAgICAgICAgYnJlYWs7CiAKICAgICAgIGNhc2UgSlNEZWZpbml0aW9uOjpWQVI6CiAgICAg
ICAgIGlmIChQTl9PUChkbikgPT0gSlNPUF9DQUxMRUUpIHsKICAgICAgICAgICAgIEpTX0FTU0VS
VChvcCAhPSBKU09QX0NBTExFRSk7CkBAIC0yNDE1LDE3ICsyNDEyLDE2IEBAIEJpbmROYW1lVG9T
bG90KEpTQ29udGV4dCAqY3gsIEpTQ29kZUdlbmUKICAgICAgICAgc3dpdGNoIChvcCkgewogICAg
ICAgICAgIGNhc2UgSlNPUF9OQU1FOiAgICAgb3AgPSBKU09QX0dFVExPQ0FMOyBicmVhazsKICAg
ICAgICAgICBjYXNlIEpTT1BfU0VUTkFNRTogIG9wID0gSlNPUF9TRVRMT0NBTDsgYnJlYWs7CiAg
ICAgICAgICAgY2FzZSBKU09QX1NFVENPTlNUOiBvcCA9IEpTT1BfU0VUTE9DQUw7IGJyZWFrOwog
ICAgICAgICAgIGNhc2UgSlNPUF9JTkNOQU1FOiAgb3AgPSBKU09QX0lOQ0xPQ0FMOyBicmVhazsK
ICAgICAgICAgICBjYXNlIEpTT1BfTkFNRUlOQzogIG9wID0gSlNPUF9MT0NBTElOQzsgYnJlYWs7
CiAgICAgICAgICAgY2FzZSBKU09QX0RFQ05BTUU6ICBvcCA9IEpTT1BfREVDTE9DQUw7IGJyZWFr
OwogICAgICAgICAgIGNhc2UgSlNPUF9OQU1FREVDOiAgb3AgPSBKU09QX0xPQ0FMREVDOyBicmVh
azsKLSAgICAgICAgICBjYXNlIEpTT1BfRk9STkFNRTogIG9wID0gSlNPUF9GT1JMT0NBTDsgYnJl
YWs7CiAgICAgICAgICAgZGVmYXVsdDogSlNfTk9UX1JFQUNIRUQoImxvY2FsIik7CiAgICAgICAg
IH0KICAgICAgICAgSlNfQVNTRVJUX0lGKGRuX2tpbmQgPT0gSlNEZWZpbml0aW9uOjpDT05TVCwg
cG4tPnBuX2RmbGFncyAmIFBORF9DT05TVCk7CiAgICAgICAgIGJyZWFrOwogICAgIH0KIAogICAg
IEpTX0FTU0VSVChvcCAhPSBQTl9PUChwbikpOwogICAgIHBuLT5wbl9vcCA9IG9wOwpAQCAtNDM1
NywxNiArNDM1MywyMTQgQEAgRW1pdFZhcmlhYmxlcyhKU0NvbnRleHQgKmN4LCBKU0NvZGVHZW5l
cgogICAgICAgICAgICAgcmV0dXJuIEpTX0ZBTFNFOwogICAgICAgICBpZiAoIShwbi0+cG5feGZs
YWdzICYgUE5YX1BPUFZBUikpCiAgICAgICAgICAgICByZXR1cm4ganNfRW1pdDEoY3gsIGNnLCBK
U09QX05PUCkgPj0gMDsKICAgICB9CiAKICAgICByZXR1cm4gIShwbi0+cG5feGZsYWdzICYgUE5Y
X1BPUFZBUikgfHwganNfRW1pdDEoY3gsIGNnLCBKU09QX1BPUCkgPj0gMDsKIH0KIAorc3RhdGlj
IGJvb2wKK0VtaXRBc3NpZ25tZW50KEpTQ29udGV4dCAqY3gsIEpTQ29kZUdlbmVyYXRvciAqY2cs
IEpTUGFyc2VOb2RlICpsaHMsIEpTT3Agb3AsIEpTUGFyc2VOb2RlICpyaHMpCit7CisgICAgcHRy
ZGlmZl90IHRvcCA9IENHX09GRlNFVChjZyk7CisKKyAgICAvKgorICAgICAqIENoZWNrIGxlZnQg
b3BlcmFuZCB0eXBlIGFuZCBnZW5lcmF0ZSBzcGVjaWFsaXplZCBjb2RlIGZvciBpdC4KKyAgICAg
KiBTcGVjaWFsaXplIHRvIGF2b2lkIEVDTUEgInJlZmVyZW5jZSB0eXBlIiB2YWx1ZXMgb24gdGhl
IG9wZXJhbmQKKyAgICAgKiBzdGFjaywgd2hpY2ggaW1wb3NlIHBlcnZhc2l2ZSBydW50aW1lICJH
ZXRWYWx1ZSIgY29zdHMuCisgICAgICovCisgICAganNhdG9taWQgYXRvbUluZGV4ID0gKGpzYXRv
bWlkKSAtMTsgICAgICAgICAgICAgIC8qIHF1ZWxsIEdDQyBvdmVyd2FybmluZyAqLworICAgIGpz
Ynl0ZWNvZGUgb2Zmc2V0ID0gMTsKKyAgICBKU0F0b21MaXN0RWxlbWVudCAqYWxlOworICAgIHN3
aXRjaCAoUE5fVFlQRShsaHMpKSB7CisgICAgICBjYXNlIFRPS19OQU1FOgorICAgICAgICBpZiAo
IUJpbmROYW1lVG9TbG90KGN4LCBjZywgbGhzKSkKKyAgICAgICAgICAgIHJldHVybiBmYWxzZTsK
KyAgICAgICAgaWYgKCFsaHMtPnBuX2Nvb2tpZS5pc0ZyZWUoKSkgeworICAgICAgICAgICAgYXRv
bUluZGV4ID0gKGpzYXRvbWlkKSBsaHMtPnBuX2Nvb2tpZS5hc0ludGVnZXIoKTsKKyAgICAgICAg
fSBlbHNlIHsKKyAgICAgICAgICAgIGFsZSA9IGNnLT5hdG9tTGlzdC5hZGQoY2ctPnBhcnNlciwg
bGhzLT5wbl9hdG9tKTsKKyAgICAgICAgICAgIGlmICghYWxlKQorICAgICAgICAgICAgICAgIHJl
dHVybiBmYWxzZTsKKyAgICAgICAgICAgIGF0b21JbmRleCA9IEFMRV9JTkRFWChhbGUpOworICAg
ICAgICAgICAgaWYgKCFsaHMtPmlzQ29uc3QoKSkgeworICAgICAgICAgICAgICAgIEpTT3Agb3Ag
PSBQTl9PUChsaHMpID09IEpTT1BfU0VUR05BTUUgPyBKU09QX0JJTkRHTkFNRSA6IEpTT1BfQklO
RE5BTUU7CisgICAgICAgICAgICAgICAgRU1JVF9JTkRFWF9PUChvcCwgYXRvbUluZGV4KTsKKyAg
ICAgICAgICAgICAgICBvZmZzZXQrKzsKKyAgICAgICAgICAgIH0KKyAgICAgICAgfQorICAgICAg
ICBicmVhazsKKyAgICAgIGNhc2UgVE9LX0RPVDoKKyAgICAgICAgaWYgKCFqc19FbWl0VHJlZShj
eCwgY2csIGxocy0+ZXhwcigpKSkKKyAgICAgICAgICAgIHJldHVybiBmYWxzZTsKKyAgICAgICAg
b2Zmc2V0Kys7CisgICAgICAgIGFsZSA9IGNnLT5hdG9tTGlzdC5hZGQoY2ctPnBhcnNlciwgbGhz
LT5wbl9hdG9tKTsKKyAgICAgICAgaWYgKCFhbGUpCisgICAgICAgICAgICByZXR1cm4gZmFsc2U7
CisgICAgICAgIGF0b21JbmRleCA9IEFMRV9JTkRFWChhbGUpOworICAgICAgICBicmVhazsKKyAg
ICAgIGNhc2UgVE9LX0xCOgorICAgICAgICBKU19BU1NFUlQobGhzLT5wbl9hcml0eSA9PSBQTl9C
SU5BUlkpOworICAgICAgICBpZiAoIWpzX0VtaXRUcmVlKGN4LCBjZywgbGhzLT5wbl9sZWZ0KSkK
KyAgICAgICAgICAgIHJldHVybiBmYWxzZTsKKyAgICAgICAgaWYgKCFqc19FbWl0VHJlZShjeCwg
Y2csIGxocy0+cG5fcmlnaHQpKQorICAgICAgICAgICAgcmV0dXJuIGZhbHNlOworICAgICAgICBv
ZmZzZXQgKz0gMjsKKyAgICAgICAgYnJlYWs7CisjaWYgSlNfSEFTX0RFU1RSVUNUVVJJTkcKKyAg
ICAgIGNhc2UgVE9LX1JCOgorICAgICAgY2FzZSBUT0tfUkM6CisgICAgICAgIGJyZWFrOworI2Vu
ZGlmCisgICAgICBjYXNlIFRPS19MUDoKKyAgICAgICAgaWYgKCFqc19FbWl0VHJlZShjeCwgY2cs
IGxocykpCisgICAgICAgICAgICByZXR1cm4gZmFsc2U7CisgICAgICAgIG9mZnNldCsrOworICAg
ICAgICBicmVhazsKKyNpZiBKU19IQVNfWE1MX1NVUFBPUlQKKyAgICAgIGNhc2UgVE9LX1VOQVJZ
T1A6CisgICAgICAgIEpTX0FTU0VSVChsaHMtPnBuX29wID09IEpTT1BfU0VUWE1MTkFNRSk7Cisg
ICAgICAgIGlmICghanNfRW1pdFRyZWUoY3gsIGNnLCBsaHMtPnBuX2tpZCkpCisgICAgICAgICAg
ICByZXR1cm4gZmFsc2U7CisgICAgICAgIGlmIChqc19FbWl0MShjeCwgY2csIEpTT1BfQklORFhN
TE5BTUUpIDwgMCkKKyAgICAgICAgICAgIHJldHVybiBmYWxzZTsKKyAgICAgICAgb2Zmc2V0Kys7
CisgICAgICAgIGJyZWFrOworI2VuZGlmCisgICAgICBkZWZhdWx0OgorICAgICAgICBKU19BU1NF
UlQoMCk7CisgICAgfQorCisgICAgaWYgKG9wICE9IEpTT1BfTk9QKSB7CisgICAgICAgIEpTX0FT
U0VSVChyaHMpOworICAgICAgICBzd2l0Y2ggKGxocy0+cG5fdHlwZSkgeworICAgICAgICAgIGNh
c2UgVE9LX05BTUU6CisgICAgICAgICAgICBpZiAobGhzLT5pc0NvbnN0KCkpIHsKKyAgICAgICAg
ICAgICAgICBpZiAoUE5fT1AobGhzKSA9PSBKU09QX0NBTExFRSkgeworICAgICAgICAgICAgICAg
ICAgICBpZiAoanNfRW1pdDEoY3gsIGNnLCBKU09QX0NBTExFRSkgPCAwKQorICAgICAgICAgICAg
ICAgICAgICAgICAgcmV0dXJuIGZhbHNlOworICAgICAgICAgICAgICAgIH0gZWxzZSB7CisgICAg
ICAgICAgICAgICAgICAgIEVNSVRfSU5ERVhfT1AoUE5fT1AobGhzKSwgYXRvbUluZGV4KTsKKyAg
ICAgICAgICAgICAgICB9CisgICAgICAgICAgICB9IGVsc2UgaWYgKFBOX09QKGxocykgPT0gSlNP
UF9TRVROQU1FKSB7CisgICAgICAgICAgICAgICAgaWYgKGpzX0VtaXQxKGN4LCBjZywgSlNPUF9E
VVApIDwgMCkKKyAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlOworICAgICAgICAgICAg
ICAgIEVNSVRfSU5ERVhfT1AoSlNPUF9HRVRYUFJPUCwgYXRvbUluZGV4KTsKKyAgICAgICAgICAg
IH0gZWxzZSBpZiAoUE5fT1AobGhzKSA9PSBKU09QX1NFVEdOQU1FKSB7CisgICAgICAgICAgICAg
ICAgaWYgKCFCaW5kR2xvYmFsKGN4LCBjZywgbGhzLCBsaHMtPnBuX2F0b20pKQorICAgICAgICAg
ICAgICAgICAgICByZXR1cm4gZmFsc2U7CisgICAgICAgICAgICAgICAgaWYgKGxocy0+cG5fY29v
a2llLmlzRnJlZSgpKQorICAgICAgICAgICAgICAgICAgICBFbWl0QXRvbU9wKGN4LCBsaHMsIEpT
T1BfR0VUR05BTUUsIGNnKTsKKyAgICAgICAgICAgICAgICBlbHNlCisgICAgICAgICAgICAgICAg
ICAgIEVNSVRfVUlOVDE2X0lNTV9PUChKU09QX0dFVEdMT0JBTCwgbGhzLT5wbl9jb29raWUuYXNJ
bnRlZ2VyKCkpOworICAgICAgICAgICAgfSBlbHNlIHsKKyAgICAgICAgICAgICAgICBFTUlUX1VJ
TlQxNl9JTU1fT1AoKFBOX09QKGxocykgPT0gSlNPUF9TRVRBUkcpCisgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgID8gSlNPUF9HRVRBUkcKKyAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgOiBKU09QX0dFVExPQ0FMLAorICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICBhdG9tSW5kZXgpOworICAgICAgICAgICAgfQorICAgICAgICAgICAgYnJlYWs7Cisg
ICAgICAgICAgY2FzZSBUT0tfRE9UOgorICAgICAgICAgICAgaWYgKGpzX0VtaXQxKGN4LCBjZywg
SlNPUF9EVVApIDwgMCkKKyAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7CisgICAgICAgICAg
ICBpZiAobGhzLT5wbl9hdG9tID09IGN4LT5ydW50aW1lLT5hdG9tU3RhdGUubGVuZ3RoQXRvbSkg
eworICAgICAgICAgICAgICAgIGlmIChqc19FbWl0MShjeCwgY2csIEpTT1BfTEVOR1RIKSA8IDAp
CisgICAgICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTsKKyAgICAgICAgICAgIH0gZWxzZSBp
ZiAobGhzLT5wbl9hdG9tID09IGN4LT5ydW50aW1lLT5hdG9tU3RhdGUucHJvdG9BdG9tKSB7Cisg
ICAgICAgICAgICAgICAgaWYgKCFFbWl0SW5kZXhPcChjeCwgSlNPUF9RTkFNRVBBUlQsIGF0b21J
bmRleCwgY2cpKQorICAgICAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7CisgICAgICAgICAg
ICAgICAgaWYgKGpzX0VtaXQxKGN4LCBjZywgSlNPUF9HRVRFTEVNKSA8IDApCisgICAgICAgICAg
ICAgICAgICAgIHJldHVybiBmYWxzZTsKKyAgICAgICAgICAgIH0gZWxzZSB7CisgICAgICAgICAg
ICAgICAgRU1JVF9JTkRFWF9PUChKU09QX0dFVFBST1AsIGF0b21JbmRleCk7CisgICAgICAgICAg
ICB9CisgICAgICAgICAgICBicmVhazsKKyAgICAgICAgICBjYXNlIFRPS19MQjoKKyAgICAgICAg
ICBjYXNlIFRPS19MUDoKKyNpZiBKU19IQVNfWE1MX1NVUFBPUlQKKyAgICAgICAgICBjYXNlIFRP
S19VTkFSWU9QOgorI2VuZGlmCisgICAgICAgICAgICBpZiAoanNfRW1pdDEoY3gsIGNnLCBKU09Q
X0RVUDIpIDwgMCkKKyAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7CisgICAgICAgICAgICBp
ZiAoanNfRW1pdDEoY3gsIGNnLCBKU09QX0dFVEVMRU0pIDwgMCkKKyAgICAgICAgICAgICAgICBy
ZXR1cm4gZmFsc2U7CisgICAgICAgICAgICBicmVhazsKKyAgICAgICAgICBkZWZhdWx0OjsKKyAg
ICAgICAgfQorICAgIH0KKworICAgIC8qIE5vdyBlbWl0IHRoZSByaWdodCBvcGVyYW5kIChpdCBt
YXkgYWZmZWN0IHRoZSBuYW1lc3BhY2UpLiAqLworICAgIGlmIChyaHMpIHsKKyAgICAgICAgaWYg
KCFqc19FbWl0VHJlZShjeCwgY2csIHJocykpCisgICAgICAgICAgICByZXR1cm4gZmFsc2U7Cisg
ICAgfSBlbHNlIHsKKyAgICAgICAgLyogVGhlIHZhbHVlIHRvIGFzc2lnbiBpcyB0aGUgbmV4dCBl
bnVtZXJhdGlvbiB2YWx1ZSBpbiBhIGZvci1pbiBsb29wLiAqLworICAgICAgICBpZiAoanNfRW1p
dDIoY3gsIGNnLCBKU09QX0lURVJORVhULCBvZmZzZXQpIDwgMCkKKyAgICAgICAgICAgIHJldHVy
biBmYWxzZTsKKyAgICB9CisKKyAgICAvKiBJZiArPSBldGMuLCBlbWl0IHRoZSBiaW5hcnkgb3Bl
cmF0b3Igd2l0aCBhIGRlY29tcGlsZXIgbm90ZS4gKi8KKyAgICBpZiAob3AgIT0gSlNPUF9OT1Ap
IHsKKyAgICAgICAgLyoKKyAgICAgICAgICogVGFrZSBjYXJlIHRvIGF2b2lkIFNSQ19BU1NJR05P
UCBpZiB0aGUgbGVmdC1oYW5kIHNpZGUgaXMgYSBjb25zdAorICAgICAgICAgKiBkZWNsYXJlZCBp
biB0aGUgY3VycmVudCBjb21waWxhdGlvbiB1bml0LCBhcyBpbiB0aGlzIGNhc2UgKGp1c3QKKyAg
ICAgICAgICogYSBiaXQgZnVydGhlciBiZWxvdykgd2Ugd2lsbCBhdm9pZCBlbWl0dGluZyB0aGUg
YXNzaWdubWVudCBvcC4KKyAgICAgICAgICovCisgICAgICAgIGlmIChsaHMtPnBuX3R5cGUgIT0g
VE9LX05BTUUgfHwgIWxocy0+aXNDb25zdCgpKSB7CisgICAgICAgICAgICBpZiAoanNfTmV3U3Jj
Tm90ZShjeCwgY2csIFNSQ19BU1NJR05PUCkgPCAwKQorICAgICAgICAgICAgICAgIHJldHVybiBm
YWxzZTsKKyAgICAgICAgfQorICAgICAgICBpZiAoanNfRW1pdDEoY3gsIGNnLCBvcCkgPCAwKQor
ICAgICAgICAgICAgcmV0dXJuIGZhbHNlOworICAgIH0KKworICAgIC8qIExlZnQgcGFydHMgc3Vj
aCBhcyBhLmIuYyBhbmQgYVtiXS5jIG5lZWQgYSBkZWNvbXBpbGVyIG5vdGUuICovCisgICAgaWYg
KGxocy0+cG5fdHlwZSAhPSBUT0tfTkFNRSAmJgorI2lmIEpTX0hBU19ERVNUUlVDVFVSSU5HCisg
ICAgICAgIGxocy0+cG5fdHlwZSAhPSBUT0tfUkIgJiYKKyAgICAgICAgbGhzLT5wbl90eXBlICE9
IFRPS19SQyAmJgorI2VuZGlmCisgICAgICAgIGpzX05ld1NyY05vdGUyKGN4LCBjZywgU1JDX1BD
QkFTRSwgQ0dfT0ZGU0VUKGNnKSAtIHRvcCkgPCAwKSB7CisgICAgICAgIHJldHVybiBmYWxzZTsK
KyAgICB9CisKKyAgICAvKiBGaW5hbGx5LCBlbWl0IHRoZSBzcGVjaWFsaXplZCBhc3NpZ25tZW50
IGJ5dGVjb2RlLiAqLworICAgIHN3aXRjaCAobGhzLT5wbl90eXBlKSB7CisgICAgICBjYXNlIFRP
S19OQU1FOgorICAgICAgICBpZiAobGhzLT5pc0NvbnN0KCkpCisgICAgICAgICAgICBicmVhazsK
KyAgICAgICAgLyogRkFMTCBUSFJPVUdIICovCisgICAgICBjYXNlIFRPS19ET1Q6CisgICAgICAg
IEVNSVRfSU5ERVhfT1AoUE5fT1AobGhzKSwgYXRvbUluZGV4KTsKKyAgICAgICAgYnJlYWs7Cisg
ICAgICBjYXNlIFRPS19MQjoKKyAgICAgIGNhc2UgVE9LX0xQOgorICAgICAgICBpZiAoanNfRW1p
dDEoY3gsIGNnLCBKU09QX1NFVEVMRU0pIDwgMCkKKyAgICAgICAgICAgIHJldHVybiBmYWxzZTsK
KyAgICAgICAgYnJlYWs7CisjaWYgSlNfSEFTX0RFU1RSVUNUVVJJTkcKKyAgICAgIGNhc2UgVE9L
X1JCOgorICAgICAgY2FzZSBUT0tfUkM6CisgICAgICAgIGlmICghRW1pdERlc3RydWN0dXJpbmdP
cHMoY3gsIGNnLCBKU09QX1NFVE5BTUUsIGxocykpCisgICAgICAgICAgICByZXR1cm4gZmFsc2U7
CisgICAgICAgIGJyZWFrOworI2VuZGlmCisjaWYgSlNfSEFTX1hNTF9TVVBQT1JUCisgICAgICBj
YXNlIFRPS19VTkFSWU9QOgorICAgICAgICBpZiAoanNfRW1pdDEoY3gsIGNnLCBKU09QX1NFVFhN
TE5BTUUpIDwgMCkKKyAgICAgICAgICAgIHJldHVybiBmYWxzZTsKKyAgICAgICAgYnJlYWs7Cisj
ZW5kaWYKKyAgICAgIGRlZmF1bHQ6CisgICAgICAgIEpTX0FTU0VSVCgwKTsKKyAgICB9CisgICAg
cmV0dXJuIHRydWU7Cit9CisKICNpZiBkZWZpbmVkIERFQlVHX2JyZW5kYW4gfHwgZGVmaW5lZCBE
RUJVR19tcmJrYXAKIHN0YXRpYyBKU0Jvb2wKIEdldHRhYmxlTm90ZUZvck5leHRPcChKU0NvZGVH
ZW5lcmF0b3IgKmNnKQogewogICAgIHB0cmRpZmZfdCBvZmZzZXQsIHRhcmdldDsKICAgICBqc3Ny
Y25vdGUgKnNuLCAqZW5kOwogCiAgICAgb2Zmc2V0ID0gMDsKQEAgLTQ5MzYsMTcgKzUxMzAsMTcg
QEAganNfRW1pdFRyZWUoSlNDb250ZXh0ICpjeCwgSlNDb2RlR2VuZXJhdAogICAgICAgICBwbjIg
PSBwbi0+cG5fbGVmdDsKICAgICAgICAganNfUHVzaFN0YXRlbWVudChjZywgJnN0bXRJbmZvLCBT
VE1UX0ZPUl9MT09QLCB0b3ApOwogCiAgICAgICAgIGlmIChwbjItPnBuX3R5cGUgPT0gVE9LX0lO
KSB7CiAgICAgICAgICAgICAvKiBTZXQgc3RtdEluZm8gdHlwZSBmb3IgbGF0ZXIgdGVzdGluZy4g
Ki8KICAgICAgICAgICAgIHN0bXRJbmZvLnR5cGUgPSBTVE1UX0ZPUl9JTl9MT09QOwogCiAgICAg
ICAgICAgICAvKgotICAgICAgICAgICAgICogSWYgdGhlIGxlZnQgcGFydCBpcyAndmFyIHgnLCBl
bWl0IGNvZGUgdG8gZGVmaW5lIHggaWYgbmVjZXNzYXJ5CisgICAgICAgICAgICAgKiA8Pz8/Pklm
IHRoZSBsZWZ0IHBhcnQgaXMgJ3ZhciB4JywgZW1pdCBjb2RlIHRvIGRlZmluZSB4IGlmIG5lY2Vz
c2FyeQogICAgICAgICAgICAgICogdXNpbmcgYSBwcm9sb2cgb3Bjb2RlLCBidXQgZG8gbm90IGVt
aXQgYSBwb3AuICBJZiB0aGUgbGVmdCBwYXJ0CiAgICAgICAgICAgICAgKiBpcyAndmFyIHggPSBp
JywgZW1pdCBwcm9sb2cgY29kZSB0byBkZWZpbmUgeCBpZiBuZWNlc3Nhcnk7IHRoZW4KICAgICAg
ICAgICAgICAqIGVtaXQgY29kZSB0byBldmFsdWF0ZSBpLCBhc3NpZ24gdGhlIHJlc3VsdCB0byB4
LCBhbmQgcG9wIHRoZQogICAgICAgICAgICAgICogcmVzdWx0IG9mZiB0aGUgc3RhY2suCiAgICAg
ICAgICAgICAgKgogICAgICAgICAgICAgICogQWxsIHRoZSBsb2dpYyB0byBkbyB0aGlzIGlzIGlt
cGxlbWVudGVkIGluIHRoZSBvdXRlciBzd2l0Y2gncwogICAgICAgICAgICAgICogVE9LX1ZBUiBj
YXNlLCBjb25kaXRpb25lZCBvbiBwbl94ZmxhZ3MgZmxhZ3Mgc2V0IGJ5IHRoZSBwYXJzZXIuCiAg
ICAgICAgICAgICAgKgpAQCAtNDk1NSwzMCArNTE0OSwyOCBAQCBqc19FbWl0VHJlZShKU0NvbnRl
eHQgKmN4LCBKU0NvZGVHZW5lcmF0CiAgICAgICAgICAgICAgKiBvcCB0aGF0IHNldHMgeCA9IGks
IGhvaXN0aW5nIHRoZSBpbml0aWFsaXplZCB2YXIgZGVjbGFyYXRpb24KICAgICAgICAgICAgICAq
IG91dCBvZiB0aGUgbG9vcDogJ3ZhciB4ID0gaTsgZm9yICh4IGluIG8pIC4uLicuCiAgICAgICAg
ICAgICAgKgogICAgICAgICAgICAgICogSW4gdGhlICdmb3IgKHZhciB4IGluIG8pIC4uLicgY2Fz
ZSwgbm90aGluZyBidXQgdGhlIHByb2xvZyBvcAogICAgICAgICAgICAgICogKGlmIG5lZWRlZCkg
c2hvdWxkIGJlIGdlbmVyYXRlZCBoZXJlLCB3ZSBtdXN0IGVtaXQgdGhlIG5vdGUKICAgICAgICAg
ICAgICAqIGp1c3QgYmVmb3JlIHRoZSBKU09QX0ZPUiogb3Bjb2RlIGluIHRoZSBzd2l0Y2ggb24g
cG4zLT5wbl90eXBlCiAgICAgICAgICAgICAgKiBhIGJpdCBiZWxvdywgc28gbm90aGluZyBpcyBo
b2lzdGVkOiAnZm9yICh2YXIgeCBpbiBvKSAuLi4nLgogICAgICAgICAgICAgICoKLSAgICAgICAg
ICAgICAqIEEgJ2ZvciAobGV0IHggPSBpIGluIG8pJyBsb29wIG11c3Qgbm90IGJlIGhvaXN0ZWQs
IHNpbmNlIGluCi0gICAgICAgICAgICAgKiB0aGlzIGZvcm0gdGhlIGxldCB2YXJpYWJsZSBpcyBz
Y29wZWQgYnkgdGhlIGxvb3AgYm9keSAoYnV0IG5vdAotICAgICAgICAgICAgICogdGhlIGhlYWQp
LiAgVGhlIGluaXRpYWxpemVyIGV4cHJlc3Npb24gaSBtdXN0IGJlIGV2YWx1YXRlZCBmb3IKLSAg
ICAgICAgICAgICAqIGFueSBzaWRlIGVmZmVjdHMuICBTbyB3ZSBob2lzdCBvbmx5IGkgaW4gdGhl
IGxldCBjYXNlLgorICAgICAgICAgICAgICogJ2ZvciAobGV0IHggPSBpIGluIG8pJyBpcyBtZXJj
aWZ1bGx5IGJhbm5lZC48Lz8/Pz4KICAgICAgICAgICAgICAqLwotICAgICAgICAgICAgcG4zID0g
cG4yLT5wbl9sZWZ0OwotICAgICAgICAgICAgdHlwZSA9IFBOX1RZUEUocG4zKTsKLSAgICAgICAg
ICAgIGNnLT5mbGFncyB8PSBUQ0ZfSU5fRk9SX0lOSVQ7Ci0gICAgICAgICAgICBpZiAoVG9rZW5L
aW5kSXNEZWNsKHR5cGUpICYmICFqc19FbWl0VHJlZShjeCwgY2csIHBuMykpCi0gICAgICAgICAg
ICAgICAgcmV0dXJuIEpTX0ZBTFNFOwotICAgICAgICAgICAgY2ctPmZsYWdzICY9IH5UQ0ZfSU5f
Rk9SX0lOSVQ7CisgICAgICAgICAgICBpZiAoSlNQYXJzZU5vZGUgKmRlY2wgPSBwbjItPnBuX2tp
ZDEpIHsKKyAgICAgICAgICAgICAgICBKU19BU1NFUlQoVG9rZW5LaW5kSXNEZWNsKFBOX1RZUEUo
ZGVjbCkpKTsKKyAgICAgICAgICAgICAgICBjZy0+ZmxhZ3MgfD0gVENGX0lOX0ZPUl9JTklUOwor
ICAgICAgICAgICAgICAgIGlmICghanNfRW1pdFRyZWUoY3gsIGNnLCBkZWNsKSkKKyAgICAgICAg
ICAgICAgICAgICAgcmV0dXJuIEpTX0ZBTFNFOworICAgICAgICAgICAgICAgIGNnLT5mbGFncyAm
PSB+VENGX0lOX0ZPUl9JTklUOworICAgICAgICAgICAgfQogCiAgICAgICAgICAgICAvKiBDb21w
aWxlIHRoZSBvYmplY3QgZXhwcmVzc2lvbiB0byB0aGUgcmlnaHQgb2YgJ2luJy4gKi8KLSAgICAg
ICAgICAgIGlmICghanNfRW1pdFRyZWUoY3gsIGNnLCBwbjItPnBuX3JpZ2h0KSkKKyAgICAgICAg
ICAgIGlmICghanNfRW1pdFRyZWUoY3gsIGNnLCBwbjItPnBuX2tpZDMpKQogICAgICAgICAgICAg
ICAgIHJldHVybiBKU19GQUxTRTsKIAogICAgICAgICAgICAgLyoKICAgICAgICAgICAgICAqIEVt
aXQgYSBieXRlY29kZSB0byBjb252ZXJ0IHRvcCBvZiBzdGFjayB2YWx1ZSB0byB0aGUgaXRlcmF0
b3IKICAgICAgICAgICAgICAqIG9iamVjdCBkZXBlbmRpbmcgb24gdGhlIGxvb3AgdmFyaWFudCAo
Zm9yLWluLCBmb3ItZWFjaC1pbiwgb3IKICAgICAgICAgICAgICAqIGRlc3RydWN0dXJpbmcgZm9y
LWluKS4KICAgICAgICAgICAgICAqLwogICAgICAgICAgICAgSlNfQVNTRVJUKHBuLT5wbl9vcCA9
PSBKU09QX0lURVIpOwpAQCAtNTAwNywxNjYgKzUxOTksNDMgQEAganNfRW1pdFRyZWUoSlNDb250
ZXh0ICpjeCwgSlNDb2RlR2VuZXJhdAogICAgICAgICAgICAgaWYgKEVtaXRUcmFjZU9wKGN4LCBj
ZykgPCAwKQogICAgICAgICAgICAgICAgIHJldHVybiBKU19GQUxTRTsKIAogI2lmZGVmIERFQlVH
CiAgICAgICAgICAgICBpbnROIGxvb3BEZXB0aCA9IGNnLT5zdGFja0RlcHRoOwogI2VuZGlmCiAK
ICAgICAgICAgICAgIC8qCi0gICAgICAgICAgICAgKiBDb21waWxlIGEgSlNPUF9GT1IqIGJ5dGVj
b2RlIGJhc2VkIG9uIHRoZSBsZWZ0IGhhbmQgc2lkZS4KKyAgICAgICAgICAgICAqIEVtaXQgY29k
ZSB0byBnZXQgdGhlIG5leHQgZW51bWVyYXRpb24gdmFsdWUgYW5kIGFzc2lnbiBpdCB0byB0aGUK
KyAgICAgICAgICAgICAqIGxlZnQgaGFuZCBzaWRlLiBUaGUgSlNPUF9QT1AgYWZ0ZXIgdGhpcyBh
c3NpZ25tZW50IGlzIGFubm90YXRlZAorICAgICAgICAgICAgICogc28gdGhhdCB0aGUgZGVjb21w
aWxlciBjYW4gZGlzdGluZ3Vpc2ggYGZvciAoeCBpbiB5KWAgZnJvbQorICAgICAgICAgICAgICog
YGZvciAodmFyIHggaW4geSlgLgogICAgICAgICAgICAgICoKLSAgICAgICAgICAgICAqIEluaXRp
YWxpemUgb3AgdG8gSlNPUF9TRVROQU1FIGluIGNhc2Ugb2YgfGZvciAoW2EsIGJdIGluIG8pLi4u
fAorICAgICAgICAgICAgICogPD8/Pz5Jbml0aWFsaXplIG9wIHRvIEpTT1BfU0VUTkFNRSBpbiBj
YXNlIG9mIHxmb3IgKFthLCBiXSBpbiBvKS4uLnwKICAgICAgICAgICAgICAqIG9yIHNpbWlsYXIs
IHRvIHNpZ25pZnkgYXNzaWdubWVudCwgcmF0aGVyIHRoYW4gZGVjbGFyYXRpb24sIHRvCiAgICAg
ICAgICAgICAgKiB0aGUgZGVjb21waWxlci4gIEVtaXREZXN0cnVjdHVyaW5nT3BzIHRha2VzIGEg
cHJvbG9nIGJ5dGVjb2RlCiAgICAgICAgICAgICAgKiBwYXJhbWV0ZXIgYW5kIGVtaXRzIHRoZSBh
cHByb3ByaWF0ZSBzb3VyY2Ugbm90ZSwgZGVmYXVsdGluZyB0bwogICAgICAgICAgICAgICogYXNz
aWdubWVudCwgc28gSlNPUF9TRVROQU1FIGlzIG5vdCBjcml0aWNhbCBoZXJlOyBtYW55IHNpbWls
YXIKLSAgICAgICAgICAgICAqIG9wcyBjb3VsZCBiZSB1c2VkIC0tIGp1c3Qgbm90IEpTT1BfTk9Q
ICh3aGljaCBtZWFucyAnbGV0JykuCisgICAgICAgICAgICAgKiBvcHMgY291bGQgYmUgdXNlZCAt
LSBqdXN0IG5vdCBKU09QX05PUCAod2hpY2ggbWVhbnMgJ2xldCcpLjwvPz8/PgogICAgICAgICAg
ICAgICovCi0gICAgICAgICAgICBvcCA9IEpTT1BfU0VUTkFNRTsKLSAgICAgICAgICAgIHN3aXRj
aCAodHlwZSkgewotI2lmIEpTX0hBU19CTE9DS19TQ09QRQotICAgICAgICAgICAgICBjYXNlIFRP
S19MRVQ6Ci0jZW5kaWYKLSAgICAgICAgICAgICAgY2FzZSBUT0tfVkFSOgotICAgICAgICAgICAg
ICAgIEpTX0FTU0VSVChwbjMtPnBuX2FyaXR5ID09IFBOX0xJU1QgJiYgcG4zLT5wbl9jb3VudCA9
PSAxKTsKLSAgICAgICAgICAgICAgICBwbjMgPSBwbjMtPnBuX2hlYWQ7Ci0jaWYgSlNfSEFTX0RF
U1RSVUNUVVJJTkcKLSAgICAgICAgICAgICAgICBpZiAocG4zLT5wbl90eXBlID09IFRPS19BU1NJ
R04pIHsKLSAgICAgICAgICAgICAgICAgICAgcG4zID0gcG4zLT5wbl9sZWZ0OwotICAgICAgICAg
ICAgICAgICAgICBKU19BU1NFUlQocG4zLT5wbl90eXBlID09IFRPS19SQiB8fCBwbjMtPnBuX3R5
cGUgPT0gVE9LX1JDKTsKLSAgICAgICAgICAgICAgICB9Ci0gICAgICAgICAgICAgICAgaWYgKHBu
My0+cG5fdHlwZSA9PSBUT0tfUkIgfHwgcG4zLT5wbl90eXBlID09IFRPS19SQykgewotICAgICAg
ICAgICAgICAgICAgICBvcCA9IFBOX09QKHBuMi0+cG5fbGVmdCk7Ci0gICAgICAgICAgICAgICAg
ICAgIGdvdG8gZGVzdHJ1Y3R1cmluZ19mb3I7Ci0gICAgICAgICAgICAgICAgfQotI2Vsc2UKLSAg
ICAgICAgICAgICAgICBKU19BU1NFUlQocG4zLT5wbl90eXBlID09IFRPS19OQU1FKTsKLSNlbmRp
ZgotICAgICAgICAgICAgICAgIC8qIEZBTEwgVEhST1VHSCAqLwotCi0gICAgICAgICAgICAgIGNh
c2UgVE9LX05BTUU6Ci0gICAgICAgICAgICAgIHsKLSAgICAgICAgICAgICAgICAvKgotICAgICAg
ICAgICAgICAgICAqIEFsd2F5cyBhbm5vdGF0ZSBKU09QX0ZPUkxPQ0FMIGlmIGdpdmVuIGlucHV0
IG9mIHRoZSBmb3JtCi0gICAgICAgICAgICAgICAgICogJ2ZvciAobGV0IHggaW4gKiBvKScgLS0g
dGhlIGRlY29tcGlsZXIgbXVzdCBub3QgaG9pc3QgdGhlCi0gICAgICAgICAgICAgICAgICogJ2xl
dCB4JyBvdXQgb2YgdGhlIGxvb3AgaGVhZCwgb3IgeCB3aWxsIGJlIGJvdW5kIGluIHRoZQotICAg
ICAgICAgICAgICAgICAqIHdyb25nIHNjb3BlLiAgTGlrZXdpc2UsIGJ1dCBpbiB0aGlzIGNhc2Ug
b25seSBmb3IgdGhlIHNha2UKLSAgICAgICAgICAgICAgICAgKiBvZiBoaWdoZXIgZGVjb21waWxh
dGlvbiBmaWRlbGl0eSBvbmx5LCBkbyBub3QgaG9pc3QgJ3ZhciB4JwotICAgICAgICAgICAgICAg
ICAqIHdoZW4gZ2l2ZW4gJ2ZvciAodmFyIHggaW4gbyknLgotICAgICAgICAgICAgICAgICAqLwot
ICAgICAgICAgICAgICAgIGlmICgoCi0jaWYgSlNfSEFTX0JMT0NLX1NDT1BFCi0gICAgICAgICAg
ICAgICAgICAgICB0eXBlID09IFRPS19MRVQgfHwKLSNlbmRpZgotICAgICAgICAgICAgICAgICAg
ICAgKHR5cGUgPT0gVE9LX1ZBUiAmJiAhcG4zLT5tYXliZUV4cHIoKSkpICYmCi0gICAgICAgICAg
ICAgICAgICAgIGpzX05ld1NyY05vdGUyKGN4LCBjZywgU1JDX0RFQ0wsCi0gICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICh0eXBlID09IFRPS19WQVIpCi0gICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgID8gU1JDX0RFQ0xfVkFSCi0gICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgIDogU1JDX0RFQ0xfTEVUKSA8IDApIHsKLSAgICAgICAgICAgICAgICAgICAg
cmV0dXJuIEpTX0ZBTFNFOwotICAgICAgICAgICAgICAgIH0KLSAgICAgICAgICAgICAgICBVcHZh
ckNvb2tpZSBjb29raWUgPSBwbjMtPnBuX2Nvb2tpZTsKLSAgICAgICAgICAgICAgICBpZiAoIWNv
b2tpZS5pc0ZyZWUoKSkgewotICAgICAgICAgICAgICAgICAgICBvcCA9IFBOX09QKHBuMyk7Ci0g
ICAgICAgICAgICAgICAgICAgIHN3aXRjaCAob3ApIHsKLSAgICAgICAgICAgICAgICAgICAgICBj
YXNlIEpTT1BfR0VUQVJHOgotICAgICAgICAgICAgICAgICAgICAgIGNhc2UgSlNPUF9TRVRBUkc6
Ci0gICAgICAgICAgICAgICAgICAgICAgICBvcCA9IEpTT1BfRk9SQVJHOwotICAgICAgICAgICAg
ICAgICAgICAgICAgYnJlYWs7Ci0gICAgICAgICAgICAgICAgICAgICAgY2FzZSBKU09QX0dFVExP
Q0FMOgotICAgICAgICAgICAgICAgICAgICAgIGNhc2UgSlNPUF9TRVRMT0NBTDoKLSAgICAgICAg
ICAgICAgICAgICAgICAgIG9wID0gSlNPUF9GT1JMT0NBTDsKLSAgICAgICAgICAgICAgICAgICAg
ICAgIGJyZWFrOwotICAgICAgICAgICAgICAgICAgICAgIGNhc2UgSlNPUF9HRVRHTE9CQUw6Ci0g
ICAgICAgICAgICAgICAgICAgICAgICBvcCA9IEpTT1BfRk9SR05BTUU7Ci0gICAgICAgICAgICAg
ICAgICAgICAgICBjb29raWUubWFrZUZyZWUoKTsKLSAgICAgICAgICAgICAgICAgICAgICAgIGJy
ZWFrOwotICAgICAgICAgICAgICAgICAgICAgIGRlZmF1bHQ6Ci0gICAgICAgICAgICAgICAgICAg
ICAgICBKU19OT1RfUkVBQ0hFRCgidW5leHBlY3RlZCBvcGNvZGUiKTsKLSAgICAgICAgICAgICAg
ICAgICAgfQotICAgICAgICAgICAgICAgIH0gZWxzZSB7Ci0gICAgICAgICAgICAgICAgICAgIHBu
My0+cG5fb3AgPSBKU09QX0ZPUk5BTUU7Ci0gICAgICAgICAgICAgICAgICAgIGlmICghQmluZE5h
bWVUb1Nsb3QoY3gsIGNnLCBwbjMpKQotICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIEpT
X0ZBTFNFOwotICAgICAgICAgICAgICAgICAgICBvcCA9IFBOX09QKHBuMyk7Ci0gICAgICAgICAg
ICAgICAgICAgIGNvb2tpZSA9IHBuMy0+cG5fY29va2llOwotICAgICAgICAgICAgICAgIH0KLSAg
ICAgICAgICAgICAgICBpZiAocG4zLT5pc0NvbnN0KCkpIHsKLSAgICAgICAgICAgICAgICAgICAg
UmVwb3J0Q29tcGlsZUVycm9yTnVtYmVyKGN4LCBDR19UUyhjZyksIHBuMywgSlNSRVBPUlRfRVJS
T1IsCi0gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBKU01TR19C
QURfRk9SX0xFRlRTSURFKTsKLSAgICAgICAgICAgICAgICAgICAgcmV0dXJuIEpTX0ZBTFNFOwot
ICAgICAgICAgICAgICAgIH0KLSAgICAgICAgICAgICAgICBpZiAoIWNvb2tpZS5pc0ZyZWUoKSkg
ewotICAgICAgICAgICAgICAgICAgICBhdG9tSW5kZXggPSAoanNhdG9taWQpIGNvb2tpZS5hc0lu
dGVnZXIoKTsKLSAgICAgICAgICAgICAgICAgICAgRU1JVF9VSU5UMTZfSU1NX09QKG9wLCBhdG9t
SW5kZXgpOwotICAgICAgICAgICAgICAgIH0gZWxzZSB7Ci0gICAgICAgICAgICAgICAgICAgIGlm
ICghRW1pdEF0b21PcChjeCwgcG4zLCBvcCwgY2cpKQotICAgICAgICAgICAgICAgICAgICAgICAg
cmV0dXJuIEpTX0ZBTFNFOwotICAgICAgICAgICAgICAgIH0KLSAgICAgICAgICAgICAgICBicmVh
azsKLSAgICAgICAgICAgICAgfQotCi0gICAgICAgICAgICAgIGNhc2UgVE9LX0RPVDoKLSAgICAg
ICAgICAgICAgICAvKgotICAgICAgICAgICAgICAgICAqICdmb3IgKG8ucCBpbiBxKScgY2FuIHVz
ZSBKU09QX0ZPUlBST1Agb25seSBpZiBldmFsdWF0aW5nICdvJwotICAgICAgICAgICAgICAgICAq
IGhhcyBubyBzaWRlIGVmZmVjdHMuCi0gICAgICAgICAgICAgICAgICovCi0gICAgICAgICAgICAg
ICAgdXNlZnVsID0gSlNfRkFMU0U7Ci0gICAgICAgICAgICAgICAgaWYgKCFDaGVja1NpZGVFZmZl
Y3RzKGN4LCBjZywgcG4zLT5leHByKCksICZ1c2VmdWwpKQotICAgICAgICAgICAgICAgICAgICBy
ZXR1cm4gSlNfRkFMU0U7Ci0gICAgICAgICAgICAgICAgaWYgKCF1c2VmdWwpIHsKLSAgICAgICAg
ICAgICAgICAgICAgaWYgKCFFbWl0UHJvcE9wKGN4LCBwbjMsIEpTT1BfRk9SUFJPUCwgY2csIEpT
X0ZBTFNFKSkKLSAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBKU19GQUxTRTsKLSAgICAg
ICAgICAgICAgICAgICAgYnJlYWs7Ci0gICAgICAgICAgICAgICAgfQotICAgICAgICAgICAgICAg
IC8qIEZBTEwgVEhST1VHSCAqLwotCi0jaWYgSlNfSEFTX0RFU1RSVUNUVVJJTkcKLSAgICAgICAg
ICAgICAgZGVzdHJ1Y3R1cmluZ19mb3I6Ci0jZW5kaWYKLSAgICAgICAgICAgICAgZGVmYXVsdDoK
LSAgICAgICAgICAgICAgICBpZiAoanNfRW1pdDEoY3gsIGNnLCBKU09QX0ZPUkVMRU0pIDwgMCkK
LSAgICAgICAgICAgICAgICAgICAgcmV0dXJuIEpTX0ZBTFNFOwotICAgICAgICAgICAgICAgIEpT
X0FTU0VSVChjZy0+c3RhY2tEZXB0aCA+PSAyKTsKLQotI2lmIEpTX0hBU19ERVNUUlVDVFVSSU5H
Ci0gICAgICAgICAgICAgICAgaWYgKHBuMy0+cG5fdHlwZSA9PSBUT0tfUkIgfHwgcG4zLT5wbl90
eXBlID09IFRPS19SQykgewotICAgICAgICAgICAgICAgICAgICBpZiAoIUVtaXREZXN0cnVjdHVy
aW5nT3BzKGN4LCBjZywgb3AsIHBuMykpCi0gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4g
SlNfRkFMU0U7Ci0gICAgICAgICAgICAgICAgICAgIGlmIChqc19FbWl0MShjeCwgY2csIEpTT1Bf
UE9QKSA8IDApCi0gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gSlNfRkFMU0U7Ci0gICAg
ICAgICAgICAgICAgfSBlbHNlCi0jZW5kaWYKLSAgICAgICAgICAgICAgICBpZiAocG4zLT5wbl90
eXBlID09IFRPS19MUCkgewotICAgICAgICAgICAgICAgICAgICBKU19BU1NFUlQocG4zLT5wbl94
ZmxhZ3MgJiBQTlhfU0VUQ0FMTCk7Ci0gICAgICAgICAgICAgICAgICAgIGlmICghanNfRW1pdFRy
ZWUoY3gsIGNnLCBwbjMpKQotICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIEpTX0ZBTFNF
OwotICAgICAgICAgICAgICAgICAgICBpZiAoanNfRW1pdDEoY3gsIGNnLCBKU09QX0VOVU1FTEVN
KSA8IDApCi0gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gSlNfRkFMU0U7Ci0gICAgICAg
ICAgICAgICAgfSBlbHNlCi0jaWYgSlNfSEFTX1hNTF9TVVBQT1JUCi0gICAgICAgICAgICAgICAg
aWYgKHBuMy0+cG5fdHlwZSA9PSBUT0tfVU5BUllPUCkgewotICAgICAgICAgICAgICAgICAgICBK
U19BU1NFUlQocG4zLT5wbl9vcCA9PSBKU09QX0JJTkRYTUxOQU1FKTsKLSAgICAgICAgICAgICAg
ICAgICAgaWYgKCFqc19FbWl0VHJlZShjeCwgY2csIHBuMykpCi0gICAgICAgICAgICAgICAgICAg
ICAgICByZXR1cm4gSlNfRkFMU0U7Ci0gICAgICAgICAgICAgICAgICAgIGlmIChqc19FbWl0MShj
eCwgY2csIEpTT1BfRU5VTUVMRU0pIDwgMCkKLSAgICAgICAgICAgICAgICAgICAgICAgIHJldHVy
biBKU19GQUxTRTsKLSAgICAgICAgICAgICAgICB9IGVsc2UKLSNlbmRpZgotICAgICAgICAgICAg
ICAgIGlmICghRW1pdEVsZW1PcChjeCwgcG4zLCBKU09QX0VOVU1FTEVNLCBjZykpCi0gICAgICAg
ICAgICAgICAgICAgIHJldHVybiBKU19GQUxTRTsKLSAgICAgICAgICAgICAgICBicmVhazsKKyAg
ICAgICAgICAgIGlmICghRW1pdEFzc2lnbm1lbnQoY3gsIGNnLCBwbjItPnBuX2tpZDIsIEpTT1Bf
Tk9QLCBOVUxMKSkKKyAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7CisgICAgICAgICAgICB0
bXAyID0gQ0dfT0ZGU0VUKGNnKTsKKyAgICAgICAgICAgIGlmIChwbjItPnBuX2tpZDEgJiYgIWpz
X05ld1NyY05vdGUyKGN4LCBjZywgU1JDX0RFQ0wsCisgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAocG4yLT5wbl9raWQxLT5wbl9vcCA9PSBKU09QX0RFRlZB
UikKKyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgID8gU1JD
X0RFQ0xfVkFSCisgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICA6IFNSQ19ERUNMX0xFVCkgPCAwKSB7CisgICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwog
ICAgICAgICAgICAgfQotCi0gICAgICAgICAgICAvKiBUaGUgc3RhY2sgc2hvdWxkIGJlIGJhbGFu
Y2VkIGFyb3VuZCB0aGUgSlNPUF9GT1IqIG9wY29kZSBzZXF1ZW5jZS4gKi8KKyAgICAgICAgICAg
IGlmIChqc19FbWl0MShjeCwgY2csIEpTT1BfUE9QKSA8IDApCisgICAgICAgICAgICAgICAgcmV0
dXJuIGZhbHNlOworCisgICAgICAgICAgICAvKiBUaGUgc3RhY2sgc2hvdWxkIGJlIGJhbGFuY2Vk
IGFyb3VuZCB0aGUgYXNzaWdubWVudCBvcGNvZGUgc2VxdWVuY2UuICovCiAgICAgICAgICAgICBK
U19BU1NFUlQoY2ctPnN0YWNrRGVwdGggPT0gbG9vcERlcHRoKTsKIAotICAgICAgICAgICAgdG1w
MiA9IENHX09GRlNFVChjZyk7Ci0KICAgICAgICAgICAgIC8qIEVtaXQgY29kZSBmb3IgdGhlIGxv
b3AgYm9keS4gKi8KICAgICAgICAgICAgIGlmICghanNfRW1pdFRyZWUoY3gsIGNnLCBwbi0+cG5f
cmlnaHQpKQogICAgICAgICAgICAgICAgIHJldHVybiBKU19GQUxTRTsKIAogICAgICAgICAgICAg
LyogU2V0IGxvb3AgYW5kIGVuY2xvc2luZyAidXBkYXRlIiBvZmZzZXRzLCBmb3IgY29udGludWUu
ICovCiAgICAgICAgICAgICBzdG10ID0gJnN0bXRJbmZvOwogICAgICAgICAgICAgZG8gewogICAg
ICAgICAgICAgICAgIHN0bXQtPnVwZGF0ZSA9IENHX09GRlNFVChjZyk7CkBAIC02MDUzLDE5NCAr
NjEyMiwxOCBAQCBqc19FbWl0VHJlZShKU0NvbnRleHQgKmN4LCBKU0NvZGVHZW5lcmF0CiAgICAg
ICAgICAgICBpZiAobm90ZUluZGV4IDwgMCB8fAogICAgICAgICAgICAgICAgIGpzX0VtaXQxKGN4
LCBjZywgSlNPUF9QT1ApIDwgMCkgewogICAgICAgICAgICAgICAgIHJldHVybiBKU19GQUxTRTsK
ICAgICAgICAgICAgIH0KICAgICAgICAgfQogICAgICAgICBicmVhazsKIAogICAgICAgY2FzZSBU
T0tfQVNTSUdOOgotICAgICAgICAvKgotICAgICAgICAgKiBDaGVjayBsZWZ0IG9wZXJhbmQgdHlw
ZSBhbmQgZ2VuZXJhdGUgc3BlY2lhbGl6ZWQgY29kZSBmb3IgaXQuCi0gICAgICAgICAqIFNwZWNp
YWxpemUgdG8gYXZvaWQgRUNNQSAicmVmZXJlbmNlIHR5cGUiIHZhbHVlcyBvbiB0aGUgb3BlcmFu
ZAotICAgICAgICAgKiBzdGFjaywgd2hpY2ggaW1wb3NlIHBlcnZhc2l2ZSBydW50aW1lICJHZXRW
YWx1ZSIgY29zdHMuCi0gICAgICAgICAqLwotICAgICAgICBwbjIgPSBwbi0+cG5fbGVmdDsKLSAg
ICAgICAgYXRvbUluZGV4ID0gKGpzYXRvbWlkKSAtMTsgICAgICAgICAgICAgIC8qIHF1ZWxsIEdD
QyBvdmVyd2FybmluZyAqLwotICAgICAgICBzd2l0Y2ggKFBOX1RZUEUocG4yKSkgewotICAgICAg
ICAgIGNhc2UgVE9LX05BTUU6Ci0gICAgICAgICAgICBpZiAoIUJpbmROYW1lVG9TbG90KGN4LCBj
ZywgcG4yKSkKLSAgICAgICAgICAgICAgICByZXR1cm4gSlNfRkFMU0U7Ci0gICAgICAgICAgICBp
ZiAoIXBuMi0+cG5fY29va2llLmlzRnJlZSgpKSB7Ci0gICAgICAgICAgICAgICAgYXRvbUluZGV4
ID0gKGpzYXRvbWlkKSBwbjItPnBuX2Nvb2tpZS5hc0ludGVnZXIoKTsKLSAgICAgICAgICAgIH0g
ZWxzZSB7Ci0gICAgICAgICAgICAgICAgYWxlID0gY2ctPmF0b21MaXN0LmFkZChjZy0+cGFyc2Vy
LCBwbjItPnBuX2F0b20pOwotICAgICAgICAgICAgICAgIGlmICghYWxlKQotICAgICAgICAgICAg
ICAgICAgICByZXR1cm4gSlNfRkFMU0U7Ci0gICAgICAgICAgICAgICAgYXRvbUluZGV4ID0gQUxF
X0lOREVYKGFsZSk7Ci0gICAgICAgICAgICAgICAgaWYgKCFwbjItPmlzQ29uc3QoKSkgewotICAg
ICAgICAgICAgICAgICAgICBKU09wIG9wID0gUE5fT1AocG4yKSA9PSBKU09QX1NFVEdOQU1FID8g
SlNPUF9CSU5ER05BTUUgOiBKU09QX0JJTkROQU1FOwotICAgICAgICAgICAgICAgICAgICBFTUlU
X0lOREVYX09QKG9wLCBhdG9tSW5kZXgpOwotICAgICAgICAgICAgICAgIH0KLSAgICAgICAgICAg
IH0KLSAgICAgICAgICAgIGJyZWFrOwotICAgICAgICAgIGNhc2UgVE9LX0RPVDoKLSAgICAgICAg
ICAgIGlmICghanNfRW1pdFRyZWUoY3gsIGNnLCBwbjItPmV4cHIoKSkpCi0gICAgICAgICAgICAg
ICAgcmV0dXJuIEpTX0ZBTFNFOwotICAgICAgICAgICAgYWxlID0gY2ctPmF0b21MaXN0LmFkZChj
Zy0+cGFyc2VyLCBwbjItPnBuX2F0b20pOwotICAgICAgICAgICAgaWYgKCFhbGUpCi0gICAgICAg
ICAgICAgICAgcmV0dXJuIEpTX0ZBTFNFOwotICAgICAgICAgICAgYXRvbUluZGV4ID0gQUxFX0lO
REVYKGFsZSk7Ci0gICAgICAgICAgICBicmVhazsKLSAgICAgICAgICBjYXNlIFRPS19MQjoKLSAg
ICAgICAgICAgIEpTX0FTU0VSVChwbjItPnBuX2FyaXR5ID09IFBOX0JJTkFSWSk7Ci0gICAgICAg
ICAgICBpZiAoIWpzX0VtaXRUcmVlKGN4LCBjZywgcG4yLT5wbl9sZWZ0KSkKLSAgICAgICAgICAg
ICAgICByZXR1cm4gSlNfRkFMU0U7Ci0gICAgICAgICAgICBpZiAoIWpzX0VtaXRUcmVlKGN4LCBj
ZywgcG4yLT5wbl9yaWdodCkpCi0gICAgICAgICAgICAgICAgcmV0dXJuIEpTX0ZBTFNFOwotICAg
ICAgICAgICAgYnJlYWs7Ci0jaWYgSlNfSEFTX0RFU1RSVUNUVVJJTkcKLSAgICAgICAgICBjYXNl
IFRPS19SQjoKLSAgICAgICAgICBjYXNlIFRPS19SQzoKLSAgICAgICAgICAgIGJyZWFrOwotI2Vu
ZGlmCi0gICAgICAgICAgY2FzZSBUT0tfTFA6Ci0gICAgICAgICAgICBpZiAoIWpzX0VtaXRUcmVl
KGN4LCBjZywgcG4yKSkKLSAgICAgICAgICAgICAgICByZXR1cm4gSlNfRkFMU0U7Ci0gICAgICAg
ICAgICBicmVhazsKLSNpZiBKU19IQVNfWE1MX1NVUFBPUlQKLSAgICAgICAgICBjYXNlIFRPS19V
TkFSWU9QOgotICAgICAgICAgICAgSlNfQVNTRVJUKHBuMi0+cG5fb3AgPT0gSlNPUF9TRVRYTUxO
QU1FKTsKLSAgICAgICAgICAgIGlmICghanNfRW1pdFRyZWUoY3gsIGNnLCBwbjItPnBuX2tpZCkp
Ci0gICAgICAgICAgICAgICAgcmV0dXJuIEpTX0ZBTFNFOwotICAgICAgICAgICAgaWYgKGpzX0Vt
aXQxKGN4LCBjZywgSlNPUF9CSU5EWE1MTkFNRSkgPCAwKQotICAgICAgICAgICAgICAgIHJldHVy
biBKU19GQUxTRTsKLSAgICAgICAgICAgIGJyZWFrOwotI2VuZGlmCi0gICAgICAgICAgZGVmYXVs
dDoKLSAgICAgICAgICAgIEpTX0FTU0VSVCgwKTsKLSAgICAgICAgfQotCi0gICAgICAgIG9wID0g
UE5fT1AocG4pOwotICAgICAgICBpZiAob3AgIT0gSlNPUF9OT1ApIHsKLSAgICAgICAgICAgIHN3
aXRjaCAocG4yLT5wbl90eXBlKSB7Ci0gICAgICAgICAgICAgIGNhc2UgVE9LX05BTUU6Ci0gICAg
ICAgICAgICAgICAgaWYgKHBuMi0+aXNDb25zdCgpKSB7Ci0gICAgICAgICAgICAgICAgICAgIGlm
IChQTl9PUChwbjIpID09IEpTT1BfQ0FMTEVFKSB7Ci0gICAgICAgICAgICAgICAgICAgICAgICBp
ZiAoanNfRW1pdDEoY3gsIGNnLCBKU09QX0NBTExFRSkgPCAwKQotICAgICAgICAgICAgICAgICAg
ICAgICAgICAgIHJldHVybiBKU19GQUxTRTsKLSAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHsK
LSAgICAgICAgICAgICAgICAgICAgICAgIEVNSVRfSU5ERVhfT1AoUE5fT1AocG4yKSwgYXRvbUlu
ZGV4KTsKLSAgICAgICAgICAgICAgICAgICAgfQotICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAo
UE5fT1AocG4yKSA9PSBKU09QX1NFVE5BTUUpIHsKLSAgICAgICAgICAgICAgICAgICAgaWYgKGpz
X0VtaXQxKGN4LCBjZywgSlNPUF9EVVApIDwgMCkKLSAgICAgICAgICAgICAgICAgICAgICAgIHJl
dHVybiBKU19GQUxTRTsKLSAgICAgICAgICAgICAgICAgICAgRU1JVF9JTkRFWF9PUChKU09QX0dF
VFhQUk9QLCBhdG9tSW5kZXgpOwotICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAoUE5fT1AocG4y
KSA9PSBKU09QX1NFVEdOQU1FKSB7Ci0gICAgICAgICAgICAgICAgICAgIGlmICghQmluZEdsb2Jh
bChjeCwgY2csIHBuMiwgcG4yLT5wbl9hdG9tKSkKLSAgICAgICAgICAgICAgICAgICAgICAgIHJl
dHVybiBKU19GQUxTRTsKLSAgICAgICAgICAgICAgICAgICAgaWYgKHBuMi0+cG5fY29va2llLmlz
RnJlZSgpKQotICAgICAgICAgICAgICAgICAgICAgICAgRW1pdEF0b21PcChjeCwgcG4yLCBKU09Q
X0dFVEdOQU1FLCBjZyk7Ci0gICAgICAgICAgICAgICAgICAgIGVsc2UKLSAgICAgICAgICAgICAg
ICAgICAgICAgIEVNSVRfVUlOVDE2X0lNTV9PUChKU09QX0dFVEdMT0JBTCwgcG4yLT5wbl9jb29r
aWUuYXNJbnRlZ2VyKCkpOwotICAgICAgICAgICAgICAgIH0gZWxzZSB7Ci0gICAgICAgICAgICAg
ICAgICAgIEVNSVRfVUlOVDE2X0lNTV9PUCgoUE5fT1AocG4yKSA9PSBKU09QX1NFVEFSRykKLSAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgID8gSlNPUF9HRVRBUkcKLSAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDogSlNPUF9HRVRMT0NBTCwKLSAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGF0b21JbmRleCk7Ci0gICAgICAgICAg
ICAgICAgfQotICAgICAgICAgICAgICAgIGJyZWFrOwotICAgICAgICAgICAgICBjYXNlIFRPS19E
T1Q6Ci0gICAgICAgICAgICAgICAgaWYgKGpzX0VtaXQxKGN4LCBjZywgSlNPUF9EVVApIDwgMCkK
LSAgICAgICAgICAgICAgICAgICAgcmV0dXJuIEpTX0ZBTFNFOwotICAgICAgICAgICAgICAgIGlm
IChwbjItPnBuX2F0b20gPT0gY3gtPnJ1bnRpbWUtPmF0b21TdGF0ZS5sZW5ndGhBdG9tKSB7Ci0g
ICAgICAgICAgICAgICAgICAgIGlmIChqc19FbWl0MShjeCwgY2csIEpTT1BfTEVOR1RIKSA8IDAp
Ci0gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gSlNfRkFMU0U7Ci0gICAgICAgICAgICAg
ICAgfSBlbHNlIGlmIChwbjItPnBuX2F0b20gPT0gY3gtPnJ1bnRpbWUtPmF0b21TdGF0ZS5wcm90
b0F0b20pIHsKLSAgICAgICAgICAgICAgICAgICAgaWYgKCFFbWl0SW5kZXhPcChjeCwgSlNPUF9R
TkFNRVBBUlQsIGF0b21JbmRleCwgY2cpKQotICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJu
IEpTX0ZBTFNFOwotICAgICAgICAgICAgICAgICAgICBpZiAoanNfRW1pdDEoY3gsIGNnLCBKU09Q
X0dFVEVMRU0pIDwgMCkKLSAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBKU19GQUxTRTsK
LSAgICAgICAgICAgICAgICB9IGVsc2UgewotICAgICAgICAgICAgICAgICAgICBFTUlUX0lOREVY
X09QKEpTT1BfR0VUUFJPUCwgYXRvbUluZGV4KTsKLSAgICAgICAgICAgICAgICB9Ci0gICAgICAg
ICAgICAgICAgYnJlYWs7Ci0gICAgICAgICAgICAgIGNhc2UgVE9LX0xCOgotICAgICAgICAgICAg
ICBjYXNlIFRPS19MUDoKLSNpZiBKU19IQVNfWE1MX1NVUFBPUlQKLSAgICAgICAgICAgICAgY2Fz
ZSBUT0tfVU5BUllPUDoKLSNlbmRpZgotICAgICAgICAgICAgICAgIGlmIChqc19FbWl0MShjeCwg
Y2csIEpTT1BfRFVQMikgPCAwKQotICAgICAgICAgICAgICAgICAgICByZXR1cm4gSlNfRkFMU0U7
Ci0gICAgICAgICAgICAgICAgaWYgKGpzX0VtaXQxKGN4LCBjZywgSlNPUF9HRVRFTEVNKSA8IDAp
Ci0gICAgICAgICAgICAgICAgICAgIHJldHVybiBKU19GQUxTRTsKLSAgICAgICAgICAgICAgICBi
cmVhazsKLSAgICAgICAgICAgICAgZGVmYXVsdDo7Ci0gICAgICAgICAgICB9Ci0gICAgICAgIH0K
LQotICAgICAgICAvKiBOb3cgZW1pdCB0aGUgcmlnaHQgb3BlcmFuZCAoaXQgbWF5IGFmZmVjdCB0
aGUgbmFtZXNwYWNlKS4gKi8KLSAgICAgICAgaWYgKCFqc19FbWl0VHJlZShjeCwgY2csIHBuLT5w
bl9yaWdodCkpCi0gICAgICAgICAgICByZXR1cm4gSlNfRkFMU0U7Ci0KLSAgICAgICAgLyogSWYg
Kz0gZXRjLiwgZW1pdCB0aGUgYmluYXJ5IG9wZXJhdG9yIHdpdGggYSBkZWNvbXBpbGVyIG5vdGUu
ICovCi0gICAgICAgIGlmIChvcCAhPSBKU09QX05PUCkgewotICAgICAgICAgICAgLyoKLSAgICAg
ICAgICAgICAqIFRha2UgY2FyZSB0byBhdm9pZCBTUkNfQVNTSUdOT1AgaWYgdGhlIGxlZnQtaGFu
ZCBzaWRlIGlzIGEgY29uc3QKLSAgICAgICAgICAgICAqIGRlY2xhcmVkIGluIHRoZSBjdXJyZW50
IGNvbXBpbGF0aW9uIHVuaXQsIGFzIGluIHRoaXMgY2FzZSAoanVzdAotICAgICAgICAgICAgICog
YSBiaXQgZnVydGhlciBiZWxvdykgd2Ugd2lsbCBhdm9pZCBlbWl0dGluZyB0aGUgYXNzaWdubWVu
dCBvcC4KLSAgICAgICAgICAgICAqLwotICAgICAgICAgICAgaWYgKHBuMi0+cG5fdHlwZSAhPSBU
T0tfTkFNRSB8fCAhcG4yLT5pc0NvbnN0KCkpIHsKLSAgICAgICAgICAgICAgICBpZiAoanNfTmV3
U3JjTm90ZShjeCwgY2csIFNSQ19BU1NJR05PUCkgPCAwKQotICAgICAgICAgICAgICAgICAgICBy
ZXR1cm4gSlNfRkFMU0U7Ci0gICAgICAgICAgICB9Ci0gICAgICAgICAgICBpZiAoanNfRW1pdDEo
Y3gsIGNnLCBvcCkgPCAwKQotICAgICAgICAgICAgICAgIHJldHVybiBKU19GQUxTRTsKLSAgICAg
ICAgfQotCi0gICAgICAgIC8qIExlZnQgcGFydHMgc3VjaCBhcyBhLmIuYyBhbmQgYVtiXS5jIG5l
ZWQgYSBkZWNvbXBpbGVyIG5vdGUuICovCi0gICAgICAgIGlmIChwbjItPnBuX3R5cGUgIT0gVE9L
X05BTUUgJiYKLSNpZiBKU19IQVNfREVTVFJVQ1RVUklORwotICAgICAgICAgICAgcG4yLT5wbl90
eXBlICE9IFRPS19SQiAmJgotICAgICAgICAgICAgcG4yLT5wbl90eXBlICE9IFRPS19SQyAmJgot
I2VuZGlmCi0gICAgICAgICAgICBqc19OZXdTcmNOb3RlMihjeCwgY2csIFNSQ19QQ0JBU0UsIENH
X09GRlNFVChjZykgLSB0b3ApIDwgMCkgewotICAgICAgICAgICAgcmV0dXJuIEpTX0ZBTFNFOwot
ICAgICAgICB9Ci0KLSAgICAgICAgLyogRmluYWxseSwgZW1pdCB0aGUgc3BlY2lhbGl6ZWQgYXNz
aWdubWVudCBieXRlY29kZS4gKi8KLSAgICAgICAgc3dpdGNoIChwbjItPnBuX3R5cGUpIHsKLSAg
ICAgICAgICBjYXNlIFRPS19OQU1FOgotICAgICAgICAgICAgaWYgKHBuMi0+aXNDb25zdCgpKQot
ICAgICAgICAgICAgICAgIGJyZWFrOwotICAgICAgICAgICAgLyogRkFMTCBUSFJPVUdIICovCi0g
ICAgICAgICAgY2FzZSBUT0tfRE9UOgotICAgICAgICAgICAgRU1JVF9JTkRFWF9PUChQTl9PUChw
bjIpLCBhdG9tSW5kZXgpOwotICAgICAgICAgICAgYnJlYWs7Ci0gICAgICAgICAgY2FzZSBUT0tf
TEI6Ci0gICAgICAgICAgY2FzZSBUT0tfTFA6Ci0gICAgICAgICAgICBpZiAoanNfRW1pdDEoY3gs
IGNnLCBKU09QX1NFVEVMRU0pIDwgMCkKLSAgICAgICAgICAgICAgICByZXR1cm4gSlNfRkFMU0U7
Ci0gICAgICAgICAgICBicmVhazsKLSNpZiBKU19IQVNfREVTVFJVQ1RVUklORwotICAgICAgICAg
IGNhc2UgVE9LX1JCOgotICAgICAgICAgIGNhc2UgVE9LX1JDOgotICAgICAgICAgICAgaWYgKCFF
bWl0RGVzdHJ1Y3R1cmluZ09wcyhjeCwgY2csIEpTT1BfU0VUTkFNRSwgcG4yKSkKLSAgICAgICAg
ICAgICAgICByZXR1cm4gSlNfRkFMU0U7Ci0gICAgICAgICAgICBicmVhazsKLSNlbmRpZgotI2lm
IEpTX0hBU19YTUxfU1VQUE9SVAotICAgICAgICAgIGNhc2UgVE9LX1VOQVJZT1A6Ci0gICAgICAg
ICAgICBpZiAoanNfRW1pdDEoY3gsIGNnLCBKU09QX1NFVFhNTE5BTUUpIDwgMCkKLSAgICAgICAg
ICAgICAgICByZXR1cm4gSlNfRkFMU0U7Ci0gICAgICAgICAgICBicmVhazsKLSNlbmRpZgotICAg
ICAgICAgIGRlZmF1bHQ6Ci0gICAgICAgICAgICBKU19BU1NFUlQoMCk7Ci0gICAgICAgIH0KKyAg
ICAgICAgaWYgKCFFbWl0QXNzaWdubWVudChjeCwgY2csIHBuLT5wbl9sZWZ0LCBQTl9PUChwbiks
IHBuLT5wbl9yaWdodCkpCisgICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgIGJyZWFr
OwogCiAgICAgICBjYXNlIFRPS19IT09LOgogICAgICAgICAvKiBFbWl0IHRoZSBjb25kaXRpb24s
IHRoZW4gYnJhbmNoIGlmIGZhbHNlIHRvIHRoZSBlbHNlIHBhcnQuICovCiAgICAgICAgIGlmICgh
anNfRW1pdFRyZWUoY3gsIGNnLCBwbi0+cG5fa2lkMSkpCiAgICAgICAgICAgICByZXR1cm4gSlNf
RkFMU0U7CiAgICAgICAgIG5vdGVJbmRleCA9IGpzX05ld1NyY05vdGUoY3gsIGNnLCBTUkNfQ09O
RCk7CiAgICAgICAgIGlmIChub3RlSW5kZXggPCAwKQpkaWZmIC0tZ2l0IGEvanMvc3JjL2pzaW50
ZXJwLmNwcCBiL2pzL3NyYy9qc2ludGVycC5jcHAKLS0tIGEvanMvc3JjL2pzaW50ZXJwLmNwcAor
KysgYi9qcy9zcmMvanNpbnRlcnAuY3BwCkBAIC0zMTQ2LDEwNSArMzE0NiwzNyBAQCBCRUdJTl9D
QVNFKEpTT1BfTU9SRUlURVIpCiAgICAgYm9vbCBjb25kOwogICAgIGlmICghSXRlcmF0b3JNb3Jl
KGN4LCAmcmVncy5zcFstMl0udG9PYmplY3QoKSwgJmNvbmQsICZyZWdzLnNwWy0xXSkpCiAgICAg
ICAgIGdvdG8gZXJyb3I7CiAgICAgQ0hFQ0tfSU5URVJSVVBUX0hBTkRMRVIoKTsKICAgICByZWdz
LnNwWy0xXS5zZXRCb29sZWFuKGNvbmQpOwogfQogRU5EX0NBU0UoSlNPUF9NT1JFSVRFUikKIAor
QkVHSU5fQ0FTRShKU09QX0lURVJORVhUKQoreworICAgIFZhbHVlICppdGVydnAgPSByZWdzLnNw
IC0gR0VUX0lOVDgocmVncy5wYyk7CisgICAgSlNfQVNTRVJUKGl0ZXJ2cCA+PSByZWdzLmZwLT5i
YXNlKCkpOworICAgIEpTX0FTU0VSVChpdGVydnAtPmlzT2JqZWN0KCkpOworICAgIFBVU0hfTlVM
TCgpOworICAgIGlmICghSXRlcmF0b3JOZXh0KGN4LCAmaXRlcnZwLT50b09iamVjdCgpLCAmcmVn
cy5zcFstMV0pKQorICAgICAgICBnb3RvIGVycm9yOworfQorRU5EX0NBU0UoSlNPUF9JVEVSTkVY
VCkKKwogQkVHSU5fQ0FTRShKU09QX0VORElURVIpCiB7CiAgICAgSlNfQVNTRVJUKHJlZ3Muc3Ag
LSAxID49IHJlZ3MuZnAtPmJhc2UoKSk7CiAgICAgYm9vbCBvayA9ICEhanNfQ2xvc2VJdGVyYXRv
cihjeCwgJnJlZ3Muc3BbLTFdLnRvT2JqZWN0KCkpOwogICAgIHJlZ3Muc3AtLTsKICAgICBpZiAo
IW9rKQogICAgICAgICBnb3RvIGVycm9yOwogfQogRU5EX0NBU0UoSlNPUF9FTkRJVEVSKQogCi1C
RUdJTl9DQVNFKEpTT1BfRk9SQVJHKQotewotICAgIEpTX0FTU0VSVChyZWdzLnNwIC0gMSA+PSBy
ZWdzLmZwLT5iYXNlKCkpOwotICAgIHVpbnROIHNsb3QgPSBHRVRfQVJHTk8ocmVncy5wYyk7Ci0g
ICAgSlNfQVNTRVJUKHNsb3QgPCByZWdzLmZwLT5udW1Gb3JtYWxBcmdzKCkpOwotICAgIEpTX0FT
U0VSVChyZWdzLnNwWy0xXS5pc09iamVjdCgpKTsKLSAgICBpZiAoIUl0ZXJhdG9yTmV4dChjeCwg
JnJlZ3Muc3BbLTFdLnRvT2JqZWN0KCksICZhcmd2W3Nsb3RdKSkKLSAgICAgICAgZ290byBlcnJv
cjsKLX0KLUVORF9DQVNFKEpTT1BfRk9SQVJHKQotCi1CRUdJTl9DQVNFKEpTT1BfRk9STE9DQUwp
Ci17Ci0gICAgSlNfQVNTRVJUKHJlZ3Muc3AgLSAxID49IHJlZ3MuZnAtPmJhc2UoKSk7Ci0gICAg
dWludE4gc2xvdCA9IEdFVF9TTE9UTk8ocmVncy5wYyk7Ci0gICAgSlNfQVNTRVJUKHNsb3QgPCBy
ZWdzLmZwLT5udW1TbG90cygpKTsKLSAgICBKU19BU1NFUlQocmVncy5zcFstMV0uaXNPYmplY3Qo
KSk7Ci0gICAgaWYgKCFJdGVyYXRvck5leHQoY3gsICZyZWdzLnNwWy0xXS50b09iamVjdCgpLCAm
cmVncy5mcC0+c2xvdHMoKVtzbG90XSkpCi0gICAgICAgIGdvdG8gZXJyb3I7Ci19Ci1FTkRfQ0FT
RShKU09QX0ZPUkxPQ0FMKQotCi1CRUdJTl9DQVNFKEpTT1BfRk9STkFNRSkKLUJFR0lOX0NBU0Uo
SlNPUF9GT1JHTkFNRSkKLXsKLSAgICBKU19BU1NFUlQocmVncy5zcCAtIDEgPj0gcmVncy5mcC0+
YmFzZSgpKTsKLSAgICBKU0F0b20gKmF0b207Ci0gICAgTE9BRF9BVE9NKDAsIGF0b20pOwotICAg
IGpzaWQgaWQgPSBBVE9NX1RPX0pTSUQoYXRvbSk7Ci0gICAgSlNPYmplY3QgKm9iaiwgKm9iajI7
Ci0gICAgSlNQcm9wZXJ0eSAqcHJvcDsKLSAgICBpZiAoIWpzX0ZpbmRQcm9wZXJ0eShjeCwgaWQs
ICZvYmosICZvYmoyLCAmcHJvcCkpCi0gICAgICAgIGdvdG8gZXJyb3I7Ci0KLSAgICB7Ci0gICAg
ICAgIEF1dG9WYWx1ZVJvb3RlciB0dnIoY3gpOwotICAgICAgICBKU19BU1NFUlQocmVncy5zcFst
MV0uaXNPYmplY3QoKSk7Ci0gICAgICAgIGlmICghSXRlcmF0b3JOZXh0KGN4LCAmcmVncy5zcFst
MV0udG9PYmplY3QoKSwgdHZyLmFkZHIoKSkpCi0gICAgICAgICAgICBnb3RvIGVycm9yOwotICAg
ICAgICBpZiAoIW9iai0+c2V0UHJvcGVydHkoY3gsIGlkLCB0dnIuYWRkcigpLCBzY3JpcHQtPnN0
cmljdE1vZGVDb2RlKSkKLSAgICAgICAgICAgIGdvdG8gZXJyb3I7Ci0gICAgfQotfQotRU5EX0NB
U0UoSlNPUF9GT1JOQU1FKQotCi1CRUdJTl9DQVNFKEpTT1BfRk9SUFJPUCkKLXsKLSAgICBKU19B
U1NFUlQocmVncy5zcCAtIDIgPj0gcmVncy5mcC0+YmFzZSgpKTsKLSAgICBKU0F0b20gKmF0b207
Ci0gICAgTE9BRF9BVE9NKDAsIGF0b20pOwotICAgIGpzaWQgaWQgPSBBVE9NX1RPX0pTSUQoYXRv
bSk7Ci0gICAgSlNPYmplY3QgKm9iajsKLSAgICBGRVRDSF9PQkpFQ1QoY3gsIC0xLCBvYmopOwot
ICAgIHsKLSAgICAgICAgQXV0b1ZhbHVlUm9vdGVyIHR2cihjeCk7Ci0gICAgICAgIEpTX0FTU0VS
VChyZWdzLnNwWy0yXS5pc09iamVjdCgpKTsKLSAgICAgICAgaWYgKCFJdGVyYXRvck5leHQoY3gs
ICZyZWdzLnNwWy0yXS50b09iamVjdCgpLCB0dnIuYWRkcigpKSkKLSAgICAgICAgICAgIGdvdG8g
ZXJyb3I7Ci0gICAgICAgIGlmICghb2JqLT5zZXRQcm9wZXJ0eShjeCwgaWQsIHR2ci5hZGRyKCks
IHNjcmlwdC0+c3RyaWN0TW9kZUNvZGUpKQotICAgICAgICAgICAgZ290byBlcnJvcjsKLSAgICB9
Ci0gICAgcmVncy5zcC0tOwotfQotRU5EX0NBU0UoSlNPUF9GT1JQUk9QKQotCi1CRUdJTl9DQVNF
KEpTT1BfRk9SRUxFTSkKLSAgICAvKgotICAgICAqIEpTT1BfRk9SRUxFTSBzaW1wbHkgZHVwcyB0
aGUgcHJvcGVydHkgaWRlbnRpZmllciBhdCB0b3Agb2Ygc3RhY2sgYW5kCi0gICAgICogbGV0cyB0
aGUgc3Vic2VxdWVudCBKU09QX0VOVU1FTEVNIG9wY29kZSBzZXF1ZW5jZSBoYW5kbGUgdGhlIGxl
ZnQtaGFuZAotICAgICAqIHNpZGUgZXhwcmVzc2lvbiBldmFsdWF0aW9uIGFuZCBhc3NpZ25tZW50
LiBUaGlzIG9wY29kZSBleGlzdHMgc29sZWx5IHRvCi0gICAgICogaGVscCB0aGUgZGVjb21waWxl
ci4KLSAgICAgKi8KLSAgICBKU19BU1NFUlQocmVncy5zcCAtIDEgPj0gcmVncy5mcC0+YmFzZSgp
KTsKLSAgICBKU19BU1NFUlQocmVncy5zcFstMV0uaXNPYmplY3QoKSk7Ci0gICAgUFVTSF9OVUxM
KCk7Ci0gICAgaWYgKCFJdGVyYXRvck5leHQoY3gsICZyZWdzLnNwWy0yXS50b09iamVjdCgpLCAm
cmVncy5zcFstMV0pKQotICAgICAgICBnb3RvIGVycm9yOwotRU5EX0NBU0UoSlNPUF9GT1JFTEVN
KQotCiBCRUdJTl9DQVNFKEpTT1BfRFVQKQogewogICAgIEpTX0FTU0VSVChyZWdzLnNwID4gcmVn
cy5mcC0+YmFzZSgpKTsKICAgICBjb25zdCBWYWx1ZSAmcnJlZiA9IHJlZ3Muc3BbLTFdOwogICAg
IFBVU0hfQ09QWShycmVmKTsKIH0KIEVORF9DQVNFKEpTT1BfRFVQKQogCkBAIC02NjE3LDE2ICs2
NTQ5LDIwIEBAIEJFR0lOX0NBU0UoSlNPUF9BUlJBWVBVU0gpCiAgICAgaWYgKCFqc19BcnJheUNv
bXBQdXNoKGN4LCBvYmosIHJlZ3Muc3BbLTFdKSkKICAgICAgICAgZ290byBlcnJvcjsKICAgICBy
ZWdzLnNwLS07CiB9CiBFTkRfQ0FTRShKU09QX0FSUkFZUFVTSCkKICNlbmRpZiAvKiBKU19IQVNf
R0VORVJBVE9SUyAqLwogCiAjaWYgSlNfVEhSRUFERURfSU5URVJQCisgIExfSlNPUF9VTlVTRUQx
MToKKyAgTF9KU09QX1VOVVNFRDEwNjoKKyAgTF9KU09QX1VOVVNFRDEwNzoKKyAgTF9KU09QX1VO
VVNFRDEwODoKICAgTF9KU09QX0JBQ0tQQVRDSDoKICAgTF9KU09QX0JBQ0tQQVRDSF9QT1A6CiAK
ICMgaWYgIUpTX0hBU19HRU5FUkFUT1JTCiAgIExfSlNPUF9HRU5FUkFUT1I6CiAgIExfSlNPUF9Z
SUVMRDoKICAgTF9KU09QX0FSUkFZUFVTSDoKICMgZW5kaWYKZGlmZiAtLWdpdCBhL2pzL3NyYy9q
c29wY29kZS5jcHAgYi9qcy9zcmMvanNvcGNvZGUuY3BwCi0tLSBhL2pzL3NyYy9qc29wY29kZS5j
cHAKKysrIGIvanMvc3JjL2pzb3Bjb2RlLmNwcApAQCAtMzE4NCwxOSArMzE4NCwyMiBAQCBEZWNv
bXBpbGUoU3ByaW50U3RhY2sgKnNzLCBqc2J5dGVjb2RlICpwCiAgICAgICAgICAgICAgICAgICAg
ICAqIGZsYWcgcHJvY2Vzc2VkIGJ5IEpTT1BfSUZORS4gV2UgZG8gbm90IGRlY29tcGlsZSB0aGUK
ICAgICAgICAgICAgICAgICAgICAgICogSlNPUF9JRk5FLCBhbmQgaW5zdGVhZCBwdXNoIHRoZSBs
ZWZ0LWhhbmQgc2lkZSBvZiAnaW4nCiAgICAgICAgICAgICAgICAgICAgICAqIGFmdGVyIHRoZSBs
b29wIGVkZ2UgaW4gdGhpcyBzdGFjayBzbG90ICh0aGUgSlNPUF9GT1IqCiAgICAgICAgICAgICAg
ICAgICAgICAqIG9wY29kZXMnIGRlY29tcGlsZXJzIGRvIHRoaXMgcHVzaGluZykuCiAgICAgICAg
ICAgICAgICAgICAgICAqLwogICAgICAgICAgICAgICAgICAgICBjb25kID0gR2V0SnVtcE9mZnNl
dChwYywgcGMpOwogICAgICAgICAgICAgICAgICAgICBuZXh0ID0ganNfR2V0U3JjTm90ZU9mZnNl
dChzbiwgMCk7CiAgICAgICAgICAgICAgICAgICAgIHRhaWwgPSBqc19HZXRTcmNOb3RlT2Zmc2V0
KHNuLCAxKTsKKyAgICAgICAgICAgICAgICAgICAgSlNfQVNTRVJUKHBjW25leHRdID09IEpTT1Bf
UE9QKTsKICAgICAgICAgICAgICAgICAgICAgSlNfQVNTRVJUKHBjW2NvbmRdID09IEpTT1BfTU9S
RUlURVIpOwogICAgICAgICAgICAgICAgICAgICBERUNPTVBJTEVfQ09ERShwYyArIG9wbGVuLCBu
ZXh0IC0gb3BsZW4pOwogICAgICAgICAgICAgICAgICAgICBsdmFsID0gUE9QX1NUUigpOworICAg
ICAgICAgICAgICAgICAgICBKU19BU1NFUlQoc3RyY21wKGx2YWwgKyBzdHJsZW4obHZhbCkgLSA5
LCAiID0gPG5leHQ+IikgPT0gMCk7CisgICAgICAgICAgICAgICAgICAgIGNvbnN0X2Nhc3Q8Y2hh
ciAqPihsdmFsKVtzdHJsZW4obHZhbCkgLSA5XSA9ICdcMCc7CiAgICAgICAgICAgICAgICAgICAg
IExPQ0FMX0FTU0VSVChzcy0+dG9wID49IDEpOwogCiAgICAgICAgICAgICAgICAgICAgIGlmIChz
cy0+aW5BcnJheUluaXQgfHwgc3MtPmluR2VuRXhwKSB7CiAgICAgICAgICAgICAgICAgICAgICAg
ICBydmFsID0gUE9QX1NUUigpOwogICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHNzLT50b3Ag
Pj0gMSAmJiBzcy0+b3Bjb2Rlc1tzcy0+dG9wIC0gMV0gPT0gSlNPUF9GT1JMT0NBTCkgewogICAg
ICAgICAgICAgICAgICAgICAgICAgICAgIHNzLT5zcHJpbnRlci5vZmZzZXQgPSBzcy0+b2Zmc2V0
c1tzcy0+dG9wXSAtIFBBUkVOX1NMT1A7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYg
KFNwcmludCgmc3MtPnNwcmludGVyLCAiICVzICglcyBpbiAlcykiLAogICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgZm9yZWFjaCA/IGpzX2Zvcl9lYWNoX3N0ciA6IGpzX2Zv
cl9zdHIsCkBAIC0zMjIwLDIxICszMjIzLDIyIEBAIERlY29tcGlsZShTcHJpbnRTdGFjayAqc3Ms
IGpzYnl0ZWNvZGUgKnAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gTlVMTDsK
ICAgICAgICAgICAgICAgICAgICAgICAgIERFQ09NUElMRV9DT0RFKHBjICsgbmV4dCwgY29uZCAt
IG5leHQpOwogICAgICAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAg
ICAgICAgLyoKICAgICAgICAgICAgICAgICAgICAgICAgICAqIEFzIGFib3ZlLCBydmFsIG9yIGFu
IGV4dGVuc2lvbiBvZiBpdCBtdXN0IHJlbWFpbgogICAgICAgICAgICAgICAgICAgICAgICAgICog
c3RhY2tlZCBkdXJpbmcgbG9vcCBib2R5IGRlY29tcGlsYXRpb24uCiAgICAgICAgICAgICAgICAg
ICAgICAgICAgKi8KICAgICAgICAgICAgICAgICAgICAgICAgIHJ2YWwgPSBHZXRTdHIoc3MsIHNz
LT50b3AgLSAxKTsKLSAgICAgICAgICAgICAgICAgICAgICAgIGpzX3ByaW50ZihqcCwgIlx0JXMg
KCVzIGluICVzKSB7XG4iLAorICAgICAgICAgICAgICAgICAgICAgICAgeHZhbCA9IFZhclByZWZp
eChqc19HZXRTcmNOb3RlKGpwLT5zY3JpcHQsIHBjICsgbmV4dCkpOworICAgICAgICAgICAgICAg
ICAgICAgICAganNfcHJpbnRmKGpwLCAiXHQlcyAoJXMlcyBpbiAlcykge1xuIiwKICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICBmb3JlYWNoID8ganNfZm9yX2VhY2hfc3RyIDoganNf
Zm9yX3N0ciwKLSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBsdmFsLCBydmFsKTsK
KyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB4dmFsLCBsdmFsLCBydmFsKTsKICAg
ICAgICAgICAgICAgICAgICAgICAgIGpwLT5pbmRlbnQgKz0gNDsKLSAgICAgICAgICAgICAgICAg
ICAgICAgIERFQ09NUElMRV9DT0RFKHBjICsgbmV4dCwgY29uZCAtIG5leHQpOworICAgICAgICAg
ICAgICAgICAgICAgICAgREVDT01QSUxFX0NPREUocGMgKyBuZXh0ICsgSlNPUF9QT1BfTEVOR1RI
LCBjb25kIC0gbmV4dCAtIEpTT1BfUE9QX0xFTkdUSCk7CiAgICAgICAgICAgICAgICAgICAgICAg
ICBqcC0+aW5kZW50IC09IDQ7CiAgICAgICAgICAgICAgICAgICAgICAgICBqc19wcmludGYoanAs
ICJcdH1cbiIpOwogICAgICAgICAgICAgICAgICAgICB9CiAKICAgICAgICAgICAgICAgICAgICAg
cGMgKz0gdGFpbDsKICAgICAgICAgICAgICAgICAgICAgTE9DQUxfQVNTRVJUKCpwYyA9PSBKU09Q
X0lGTkUgfHwgKnBjID09IEpTT1BfSUZORVgpOwogICAgICAgICAgICAgICAgICAgICBsZW4gPSBq
c19Db2RlU3BlY1sqcGNdLmxlbmd0aDsKICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CmRpZmYg
LS1naXQgYS9qcy9zcmMvanNvcGNvZGUuaCBiL2pzL3NyYy9qc29wY29kZS5oCi0tLSBhL2pzL3Ny
Yy9qc29wY29kZS5oCisrKyBiL2pzL3NyYy9qc29wY29kZS5oCkBAIC02NiwxNiArNjYsMjQgQEAg
dHlwZWRlZiBlbnVtIEpTT3AgewogCiAgICAgLyoKICAgICAgKiBUaGVzZSBwc2V1ZG8tb3BzIGhl
bHAganNfRGVjb21waWxlVmFsdWVHZW5lcmF0b3IgZGVjb21waWxlIEpTT1BfU0VUTkFNRSwKICAg
ICAgKiBKU09QX1NFVFBST1AsIGFuZCBKU09QX1NFVEVMRU0sIHJlc3BlY3RpdmVseS4gIFRoZXkg
YXJlIG5ldmVyIHN0b3JlZCBpbgogICAgICAqIGJ5dGVjb2RlLCBzbyB0aGV5IGRvbid0IHByZWVt
cHQgdmFsaWQgb3Bjb2Rlcy4KICAgICAgKi8KICAgICBKU09QX0dFVFBST1AyID0gSlNPUF9MSU1J
VCwKICAgICBKU09QX0dFVEVMRU0yID0gSlNPUF9MSU1JVCArIDEsCisgLyogPD8/Pz4gKi8KKyAg
ICBKU09QX0ZPUkxPQ0FMLAorICAgIEpTT1BfRk9SQVJHLAorICAgIEpTT1BfRk9STkFNRSwKKyAg
ICBKU09QX0ZPUlBST1AsCisgICAgSlNPUF9GT1JFTEVNLAorICAgIEpTT1BfRk9SR05BTUUsCisv
KiA8Lz8/Pz4gKi8KICAgICBKU09QX0ZBS0VfTElNSVQgPSBKU09QX0dFVEVMRU0yCiB9IEpTT3A7
CiAKIC8qCiAgKiBKUyBieXRlY29kZSBmb3JtYXRzLgogICovCiAjZGVmaW5lIEpPRl9CWVRFICAg
ICAgICAgIDAgICAgICAgLyogc2luZ2xlIGJ5dGVjb2RlLCBubyBpbW1lZGlhdGVzICovCiAjZGVm
aW5lIEpPRl9KVU1QICAgICAgICAgIDEgICAgICAgLyogc2lnbmVkIDE2LWJpdCBqdW1wIG9mZnNl
dCBpbW1lZGlhdGUgKi8KZGlmZiAtLWdpdCBhL2pzL3NyYy9qc29wY29kZS50YmwgYi9qcy9zcmMv
anNvcGNvZGUudGJsCi0tLSBhL2pzL3NyYy9qc29wY29kZS50YmwKKysrIGIvanMvc3JjL2pzb3Bj
b2RlLnRibApAQCAtMTIwLDE5ICsxMjAsMTggQEAgT1BERUYoSlNPUF9MRUFWRVdJVEgsIDQsICAi
bGVhdmV3aXRoIiwgIAogT1BERUYoSlNPUF9SRVRVUk4sICAgIDUsICAicmV0dXJuIiwgICAgIE5V
TEwsICAgICAgICAgMSwgIDEsICAwLCAgMiwgIEpPRl9CWVRFKQogT1BERUYoSlNPUF9HT1RPLCAg
ICAgIDYsICAiZ290byIsICAgICAgIE5VTEwsICAgICAgICAgMywgIDAsICAwLCAgMCwgIEpPRl9K
VU1QKQogT1BERUYoSlNPUF9JRkVRLCAgICAgIDcsICAiaWZlcSIsICAgICAgIE5VTEwsICAgICAg
ICAgMywgIDEsICAwLCAgNCwgIEpPRl9KVU1QfEpPRl9ERVRFQ1RJTkcpCiBPUERFRihKU09QX0lG
TkUsICAgICAgOCwgICJpZm5lIiwgICAgICAgTlVMTCwgICAgICAgICAzLCAgMSwgIDAsICAwLCAg
Sk9GX0pVTVB8Sk9GX1BBUkVOSEVBRCkKIAogLyogR2V0IHRoZSBhcmd1bWVudHMgb2JqZWN0IGZv
ciB0aGUgY3VycmVudCwgbGlnaHR3ZWlnaHQgZnVuY3Rpb24gYWN0aXZhdGlvbi4gKi8KIE9QREVG
KEpTT1BfQVJHVU1FTlRTLCA5LCBqc19hcmd1bWVudHNfc3RyLCBqc19hcmd1bWVudHNfc3RyLCAx
LCAwLCAxLCAxOCwgSk9GX0JZVEUpCiAKLS8qIEVDTUEtY29tcGxpYW50IGZvci1pbiBsb29wIHdp
dGggYXJndW1lbnQgb3IgbG9jYWwgbG9vcCBjb250cm9sLiAqLwotT1BERUYoSlNPUF9GT1JBUkcs
ICAgIDEwLCAiZm9yYXJnIiwgICAgIE5VTEwsICAgICAgICAgMywgIDEsICAxLCAxOSwgIEpPRl9R
QVJHfEpPRl9OQU1FfEpPRl9GT1J8Sk9GX1RNUFNMT1QpCi1PUERFRihKU09QX0ZPUkxPQ0FMLCAg
MTEsICJmb3Jsb2NhbCIsICAgTlVMTCwgICAgICAgICAzLCAgMSwgIDEsIDE5LCAgSk9GX0xPQ0FM
fEpPRl9OQU1FfEpPRl9GT1J8Sk9GX1RNUFNMT1QpCitPUERFRihKU09QX1NXQVAsICAgICAgMTAs
ICJzd2FwIiwgICAgICAgTlVMTCwgICAgICAgICAxLCAgMiwgIDIsICAwLCAgSk9GX0JZVEUpCitP
UERFRihKU09QX1VOVVNFRDExLCAgMTEsICJ1bnVzZWQxMSIsICAgTlVMTCwgICAgICAgICAxLCAg
MCwgIDAsICAwLCAgSk9GX0JZVEUpCiAKIC8qIE1vcmUgbG9uZy1zdGFuZGluZyBieXRlY29kZXMu
ICovCiBPUERFRihKU09QX0RVUCwgICAgICAgMTIsICJkdXAiLCAgICAgICAgTlVMTCwgICAgICAg
ICAxLCAgMSwgIDIsICAwLCAgSk9GX0JZVEUpCiBPUERFRihKU09QX0RVUDIsICAgICAgMTMsICJk
dXAyIiwgICAgICAgTlVMTCwgICAgICAgICAxLCAgMiwgIDQsICAwLCAgSk9GX0JZVEUpCiBPUERF
RihKU09QX1NFVENPTlNULCAgMTQsICJzZXRjb25zdCIsICAgTlVMTCwgICAgICAgICAzLCAgMSwg
IDEsICAzLCAgSk9GX0FUT018Sk9GX05BTUV8Sk9GX1NFVCkKIE9QREVGKEpTT1BfQklUT1IsICAg
ICAxNSwgImJpdG9yIiwgICAgICAifCIsICAgICAgICAgIDEsICAyLCAgMSwgIDcsICBKT0ZfQllU
RXxKT0ZfTEVGVEFTU09DKQogT1BERUYoSlNPUF9CSVRYT1IsICAgIDE2LCAiYml0eG9yIiwgICAg
ICJeIiwgICAgICAgICAgMSwgIDIsICAxLCAgOCwgIEpPRl9CWVRFfEpPRl9MRUZUQVNTT0MpCiBP
UERFRihKU09QX0JJVEFORCwgICAgMTcsICJiaXRhbmQiLCAgICAgIiYiLCAgICAgICAgICAxLCAg
MiwgIDEsICA5LCAgSk9GX0JZVEV8Sk9GX0xFRlRBU1NPQykKQEAgLTIxNCwyMCArMjEzLDIwIEBA
IE9QREVGKEpTT1BfU0VUQ0FMTCwgICA3NCwgInNldGNhbGwiLCAgICAKICAqIHRydWUgaWYgYW5v
dGhlciB2YWx1ZSBpcyBhdmFpbGFibGUsIGFuZCBmYWxzZSBvdGhlcndpc2UuIEl0IGlzIGZvbGxv
d2VkCiAgKiBpbW1lZGlhdGVseSBieSBKU09QX0lGTkV7LFh9LgogICoKICAqIEpTT1BfRU5ESVRF
UiBjbGVhbnMgdXAgYWZ0ZXIgdGhlIGxvb3AuIEl0IHVzZXMgdGhlIHNsb3QgYWJvdmUgdGhlIGl0
ZXJhdG9yCiAgKiBmb3IgdGVtcG9yYXJ5IEdDIHJvb3RpbmcuCiAgKi8KIE9QREVGKEpTT1BfSVRF
UiwgICAgICA3NSwgIml0ZXIiLCAgICAgICBOVUxMLCAgICAgICAgIDIsICAxLCAgMSwgIDAsICBK
T0ZfVUlOVDgpCiBPUERFRihKU09QX01PUkVJVEVSLCAgNzYsICJtb3JlaXRlciIsICAgTlVMTCwg
ICAgICAgICAxLCAgMSwgIDIsICAwLCAgSk9GX0JZVEUpCi1PUERFRihKU09QX0VORElURVIsICAg
NzcsICJlbmRpdGVyIiwgICAgTlVMTCwgICAgICAgICAxLCAgMSwgIDAsICAwLCAgSk9GX0JZVEUp
CitPUERFRihKU09QX0lURVJORVhULCAgNzcsICJpdGVybmV4dCIsICAgIjxuZXh0PiIsICAgICAy
LCAgMCwgIDEsICAwLCAgSk9GX1VJTlQ4KQorT1BERUYoSlNPUF9FTkRJVEVSLCAgIDc4LCAiZW5k
aXRlciIsICAgIE5VTEwsICAgICAgICAgMSwgIDEsICAwLCAgMCwgIEpPRl9CWVRFKQogCi1PUERF
RihKU09QX0ZVTkFQUExZLCAgNzgsICJmdW5hcHBseSIsICAgTlVMTCwgICAgICAgICAzLCAtMSwg
IDEsIDE4LCAgSk9GX1VJTlQxNnxKT0ZfSU5WT0tFKQotT1BERUYoSlNPUF9TV0FQLCAgICAgIDc5
LCAic3dhcCIsICAgICAgIE5VTEwsICAgICAgICAgMSwgIDIsICAyLCAgMCwgIEpPRl9CWVRFKQor
T1BERUYoSlNPUF9GVU5BUFBMWSwgIDc5LCAiZnVuYXBwbHkiLCAgIE5VTEwsICAgICAgICAgMywg
LTEsICAxLCAxOCwgIEpPRl9VSU5UMTZ8Sk9GX0lOVk9LRSkKIAogLyogUHVzaCBvYmplY3QgbGl0
ZXJhbDogZWl0aGVyIGFuIFhNTCBvYmplY3Qgb3IgaW5pdGlhbGlzZXIgb2JqZWN0LiAqLwogT1BE
RUYoSlNPUF9PQkpFQ1QsICAgIDgwLCAib2JqZWN0IiwgICAgIE5VTEwsICAgICAgICAgMywgIDAs
ICAxLCAxOSwgIEpPRl9PQkpFQ1QpCiAKIC8qIFBvcCB2YWx1ZSBhbmQgZGlzY2FyZCBpdC4gKi8K
IE9QREVGKEpTT1BfUE9QLCAgICAgICA4MSwgInBvcCIsICAgICAgICBOVUxMLCAgICAgICAgIDEs
ICAxLCAgMCwgIDIsICBKT0ZfQllURSkKIAogLyogQ2FsbCBhIGZ1bmN0aW9uIGFzIGEgY29uc3Ry
dWN0b3I7IG9wZXJhbmQgaXMgYXJnYy4gKi8KQEAgLTI3MCwyMCArMjY5LDE5IEBAIE9QREVGKEpT
T1BfQVJHREVDLCAgIDEwMCwgImFyZ2RlYyIsICAgICAKIAogT1BERUYoSlNPUF9JTkNMT0NBTCwg
IDEwMSwiaW5jbG9jYWwiLCAgIE5VTEwsICAgICAgICAgMywgIDAsICAxLCAxNSwgIEpPRl9MT0NB
THxKT0ZfTkFNRXxKT0ZfSU5DfEpPRl9UTVBTTE9UMykKIE9QREVGKEpTT1BfREVDTE9DQUwsICAx
MDIsImRlY2xvY2FsIiwgICBOVUxMLCAgICAgICAgIDMsICAwLCAgMSwgMTUsICBKT0ZfTE9DQUx8
Sk9GX05BTUV8Sk9GX0RFQ3xKT0ZfVE1QU0xPVDMpCiBPUERFRihKU09QX0xPQ0FMSU5DLCAgMTAz
LCJsb2NhbGluYyIsICAgTlVMTCwgICAgICAgICAzLCAgMCwgIDEsIDE1LCAgSk9GX0xPQ0FMfEpP
Rl9OQU1FfEpPRl9JTkN8Sk9GX1BPU1R8Sk9GX1RNUFNMT1QzKQogT1BERUYoSlNPUF9MT0NBTERF
QywgIDEwNCwibG9jYWxkZWMiLCAgIE5VTEwsICAgICAgICAgMywgIDAsICAxLCAxNSwgIEpPRl9M
T0NBTHxKT0ZfTkFNRXxKT0ZfREVDfEpPRl9QT1NUfEpPRl9UTVBTTE9UMykKIAogT1BERUYoSlNP
UF9JTUFDT1AsICAgIDEwNSwiaW1hY29wIiwgICAgIE5VTEwsICAgICAgICAgMSwgIDAsICAwLCAg
MCwgIEpPRl9CWVRFKQogCi0vKiBFQ01BLWNvbXBsaWFudCBmb3IvaW4gb3BzLiAqLwotT1BERUYo
SlNPUF9GT1JOQU1FLCAgIDEwNiwiZm9ybmFtZSIsICAgIE5VTEwsICAgICAgICAgMywgIDEsICAx
LCAxOSwgIEpPRl9BVE9NfEpPRl9OQU1FfEpPRl9GT1J8Sk9GX1RNUFNMT1QzKQotT1BERUYoSlNP
UF9GT1JQUk9QLCAgIDEwNywiZm9ycHJvcCIsICAgIE5VTEwsICAgICAgICAgMywgIDIsICAxLCAx
OCwgIEpPRl9BVE9NfEpPRl9QUk9QfEpPRl9GT1J8Sk9GX1RNUFNMT1QzKQotT1BERUYoSlNPUF9G
T1JFTEVNLCAgIDEwOCwiZm9yZWxlbSIsICAgIE5VTEwsICAgICAgICAgMSwgIDEsICAyLCAxOCwg
IEpPRl9CWVRFIHxKT0ZfRUxFTXxKT0ZfRk9SKQorT1BERUYoSlNPUF9VTlVTRUQxMDYsIDEwNiwg
InVudXNlZDEwNiIsIE5VTEwsICAgICAgICAgMSwgIDAsICAwLCAgMCwgIEpPRl9CWVRFKQorT1BE
RUYoSlNPUF9VTlVTRUQxMDcsIDEwNywgInVudXNlZDEwNyIsIE5VTEwsICAgICAgICAgMSwgIDAs
ICAwLCAgMCwgIEpPRl9CWVRFKQorT1BERUYoSlNPUF9VTlVTRUQxMDgsIDEwOCwgInVudXNlZDEw
OCIsIE5VTEwsICAgICAgICAgMSwgIDAsICAwLCAgMCwgIEpPRl9CWVRFKQogT1BERUYoSlNPUF9Q
T1BOLCAgICAgIDEwOSwicG9wbiIsICAgICAgIE5VTEwsICAgICAgICAgMywgLTEsICAwLCAgMCwg
IEpPRl9VSU5UMTYpCiAKIC8qIEVDTUEtY29tcGxpYW50IGFzc2lnbm1lbnQgb3BzLiAqLwogT1BE
RUYoSlNPUF9CSU5ETkFNRSwgIDExMCwiYmluZG5hbWUiLCAgIE5VTEwsICAgICAgICAgMywgIDAs
ICAxLCAgMCwgIEpPRl9BVE9NfEpPRl9OQU1FfEpPRl9TRVQpCiBPUERFRihKU09QX1NFVE5BTUUs
ICAgMTExLCJzZXRuYW1lIiwgICAgTlVMTCwgICAgICAgICAzLCAgMiwgIDEsICAzLCAgSk9GX0FU
T018Sk9GX05BTUV8Sk9GX1NFVHxKT0ZfREVURUNUSU5HKQogCiAvKiBFeGNlcHRpb24gaGFuZGxp
bmcgb3BzLiAqLwogT1BERUYoSlNPUF9USFJPVywgICAgIDExMixqc190aHJvd19zdHIsIE5VTEws
ICAgICAgICAgMSwgIDEsICAwLCAgMCwgIEpPRl9CWVRFKQpAQCAtNjA5LDEwICs2MDcsOCBAQCBP
UERFRihKU09QX1VOQlJBTkRUSElTLCAgIDIzOCwidW5icmFuZHRoCiBPUERFRihKU09QX1NIQVJQ
SU5JVCwgICAgIDIzOSwic2hhcnBpbml0IiwgICAgIE5VTEwsICAzLCAgMCwgIDAsICAwLCAgSk9G
X1VJTlQxNnxKT0ZfU0hBUlBTTE9UKQogCiAvKiBTdGF0aWMgYmluZGluZyBmb3IgZ2xvYmFscy4g
Ki8KIE9QREVGKEpTT1BfR0VUR0xPQkFMLCAgICAgMjQwLCJnZXRnbG9iYWwiLCAgICAgTlVMTCwg
IDMsICAwLCAgMSwgMTksICBKT0ZfR0xPQkFMfEpPRl9OQU1FKQogT1BERUYoSlNPUF9DQUxMR0xP
QkFMLCAgICAyNDEsImNhbGxnbG9iYWwiLCAgICBOVUxMLCAgMywgIDAsICAyLCAxOSwgIEpPRl9H
TE9CQUx8Sk9GX05BTUV8Sk9GX0NBTExPUCkKIAogLyogTGlrZSBKU09QX0ZVTkFQUExZIGJ1dCBm
b3IgZi5jYWxsIGluc3RlYWQgb2YgZi5hcHBseS4gKi8KIE9QREVGKEpTT1BfRlVOQ0FMTCwgICAg
ICAgMjQyLCJmdW5jYWxsIiwgICAgICAgTlVMTCwgIDMsIC0xLCAgMSwgMTgsICBKT0ZfVUlOVDE2
fEpPRl9JTlZPS0UpCi0KLU9QREVGKEpTT1BfRk9SR05BTUUsICAgICAgMjQzLCJmb3JnbmFtZSIs
ICAgICAgTlVMTCwgIDMsICAxLCAgMSwgMTksICBKT0ZfQVRPTXxKT0ZfR05BTUV8Sk9GX0ZPUnxK
T0ZfVE1QU0xPVDMpCmRpZmYgLS1naXQgYS9qcy9zcmMvanNwYXJzZS5jcHAgYi9qcy9zcmMvanNw
YXJzZS5jcHAKLS0tIGEvanMvc3JjL2pzcGFyc2UuY3BwCisrKyBiL2pzL3NyYy9qc3BhcnNlLmNw
cApAQCAtNzc2LDE3ICs3NzYsMzMgQEAgSlNQYXJzZU5vZGU6Om5ld0JpbmFyeU9yQXBwZW5kKFRv
a2VuS2luZAogICAgIHBuID0gTmV3T3JSZWN5Y2xlZE5vZGUodGMpOwogICAgIGlmICghcG4pCiAg
ICAgICAgIHJldHVybiBOVUxMOwogICAgIHBuLT5pbml0KHR0LCBvcCwgUE5fQklOQVJZKTsKICAg
ICBwbi0+cG5fcG9zLmJlZ2luID0gbGVmdC0+cG5fcG9zLmJlZ2luOwogICAgIHBuLT5wbl9wb3Mu
ZW5kID0gcmlnaHQtPnBuX3Bvcy5lbmQ7CiAgICAgcG4tPnBuX2xlZnQgPSBsZWZ0OwogICAgIHBu
LT5wbl9yaWdodCA9IHJpZ2h0OwotICAgIHJldHVybiAoQmluYXJ5Tm9kZSAqKXBuOworICAgIHJl
dHVybiBwbjsKK30KKworSlNQYXJzZU5vZGUgKgorSlNQYXJzZU5vZGU6Om5ld1Rlcm5hcnkoVG9r
ZW5LaW5kIHR0LCBKU09wIG9wLCBKU1BhcnNlTm9kZSAqa2lkMSwgSlNQYXJzZU5vZGUgKmtpZDIs
CisgICAgICAgICAgICAgICAgICAgICAgICBKU1BhcnNlTm9kZSAqa2lkMywgSlNUcmVlQ29udGV4
dCAqdGMpCit7CisgICAgSlNQYXJzZU5vZGUgKnBuID0gTmV3T3JSZWN5Y2xlZE5vZGUodGMpOwor
ICAgIGlmICghcG4pCisgICAgICAgIHJldHVybiBOVUxMOworICAgIHBuLT5pbml0KHR0LCBvcCwg
UE5fVEVSTkFSWSk7CisgICAgcG4tPnBuX3Bvcy5iZWdpbiA9IChraWQxID8ga2lkMSA6IGtpZDIp
LT5wbl9wb3MuYmVnaW47CisgICAgcG4tPnBuX3Bvcy5lbmQgPSBraWQzLT5wbl9wb3MuZW5kOwor
ICAgIHBuLT5wbl9raWQxID0ga2lkMTsKKyAgICBwbi0+cG5fa2lkMiA9IGtpZDI7CisgICAgcG4t
PnBuX2tpZDMgPSBraWQzOworICAgIHJldHVybiBwbjsKIH0KIAogbmFtZXNwYWNlIGpzIHsKIAog
aW5saW5lIHZvaWQKIE5hbWVOb2RlOjppbml0Q29tbW9uKEpTVHJlZUNvbnRleHQgKnRjKQogewog
ICAgIHBuX2V4cHIgPSBOVUxMOwpAQCAtNDQ0NSwxOCArNDQ2MSwyMiBAQCBQYXJzZXI6OmRlc3Ry
dWN0dXJpbmdFeHByKEJpbmREYXRhICpkYXRhCiAgICAgdGMtPmZsYWdzICY9IH5UQ0ZfREVDTF9E
RVNUUlVDVFVSSU5HOwogICAgIGlmICghcG4pCiAgICAgICAgIHJldHVybiBOVUxMOwogICAgIGlm
ICghQ2hlY2tEZXN0cnVjdHVyaW5nKGNvbnRleHQsIGRhdGEsIHBuLCB0YykpCiAgICAgICAgIHJl
dHVybiBOVUxMOwogICAgIHJldHVybiBwbjsKIH0KIAorI2VuZGlmIC8qIEpTX0hBU19ERVNUUlVD
VFVSSU5HICovCisKIC8qCi0gKiBDdXJyZW50bHkgdXNlZCBvbmx5ICNpZiBKU19IQVNfREVTVFJV
Q1RVUklORywgaW4gU3RhdGVtZW50J3MgVE9LX0ZPUiBjYXNlLgorICogQ3VycmVudGx5IHVzZWQg
b25seSBieSBQYXJzZXI6OmZvclN0YXRlbWVudCB0byBjbG9uZSB0aGUgVEFSR0VUIGluCisgKiBg
Zm9yICh2YXIvY29uc3QvbGV0IFRBUkdFVCBpbiBFWFBSKSBTVE1UYC4KKyAqCiAgKiBUaGlzIGZ1
bmN0aW9uIGFzc3VtZXMgdGhlIGNsb25lZCB0cmVlIGlzIGZvciB1c2UgaW4gdGhlIHNhbWUgc3Rh
dGVtZW50IGFuZAogICogYmluZGluZyBjb250ZXh0IGFzIHRoZSBvcmlnaW5hbCB0cmVlLgogICov
CiBzdGF0aWMgSlNQYXJzZU5vZGUgKgogQ2xvbmVQYXJzZVRyZWUoSlNQYXJzZU5vZGUgKm9wbiwg
SlNUcmVlQ29udGV4dCAqdGMpCiB7CiAgICAgSlNQYXJzZU5vZGUgKnBuLCAqcG4yLCAqb3BuMjsK
IApAQCAtNDU1MCwxOCArNDU3MCwxNiBAQCBDbG9uZVBhcnNlVHJlZShKU1BhcnNlTm9kZSAqb3Bu
LCBKU1RyZWVDCiAgICAgICAgIHBuLT5wbl91ID0gb3BuLT5wbl91OwogICAgICAgICBicmVhazsK
IAogI3VuZGVmIE5VTExDSEVDSwogICAgIH0KICAgICByZXR1cm4gcG47CiB9CiAKLSNlbmRpZiAv
KiBKU19IQVNfREVTVFJVQ1RVUklORyAqLwotCiBleHRlcm4gY29uc3QgY2hhciBqc193aXRoX3N0
YXRlbWVudF9zdHJbXTsKIAogc3RhdGljIEpTUGFyc2VOb2RlICoKIENvbnRhaW5zU3RtdChKU1Bh
cnNlTm9kZSAqcG4sIFRva2VuS2luZCB0dCkKIHsKICAgICBKU1BhcnNlTm9kZSAqcG4yLCAqcG50
OwogCiAgICAgaWYgKCFwbikKQEAgLTUwNTcsMTggKzUwNzUsMjAgQEAgUGFyc2VyOjpmb3JTdGF0
ZW1lbnQoKQogICAgIFRva2VuS2luZCB0dCA9IHRva2VuU3RyZWFtLnBlZWtUb2tlbihUU0ZfT1BF
UkFORCk7CiAKICNpZiBKU19IQVNfQkxPQ0tfU0NPUEUKICAgICBib29sIGxldCA9IGZhbHNlOwog
I2VuZGlmCiAKICAgICBKU1BhcnNlTm9kZSAqcG4xOwogICAgIGlmICh0dCA9PSBUT0tfU0VNSSkg
ewotICAgICAgICBpZiAocG4tPnBuX2lmbGFncyAmIEpTSVRFUl9GT1JFQUNIKQotICAgICAgICAg
ICAgZ290byBiYWRfZm9yX2VhY2g7CisgICAgICAgIGlmIChwbi0+cG5faWZsYWdzICYgSlNJVEVS
X0ZPUkVBQ0gpIHsKKyAgICAgICAgICAgIHJlcG9ydEVycm9yTnVtYmVyKHBuLCBKU1JFUE9SVF9F
UlJPUiwgSlNNU0dfQkFEX0ZPUl9FQUNIX0xPT1ApOworICAgICAgICAgICAgcmV0dXJuIE5VTEw7
CisgICAgICAgIH0KIAogICAgICAgICAvKiBObyBpbml0aWFsaXplciAtLSBzZXQgZmlyc3Qga2lk
IG9mIGxlZnQgc3ViLW5vZGUgdG8gbnVsbC4gKi8KICAgICAgICAgcG4xID0gTlVMTDsKICAgICB9
IGVsc2UgewogICAgICAgICAvKgogICAgICAgICAgKiBTZXQgcG4xIHRvIGEgdmFyIGxpc3Qgb3Ig
YW4gaW5pdGlhbGl6aW5nIGV4cHJlc3Npb24uCiAgICAgICAgICAqCiAgICAgICAgICAqIFNldCB0
aGUgVENGX0lOX0ZPUl9JTklUIGZsYWcgZHVyaW5nIHBhcnNpbmcgb2YgdGhlIGZpcnN0IGNsYXVz
ZQpAQCAtNTEwOSwxNyArNTEyOSwyOCBAQCBQYXJzZXI6OmZvclN0YXRlbWVudCgpCiAgICAgfQog
CiAgICAgLyoKICAgICAgKiBXZSBjYW4gYmUgc3VyZSB0aGF0IGl0J3MgYSBmb3IvaW4gbG9vcCBp
ZiB0aGVyZSdzIHN0aWxsIGFuICdpbicKICAgICAgKiBrZXl3b3JkIGhlcmUsIGV2ZW4gaWYgSmF2
YVNjcmlwdCByZWNvZ25pemVzICdpbicgYXMgYW4gb3BlcmF0b3IsCiAgICAgICogYXMgd2UndmUg
ZXhjbHVkZWQgJ2luJyBmcm9tIGJlaW5nIHBhcnNlZCBpbiBSZWxFeHByIGJ5IHNldHRpbmcKICAg
ICAgKiB0aGUgVENGX0lOX0ZPUl9JTklUIGZsYWcgaW4gb3VyIEpTVHJlZUNvbnRleHQuCiAgICAg
ICovCisgICAgSlNQYXJzZU5vZGUgKnBuMiwgKnBuMzsKKyAgICBKU1BhcnNlTm9kZSAqcG40ID0g
VGVybmFyeU5vZGU6OmNyZWF0ZSh0Yyk7CisgICAgaWYgKCFwbjQpCisgICAgICAgIHJldHVybiBO
VUxMOwogICAgIGlmIChwbjEgJiYgdG9rZW5TdHJlYW0ubWF0Y2hUb2tlbihUT0tfSU4pKSB7Cisg
ICAgICAgIC8qCisgICAgICAgICAqIFBhcnNlIHRoZSByZXN0IG9mIHRoZSBmb3IvaW4gaGVhZC4K
KyAgICAgICAgICoKKyAgICAgICAgICogSGVyZSBwbjEgaXMgZXZlcnl0aGluZyB0byB0aGUgbGVm
dCBvZiAnaW4nLiBBdCB0aGUgZW5kIG9mIHRoaXMgYmxvY2ssCisgICAgICAgICAqIHBuMSBpcyBh
IGRlY2wgb3IgTlVMTCwgcG4yIGlzIHRoZSBhc3NpZ25tZW50IHRhcmdldCB0aGF0IHJlY2VpdmVz
IHRoZQorICAgICAgICAgKiBlbnVtZXJhdGlvbiB2YWx1ZSBlYWNoIGl0ZXJhdGlvbiwgYW5kIHBu
MyBpcyB0aGUgcmhzIG9mICdpbicuCisgICAgICAgICAqLwogICAgICAgICBwbi0+cG5faWZsYWdz
IHw9IEpTSVRFUl9FTlVNRVJBVEU7CiAgICAgICAgIHN0bXRJbmZvLnR5cGUgPSBTVE1UX0ZPUl9J
Tl9MT09QOwogCiAgICAgICAgIC8qIENoZWNrIHRoYXQgdGhlIGxlZnQgc2lkZSBvZiB0aGUgJ2lu
JyBpcyB2YWxpZC4gKi8KICAgICAgICAgSlNfQVNTRVJUKCFUb2tlbktpbmRJc0RlY2wodHQpIHx8
IFBOX1RZUEUocG4xKSA9PSB0dCk7CiAgICAgICAgIGlmIChUb2tlbktpbmRJc0RlY2wodHQpCiAg
ICAgICAgICAgICA/IChwbjEtPnBuX2NvdW50ID4gMSB8fCBwbjEtPnBuX29wID09IEpTT1BfREVG
Q09OU1QKICNpZiBKU19IQVNfREVTVFJVQ1RVUklORwpAQCAtNTE0OCwzNSArNTE3OSw0MSBAQCBQ
YXJzZXI6OmZvclN0YXRlbWVudCgpCiAgICAgICAgICAgICAgICAocG4xLT5wbl90eXBlICE9IFRP
S19VTkFSWU9QIHx8CiAgICAgICAgICAgICAgICAgcG4xLT5wbl9vcCAhPSBKU09QX1hNTE5BTUUp
ICYmCiAjZW5kaWYKICAgICAgICAgICAgICAgIHBuMS0+cG5fdHlwZSAhPSBUT0tfTEIpKSB7CiAg
ICAgICAgICAgICByZXBvcnRFcnJvck51bWJlcihwbjEsIEpTUkVQT1JUX0VSUk9SLCBKU01TR19C
QURfRk9SX0xFRlRTSURFKTsKICAgICAgICAgICAgIHJldHVybiBOVUxMOwogICAgICAgICB9CiAK
LSAgICAgICAgLyogcG4yIHBvaW50cyB0byB0aGUgbmFtZSBvciBkZXN0cnVjdHVyaW5nIHBhdHRl
cm4gb24gaW4ncyBsZWZ0LiAqLwotICAgICAgICBKU1BhcnNlTm9kZSAqcG4yID0gTlVMTDsKKyAg
ICAgICAgLyoKKyAgICAgICAgICogQWZ0ZXIgdGhlIGZvbGxvd2luZyBpZi1lbHNlLCBwbjIgd2ls
bCBwb2ludCB0byB0aGUgbmFtZSBvcgorICAgICAgICAgKiBkZXN0cnVjdHVyaW5nIHBhdHRlcm4g
b24gaW4ncyBsZWZ0LiBwbjEgd2lsbCBwb2ludCB0byB0aGUgZGVjbCwgaWYKKyAgICAgICAgICog
YW55LCBlbHNlIE5VTEwuIE5vdGUgdGhhdCB0aGUgImRlY2xhcmF0aW9uIHdpdGggaW5pdGlhbGl6
ZXIiIGNhc2UKKyAgICAgICAgICogcmV3cml0ZXMgdGhlIGxvb3AtaGVhZCwgbW92aW5nIHRoZSBk
ZWNsIGFuZCBzZXR0aW5nIHBuMSB0byBOVUxMLgorICAgICAgICAgKi8KKyAgICAgICAgcG4yID0g
TlVMTDsKICAgICAgICAgdWludE4gZGZsYWcgPSBQTkRfQVNTSUdORUQ7Ci0KICAgICAgICAgaWYg
KFRva2VuS2luZElzRGVjbCh0dCkpIHsKLSAgICAgICAgICAgIC8qIFRlbGwganNfRW1pdFRyZWUo
VE9LX1ZBUikgdGhhdCBwbjEgaXMgcGFydCBvZiBhIGZvci9pbi4gKi8KKyAgICAgICAgICAgIC8q
IFRlbGwgRW1pdFZhcmlhYmxlcyB0aGF0IHBuMSBpcyBwYXJ0IG9mIGEgZm9yL2luLiAqLwogICAg
ICAgICAgICAgcG4xLT5wbl94ZmxhZ3MgfD0gUE5YX0ZPUklOVkFSOwogCi0gICAgICAgICAgICAv
KgotICAgICAgICAgICAgICogUmV3cml0ZSAnZm9yICg8ZGVjbD4geCA9IGkgaW4gbyknIHdoZXJl
IDxkZWNsPiBpcyAndmFyJyBvcgotICAgICAgICAgICAgICogJ2NvbnN0JyB0byBob2lzdCB0aGUg
aW5pdGlhbGl6ZXIgb3IgdGhlIGVudGlyZSBkZWNsIG91dCBvZgotICAgICAgICAgICAgICogdGhl
IGxvb3AgaGVhZC4gVE9LX1ZBUiBpcyB0aGUgdHlwZSBmb3IgYm90aCAndmFyJyBhbmQgJ2NvbnN0
Jy4KLSAgICAgICAgICAgICAqLwogICAgICAgICAgICAgcG4yID0gcG4xLT5wbl9oZWFkOwogICAg
ICAgICAgICAgaWYgKChwbjItPnBuX3R5cGUgPT0gVE9LX05BTUUgJiYgcG4yLT5tYXliZUV4cHIo
KSkKICNpZiBKU19IQVNfREVTVFJVQ1RVUklORwogICAgICAgICAgICAgICAgIHx8IHBuMi0+cG5f
dHlwZSA9PSBUT0tfQVNTSUdOCiAjZW5kaWYKICAgICAgICAgICAgICAgICApIHsKKyAgICAgICAg
ICAgICAgICAvKgorICAgICAgICAgICAgICAgICAqIERlY2xhcmF0aW9uIHdpdGggaW5pdGlhbGl6
ZXIuCisgICAgICAgICAgICAgICAgICoKKyAgICAgICAgICAgICAgICAgKiBSZXdyaXRlICdmb3Ig
KDxkZWNsPiB4ID0gaSBpbiBvKScgd2hlcmUgPGRlY2w+IGlzICd2YXInIG9yCisgICAgICAgICAg
ICAgICAgICogJ2NvbnN0JyB0byBob2lzdCB0aGUgaW5pdGlhbGl6ZXIgb3IgdGhlIGVudGlyZSBk
ZWNsIG91dCBvZgorICAgICAgICAgICAgICAgICAqIHRoZSBsb29wIGhlYWQuIFRPS19WQVIgaXMg
dGhlIHR5cGUgZm9yIGJvdGggJ3ZhcicgYW5kICdjb25zdCcuCisgICAgICAgICAgICAgICAgICov
CiAjaWYgSlNfSEFTX0JMT0NLX1NDT1BFCiAgICAgICAgICAgICAgICAgaWYgKHR0ID09IFRPS19M
RVQpIHsKICAgICAgICAgICAgICAgICAgICAgcmVwb3J0RXJyb3JOdW1iZXIocG4yLCBKU1JFUE9S
VF9FUlJPUiwgSlNNU0dfSU5WQUxJRF9GT1JfSU5fSU5JVCk7CiAgICAgICAgICAgICAgICAgICAg
IHJldHVybiBOVUxMOwogICAgICAgICAgICAgICAgIH0KICNlbmRpZiAvKiBKU19IQVNfQkxPQ0tf
U0NPUEUgKi8KIAogICAgICAgICAgICAgICAgIHBuc2VxID0gTGlzdE5vZGU6OmNyZWF0ZSh0Yyk7
CkBAIC01MTk2LDY1ICs1MjMzLDc0IEBAIFBhcnNlcjo6Zm9yU3RhdGVtZW50KCkKICAgICAgICAg
ICAgICAgICAgKiBzaWRlKSBhbmQgaXQgaGFzIGFuIGluaXRpYWxpemVyLgogICAgICAgICAgICAg
ICAgICAqLwogICAgICAgICAgICAgICAgIHBuMS0+cG5feGZsYWdzICY9IH5QTlhfRk9SSU5WQVI7
CiAgICAgICAgICAgICAgICAgcG4xLT5wbl94ZmxhZ3MgfD0gUE5YX1BPUFZBUjsKICAgICAgICAg
ICAgICAgICBwbnNlcS0+aW5pdExpc3QocG4xKTsKIAogI2lmIEpTX0hBU19ERVNUUlVDVFVSSU5H
CiAgICAgICAgICAgICAgICAgaWYgKHBuMi0+cG5fdHlwZSA9PSBUT0tfQVNTSUdOKSB7Ci0gICAg
ICAgICAgICAgICAgICAgIHBuMSA9IENsb25lUGFyc2VUcmVlKHBuMi0+cG5fbGVmdCwgdGMpOwot
ICAgICAgICAgICAgICAgICAgICBpZiAoIXBuMSkKKyAgICAgICAgICAgICAgICAgICAgcG4yID0g
Q2xvbmVQYXJzZVRyZWUocG4yLT5wbl9sZWZ0LCB0Yyk7CisgICAgICAgICAgICAgICAgICAgIGlm
ICghcG4yKQogICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIE5VTEw7CiAgICAgICAgICAg
ICAgICAgfSBlbHNlCiAjZW5kaWYKICAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAg
ICAgIEpTX0FTU0VSVChwbjItPnBuX3R5cGUgPT0gVE9LX05BTUUpOwogICAgICAgICAgICAgICAg
ICAgICBwbjEgPSBOYW1lTm9kZTo6Y3JlYXRlKHBuMi0+cG5fYXRvbSwgdGMpOwogICAgICAgICAg
ICAgICAgICAgICBpZiAoIXBuMSkKICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBOVUxM
OwogICAgICAgICAgICAgICAgICAgICBwbjEtPnBuX3R5cGUgPSBUT0tfTkFNRTsKICAgICAgICAg
ICAgICAgICAgICAgcG4xLT5wbl9vcCA9IEpTT1BfTkFNRTsKICAgICAgICAgICAgICAgICAgICAg
cG4xLT5wbl9wb3MgPSBwbjItPnBuX3BvczsKICAgICAgICAgICAgICAgICAgICAgaWYgKHBuMi0+
cG5fZGVmbikKICAgICAgICAgICAgICAgICAgICAgICAgIExpbmtVc2VUb0RlZihwbjEsIChKU0Rl
ZmluaXRpb24gKikgcG4yLCB0Yyk7CisgICAgICAgICAgICAgICAgICAgIHBuMiA9IHBuMTsKICAg
ICAgICAgICAgICAgICB9Ci0gICAgICAgICAgICAgICAgcG4yID0gcG4xOwotICAgICAgICAgICAg
fQotICAgICAgICB9Ci0KLSAgICAgICAgaWYgKCFwbjIpIHsKKyAgICAgICAgICAgICAgICBwbjEg
PSBOVUxMOworICAgICAgICAgICAgfSBlbHNlIHsKKyAgICAgICAgICAgICAgICAvKiBEZWNsYXJh
dGlvbiB3aXRob3V0IGluaXRpYWxpemVyLiAqLworICAgICAgICAgICAgICAgIGlmIChwbjItPnBu
X3R5cGUgPT0gVE9LX05BTUUpIHsKKyAgICAgICAgICAgICAgICAgICAgSlNQYXJzZU5vZGUgKmNv
cHkgPSBOYW1lTm9kZTo6Y3JlYXRlKHBuMi0+cG5fYXRvbSwgdGMpOworICAgICAgICAgICAgICAg
ICAgICBpZiAoIWNvcHkpCisgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gTlVMTDsKKyAg
ICAgICAgICAgICAgICAgICAgY29weS0+cG5fdHlwZSA9IFRPS19OQU1FOworICAgICAgICAgICAg
ICAgICAgICBjb3B5LT5wbl9vcCA9IEpTT1BfTkFNRTsKKyAgICAgICAgICAgICAgICAgICAgY29w
eS0+cG5fcG9zID0gcG4yLT5wbl9wb3M7CisgICAgICAgICAgICAgICAgICAgIGlmIChwbjItPnBu
X2RlZm4pCisgICAgICAgICAgICAgICAgICAgICAgICBMaW5rVXNlVG9EZWYoY29weSwgKEpTRGVm
aW5pdGlvbiAqKSBwbjIsIHRjKTsKKyAgICAgICAgICAgICAgICAgICAgcG4yID0gY29weTsKKyAg
ICAgICAgICAgICAgICB9IGVsc2UgeworICAgICAgICAgICAgICAgICAgICBwbjIgPSBDbG9uZVBh
cnNlVHJlZShwbjIsIHRjKTsKKyAgICAgICAgICAgICAgICAgICAgaWYgKCFwbjIpCisgICAgICAg
ICAgICAgICAgICAgICAgICByZXR1cm4gTlVMTDsKKyAgICAgICAgICAgICAgICB9CisgICAgICAg
ICAgICB9CisgICAgICAgIH0gZWxzZSB7CisgICAgICAgICAgICAvKiBOb3QgYSBkZWNsYXJhdGlv
bi4gKi8KICAgICAgICAgICAgIHBuMiA9IHBuMTsKLSAgICAgICAgICAgIGlmIChwbjItPnBuX3R5
cGUgPT0gVE9LX0xQICYmCi0gICAgICAgICAgICAgICAgIU1ha2VTZXRDYWxsKGNvbnRleHQsIHBu
MiwgdGMsIEpTTVNHX0JBRF9MRUZUU0lERV9PRl9BU1MpKSB7Ci0gICAgICAgICAgICAgICAgcmV0
dXJuIE5VTEw7Ci0gICAgICAgICAgICB9Ci0jaWYgSlNfSEFTX1hNTF9TVVBQT1JUCi0gICAgICAg
ICAgICBpZiAocG4yLT5wbl90eXBlID09IFRPS19VTkFSWU9QKQotICAgICAgICAgICAgICAgIHBu
Mi0+cG5fb3AgPSBKU09QX0JJTkRYTUxOQU1FOwotI2VuZGlmCi0gICAgICAgIH0KKyAgICAgICAg
ICAgIHBuMSA9IE5VTEw7CisgICAgICAgIH0KKworICAgICAgICBpZiAoIXNldEFzc2lnbm1lbnRM
aHNPcHMocG4yLCBKU09QX05PUCkpCisgICAgICAgICAgICByZXR1cm4gTlVMTDsKIAogICAgICAg
ICBzd2l0Y2ggKHBuMi0+cG5fdHlwZSkgewogICAgICAgICAgIGNhc2UgVE9LX05BTUU6CiAgICAg
ICAgICAgICAvKiBCZXdhcmUgJ2ZvciAoYXJndW1lbnRzIGluIC4uLiknIHdpdGggb3Igd2l0aG91
dCBhICd2YXInLiAqLwogICAgICAgICAgICAgTm90ZUxWYWx1ZShjb250ZXh0LCBwbjIsIHRjLCBk
ZmxhZyk7CiAgICAgICAgICAgICBicmVhazsKIAogI2lmIEpTX0hBU19ERVNUUlVDVFVSSU5HCiAg
ICAgICAgICAgY2FzZSBUT0tfQVNTSUdOOgotICAgICAgICAgICAgcG4yID0gcG4yLT5wbl9sZWZ0
OwotICAgICAgICAgICAgSlNfQVNTRVJUKHBuMi0+cG5fdHlwZSA9PSBUT0tfUkIgfHwgcG4yLT5w
bl90eXBlID09IFRPS19SQyk7Ci0gICAgICAgICAgICAvKiBGQUxMIFRIUk9VR0ggKi8KKyAgICAg
ICAgICAgIEpTX05PVF9SRUFDSEVEKCJmb3JTdGF0ZW1lbnQgVE9LX0FTU0lHTiIpOworICAgICAg
ICAgICAgYnJlYWs7CisKICAgICAgICAgICBjYXNlIFRPS19SQjoKICAgICAgICAgICBjYXNlIFRP
S19SQzoKLSAgICAgICAgICAgIC8qIENoZWNrIGZvciB2YWxpZCBsdmFsdWVzIGluIHZhci1sZXNz
IGRlc3RydWN0dXJpbmcgZm9yLWluLiAqLwotICAgICAgICAgICAgaWYgKHBuMSA9PSBwbjIgJiYg
IUNoZWNrRGVzdHJ1Y3R1cmluZyhjb250ZXh0LCBOVUxMLCBwbjIsIHRjKSkKLSAgICAgICAgICAg
ICAgICByZXR1cm4gTlVMTDsKLQogICAgICAgICAgICAgaWYgKHZlcnNpb25OdW1iZXIoKSA9PSBK
U1ZFUlNJT05fMV83KSB7CiAgICAgICAgICAgICAgICAgLyoKICAgICAgICAgICAgICAgICAgKiBE
ZXN0cnVjdHVyaW5nIGZvci1pbiByZXF1aXJlcyBba2V5LCB2YWx1ZV0gZW51bWVyYXRpb24KICAg
ICAgICAgICAgICAgICAgKiBpbiBKUzEuNy4KICAgICAgICAgICAgICAgICAgKi8KICAgICAgICAg
ICAgICAgICBKU19BU1NFUlQocG4tPnBuX29wID09IEpTT1BfSVRFUik7CiAgICAgICAgICAgICAg
ICAgaWYgKCEocG4tPnBuX2lmbGFncyAmIEpTSVRFUl9GT1JFQUNIKSkKICAgICAgICAgICAgICAg
ICAgICAgcG4tPnBuX2lmbGFncyB8PSBKU0lURVJfRk9SRUFDSCB8IEpTSVRFUl9LRVlWQUxVRTsK
QEAgLTUyNzAsNzEgKzUzMTYsNjMgQEAgUGFyc2VyOjpmb3JTdGF0ZW1lbnQoKQogICAgICAgICAg
KiByZW1vdmluZyB0aGUgdG9wIHN0YXRlbWVudCBmcm9tIHRoZSBzdGF0ZW1lbnQtc3RhY2sgaWYg
dGhpcyBpcyBhCiAgICAgICAgICAqICdmb3IgKGxldCB4IGluIHkpJyBsb29wLgogICAgICAgICAg
Ki8KICNpZiBKU19IQVNfQkxPQ0tfU0NPUEUKICAgICAgICAgSlNTdG10SW5mbyAqc2F2ZSA9IHRj
LT50b3BTdG10OwogICAgICAgICBpZiAobGV0KQogICAgICAgICAgICAgdGMtPnRvcFN0bXQgPSBz
YXZlLT5kb3duOwogI2VuZGlmCi0gICAgICAgIHBuMiA9IGV4cHIoKTsKKyAgICAgICAgcG4zID0g
ZXhwcigpOwogI2lmIEpTX0hBU19CTE9DS19TQ09QRQogICAgICAgICBpZiAobGV0KQogICAgICAg
ICAgICAgdGMtPnRvcFN0bXQgPSBzYXZlOwogI2VuZGlmCiAKLSAgICAgICAgcG4yID0gSlNQYXJz
ZU5vZGU6Om5ld0JpbmFyeU9yQXBwZW5kKFRPS19JTiwgSlNPUF9OT1AsIHBuMSwgcG4yLCB0Yyk7
Ci0gICAgICAgIGlmICghcG4yKQotICAgICAgICAgICAgcmV0dXJuIE5VTEw7Ci0gICAgICAgIHBu
LT5wbl9sZWZ0ID0gcG4yOworICAgICAgICBwbjQtPnBuX3R5cGUgPSBUT0tfSU47CiAgICAgfSBl
bHNlIHsKLSAgICAgICAgaWYgKHBuLT5wbl9pZmxhZ3MgJiBKU0lURVJfRk9SRUFDSCkKLSAgICAg
ICAgICAgIGdvdG8gYmFkX2Zvcl9lYWNoOworICAgICAgICBpZiAocG4tPnBuX2lmbGFncyAmIEpT
SVRFUl9GT1JFQUNIKSB7CisgICAgICAgICAgICByZXBvcnRFcnJvck51bWJlcihwbiwgSlNSRVBP
UlRfRVJST1IsIEpTTVNHX0JBRF9GT1JfRUFDSF9MT09QKTsKKyAgICAgICAgICAgIHJldHVybiBO
VUxMOworICAgICAgICB9CiAgICAgICAgIHBuLT5wbl9vcCA9IEpTT1BfTk9QOwogCiAgICAgICAg
IC8qIFBhcnNlIHRoZSBsb29wIGNvbmRpdGlvbiBvciBudWxsIGludG8gcG4yLiAqLwogICAgICAg
ICBNVVNUX01BVENIX1RPS0VOKFRPS19TRU1JLCBKU01TR19TRU1JX0FGVEVSX0ZPUl9JTklUKTsK
ICAgICAgICAgdHQgPSB0b2tlblN0cmVhbS5wZWVrVG9rZW4oVFNGX09QRVJBTkQpOwotICAgICAg
ICBKU1BhcnNlTm9kZSAqcG4yOwogICAgICAgICBpZiAodHQgPT0gVE9LX1NFTUkpIHsKICAgICAg
ICAgICAgIHBuMiA9IE5VTEw7CiAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICBwbjIgPSBl
eHByKCk7CiAgICAgICAgICAgICBpZiAoIXBuMikKICAgICAgICAgICAgICAgICByZXR1cm4gTlVM
TDsKICAgICAgICAgfQogCiAgICAgICAgIC8qIFBhcnNlIHRoZSB1cGRhdGUgZXhwcmVzc2lvbiBv
ciBudWxsIGludG8gcG4zLiAqLwogICAgICAgICBNVVNUX01BVENIX1RPS0VOKFRPS19TRU1JLCBK
U01TR19TRU1JX0FGVEVSX0ZPUl9DT05EKTsKICAgICAgICAgdHQgPSB0b2tlblN0cmVhbS5wZWVr
VG9rZW4oVFNGX09QRVJBTkQpOwotICAgICAgICBKU1BhcnNlTm9kZSAqcG4zOwogICAgICAgICBp
ZiAodHQgPT0gVE9LX1JQKSB7CiAgICAgICAgICAgICBwbjMgPSBOVUxMOwogICAgICAgICB9IGVs
c2UgewogICAgICAgICAgICAgcG4zID0gZXhwcigpOwogICAgICAgICAgICAgaWYgKCFwbjMpCiAg
ICAgICAgICAgICAgICAgcmV0dXJuIE5VTEw7CiAgICAgICAgIH0KIAotICAgICAgICAvKiBCdWls
ZCB0aGUgRk9SSEVBRCBub2RlIHRvIHVzZSBhcyB0aGUgbGVmdCBraWQgb2YgcG4uICovCi0gICAg
ICAgIEpTUGFyc2VOb2RlICpwbjQgPSBUZXJuYXJ5Tm9kZTo6Y3JlYXRlKHRjKTsKLSAgICAgICAg
aWYgKCFwbjQpCi0gICAgICAgICAgICByZXR1cm4gTlVMTDsKICAgICAgICAgcG40LT5wbl90eXBl
ID0gVE9LX0ZPUkhFQUQ7Ci0gICAgICAgIHBuNC0+cG5fb3AgPSBKU09QX05PUDsKLSAgICAgICAg
cG40LT5wbl9raWQxID0gcG4xOwotICAgICAgICBwbjQtPnBuX2tpZDIgPSBwbjI7Ci0gICAgICAg
IHBuNC0+cG5fa2lkMyA9IHBuMzsKLSAgICAgICAgcG4tPnBuX2xlZnQgPSBwbjQ7Ci0gICAgfQor
ICAgIH0KKyAgICBwbjQtPnBuX29wID0gSlNPUF9OT1A7CisgICAgcG40LT5wbl9raWQxID0gcG4x
OworICAgIHBuNC0+cG5fa2lkMiA9IHBuMjsKKyAgICBwbjQtPnBuX2tpZDMgPSBwbjM7CisgICAg
cG4tPnBuX2xlZnQgPSBwbjQ7CiAKICAgICBNVVNUX01BVENIX1RPS0VOKFRPS19SUCwgSlNNU0df
UEFSRU5fQUZURVJfRk9SX0NUUkwpOwogCiAgICAgLyogUGFyc2UgdGhlIGxvb3AgYm9keSBpbnRv
IHBuLT5wbl9yaWdodC4gKi8KLSAgICBKU1BhcnNlTm9kZSAqcG4yOwogICAgIHBuMiA9IHN0YXRl
bWVudCgpOwogICAgIGlmICghcG4yKQogICAgICAgICByZXR1cm4gTlVMTDsKICAgICBwbi0+cG5f
cmlnaHQgPSBwbjI7CiAKICAgICAvKiBSZWNvcmQgdGhlIGFic29sdXRlIGxpbmUgbnVtYmVyIGZv
ciBzb3VyY2Ugbm90ZSBlbWlzc2lvbi4gKi8KICAgICBwbi0+cG5fcG9zLmVuZCA9IHBuMi0+cG5f
cG9zLmVuZDsKIApAQCAtNTM0NywyMCArNTM4NSwxNiBAQCBQYXJzZXI6OmZvclN0YXRlbWVudCgp
CiAjZW5kaWYKICAgICBpZiAocG5zZXEpIHsKICAgICAgICAgcG5zZXEtPnBuX3Bvcy5lbmQgPSBw
bi0+cG5fcG9zLmVuZDsKICAgICAgICAgcG5zZXEtPmFwcGVuZChwbik7CiAgICAgICAgIHBuID0g
cG5zZXE7CiAgICAgfQogICAgIFBvcFN0YXRlbWVudCh0Yyk7CiAgICAgcmV0dXJuIHBuOwotCi0g
IGJhZF9mb3JfZWFjaDoKLSAgICByZXBvcnRFcnJvck51bWJlcihwbiwgSlNSRVBPUlRfRVJST1Is
IEpTTVNHX0JBRF9GT1JfRUFDSF9MT09QKTsKLSAgICByZXR1cm4gTlVMTDsKIH0KIAogSlNQYXJz
ZU5vZGUgKgogUGFyc2VyOjp0cnlTdGF0ZW1lbnQoKQogewogICAgIEpTUGFyc2VOb2RlICpjYXRj
aExpc3QsICpsYXN0Q2F0Y2g7CiAKICAgICAvKgpAQCAtNjUwMSw4MiArNjUzNSw4OSBAQCBQYXJz
ZXI6OmNvbmRFeHByMSgpCiAgICAgICAgIHBuLT5wbl9raWQxID0gcG4xOwogICAgICAgICBwbi0+
cG5fa2lkMiA9IHBuMjsKICAgICAgICAgcG4tPnBuX2tpZDMgPSBwbjM7CiAgICAgICAgIHRva2Vu
U3RyZWFtLmdldFRva2VuKCk7ICAgICAvKiBuZWVkIHRvIHJlYWQgb25lIHRva2VuIHBhc3QgdGhl
IGVuZCAqLwogICAgIH0KICAgICByZXR1cm4gcG47CiB9CiAKLUpTUGFyc2VOb2RlICoKLVBhcnNl
cjo6YXNzaWduRXhwcigpCi17Ci0gICAgSlNfQ0hFQ0tfUkVDVVJTSU9OKGNvbnRleHQsIHJldHVy
biBOVUxMKTsKLQotI2lmIEpTX0hBU19HRU5FUkFUT1JTCi0gICAgaWYgKHRva2VuU3RyZWFtLm1h
dGNoVG9rZW4oVE9LX1lJRUxELCBUU0ZfT1BFUkFORCkpCi0gICAgICAgIHJldHVybiByZXR1cm5P
cllpZWxkKHRydWUpOwotI2VuZGlmCi0KLSAgICBKU1BhcnNlTm9kZSAqcG4gPSBjb25kRXhwcjEo
KTsKLSAgICBpZiAoIXBuKQotICAgICAgICByZXR1cm4gTlVMTDsKLQotICAgIGlmICghdG9rZW5T
dHJlYW0uaXNDdXJyZW50VG9rZW5UeXBlKFRPS19BU1NJR04pKSB7Ci0gICAgICAgIHRva2VuU3Ry
ZWFtLnVuZ2V0VG9rZW4oKTsKLSAgICAgICAgcmV0dXJuIHBuOwotICAgIH0KLQotICAgIEpTT3Ag
b3AgPSB0b2tlblN0cmVhbS5jdXJyZW50VG9rZW4oKS50X29wOworYm9vbAorUGFyc2VyOjpzZXRB
c3NpZ25tZW50TGhzT3BzKEpTUGFyc2VOb2RlICpwbiwgSlNPcCBvcCkKK3sKICAgICBzd2l0Y2gg
KHBuLT5wbl90eXBlKSB7CiAgICAgICBjYXNlIFRPS19OQU1FOgogICAgICAgICBpZiAoIUNoZWNr
U3RyaWN0QXNzaWdubWVudChjb250ZXh0LCB0YywgcG4pKQotICAgICAgICAgICAgcmV0dXJuIE5V
TEw7Ci0gICAgICAgIHBuLT5wbl9vcCA9IEpTT1BfU0VUTkFNRTsKKyAgICAgICAgICAgIHJldHVy
biBmYWxzZTsKKyAgICAgICAgcG4tPnBuX29wID0gKHBuLT5wbl9vcCA9PSBKU09QX0dFVExPQ0FM
KSA/IEpTT1BfU0VUTE9DQUwgOiBKU09QX1NFVE5BTUU7CiAgICAgICAgIE5vdGVMVmFsdWUoY29u
dGV4dCwgcG4sIHRjKTsKICAgICAgICAgYnJlYWs7CiAgICAgICBjYXNlIFRPS19ET1Q6CiAgICAg
ICAgIHBuLT5wbl9vcCA9IEpTT1BfU0VUUFJPUDsKICAgICAgICAgYnJlYWs7CiAgICAgICBjYXNl
IFRPS19MQjoKICAgICAgICAgcG4tPnBuX29wID0gSlNPUF9TRVRFTEVNOwogICAgICAgICBicmVh
azsKICNpZiBKU19IQVNfREVTVFJVQ1RVUklORwogICAgICAgY2FzZSBUT0tfUkI6CiAgICAgICBj
YXNlIFRPS19SQzoKLSAgICAgIHsKICAgICAgICAgaWYgKG9wICE9IEpTT1BfTk9QKSB7CiAgICAg
ICAgICAgICByZXBvcnRFcnJvck51bWJlcihOVUxMLCBKU1JFUE9SVF9FUlJPUiwgSlNNU0dfQkFE
X0RFU1RSVUNUX0FTUyk7Ci0gICAgICAgICAgICByZXR1cm4gTlVMTDsKLSAgICAgICAgfQotICAg
ICAgICBKU1BhcnNlTm9kZSAqcmhzID0gYXNzaWduRXhwcigpOwotICAgICAgICBpZiAoIXJocyB8
fCAhQ2hlY2tEZXN0cnVjdHVyaW5nKGNvbnRleHQsIE5VTEwsIHBuLCB0YykpCi0gICAgICAgICAg
ICByZXR1cm4gTlVMTDsKLSAgICAgICAgcmV0dXJuIEpTUGFyc2VOb2RlOjpuZXdCaW5hcnlPckFw
cGVuZChUT0tfQVNTSUdOLCBvcCwgcG4sIHJocywgdGMpOwotICAgICAgfQorICAgICAgICAgICAg
cmV0dXJuIGZhbHNlOworICAgICAgICB9CisgICAgICAgIGlmICghQ2hlY2tEZXN0cnVjdHVyaW5n
KGNvbnRleHQsIE5VTEwsIHBuLCB0YykpCisgICAgICAgICAgICByZXR1cm4gZmFsc2U7CisgICAg
ICAgIGJyZWFrOwogI2VuZGlmCiAgICAgICBjYXNlIFRPS19MUDoKICAgICAgICAgaWYgKCFNYWtl
U2V0Q2FsbChjb250ZXh0LCBwbiwgdGMsIEpTTVNHX0JBRF9MRUZUU0lERV9PRl9BU1MpKQotICAg
ICAgICAgICAgcmV0dXJuIE5VTEw7CisgICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAg
IGJyZWFrOwogI2lmIEpTX0hBU19YTUxfU1VQUE9SVAogICAgICAgY2FzZSBUT0tfVU5BUllPUDoK
ICAgICAgICAgaWYgKHBuLT5wbl9vcCA9PSBKU09QX1hNTE5BTUUpIHsKICAgICAgICAgICAgIHBu
LT5wbl9vcCA9IEpTT1BfU0VUWE1MTkFNRTsKICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICB9
CiAgICAgICAgIC8qIEZBTEwgVEhST1VHSCAqLwogI2VuZGlmCiAgICAgICBkZWZhdWx0OgogICAg
ICAgICByZXBvcnRFcnJvck51bWJlcihOVUxMLCBKU1JFUE9SVF9FUlJPUiwgSlNNU0dfQkFEX0xF
RlRTSURFX09GX0FTUyk7CisgICAgICAgIHJldHVybiBmYWxzZTsKKyAgICB9CisgICAgcmV0dXJu
IHRydWU7Cit9CisKK0pTUGFyc2VOb2RlICoKK1BhcnNlcjo6YXNzaWduRXhwcigpCit7CisgICAg
SlNfQ0hFQ0tfUkVDVVJTSU9OKGNvbnRleHQsIHJldHVybiBOVUxMKTsKKworI2lmIEpTX0hBU19H
RU5FUkFUT1JTCisgICAgaWYgKHRva2VuU3RyZWFtLm1hdGNoVG9rZW4oVE9LX1lJRUxELCBUU0Zf
T1BFUkFORCkpCisgICAgICAgIHJldHVybiByZXR1cm5PcllpZWxkKHRydWUpOworI2VuZGlmCisK
KyAgICBKU1BhcnNlTm9kZSAqcG4gPSBjb25kRXhwcjEoKTsKKyAgICBpZiAoIXBuKQogICAgICAg
ICByZXR1cm4gTlVMTDsKLSAgICB9CisKKyAgICBpZiAoIXRva2VuU3RyZWFtLmlzQ3VycmVudFRv
a2VuVHlwZShUT0tfQVNTSUdOKSkgeworICAgICAgICB0b2tlblN0cmVhbS51bmdldFRva2VuKCk7
CisgICAgICAgIHJldHVybiBwbjsKKyAgICB9CisKKyAgICBKU09wIG9wID0gdG9rZW5TdHJlYW0u
Y3VycmVudFRva2VuKCkudF9vcDsKKyAgICBpZiAoIXNldEFzc2lnbm1lbnRMaHNPcHMocG4sIG9w
KSkKKyAgICAgICAgcmV0dXJuIE5VTEw7CiAKICAgICBKU1BhcnNlTm9kZSAqcmhzID0gYXNzaWdu
RXhwcigpOwotICAgIGlmIChyaHMgJiYgUE5fVFlQRShwbikgPT0gVE9LX05BTUUgJiYgcG4tPnBu
X3VzZWQpIHsKKyAgICBpZiAoIXJocykKKyAgICAgICAgcmV0dXJuIE5VTEw7CisgICAgaWYgKFBO
X1RZUEUocG4pID09IFRPS19OQU1FICYmIHBuLT5wbl91c2VkKSB7CiAgICAgICAgIEpTRGVmaW5p
dGlvbiAqZG4gPSBwbi0+cG5fbGV4ZGVmOwogCiAgICAgICAgIC8qCiAgICAgICAgICAqIElmIHRo
ZSBkZWZpbml0aW9uIGlzIG5vdCBmbGFnZ2VkIGFzIGFzc2lnbmVkLCB3ZSBtdXN0IGhhdmUgaW1w
dXRlZAogICAgICAgICAgKiB0aGUgaW5pdGlhbGl6ZWQgZmxhZyB0byBpdCwgdG8gb3B0aW1pemUg
Zm9yIGZsYXQgY2xvc3VyZXMuIEJ1dCB0aGF0CiAgICAgICAgICAqIG9wdGltaXphdGlvbiB1c2Vz
IHNvdXJjZSBjb29yZGluYXRlcyB0byBjaGVjayBkb21pbmFuY2UgcmVsYXRpb25zLAogICAgICAg
ICAgKiBzbyB3ZSBtdXN0IGV4dGVuZCB0aGUgZW5kIG9mIHRoZSBkZWZpbml0aW9uIHRvIGNvdmVy
IHRoZSByaWdodC1oYW5kCiAgICAgICAgICAqIHNpZGUgb2YgdGhpcyBhc3NpZ25tZW50LCBpLmUu
LCB0aGUgaW5pdGlhbGl6ZXIuCkBAIC03MDA0LDE4ICs3MDQ1LDE3IEBAIENvbXBFeHByVHJhbnNw
bGFudGVyOjp0cmFuc3BsYW50KEpTUGFyc2UKICAqIGFuIGV4cHJlc3Npb24gaW4gYW4gb3BlbiBw
YXJlbnRoZXNpcywgcGFyc2UgdGhlIHRhaWwgb2YgdGhlIGNvbXByZWhlbnNpb24KICAqIG9yIGdl
bmVyYXRvciBleHByZXNzaW9uIHNpZ25pZmllZCBieSB0aGlzIHxmb3J8IGtleXdvcmQgaW4gY29u
dGV4dC4KICAqCiAgKiBSZXR1cm4gbnVsbCBvbiBmYWlsdXJlLCBlbHNlIHJldHVybiB0aGUgdG9w
LW1vc3QgcGFyc2Ugbm9kZSBmb3IgdGhlIGFycmF5CiAgKiBjb21wcmVoZW5zaW9uIG9yIGdlbmVy
YXRvciBleHByZXNzaW9uLCB3aXRoIGEgdW5hcnkgbm9kZSBhcyB0aGUgYm9keSBvZiB0aGUKICAq
IChwb3NzaWJseSBuZXN0ZWQpIGZvci1sb29wLCBpbml0aWFsaXplZCBieSB8dHlwZSwgb3AsIGtp
ZHwuCiAgKi8KIEpTUGFyc2VOb2RlICoKLVBhcnNlcjo6Y29tcHJlaGVuc2lvblRhaWwoSlNQYXJz
ZU5vZGUgKmtpZCwgdWludE4gYmxvY2tpZCwKLSAgICAgICAgICAgICAgICAgICAgICAgICAgVG9r
ZW5LaW5kIHR5cGUsIEpTT3Agb3ApCitQYXJzZXI6OmNvbXByZWhlbnNpb25UYWlsKEpTUGFyc2VO
b2RlICpraWQsIHVpbnROIGJsb2NraWQsIFRva2VuS2luZCB0eXBlLCBKU09wIG9wKQogewogICAg
IHVpbnROIGFkanVzdDsKICAgICBKU1BhcnNlTm9kZSAqcG4sICpwbjIsICpwbjMsICoqcG5wOwog
ICAgIEpTU3RtdEluZm8gc3RtdEluZm87CiAgICAgQmluZERhdGEgZGF0YTsKICAgICBUb2tlbktp
bmQgdHQ7CiAgICAgSlNBdG9tICphdG9tOwogCkBAIC03MTU3LDE3ICs3MTk3LDIwIEBAIFBhcnNl
cjo6Y29tcHJlaGVuc2lvblRhaWwoSlNQYXJzZU5vZGUgKmsKICAgICAgICAgICAgIGRhdGEucG4g
PSBwbjM7CiAgICAgICAgICAgICBpZiAoIWRhdGEuYmluZGVyKGNvbnRleHQsICZkYXRhLCBhdG9t
LCB0YykpCiAgICAgICAgICAgICAgICAgcmV0dXJuIE5VTEw7CiAgICAgICAgICAgICBicmVhazsK
IAogICAgICAgICAgIGRlZmF1bHQ6OwogICAgICAgICB9CiAKLSAgICAgICAgcG4yLT5wbl9sZWZ0
ID0gSlNQYXJzZU5vZGU6Om5ld0JpbmFyeU9yQXBwZW5kKFRPS19JTiwgSlNPUF9OT1AsIHBuMywg
cG40LCB0Yyk7CisgICAgICAgIGlmICghc2V0QXNzaWdubWVudExoc09wcyhwbjMsIEpTT1BfTk9Q
KSkKKyAgICAgICAgICAgIHJldHVybiBOVUxMOworCisgICAgICAgIHBuMi0+cG5fbGVmdCA9IEpT
UGFyc2VOb2RlOjpuZXdUZXJuYXJ5KFRPS19JTiwgSlNPUF9OT1AsIE5VTEwsIHBuMywgcG40LCB0
Yyk7CiAgICAgICAgIGlmICghcG4yLT5wbl9sZWZ0KQogICAgICAgICAgICAgcmV0dXJuIE5VTEw7
CiAgICAgICAgICpwbnAgPSBwbjI7CiAgICAgICAgIHBucCA9ICZwbjItPnBuX3JpZ2h0OwogICAg
IH0gd2hpbGUgKHRva2VuU3RyZWFtLm1hdGNoVG9rZW4oVE9LX0ZPUikpOwogCiAgICAgaWYgKHRv
a2VuU3RyZWFtLm1hdGNoVG9rZW4oVE9LX0lGKSkgewogICAgICAgICBwbjIgPSBUZXJuYXJ5Tm9k
ZTo6Y3JlYXRlKHRjKTsKQEAgLTgzNzAsMjAgKzg0MTMsMTkgQEAgUGFyc2VyOjpwcmltYXJ5RXhw
cihUb2tlbktpbmQgdHQsIEpTQm9vbAogICAgICAgICAgICAgICoKICAgICAgICAgICAgICAqICAg
SlNPUF9FTlRFUkJMT0NLIDxvPiAuLi4gSlNPUF9MRUFWRUJMT0NLIDxuPgogICAgICAgICAgICAg
ICoKICAgICAgICAgICAgICAqIHdoZXJlIDxvPiBpcyBhIGxpdGVyYWwgb2JqZWN0IHJlcHJlc2Vu
dGluZyB0aGUgYmxvY2sgc2NvcGUsCiAgICAgICAgICAgICAgKiB3aXRoIDxuPiBwcm9wZXJ0aWVz
LCBuYW1pbmcgZWFjaCB2YXIgZGVjbGFyZWQgaW4gdGhlIGJsb2NrLgogICAgICAgICAgICAgICoK
ICAgICAgICAgICAgICAqIEVhY2ggdmFyIGRlY2xhcmF0aW9uIGluIGEgbGV0LWJsb2NrIGJpbmRz
IGEgbmFtZSBpbiA8bz4gYXQKICAgICAgICAgICAgICAqIGNvbXBpbGUgdGltZSwgYW5kIGFsbG9j
YXRlcyBhIHNsb3Qgb24gdGhlIG9wZXJhbmQgc3RhY2sgYXQKLSAgICAgICAgICAgICAqIHJ1bnRp
bWUgdmlhIEpTT1BfRU5URVJCTE9DSy4gIEEgYmxvY2stbG9jYWwgdmFyIGlzIGFjY2Vzc2VkCi0g
ICAgICAgICAgICAgKiBieSB0aGUgSlNPUF9HRVRMT0NBTCBhbmQgSlNPUF9TRVRMT0NBTCBvcHMs
IGFuZCBpdGVyYXRlZCB3aXRoCi0gICAgICAgICAgICAgKiBKU09QX0ZPUkxPQ0FMLiAgVGhlc2Ug
b3BzIGFsbCBoYXZlIGFuIGltbWVkaWF0ZSBvcGVyYW5kLCB0aGUKLSAgICAgICAgICAgICAqIGxv
Y2FsIHNsb3QncyBzdGFjayBpbmRleCBmcm9tIGZwLT5zcGJhc2UuCisgICAgICAgICAgICAgKiBy
dW50aW1lIHZpYSBKU09QX0VOVEVSQkxPQ0suICBBIGJsb2NrLWxvY2FsIHZhciBpcyBhY2Nlc3Nl
ZCBieQorICAgICAgICAgICAgICogdGhlIEpTT1BfR0VUTE9DQUwgYW5kIEpTT1BfU0VUTE9DQUwg
b3BzLiAgVGhlc2Ugb3BzIGFsbCBoYXZlIGFuCisgICAgICAgICAgICAgKiBpbW1lZGlhdGUgb3Bl
cmFuZCwgdGhlIGxvY2FsIHNsb3QncyBzdGFjayBpbmRleCBmcm9tIGZwLT5zcGJhc2UuCiAgICAg
ICAgICAgICAgKgogICAgICAgICAgICAgICogVGhlIGFycmF5IGNvbXByZWhlbnNpb24gaXRlcmF0
aW9uIHN0ZXAsIGFycmF5LnB1c2goaSAqIGopIGluCiAgICAgICAgICAgICAgKiB0aGUgZXhhbXBs
ZSBhYm92ZSwgaXMgZG9uZSBieSA8aSAqIGo+OyBKU09QX0FSUkFZQ09NUCA8YXJyYXk+LAogICAg
ICAgICAgICAgICogd2hlcmUgPGFycmF5PiBpcyB0aGUgaW5kZXggb2YgYXJyYXkncyBzdGFjayBz
bG90LgogICAgICAgICAgICAgICovCiAgICAgICAgICAgICBpZiAoaW5kZXggPT0gMCAmJiBwbi0+
cG5fY291bnQgIT0gMCAmJiB0b2tlblN0cmVhbS5tYXRjaFRva2VuKFRPS19GT1IpKSB7CiAgICAg
ICAgICAgICAgICAgSlNQYXJzZU5vZGUgKnBuZXhwLCAqcG50b3A7CiAKZGlmZiAtLWdpdCBhL2pz
L3NyYy9qc3BhcnNlLmggYi9qcy9zcmMvanNwYXJzZS5oCi0tLSBhL2pzL3NyYy9qc3BhcnNlLmgK
KysrIGIvanMvc3JjL2pzcGFyc2UuaApAQCAtOTgsMjEgKzk4LDI0IEBAIEpTX0JFR0lOX0VYVEVS
Tl9DCiAgKiAgICAgICAgICAgICAgICAgICAgICAgICAgICBUT0tfTEVYSUNBTFNDT1BFIG5vZGUg
dGhhdCBjb250YWlucyB0aGUgbGlzdCBvZgogICogICAgICAgICAgICAgICAgICAgICAgICAgICAg
VE9LX0NBU0Ugbm9kZXMuCiAgKiBUT0tfQ0FTRSwgICAgYmluYXJ5ICAgICAgcG5fbGVmdDogY2Fz
ZSBleHByIG9yIG51bGwgaWYgVE9LX0RFRkFVTFQKICAqIFRPS19ERUZBVUxUICAgICAgICAgICAg
ICBwbl9yaWdodDogVE9LX0xDIG5vZGUgZm9yIHRoaXMgY2FzZSdzIHN0YXRlbWVudHMKICAqICAg
ICAgICAgICAgICAgICAgICAgICAgICBwbl92YWw6IGNvbnN0YW50IHZhbHVlIGlmIGxvb2t1cCBv
ciB0YWJsZSBzd2l0Y2gKICAqIFRPS19XSElMRSAgICBiaW5hcnkgICAgICBwbl9sZWZ0OiBjb25k
LCBwbl9yaWdodDogYm9keQogICogVE9LX0RPICAgICAgIGJpbmFyeSAgICAgIHBuX2xlZnQ6IGJv
ZHksIHBuX3JpZ2h0OiBjb25kCiAgKiBUT0tfRk9SICAgICAgYmluYXJ5ICAgICAgcG5fbGVmdDog
ZWl0aGVyCi0gKiAgICAgICAgICAgICAgICAgICAgICAgICAgICBmb3IvaW4gbG9vcDogYSBiaW5h
cnkgVE9LX0lOIG5vZGUgd2l0aAotICogICAgICAgICAgICAgICAgICAgICAgICAgICAgICBwbl9s
ZWZ0OiAgVE9LX1ZBUiBvciBUT0tfTkFNRSB0byBsZWZ0IG9mICdpbicKLSAqICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICBpZiBUT0tfVkFSLCBpdHMgcG5feGZsYWdzIG1heSBoYXZlIFBO
WF9QT1BWQVIKKyAqICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZvci9pbiBsb29wOiBhIHRl
cm5hcnkgVE9LX0lOIG5vZGUgd2l0aAorICogICAgICAgICAgICAgICAgICAgICAgICAgICAgICBw
bl9raWQxOiAgVE9LX1ZBUiB0byBsZWZ0IG9mICdpbicsIG9yIE5VTEwKKyAqICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICBpdHMgcG5feGZsYWdzIG1heSBoYXZlIFBOWF9QT1BWQVIKICAq
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhbmQgUE5YX0ZPUklOVkFSIGJpdHMgc2V0
Ci0gKiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBuX3JpZ2h0OiBvYmplY3QgZXhwciB0
byByaWdodCBvZiAnaW4nCisgKiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBuX2tpZDI6
IFRPS19OQU1FIG9yIGRlc3RydWN0dXJpbmcgZXhwcgorICogICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgIHRvIGxlZnQgb2YgJ2luJzsgaWYgcG5fa2lkMSwgdGhlbiB0aGlzCisgKiAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgaXMgYSBjbG9uZSBvZiBwbl9raWQxLT5wbl9oZWFk
CisgKiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBuX2tpZDM6IG9iamVjdCBleHByIHRv
IHJpZ2h0IG9mICdpbicKICAqICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZvcig7OykgbG9v
cDogYSB0ZXJuYXJ5IFRPS19SRVNFUlZFRCBub2RlIHdpdGgKICAqICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgcG5fa2lkMTogIGluaXQgZXhwciBiZWZvcmUgZmlyc3QgJzsnCiAgKiAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgIHBuX2tpZDI6ICBjb25kIGV4cHIgYmVmb3JlIHNlY29u
ZCAnOycKICAqICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcG5fa2lkMzogIHVwZGF0ZSBl
eHByIGFmdGVyIHNlY29uZCAnOycKICAqICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYW55
IGtpZCBtYXkgYmUgbnVsbAogICogICAgICAgICAgICAgICAgICAgICAgICAgIHBuX3JpZ2h0OiBi
b2R5CiAgKiBUT0tfVEhST1cgICAgdW5hcnkgICAgICAgcG5fb3A6IEpTT1BfVEhST1csIHBuX2tp
ZDogZXhjZXB0aW9uCiAgKiBUT0tfVFJZICAgICAgdGVybmFyeSAgICAgcG5fa2lkMTogdHJ5IGJs
b2NrCkBAIC00NTQsMTYgKzQ1NywxOSBAQCBwcm90ZWN0ZWQ6CiAgICAgfQogCiAgICAgc3RhdGlj
IEpTUGFyc2VOb2RlICpjcmVhdGUoSlNQYXJzZU5vZGVBcml0eSBhcml0eSwgSlNUcmVlQ29udGV4
dCAqdGMpOwogCiBwdWJsaWM6CiAgICAgc3RhdGljIEpTUGFyc2VOb2RlICpuZXdCaW5hcnlPckFw
cGVuZChqczo6VG9rZW5LaW5kIHR0LCBKU09wIG9wLCBKU1BhcnNlTm9kZSAqbGVmdCwKICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIEpTUGFyc2VOb2RlICpyaWdodCwg
SlNUcmVlQ29udGV4dCAqdGMpOwogCisgICAgc3RhdGljIEpTUGFyc2VOb2RlICpuZXdUZXJuYXJ5
KGpzOjpUb2tlbktpbmQgdHQsIEpTT3Agb3AsIEpTUGFyc2VOb2RlICpraWQxLCBKU1BhcnNlTm9k
ZSAqa2lkMiwKKyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgSlNQYXJzZU5vZGUg
KmtpZDMsIEpTVHJlZUNvbnRleHQgKnRjKTsKKwogICAgIC8qCiAgICAgICogVGhlIHBuX2V4cHIg
YW5kIGxleGRlZiBtZW1iZXJzIGFyZSBhcm1zIG9mIGFuIHVuc2FmZSB1bmlvbi4gVW5sZXNzIHlv
dQogICAgICAqIGtub3cgZXhhY3RseSB3aGF0IHlvdSdyZSBkb2luZywgdXNlIG9ubHkgdGhlIGZv
bGxvd2luZyBtZXRob2RzIHRvIGFjY2VzcwogICAgICAqIHRoZW0uIEZvciBsZXNzIG92ZXJoZWFk
IGFuZCBhc3NlcnRpb25zIGZvciBwcm90ZWN0aW9uLCB1c2UgcG4tPmV4cHIoKQogICAgICAqIGFu
ZCBwbi0+bGV4ZGVmKCkuIE90aGVyd2lzZSwgdXNlIHBuLT5tYXliZUV4cHIoKSBhbmQgcG4tPm1h
eWJlTGV4RGVmKCkuCiAgICAgICovCiAgICAgSlNQYXJzZU5vZGUgICpleHByKCkgY29uc3Qgewog
ICAgICAgICBKU19BU1NFUlQoIXBuX3VzZWQpOwpAQCAtMTIxNiwxNiArMTIyMiwxOCBAQCBwcml2
YXRlOgogICAgIEpTUGFyc2VOb2RlICp4bWxFeHByKEpTQm9vbCBpblRhZyk7CiAgICAgSlNQYXJz
ZU5vZGUgKnhtbEF0b21Ob2RlKCk7CiAgICAgSlNQYXJzZU5vZGUgKnhtbE5hbWVFeHByKCk7CiAg
ICAgSlNQYXJzZU5vZGUgKnhtbFRhZ0NvbnRlbnQoanM6OlRva2VuS2luZCB0YWd0eXBlLCBKU0F0
b20gKipuYW1lcCk7CiAgICAgSlNCb29sIHhtbEVsZW1lbnRDb250ZW50KEpTUGFyc2VOb2RlICpw
bik7CiAgICAgSlNQYXJzZU5vZGUgKnhtbEVsZW1lbnRPckxpc3QoSlNCb29sIGFsbG93TGlzdCk7
CiAgICAgSlNQYXJzZU5vZGUgKnhtbEVsZW1lbnRPckxpc3RSb290KEpTQm9vbCBhbGxvd0xpc3Qp
OwogI2VuZGlmIC8qIEpTX0hBU19YTUxfU1VQUE9SVCAqLworCisgICAgYm9vbCBzZXRBc3NpZ25t
ZW50TGhzT3BzKEpTUGFyc2VOb2RlICpwbiwgSlNPcCBvcCk7CiB9OwogCiBpbmxpbmUgYm9vbAog
UGFyc2VyOjpyZXBvcnRFcnJvck51bWJlcihKU1BhcnNlTm9kZSAqcG4sIHVpbnROIGZsYWdzLCB1
aW50TiBlcnJvck51bWJlciwgLi4uKQogewogICAgIHZhX2xpc3QgYXJnczsKICAgICB2YV9zdGFy
dChhcmdzLCBlcnJvck51bWJlcik7CiAgICAgYm9vbCByZXN1bHQgPSB0b2tlblN0cmVhbS5yZXBv
cnRDb21waWxlRXJyb3JOdW1iZXJWQShwbiwgZmxhZ3MsIGVycm9yTnVtYmVyLCBhcmdzKTsKZGlm
ZiAtLWdpdCBhL2pzL3NyYy9qc3JlZmxlY3QuY3BwIGIvanMvc3JjL2pzcmVmbGVjdC5jcHAKLS0t
IGEvanMvc3JjL2pzcmVmbGVjdC5jcHAKKysrIGIvanMvc3JjL2pzcmVmbGVjdC5jcHAKQEAgLTIx
ODksMjEgKzIxODksMjEgQEAgQVNUU2VyaWFsaXplcjo6c3RhdGVtZW50KEpTUGFyc2VOb2RlICpw
bgogICAgICAgICBpZiAoIXN0YXRlbWVudChwbi0+cG5fcmlnaHQsICZzdG10KSkKICAgICAgICAg
ICAgIHJldHVybiBmYWxzZTsKIAogICAgICAgICBib29sIGlzRm9yRWFjaCA9IHBuLT5wbl9pZmxh
Z3MgJiBKU0lURVJfRk9SRUFDSDsKIAogICAgICAgICBpZiAoUE5fVFlQRShoZWFkKSA9PSBUT0tf
SU4pIHsKICAgICAgICAgICAgIFZhbHVlIHZhciwgZXhwcjsKIAotICAgICAgICAgICAgcmV0dXJu
IChQTl9UWVBFKGhlYWQtPnBuX2xlZnQpID09IFRPS19WQVIKLSAgICAgICAgICAgICAgICAgICAg
PyB2YXJpYWJsZURlY2xhcmF0aW9uKGhlYWQtPnBuX2xlZnQsIGZhbHNlLCAmdmFyKQotICAgICAg
ICAgICAgICAgICAgICA6IFBOX1RZUEUoaGVhZC0+cG5fbGVmdCkgPT0gVE9LX0xFVAotICAgICAg
ICAgICAgICAgICAgICA/IHZhcmlhYmxlRGVjbGFyYXRpb24oaGVhZC0+cG5fbGVmdCwgdHJ1ZSwg
JnZhcikKLSAgICAgICAgICAgICAgICAgICAgOiBwYXR0ZXJuKGhlYWQtPnBuX2xlZnQsIE5VTEws
ICZ2YXIpKSAmJgorICAgICAgICAgICAgcmV0dXJuICghaGVhZC0+cG5fa2lkMQorICAgICAgICAg
ICAgICAgICAgICA/IHBhdHRlcm4oaGVhZC0+cG5fa2lkMiwgTlVMTCwgJnZhcikKKyAgICAgICAg
ICAgICAgICAgICAgOiB2YXJpYWJsZURlY2xhcmF0aW9uKGhlYWQtPnBuX2tpZDEsCisgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBQTl9UWVBFKGhlYWQtPnBuX2tpZDEp
ID09IFRPS19MRVQsCisgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAm
dmFyKSkgJiYKICAgICAgICAgICAgICAgICAgICBleHByZXNzaW9uKGhlYWQtPnBuX3JpZ2h0LCAm
ZXhwcikgJiYKICAgICAgICAgICAgICAgICAgICBidWlsZGVyLmZvckluU3RhdGVtZW50KHZhciwg
ZXhwciwgc3RtdCwgaXNGb3JFYWNoLCAmcG4tPnBuX3BvcywgZHN0KTsKICAgICAgICAgfQogCiAg
ICAgICAgIFZhbHVlIGluaXQsIHRlc3QsIHVwZGF0ZTsKIAogICAgICAgICByZXR1cm4gZm9ySW5p
dChoZWFkLT5wbl9raWQxLCAmaW5pdCkgJiYKICAgICAgICAgICAgICAgIG9wdEV4cHJlc3Npb24o
aGVhZC0+cG5fa2lkMiwgJnRlc3QpICYmCmRpZmYgLS1naXQgYS9qcy9zcmMvanN0cmFjZXIuY3Bw
IGIvanMvc3JjL2pzdHJhY2VyLmNwcAotLS0gYS9qcy9zcmMvanN0cmFjZXIuY3BwCisrKyBiL2pz
L3NyYy9qc3RyYWNlci5jcHAKQEAgLTE0ODA3LDIwICsxNDgwNywyMCBAQCBUcmFjZVJlY29yZGVy
OjpyZWNvcmRfSlNPUF9NT1JFSVRFUigpCiAKICAgICBSRVRVUk5fSUZfWE1MX0EoaXRlcm9ial92
YWwpOwogCiAgICAgSlNPYmplY3QqIGl0ZXJvYmogPSAmaXRlcm9ial92YWwudG9PYmplY3QoKTsK
ICAgICBMSW5zKiBpdGVyb2JqX2lucyA9IGdldCgmaXRlcm9ial92YWwpOwogICAgIExJbnMqIGNv
bmRfaW5zOwogCiAgICAgLyoKLSAgICAgKiBKU09QX0ZPUiogYWxyZWFkeSBndWFyZHMgb24gdGhp
cywgYnV0IGluIGNlcnRhaW4gcmFyZSBjYXNlcyB3ZSBtaWdodAorICAgICAqIEpTT1BfSVRFUk5F
WFQgYWxyZWFkeSBndWFyZHMgb24gdGhpcywgYnV0IGluIGNlcnRhaW4gcmFyZSBjYXNlcyB3ZSBt
aWdodAogICAgICAqIHJlY29yZCBtaXNmb3JtZWQgbG9vcCB0cmFjZXMuIE5vdGUgdGhhdCBpdCdz
IG5vdCBuZWNlc3NhcnkgdG8gZ3VhcmQgb24KLSAgICAgKiBuaS0+ZmxhZ3MgKG5vciBkbyB3ZSBp
biB1bmJveE5leHRWYWx1ZSksIGJlY2F1c2UgdGhlIGRpZmZlcmVudAotICAgICAqIGl0ZXJhdGlv
biB0eXBlIHdpbGwgZ3VhcmFudGVlIGEgZGlmZmVyZW50IGVudHJ5IHR5cGVtYXAuCisgICAgICog
bmktPmZsYWdzIChub3IgZG8gd2UgaW4gdW5ib3hOZXh0VmFsdWUpLCBiZWNhdXNlIHRoZSBkaWZm
ZXJlbnQgaXRlcmF0aW9uCisgICAgICogdHlwZSB3aWxsIGd1YXJhbnRlZSBhIGRpZmZlcmVudCBl
bnRyeSB0eXBlbWFwLgogICAgICAqLwogICAgIGlmIChpdGVyb2JqLT5oYXNDbGFzcygmanNfSXRl
cmF0b3JDbGFzcykpIHsKICAgICAgICAgZ3VhcmRDbGFzcyhpdGVyb2JqX2lucywgJmpzX0l0ZXJh
dG9yQ2xhc3MsIHNuYXBzaG90KEJSQU5DSF9FWElUKSwgTE9BRF9OT1JNQUwpOwogCiAgICAgICAg
IE5hdGl2ZUl0ZXJhdG9yICpuaSA9IChOYXRpdmVJdGVyYXRvciAqKSBpdGVyb2JqLT5nZXRQcml2
YXRlKCk7CiAgICAgICAgIGlmIChuaS0+aXNLZXlJdGVyKCkpIHsKICAgICAgICAgICAgIExJbnMg
Km5pX2lucyA9IHcubGRwT2JqUHJpdmF0ZShpdGVyb2JqX2lucyk7CiAgICAgICAgICAgICBMSW5z
ICpjdXJzb3JfaW5zID0gdy5sZHBJdGVyQ3Vyc29yKG5pX2lucyk7CkBAIC0xNDg0NywxNiArMTQ4
NDcsMjYgQEAgVHJhY2VSZWNvcmRlcjo6cmVjb3JkX0pTT1BfTU9SRUlURVIoKQogCiAgICAgLy8g
V3JpdGUgdGhpcyB2YWx1ZSBiYWNrIGV2ZW4gdGhvdWdoIHdlIGhhdmVuJ3QgY2hhbmdlZCBpdC4K
ICAgICAvLyBTZWUgdGhlIGNvbW1lbnQgaW4gRGVlcEJhaWwgYWJvdXQgImNsb2JiZXJpbmcgZGVl
cCBiYWlscyIuCiAgICAgc3RhY2soLTEsIGl0ZXJvYmpfaW5zKTsKIAogICAgIHJldHVybiBBUkVD
T1JEX0NPTlRJTlVFOwogfQogCitKU19SRVFVSVJFU19TVEFDSyBBYm9ydGFibGVSZWNvcmRpbmdT
dGF0dXMKK1RyYWNlUmVjb3JkZXI6OnJlY29yZF9KU09QX0lURVJORVhUKCkKK3sKKyAgICBMSW5z
KiB2X2luczsKKyAgICBWYWx1ZSAmaXRlcm9ial92YWwgPSBzdGFja3ZhbCgtR0VUX0lOVDgoY3gt
PnJlZ3MtPnBjKSk7CisgICAgQ0hFQ0tfU1RBVFVTX0EodW5ib3hOZXh0VmFsdWUoaXRlcm9ial92
YWwsIHZfaW5zKSk7CisgICAgc3RhY2soMCwgdl9pbnMpOworICAgIHJldHVybiBBUkVDT1JEX0NP
TlRJTlVFOworfQorCiBzdGF0aWMgSlNCb29sIEZBU1RDQUxMCiBDbG9zZUl0ZXJhdG9yKEpTQ29u
dGV4dCAqY3gsIEpTT2JqZWN0ICppdGVyb2JqKQogewogICAgIFRyYWNlTW9uaXRvciAqdG0gPSBK
U19UUkFDRV9NT05JVE9SX09OX1RSQUNFKGN4KTsKIAogICAgIGlmICghanNfQ2xvc2VJdGVyYXRv
cihjeCwgaXRlcm9iaikpIHsKICAgICAgICAgU2V0QnVpbHRpbkVycm9yKHRtKTsKICAgICAgICAg
cmV0dXJuIGZhbHNlOwpAQCAtMTQ4OTYsMTkgKzE0OTA2LDE4IEBAIEpTX1JFUVVJUkVTX1NUQUNL
IHZvaWQKIFRyYWNlUmVjb3JkZXI6OnN0b3JlTWFnaWMoSlNXaHlNYWdpYyB3aHksIEFkZHJlc3Mg
YWRkcikKIHsKICAgICBMSW5zICptYWdpYyA9IHcubmFtZUltbXEoQlVJTERfSlNWQUwoSlNWQUxf
VEFHX01BR0lDLCB3aHkpKTsKICAgICB3LnN0cShtYWdpYywgYWRkcik7CiB9CiAjZW5kaWYKIAog
SlNfUkVRVUlSRVNfU1RBQ0sgQWJvcnRhYmxlUmVjb3JkaW5nU3RhdHVzCi1UcmFjZVJlY29yZGVy
Ojp1bmJveE5leHRWYWx1ZShMSW5zKiAmdl9pbnMpCi17Ci0gICAgVmFsdWUgJml0ZXJvYmpfdmFs
ID0gc3RhY2t2YWwoLTEpOworVHJhY2VSZWNvcmRlcjo6dW5ib3hOZXh0VmFsdWUoVmFsdWUgJml0
ZXJvYmpfdmFsLCBMSW5zKiAmdl9pbnMpCit7CiAgICAgSlNPYmplY3QgKml0ZXJvYmogPSAmaXRl
cm9ial92YWwudG9PYmplY3QoKTsKICAgICBMSW5zKiBpdGVyb2JqX2lucyA9IGdldCgmaXRlcm9i
al92YWwpOwogCiAgICAgaWYgKGl0ZXJvYmotPmhhc0NsYXNzKCZqc19JdGVyYXRvckNsYXNzKSkg
ewogICAgICAgICBndWFyZENsYXNzKGl0ZXJvYmpfaW5zLCAmanNfSXRlcmF0b3JDbGFzcywgc25h
cHNob3QoQlJBTkNIX0VYSVQpLCBMT0FEX05PUk1BTCk7CiAgICAgICAgIE5hdGl2ZUl0ZXJhdG9y
ICpuaSA9IChOYXRpdmVJdGVyYXRvciAqKSBpdGVyb2JqLT5nZXRQcml2YXRlKCk7CiAKICAgICAg
ICAgTElucyAqbmlfaW5zID0gdy5sZHBPYmpQcml2YXRlKGl0ZXJvYmpfaW5zKTsKQEAgLTE0OTU4
LDcwICsxNDk2NywxNiBAQCBUcmFjZVJlY29yZGVyOjp1bmJveE5leHRWYWx1ZShMSW5zKiAmdl9p
CiAgICAgQWRkcmVzcyBpdGVyVmFsdWVBZGRyID0gQ3hBZGRyZXNzKGl0ZXJWYWx1ZSk7CiAgICAg
dl9pbnMgPSB1bmJveF92YWx1ZShjeC0+aXRlclZhbHVlLCBpdGVyVmFsdWVBZGRyLCBzbmFwc2hv
dChCUkFOQ0hfRVhJVCkpOwogICAgIHN0b3JlTWFnaWMoSlNfTk9fSVRFUl9WQUxVRSwgaXRlclZh
bHVlQWRkcik7CiAKICAgICByZXR1cm4gQVJFQ09SRF9DT05USU5VRTsKIH0KIAogSlNfUkVRVUlS
RVNfU1RBQ0sgQWJvcnRhYmxlUmVjb3JkaW5nU3RhdHVzCi1UcmFjZVJlY29yZGVyOjpyZWNvcmRf
SlNPUF9GT1JOQU1FKCkKLXsKLSAgICBWYWx1ZSogdnA7Ci0gICAgTElucyogeF9pbnM7Ci0gICAg
TmFtZVJlc3VsdCBucjsKLSAgICBDSEVDS19TVEFUVVNfQShuYW1lKHZwLCB4X2lucywgbnIpKTsK
LSAgICBpZiAoIW5yLnRyYWNrZWQpCi0gICAgICAgIFJFVFVSTl9TVE9QX0EoImZvcm5hbWUgb24g
bm9uLXRyYWNrZWQgdmFsdWUgbm90IHN1cHBvcnRlZCIpOwotICAgIExJbnMqIHZfaW5zOwotICAg
IENIRUNLX1NUQVRVU19BKHVuYm94TmV4dFZhbHVlKHZfaW5zKSk7Ci0gICAgc2V0KHZwLCB2X2lu
cyk7Ci0gICAgcmV0dXJuIEFSRUNPUkRfQ09OVElOVUU7Ci19Ci0KLUpTX1JFUVVJUkVTX1NUQUNL
IEFib3J0YWJsZVJlY29yZGluZ1N0YXR1cwotVHJhY2VSZWNvcmRlcjo6cmVjb3JkX0pTT1BfRk9S
R05BTUUoKQotewotICAgIHJldHVybiByZWNvcmRfSlNPUF9GT1JOQU1FKCk7Ci19Ci0KLUpTX1JF
UVVJUkVTX1NUQUNLIEFib3J0YWJsZVJlY29yZGluZ1N0YXR1cwotVHJhY2VSZWNvcmRlcjo6cmVj
b3JkX0pTT1BfRk9SUFJPUCgpCi17Ci0gICAgcmV0dXJuIEFSRUNPUkRfU1RPUDsKLX0KLQotSlNf
UkVRVUlSRVNfU1RBQ0sgQWJvcnRhYmxlUmVjb3JkaW5nU3RhdHVzCi1UcmFjZVJlY29yZGVyOjpy
ZWNvcmRfSlNPUF9GT1JFTEVNKCkKLXsKLSAgICBMSW5zKiB2X2luczsKLSAgICBDSEVDS19TVEFU
VVNfQSh1bmJveE5leHRWYWx1ZSh2X2lucykpOwotICAgIHN0YWNrKDAsIHZfaW5zKTsKLSAgICBy
ZXR1cm4gQVJFQ09SRF9DT05USU5VRTsKLX0KLQotSlNfUkVRVUlSRVNfU1RBQ0sgQWJvcnRhYmxl
UmVjb3JkaW5nU3RhdHVzCi1UcmFjZVJlY29yZGVyOjpyZWNvcmRfSlNPUF9GT1JBUkcoKQotewot
ICAgIExJbnMqIHZfaW5zOwotICAgIENIRUNLX1NUQVRVU19BKHVuYm94TmV4dFZhbHVlKHZfaW5z
KSk7Ci0gICAgYXJnKEdFVF9BUkdOTyhjeC0+cmVncy0+cGMpLCB2X2lucyk7Ci0gICAgcmV0dXJu
IEFSRUNPUkRfQ09OVElOVUU7Ci19Ci0KLUpTX1JFUVVJUkVTX1NUQUNLIEFib3J0YWJsZVJlY29y
ZGluZ1N0YXR1cwotVHJhY2VSZWNvcmRlcjo6cmVjb3JkX0pTT1BfRk9STE9DQUwoKQotewotICAg
IExJbnMqIHZfaW5zOwotICAgIENIRUNLX1NUQVRVU19BKHVuYm94TmV4dFZhbHVlKHZfaW5zKSk7
Ci0gICAgdmFyKEdFVF9TTE9UTk8oY3gtPnJlZ3MtPnBjKSwgdl9pbnMpOwotICAgIHJldHVybiBB
UkVDT1JEX0NPTlRJTlVFOwotfQotCi1KU19SRVFVSVJFU19TVEFDSyBBYm9ydGFibGVSZWNvcmRp
bmdTdGF0dXMKIFRyYWNlUmVjb3JkZXI6OnJlY29yZF9KU09QX1BPUE4oKQogewogICAgIHJldHVy
biBBUkVDT1JEX0NPTlRJTlVFOwogfQogCiBzdGF0aWMgaW5saW5lIGJvb2wKIElzRmluZGFibGVD
YWxsT2JqKEpTT2JqZWN0ICpvYmopCiB7CkBAIC0xNjU1NCwxNiArMTY1MDksMjkgQEAgVHJhY2VS
ZWNvcmRlcjo6cmVjb3JkX0pTT1BfQ0FMTEdOQU1FKCkKICAgICB9CiAKIERCR19TVFVCKEpTT1Bf
R0VUVVBWQVJfREJHKQogREJHX1NUVUIoSlNPUF9DQUxMVVBWQVJfREJHKQogREJHX1NUVUIoSlNP
UF9ERUZGVU5fREJHRkMpCiBEQkdfU1RVQihKU09QX0RFRkxPQ0FMRlVOX0RCR0ZDKQogREJHX1NU
VUIoSlNPUF9MQU1CREFfREJHRkMpCiAKKyNkZWZpbmUgVU5VU0VEX1NUVUIoT1ApICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFwKKyAgICBKU19S
RVFVSVJFU19TVEFDSyBBYm9ydGFibGVSZWNvcmRpbmdTdGF0dXMgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgIFwKKyAgICBUcmFjZVJlY29yZGVyOjpyZWNvcmRfIyNPUCgpICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFwKKyAgICB7ICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgIFwKKyAgICAgICAgSlNfTk9UX1JFQUNIRUQoI09QKTsgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgIFwKKyAgICAgICAgcmV0dXJuIEFSRUNPUkRfRVJS
T1I7ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFwKKyAg
ICB9CisKK1VOVVNFRF9TVFVCKEpTT1BfVU5VU0VEMTEpCitVTlVTRURfU1RVQihKU09QX1VOVVNF
RDEwNikKK1VOVVNFRF9TVFVCKEpTT1BfVU5VU0VEMTA3KQorVU5VU0VEX1NUVUIoSlNPUF9VTlVT
RUQxMDgpCisKICNpZmRlZiBKU19KSVRfU1BFVwogLyoKICAqIFByaW50IGluZm9ybWF0aW9uIGFi
b3V0IGVudHJ5IHR5cGVtYXBzIGFuZCB1bnN0YWJsZSBleGl0cyBmb3IgYWxsIHBlZXJzCiAgKiBh
dCBhIFBDLgogICovCiB2b2lkCiBEdW1wUGVlclN0YWJpbGl0eShUcmFjZU1vbml0b3IqIHRtLCBj
b25zdCB2b2lkKiBpcCwgSlNPYmplY3QqIGdsb2JhbE9iaiwgdWludDMyIGdsb2JhbFNoYXBlLAog
ICAgICAgICAgICAgICAgICAgdWludDMyIGFyZ2MpCmRpZmYgLS1naXQgYS9qcy9zcmMvanN0cmFj
ZXIuaCBiL2pzL3NyYy9qc3RyYWNlci5oCi0tLSBhL2pzL3NyYy9qc3RyYWNlci5oCisrKyBiL2pz
L3NyYy9qc3RyYWNlci5oCkBAIC0xMzY4LDE3ICsxMzY4LDE4IEBAIGNsYXNzIFRyYWNlUmVjb3Jk
ZXIKICAgICBKU19SRVFVSVJFU19TVEFDSyBuYW5vaml0OjpMSW5zICpjYW5vbmljYWxpemVOYU5z
KG5hbm9qaXQ6OkxJbnMgKmR2YWxfaW5zKTsKICAgICBKU19SRVFVSVJFU19TVEFDSyBBYm9ydGFi
bGVSZWNvcmRpbmdTdGF0dXMgdHlwZWRBcnJheUVsZW1lbnQoVmFsdWUmIG92YWwsIFZhbHVlJiBp
ZHgsIFZhbHVlKiYgdnAsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgIG5hbm9qaXQ6OkxJbnMqJiB2X2lucyk7CiAgICAgSlNf
UkVRVUlSRVNfU1RBQ0sgQWJvcnRhYmxlUmVjb3JkaW5nU3RhdHVzIGdldFByb3AoSlNPYmplY3Qq
IG9iaiwgbmFub2ppdDo6TElucyogb2JqX2lucyk7CiAgICAgSlNfUkVRVUlSRVNfU1RBQ0sgQWJv
cnRhYmxlUmVjb3JkaW5nU3RhdHVzIGdldFByb3AoVmFsdWUmIHYpOwogICAgIEpTX1JFUVVJUkVT
X1NUQUNLIFJlY29yZGluZ1N0YXR1cyBnZXRUaGlzKG5hbm9qaXQ6OkxJbnMqJiB0aGlzX2lucyk7
CiAKICAgICBKU19SRVFVSVJFU19TVEFDSyB2b2lkIHN0b3JlTWFnaWMoSlNXaHlNYWdpYyB3aHks
IHRqaXQ6OkFkZHJlc3MgYWRkcik7Ci0gICAgSlNfUkVRVUlSRVNfU1RBQ0sgQWJvcnRhYmxlUmVj
b3JkaW5nU3RhdHVzIHVuYm94TmV4dFZhbHVlKG5hbm9qaXQ6OkxJbnMqICZ2X2lucyk7CisgICAg
SlNfUkVRVUlSRVNfU1RBQ0sgQWJvcnRhYmxlUmVjb3JkaW5nU3RhdHVzIHVuYm94TmV4dFZhbHVl
KFZhbHVlICZpdGVyb2JqX3ZhbCwKKyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgbmFub2ppdDo6TElucyogJnZfaW5zKTsKIAogICAg
IEpTX1JFUVVJUkVTX1NUQUNLIFZNU2lkZUV4aXQqIGVudGVyRGVlcEJhaWxDYWxsKCk7CiAgICAg
SlNfUkVRVUlSRVNfU1RBQ0sgdm9pZCBsZWF2ZURlZXBCYWlsQ2FsbCgpOwogCiAgICAgSlNfUkVR
VUlSRVNfU1RBQ0sgUmVjb3JkaW5nU3RhdHVzIHByaW1pdGl2ZVRvU3RyaW5nSW5QbGFjZShWYWx1
ZSogdnApOwogICAgIEpTX1JFUVVJUkVTX1NUQUNLIHZvaWQgZmluaXNoR2V0UHJvcChuYW5vaml0
OjpMSW5zKiBvYmpfaW5zLCBuYW5vaml0OjpMSW5zKiB2cF9pbnMsCiAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgIG5hbm9qaXQ6OkxJbnMqIG9rX2lucywgVmFsdWUqIG91
dHApOwogICAgIEpTX1JFUVVJUkVTX1NUQUNLIFJlY29yZGluZ1N0YXR1cyBnZXRQcm9wZXJ0eUJ5
TmFtZShuYW5vaml0OjpMSW5zKiBvYmpfaW5zLCBWYWx1ZSogaWR2YWxwLApkaWZmIC0tZ2l0IGEv
anMvc3JjL2pzeGRyYXBpLmggYi9qcy9zcmMvanN4ZHJhcGkuaAotLS0gYS9qcy9zcmMvanN4ZHJh
cGkuaAorKysgYi9qcy9zcmMvanN4ZHJhcGkuaApAQCAtMjI2LDE3ICsyMjYsMTcgQEAgSlNfWERS
RmluZENsYXNzQnlJZChKU1hEUlN0YXRlICp4ZHIsIHVpbgogICogQnl0ZWNvZGUgdmVyc2lvbiBu
dW1iZXIuIEluY3JlbWVudCB0aGUgc3VidHJhaGVuZCB3aGVuZXZlciBKUyBieXRlY29kZQogICog
Y2hhbmdlcyBpbmNvbXBhdGlibHkuCiAgKgogICogVGhpcyB2ZXJzaW9uIG51bWJlciBzaG91bGQg
YmUgWERSJ2VkIG9uY2UgbmVhciB0aGUgZnJvbnQgb2YgYW55IGZpbGUgb3IKICAqIGxhcmdlciBz
dG9yYWdlIHVuaXQgY29udGFpbmluZyBYRFInZWQgYnl0ZWNvZGUgYW5kIG90aGVyIGRhdGEsIGFu
ZCBjaGVja2VkCiAgKiBiZWZvcmUgZGVzZXJpYWxpemF0aW9uIG9mIGJ5dGVjb2RlLiAgSWYgdGhl
IHNhdmVkIHZlcnNpb24gZG9lcyBub3QgbWF0Y2gKICAqIHRoZSBjdXJyZW50IHZlcnNpb24sIGFi
b3J0IGRlc2VyaWFsaXphdGlvbiBhbmQgaW52YWxpZGF0ZSB0aGUgZmlsZS4KICAqLwotI2RlZmlu
ZSBKU1hEUl9CWVRFQ09ERV9WRVJTSU9OICAgICAgKDB4Yjk3M2MwZGUgLSA4NSkKKyNkZWZpbmUg
SlNYRFJfQllURUNPREVfVkVSU0lPTiAgICAgICgweGI5NzNjMGRlIC0gODYpCiAKIC8qCiAgKiBM
aWJyYXJ5LXByaXZhdGUgZnVuY3Rpb25zLgogICovCiBleHRlcm4gSlNCb29sCiBqc19YRFJBdG9t
KEpTWERSU3RhdGUgKnhkciwgSlNBdG9tICoqYXRvbXApOwogCiBKU19FTkRfRVhURVJOX0MKZGlm
ZiAtLWdpdCBhL2pzL3NyYy9tZXRob2RqaXQvQ29tcGlsZXIuY3BwIGIvanMvc3JjL21ldGhvZGpp
dC9Db21waWxlci5jcHAKLS0tIGEvanMvc3JjL21ldGhvZGppdC9Db21waWxlci5jcHAKKysrIGIv
anMvc3JjL21ldGhvZGppdC9Db21waWxlci5jcHAKQEAgLTEwMDksMjcgKzEwMDksMTkgQEAgbWpp
dDo6Q29tcGlsZXI6OmdlbmVyYXRlTWV0aG9kKCkKICAgICAgICAgICAgICAqLwogICAgICAgICAg
ICAgaWYgKGNhblVzZUFwcGx5VHJpY2tzKCkpCiAgICAgICAgICAgICAgICAgYXBwbHlUcmlja3Mg
PSBMYXp5QXJnc09iajsKICAgICAgICAgICAgIGVsc2UKICAgICAgICAgICAgICAgICBqc29wX2Fy
Z3VtZW50cygpOwogICAgICAgICAgICAgZnJhbWUucHVzaFN5bmNlZCgpOwogICAgICAgICAgIEVO
RF9DQVNFKEpTT1BfQVJHVU1FTlRTKQogCi0gICAgICAgICAgQkVHSU5fQ0FTRShKU09QX0ZPUkFS
RykKLSAgICAgICAgICAgIGl0ZXJOZXh0KCk7Ci0gICAgICAgICAgICBmcmFtZS5zdG9yZUFyZyhH
RVRfU0xPVE5PKFBDKSwgdHJ1ZSk7Ci0gICAgICAgICAgICBmcmFtZS5wb3AoKTsKLSAgICAgICAg
ICBFTkRfQ0FTRShKU09QX0ZPUkFSRykKLQotICAgICAgICAgIEJFR0lOX0NBU0UoSlNPUF9GT1JM
T0NBTCkKLSAgICAgICAgICAgIGl0ZXJOZXh0KCk7Ci0gICAgICAgICAgICBmcmFtZS5zdG9yZUxv
Y2FsKEdFVF9TTE9UTk8oUEMpLCB0cnVlKTsKLSAgICAgICAgICAgIGZyYW1lLnBvcCgpOwotICAg
ICAgICAgIEVORF9DQVNFKEpTT1BfRk9STE9DQUwpCisgICAgICAgICAgQkVHSU5fQ0FTRShKU09Q
X0lURVJORVhUKQorICAgICAgICAgICAgaXRlck5leHQoUENbMV0pOworICAgICAgICAgIEVORF9D
QVNFKEpTT1BfSVRFUk5FWFQpCiAKICAgICAgICAgICBCRUdJTl9DQVNFKEpTT1BfRFVQKQogICAg
ICAgICAgICAgZnJhbWUuZHVwKCk7CiAgICAgICAgICAgRU5EX0NBU0UoSlNPUF9EVVApCiAKICAg
ICAgICAgICBCRUdJTl9DQVNFKEpTT1BfRFVQMikKICAgICAgICAgICAgIGZyYW1lLmR1cDIoKTsK
ICAgICAgICAgICBFTkRfQ0FTRShKU09QX0RVUDIpCkBAIC0xNjQ1LDM0ICsxNjM3LDE2IEBAIG1q
aXQ6OkNvbXBpbGVyOjpnZW5lcmF0ZU1ldGhvZCgpCiAgICAgICAgICAgICBqc29wX2xvY2FsaW5j
KG9wLCBHRVRfU0xPVE5PKFBDKSwgcG9wcGVkKTsKICAgICAgICAgICAgIFBDICs9IEpTT1BfTE9D
QUxJTkNfTEVOR1RIOwogICAgICAgICAgICAgaWYgKHBvcHBlZCkKICAgICAgICAgICAgICAgICBQ
QyArPSBKU09QX1BPUF9MRU5HVEg7CiAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICB9CiAg
ICAgICAgICAgRU5EX0NBU0UoSlNPUF9MT0NBTERFQykKIAotICAgICAgICAgIEJFR0lOX0NBU0Uo
SlNPUF9GT1JOQU1FKQotICAgICAgICAgICAganNvcF9mb3JuYW1lKHNjcmlwdC0+Z2V0QXRvbShm
dWxsQXRvbUluZGV4KFBDKSkpOwotICAgICAgICAgIEVORF9DQVNFKEpTT1BfRk9STkFNRSkKLQot
ICAgICAgICAgIEJFR0lOX0NBU0UoSlNPUF9GT1JHTkFNRSkKLSAgICAgICAgICAgIGpzb3BfZm9y
Z25hbWUoc2NyaXB0LT5nZXRBdG9tKGZ1bGxBdG9tSW5kZXgoUEMpKSk7Ci0gICAgICAgICAgRU5E
X0NBU0UoSlNPUF9GT1JHTkFNRSkKLQotICAgICAgICAgIEJFR0lOX0NBU0UoSlNPUF9GT1JQUk9Q
KQotICAgICAgICAgICAganNvcF9mb3Jwcm9wKHNjcmlwdC0+Z2V0QXRvbShmdWxsQXRvbUluZGV4
KFBDKSkpOwotICAgICAgICAgIEVORF9DQVNFKEpTT1BfRk9SUFJPUCkKLQotICAgICAgICAgIEJF
R0lOX0NBU0UoSlNPUF9GT1JFTEVNKQotICAgICAgICAgICAgLy8gVGhpcyBvcGNvZGUgaXMgZm9y
IHRoZSBkZWNvbXBpbGVyOyBpdCBpcyBzdWNjZWVkZWQgYnkgYW4KLSAgICAgICAgICAgIC8vIEVO
VU1FTEVNLCB3aGljaCBwZXJmb3JtcyB0aGUgYWN0dWFsIGFycmF5IHN0b3JlLgotICAgICAgICAg
ICAgaXRlck5leHQoKTsKLSAgICAgICAgICBFTkRfQ0FTRShKU09QX0ZPUkVMRU0pCi0KICAgICAg
ICAgICBCRUdJTl9DQVNFKEpTT1BfQklORE5BTUUpCiAgICAgICAgICAgICBqc29wX2JpbmRuYW1l
KHNjcmlwdC0+Z2V0QXRvbShmdWxsQXRvbUluZGV4KFBDKSksIHRydWUpOwogICAgICAgICAgIEVO
RF9DQVNFKEpTT1BfQklORE5BTUUpCiAKICAgICAgICAgICBCRUdJTl9DQVNFKEpTT1BfU0VUUFJP
UCkKICAgICAgICAgICAgIGlmICghanNvcF9zZXRwcm9wKHNjcmlwdC0+Z2V0QXRvbShmdWxsQXRv
bUluZGV4KFBDKSksIHRydWUpKQogICAgICAgICAgICAgICAgIHJldHVybiBDb21waWxlX0Vycm9y
OwogICAgICAgICAgIEVORF9DQVNFKEpTT1BfU0VUUFJPUCkKQEAgLTQxMTAsMjMgKzQwODQsMjMg
QEAgbWppdDo6Q29tcGlsZXI6Oml0ZXIodWludE4gZmxhZ3MpCiAgICAgZnJhbWUucHVzaFR5cGVk
UGF5bG9hZChKU1ZBTF9UWVBFX09CSkVDVCwgaW9yZWcpOwogCiAgICAgc3R1YmNjLnJlam9pbihD
aGFuZ2VzKDEpKTsKIAogICAgIHJldHVybiB0cnVlOwogfQogCiAvKgotICogVGhpcyBiaWcgbmFz
dHkgZnVuY3Rpb24gZW1pdHMgYSBmYXN0LXBhdGggZm9yIG5hdGl2ZSBpdGVyYXRvcnMsIHByb2R1
Y2luZwotICogYSB0ZW1wb3JhcnkgdmFsdWUgb24gdGhlIHN0YWNrIGZvciBGT1JMT0NBTCxBUkcs
R0xPQkFMLGV0YyBvcHMgdG8gdXNlLgorICogVGhpcyBiaWcgbmFzdHkgZnVuY3Rpb24gaW1wbGVt
ZW50cyBKU09QX0lURVJORVhULCB3aGljaCBpcyB1c2VkIGluIHRoZSBoZWFkCisgKiBvZiBhIGZv
ci1pbiBsb29wIHRvIHB1dCB0aGUgbmV4dCB2YWx1ZSBvbiB0aGUgc3RhY2suCiAgKi8KIHZvaWQK
LW1qaXQ6OkNvbXBpbGVyOjppdGVyTmV4dCgpCittaml0OjpDb21waWxlcjo6aXRlck5leHQocHRy
ZGlmZl90IG9mZnNldCkKIHsKLSAgICBGcmFtZUVudHJ5ICpmZSA9IGZyYW1lLnBlZWsoLTEpOwor
ICAgIEZyYW1lRW50cnkgKmZlID0gZnJhbWUucGVlaygtb2Zmc2V0KTsKICAgICBSZWdpc3RlcklE
IHJlZyA9IGZyYW1lLnRlbXBSZWdGb3JEYXRhKGZlKTsKIAogICAgIC8qIElzIGl0IHdvcnRoIHRy
eWluZyB0byBwaW4gdGhpcyBsb25nZXI/IFByb2xseSBub3QuICovCiAgICAgZnJhbWUucGluUmVn
KHJlZyk7CiAgICAgUmVnaXN0ZXJJRCBUMSA9IGZyYW1lLmFsbG9jUmVnKCk7CiAgICAgZnJhbWUu
dW5waW5SZWcocmVnKTsKIAogICAgIC8qIFRlc3QgY2xhc3AgKi8KQEAgLTQxNjAsMTYgKzQxMzQs
MTcgQEAgbWppdDo6Q29tcGlsZXI6Oml0ZXJOZXh0KCkKICAgICBtYXNtLmFkZFB0cihJbW0zMihz
aXplb2YoanNpZCkpLCBUMiwgVDQpOwogICAgIG1hc20uc3RvcmVQdHIoVDQsIEFkZHJlc3MoVDEs
IG9mZnNldG9mKE5hdGl2ZUl0ZXJhdG9yLCBwcm9wc19jdXJzb3IpKSk7CiAKICAgICBmcmFtZS5m
cmVlUmVnKFQ0KTsKICAgICBmcmFtZS5mcmVlUmVnKFQxKTsKICAgICBmcmFtZS5mcmVlUmVnKFQy
KTsKIAogICAgIHN0dWJjYy5sZWF2ZSgpOworICAgIHN0dWJjYy5tYXNtLm1vdmUoSW1tMzIob2Zm
c2V0KSwgUmVnaXN0ZXJzOjpBcmdSZWcxKTsKICAgICBPT0xfU1RVQkNBTEwoc3R1YnM6Okl0ZXJO
ZXh0KTsKIAogICAgIGZyYW1lLnB1c2hVbnR5cGVkUGF5bG9hZChKU1ZBTF9UWVBFX1NUUklORywg
VDMpOwogCiAgICAgLyogSm9pbiB3aXRoIHRoZSBzdHViIGNhbGwuICovCiAgICAgc3R1YmNjLnJl
am9pbihDaGFuZ2VzKDEpKTsKIH0KIApAQCAtNDk5NCw3MCArNDk2OSw4IEBAIHZvaWQKIG1qaXQ6
OkNvbXBpbGVyOjpqc29wX2NhbGxlbGVtX3Nsb3coKQogewogICAgIHByZXBhcmVTdHViQ2FsbChV
c2VzKDIpKTsKICAgICBJTkxJTkVfU1RVQkNBTEwoc3R1YnM6OkNhbGxFbGVtKTsKICAgICBmcmFt
ZS5wb3BuKDIpOwogICAgIGZyYW1lLnB1c2hTeW5jZWQoKTsKICAgICBmcmFtZS5wdXNoU3luY2Vk
KCk7CiB9Ci0KLXZvaWQKLW1qaXQ6OkNvbXBpbGVyOjpqc29wX2ZvcnByb3AoSlNBdG9tICphdG9t
KQotewotICAgIC8vIEJlZm9yZTogSVRFUiBPQkoKLSAgICAvLyBBZnRlcjogIElURVIgT0JKIElU
RVIKLSAgICBmcmFtZS5kdXBBdCgtMik7Ci0KLSAgICAvLyBCZWZvcmU6IElURVIgT0JKIElURVIg
Ci0gICAgLy8gQWZ0ZXI6ICBJVEVSIE9CSiBJVEVSIFZBTFVFCi0gICAgaXRlck5leHQoKTsKLQot
ICAgIC8vIEJlZm9yZTogSVRFUiBPQkogSVRFUiBWQUxVRQotICAgIC8vIEFmdGVyOiAgSVRFUiBP
QkogVkFMVUUKLSAgICBmcmFtZS5zaGltbXkoMSk7Ci0KLSAgICAvLyBCZWZvcmU6IElURVIgT0JK
IFZBTFVFCi0gICAgLy8gQWZ0ZXI6ICBJVEVSIFZBTFVFCi0gICAganNvcF9zZXRwcm9wKGF0b20s
IGZhbHNlKTsKLQotICAgIC8vIEJlZm9yZTogSVRFUiBWQUxVRQotICAgIC8vIEFmdGVyOiAgSVRF
UgotICAgIGZyYW1lLnBvcCgpOwotfQotCi12b2lkCi1taml0OjpDb21waWxlcjo6anNvcF9mb3Ju
YW1lKEpTQXRvbSAqYXRvbSkKLXsKLSAgICAvLyBCZWZvcmU6IElURVIKLSAgICAvLyBBZnRlcjog
IElURVIgU0NPUEVPQkoKLSAgICBqc29wX2JpbmRuYW1lKGF0b20sIGZhbHNlKTsKLSAgICBqc29w
X2ZvcnByb3AoYXRvbSk7Ci19Ci0KLXZvaWQKLW1qaXQ6OkNvbXBpbGVyOjpqc29wX2ZvcmduYW1l
KEpTQXRvbSAqYXRvbSkKLXsKLSAgICAvLyBCZWZvcmU6IElURVIKLSAgICAvLyBBZnRlcjogIElU
RVIgR0xPQkFMCi0gICAganNvcF9iaW5kZ25hbWUoKTsKLQotICAgIC8vIEJlZm9yZTogSVRFUiBH
TE9CQUwKLSAgICAvLyBBZnRlcjogIElURVIgR0xPQkFMIElURVIKLSAgICBmcmFtZS5kdXBBdCgt
Mik7Ci0KLSAgICAvLyBCZWZvcmU6IElURVIgR0xPQkFMIElURVIgCi0gICAgLy8gQWZ0ZXI6ICBJ
VEVSIEdMT0JBTCBJVEVSIFZBTFVFCi0gICAgaXRlck5leHQoKTsKLQotICAgIC8vIEJlZm9yZTog
SVRFUiBHTE9CQUwgSVRFUiBWQUxVRQotICAgIC8vIEFmdGVyOiAgSVRFUiBHTE9CQUwgVkFMVUUK
LSAgICBmcmFtZS5zaGltbXkoMSk7Ci0KLSAgICAvLyBCZWZvcmU6IElURVIgR0xPQkFMIFZBTFVF
Ci0gICAgLy8gQWZ0ZXI6ICBJVEVSIFZBTFVFCi0gICAganNvcF9zZXRnbmFtZShhdG9tLCBmYWxz
ZSk7Ci0KLSAgICAvLyBCZWZvcmU6IElURVIgVkFMVUUKLSAgICAvLyBBZnRlcjogIElURVIKLSAg
ICBmcmFtZS5wb3AoKTsKLX0KLQpkaWZmIC0tZ2l0IGEvanMvc3JjL21ldGhvZGppdC9Db21waWxl
ci5oIGIvanMvc3JjL21ldGhvZGppdC9Db21waWxlci5oCi0tLSBhL2pzL3NyYy9tZXRob2RqaXQv
Q29tcGlsZXIuaAorKysgYi9qcy9zcmMvbWV0aG9kaml0L0NvbXBpbGVyLmgKQEAgLTQwMCwxNyAr
NDAwLDE3IEBAIGNsYXNzIENvbXBpbGVyIDogcHVibGljIEJhc2VDb21waWxlcgogICAgIGJvb2wg
anVtcEluU2NyaXB0KEp1bXAgaiwganNieXRlY29kZSAqcGMpOwogICAgIGJvb2wgY29tcGFyZVR3
b1ZhbHVlcyhKU0NvbnRleHQgKmN4LCBKU09wIG9wLCBjb25zdCBWYWx1ZSAmbGhzLCBjb25zdCBW
YWx1ZSAmcmhzKTsKICAgICBib29sIGNhblVzZUFwcGx5VHJpY2tzKCk7CiAKICAgICAvKiBFbWl0
dGluZyBoZWxwZXJzLiAqLwogICAgIHZvaWQgcmVzdG9yZUZyYW1lUmVncyhBc3NlbWJsZXIgJm1h
c20pOwogICAgIGJvb2wgZW1pdFN0dWJDbXBPcChCb29sU3R1YiBzdHViLCBqc2J5dGVjb2RlICp0
YXJnZXQsIEpTT3AgZnVzZWQpOwogICAgIGJvb2wgaXRlcih1aW50TiBmbGFncyk7Ci0gICAgdm9p
ZCBpdGVyTmV4dCgpOworICAgIHZvaWQgaXRlck5leHQocHRyZGlmZl90IG9mZnNldCk7CiAgICAg
Ym9vbCBpdGVyTW9yZSgpOwogICAgIHZvaWQgaXRlckVuZCgpOwogICAgIE1heWJlSnVtcCBsb2Fk
RG91YmxlKEZyYW1lRW50cnkgKmZlLCBGUFJlZ2lzdGVySUQgZnBSZWcpOwogI2lmZGVmIEpTX1BP
TFlJQwogICAgIHZvaWQgcGFzc0lDQWRkcmVzcyhCYXNlSUNJbmZvICppYyk7CiAjZW5kaWYKICNp
ZmRlZiBKU19NT05PSUMKICAgICB2b2lkIHBhc3NNSUNBZGRyZXNzKEdsb2JhbE5hbWVJQ0luZm8g
Jm1pYyk7CkBAIC00NjYsMTkgKzQ2NiwxNiBAQCBjbGFzcyBDb21waWxlciA6IHB1YmxpYyBCYXNl
Q29tcGlsZXIKICAgICBib29sIGpzb3BfaW5zdGFuY2VvZigpOwogICAgIHZvaWQganNvcF9uYW1l
KEpTQXRvbSAqYXRvbSk7CiAgICAgYm9vbCBqc29wX3huYW1lKEpTQXRvbSAqYXRvbSk7CiAgICAg
dm9pZCBlbnRlckJsb2NrKEpTT2JqZWN0ICpvYmopOwogICAgIHZvaWQgbGVhdmVCbG9jaygpOwog
ICAgIHZvaWQgZW1pdEV2YWwodWludDMyIGFyZ2MpOwogICAgIHZvaWQganNvcF9hcmd1bWVudHMo
KTsKICAgICBib29sIGpzb3BfdGFibGVzd2l0Y2goanNieXRlY29kZSAqcGMpOwotICAgIHZvaWQg
anNvcF9mb3Jwcm9wKEpTQXRvbSAqYXRvbSk7Ci0gICAgdm9pZCBqc29wX2Zvcm5hbWUoSlNBdG9t
ICphdG9tKTsKLSAgICB2b2lkIGpzb3BfZm9yZ25hbWUoSlNBdG9tICphdG9tKTsKIAogICAgIC8q
IEZhc3QgYXJpdGhtZXRpYy4gKi8KICAgICB2b2lkIGpzb3BfYmluYXJ5KEpTT3Agb3AsIFZvaWRT
dHViIHN0dWIpOwogICAgIHZvaWQganNvcF9iaW5hcnlfZnVsbChGcmFtZUVudHJ5ICpsaHMsIEZy
YW1lRW50cnkgKnJocywgSlNPcCBvcCwgVm9pZFN0dWIgc3R1Yik7CiAgICAgdm9pZCBqc29wX2Jp
bmFyeV9mdWxsX3NpbXBsZShGcmFtZUVudHJ5ICpmZSwgSlNPcCBvcCwgVm9pZFN0dWIgc3R1Yik7
CiAgICAgdm9pZCBqc29wX2JpbmFyeV9kb3VibGUoRnJhbWVFbnRyeSAqbGhzLCBGcmFtZUVudHJ5
ICpyaHMsIEpTT3Agb3AsIFZvaWRTdHViIHN0dWIpOwogICAgIHZvaWQgc2xvd0xvYWRDb25zdGFu
dERvdWJsZShBc3NlbWJsZXIgJm1hc20sIEZyYW1lRW50cnkgKmZlLAogICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICBGUFJlZ2lzdGVySUQgZnByZWcpOwpkaWZmIC0tZ2l0IGEvanMvc3Jj
L21ldGhvZGppdC9TdHViQ2FsbHMuY3BwIGIvanMvc3JjL21ldGhvZGppdC9TdHViQ2FsbHMuY3Bw
Ci0tLSBhL2pzL3NyYy9tZXRob2RqaXQvU3R1YkNhbGxzLmNwcAorKysgYi9qcy9zcmMvbWV0aG9k
aml0L1N0dWJDYWxscy5jcHAKQEAgLTIxMTYsMjIgKzIxMTYsMjIgQEAgc3R1YnM6OkluaXRQcm9w
KFZNRnJhbWUgJmYsIEpTQXRvbSAqYXRvbQogCiB2b2lkIEpTX0ZBU1RDQUxMCiBzdHViczo6SW5p
dE1ldGhvZChWTUZyYW1lICZmLCBKU0F0b20gKmF0b20pCiB7CiAgICAgSW5pdFByb3BPck1ldGhv
ZChmLCBhdG9tLCBKU09QX0lOSVRNRVRIT0QpOwogfQogCiB2b2lkIEpTX0ZBU1RDQUxMCi1zdHVi
czo6SXRlck5leHQoVk1GcmFtZSAmZikKK3N0dWJzOjpJdGVyTmV4dChWTUZyYW1lICZmLCB1aW50
MzIgb2Zmc2V0KQogewotICAgIEpTX0FTU0VSVChmLnJlZ3Muc3AgLSAxID49IGYuZnAoKS0+YmFz
ZSgpKTsKLSAgICBKU19BU1NFUlQoZi5yZWdzLnNwWy0xXS5pc09iamVjdCgpKTsKKyAgICBKU19B
U1NFUlQoZi5yZWdzLnNwIC0gb2Zmc2V0ID49IGYuZnAoKS0+YmFzZSgpKTsKKyAgICBKU19BU1NF
UlQoZi5yZWdzLnNwWy1vZmZzZXRdLmlzT2JqZWN0KCkpOwogCi0gICAgSlNPYmplY3QgKml0ZXJv
YmogPSAmZi5yZWdzLnNwWy0xXS50b09iamVjdCgpOworICAgIEpTT2JqZWN0ICppdGVyb2JqID0g
JmYucmVncy5zcFstb2Zmc2V0XS50b09iamVjdCgpOwogICAgIGYucmVncy5zcFswXS5zZXROdWxs
KCk7CiAgICAgZi5yZWdzLnNwKys7CiAgICAgaWYgKCFqc19JdGVyYXRvck5leHQoZi5jeCwgaXRl
cm9iaiwgJmYucmVncy5zcFstMV0pKQogICAgICAgICBUSFJPVygpOwogfQogCiBKU0Jvb2wgSlNf
RkFTVENBTEwKIHN0dWJzOjpJdGVyTW9yZShWTUZyYW1lICZmKQpkaWZmIC0tZ2l0IGEvanMvc3Jj
L21ldGhvZGppdC9TdHViQ2FsbHMuaCBiL2pzL3NyYy9tZXRob2RqaXQvU3R1YkNhbGxzLmgKLS0t
IGEvanMvc3JjL21ldGhvZGppdC9TdHViQ2FsbHMuaAorKysgYi9qcy9zcmMvbWV0aG9kaml0L1N0
dWJDYWxscy5oCkBAIC0xOTksMTcgKzE5OSwxNyBAQCB2b2lkIEpTX0ZBU1RDQUxMIERpdihWTUZy
YW1lICZmKTsKIHZvaWQgSlNfRkFTVENBTEwgTW9kKFZNRnJhbWUgJmYpOwogdm9pZCBKU19GQVNU
Q0FMTCBOZWcoVk1GcmFtZSAmZik7CiB2b2lkIEpTX0ZBU1RDQUxMIFBvcyhWTUZyYW1lICZmKTsK
IHZvaWQgSlNfRkFTVENBTEwgTm90KFZNRnJhbWUgJmYpOwogdm9pZCBKU19GQVNUQ0FMTCBTdHJp
Y3RFcShWTUZyYW1lICZmKTsKIHZvaWQgSlNfRkFTVENBTEwgU3RyaWN0TmUoVk1GcmFtZSAmZik7
CiAKIHZvaWQgSlNfRkFTVENBTEwgSXRlcihWTUZyYW1lICZmLCB1aW50MzIgZmxhZ3MpOwotdm9p
ZCBKU19GQVNUQ0FMTCBJdGVyTmV4dChWTUZyYW1lICZmKTsKK3ZvaWQgSlNfRkFTVENBTEwgSXRl
ck5leHQoVk1GcmFtZSAmZiwgdWludDMyIG9mZnNldCk7CiBKU0Jvb2wgSlNfRkFTVENBTEwgSXRl
ck1vcmUoVk1GcmFtZSAmZik7CiB2b2lkIEpTX0ZBU1RDQUxMIEVuZEl0ZXIoVk1GcmFtZSAmZik7
CiAKIEpTQm9vbCBKU19GQVNUQ0FMTCBWYWx1ZVRvQm9vbGVhbihWTUZyYW1lICZmKTsKIEpTU3Ry
aW5nICogSlNfRkFTVENBTEwgVHlwZU9mKFZNRnJhbWUgJmYpOwogSlNCb29sIEpTX0ZBU1RDQUxM
IEluc3RhbmNlT2YoVk1GcmFtZSAmZik7CiB2b2lkIEpTX0ZBU1RDQUxMIEZhc3RJbnN0YW5jZU9m
KFZNRnJhbWUgJmYpOwogdm9pZCBKU19GQVNUQ0FMTCBBcmdDbnQoVk1GcmFtZSAmZik7
</data>

          </attachment>
          <attachment
              isobsolete="0"
              ispatch="1"
              isprivate="0"
              isurl="0"
          >
            <attachid>524999</attachid>
            <date>2011-04-10 15:57:00 -0700</date>
            <delta_ts>2011-04-10 15:57:27 -0700</delta_ts>
            <desc>WIP 4 - failing 6 tests</desc>
            <filename>bug-648175-rm-jsop-for-take-2-v4.patch</filename>
            <type>text/plain</type>
            <size>94255</size>
            <attacher>jorendorff</attacher>
            
              <data encoding="base64">ZGlmZiAtLWdpdCBhL2pzL3NyYy9qc2FuYWx5emUuY3BwIGIvanMvc3JjL2pzYW5hbHl6ZS5jcHAK
LS0tIGEvanMvc3JjL2pzYW5hbHl6ZS5jcHAKKysrIGIvanMvc3JjL2pzYW5hbHl6ZS5jcHAKQEAg
LTQ1MiwxNyArNDUyLDE2IEBAIFNjcmlwdDo6YW5hbHl6ZShKU0NvbnRleHQgKmN4LCBKU1Njcmlw
dCAKICAgICAgICAgICBjYXNlIEpTT1BfQ0FMTE5BTUU6CiAgICAgICAgICAgY2FzZSBKU09QX0JJ
TkROQU1FOgogICAgICAgICAgIGNhc2UgSlNPUF9TRVROQU1FOgogICAgICAgICAgIGNhc2UgSlNP
UF9ERUxOQU1FOgogICAgICAgICAgIGNhc2UgSlNPUF9JTkNOQU1FOgogICAgICAgICAgIGNhc2Ug
SlNPUF9ERUNOQU1FOgogICAgICAgICAgIGNhc2UgSlNPUF9OQU1FSU5DOgogICAgICAgICAgIGNh
c2UgSlNPUF9OQU1FREVDOgotICAgICAgICAgIGNhc2UgSlNPUF9GT1JOQU1FOgogICAgICAgICAg
ICAgdXNlc1Njb3BlID0gdHJ1ZTsKICAgICAgICAgICAgIGJyZWFrOwogCiAgICAgICAgICAgLyog
V2F0Y2ggZm9yIG9wY29kZXMgdGhlIG1ldGhvZCBKSVQgZG9lc24ndCBjb21waWxlLiAqLwogICAg
ICAgICAgIGNhc2UgSlNPUF9HT1NVQjoKICAgICAgICAgICBjYXNlIEpTT1BfR09TVUJYOgogICAg
ICAgICAgIGNhc2UgSlNPUF9JRlBSSU1UT1A6CiAgICAgICAgICAgY2FzZSBKU09QX0ZJTFRFUjoK
QEAgLTU3NCwxOCArNTczLDE3IEBAIFNjcmlwdDo6YW5hbHl6ZShKU0NvbnRleHQgKmN4LCBKU1Nj
cmlwdCAKICAgICAgICAgICBjYXNlIEpTT1BfTE9DQUxJTkM6CiAgICAgICAgICAgY2FzZSBKU09Q
X0xPQ0FMREVDOiB7CiAgICAgICAgICAgICB1aW50MzIgbG9jYWwgPSBHRVRfU0xPVE5PKHBjKTsK
ICAgICAgICAgICAgIGlmIChsb2NhbCA8IG5maXhlZCAmJiAhbG9jYWxEZWZpbmVkKGxvY2FsLCBv
ZmZzZXQpKQogICAgICAgICAgICAgICAgIHNldExvY2FsKGxvY2FsLCBMT0NBTF9VU0VfQkVGT1JF
X0RFRik7CiAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICB9CiAKLSAgICAgICAgICBjYXNl
IEpTT1BfU0VUTE9DQUw6Ci0gICAgICAgICAgY2FzZSBKU09QX0ZPUkxPQ0FMOiB7CisgICAgICAg
ICAgY2FzZSBKU09QX1NFVExPQ0FMOiB7CiAgICAgICAgICAgICB1aW50MzIgbG9jYWwgPSBHRVRf
U0xPVE5PKHBjKTsKIAogICAgICAgICAgICAgLyoKICAgICAgICAgICAgICAqIFRoZSBsb2NhbCB2
YXJpYWJsZSBtYXkgYWxyZWFkeSBoYXZlIGJlZW4gbWFya2VkIGFzIHVuY29uZGl0aW9uYWxseQog
ICAgICAgICAgICAgICogZGVmaW5lZCBhdCBhIGxhdGVyIHBvaW50IGluIHRoZSBzY3JpcHQsIGlm
IHRoYXQgZGVmaW5pdGlvbiB3YXMgaW4gdGhlCiAgICAgICAgICAgICAgKiBjb25kaXRpb24gZm9y
IGEgbG9vcCB3aGljaCB0aGVuIGp1bXBlZCBiYWNrIGhlcmUuICBJbiBzdWNoIGNhc2VzIHdlCiAg
ICAgICAgICAgICAgKiB3aWxsIG5vdCB0cmVhdCB0aGUgdmFyaWFibGUgYXMgZXZlciBiZWluZyBk
ZWZpbmVkIGluIHRoZSBsb29wIGJvZHkKICAgICAgICAgICAgICAqIChzZWUgc2V0TG9jYWwpLgpk
aWZmIC0tZ2l0IGEvanMvc3JjL2pzY250eHQuaCBiL2pzL3NyYy9qc2NudHh0LmgKLS0tIGEvanMv
c3JjL2pzY250eHQuaAorKysgYi9qcy9zcmMvanNjbnR4dC5oCkBAIC0xOTM4LDE3ICsxOTM4LDE3
IEBAIHN0cnVjdCBKU0NvbnRleHQKICAgICBKU1NlY3VyaXR5Q2FsbGJhY2tzICpzZWN1cml0eUNh
bGxiYWNrczsKIAogICAgIC8qIFN0b3JlZCBoZXJlIHRvIGF2b2lkIHBhc3NpbmcgaXQgYXJvdW5k
IGFzIGEgcGFyYW1ldGVyLiAqLwogICAgIHVpbnROICAgICAgICAgICAgICAgcmVzb2x2ZUZsYWdz
OwogCiAgICAgLyogUmFuZG9tIG51bWJlciBnZW5lcmF0b3Igc3RhdGUsIHVzZWQgYnkganNtYXRo
LmNwcC4gKi8KICAgICBpbnQ2NCAgICAgICAgICAgICAgIHJuZ1NlZWQ7CiAKLSAgICAvKiBMb2Nh
dGlvbiB0byBzdGFzaCB0aGUgaXRlcmF0aW9uIHZhbHVlIGJldHdlZW4gSlNPUF9NT1JFSVRFUiBh
bmQgSlNPUF9GT1IqLiAqLworICAgIC8qIExvY2F0aW9uIHRvIHN0YXNoIHRoZSBpdGVyYXRpb24g
dmFsdWUgYmV0d2VlbiBKU09QX01PUkVJVEVSIGFuZCBKU09QX0lURVJORVhULiAqLwogICAgIGpz
OjpWYWx1ZSAgICAgICAgICAgaXRlclZhbHVlOwogCiAjaWZkZWYgSlNfVFJBQ0VSCiAgICAgLyoK
ICAgICAgKiBUcnVlIGlmIHRyYWNlcyBtYXkgYmUgZXhlY3V0ZWQuIEludmFyaWFudDogVGhlIHZh
bHVlIG9mIHRyYWNlSml0ZW5hYmxlZAogICAgICAqIGlzIGFsd2F5cyBlcXVhbCB0byB0aGUgZXhw
cmVzc2lvbiBpbiB1cGRhdGVKSVRFbmFibGVkIGJlbG93LgogICAgICAqCiAgICAgICogVGhpcyBm
bGFnIGFuZCB0aGUgZmllbGRzIGFjY2Vzc2VkIGJ5IHVwZGF0ZUpJVEVuYWJsZWQgYXJlIHdyaXR0
ZW4gb25seQpkaWZmIC0tZ2l0IGEvanMvc3JjL2pzZW1pdC5jcHAgYi9qcy9zcmMvanNlbWl0LmNw
cAotLS0gYS9qcy9zcmMvanNlbWl0LmNwcAorKysgYi9qcy9zcmMvanNlbWl0LmNwcApAQCAtMjAx
NCwxNyArMjAxNCwxNiBAQCBUcnlDb252ZXJ0VG9HbmFtZShKU0NvZGVHZW5lcmF0b3IgKmNnLCBK
CiAgICAgICAgICEoY2ctPmZsYWdzICYgVENGX1NUUklDVF9NT0RFX0NPREUpKSB7IAogICAgICAg
ICBzd2l0Y2ggKCpvcCkgewogICAgICAgICAgIGNhc2UgSlNPUF9OQU1FOiAgICAgKm9wID0gSlNP
UF9HRVRHTkFNRTsgYnJlYWs7CiAgICAgICAgICAgY2FzZSBKU09QX1NFVE5BTUU6ICAqb3AgPSBK
U09QX1NFVEdOQU1FOyBicmVhazsKICAgICAgICAgICBjYXNlIEpTT1BfSU5DTkFNRTogICpvcCA9
IEpTT1BfSU5DR05BTUU7IGJyZWFrOwogICAgICAgICAgIGNhc2UgSlNPUF9OQU1FSU5DOiAgKm9w
ID0gSlNPUF9HTkFNRUlOQzsgYnJlYWs7CiAgICAgICAgICAgY2FzZSBKU09QX0RFQ05BTUU6ICAq
b3AgPSBKU09QX0RFQ0dOQU1FOyBicmVhazsKICAgICAgICAgICBjYXNlIEpTT1BfTkFNRURFQzog
ICpvcCA9IEpTT1BfR05BTUVERUM7IGJyZWFrOwotICAgICAgICAgIGNhc2UgSlNPUF9GT1JOQU1F
OiAgKm9wID0gSlNPUF9GT1JHTkFNRTsgYnJlYWs7CiAgICAgICAgICAgY2FzZSBKU09QX1NFVENP
TlNUOgogICAgICAgICAgIGNhc2UgSlNPUF9ERUxOQU1FOgogICAgICAgICAgICAgLyogTm90IHN1
cHBvcnRlZC4gKi8KICAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICAgICBkZWZhdWx0
OiBKU19OT1RfUkVBQ0hFRCgiZ25hbWUiKTsKICAgICAgICAgfQogICAgICAgICByZXR1cm4gdHJ1
ZTsKICAgICB9CkBAIC0yMzQzLDMwICsyMzQyLDI4IEBAIEJpbmROYW1lVG9TbG90KEpTQ29udGV4
dCAqY3gsIEpTQ29kZUdlbmUKICAgICAgIGNhc2UgSlNEZWZpbml0aW9uOjpMRVQ6CiAgICAgICAg
IHN3aXRjaCAob3ApIHsKICAgICAgICAgICBjYXNlIEpTT1BfTkFNRTogICAgIG9wID0gSlNPUF9H
RVRMT0NBTDsgYnJlYWs7CiAgICAgICAgICAgY2FzZSBKU09QX1NFVE5BTUU6ICBvcCA9IEpTT1Bf
U0VUTE9DQUw7IGJyZWFrOwogICAgICAgICAgIGNhc2UgSlNPUF9JTkNOQU1FOiAgb3AgPSBKU09Q
X0lOQ0xPQ0FMOyBicmVhazsKICAgICAgICAgICBjYXNlIEpTT1BfTkFNRUlOQzogIG9wID0gSlNP
UF9MT0NBTElOQzsgYnJlYWs7CiAgICAgICAgICAgY2FzZSBKU09QX0RFQ05BTUU6ICBvcCA9IEpT
T1BfREVDTE9DQUw7IGJyZWFrOwogICAgICAgICAgIGNhc2UgSlNPUF9OQU1FREVDOiAgb3AgPSBK
U09QX0xPQ0FMREVDOyBicmVhazsKLSAgICAgICAgICBjYXNlIEpTT1BfRk9STkFNRTogIG9wID0g
SlNPUF9GT1JMT0NBTDsgYnJlYWs7CiAgICAgICAgICAgZGVmYXVsdDogSlNfTk9UX1JFQUNIRUQo
ImxldCIpOwogICAgICAgICB9CiAgICAgICAgIGJyZWFrOwogCiAgICAgICBjYXNlIEpTRGVmaW5p
dGlvbjo6QVJHOgogICAgICAgICBzd2l0Y2ggKG9wKSB7CiAgICAgICAgICAgY2FzZSBKU09QX05B
TUU6ICAgICBvcCA9IEpTT1BfR0VUQVJHOyBicmVhazsKICAgICAgICAgICBjYXNlIEpTT1BfU0VU
TkFNRTogIG9wID0gSlNPUF9TRVRBUkc7IGJyZWFrOwogICAgICAgICAgIGNhc2UgSlNPUF9JTkNO
QU1FOiAgb3AgPSBKU09QX0lOQ0FSRzsgYnJlYWs7CiAgICAgICAgICAgY2FzZSBKU09QX05BTUVJ
TkM6ICBvcCA9IEpTT1BfQVJHSU5DOyBicmVhazsKICAgICAgICAgICBjYXNlIEpTT1BfREVDTkFN
RTogIG9wID0gSlNPUF9ERUNBUkc7IGJyZWFrOwogICAgICAgICAgIGNhc2UgSlNPUF9OQU1FREVD
OiAgb3AgPSBKU09QX0FSR0RFQzsgYnJlYWs7Ci0gICAgICAgICAgY2FzZSBKU09QX0ZPUk5BTUU6
ICBvcCA9IEpTT1BfRk9SQVJHOyBicmVhazsKICAgICAgICAgICBkZWZhdWx0OiBKU19OT1RfUkVB
Q0hFRCgiYXJnIik7CiAgICAgICAgIH0KICAgICAgICAgSlNfQVNTRVJUKCFwbi0+aXNDb25zdCgp
KTsKICAgICAgICAgYnJlYWs7CiAKICAgICAgIGNhc2UgSlNEZWZpbml0aW9uOjpWQVI6CiAgICAg
ICAgIGlmIChQTl9PUChkbikgPT0gSlNPUF9DQUxMRUUpIHsKICAgICAgICAgICAgIEpTX0FTU0VS
VChvcCAhPSBKU09QX0NBTExFRSk7CkBAIC0yNDE1LDE3ICsyNDEyLDE2IEBAIEJpbmROYW1lVG9T
bG90KEpTQ29udGV4dCAqY3gsIEpTQ29kZUdlbmUKICAgICAgICAgc3dpdGNoIChvcCkgewogICAg
ICAgICAgIGNhc2UgSlNPUF9OQU1FOiAgICAgb3AgPSBKU09QX0dFVExPQ0FMOyBicmVhazsKICAg
ICAgICAgICBjYXNlIEpTT1BfU0VUTkFNRTogIG9wID0gSlNPUF9TRVRMT0NBTDsgYnJlYWs7CiAg
ICAgICAgICAgY2FzZSBKU09QX1NFVENPTlNUOiBvcCA9IEpTT1BfU0VUTE9DQUw7IGJyZWFrOwog
ICAgICAgICAgIGNhc2UgSlNPUF9JTkNOQU1FOiAgb3AgPSBKU09QX0lOQ0xPQ0FMOyBicmVhazsK
ICAgICAgICAgICBjYXNlIEpTT1BfTkFNRUlOQzogIG9wID0gSlNPUF9MT0NBTElOQzsgYnJlYWs7
CiAgICAgICAgICAgY2FzZSBKU09QX0RFQ05BTUU6ICBvcCA9IEpTT1BfREVDTE9DQUw7IGJyZWFr
OwogICAgICAgICAgIGNhc2UgSlNPUF9OQU1FREVDOiAgb3AgPSBKU09QX0xPQ0FMREVDOyBicmVh
azsKLSAgICAgICAgICBjYXNlIEpTT1BfRk9STkFNRTogIG9wID0gSlNPUF9GT1JMT0NBTDsgYnJl
YWs7CiAgICAgICAgICAgZGVmYXVsdDogSlNfTk9UX1JFQUNIRUQoImxvY2FsIik7CiAgICAgICAg
IH0KICAgICAgICAgSlNfQVNTRVJUX0lGKGRuX2tpbmQgPT0gSlNEZWZpbml0aW9uOjpDT05TVCwg
cG4tPnBuX2RmbGFncyAmIFBORF9DT05TVCk7CiAgICAgICAgIGJyZWFrOwogICAgIH0KIAogICAg
IEpTX0FTU0VSVChvcCAhPSBQTl9PUChwbikpOwogICAgIHBuLT5wbl9vcCA9IG9wOwpAQCAtNDM1
NywxNiArNDM1MywyMjAgQEAgRW1pdFZhcmlhYmxlcyhKU0NvbnRleHQgKmN4LCBKU0NvZGVHZW5l
cgogICAgICAgICAgICAgcmV0dXJuIEpTX0ZBTFNFOwogICAgICAgICBpZiAoIShwbi0+cG5feGZs
YWdzICYgUE5YX1BPUFZBUikpCiAgICAgICAgICAgICByZXR1cm4ganNfRW1pdDEoY3gsIGNnLCBK
U09QX05PUCkgPj0gMDsKICAgICB9CiAKICAgICByZXR1cm4gIShwbi0+cG5feGZsYWdzICYgUE5Y
X1BPUFZBUikgfHwganNfRW1pdDEoY3gsIGNnLCBKU09QX1BPUCkgPj0gMDsKIH0KIAorc3RhdGlj
IGJvb2wKK0VtaXRBc3NpZ25tZW50KEpTQ29udGV4dCAqY3gsIEpTQ29kZUdlbmVyYXRvciAqY2cs
IEpTUGFyc2VOb2RlICpsaHMsIEpTT3Agb3AsIEpTUGFyc2VOb2RlICpyaHMpCit7CisgICAgcHRy
ZGlmZl90IHRvcCA9IENHX09GRlNFVChjZyk7CisKKyAgICAvKgorICAgICAqIENoZWNrIGxlZnQg
b3BlcmFuZCB0eXBlIGFuZCBnZW5lcmF0ZSBzcGVjaWFsaXplZCBjb2RlIGZvciBpdC4KKyAgICAg
KiBTcGVjaWFsaXplIHRvIGF2b2lkIEVDTUEgInJlZmVyZW5jZSB0eXBlIiB2YWx1ZXMgb24gdGhl
IG9wZXJhbmQKKyAgICAgKiBzdGFjaywgd2hpY2ggaW1wb3NlIHBlcnZhc2l2ZSBydW50aW1lICJH
ZXRWYWx1ZSIgY29zdHMuCisgICAgICovCisgICAganNhdG9taWQgYXRvbUluZGV4ID0gKGpzYXRv
bWlkKSAtMTsgICAgICAgICAgICAgIC8qIHF1ZWxsIEdDQyBvdmVyd2FybmluZyAqLworICAgIGpz
Ynl0ZWNvZGUgb2Zmc2V0ID0gMTsKKyAgICBKU0F0b21MaXN0RWxlbWVudCAqYWxlOworICAgIHN3
aXRjaCAoUE5fVFlQRShsaHMpKSB7CisgICAgICBjYXNlIFRPS19OQU1FOgorICAgICAgICBpZiAo
IUJpbmROYW1lVG9TbG90KGN4LCBjZywgbGhzKSkKKyAgICAgICAgICAgIHJldHVybiBmYWxzZTsK
KyAgICAgICAgaWYgKCFsaHMtPnBuX2Nvb2tpZS5pc0ZyZWUoKSkgeworICAgICAgICAgICAgYXRv
bUluZGV4ID0gKGpzYXRvbWlkKSBsaHMtPnBuX2Nvb2tpZS5hc0ludGVnZXIoKTsKKyAgICAgICAg
fSBlbHNlIHsKKyAgICAgICAgICAgIGFsZSA9IGNnLT5hdG9tTGlzdC5hZGQoY2ctPnBhcnNlciwg
bGhzLT5wbl9hdG9tKTsKKyAgICAgICAgICAgIGlmICghYWxlKQorICAgICAgICAgICAgICAgIHJl
dHVybiBmYWxzZTsKKyAgICAgICAgICAgIGF0b21JbmRleCA9IEFMRV9JTkRFWChhbGUpOworICAg
ICAgICAgICAgaWYgKCFsaHMtPmlzQ29uc3QoKSkgeworICAgICAgICAgICAgICAgIEpTT3Agb3Ag
PSBQTl9PUChsaHMpID09IEpTT1BfU0VUR05BTUUgPyBKU09QX0JJTkRHTkFNRSA6IEpTT1BfQklO
RE5BTUU7CisgICAgICAgICAgICAgICAgRU1JVF9JTkRFWF9PUChvcCwgYXRvbUluZGV4KTsKKyAg
ICAgICAgICAgICAgICBvZmZzZXQrKzsKKyAgICAgICAgICAgIH0KKyAgICAgICAgfQorICAgICAg
ICBicmVhazsKKyAgICAgIGNhc2UgVE9LX0RPVDoKKyAgICAgICAgaWYgKCFqc19FbWl0VHJlZShj
eCwgY2csIGxocy0+ZXhwcigpKSkKKyAgICAgICAgICAgIHJldHVybiBmYWxzZTsKKyAgICAgICAg
b2Zmc2V0Kys7CisgICAgICAgIGFsZSA9IGNnLT5hdG9tTGlzdC5hZGQoY2ctPnBhcnNlciwgbGhz
LT5wbl9hdG9tKTsKKyAgICAgICAgaWYgKCFhbGUpCisgICAgICAgICAgICByZXR1cm4gZmFsc2U7
CisgICAgICAgIGF0b21JbmRleCA9IEFMRV9JTkRFWChhbGUpOworICAgICAgICBicmVhazsKKyAg
ICAgIGNhc2UgVE9LX0xCOgorICAgICAgICBKU19BU1NFUlQobGhzLT5wbl9hcml0eSA9PSBQTl9C
SU5BUlkpOworICAgICAgICBpZiAoIWpzX0VtaXRUcmVlKGN4LCBjZywgbGhzLT5wbl9sZWZ0KSkK
KyAgICAgICAgICAgIHJldHVybiBmYWxzZTsKKyAgICAgICAgaWYgKCFqc19FbWl0VHJlZShjeCwg
Y2csIGxocy0+cG5fcmlnaHQpKQorICAgICAgICAgICAgcmV0dXJuIGZhbHNlOworICAgICAgICBv
ZmZzZXQgKz0gMjsKKyAgICAgICAgYnJlYWs7CisjaWYgSlNfSEFTX0RFU1RSVUNUVVJJTkcKKyAg
ICAgIGNhc2UgVE9LX1JCOgorICAgICAgY2FzZSBUT0tfUkM6CisgICAgICAgIGJyZWFrOworI2Vu
ZGlmCisgICAgICBjYXNlIFRPS19MUDoKKyAgICAgICAgaWYgKCFqc19FbWl0VHJlZShjeCwgY2cs
IGxocykpCisgICAgICAgICAgICByZXR1cm4gZmFsc2U7CisgICAgICAgIG9mZnNldCsrOworICAg
ICAgICBicmVhazsKKyNpZiBKU19IQVNfWE1MX1NVUFBPUlQKKyAgICAgIGNhc2UgVE9LX1VOQVJZ
T1A6CisgICAgICAgIEpTX0FTU0VSVChsaHMtPnBuX29wID09IEpTT1BfU0VUWE1MTkFNRSk7Cisg
ICAgICAgIGlmICghanNfRW1pdFRyZWUoY3gsIGNnLCBsaHMtPnBuX2tpZCkpCisgICAgICAgICAg
ICByZXR1cm4gZmFsc2U7CisgICAgICAgIGlmIChqc19FbWl0MShjeCwgY2csIEpTT1BfQklORFhN
TE5BTUUpIDwgMCkKKyAgICAgICAgICAgIHJldHVybiBmYWxzZTsKKyAgICAgICAgb2Zmc2V0Kys7
CisgICAgICAgIGJyZWFrOworI2VuZGlmCisgICAgICBkZWZhdWx0OgorICAgICAgICBKU19BU1NF
UlQoMCk7CisgICAgfQorCisgICAgaWYgKG9wICE9IEpTT1BfTk9QKSB7CisgICAgICAgIEpTX0FT
U0VSVChyaHMpOworICAgICAgICBzd2l0Y2ggKGxocy0+cG5fdHlwZSkgeworICAgICAgICAgIGNh
c2UgVE9LX05BTUU6CisgICAgICAgICAgICBpZiAobGhzLT5pc0NvbnN0KCkpIHsKKyAgICAgICAg
ICAgICAgICBpZiAoUE5fT1AobGhzKSA9PSBKU09QX0NBTExFRSkgeworICAgICAgICAgICAgICAg
ICAgICBpZiAoanNfRW1pdDEoY3gsIGNnLCBKU09QX0NBTExFRSkgPCAwKQorICAgICAgICAgICAg
ICAgICAgICAgICAgcmV0dXJuIGZhbHNlOworICAgICAgICAgICAgICAgIH0gZWxzZSB7CisgICAg
ICAgICAgICAgICAgICAgIEVNSVRfSU5ERVhfT1AoUE5fT1AobGhzKSwgYXRvbUluZGV4KTsKKyAg
ICAgICAgICAgICAgICB9CisgICAgICAgICAgICB9IGVsc2UgaWYgKFBOX09QKGxocykgPT0gSlNP
UF9TRVROQU1FKSB7CisgICAgICAgICAgICAgICAgaWYgKGpzX0VtaXQxKGN4LCBjZywgSlNPUF9E
VVApIDwgMCkKKyAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlOworICAgICAgICAgICAg
ICAgIEVNSVRfSU5ERVhfT1AoSlNPUF9HRVRYUFJPUCwgYXRvbUluZGV4KTsKKyAgICAgICAgICAg
IH0gZWxzZSBpZiAoUE5fT1AobGhzKSA9PSBKU09QX1NFVEdOQU1FKSB7CisgICAgICAgICAgICAg
ICAgaWYgKCFCaW5kR2xvYmFsKGN4LCBjZywgbGhzLCBsaHMtPnBuX2F0b20pKQorICAgICAgICAg
ICAgICAgICAgICByZXR1cm4gZmFsc2U7CisgICAgICAgICAgICAgICAgaWYgKGxocy0+cG5fY29v
a2llLmlzRnJlZSgpKQorICAgICAgICAgICAgICAgICAgICBFbWl0QXRvbU9wKGN4LCBsaHMsIEpT
T1BfR0VUR05BTUUsIGNnKTsKKyAgICAgICAgICAgICAgICBlbHNlCisgICAgICAgICAgICAgICAg
ICAgIEVNSVRfVUlOVDE2X0lNTV9PUChKU09QX0dFVEdMT0JBTCwgbGhzLT5wbl9jb29raWUuYXNJ
bnRlZ2VyKCkpOworICAgICAgICAgICAgfSBlbHNlIHsKKyAgICAgICAgICAgICAgICBFTUlUX1VJ
TlQxNl9JTU1fT1AoKFBOX09QKGxocykgPT0gSlNPUF9TRVRBUkcpCisgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgID8gSlNPUF9HRVRBUkcKKyAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgOiBKU09QX0dFVExPQ0FMLAorICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICBhdG9tSW5kZXgpOworICAgICAgICAgICAgfQorICAgICAgICAgICAgYnJlYWs7Cisg
ICAgICAgICAgY2FzZSBUT0tfRE9UOgorICAgICAgICAgICAgaWYgKGpzX0VtaXQxKGN4LCBjZywg
SlNPUF9EVVApIDwgMCkKKyAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7CisgICAgICAgICAg
ICBpZiAobGhzLT5wbl9hdG9tID09IGN4LT5ydW50aW1lLT5hdG9tU3RhdGUubGVuZ3RoQXRvbSkg
eworICAgICAgICAgICAgICAgIGlmIChqc19FbWl0MShjeCwgY2csIEpTT1BfTEVOR1RIKSA8IDAp
CisgICAgICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTsKKyAgICAgICAgICAgIH0gZWxzZSBp
ZiAobGhzLT5wbl9hdG9tID09IGN4LT5ydW50aW1lLT5hdG9tU3RhdGUucHJvdG9BdG9tKSB7Cisg
ICAgICAgICAgICAgICAgaWYgKCFFbWl0SW5kZXhPcChjeCwgSlNPUF9RTkFNRVBBUlQsIGF0b21J
bmRleCwgY2cpKQorICAgICAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7CisgICAgICAgICAg
ICAgICAgaWYgKGpzX0VtaXQxKGN4LCBjZywgSlNPUF9HRVRFTEVNKSA8IDApCisgICAgICAgICAg
ICAgICAgICAgIHJldHVybiBmYWxzZTsKKyAgICAgICAgICAgIH0gZWxzZSB7CisgICAgICAgICAg
ICAgICAgRU1JVF9JTkRFWF9PUChKU09QX0dFVFBST1AsIGF0b21JbmRleCk7CisgICAgICAgICAg
ICB9CisgICAgICAgICAgICBicmVhazsKKyAgICAgICAgICBjYXNlIFRPS19MQjoKKyAgICAgICAg
ICBjYXNlIFRPS19MUDoKKyNpZiBKU19IQVNfWE1MX1NVUFBPUlQKKyAgICAgICAgICBjYXNlIFRP
S19VTkFSWU9QOgorI2VuZGlmCisgICAgICAgICAgICBpZiAoanNfRW1pdDEoY3gsIGNnLCBKU09Q
X0RVUDIpIDwgMCkKKyAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7CisgICAgICAgICAgICBp
ZiAoanNfRW1pdDEoY3gsIGNnLCBKU09QX0dFVEVMRU0pIDwgMCkKKyAgICAgICAgICAgICAgICBy
ZXR1cm4gZmFsc2U7CisgICAgICAgICAgICBicmVhazsKKyAgICAgICAgICBkZWZhdWx0OjsKKyAg
ICAgICAgfQorICAgIH0KKworICAgIC8qIE5vdyBlbWl0IHRoZSByaWdodCBvcGVyYW5kIChpdCBt
YXkgYWZmZWN0IHRoZSBuYW1lc3BhY2UpLiAqLworICAgIGlmIChyaHMpIHsKKyAgICAgICAgaWYg
KCFqc19FbWl0VHJlZShjeCwgY2csIHJocykpCisgICAgICAgICAgICByZXR1cm4gZmFsc2U7Cisg
ICAgfSBlbHNlIHsKKyAgICAgICAgLyogVGhlIHZhbHVlIHRvIGFzc2lnbiBpcyB0aGUgbmV4dCBl
bnVtZXJhdGlvbiB2YWx1ZSBpbiBhIGZvci1pbiBsb29wLiAqLworICAgICAgICBpZiAoanNfRW1p
dDIoY3gsIGNnLCBKU09QX0lURVJORVhULCBvZmZzZXQpIDwgMCkKKyAgICAgICAgICAgIHJldHVy
biBmYWxzZTsKKyAgICB9CisKKyAgICAvKiBJZiArPSBldGMuLCBlbWl0IHRoZSBiaW5hcnkgb3Bl
cmF0b3Igd2l0aCBhIGRlY29tcGlsZXIgbm90ZS4gKi8KKyAgICBpZiAob3AgIT0gSlNPUF9OT1Ap
IHsKKyAgICAgICAgLyoKKyAgICAgICAgICogVGFrZSBjYXJlIHRvIGF2b2lkIFNSQ19BU1NJR05P
UCBpZiB0aGUgbGVmdC1oYW5kIHNpZGUgaXMgYSBjb25zdAorICAgICAgICAgKiBkZWNsYXJlZCBp
biB0aGUgY3VycmVudCBjb21waWxhdGlvbiB1bml0LCBhcyBpbiB0aGlzIGNhc2UgKGp1c3QKKyAg
ICAgICAgICogYSBiaXQgZnVydGhlciBiZWxvdykgd2Ugd2lsbCBhdm9pZCBlbWl0dGluZyB0aGUg
YXNzaWdubWVudCBvcC4KKyAgICAgICAgICovCisgICAgICAgIGlmIChsaHMtPnBuX3R5cGUgIT0g
VE9LX05BTUUgfHwgIWxocy0+aXNDb25zdCgpKSB7CisgICAgICAgICAgICBpZiAoanNfTmV3U3Jj
Tm90ZShjeCwgY2csIFNSQ19BU1NJR05PUCkgPCAwKQorICAgICAgICAgICAgICAgIHJldHVybiBm
YWxzZTsKKyAgICAgICAgfQorICAgICAgICBpZiAoanNfRW1pdDEoY3gsIGNnLCBvcCkgPCAwKQor
ICAgICAgICAgICAgcmV0dXJuIGZhbHNlOworICAgIH0KKworICAgIC8qIExlZnQgcGFydHMgc3Vj
aCBhcyBhLmIuYyBhbmQgYVtiXS5jIG5lZWQgYSBkZWNvbXBpbGVyIG5vdGUuICovCisgICAgaWYg
KGxocy0+cG5fdHlwZSAhPSBUT0tfTkFNRSAmJgorI2lmIEpTX0hBU19ERVNUUlVDVFVSSU5HCisg
ICAgICAgIGxocy0+cG5fdHlwZSAhPSBUT0tfUkIgJiYKKyAgICAgICAgbGhzLT5wbl90eXBlICE9
IFRPS19SQyAmJgorI2VuZGlmCisgICAgICAgIGpzX05ld1NyY05vdGUyKGN4LCBjZywgU1JDX1BD
QkFTRSwgQ0dfT0ZGU0VUKGNnKSAtIHRvcCkgPCAwKSB7CisgICAgICAgIHJldHVybiBmYWxzZTsK
KyAgICB9CisKKyAgICAvKiBGaW5hbGx5LCBlbWl0IHRoZSBzcGVjaWFsaXplZCBhc3NpZ25tZW50
IGJ5dGVjb2RlLiAqLworICAgIHN3aXRjaCAobGhzLT5wbl90eXBlKSB7CisgICAgICBjYXNlIFRP
S19OQU1FOgorICAgICAgICBpZiAobGhzLT5pc0NvbnN0KCkpIHsKKyAgICAgICAgICAgIGlmICgh
cmhzKSB7CisgICAgICAgICAgICAgICAgUmVwb3J0Q29tcGlsZUVycm9yTnVtYmVyKGN4LCBDR19U
UyhjZyksIGxocywgSlNSRVBPUlRfRVJST1IsCisgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgIEpTTVNHX0JBRF9GT1JfTEVGVFNJREUpOworICAgICAgICAgICAgICAgIHJl
dHVybiBmYWxzZTsKKyAgICAgICAgICAgIH0KKyAgICAgICAgICAgIGJyZWFrOworICAgICAgICB9
CisgICAgICAgIC8qIEZBTEwgVEhST1VHSCAqLworICAgICAgY2FzZSBUT0tfRE9UOgorICAgICAg
ICBFTUlUX0lOREVYX09QKFBOX09QKGxocyksIGF0b21JbmRleCk7CisgICAgICAgIGJyZWFrOwor
ICAgICAgY2FzZSBUT0tfTEI6CisgICAgICBjYXNlIFRPS19MUDoKKyAgICAgICAgaWYgKGpzX0Vt
aXQxKGN4LCBjZywgSlNPUF9TRVRFTEVNKSA8IDApCisgICAgICAgICAgICByZXR1cm4gZmFsc2U7
CisgICAgICAgIGJyZWFrOworI2lmIEpTX0hBU19ERVNUUlVDVFVSSU5HCisgICAgICBjYXNlIFRP
S19SQjoKKyAgICAgIGNhc2UgVE9LX1JDOgorICAgICAgICBpZiAoIUVtaXREZXN0cnVjdHVyaW5n
T3BzKGN4LCBjZywgSlNPUF9TRVROQU1FLCBsaHMpKQorICAgICAgICAgICAgcmV0dXJuIGZhbHNl
OworICAgICAgICBicmVhazsKKyNlbmRpZgorI2lmIEpTX0hBU19YTUxfU1VQUE9SVAorICAgICAg
Y2FzZSBUT0tfVU5BUllPUDoKKyAgICAgICAgaWYgKGpzX0VtaXQxKGN4LCBjZywgSlNPUF9TRVRY
TUxOQU1FKSA8IDApCisgICAgICAgICAgICByZXR1cm4gZmFsc2U7CisgICAgICAgIGJyZWFrOwor
I2VuZGlmCisgICAgICBkZWZhdWx0OgorICAgICAgICBKU19BU1NFUlQoMCk7CisgICAgfQorICAg
IHJldHVybiB0cnVlOworfQorCiAjaWYgZGVmaW5lZCBERUJVR19icmVuZGFuIHx8IGRlZmluZWQg
REVCVUdfbXJia2FwCiBzdGF0aWMgSlNCb29sCiBHZXR0YWJsZU5vdGVGb3JOZXh0T3AoSlNDb2Rl
R2VuZXJhdG9yICpjZykKIHsKICAgICBwdHJkaWZmX3Qgb2Zmc2V0LCB0YXJnZXQ7CiAgICAganNz
cmNub3RlICpzbiwgKmVuZDsKIAogICAgIG9mZnNldCA9IDA7CkBAIC00OTM2LDE3ICs1MTM2LDE3
IEBAIGpzX0VtaXRUcmVlKEpTQ29udGV4dCAqY3gsIEpTQ29kZUdlbmVyYXQKICAgICAgICAgcG4y
ID0gcG4tPnBuX2xlZnQ7CiAgICAgICAgIGpzX1B1c2hTdGF0ZW1lbnQoY2csICZzdG10SW5mbywg
U1RNVF9GT1JfTE9PUCwgdG9wKTsKIAogICAgICAgICBpZiAocG4yLT5wbl90eXBlID09IFRPS19J
TikgewogICAgICAgICAgICAgLyogU2V0IHN0bXRJbmZvIHR5cGUgZm9yIGxhdGVyIHRlc3Rpbmcu
ICovCiAgICAgICAgICAgICBzdG10SW5mby50eXBlID0gU1RNVF9GT1JfSU5fTE9PUDsKIAogICAg
ICAgICAgICAgLyoKLSAgICAgICAgICAgICAqIElmIHRoZSBsZWZ0IHBhcnQgaXMgJ3ZhciB4Jywg
ZW1pdCBjb2RlIHRvIGRlZmluZSB4IGlmIG5lY2Vzc2FyeQorICAgICAgICAgICAgICogPD8/Pz5J
ZiB0aGUgbGVmdCBwYXJ0IGlzICd2YXIgeCcsIGVtaXQgY29kZSB0byBkZWZpbmUgeCBpZiBuZWNl
c3NhcnkKICAgICAgICAgICAgICAqIHVzaW5nIGEgcHJvbG9nIG9wY29kZSwgYnV0IGRvIG5vdCBl
bWl0IGEgcG9wLiAgSWYgdGhlIGxlZnQgcGFydAogICAgICAgICAgICAgICogaXMgJ3ZhciB4ID0g
aScsIGVtaXQgcHJvbG9nIGNvZGUgdG8gZGVmaW5lIHggaWYgbmVjZXNzYXJ5OyB0aGVuCiAgICAg
ICAgICAgICAgKiBlbWl0IGNvZGUgdG8gZXZhbHVhdGUgaSwgYXNzaWduIHRoZSByZXN1bHQgdG8g
eCwgYW5kIHBvcCB0aGUKICAgICAgICAgICAgICAqIHJlc3VsdCBvZmYgdGhlIHN0YWNrLgogICAg
ICAgICAgICAgICoKICAgICAgICAgICAgICAqIEFsbCB0aGUgbG9naWMgdG8gZG8gdGhpcyBpcyBp
bXBsZW1lbnRlZCBpbiB0aGUgb3V0ZXIgc3dpdGNoJ3MKICAgICAgICAgICAgICAqIFRPS19WQVIg
Y2FzZSwgY29uZGl0aW9uZWQgb24gcG5feGZsYWdzIGZsYWdzIHNldCBieSB0aGUgcGFyc2VyLgog
ICAgICAgICAgICAgICoKQEAgLTQ5NTUsMzAgKzUxNTUsMjggQEAganNfRW1pdFRyZWUoSlNDb250
ZXh0ICpjeCwgSlNDb2RlR2VuZXJhdAogICAgICAgICAgICAgICogb3AgdGhhdCBzZXRzIHggPSBp
LCBob2lzdGluZyB0aGUgaW5pdGlhbGl6ZWQgdmFyIGRlY2xhcmF0aW9uCiAgICAgICAgICAgICAg
KiBvdXQgb2YgdGhlIGxvb3A6ICd2YXIgeCA9IGk7IGZvciAoeCBpbiBvKSAuLi4nLgogICAgICAg
ICAgICAgICoKICAgICAgICAgICAgICAqIEluIHRoZSAnZm9yICh2YXIgeCBpbiBvKSAuLi4nIGNh
c2UsIG5vdGhpbmcgYnV0IHRoZSBwcm9sb2cgb3AKICAgICAgICAgICAgICAqIChpZiBuZWVkZWQp
IHNob3VsZCBiZSBnZW5lcmF0ZWQgaGVyZSwgd2UgbXVzdCBlbWl0IHRoZSBub3RlCiAgICAgICAg
ICAgICAgKiBqdXN0IGJlZm9yZSB0aGUgSlNPUF9GT1IqIG9wY29kZSBpbiB0aGUgc3dpdGNoIG9u
IHBuMy0+cG5fdHlwZQogICAgICAgICAgICAgICogYSBiaXQgYmVsb3csIHNvIG5vdGhpbmcgaXMg
aG9pc3RlZDogJ2ZvciAodmFyIHggaW4gbykgLi4uJy4KICAgICAgICAgICAgICAqCi0gICAgICAg
ICAgICAgKiBBICdmb3IgKGxldCB4ID0gaSBpbiBvKScgbG9vcCBtdXN0IG5vdCBiZSBob2lzdGVk
LCBzaW5jZSBpbgotICAgICAgICAgICAgICogdGhpcyBmb3JtIHRoZSBsZXQgdmFyaWFibGUgaXMg
c2NvcGVkIGJ5IHRoZSBsb29wIGJvZHkgKGJ1dCBub3QKLSAgICAgICAgICAgICAqIHRoZSBoZWFk
KS4gIFRoZSBpbml0aWFsaXplciBleHByZXNzaW9uIGkgbXVzdCBiZSBldmFsdWF0ZWQgZm9yCi0g
ICAgICAgICAgICAgKiBhbnkgc2lkZSBlZmZlY3RzLiAgU28gd2UgaG9pc3Qgb25seSBpIGluIHRo
ZSBsZXQgY2FzZS4KKyAgICAgICAgICAgICAqICdmb3IgKGxldCB4ID0gaSBpbiBvKScgaXMgbWVy
Y2lmdWxseSBiYW5uZWQuPC8/Pz8+CiAgICAgICAgICAgICAgKi8KLSAgICAgICAgICAgIHBuMyA9
IHBuMi0+cG5fbGVmdDsKLSAgICAgICAgICAgIHR5cGUgPSBQTl9UWVBFKHBuMyk7Ci0gICAgICAg
ICAgICBjZy0+ZmxhZ3MgfD0gVENGX0lOX0ZPUl9JTklUOwotICAgICAgICAgICAgaWYgKFRva2Vu
S2luZElzRGVjbCh0eXBlKSAmJiAhanNfRW1pdFRyZWUoY3gsIGNnLCBwbjMpKQotICAgICAgICAg
ICAgICAgIHJldHVybiBKU19GQUxTRTsKLSAgICAgICAgICAgIGNnLT5mbGFncyAmPSB+VENGX0lO
X0ZPUl9JTklUOworICAgICAgICAgICAgaWYgKEpTUGFyc2VOb2RlICpkZWNsID0gcG4yLT5wbl9r
aWQxKSB7CisgICAgICAgICAgICAgICAgSlNfQVNTRVJUKFRva2VuS2luZElzRGVjbChQTl9UWVBF
KGRlY2wpKSk7CisgICAgICAgICAgICAgICAgY2ctPmZsYWdzIHw9IFRDRl9JTl9GT1JfSU5JVDsK
KyAgICAgICAgICAgICAgICBpZiAoIWpzX0VtaXRUcmVlKGN4LCBjZywgZGVjbCkpCisgICAgICAg
ICAgICAgICAgICAgIHJldHVybiBKU19GQUxTRTsKKyAgICAgICAgICAgICAgICBjZy0+ZmxhZ3Mg
Jj0gflRDRl9JTl9GT1JfSU5JVDsKKyAgICAgICAgICAgIH0KIAogICAgICAgICAgICAgLyogQ29t
cGlsZSB0aGUgb2JqZWN0IGV4cHJlc3Npb24gdG8gdGhlIHJpZ2h0IG9mICdpbicuICovCi0gICAg
ICAgICAgICBpZiAoIWpzX0VtaXRUcmVlKGN4LCBjZywgcG4yLT5wbl9yaWdodCkpCisgICAgICAg
ICAgICBpZiAoIWpzX0VtaXRUcmVlKGN4LCBjZywgcG4yLT5wbl9raWQzKSkKICAgICAgICAgICAg
ICAgICByZXR1cm4gSlNfRkFMU0U7CiAKICAgICAgICAgICAgIC8qCiAgICAgICAgICAgICAgKiBF
bWl0IGEgYnl0ZWNvZGUgdG8gY29udmVydCB0b3Agb2Ygc3RhY2sgdmFsdWUgdG8gdGhlIGl0ZXJh
dG9yCiAgICAgICAgICAgICAgKiBvYmplY3QgZGVwZW5kaW5nIG9uIHRoZSBsb29wIHZhcmlhbnQg
KGZvci1pbiwgZm9yLWVhY2gtaW4sIG9yCiAgICAgICAgICAgICAgKiBkZXN0cnVjdHVyaW5nIGZv
ci1pbikuCiAgICAgICAgICAgICAgKi8KICAgICAgICAgICAgIEpTX0FTU0VSVChwbi0+cG5fb3Ag
PT0gSlNPUF9JVEVSKTsKQEAgLTUwMDcsMTY2ICs1MjA1LDQzIEBAIGpzX0VtaXRUcmVlKEpTQ29u
dGV4dCAqY3gsIEpTQ29kZUdlbmVyYXQKICAgICAgICAgICAgIGlmIChFbWl0VHJhY2VPcChjeCwg
Y2cpIDwgMCkKICAgICAgICAgICAgICAgICByZXR1cm4gSlNfRkFMU0U7CiAKICNpZmRlZiBERUJV
RwogICAgICAgICAgICAgaW50TiBsb29wRGVwdGggPSBjZy0+c3RhY2tEZXB0aDsKICNlbmRpZgog
CiAgICAgICAgICAgICAvKgotICAgICAgICAgICAgICogQ29tcGlsZSBhIEpTT1BfRk9SKiBieXRl
Y29kZSBiYXNlZCBvbiB0aGUgbGVmdCBoYW5kIHNpZGUuCisgICAgICAgICAgICAgKiBFbWl0IGNv
ZGUgdG8gZ2V0IHRoZSBuZXh0IGVudW1lcmF0aW9uIHZhbHVlIGFuZCBhc3NpZ24gaXQgdG8gdGhl
CisgICAgICAgICAgICAgKiBsZWZ0IGhhbmQgc2lkZS4gVGhlIEpTT1BfUE9QIGFmdGVyIHRoaXMg
YXNzaWdubWVudCBpcyBhbm5vdGF0ZWQKKyAgICAgICAgICAgICAqIHNvIHRoYXQgdGhlIGRlY29t
cGlsZXIgY2FuIGRpc3Rpbmd1aXNoIGBmb3IgKHggaW4geSlgIGZyb20KKyAgICAgICAgICAgICAq
IGBmb3IgKHZhciB4IGluIHkpYC4KICAgICAgICAgICAgICAqCi0gICAgICAgICAgICAgKiBJbml0
aWFsaXplIG9wIHRvIEpTT1BfU0VUTkFNRSBpbiBjYXNlIG9mIHxmb3IgKFthLCBiXSBpbiBvKS4u
LnwKKyAgICAgICAgICAgICAqIDw/Pz8+SW5pdGlhbGl6ZSBvcCB0byBKU09QX1NFVE5BTUUgaW4g
Y2FzZSBvZiB8Zm9yIChbYSwgYl0gaW4gbykuLi58CiAgICAgICAgICAgICAgKiBvciBzaW1pbGFy
LCB0byBzaWduaWZ5IGFzc2lnbm1lbnQsIHJhdGhlciB0aGFuIGRlY2xhcmF0aW9uLCB0bwogICAg
ICAgICAgICAgICogdGhlIGRlY29tcGlsZXIuICBFbWl0RGVzdHJ1Y3R1cmluZ09wcyB0YWtlcyBh
IHByb2xvZyBieXRlY29kZQogICAgICAgICAgICAgICogcGFyYW1ldGVyIGFuZCBlbWl0cyB0aGUg
YXBwcm9wcmlhdGUgc291cmNlIG5vdGUsIGRlZmF1bHRpbmcgdG8KICAgICAgICAgICAgICAqIGFz
c2lnbm1lbnQsIHNvIEpTT1BfU0VUTkFNRSBpcyBub3QgY3JpdGljYWwgaGVyZTsgbWFueSBzaW1p
bGFyCi0gICAgICAgICAgICAgKiBvcHMgY291bGQgYmUgdXNlZCAtLSBqdXN0IG5vdCBKU09QX05P
UCAod2hpY2ggbWVhbnMgJ2xldCcpLgorICAgICAgICAgICAgICogb3BzIGNvdWxkIGJlIHVzZWQg
LS0ganVzdCBub3QgSlNPUF9OT1AgKHdoaWNoIG1lYW5zICdsZXQnKS48Lz8/Pz4KICAgICAgICAg
ICAgICAqLwotICAgICAgICAgICAgb3AgPSBKU09QX1NFVE5BTUU7Ci0gICAgICAgICAgICBzd2l0
Y2ggKHR5cGUpIHsKLSNpZiBKU19IQVNfQkxPQ0tfU0NPUEUKLSAgICAgICAgICAgICAgY2FzZSBU
T0tfTEVUOgotI2VuZGlmCi0gICAgICAgICAgICAgIGNhc2UgVE9LX1ZBUjoKLSAgICAgICAgICAg
ICAgICBKU19BU1NFUlQocG4zLT5wbl9hcml0eSA9PSBQTl9MSVNUICYmIHBuMy0+cG5fY291bnQg
PT0gMSk7Ci0gICAgICAgICAgICAgICAgcG4zID0gcG4zLT5wbl9oZWFkOwotI2lmIEpTX0hBU19E
RVNUUlVDVFVSSU5HCi0gICAgICAgICAgICAgICAgaWYgKHBuMy0+cG5fdHlwZSA9PSBUT0tfQVNT
SUdOKSB7Ci0gICAgICAgICAgICAgICAgICAgIHBuMyA9IHBuMy0+cG5fbGVmdDsKLSAgICAgICAg
ICAgICAgICAgICAgSlNfQVNTRVJUKHBuMy0+cG5fdHlwZSA9PSBUT0tfUkIgfHwgcG4zLT5wbl90
eXBlID09IFRPS19SQyk7Ci0gICAgICAgICAgICAgICAgfQotICAgICAgICAgICAgICAgIGlmIChw
bjMtPnBuX3R5cGUgPT0gVE9LX1JCIHx8IHBuMy0+cG5fdHlwZSA9PSBUT0tfUkMpIHsKLSAgICAg
ICAgICAgICAgICAgICAgb3AgPSBQTl9PUChwbjItPnBuX2xlZnQpOwotICAgICAgICAgICAgICAg
ICAgICBnb3RvIGRlc3RydWN0dXJpbmdfZm9yOwotICAgICAgICAgICAgICAgIH0KLSNlbHNlCi0g
ICAgICAgICAgICAgICAgSlNfQVNTRVJUKHBuMy0+cG5fdHlwZSA9PSBUT0tfTkFNRSk7Ci0jZW5k
aWYKLSAgICAgICAgICAgICAgICAvKiBGQUxMIFRIUk9VR0ggKi8KLQotICAgICAgICAgICAgICBj
YXNlIFRPS19OQU1FOgotICAgICAgICAgICAgICB7Ci0gICAgICAgICAgICAgICAgLyoKLSAgICAg
ICAgICAgICAgICAgKiBBbHdheXMgYW5ub3RhdGUgSlNPUF9GT1JMT0NBTCBpZiBnaXZlbiBpbnB1
dCBvZiB0aGUgZm9ybQotICAgICAgICAgICAgICAgICAqICdmb3IgKGxldCB4IGluICogbyknIC0t
IHRoZSBkZWNvbXBpbGVyIG11c3Qgbm90IGhvaXN0IHRoZQotICAgICAgICAgICAgICAgICAqICds
ZXQgeCcgb3V0IG9mIHRoZSBsb29wIGhlYWQsIG9yIHggd2lsbCBiZSBib3VuZCBpbiB0aGUKLSAg
ICAgICAgICAgICAgICAgKiB3cm9uZyBzY29wZS4gIExpa2V3aXNlLCBidXQgaW4gdGhpcyBjYXNl
IG9ubHkgZm9yIHRoZSBzYWtlCi0gICAgICAgICAgICAgICAgICogb2YgaGlnaGVyIGRlY29tcGls
YXRpb24gZmlkZWxpdHkgb25seSwgZG8gbm90IGhvaXN0ICd2YXIgeCcKLSAgICAgICAgICAgICAg
ICAgKiB3aGVuIGdpdmVuICdmb3IgKHZhciB4IGluIG8pJy4KLSAgICAgICAgICAgICAgICAgKi8K
LSAgICAgICAgICAgICAgICBpZiAoKAotI2lmIEpTX0hBU19CTE9DS19TQ09QRQotICAgICAgICAg
ICAgICAgICAgICAgdHlwZSA9PSBUT0tfTEVUIHx8Ci0jZW5kaWYKLSAgICAgICAgICAgICAgICAg
ICAgICh0eXBlID09IFRPS19WQVIgJiYgIXBuMy0+bWF5YmVFeHByKCkpKSAmJgotICAgICAgICAg
ICAgICAgICAgICBqc19OZXdTcmNOb3RlMihjeCwgY2csIFNSQ19ERUNMLAotICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAodHlwZSA9PSBUT0tfVkFSKQotICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICA/IFNSQ19ERUNMX1ZBUgotICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICA6IFNSQ19ERUNMX0xFVCkgPCAwKSB7Ci0gICAgICAgICAgICAgICAgICAg
IHJldHVybiBKU19GQUxTRTsKLSAgICAgICAgICAgICAgICB9Ci0gICAgICAgICAgICAgICAgVXB2
YXJDb29raWUgY29va2llID0gcG4zLT5wbl9jb29raWU7Ci0gICAgICAgICAgICAgICAgaWYgKCFj
b29raWUuaXNGcmVlKCkpIHsKLSAgICAgICAgICAgICAgICAgICAgb3AgPSBQTl9PUChwbjMpOwot
ICAgICAgICAgICAgICAgICAgICBzd2l0Y2ggKG9wKSB7Ci0gICAgICAgICAgICAgICAgICAgICAg
Y2FzZSBKU09QX0dFVEFSRzoKLSAgICAgICAgICAgICAgICAgICAgICBjYXNlIEpTT1BfU0VUQVJH
OgotICAgICAgICAgICAgICAgICAgICAgICAgb3AgPSBKU09QX0ZPUkFSRzsKLSAgICAgICAgICAg
ICAgICAgICAgICAgIGJyZWFrOwotICAgICAgICAgICAgICAgICAgICAgIGNhc2UgSlNPUF9HRVRM
T0NBTDoKLSAgICAgICAgICAgICAgICAgICAgICBjYXNlIEpTT1BfU0VUTE9DQUw6Ci0gICAgICAg
ICAgICAgICAgICAgICAgICBvcCA9IEpTT1BfRk9STE9DQUw7Ci0gICAgICAgICAgICAgICAgICAg
ICAgICBicmVhazsKLSAgICAgICAgICAgICAgICAgICAgICBjYXNlIEpTT1BfR0VUR0xPQkFMOgot
ICAgICAgICAgICAgICAgICAgICAgICAgb3AgPSBKU09QX0ZPUkdOQU1FOwotICAgICAgICAgICAg
ICAgICAgICAgICAgY29va2llLm1ha2VGcmVlKCk7Ci0gICAgICAgICAgICAgICAgICAgICAgICBi
cmVhazsKLSAgICAgICAgICAgICAgICAgICAgICBkZWZhdWx0OgotICAgICAgICAgICAgICAgICAg
ICAgICAgSlNfTk9UX1JFQUNIRUQoInVuZXhwZWN0ZWQgb3Bjb2RlIik7Ci0gICAgICAgICAgICAg
ICAgICAgIH0KLSAgICAgICAgICAgICAgICB9IGVsc2UgewotICAgICAgICAgICAgICAgICAgICBw
bjMtPnBuX29wID0gSlNPUF9GT1JOQU1FOwotICAgICAgICAgICAgICAgICAgICBpZiAoIUJpbmRO
YW1lVG9TbG90KGN4LCBjZywgcG4zKSkKLSAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBK
U19GQUxTRTsKLSAgICAgICAgICAgICAgICAgICAgb3AgPSBQTl9PUChwbjMpOwotICAgICAgICAg
ICAgICAgICAgICBjb29raWUgPSBwbjMtPnBuX2Nvb2tpZTsKLSAgICAgICAgICAgICAgICB9Ci0g
ICAgICAgICAgICAgICAgaWYgKHBuMy0+aXNDb25zdCgpKSB7Ci0gICAgICAgICAgICAgICAgICAg
IFJlcG9ydENvbXBpbGVFcnJvck51bWJlcihjeCwgQ0dfVFMoY2cpLCBwbjMsIEpTUkVQT1JUX0VS
Uk9SLAotICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgSlNNU0df
QkFEX0ZPUl9MRUZUU0lERSk7Ci0gICAgICAgICAgICAgICAgICAgIHJldHVybiBKU19GQUxTRTsK
LSAgICAgICAgICAgICAgICB9Ci0gICAgICAgICAgICAgICAgaWYgKCFjb29raWUuaXNGcmVlKCkp
IHsKLSAgICAgICAgICAgICAgICAgICAgYXRvbUluZGV4ID0gKGpzYXRvbWlkKSBjb29raWUuYXNJ
bnRlZ2VyKCk7Ci0gICAgICAgICAgICAgICAgICAgIEVNSVRfVUlOVDE2X0lNTV9PUChvcCwgYXRv
bUluZGV4KTsKLSAgICAgICAgICAgICAgICB9IGVsc2UgewotICAgICAgICAgICAgICAgICAgICBp
ZiAoIUVtaXRBdG9tT3AoY3gsIHBuMywgb3AsIGNnKSkKLSAgICAgICAgICAgICAgICAgICAgICAg
IHJldHVybiBKU19GQUxTRTsKLSAgICAgICAgICAgICAgICB9Ci0gICAgICAgICAgICAgICAgYnJl
YWs7Ci0gICAgICAgICAgICAgIH0KLQotICAgICAgICAgICAgICBjYXNlIFRPS19ET1Q6Ci0gICAg
ICAgICAgICAgICAgLyoKLSAgICAgICAgICAgICAgICAgKiAnZm9yIChvLnAgaW4gcSknIGNhbiB1
c2UgSlNPUF9GT1JQUk9QIG9ubHkgaWYgZXZhbHVhdGluZyAnbycKLSAgICAgICAgICAgICAgICAg
KiBoYXMgbm8gc2lkZSBlZmZlY3RzLgotICAgICAgICAgICAgICAgICAqLwotICAgICAgICAgICAg
ICAgIHVzZWZ1bCA9IEpTX0ZBTFNFOwotICAgICAgICAgICAgICAgIGlmICghQ2hlY2tTaWRlRWZm
ZWN0cyhjeCwgY2csIHBuMy0+ZXhwcigpLCAmdXNlZnVsKSkKLSAgICAgICAgICAgICAgICAgICAg
cmV0dXJuIEpTX0ZBTFNFOwotICAgICAgICAgICAgICAgIGlmICghdXNlZnVsKSB7Ci0gICAgICAg
ICAgICAgICAgICAgIGlmICghRW1pdFByb3BPcChjeCwgcG4zLCBKU09QX0ZPUlBST1AsIGNnLCBK
U19GQUxTRSkpCi0gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gSlNfRkFMU0U7Ci0gICAg
ICAgICAgICAgICAgICAgIGJyZWFrOwotICAgICAgICAgICAgICAgIH0KLSAgICAgICAgICAgICAg
ICAvKiBGQUxMIFRIUk9VR0ggKi8KLQotI2lmIEpTX0hBU19ERVNUUlVDVFVSSU5HCi0gICAgICAg
ICAgICAgIGRlc3RydWN0dXJpbmdfZm9yOgotI2VuZGlmCi0gICAgICAgICAgICAgIGRlZmF1bHQ6
Ci0gICAgICAgICAgICAgICAgaWYgKGpzX0VtaXQxKGN4LCBjZywgSlNPUF9GT1JFTEVNKSA8IDAp
Ci0gICAgICAgICAgICAgICAgICAgIHJldHVybiBKU19GQUxTRTsKLSAgICAgICAgICAgICAgICBK
U19BU1NFUlQoY2ctPnN0YWNrRGVwdGggPj0gMik7Ci0KLSNpZiBKU19IQVNfREVTVFJVQ1RVUklO
RwotICAgICAgICAgICAgICAgIGlmIChwbjMtPnBuX3R5cGUgPT0gVE9LX1JCIHx8IHBuMy0+cG5f
dHlwZSA9PSBUT0tfUkMpIHsKLSAgICAgICAgICAgICAgICAgICAgaWYgKCFFbWl0RGVzdHJ1Y3R1
cmluZ09wcyhjeCwgY2csIG9wLCBwbjMpKQotICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJu
IEpTX0ZBTFNFOwotICAgICAgICAgICAgICAgICAgICBpZiAoanNfRW1pdDEoY3gsIGNnLCBKU09Q
X1BPUCkgPCAwKQotICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIEpTX0ZBTFNFOwotICAg
ICAgICAgICAgICAgIH0gZWxzZQotI2VuZGlmCi0gICAgICAgICAgICAgICAgaWYgKHBuMy0+cG5f
dHlwZSA9PSBUT0tfTFApIHsKLSAgICAgICAgICAgICAgICAgICAgSlNfQVNTRVJUKHBuMy0+cG5f
eGZsYWdzICYgUE5YX1NFVENBTEwpOwotICAgICAgICAgICAgICAgICAgICBpZiAoIWpzX0VtaXRU
cmVlKGN4LCBjZywgcG4zKSkKLSAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBKU19GQUxT
RTsKLSAgICAgICAgICAgICAgICAgICAgaWYgKGpzX0VtaXQxKGN4LCBjZywgSlNPUF9FTlVNRUxF
TSkgPCAwKQotICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIEpTX0ZBTFNFOwotICAgICAg
ICAgICAgICAgIH0gZWxzZQotI2lmIEpTX0hBU19YTUxfU1VQUE9SVAotICAgICAgICAgICAgICAg
IGlmIChwbjMtPnBuX3R5cGUgPT0gVE9LX1VOQVJZT1ApIHsKLSAgICAgICAgICAgICAgICAgICAg
SlNfQVNTRVJUKHBuMy0+cG5fb3AgPT0gSlNPUF9CSU5EWE1MTkFNRSk7Ci0gICAgICAgICAgICAg
ICAgICAgIGlmICghanNfRW1pdFRyZWUoY3gsIGNnLCBwbjMpKQotICAgICAgICAgICAgICAgICAg
ICAgICAgcmV0dXJuIEpTX0ZBTFNFOwotICAgICAgICAgICAgICAgICAgICBpZiAoanNfRW1pdDEo
Y3gsIGNnLCBKU09QX0VOVU1FTEVNKSA8IDApCi0gICAgICAgICAgICAgICAgICAgICAgICByZXR1
cm4gSlNfRkFMU0U7Ci0gICAgICAgICAgICAgICAgfSBlbHNlCi0jZW5kaWYKLSAgICAgICAgICAg
ICAgICBpZiAoIUVtaXRFbGVtT3AoY3gsIHBuMywgSlNPUF9FTlVNRUxFTSwgY2cpKQotICAgICAg
ICAgICAgICAgICAgICByZXR1cm4gSlNfRkFMU0U7Ci0gICAgICAgICAgICAgICAgYnJlYWs7Cisg
ICAgICAgICAgICBpZiAoIUVtaXRBc3NpZ25tZW50KGN4LCBjZywgcG4yLT5wbl9raWQyLCBKU09Q
X05PUCwgTlVMTCkpCisgICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlOworICAgICAgICAgICAg
dG1wMiA9IENHX09GRlNFVChjZyk7CisgICAgICAgICAgICBpZiAocG4yLT5wbl9raWQxICYmICFq
c19OZXdTcmNOb3RlMihjeCwgY2csIFNSQ19ERUNMLAorICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgKHBuMi0+cG5fa2lkMS0+cG5fb3AgPT0gSlNPUF9ERUZW
QVIpCisgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA/IFNS
Q19ERUNMX1ZBUgorICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgOiBTUkNfREVDTF9MRVQpIDwgMCkgeworICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTsK
ICAgICAgICAgICAgIH0KLQotICAgICAgICAgICAgLyogVGhlIHN0YWNrIHNob3VsZCBiZSBiYWxh
bmNlZCBhcm91bmQgdGhlIEpTT1BfRk9SKiBvcGNvZGUgc2VxdWVuY2UuICovCisgICAgICAgICAg
ICBpZiAoanNfRW1pdDEoY3gsIGNnLCBKU09QX1BPUCkgPCAwKQorICAgICAgICAgICAgICAgIHJl
dHVybiBmYWxzZTsKKworICAgICAgICAgICAgLyogVGhlIHN0YWNrIHNob3VsZCBiZSBiYWxhbmNl
ZCBhcm91bmQgdGhlIGFzc2lnbm1lbnQgb3Bjb2RlIHNlcXVlbmNlLiAqLwogICAgICAgICAgICAg
SlNfQVNTRVJUKGNnLT5zdGFja0RlcHRoID09IGxvb3BEZXB0aCk7CiAKLSAgICAgICAgICAgIHRt
cDIgPSBDR19PRkZTRVQoY2cpOwotCiAgICAgICAgICAgICAvKiBFbWl0IGNvZGUgZm9yIHRoZSBs
b29wIGJvZHkuICovCiAgICAgICAgICAgICBpZiAoIWpzX0VtaXRUcmVlKGN4LCBjZywgcG4tPnBu
X3JpZ2h0KSkKICAgICAgICAgICAgICAgICByZXR1cm4gSlNfRkFMU0U7CiAKICAgICAgICAgICAg
IC8qIFNldCBsb29wIGFuZCBlbmNsb3NpbmcgInVwZGF0ZSIgb2Zmc2V0cywgZm9yIGNvbnRpbnVl
LiAqLwogICAgICAgICAgICAgc3RtdCA9ICZzdG10SW5mbzsKICAgICAgICAgICAgIGRvIHsKICAg
ICAgICAgICAgICAgICBzdG10LT51cGRhdGUgPSBDR19PRkZTRVQoY2cpOwpAQCAtNjA1MywxOTQg
KzYxMjgsMTggQEAganNfRW1pdFRyZWUoSlNDb250ZXh0ICpjeCwgSlNDb2RlR2VuZXJhdAogICAg
ICAgICAgICAgaWYgKG5vdGVJbmRleCA8IDAgfHwKICAgICAgICAgICAgICAgICBqc19FbWl0MShj
eCwgY2csIEpTT1BfUE9QKSA8IDApIHsKICAgICAgICAgICAgICAgICByZXR1cm4gSlNfRkFMU0U7
CiAgICAgICAgICAgICB9CiAgICAgICAgIH0KICAgICAgICAgYnJlYWs7CiAKICAgICAgIGNhc2Ug
VE9LX0FTU0lHTjoKLSAgICAgICAgLyoKLSAgICAgICAgICogQ2hlY2sgbGVmdCBvcGVyYW5kIHR5
cGUgYW5kIGdlbmVyYXRlIHNwZWNpYWxpemVkIGNvZGUgZm9yIGl0LgotICAgICAgICAgKiBTcGVj
aWFsaXplIHRvIGF2b2lkIEVDTUEgInJlZmVyZW5jZSB0eXBlIiB2YWx1ZXMgb24gdGhlIG9wZXJh
bmQKLSAgICAgICAgICogc3RhY2ssIHdoaWNoIGltcG9zZSBwZXJ2YXNpdmUgcnVudGltZSAiR2V0
VmFsdWUiIGNvc3RzLgotICAgICAgICAgKi8KLSAgICAgICAgcG4yID0gcG4tPnBuX2xlZnQ7Ci0g
ICAgICAgIGF0b21JbmRleCA9IChqc2F0b21pZCkgLTE7ICAgICAgICAgICAgICAvKiBxdWVsbCBH
Q0Mgb3Zlcndhcm5pbmcgKi8KLSAgICAgICAgc3dpdGNoIChQTl9UWVBFKHBuMikpIHsKLSAgICAg
ICAgICBjYXNlIFRPS19OQU1FOgotICAgICAgICAgICAgaWYgKCFCaW5kTmFtZVRvU2xvdChjeCwg
Y2csIHBuMikpCi0gICAgICAgICAgICAgICAgcmV0dXJuIEpTX0ZBTFNFOwotICAgICAgICAgICAg
aWYgKCFwbjItPnBuX2Nvb2tpZS5pc0ZyZWUoKSkgewotICAgICAgICAgICAgICAgIGF0b21JbmRl
eCA9IChqc2F0b21pZCkgcG4yLT5wbl9jb29raWUuYXNJbnRlZ2VyKCk7Ci0gICAgICAgICAgICB9
IGVsc2UgewotICAgICAgICAgICAgICAgIGFsZSA9IGNnLT5hdG9tTGlzdC5hZGQoY2ctPnBhcnNl
ciwgcG4yLT5wbl9hdG9tKTsKLSAgICAgICAgICAgICAgICBpZiAoIWFsZSkKLSAgICAgICAgICAg
ICAgICAgICAgcmV0dXJuIEpTX0ZBTFNFOwotICAgICAgICAgICAgICAgIGF0b21JbmRleCA9IEFM
RV9JTkRFWChhbGUpOwotICAgICAgICAgICAgICAgIGlmICghcG4yLT5pc0NvbnN0KCkpIHsKLSAg
ICAgICAgICAgICAgICAgICAgSlNPcCBvcCA9IFBOX09QKHBuMikgPT0gSlNPUF9TRVRHTkFNRSA/
IEpTT1BfQklOREdOQU1FIDogSlNPUF9CSU5ETkFNRTsKLSAgICAgICAgICAgICAgICAgICAgRU1J
VF9JTkRFWF9PUChvcCwgYXRvbUluZGV4KTsKLSAgICAgICAgICAgICAgICB9Ci0gICAgICAgICAg
ICB9Ci0gICAgICAgICAgICBicmVhazsKLSAgICAgICAgICBjYXNlIFRPS19ET1Q6Ci0gICAgICAg
ICAgICBpZiAoIWpzX0VtaXRUcmVlKGN4LCBjZywgcG4yLT5leHByKCkpKQotICAgICAgICAgICAg
ICAgIHJldHVybiBKU19GQUxTRTsKLSAgICAgICAgICAgIGFsZSA9IGNnLT5hdG9tTGlzdC5hZGQo
Y2ctPnBhcnNlciwgcG4yLT5wbl9hdG9tKTsKLSAgICAgICAgICAgIGlmICghYWxlKQotICAgICAg
ICAgICAgICAgIHJldHVybiBKU19GQUxTRTsKLSAgICAgICAgICAgIGF0b21JbmRleCA9IEFMRV9J
TkRFWChhbGUpOwotICAgICAgICAgICAgYnJlYWs7Ci0gICAgICAgICAgY2FzZSBUT0tfTEI6Ci0g
ICAgICAgICAgICBKU19BU1NFUlQocG4yLT5wbl9hcml0eSA9PSBQTl9CSU5BUlkpOwotICAgICAg
ICAgICAgaWYgKCFqc19FbWl0VHJlZShjeCwgY2csIHBuMi0+cG5fbGVmdCkpCi0gICAgICAgICAg
ICAgICAgcmV0dXJuIEpTX0ZBTFNFOwotICAgICAgICAgICAgaWYgKCFqc19FbWl0VHJlZShjeCwg
Y2csIHBuMi0+cG5fcmlnaHQpKQotICAgICAgICAgICAgICAgIHJldHVybiBKU19GQUxTRTsKLSAg
ICAgICAgICAgIGJyZWFrOwotI2lmIEpTX0hBU19ERVNUUlVDVFVSSU5HCi0gICAgICAgICAgY2Fz
ZSBUT0tfUkI6Ci0gICAgICAgICAgY2FzZSBUT0tfUkM6Ci0gICAgICAgICAgICBicmVhazsKLSNl
bmRpZgotICAgICAgICAgIGNhc2UgVE9LX0xQOgotICAgICAgICAgICAgaWYgKCFqc19FbWl0VHJl
ZShjeCwgY2csIHBuMikpCi0gICAgICAgICAgICAgICAgcmV0dXJuIEpTX0ZBTFNFOwotICAgICAg
ICAgICAgYnJlYWs7Ci0jaWYgSlNfSEFTX1hNTF9TVVBQT1JUCi0gICAgICAgICAgY2FzZSBUT0tf
VU5BUllPUDoKLSAgICAgICAgICAgIEpTX0FTU0VSVChwbjItPnBuX29wID09IEpTT1BfU0VUWE1M
TkFNRSk7Ci0gICAgICAgICAgICBpZiAoIWpzX0VtaXRUcmVlKGN4LCBjZywgcG4yLT5wbl9raWQp
KQotICAgICAgICAgICAgICAgIHJldHVybiBKU19GQUxTRTsKLSAgICAgICAgICAgIGlmIChqc19F
bWl0MShjeCwgY2csIEpTT1BfQklORFhNTE5BTUUpIDwgMCkKLSAgICAgICAgICAgICAgICByZXR1
cm4gSlNfRkFMU0U7Ci0gICAgICAgICAgICBicmVhazsKLSNlbmRpZgotICAgICAgICAgIGRlZmF1
bHQ6Ci0gICAgICAgICAgICBKU19BU1NFUlQoMCk7Ci0gICAgICAgIH0KLQotICAgICAgICBvcCA9
IFBOX09QKHBuKTsKLSAgICAgICAgaWYgKG9wICE9IEpTT1BfTk9QKSB7Ci0gICAgICAgICAgICBz
d2l0Y2ggKHBuMi0+cG5fdHlwZSkgewotICAgICAgICAgICAgICBjYXNlIFRPS19OQU1FOgotICAg
ICAgICAgICAgICAgIGlmIChwbjItPmlzQ29uc3QoKSkgewotICAgICAgICAgICAgICAgICAgICBp
ZiAoUE5fT1AocG4yKSA9PSBKU09QX0NBTExFRSkgewotICAgICAgICAgICAgICAgICAgICAgICAg
aWYgKGpzX0VtaXQxKGN4LCBjZywgSlNPUF9DQUxMRUUpIDwgMCkKLSAgICAgICAgICAgICAgICAg
ICAgICAgICAgICByZXR1cm4gSlNfRkFMU0U7Ci0gICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7
Ci0gICAgICAgICAgICAgICAgICAgICAgICBFTUlUX0lOREVYX09QKFBOX09QKHBuMiksIGF0b21J
bmRleCk7Ci0gICAgICAgICAgICAgICAgICAgIH0KLSAgICAgICAgICAgICAgICB9IGVsc2UgaWYg
KFBOX09QKHBuMikgPT0gSlNPUF9TRVROQU1FKSB7Ci0gICAgICAgICAgICAgICAgICAgIGlmIChq
c19FbWl0MShjeCwgY2csIEpTT1BfRFVQKSA8IDApCi0gICAgICAgICAgICAgICAgICAgICAgICBy
ZXR1cm4gSlNfRkFMU0U7Ci0gICAgICAgICAgICAgICAgICAgIEVNSVRfSU5ERVhfT1AoSlNPUF9H
RVRYUFJPUCwgYXRvbUluZGV4KTsKLSAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKFBOX09QKHBu
MikgPT0gSlNPUF9TRVRHTkFNRSkgewotICAgICAgICAgICAgICAgICAgICBpZiAoIUJpbmRHbG9i
YWwoY3gsIGNnLCBwbjIsIHBuMi0+cG5fYXRvbSkpCi0gICAgICAgICAgICAgICAgICAgICAgICBy
ZXR1cm4gSlNfRkFMU0U7Ci0gICAgICAgICAgICAgICAgICAgIGlmIChwbjItPnBuX2Nvb2tpZS5p
c0ZyZWUoKSkKLSAgICAgICAgICAgICAgICAgICAgICAgIEVtaXRBdG9tT3AoY3gsIHBuMiwgSlNP
UF9HRVRHTkFNRSwgY2cpOwotICAgICAgICAgICAgICAgICAgICBlbHNlCi0gICAgICAgICAgICAg
ICAgICAgICAgICBFTUlUX1VJTlQxNl9JTU1fT1AoSlNPUF9HRVRHTE9CQUwsIHBuMi0+cG5fY29v
a2llLmFzSW50ZWdlcigpKTsKLSAgICAgICAgICAgICAgICB9IGVsc2UgewotICAgICAgICAgICAg
ICAgICAgICBFTUlUX1VJTlQxNl9JTU1fT1AoKFBOX09QKHBuMikgPT0gSlNPUF9TRVRBUkcpCi0g
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA/IEpTT1BfR0VUQVJHCi0gICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA6IEpTT1BfR0VUTE9DQUwsCi0gICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhdG9tSW5kZXgpOwotICAgICAgICAg
ICAgICAgIH0KLSAgICAgICAgICAgICAgICBicmVhazsKLSAgICAgICAgICAgICAgY2FzZSBUT0tf
RE9UOgotICAgICAgICAgICAgICAgIGlmIChqc19FbWl0MShjeCwgY2csIEpTT1BfRFVQKSA8IDAp
Ci0gICAgICAgICAgICAgICAgICAgIHJldHVybiBKU19GQUxTRTsKLSAgICAgICAgICAgICAgICBp
ZiAocG4yLT5wbl9hdG9tID09IGN4LT5ydW50aW1lLT5hdG9tU3RhdGUubGVuZ3RoQXRvbSkgewot
ICAgICAgICAgICAgICAgICAgICBpZiAoanNfRW1pdDEoY3gsIGNnLCBKU09QX0xFTkdUSCkgPCAw
KQotICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIEpTX0ZBTFNFOwotICAgICAgICAgICAg
ICAgIH0gZWxzZSBpZiAocG4yLT5wbl9hdG9tID09IGN4LT5ydW50aW1lLT5hdG9tU3RhdGUucHJv
dG9BdG9tKSB7Ci0gICAgICAgICAgICAgICAgICAgIGlmICghRW1pdEluZGV4T3AoY3gsIEpTT1Bf
UU5BTUVQQVJULCBhdG9tSW5kZXgsIGNnKSkKLSAgICAgICAgICAgICAgICAgICAgICAgIHJldHVy
biBKU19GQUxTRTsKLSAgICAgICAgICAgICAgICAgICAgaWYgKGpzX0VtaXQxKGN4LCBjZywgSlNP
UF9HRVRFTEVNKSA8IDApCi0gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gSlNfRkFMU0U7
Ci0gICAgICAgICAgICAgICAgfSBlbHNlIHsKLSAgICAgICAgICAgICAgICAgICAgRU1JVF9JTkRF
WF9PUChKU09QX0dFVFBST1AsIGF0b21JbmRleCk7Ci0gICAgICAgICAgICAgICAgfQotICAgICAg
ICAgICAgICAgIGJyZWFrOwotICAgICAgICAgICAgICBjYXNlIFRPS19MQjoKLSAgICAgICAgICAg
ICAgY2FzZSBUT0tfTFA6Ci0jaWYgSlNfSEFTX1hNTF9TVVBQT1JUCi0gICAgICAgICAgICAgIGNh
c2UgVE9LX1VOQVJZT1A6Ci0jZW5kaWYKLSAgICAgICAgICAgICAgICBpZiAoanNfRW1pdDEoY3gs
IGNnLCBKU09QX0RVUDIpIDwgMCkKLSAgICAgICAgICAgICAgICAgICAgcmV0dXJuIEpTX0ZBTFNF
OwotICAgICAgICAgICAgICAgIGlmIChqc19FbWl0MShjeCwgY2csIEpTT1BfR0VURUxFTSkgPCAw
KQotICAgICAgICAgICAgICAgICAgICByZXR1cm4gSlNfRkFMU0U7Ci0gICAgICAgICAgICAgICAg
YnJlYWs7Ci0gICAgICAgICAgICAgIGRlZmF1bHQ6OwotICAgICAgICAgICAgfQotICAgICAgICB9
Ci0KLSAgICAgICAgLyogTm93IGVtaXQgdGhlIHJpZ2h0IG9wZXJhbmQgKGl0IG1heSBhZmZlY3Qg
dGhlIG5hbWVzcGFjZSkuICovCi0gICAgICAgIGlmICghanNfRW1pdFRyZWUoY3gsIGNnLCBwbi0+
cG5fcmlnaHQpKQotICAgICAgICAgICAgcmV0dXJuIEpTX0ZBTFNFOwotCi0gICAgICAgIC8qIElm
ICs9IGV0Yy4sIGVtaXQgdGhlIGJpbmFyeSBvcGVyYXRvciB3aXRoIGEgZGVjb21waWxlciBub3Rl
LiAqLwotICAgICAgICBpZiAob3AgIT0gSlNPUF9OT1ApIHsKLSAgICAgICAgICAgIC8qCi0gICAg
ICAgICAgICAgKiBUYWtlIGNhcmUgdG8gYXZvaWQgU1JDX0FTU0lHTk9QIGlmIHRoZSBsZWZ0LWhh
bmQgc2lkZSBpcyBhIGNvbnN0Ci0gICAgICAgICAgICAgKiBkZWNsYXJlZCBpbiB0aGUgY3VycmVu
dCBjb21waWxhdGlvbiB1bml0LCBhcyBpbiB0aGlzIGNhc2UgKGp1c3QKLSAgICAgICAgICAgICAq
IGEgYml0IGZ1cnRoZXIgYmVsb3cpIHdlIHdpbGwgYXZvaWQgZW1pdHRpbmcgdGhlIGFzc2lnbm1l
bnQgb3AuCi0gICAgICAgICAgICAgKi8KLSAgICAgICAgICAgIGlmIChwbjItPnBuX3R5cGUgIT0g
VE9LX05BTUUgfHwgIXBuMi0+aXNDb25zdCgpKSB7Ci0gICAgICAgICAgICAgICAgaWYgKGpzX05l
d1NyY05vdGUoY3gsIGNnLCBTUkNfQVNTSUdOT1ApIDwgMCkKLSAgICAgICAgICAgICAgICAgICAg
cmV0dXJuIEpTX0ZBTFNFOwotICAgICAgICAgICAgfQotICAgICAgICAgICAgaWYgKGpzX0VtaXQx
KGN4LCBjZywgb3ApIDwgMCkKLSAgICAgICAgICAgICAgICByZXR1cm4gSlNfRkFMU0U7Ci0gICAg
ICAgIH0KLQotICAgICAgICAvKiBMZWZ0IHBhcnRzIHN1Y2ggYXMgYS5iLmMgYW5kIGFbYl0uYyBu
ZWVkIGEgZGVjb21waWxlciBub3RlLiAqLwotICAgICAgICBpZiAocG4yLT5wbl90eXBlICE9IFRP
S19OQU1FICYmCi0jaWYgSlNfSEFTX0RFU1RSVUNUVVJJTkcKLSAgICAgICAgICAgIHBuMi0+cG5f
dHlwZSAhPSBUT0tfUkIgJiYKLSAgICAgICAgICAgIHBuMi0+cG5fdHlwZSAhPSBUT0tfUkMgJiYK
LSNlbmRpZgotICAgICAgICAgICAganNfTmV3U3JjTm90ZTIoY3gsIGNnLCBTUkNfUENCQVNFLCBD
R19PRkZTRVQoY2cpIC0gdG9wKSA8IDApIHsKLSAgICAgICAgICAgIHJldHVybiBKU19GQUxTRTsK
LSAgICAgICAgfQotCi0gICAgICAgIC8qIEZpbmFsbHksIGVtaXQgdGhlIHNwZWNpYWxpemVkIGFz
c2lnbm1lbnQgYnl0ZWNvZGUuICovCi0gICAgICAgIHN3aXRjaCAocG4yLT5wbl90eXBlKSB7Ci0g
ICAgICAgICAgY2FzZSBUT0tfTkFNRToKLSAgICAgICAgICAgIGlmIChwbjItPmlzQ29uc3QoKSkK
LSAgICAgICAgICAgICAgICBicmVhazsKLSAgICAgICAgICAgIC8qIEZBTEwgVEhST1VHSCAqLwot
ICAgICAgICAgIGNhc2UgVE9LX0RPVDoKLSAgICAgICAgICAgIEVNSVRfSU5ERVhfT1AoUE5fT1Ao
cG4yKSwgYXRvbUluZGV4KTsKLSAgICAgICAgICAgIGJyZWFrOwotICAgICAgICAgIGNhc2UgVE9L
X0xCOgotICAgICAgICAgIGNhc2UgVE9LX0xQOgotICAgICAgICAgICAgaWYgKGpzX0VtaXQxKGN4
LCBjZywgSlNPUF9TRVRFTEVNKSA8IDApCi0gICAgICAgICAgICAgICAgcmV0dXJuIEpTX0ZBTFNF
OwotICAgICAgICAgICAgYnJlYWs7Ci0jaWYgSlNfSEFTX0RFU1RSVUNUVVJJTkcKLSAgICAgICAg
ICBjYXNlIFRPS19SQjoKLSAgICAgICAgICBjYXNlIFRPS19SQzoKLSAgICAgICAgICAgIGlmICgh
RW1pdERlc3RydWN0dXJpbmdPcHMoY3gsIGNnLCBKU09QX1NFVE5BTUUsIHBuMikpCi0gICAgICAg
ICAgICAgICAgcmV0dXJuIEpTX0ZBTFNFOwotICAgICAgICAgICAgYnJlYWs7Ci0jZW5kaWYKLSNp
ZiBKU19IQVNfWE1MX1NVUFBPUlQKLSAgICAgICAgICBjYXNlIFRPS19VTkFSWU9QOgotICAgICAg
ICAgICAgaWYgKGpzX0VtaXQxKGN4LCBjZywgSlNPUF9TRVRYTUxOQU1FKSA8IDApCi0gICAgICAg
ICAgICAgICAgcmV0dXJuIEpTX0ZBTFNFOwotICAgICAgICAgICAgYnJlYWs7Ci0jZW5kaWYKLSAg
ICAgICAgICBkZWZhdWx0OgotICAgICAgICAgICAgSlNfQVNTRVJUKDApOwotICAgICAgICB9Cisg
ICAgICAgIGlmICghRW1pdEFzc2lnbm1lbnQoY3gsIGNnLCBwbi0+cG5fbGVmdCwgUE5fT1AocG4p
LCBwbi0+cG5fcmlnaHQpKQorICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgICBicmVh
azsKIAogICAgICAgY2FzZSBUT0tfSE9PSzoKICAgICAgICAgLyogRW1pdCB0aGUgY29uZGl0aW9u
LCB0aGVuIGJyYW5jaCBpZiBmYWxzZSB0byB0aGUgZWxzZSBwYXJ0LiAqLwogICAgICAgICBpZiAo
IWpzX0VtaXRUcmVlKGN4LCBjZywgcG4tPnBuX2tpZDEpKQogICAgICAgICAgICAgcmV0dXJuIEpT
X0ZBTFNFOwogICAgICAgICBub3RlSW5kZXggPSBqc19OZXdTcmNOb3RlKGN4LCBjZywgU1JDX0NP
TkQpOwogICAgICAgICBpZiAobm90ZUluZGV4IDwgMCkKZGlmZiAtLWdpdCBhL2pzL3NyYy9qc2lu
dGVycC5jcHAgYi9qcy9zcmMvanNpbnRlcnAuY3BwCi0tLSBhL2pzL3NyYy9qc2ludGVycC5jcHAK
KysrIGIvanMvc3JjL2pzaW50ZXJwLmNwcApAQCAtMzE0NiwxMDUgKzMxNDYsMzcgQEAgQkVHSU5f
Q0FTRShKU09QX01PUkVJVEVSKQogICAgIGJvb2wgY29uZDsKICAgICBpZiAoIUl0ZXJhdG9yTW9y
ZShjeCwgJnJlZ3Muc3BbLTJdLnRvT2JqZWN0KCksICZjb25kLCAmcmVncy5zcFstMV0pKQogICAg
ICAgICBnb3RvIGVycm9yOwogICAgIENIRUNLX0lOVEVSUlVQVF9IQU5ETEVSKCk7CiAgICAgcmVn
cy5zcFstMV0uc2V0Qm9vbGVhbihjb25kKTsKIH0KIEVORF9DQVNFKEpTT1BfTU9SRUlURVIpCiAK
K0JFR0lOX0NBU0UoSlNPUF9JVEVSTkVYVCkKK3sKKyAgICBWYWx1ZSAqaXRlcnZwID0gcmVncy5z
cCAtIEdFVF9JTlQ4KHJlZ3MucGMpOworICAgIEpTX0FTU0VSVChpdGVydnAgPj0gcmVncy5mcC0+
YmFzZSgpKTsKKyAgICBKU19BU1NFUlQoaXRlcnZwLT5pc09iamVjdCgpKTsKKyAgICBQVVNIX05V
TEwoKTsKKyAgICBpZiAoIUl0ZXJhdG9yTmV4dChjeCwgJml0ZXJ2cC0+dG9PYmplY3QoKSwgJnJl
Z3Muc3BbLTFdKSkKKyAgICAgICAgZ290byBlcnJvcjsKK30KK0VORF9DQVNFKEpTT1BfSVRFUk5F
WFQpCisKIEJFR0lOX0NBU0UoSlNPUF9FTkRJVEVSKQogewogICAgIEpTX0FTU0VSVChyZWdzLnNw
IC0gMSA+PSByZWdzLmZwLT5iYXNlKCkpOwogICAgIGJvb2wgb2sgPSAhIWpzX0Nsb3NlSXRlcmF0
b3IoY3gsICZyZWdzLnNwWy0xXS50b09iamVjdCgpKTsKICAgICByZWdzLnNwLS07CiAgICAgaWYg
KCFvaykKICAgICAgICAgZ290byBlcnJvcjsKIH0KIEVORF9DQVNFKEpTT1BfRU5ESVRFUikKIAot
QkVHSU5fQ0FTRShKU09QX0ZPUkFSRykKLXsKLSAgICBKU19BU1NFUlQocmVncy5zcCAtIDEgPj0g
cmVncy5mcC0+YmFzZSgpKTsKLSAgICB1aW50TiBzbG90ID0gR0VUX0FSR05PKHJlZ3MucGMpOwot
ICAgIEpTX0FTU0VSVChzbG90IDwgcmVncy5mcC0+bnVtRm9ybWFsQXJncygpKTsKLSAgICBKU19B
U1NFUlQocmVncy5zcFstMV0uaXNPYmplY3QoKSk7Ci0gICAgaWYgKCFJdGVyYXRvck5leHQoY3gs
ICZyZWdzLnNwWy0xXS50b09iamVjdCgpLCAmYXJndltzbG90XSkpCi0gICAgICAgIGdvdG8gZXJy
b3I7Ci19Ci1FTkRfQ0FTRShKU09QX0ZPUkFSRykKLQotQkVHSU5fQ0FTRShKU09QX0ZPUkxPQ0FM
KQotewotICAgIEpTX0FTU0VSVChyZWdzLnNwIC0gMSA+PSByZWdzLmZwLT5iYXNlKCkpOwotICAg
IHVpbnROIHNsb3QgPSBHRVRfU0xPVE5PKHJlZ3MucGMpOwotICAgIEpTX0FTU0VSVChzbG90IDwg
cmVncy5mcC0+bnVtU2xvdHMoKSk7Ci0gICAgSlNfQVNTRVJUKHJlZ3Muc3BbLTFdLmlzT2JqZWN0
KCkpOwotICAgIGlmICghSXRlcmF0b3JOZXh0KGN4LCAmcmVncy5zcFstMV0udG9PYmplY3QoKSwg
JnJlZ3MuZnAtPnNsb3RzKClbc2xvdF0pKQotICAgICAgICBnb3RvIGVycm9yOwotfQotRU5EX0NB
U0UoSlNPUF9GT1JMT0NBTCkKLQotQkVHSU5fQ0FTRShKU09QX0ZPUk5BTUUpCi1CRUdJTl9DQVNF
KEpTT1BfRk9SR05BTUUpCi17Ci0gICAgSlNfQVNTRVJUKHJlZ3Muc3AgLSAxID49IHJlZ3MuZnAt
PmJhc2UoKSk7Ci0gICAgSlNBdG9tICphdG9tOwotICAgIExPQURfQVRPTSgwLCBhdG9tKTsKLSAg
ICBqc2lkIGlkID0gQVRPTV9UT19KU0lEKGF0b20pOwotICAgIEpTT2JqZWN0ICpvYmosICpvYmoy
OwotICAgIEpTUHJvcGVydHkgKnByb3A7Ci0gICAgaWYgKCFqc19GaW5kUHJvcGVydHkoY3gsIGlk
LCAmb2JqLCAmb2JqMiwgJnByb3ApKQotICAgICAgICBnb3RvIGVycm9yOwotCi0gICAgewotICAg
ICAgICBBdXRvVmFsdWVSb290ZXIgdHZyKGN4KTsKLSAgICAgICAgSlNfQVNTRVJUKHJlZ3Muc3Bb
LTFdLmlzT2JqZWN0KCkpOwotICAgICAgICBpZiAoIUl0ZXJhdG9yTmV4dChjeCwgJnJlZ3Muc3Bb
LTFdLnRvT2JqZWN0KCksIHR2ci5hZGRyKCkpKQotICAgICAgICAgICAgZ290byBlcnJvcjsKLSAg
ICAgICAgaWYgKCFvYmotPnNldFByb3BlcnR5KGN4LCBpZCwgdHZyLmFkZHIoKSwgc2NyaXB0LT5z
dHJpY3RNb2RlQ29kZSkpCi0gICAgICAgICAgICBnb3RvIGVycm9yOwotICAgIH0KLX0KLUVORF9D
QVNFKEpTT1BfRk9STkFNRSkKLQotQkVHSU5fQ0FTRShKU09QX0ZPUlBST1ApCi17Ci0gICAgSlNf
QVNTRVJUKHJlZ3Muc3AgLSAyID49IHJlZ3MuZnAtPmJhc2UoKSk7Ci0gICAgSlNBdG9tICphdG9t
OwotICAgIExPQURfQVRPTSgwLCBhdG9tKTsKLSAgICBqc2lkIGlkID0gQVRPTV9UT19KU0lEKGF0
b20pOwotICAgIEpTT2JqZWN0ICpvYmo7Ci0gICAgRkVUQ0hfT0JKRUNUKGN4LCAtMSwgb2JqKTsK
LSAgICB7Ci0gICAgICAgIEF1dG9WYWx1ZVJvb3RlciB0dnIoY3gpOwotICAgICAgICBKU19BU1NF
UlQocmVncy5zcFstMl0uaXNPYmplY3QoKSk7Ci0gICAgICAgIGlmICghSXRlcmF0b3JOZXh0KGN4
LCAmcmVncy5zcFstMl0udG9PYmplY3QoKSwgdHZyLmFkZHIoKSkpCi0gICAgICAgICAgICBnb3Rv
IGVycm9yOwotICAgICAgICBpZiAoIW9iai0+c2V0UHJvcGVydHkoY3gsIGlkLCB0dnIuYWRkcigp
LCBzY3JpcHQtPnN0cmljdE1vZGVDb2RlKSkKLSAgICAgICAgICAgIGdvdG8gZXJyb3I7Ci0gICAg
fQotICAgIHJlZ3Muc3AtLTsKLX0KLUVORF9DQVNFKEpTT1BfRk9SUFJPUCkKLQotQkVHSU5fQ0FT
RShKU09QX0ZPUkVMRU0pCi0gICAgLyoKLSAgICAgKiBKU09QX0ZPUkVMRU0gc2ltcGx5IGR1cHMg
dGhlIHByb3BlcnR5IGlkZW50aWZpZXIgYXQgdG9wIG9mIHN0YWNrIGFuZAotICAgICAqIGxldHMg
dGhlIHN1YnNlcXVlbnQgSlNPUF9FTlVNRUxFTSBvcGNvZGUgc2VxdWVuY2UgaGFuZGxlIHRoZSBs
ZWZ0LWhhbmQKLSAgICAgKiBzaWRlIGV4cHJlc3Npb24gZXZhbHVhdGlvbiBhbmQgYXNzaWdubWVu
dC4gVGhpcyBvcGNvZGUgZXhpc3RzIHNvbGVseSB0bwotICAgICAqIGhlbHAgdGhlIGRlY29tcGls
ZXIuCi0gICAgICovCi0gICAgSlNfQVNTRVJUKHJlZ3Muc3AgLSAxID49IHJlZ3MuZnAtPmJhc2Uo
KSk7Ci0gICAgSlNfQVNTRVJUKHJlZ3Muc3BbLTFdLmlzT2JqZWN0KCkpOwotICAgIFBVU0hfTlVM
TCgpOwotICAgIGlmICghSXRlcmF0b3JOZXh0KGN4LCAmcmVncy5zcFstMl0udG9PYmplY3QoKSwg
JnJlZ3Muc3BbLTFdKSkKLSAgICAgICAgZ290byBlcnJvcjsKLUVORF9DQVNFKEpTT1BfRk9SRUxF
TSkKLQogQkVHSU5fQ0FTRShKU09QX0RVUCkKIHsKICAgICBKU19BU1NFUlQocmVncy5zcCA+IHJl
Z3MuZnAtPmJhc2UoKSk7CiAgICAgY29uc3QgVmFsdWUgJnJyZWYgPSByZWdzLnNwWy0xXTsKICAg
ICBQVVNIX0NPUFkocnJlZik7CiB9CiBFTkRfQ0FTRShKU09QX0RVUCkKIApAQCAtNjYxNywxNiAr
NjU0OSwyMCBAQCBCRUdJTl9DQVNFKEpTT1BfQVJSQVlQVVNIKQogICAgIGlmICghanNfQXJyYXlD
b21wUHVzaChjeCwgb2JqLCByZWdzLnNwWy0xXSkpCiAgICAgICAgIGdvdG8gZXJyb3I7CiAgICAg
cmVncy5zcC0tOwogfQogRU5EX0NBU0UoSlNPUF9BUlJBWVBVU0gpCiAjZW5kaWYgLyogSlNfSEFT
X0dFTkVSQVRPUlMgKi8KIAogI2lmIEpTX1RIUkVBREVEX0lOVEVSUAorICBMX0pTT1BfVU5VU0VE
MTE6CisgIExfSlNPUF9VTlVTRUQxMDY6CisgIExfSlNPUF9VTlVTRUQxMDc6CisgIExfSlNPUF9V
TlVTRUQxMDg6CiAgIExfSlNPUF9CQUNLUEFUQ0g6CiAgIExfSlNPUF9CQUNLUEFUQ0hfUE9QOgog
CiAjIGlmICFKU19IQVNfR0VORVJBVE9SUwogICBMX0pTT1BfR0VORVJBVE9SOgogICBMX0pTT1Bf
WUlFTEQ6CiAgIExfSlNPUF9BUlJBWVBVU0g6CiAjIGVuZGlmCmRpZmYgLS1naXQgYS9qcy9zcmMv
anNvcGNvZGUuY3BwIGIvanMvc3JjL2pzb3Bjb2RlLmNwcAotLS0gYS9qcy9zcmMvanNvcGNvZGUu
Y3BwCisrKyBiL2pzL3NyYy9qc29wY29kZS5jcHAKQEAgLTMwNTIsNDQgKzMwNTIsNDEgQEAgRGVj
b21waWxlKFNwcmludFN0YWNrICpzcywganNieXRlY29kZSAqcAogCiAjaWYgSlNfSEFTX0dFTkVS
QVRPUl9FWFBSUwogICAgICAgICAgICAgICAgIExPQ0FMX0FTU0VSVChTTl9UWVBFKHNuKSA9PSBT
UkNfSElEREVOKTsKICAgICAgICAgICAgICAgICAvKiBGQUxMIFRIUk9VR0ggKi8KICNlbmRpZgog
CiAgICAgICAgICAgICAgIGNhc2UgSlNPUF9BUlJBWVBVU0g6CiAgICAgICAgICAgICAgIHsKLSAg
ICAgICAgICAgICAgICB1aW50TiBwb3MsIGZvcnBvczsKLSAgICAgICAgICAgICAgICBwdHJkaWZm
X3Qgc3RhcnQ7Ci0KICAgICAgICAgICAgICAgICAvKiBUdXJuIG9mZiBtb3N0IHBhcmVucy4gKi8K
ICAgICAgICAgICAgICAgICBvcCA9IEpTT1BfU0VUTkFNRTsKIAogICAgICAgICAgICAgICAgIC8q
IFBvcCB0aGUgZXhwcmVzc2lvbiBiZWluZyBwdXNoZWQgb3IgeWllbGRlZC4gKi8KICAgICAgICAg
ICAgICAgICBydmFsID0gUE9QX1NUUigpOwogCiAgICAgICAgICAgICAgICAgLyoKLSAgICAgICAg
ICAgICAgICAgKiBTa2lwIHRoZSBmb3IgbG9vcCBoZWFkIHN0YWNrZWQgYnkgSlNPUF9GT1JMT0NB
TCB1bnRpbCB3ZSBoaXQKLSAgICAgICAgICAgICAgICAgKiBhIGJsb2NrIGxvY2FsIHNsb3QgKG5v
dGUgZW1wdHkgZGVzdHJ1Y3R1cmluZyBwYXR0ZXJucyByZXN1bHQKLSAgICAgICAgICAgICAgICAg
KiBpbiB1bml0LWNvdW50IGJsb2NrcykuCisgICAgICAgICAgICAgICAgICogU2tpcCB0aGUgZm9y
IGxvb3AgaGVhZCBzdGFja2VkIGJ5IEpTT1BfR09UTzpTUkNfRk9SX0lOIHVudGlsCisgICAgICAg
ICAgICAgICAgICogd2UgaGl0IGEgYmxvY2sgbG9jYWwgc2xvdCAobm90ZSBlbXB0eSBkZXN0cnVj
dHVyaW5nIHBhdHRlcm5zCisgICAgICAgICAgICAgICAgICogcmVzdWx0IGluIHVuaXQtY291bnQg
YmxvY2tzKS4KICAgICAgICAgICAgICAgICAgKi8KLSAgICAgICAgICAgICAgICBwb3MgPSBzcy0+
dG9wOworICAgICAgICAgICAgICAgIHVpbnROIHBvcyA9IHNzLT50b3A7CiAgICAgICAgICAgICAg
ICAgd2hpbGUgKHBvcyAhPSAwKSB7CiAgICAgICAgICAgICAgICAgICAgIG9wID0gKEpTT3ApIHNz
LT5vcGNvZGVzWy0tcG9zXTsKICAgICAgICAgICAgICAgICAgICAgaWYgKG9wID09IEpTT1BfRU5U
RVJCTE9DSykKICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAg
IH0KICAgICAgICAgICAgICAgICBKU19BU1NFUlQob3AgPT0gSlNPUF9FTlRFUkJMT0NLKTsKIAog
ICAgICAgICAgICAgICAgIC8qCiAgICAgICAgICAgICAgICAgICogSGVyZSwgZm9ycG9zIG11c3Qg
aW5kZXggdGhlIHNwYWNlIGJlZm9yZSB0aGUgbGVmdC1tb3N0IHxmb3J8CiAgICAgICAgICAgICAg
ICAgICogaW4gdGhlIHNpbmdsZSBzdHJpbmcgb2YgYWNjdW11bGF0ZWQgfGZvcnwgaGVhZHMgYW5k
IG9wdGlvbmFsCiAgICAgICAgICAgICAgICAgICogZmluYWwgfGlmIChjb25kaXRpb24pfC4KICAg
ICAgICAgICAgICAgICAgKi8KLSAgICAgICAgICAgICAgICBmb3Jwb3MgPSBwb3MgKyAxOworICAg
ICAgICAgICAgICAgIHVpbnROIGZvcnBvcyA9IHBvcyArIDE7CiAgICAgICAgICAgICAgICAgTE9D
QUxfQVNTRVJUKGZvcnBvcyA8IHNzLT50b3ApOwogCiAgICAgICAgICAgICAgICAgLyoKICAgICAg
ICAgICAgICAgICAgKiBOb3cgbW92ZSBwb3MgZG93bndhcmQgb3ZlciB0aGUgYmxvY2sncyBsb2Nh
bCBzbG90cy4gRXZlbiBhbgogICAgICAgICAgICAgICAgICAqIGVtcHR5IGRlc3RydWN0dXJpbmcg
cGF0dGVybiBoYXMgb25lIChkdW1teSkgbG9jYWwuCiAgICAgICAgICAgICAgICAgICovCiAgICAg
ICAgICAgICAgICAgd2hpbGUgKHNzLT5vcGNvZGVzW3Bvc10gPT0gSlNPUF9FTlRFUkJMT0NLKSB7
CiAgICAgICAgICAgICAgICAgICAgIGlmIChwb3MgPT0gMCkKQEAgLTMxMjEsMTcgKzMxMTgsMTcg
QEAgRGVjb21waWxlKFNwcmludFN0YWNrICpzcywganNieXRlY29kZSAqcAogCiAgICAgICAgICAg
ICAgICAgLyoKICAgICAgICAgICAgICAgICAgKiBBcnJheSBjb21wcmVoZW5zaW9uOiByZXRyYWN0
IHRoZSBzcHJpbnRlciB0byB0aGUgYmVnaW5uaW5nCiAgICAgICAgICAgICAgICAgICogb2YgdGhl
IGFycmF5IGluaXRpYWxpc2VyIGFuZCBkZWNvbXBpbGUgIls8cnZhbD4gZm9yIC4uLl0iLgogICAg
ICAgICAgICAgICAgICAqLwogICAgICAgICAgICAgICAgIEpTX0FTU0VSVChqcC0+c2NyaXB0LT5u
Zml4ZWQgKyBwb3MgPT0gR0VUX1VJTlQxNihwYykpOwogICAgICAgICAgICAgICAgIExPQ0FMX0FT
U0VSVChzcy0+b3Bjb2Rlc1twb3NdID09IEpTT1BfTkVXSU5JVCk7CiAKLSAgICAgICAgICAgICAg
ICBzdGFydCA9IHNzLT5vZmZzZXRzW3Bvc107CisgICAgICAgICAgICAgICAgcHRyZGlmZl90IHN0
YXJ0ID0gc3MtPm9mZnNldHNbcG9zXTsKICAgICAgICAgICAgICAgICBMT0NBTF9BU1NFUlQoc3Mt
PnNwcmludGVyLmJhc2Vbc3RhcnRdID09ICdbJyB8fAogICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICBzcy0+c3ByaW50ZXIuYmFzZVtzdGFydF0gPT0gJyMnKTsKICAgICAgICAgICAgICAgICBM
T0NBTF9BU1NFUlQoZm9ycG9zIDwgc3MtPnRvcCk7CiAgICAgICAgICAgICAgICAgeHZhbCA9IE9G
RjJTVFIoJnNzLT5zcHJpbnRlciwgc3MtPm9mZnNldHNbZm9ycG9zXSk7CiAgICAgICAgICAgICAg
ICAgbHZhbCA9IE9GRjJTVFIoJnNzLT5zcHJpbnRlciwgc3RhcnQpOwogICAgICAgICAgICAgICAg
IFJFVFJBQ1QoJnNzLT5zcHJpbnRlciwgbHZhbCk7CiAKICAgICAgICAgICAgICAgICB0b2RvID0g
U3ByaW50KCZzcy0+c3ByaW50ZXIsIHNzc19mb3JtYXQsIGx2YWwsIHJ2YWwsIHh2YWwpOwpAQCAt
MzE3NSwyOCArMzE3Miw1NyBAQCBEZWNvbXBpbGUoU3ByaW50U3RhY2sgKnNzLCBqc2J5dGVjb2Rl
ICpwCiAgICAgICAgICAgICAgICAgYnJlYWs7CiAKICAgICAgICAgICAgICAgY2FzZSBKU09QX0dP
VE86CiAgICAgICAgICAgICAgIGNhc2UgSlNPUF9HT1RPWDoKICAgICAgICAgICAgICAgICBzbiA9
IGpzX0dldFNyY05vdGUoanAtPnNjcmlwdCwgcGMpOwogICAgICAgICAgICAgICAgIHN3aXRjaCAo
c24gPyBTTl9UWVBFKHNuKSA6IFNSQ19OVUxMKSB7CiAgICAgICAgICAgICAgICAgICBjYXNlIFNS
Q19GT1JfSU46CiAgICAgICAgICAgICAgICAgICAgIC8qCi0gICAgICAgICAgICAgICAgICAgICAq
IFRoZSBsb29wIGJhY2stZWRnZSBjYXJyaWVzICsxIHN0YWNrIGJhbGFuY2UsIGZvciB0aGUKLSAg
ICAgICAgICAgICAgICAgICAgICogZmxhZyBwcm9jZXNzZWQgYnkgSlNPUF9JRk5FLiBXZSBkbyBu
b3QgZGVjb21waWxlIHRoZQotICAgICAgICAgICAgICAgICAgICAgKiBKU09QX0lGTkUsIGFuZCBp
bnN0ZWFkIHB1c2ggdGhlIGxlZnQtaGFuZCBzaWRlIG9mICdpbicKLSAgICAgICAgICAgICAgICAg
ICAgICogYWZ0ZXIgdGhlIGxvb3AgZWRnZSBpbiB0aGlzIHN0YWNrIHNsb3QgKHRoZSBKU09QX0ZP
UioKLSAgICAgICAgICAgICAgICAgICAgICogb3Bjb2RlcycgZGVjb21waWxlcnMgZG8gdGhpcyBw
dXNoaW5nKS4KKyAgICAgICAgICAgICAgICAgICAgICogVGhlIGJ5dGVjb2RlIGFyb3VuZCBwYyBs
b29rcyBsaWtlIHRoaXM6CisgICAgICAgICAgICAgICAgICAgICAqICAgICA8PFJIUz4+CisgICAg
ICAgICAgICAgICAgICAgICAqICAgICBpdGVyCisgICAgICAgICAgICAgICAgICAgICAqIHBjOiBn
b3RvL2dvdG94IEMgICAgICAgICBbc3JjX2Zvcl9pbihCLCBEKV0KKyAgICAgICAgICAgICAgICAg
ICAgICogIEE6IDw8TEhTID0gaXRlcm5leHQ+PgorICAgICAgICAgICAgICAgICAgICAgKiAgQjog
cG9wICAgICAgICAgICAgICAgICAgW21heWJlIGEgc3JjX2RlY2xfdmFyL2xldF0KKyAgICAgICAg
ICAgICAgICAgICAgICogICAgIDw8Uz4+CisgICAgICAgICAgICAgICAgICAgICAqICBDOiBtb3Jl
aXRlcgorICAgICAgICAgICAgICAgICAgICAgKiAgICAgaWZuZS9pZm5leCBBCisgICAgICAgICAg
ICAgICAgICAgICAqICAgICBlbmRpdGVyCisgICAgICAgICAgICAgICAgICAgICAqICBEOiAuLi4K
KyAgICAgICAgICAgICAgICAgICAgICoKKyAgICAgICAgICAgICAgICAgICAgICogSW4gYW4gYXJy
YXkgY29tcHJlaGVuc2lvbiBvciBnZW5lcmF0b3IgZXhwcmVzc2lvbiwgd2UKKyAgICAgICAgICAg
ICAgICAgICAgICogY29uc3RydWN0IHRoZSBmb3ItaGVhZCBhbmQgc3RvcmUgaXQgaW4gdGhlIHNs
b3QgcHVzaGVkCisgICAgICAgICAgICAgICAgICAgICAqIGJ5IEpTT1BfSVRFUiwgdGhlbiByZWN1
cnNlIHRvIGRlY29tcGlsZSBTLiBUaGUKKyAgICAgICAgICAgICAgICAgICAgICogY3VsbWluYXRp
bmcgSlNPUF9BUlJBWVBVU0ggb3IgSlNPUF9ZSUVMRCBpbnN0cnVjdGlvbgorICAgICAgICAgICAg
ICAgICAgICAgKiAod2hpY2ggUyBtdXN0IGNvbnRhaW4sIGJ5IGNvbnN0cnVjdGlvbikgZ2x1ZXMg
YWxsIHRoZQorICAgICAgICAgICAgICAgICAgICAgKiBjbGF1c2VzIHRvZ2V0aGVyLgorICAgICAg
ICAgICAgICAgICAgICAgKgorICAgICAgICAgICAgICAgICAgICAgKiBPdGhlcndpc2UgdGhpcyBp
cyBhIGZvci1pbiBzdGF0ZW1lbnQuIFdlIGVhZ2VybHkgb3V0cHV0CisgICAgICAgICAgICAgICAg
ICAgICAqIHRoZSBmb3ItaGVhZCBhbmQgcmVjdXJzZSB0byBkZWNvbXBpbGUgdGhlIGNvbnRyb2xs
ZWQKKyAgICAgICAgICAgICAgICAgICAgICogc3RhdGVtZW50IFMuCisgICAgICAgICAgICAgICAg
ICAgICAqCisgICAgICAgICAgICAgICAgICAgICAqIFdlIG5ldmVyIGRlY29tcGlsZSB0aGUgb2Js
aWdhdG9yeSBKU09QX1BPUCwKKyAgICAgICAgICAgICAgICAgICAgICogSlNPUF9NT1JFSVRFUiBv
ciBKU09QX0lGTkUsIHRob3VnaCB3ZSBkbyBxdWljayBhc3NlcnRzCisgICAgICAgICAgICAgICAg
ICAgICAqIHRvIGNoZWNrIHRoYXQgdGhleSBhcmUgdGhlcmUuCiAgICAgICAgICAgICAgICAgICAg
ICAqLwogICAgICAgICAgICAgICAgICAgICBjb25kID0gR2V0SnVtcE9mZnNldChwYywgcGMpOwog
ICAgICAgICAgICAgICAgICAgICBuZXh0ID0ganNfR2V0U3JjTm90ZU9mZnNldChzbiwgMCk7CiAg
ICAgICAgICAgICAgICAgICAgIHRhaWwgPSBqc19HZXRTcmNOb3RlT2Zmc2V0KHNuLCAxKTsKKyAg
ICAgICAgICAgICAgICAgICAgSlNfQVNTRVJUKHBjW25leHRdID09IEpTT1BfUE9QKTsKICAgICAg
ICAgICAgICAgICAgICAgSlNfQVNTRVJUKHBjW2NvbmRdID09IEpTT1BfTU9SRUlURVIpOwogICAg
ICAgICAgICAgICAgICAgICBERUNPTVBJTEVfQ09ERShwYyArIG9wbGVuLCBuZXh0IC0gb3BsZW4p
OwogICAgICAgICAgICAgICAgICAgICBsdmFsID0gUE9QX1NUUigpOworCisgICAgICAgICAgICAg
ICAgICAgIC8qCisgICAgICAgICAgICAgICAgICAgICAqIFRoaXMgc3RyaW5nICI8bmV4dD4iIGNv
bWVzIGZyb20ganNvcGNvZGUudGJsLiBJdCBzdGFuZHMKKyAgICAgICAgICAgICAgICAgICAgICog
Zm9yIHRoZSByZXN1bHQgcHVzaGVkIGJ5IEpTT1BfSVRFUk5FWFQuCisgICAgICAgICAgICAgICAg
ICAgICAqLworICAgICAgICAgICAgICAgICAgICBKU19BU1NFUlQoc3RyY21wKGx2YWwgKyBzdHJs
ZW4obHZhbCkgLSA5LCAiID0gPG5leHQ+IikgPT0gMCk7CisgICAgICAgICAgICAgICAgICAgIGNv
bnN0X2Nhc3Q8Y2hhciAqPihsdmFsKVtzdHJsZW4obHZhbCkgLSA5XSA9ICdcMCc7CiAgICAgICAg
ICAgICAgICAgICAgIExPQ0FMX0FTU0VSVChzcy0+dG9wID49IDEpOwogCiAgICAgICAgICAgICAg
ICAgICAgIGlmIChzcy0+aW5BcnJheUluaXQgfHwgc3MtPmluR2VuRXhwKSB7CiAgICAgICAgICAg
ICAgICAgICAgICAgICBydmFsID0gUE9QX1NUUigpOwogICAgICAgICAgICAgICAgICAgICAgICAg
aWYgKHNzLT50b3AgPj0gMSAmJiBzcy0+b3Bjb2Rlc1tzcy0+dG9wIC0gMV0gPT0gSlNPUF9GT1JM
T0NBTCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNzLT5zcHJpbnRlci5vZmZzZXQg
PSBzcy0+b2Zmc2V0c1tzcy0+dG9wXSAtIFBBUkVOX1NMT1A7CiAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgaWYgKFNwcmludCgmc3MtPnNwcmludGVyLCAiICVzICglcyBpbiAlcykiLAogICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZm9yZWFjaCA/IGpzX2Zvcl9lYWNo
X3N0ciA6IGpzX2Zvcl9zdHIsCkBAIC0zMjEzLDI4ICszMjM5LDI5IEBAIERlY29tcGlsZShTcHJp
bnRTdGFjayAqc3MsIGpzYnl0ZWNvZGUgKnAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0
b2RvID0gc3MtPm9mZnNldHNbc3MtPnRvcCAtIDFdOwogICAgICAgICAgICAgICAgICAgICAgICAg
fSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0b2RvID0gU3ByaW50KCZzcy0+
c3ByaW50ZXIsICIgJXMgKCVzIGluICVzKSIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICBmb3JlYWNoID8ganNfZm9yX2VhY2hfc3RyIDoganNfZm9yX3N0ciwKICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGx2YWwsIHJ2YWwpOwogICAg
ICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHRvZG8g
PCAwIHx8ICFQdXNoT2ZmKHNzLCB0b2RvLCBKU09QX0ZPUkxPQ0FMKSkKICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICByZXR1cm4gTlVMTDsKLSAgICAgICAgICAgICAgICAgICAgICAgIERFQ09N
UElMRV9DT0RFKHBjICsgbmV4dCwgY29uZCAtIG5leHQpOworICAgICAgICAgICAgICAgICAgICAg
ICAgREVDT01QSUxFX0NPREUocGMgKyBuZXh0ICsgSlNPUF9QT1BfTEVOR1RILCBjb25kIC0gbmV4
dCAtIEpTT1BfUE9QX0xFTkdUSCk7CiAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAg
ICAgICAgICAgICAgICAgICAgICAvKgogICAgICAgICAgICAgICAgICAgICAgICAgICogQXMgYWJv
dmUsIHJ2YWwgb3IgYW4gZXh0ZW5zaW9uIG9mIGl0IG11c3QgcmVtYWluCiAgICAgICAgICAgICAg
ICAgICAgICAgICAgKiBzdGFja2VkIGR1cmluZyBsb29wIGJvZHkgZGVjb21waWxhdGlvbi4KICAg
ICAgICAgICAgICAgICAgICAgICAgICAqLwogICAgICAgICAgICAgICAgICAgICAgICAgcnZhbCA9
IEdldFN0cihzcywgc3MtPnRvcCAtIDEpOwotICAgICAgICAgICAgICAgICAgICAgICAganNfcHJp
bnRmKGpwLCAiXHQlcyAoJXMgaW4gJXMpIHtcbiIsCisgICAgICAgICAgICAgICAgICAgICAgICB4
dmFsID0gVmFyUHJlZml4KGpzX0dldFNyY05vdGUoanAtPnNjcmlwdCwgcGMgKyBuZXh0KSk7Cisg
ICAgICAgICAgICAgICAgICAgICAgICBqc19wcmludGYoanAsICJcdCVzICglcyVzIGluICVzKSB7
XG4iLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZvcmVhY2ggPyBqc19mb3Jf
ZWFjaF9zdHIgOiBqc19mb3Jfc3RyLAotICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
IGx2YWwsIHJ2YWwpOworICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHh2YWwsIGx2
YWwsIHJ2YWwpOwogICAgICAgICAgICAgICAgICAgICAgICAganAtPmluZGVudCArPSA0OwotICAg
ICAgICAgICAgICAgICAgICAgICAgREVDT01QSUxFX0NPREUocGMgKyBuZXh0LCBjb25kIC0gbmV4
dCk7CisgICAgICAgICAgICAgICAgICAgICAgICBERUNPTVBJTEVfQ09ERShwYyArIG5leHQgKyBK
U09QX1BPUF9MRU5HVEgsIGNvbmQgLSBuZXh0IC0gSlNPUF9QT1BfTEVOR1RIKTsKICAgICAgICAg
ICAgICAgICAgICAgICAgIGpwLT5pbmRlbnQgLT0gNDsKICAgICAgICAgICAgICAgICAgICAgICAg
IGpzX3ByaW50ZihqcCwgIlx0fVxuIik7CiAgICAgICAgICAgICAgICAgICAgIH0KIAogICAgICAg
ICAgICAgICAgICAgICBwYyArPSB0YWlsOwogICAgICAgICAgICAgICAgICAgICBMT0NBTF9BU1NF
UlQoKnBjID09IEpTT1BfSUZORSB8fCAqcGMgPT0gSlNPUF9JRk5FWCk7CiAgICAgICAgICAgICAg
ICAgICAgIGxlbiA9IGpzX0NvZGVTcGVjWypwY10ubGVuZ3RoOwogICAgICAgICAgICAgICAgICAg
ICBicmVhazsKQEAgLTM0MjUsNzMgKzM0NTIsMTYgQEAgRGVjb21waWxlKFNwcmludFN0YWNrICpz
cywganNieXRlY29kZSAqcAogICAgICAgICAgICAgICAgIGN4LT5mcmVlXygoY2hhciAqKWx2YWwp
OwogICAgICAgICAgICAgICAgIGJyZWFrOwogCiAgICAgICAgICAgICAgIGNhc2UgSlNPUF9BTkQ6
CiAgICAgICAgICAgICAgIGNhc2UgSlNPUF9BTkRYOgogICAgICAgICAgICAgICAgIHh2YWwgPSAi
JiYiOwogICAgICAgICAgICAgICAgIGdvdG8gZG9fbG9naWNhbF9jb25uZWN0aXZlOwogCi0gICAg
ICAgICAgICAgIGNhc2UgSlNPUF9GT1JBUkc6Ci0gICAgICAgICAgICAgICAgc24gPSBOVUxMOwot
ICAgICAgICAgICAgICAgIGkgPSBHRVRfQVJHTk8ocGMpOwotICAgICAgICAgICAgICAgIGdvdG8g
ZG9fZm9ydmFyc2xvdDsKLQotICAgICAgICAgICAgICBjYXNlIEpTT1BfRk9STE9DQUw6Ci0gICAg
ICAgICAgICAgICAgc24gPSBqc19HZXRTcmNOb3RlKGpwLT5zY3JpcHQsIHBjKTsKLSAgICAgICAg
ICAgICAgICBpZiAoIUlzVmFyU2xvdChqcCwgcGMsICZpKSkgewotICAgICAgICAgICAgICAgICAg
ICBKU19BU1NFUlQob3AgPT0gSlNPUF9GT1JMT0NBTCk7Ci0gICAgICAgICAgICAgICAgICAgIHRv
ZG8gPSBTcHJpbnQoJnNzLT5zcHJpbnRlciwgc3NfZm9ybWF0LCBWYXJQcmVmaXgoc24pLCBHZXRT
dHIoc3MsIGkpKTsKLSAgICAgICAgICAgICAgICAgICAgYnJlYWs7Ci0gICAgICAgICAgICAgICAg
fQotCi0gICAgICAgICAgICAgIGRvX2ZvcnZhcnNsb3Q6Ci0gICAgICAgICAgICAgICAgYXRvbSA9
IEdldEFyZ09yVmFyQXRvbShqcCwgaSk7Ci0gICAgICAgICAgICAgICAgTE9DQUxfQVNTRVJUKGF0
b20pOwotICAgICAgICAgICAgICAgIHRvZG8gPSBTcHJpbnRDU3RyaW5nKCZzcy0+c3ByaW50ZXIs
IFZhclByZWZpeChzbikpOwotICAgICAgICAgICAgICAgIGlmICh0b2RvIDwgMCB8fCAhUXVvdGVT
dHJpbmcoJnNzLT5zcHJpbnRlciwgYXRvbSwgMCkpCi0gICAgICAgICAgICAgICAgICAgIHJldHVy
biBOVUxMOwotICAgICAgICAgICAgICAgIGJyZWFrOwotCi0gICAgICAgICAgICAgIGNhc2UgSlNP
UF9GT1JOQU1FOgotICAgICAgICAgICAgICBjYXNlIEpTT1BfRk9SR05BTUU6Ci0gICAgICAgICAg
ICAgICAgTE9BRF9BVE9NKDApOwotCi0gICAgICAgICAgICAgICAgc24gPSBqc19HZXRTcmNOb3Rl
KGpwLT5zY3JpcHQsIHBjKTsKLSAgICAgICAgICAgICAgICB0b2RvID0gU3ByaW50Q1N0cmluZygm
c3MtPnNwcmludGVyLCBWYXJQcmVmaXgoc24pKTsKLSAgICAgICAgICAgICAgICBpZiAodG9kbyA8
IDAgfHwgIVF1b3RlU3RyaW5nKCZzcy0+c3ByaW50ZXIsIGF0b20sIDApKQotICAgICAgICAgICAg
ICAgICAgICByZXR1cm4gTlVMTDsKLSAgICAgICAgICAgICAgICBicmVhazsKLQotICAgICAgICAg
ICAgICBjYXNlIEpTT1BfRk9SUFJPUDoKLSAgICAgICAgICAgICAgICB4dmFsID0gTlVMTDsKLSAg
ICAgICAgICAgICAgICBMT0FEX0FUT00oMCk7Ci0gICAgICAgICAgICAgICAgaWYgKCFBVE9NX0lT
X0lERU5USUZJRVIoYXRvbSkpIHsKLSAgICAgICAgICAgICAgICAgICAgeHZhbCA9IFF1b3RlU3Ry
aW5nKCZzcy0+c3ByaW50ZXIsIGF0b20sCi0gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAoanNjaGFyKSdcJycpOwotICAgICAgICAgICAgICAgICAgICBpZiAoIXh2YWwpCi0g
ICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gTlVMTDsKLSAgICAgICAgICAgICAgICB9Ci0g
ICAgICAgICAgICAgICAgbHZhbCA9IFBPUF9TVFIoKTsKLSAgICAgICAgICAgICAgICBpZiAoeHZh
bCkgewotICAgICAgICAgICAgICAgICAgICBKU19BU1NFUlQoKmx2YWwpOwotICAgICAgICAgICAg
ICAgICAgICB0b2RvID0gU3ByaW50KCZzcy0+c3ByaW50ZXIsIGluZGV4X2Zvcm1hdCwgbHZhbCwg
eHZhbCk7Ci0gICAgICAgICAgICAgICAgfSBlbHNlIHsKLSAgICAgICAgICAgICAgICAgICAgdG9k
byA9IFNwcmludCgmc3MtPnNwcmludGVyLCBzc19mb3JtYXQsIGx2YWwsICpsdmFsID8gIi4iIDog
IiIpOwotICAgICAgICAgICAgICAgICAgICBpZiAodG9kbyA8IDApCi0gICAgICAgICAgICAgICAg
ICAgICAgICByZXR1cm4gTlVMTDsKLSAgICAgICAgICAgICAgICAgICAgaWYgKCFRdW90ZVN0cmlu
Zygmc3MtPnNwcmludGVyLCBhdG9tLCAwKSkKLSAgICAgICAgICAgICAgICAgICAgICAgIHJldHVy
biBOVUxMOwotICAgICAgICAgICAgICAgIH0KLSAgICAgICAgICAgICAgICBicmVhazsKLQotICAg
ICAgICAgICAgICBjYXNlIEpTT1BfRk9SRUxFTToKLSAgICAgICAgICAgICAgICB0b2RvID0gU3By
aW50Q1N0cmluZygmc3MtPnNwcmludGVyLCBmb3JlbGVtX2Nvb2tpZSk7Ci0gICAgICAgICAgICAg
ICAgYnJlYWs7Ci0KICAgICAgICAgICAgICAgY2FzZSBKU09QX0VOVU1FTEVNOgogICAgICAgICAg
ICAgICBjYXNlIEpTT1BfRU5VTUNPTlNURUxFTToKICAgICAgICAgICAgICAgICAvKgogICAgICAg
ICAgICAgICAgICAqIFRoZSBzdGFjayBoYXMgdGhlIG9iamVjdCB1bmRlciB0aGUgKHRvcCkgaW5k
ZXggZXhwcmVzc2lvbi4KICAgICAgICAgICAgICAgICAgKiBUaGUgInJ2YWwiIHByb3BlcnR5IGlk
IGlzIHVuZGVybmVhdGggdGhvc2UgdHdvIG9uIHRoZSBzdGFjay4KICAgICAgICAgICAgICAgICAg
KiBUaGUgZm9yIGxvb3AgYm9keSBuZXQgYW5kIGdyb3NzIGxlbmd0aHMgY2FuIG5vdyBiZSBhZGp1
c3RlZAogICAgICAgICAgICAgICAgICAqIHRvIGFjY291bnQgZm9yIHRoZSBsZW5ndGggb2YgdGhl
IGluZGV4aW5nIGV4cHJlc3Npb24gdGhhdAogICAgICAgICAgICAgICAgICAqIGNhbWUgYWZ0ZXIg
SlNPUF9GT1JFTEVNIGFuZCBiZWZvcmUgSlNPUF9FTlVNRUxFTS4KZGlmZiAtLWdpdCBhL2pzL3Ny
Yy9qc29wY29kZS5oIGIvanMvc3JjL2pzb3Bjb2RlLmgKLS0tIGEvanMvc3JjL2pzb3Bjb2RlLmgK
KysrIGIvanMvc3JjL2pzb3Bjb2RlLmgKQEAgLTYwLDIzICs2MCwyNCBAQCBKU19CRUdJTl9FWFRF
Uk5fQwogdHlwZWRlZiBlbnVtIEpTT3AgewogI2RlZmluZSBPUERFRihvcCx2YWwsbmFtZSx0b2tl
bixsZW5ndGgsbnVzZXMsbmRlZnMscHJlYyxmb3JtYXQpIFwKICAgICBvcCA9IHZhbCwKICNpbmNs
dWRlICJqc29wY29kZS50YmwiCiAjdW5kZWYgT1BERUYKICAgICBKU09QX0xJTUlULAogCiAgICAg
LyoKLSAgICAgKiBUaGVzZSBwc2V1ZG8tb3BzIGhlbHAganNfRGVjb21waWxlVmFsdWVHZW5lcmF0
b3IgZGVjb21waWxlIEpTT1BfU0VUTkFNRSwKLSAgICAgKiBKU09QX1NFVFBST1AsIGFuZCBKU09Q
X1NFVEVMRU0sIHJlc3BlY3RpdmVseS4gIFRoZXkgYXJlIG5ldmVyIHN0b3JlZCBpbgotICAgICAq
IGJ5dGVjb2RlLCBzbyB0aGV5IGRvbid0IHByZWVtcHQgdmFsaWQgb3Bjb2Rlcy4KKyAgICAgKiBU
aGVzZSBwc2V1ZG8tb3BzIGhlbHAganNfRGVjb21waWxlVmFsdWVHZW5lcmF0b3IgZGVjb21waWxl
IEpTT1BfU0VUUFJPUCwKKyAgICAgKiBKU09QX1NFVEVMRU0sIGFuZCBmb3ItZXhwcmVzc2lvbnMs
IHJlc3BlY3RpdmVseS4gIFRoZXkgYXJlIG5ldmVyIHN0b3JlZAorICAgICAqIGluIGJ5dGVjb2Rl
LCBzbyB0aGV5IGRvbid0IHByZWVtcHQgdmFsaWQgb3Bjb2Rlcy4KICAgICAgKi8KICAgICBKU09Q
X0dFVFBST1AyID0gSlNPUF9MSU1JVCwKICAgICBKU09QX0dFVEVMRU0yID0gSlNPUF9MSU1JVCAr
IDEsCi0gICAgSlNPUF9GQUtFX0xJTUlUID0gSlNPUF9HRVRFTEVNMgorICAgIEpTT1BfRk9STE9D
QUwgPSBKU09QX0xJTUlUICsgMiwKKyAgICBKU09QX0ZBS0VfTElNSVQgPSBKU09QX0ZPUkxPQ0FM
CiB9IEpTT3A7CiAKIC8qCiAgKiBKUyBieXRlY29kZSBmb3JtYXRzLgogICovCiAjZGVmaW5lIEpP
Rl9CWVRFICAgICAgICAgIDAgICAgICAgLyogc2luZ2xlIGJ5dGVjb2RlLCBubyBpbW1lZGlhdGVz
ICovCiAjZGVmaW5lIEpPRl9KVU1QICAgICAgICAgIDEgICAgICAgLyogc2lnbmVkIDE2LWJpdCBq
dW1wIG9mZnNldCBpbW1lZGlhdGUgKi8KICNkZWZpbmUgSk9GX0FUT00gICAgICAgICAgMiAgICAg
ICAvKiB1bnNpZ25lZCAxNi1iaXQgY29uc3RhbnQgaW5kZXggKi8KZGlmZiAtLWdpdCBhL2pzL3Ny
Yy9qc29wY29kZS50YmwgYi9qcy9zcmMvanNvcGNvZGUudGJsCi0tLSBhL2pzL3NyYy9qc29wY29k
ZS50YmwKKysrIGIvanMvc3JjL2pzb3Bjb2RlLnRibApAQCAtMTIwLDE5ICsxMjAsMTggQEAgT1BE
RUYoSlNPUF9MRUFWRVdJVEgsIDQsICAibGVhdmV3aXRoIiwgIAogT1BERUYoSlNPUF9SRVRVUk4s
ICAgIDUsICAicmV0dXJuIiwgICAgIE5VTEwsICAgICAgICAgMSwgIDEsICAwLCAgMiwgIEpPRl9C
WVRFKQogT1BERUYoSlNPUF9HT1RPLCAgICAgIDYsICAiZ290byIsICAgICAgIE5VTEwsICAgICAg
ICAgMywgIDAsICAwLCAgMCwgIEpPRl9KVU1QKQogT1BERUYoSlNPUF9JRkVRLCAgICAgIDcsICAi
aWZlcSIsICAgICAgIE5VTEwsICAgICAgICAgMywgIDEsICAwLCAgNCwgIEpPRl9KVU1QfEpPRl9E
RVRFQ1RJTkcpCiBPUERFRihKU09QX0lGTkUsICAgICAgOCwgICJpZm5lIiwgICAgICAgTlVMTCwg
ICAgICAgICAzLCAgMSwgIDAsICAwLCAgSk9GX0pVTVB8Sk9GX1BBUkVOSEVBRCkKIAogLyogR2V0
IHRoZSBhcmd1bWVudHMgb2JqZWN0IGZvciB0aGUgY3VycmVudCwgbGlnaHR3ZWlnaHQgZnVuY3Rp
b24gYWN0aXZhdGlvbi4gKi8KIE9QREVGKEpTT1BfQVJHVU1FTlRTLCA5LCBqc19hcmd1bWVudHNf
c3RyLCBqc19hcmd1bWVudHNfc3RyLCAxLCAwLCAxLCAxOCwgSk9GX0JZVEUpCiAKLS8qIEVDTUEt
Y29tcGxpYW50IGZvci1pbiBsb29wIHdpdGggYXJndW1lbnQgb3IgbG9jYWwgbG9vcCBjb250cm9s
LiAqLwotT1BERUYoSlNPUF9GT1JBUkcsICAgIDEwLCAiZm9yYXJnIiwgICAgIE5VTEwsICAgICAg
ICAgMywgIDEsICAxLCAxOSwgIEpPRl9RQVJHfEpPRl9OQU1FfEpPRl9GT1J8Sk9GX1RNUFNMT1Qp
Ci1PUERFRihKU09QX0ZPUkxPQ0FMLCAgMTEsICJmb3Jsb2NhbCIsICAgTlVMTCwgICAgICAgICAz
LCAgMSwgIDEsIDE5LCAgSk9GX0xPQ0FMfEpPRl9OQU1FfEpPRl9GT1J8Sk9GX1RNUFNMT1QpCitP
UERFRihKU09QX1NXQVAsICAgICAgMTAsICJzd2FwIiwgICAgICAgTlVMTCwgICAgICAgICAxLCAg
MiwgIDIsICAwLCAgSk9GX0JZVEUpCitPUERFRihKU09QX1VOVVNFRDExLCAgMTEsICJ1bnVzZWQx
MSIsICAgTlVMTCwgICAgICAgICAxLCAgMCwgIDAsICAwLCAgSk9GX0JZVEUpCiAKIC8qIE1vcmUg
bG9uZy1zdGFuZGluZyBieXRlY29kZXMuICovCiBPUERFRihKU09QX0RVUCwgICAgICAgMTIsICJk
dXAiLCAgICAgICAgTlVMTCwgICAgICAgICAxLCAgMSwgIDIsICAwLCAgSk9GX0JZVEUpCiBPUERF
RihKU09QX0RVUDIsICAgICAgMTMsICJkdXAyIiwgICAgICAgTlVMTCwgICAgICAgICAxLCAgMiwg
IDQsICAwLCAgSk9GX0JZVEUpCiBPUERFRihKU09QX1NFVENPTlNULCAgMTQsICJzZXRjb25zdCIs
ICAgTlVMTCwgICAgICAgICAzLCAgMSwgIDEsICAzLCAgSk9GX0FUT018Sk9GX05BTUV8Sk9GX1NF
VCkKIE9QREVGKEpTT1BfQklUT1IsICAgICAxNSwgImJpdG9yIiwgICAgICAifCIsICAgICAgICAg
IDEsICAyLCAgMSwgIDcsICBKT0ZfQllURXxKT0ZfTEVGVEFTU09DKQogT1BERUYoSlNPUF9CSVRY
T1IsICAgIDE2LCAiYml0eG9yIiwgICAgICJeIiwgICAgICAgICAgMSwgIDIsICAxLCAgOCwgIEpP
Rl9CWVRFfEpPRl9MRUZUQVNTT0MpCiBPUERFRihKU09QX0JJVEFORCwgICAgMTcsICJiaXRhbmQi
LCAgICAgIiYiLCAgICAgICAgICAxLCAgMiwgIDEsICA5LCAgSk9GX0JZVEV8Sk9GX0xFRlRBU1NP
QykKQEAgLTIxNCwyMCArMjEzLDIwIEBAIE9QREVGKEpTT1BfU0VUQ0FMTCwgICA3NCwgInNldGNh
bGwiLCAgICAKICAqIHRydWUgaWYgYW5vdGhlciB2YWx1ZSBpcyBhdmFpbGFibGUsIGFuZCBmYWxz
ZSBvdGhlcndpc2UuIEl0IGlzIGZvbGxvd2VkCiAgKiBpbW1lZGlhdGVseSBieSBKU09QX0lGTkV7
LFh9LgogICoKICAqIEpTT1BfRU5ESVRFUiBjbGVhbnMgdXAgYWZ0ZXIgdGhlIGxvb3AuIEl0IHVz
ZXMgdGhlIHNsb3QgYWJvdmUgdGhlIGl0ZXJhdG9yCiAgKiBmb3IgdGVtcG9yYXJ5IEdDIHJvb3Rp
bmcuCiAgKi8KIE9QREVGKEpTT1BfSVRFUiwgICAgICA3NSwgIml0ZXIiLCAgICAgICBOVUxMLCAg
ICAgICAgIDIsICAxLCAgMSwgIDAsICBKT0ZfVUlOVDgpCiBPUERFRihKU09QX01PUkVJVEVSLCAg
NzYsICJtb3JlaXRlciIsICAgTlVMTCwgICAgICAgICAxLCAgMSwgIDIsICAwLCAgSk9GX0JZVEUp
Ci1PUERFRihKU09QX0VORElURVIsICAgNzcsICJlbmRpdGVyIiwgICAgTlVMTCwgICAgICAgICAx
LCAgMSwgIDAsICAwLCAgSk9GX0JZVEUpCitPUERFRihKU09QX0lURVJORVhULCAgNzcsICJpdGVy
bmV4dCIsICAgIjxuZXh0PiIsICAgICAyLCAgMCwgIDEsICAwLCAgSk9GX1VJTlQ4KQorT1BERUYo
SlNPUF9FTkRJVEVSLCAgIDc4LCAiZW5kaXRlciIsICAgIE5VTEwsICAgICAgICAgMSwgIDEsICAw
LCAgMCwgIEpPRl9CWVRFKQogCi1PUERFRihKU09QX0ZVTkFQUExZLCAgNzgsICJmdW5hcHBseSIs
ICAgTlVMTCwgICAgICAgICAzLCAtMSwgIDEsIDE4LCAgSk9GX1VJTlQxNnxKT0ZfSU5WT0tFKQot
T1BERUYoSlNPUF9TV0FQLCAgICAgIDc5LCAic3dhcCIsICAgICAgIE5VTEwsICAgICAgICAgMSwg
IDIsICAyLCAgMCwgIEpPRl9CWVRFKQorT1BERUYoSlNPUF9GVU5BUFBMWSwgIDc5LCAiZnVuYXBw
bHkiLCAgIE5VTEwsICAgICAgICAgMywgLTEsICAxLCAxOCwgIEpPRl9VSU5UMTZ8Sk9GX0lOVk9L
RSkKIAogLyogUHVzaCBvYmplY3QgbGl0ZXJhbDogZWl0aGVyIGFuIFhNTCBvYmplY3Qgb3IgaW5p
dGlhbGlzZXIgb2JqZWN0LiAqLwogT1BERUYoSlNPUF9PQkpFQ1QsICAgIDgwLCAib2JqZWN0Iiwg
ICAgIE5VTEwsICAgICAgICAgMywgIDAsICAxLCAxOSwgIEpPRl9PQkpFQ1QpCiAKIC8qIFBvcCB2
YWx1ZSBhbmQgZGlzY2FyZCBpdC4gKi8KIE9QREVGKEpTT1BfUE9QLCAgICAgICA4MSwgInBvcCIs
ICAgICAgICBOVUxMLCAgICAgICAgIDEsICAxLCAgMCwgIDIsICBKT0ZfQllURSkKIAogLyogQ2Fs
bCBhIGZ1bmN0aW9uIGFzIGEgY29uc3RydWN0b3I7IG9wZXJhbmQgaXMgYXJnYy4gKi8KQEAgLTI3
MCwyMCArMjY5LDE5IEBAIE9QREVGKEpTT1BfQVJHREVDLCAgIDEwMCwgImFyZ2RlYyIsICAgICAK
IAogT1BERUYoSlNPUF9JTkNMT0NBTCwgIDEwMSwiaW5jbG9jYWwiLCAgIE5VTEwsICAgICAgICAg
MywgIDAsICAxLCAxNSwgIEpPRl9MT0NBTHxKT0ZfTkFNRXxKT0ZfSU5DfEpPRl9UTVBTTE9UMykK
IE9QREVGKEpTT1BfREVDTE9DQUwsICAxMDIsImRlY2xvY2FsIiwgICBOVUxMLCAgICAgICAgIDMs
ICAwLCAgMSwgMTUsICBKT0ZfTE9DQUx8Sk9GX05BTUV8Sk9GX0RFQ3xKT0ZfVE1QU0xPVDMpCiBP
UERFRihKU09QX0xPQ0FMSU5DLCAgMTAzLCJsb2NhbGluYyIsICAgTlVMTCwgICAgICAgICAzLCAg
MCwgIDEsIDE1LCAgSk9GX0xPQ0FMfEpPRl9OQU1FfEpPRl9JTkN8Sk9GX1BPU1R8Sk9GX1RNUFNM
T1QzKQogT1BERUYoSlNPUF9MT0NBTERFQywgIDEwNCwibG9jYWxkZWMiLCAgIE5VTEwsICAgICAg
ICAgMywgIDAsICAxLCAxNSwgIEpPRl9MT0NBTHxKT0ZfTkFNRXxKT0ZfREVDfEpPRl9QT1NUfEpP
Rl9UTVBTTE9UMykKIAogT1BERUYoSlNPUF9JTUFDT1AsICAgIDEwNSwiaW1hY29wIiwgICAgIE5V
TEwsICAgICAgICAgMSwgIDAsICAwLCAgMCwgIEpPRl9CWVRFKQogCi0vKiBFQ01BLWNvbXBsaWFu
dCBmb3IvaW4gb3BzLiAqLwotT1BERUYoSlNPUF9GT1JOQU1FLCAgIDEwNiwiZm9ybmFtZSIsICAg
IE5VTEwsICAgICAgICAgMywgIDEsICAxLCAxOSwgIEpPRl9BVE9NfEpPRl9OQU1FfEpPRl9GT1J8
Sk9GX1RNUFNMT1QzKQotT1BERUYoSlNPUF9GT1JQUk9QLCAgIDEwNywiZm9ycHJvcCIsICAgIE5V
TEwsICAgICAgICAgMywgIDIsICAxLCAxOCwgIEpPRl9BVE9NfEpPRl9QUk9QfEpPRl9GT1J8Sk9G
X1RNUFNMT1QzKQotT1BERUYoSlNPUF9GT1JFTEVNLCAgIDEwOCwiZm9yZWxlbSIsICAgIE5VTEws
ICAgICAgICAgMSwgIDEsICAyLCAxOCwgIEpPRl9CWVRFIHxKT0ZfRUxFTXxKT0ZfRk9SKQorT1BE
RUYoSlNPUF9VTlVTRUQxMDYsIDEwNiwgInVudXNlZDEwNiIsIE5VTEwsICAgICAgICAgMSwgIDAs
ICAwLCAgMCwgIEpPRl9CWVRFKQorT1BERUYoSlNPUF9VTlVTRUQxMDcsIDEwNywgInVudXNlZDEw
NyIsIE5VTEwsICAgICAgICAgMSwgIDAsICAwLCAgMCwgIEpPRl9CWVRFKQorT1BERUYoSlNPUF9V
TlVTRUQxMDgsIDEwOCwgInVudXNlZDEwOCIsIE5VTEwsICAgICAgICAgMSwgIDAsICAwLCAgMCwg
IEpPRl9CWVRFKQogT1BERUYoSlNPUF9QT1BOLCAgICAgIDEwOSwicG9wbiIsICAgICAgIE5VTEws
ICAgICAgICAgMywgLTEsICAwLCAgMCwgIEpPRl9VSU5UMTYpCiAKIC8qIEVDTUEtY29tcGxpYW50
IGFzc2lnbm1lbnQgb3BzLiAqLwogT1BERUYoSlNPUF9CSU5ETkFNRSwgIDExMCwiYmluZG5hbWUi
LCAgIE5VTEwsICAgICAgICAgMywgIDAsICAxLCAgMCwgIEpPRl9BVE9NfEpPRl9OQU1FfEpPRl9T
RVQpCiBPUERFRihKU09QX1NFVE5BTUUsICAgMTExLCJzZXRuYW1lIiwgICAgTlVMTCwgICAgICAg
ICAzLCAgMiwgIDEsICAzLCAgSk9GX0FUT018Sk9GX05BTUV8Sk9GX1NFVHxKT0ZfREVURUNUSU5H
KQogCiAvKiBFeGNlcHRpb24gaGFuZGxpbmcgb3BzLiAqLwogT1BERUYoSlNPUF9USFJPVywgICAg
IDExMixqc190aHJvd19zdHIsIE5VTEwsICAgICAgICAgMSwgIDEsICAwLCAgMCwgIEpPRl9CWVRF
KQpAQCAtNjA5LDEwICs2MDcsOCBAQCBPUERFRihKU09QX1VOQlJBTkRUSElTLCAgIDIzOCwidW5i
cmFuZHRoCiBPUERFRihKU09QX1NIQVJQSU5JVCwgICAgIDIzOSwic2hhcnBpbml0IiwgICAgIE5V
TEwsICAzLCAgMCwgIDAsICAwLCAgSk9GX1VJTlQxNnxKT0ZfU0hBUlBTTE9UKQogCiAvKiBTdGF0
aWMgYmluZGluZyBmb3IgZ2xvYmFscy4gKi8KIE9QREVGKEpTT1BfR0VUR0xPQkFMLCAgICAgMjQw
LCJnZXRnbG9iYWwiLCAgICAgTlVMTCwgIDMsICAwLCAgMSwgMTksICBKT0ZfR0xPQkFMfEpPRl9O
QU1FKQogT1BERUYoSlNPUF9DQUxMR0xPQkFMLCAgICAyNDEsImNhbGxnbG9iYWwiLCAgICBOVUxM
LCAgMywgIDAsICAyLCAxOSwgIEpPRl9HTE9CQUx8Sk9GX05BTUV8Sk9GX0NBTExPUCkKIAogLyog
TGlrZSBKU09QX0ZVTkFQUExZIGJ1dCBmb3IgZi5jYWxsIGluc3RlYWQgb2YgZi5hcHBseS4gKi8K
IE9QREVGKEpTT1BfRlVOQ0FMTCwgICAgICAgMjQyLCJmdW5jYWxsIiwgICAgICAgTlVMTCwgIDMs
IC0xLCAgMSwgMTgsICBKT0ZfVUlOVDE2fEpPRl9JTlZPS0UpCi0KLU9QREVGKEpTT1BfRk9SR05B
TUUsICAgICAgMjQzLCJmb3JnbmFtZSIsICAgICAgTlVMTCwgIDMsICAxLCAgMSwgMTksICBKT0Zf
QVRPTXxKT0ZfR05BTUV8Sk9GX0ZPUnxKT0ZfVE1QU0xPVDMpCmRpZmYgLS1naXQgYS9qcy9zcmMv
anNwYXJzZS5jcHAgYi9qcy9zcmMvanNwYXJzZS5jcHAKLS0tIGEvanMvc3JjL2pzcGFyc2UuY3Bw
CisrKyBiL2pzL3NyYy9qc3BhcnNlLmNwcApAQCAtNzc2LDE3ICs3NzYsMzMgQEAgSlNQYXJzZU5v
ZGU6Om5ld0JpbmFyeU9yQXBwZW5kKFRva2VuS2luZAogICAgIHBuID0gTmV3T3JSZWN5Y2xlZE5v
ZGUodGMpOwogICAgIGlmICghcG4pCiAgICAgICAgIHJldHVybiBOVUxMOwogICAgIHBuLT5pbml0
KHR0LCBvcCwgUE5fQklOQVJZKTsKICAgICBwbi0+cG5fcG9zLmJlZ2luID0gbGVmdC0+cG5fcG9z
LmJlZ2luOwogICAgIHBuLT5wbl9wb3MuZW5kID0gcmlnaHQtPnBuX3Bvcy5lbmQ7CiAgICAgcG4t
PnBuX2xlZnQgPSBsZWZ0OwogICAgIHBuLT5wbl9yaWdodCA9IHJpZ2h0OwotICAgIHJldHVybiAo
QmluYXJ5Tm9kZSAqKXBuOworICAgIHJldHVybiBwbjsKK30KKworSlNQYXJzZU5vZGUgKgorSlNQ
YXJzZU5vZGU6Om5ld1Rlcm5hcnkoVG9rZW5LaW5kIHR0LCBKU09wIG9wLCBKU1BhcnNlTm9kZSAq
a2lkMSwgSlNQYXJzZU5vZGUgKmtpZDIsCisgICAgICAgICAgICAgICAgICAgICAgICBKU1BhcnNl
Tm9kZSAqa2lkMywgSlNUcmVlQ29udGV4dCAqdGMpCit7CisgICAgSlNQYXJzZU5vZGUgKnBuID0g
TmV3T3JSZWN5Y2xlZE5vZGUodGMpOworICAgIGlmICghcG4pCisgICAgICAgIHJldHVybiBOVUxM
OworICAgIHBuLT5pbml0KHR0LCBvcCwgUE5fVEVSTkFSWSk7CisgICAgcG4tPnBuX3Bvcy5iZWdp
biA9IChraWQxID8ga2lkMSA6IGtpZDIpLT5wbl9wb3MuYmVnaW47CisgICAgcG4tPnBuX3Bvcy5l
bmQgPSBraWQzLT5wbl9wb3MuZW5kOworICAgIHBuLT5wbl9raWQxID0ga2lkMTsKKyAgICBwbi0+
cG5fa2lkMiA9IGtpZDI7CisgICAgcG4tPnBuX2tpZDMgPSBraWQzOworICAgIHJldHVybiBwbjsK
IH0KIAogbmFtZXNwYWNlIGpzIHsKIAogaW5saW5lIHZvaWQKIE5hbWVOb2RlOjppbml0Q29tbW9u
KEpTVHJlZUNvbnRleHQgKnRjKQogewogICAgIHBuX2V4cHIgPSBOVUxMOwpAQCAtMzYzNywxNiAr
MzY1MywyOCBAQCBNYXRjaExhYmVsKEpTQ29udGV4dCAqY3gsIFRva2VuU3RyZWFtICp0CiAgICAg
ICAgIGxhYmVsID0gdHMtPmN1cnJlbnRUb2tlbigpLnRfYXRvbTsKICAgICB9IGVsc2UgewogICAg
ICAgICBsYWJlbCA9IE5VTEw7CiAgICAgfQogICAgIHBuLT5wbl9hdG9tID0gbGFiZWw7CiAgICAg
cmV0dXJuIEpTX1RSVUU7CiB9CiAKKy8qCisgKiBEZWNsYXJlIGEgbGV0LXZhcmlhYmxlIGluIGEg
YmxvY2ssIGxldC1leHByZXNzaW9uLCBvciBjb21wcmVoZW5zaW9uCisgKiBzY29wZS4gdGMgbXVz
dCBhbHJlYWR5IGJlIGluIHN1Y2ggYSBzY29wZS4KKyAqCisgKiBUaGlzIGNoZWNrcyB0aGUgdmFy
aWFibGUgbmFtZSAnYXRvbSc7IGlmIGl0IGlzICdldmFsJywgJ2FyZ3VtZW50cycsIG9yIGEKKyAq
IGtleXdvcmQsIG9yIGlmIGEgdmFyaWFibGUgd2l0aCB0aGF0IG5hbWUgYWxyZWFkeSBleGlzdHMg
aW4gdGhlIGN1cnJlbnQKKyAqIHNjb3BlLCB0aGlzIGNhbiB0aHJvdyBhIFN5bnRheEVycm9yLgor
ICoKKyAqIE90aGVyd2lzZSBjcmVhdGUgYSBwcm9wZXJ0eSBmb3IgdGhlIG5ldyBsZXQtdmFyaWFi
bGUgb24gdGhlIGJsb2NrIG9iamN0LAorICogdGMtPmJsb2NrQ2hhaW4oKS4gUG9wdWxhdGUgZGF0
YS0+cG4tPnBuX3tvcCxjb29raWUsZGZsYWdzfS4gU3Rhc2ggYSBwb2ludGVyCisgKiB0byBkYXRh
LT5wbiBpbiBhIHNsb3Qgb2YgdGhlIGJsb2NrIG9iamVjdC4KKyAqLwogc3RhdGljIEpTQm9vbAog
QmluZExldChKU0NvbnRleHQgKmN4LCBCaW5kRGF0YSAqZGF0YSwgSlNBdG9tICphdG9tLCBKU1Ry
ZWVDb250ZXh0ICp0YykKIHsKICAgICBKU1BhcnNlTm9kZSAqcG47CiAgICAgSlNPYmplY3QgKmJs
b2NrT2JqOwogICAgIEpTQXRvbUxpc3RFbGVtZW50ICphbGU7CiAgICAganNpbnQgbjsKIApAQCAt
NDQ0NSwxOCArNDQ3MywyMiBAQCBQYXJzZXI6OmRlc3RydWN0dXJpbmdFeHByKEJpbmREYXRhICpk
YXRhCiAgICAgdGMtPmZsYWdzICY9IH5UQ0ZfREVDTF9ERVNUUlVDVFVSSU5HOwogICAgIGlmICgh
cG4pCiAgICAgICAgIHJldHVybiBOVUxMOwogICAgIGlmICghQ2hlY2tEZXN0cnVjdHVyaW5nKGNv
bnRleHQsIGRhdGEsIHBuLCB0YykpCiAgICAgICAgIHJldHVybiBOVUxMOwogICAgIHJldHVybiBw
bjsKIH0KIAorI2VuZGlmIC8qIEpTX0hBU19ERVNUUlVDVFVSSU5HICovCisKIC8qCi0gKiBDdXJy
ZW50bHkgdXNlZCBvbmx5ICNpZiBKU19IQVNfREVTVFJVQ1RVUklORywgaW4gU3RhdGVtZW50J3Mg
VE9LX0ZPUiBjYXNlLgorICogQ3VycmVudGx5IHVzZWQgb25seSBieSBQYXJzZXI6OmZvclN0YXRl
bWVudCB0byBjbG9uZSB0aGUgVEFSR0VUIGluCisgKiBgZm9yICh2YXIvY29uc3QvbGV0IFRBUkdF
VCBpbiBFWFBSKSBTVE1UYC4KKyAqCiAgKiBUaGlzIGZ1bmN0aW9uIGFzc3VtZXMgdGhlIGNsb25l
ZCB0cmVlIGlzIGZvciB1c2UgaW4gdGhlIHNhbWUgc3RhdGVtZW50IGFuZAogICogYmluZGluZyBj
b250ZXh0IGFzIHRoZSBvcmlnaW5hbCB0cmVlLgogICovCiBzdGF0aWMgSlNQYXJzZU5vZGUgKgog
Q2xvbmVQYXJzZVRyZWUoSlNQYXJzZU5vZGUgKm9wbiwgSlNUcmVlQ29udGV4dCAqdGMpCiB7CiAg
ICAgSlNQYXJzZU5vZGUgKnBuLCAqcG4yLCAqb3BuMjsKIApAQCAtNDU1MCwxOCArNDU4MiwxNiBA
QCBDbG9uZVBhcnNlVHJlZShKU1BhcnNlTm9kZSAqb3BuLCBKU1RyZWVDCiAgICAgICAgIHBuLT5w
bl91ID0gb3BuLT5wbl91OwogICAgICAgICBicmVhazsKIAogI3VuZGVmIE5VTExDSEVDSwogICAg
IH0KICAgICByZXR1cm4gcG47CiB9CiAKLSNlbmRpZiAvKiBKU19IQVNfREVTVFJVQ1RVUklORyAq
LwotCiBleHRlcm4gY29uc3QgY2hhciBqc193aXRoX3N0YXRlbWVudF9zdHJbXTsKIAogc3RhdGlj
IEpTUGFyc2VOb2RlICoKIENvbnRhaW5zU3RtdChKU1BhcnNlTm9kZSAqcG4sIFRva2VuS2luZCB0
dCkKIHsKICAgICBKU1BhcnNlTm9kZSAqcG4yLCAqcG50OwogCiAgICAgaWYgKCFwbikKQEAgLTUw
MjMsMTYgKzUwNTMsMzEgQEAgUGFyc2VyOjpzd2l0Y2hTdGF0ZW1lbnQoKQogICAgIFBvcFN0YXRl
bWVudCh0Yyk7CiAKICAgICBwbi0+cG5fcG9zLmVuZCA9IHBuMi0+cG5fcG9zLmVuZCA9IHRva2Vu
U3RyZWFtLmN1cnJlbnRUb2tlbigpLnBvcy5lbmQ7CiAgICAgcG4tPnBuX2xlZnQgPSBwbjE7CiAg
ICAgcG4tPnBuX3JpZ2h0ID0gcG4yOwogICAgIHJldHVybiBwbjsKIH0KIAorc3RhdGljIEpTUGFy
c2VOb2RlICoKK0Nsb25lTmFtZU5vZGVVbmJvdW5kKEpTUGFyc2VOb2RlICpwbiwgSlNUcmVlQ29u
dGV4dCAqdGMpCit7CisgICAgSlNfQVNTRVJUKHBuLT5wbl90eXBlID09IFRPS19OQU1FKTsKKyAg
ICBKU1BhcnNlTm9kZSAqY29weSA9IE5hbWVOb2RlOjpjcmVhdGUocG4tPnBuX2F0b20sIHRjKTsK
KyAgICBpZiAoIWNvcHkpCisgICAgICAgIHJldHVybiBOVUxMOworICAgIGNvcHktPnBuX3R5cGUg
PSBUT0tfTkFNRTsKKyAgICBjb3B5LT5wbl9vcCA9IEpTT1BfTkFNRTsKKyAgICBjb3B5LT5wbl9w
b3MgPSBwbi0+cG5fcG9zOworICAgIGlmIChwbi0+cG5fZGVmbikKKyAgICAgICAgTGlua1VzZVRv
RGVmKGNvcHksIChKU0RlZmluaXRpb24gKikgcG4sIHRjKTsKKyAgICByZXR1cm4gY29weTsKK30K
KwogSlNQYXJzZU5vZGUgKgogUGFyc2VyOjpmb3JTdGF0ZW1lbnQoKQogewogICAgIEpTUGFyc2VO
b2RlICpwbnNlcSA9IE5VTEw7CiAjaWYgSlNfSEFTX0JMT0NLX1NDT1BFCiAgICAgSlNQYXJzZU5v
ZGUgKnBubGV0ID0gTlVMTDsKICAgICBKU1N0bXRJbmZvIGJsb2NrSW5mbzsKICNlbmRpZgpAQCAt
NTA1NywxOCArNTEwMiwyMCBAQCBQYXJzZXI6OmZvclN0YXRlbWVudCgpCiAgICAgVG9rZW5LaW5k
IHR0ID0gdG9rZW5TdHJlYW0ucGVla1Rva2VuKFRTRl9PUEVSQU5EKTsKIAogI2lmIEpTX0hBU19C
TE9DS19TQ09QRQogICAgIGJvb2wgbGV0ID0gZmFsc2U7CiAjZW5kaWYKIAogICAgIEpTUGFyc2VO
b2RlICpwbjE7CiAgICAgaWYgKHR0ID09IFRPS19TRU1JKSB7Ci0gICAgICAgIGlmIChwbi0+cG5f
aWZsYWdzICYgSlNJVEVSX0ZPUkVBQ0gpCi0gICAgICAgICAgICBnb3RvIGJhZF9mb3JfZWFjaDsK
KyAgICAgICAgaWYgKHBuLT5wbl9pZmxhZ3MgJiBKU0lURVJfRk9SRUFDSCkgeworICAgICAgICAg
ICAgcmVwb3J0RXJyb3JOdW1iZXIocG4sIEpTUkVQT1JUX0VSUk9SLCBKU01TR19CQURfRk9SX0VB
Q0hfTE9PUCk7CisgICAgICAgICAgICByZXR1cm4gTlVMTDsKKyAgICAgICAgfQogCiAgICAgICAg
IC8qIE5vIGluaXRpYWxpemVyIC0tIHNldCBmaXJzdCBraWQgb2YgbGVmdCBzdWItbm9kZSB0byBu
dWxsLiAqLwogICAgICAgICBwbjEgPSBOVUxMOwogICAgIH0gZWxzZSB7CiAgICAgICAgIC8qCiAg
ICAgICAgICAqIFNldCBwbjEgdG8gYSB2YXIgbGlzdCBvciBhbiBpbml0aWFsaXppbmcgZXhwcmVz
c2lvbi4KICAgICAgICAgICoKICAgICAgICAgICogU2V0IHRoZSBUQ0ZfSU5fRk9SX0lOSVQgZmxh
ZyBkdXJpbmcgcGFyc2luZyBvZiB0aGUgZmlyc3QgY2xhdXNlCkBAIC01MTA5LDE3ICs1MTU2LDI4
IEBAIFBhcnNlcjo6Zm9yU3RhdGVtZW50KCkKICAgICB9CiAKICAgICAvKgogICAgICAqIFdlIGNh
biBiZSBzdXJlIHRoYXQgaXQncyBhIGZvci9pbiBsb29wIGlmIHRoZXJlJ3Mgc3RpbGwgYW4gJ2lu
JwogICAgICAqIGtleXdvcmQgaGVyZSwgZXZlbiBpZiBKYXZhU2NyaXB0IHJlY29nbml6ZXMgJ2lu
JyBhcyBhbiBvcGVyYXRvciwKICAgICAgKiBhcyB3ZSd2ZSBleGNsdWRlZCAnaW4nIGZyb20gYmVp
bmcgcGFyc2VkIGluIFJlbEV4cHIgYnkgc2V0dGluZwogICAgICAqIHRoZSBUQ0ZfSU5fRk9SX0lO
SVQgZmxhZyBpbiBvdXIgSlNUcmVlQ29udGV4dC4KICAgICAgKi8KKyAgICBKU1BhcnNlTm9kZSAq
cG4yLCAqcG4zOworICAgIEpTUGFyc2VOb2RlICpwbjQgPSBUZXJuYXJ5Tm9kZTo6Y3JlYXRlKHRj
KTsKKyAgICBpZiAoIXBuNCkKKyAgICAgICAgcmV0dXJuIE5VTEw7CiAgICAgaWYgKHBuMSAmJiB0
b2tlblN0cmVhbS5tYXRjaFRva2VuKFRPS19JTikpIHsKKyAgICAgICAgLyoKKyAgICAgICAgICog
UGFyc2UgdGhlIHJlc3Qgb2YgdGhlIGZvci9pbiBoZWFkLgorICAgICAgICAgKgorICAgICAgICAg
KiBIZXJlIHBuMSBpcyBldmVyeXRoaW5nIHRvIHRoZSBsZWZ0IG9mICdpbicuIEF0IHRoZSBlbmQg
b2YgdGhpcyBibG9jaywKKyAgICAgICAgICogcG4xIGlzIGEgZGVjbCBvciBOVUxMLCBwbjIgaXMg
dGhlIGFzc2lnbm1lbnQgdGFyZ2V0IHRoYXQgcmVjZWl2ZXMgdGhlCisgICAgICAgICAqIGVudW1l
cmF0aW9uIHZhbHVlIGVhY2ggaXRlcmF0aW9uLCBhbmQgcG4zIGlzIHRoZSByaHMgb2YgJ2luJy4K
KyAgICAgICAgICovCiAgICAgICAgIHBuLT5wbl9pZmxhZ3MgfD0gSlNJVEVSX0VOVU1FUkFURTsK
ICAgICAgICAgc3RtdEluZm8udHlwZSA9IFNUTVRfRk9SX0lOX0xPT1A7CiAKICAgICAgICAgLyog
Q2hlY2sgdGhhdCB0aGUgbGVmdCBzaWRlIG9mIHRoZSAnaW4nIGlzIHZhbGlkLiAqLwogICAgICAg
ICBKU19BU1NFUlQoIVRva2VuS2luZElzRGVjbCh0dCkgfHwgUE5fVFlQRShwbjEpID09IHR0KTsK
ICAgICAgICAgaWYgKFRva2VuS2luZElzRGVjbCh0dCkKICAgICAgICAgICAgID8gKHBuMS0+cG5f
Y291bnQgPiAxIHx8IHBuMS0+cG5fb3AgPT0gSlNPUF9ERUZDT05TVAogI2lmIEpTX0hBU19ERVNU
UlVDVFVSSU5HCkBAIC01MTQ4LDM1ICs1MjA2LDQxIEBAIFBhcnNlcjo6Zm9yU3RhdGVtZW50KCkK
ICAgICAgICAgICAgICAgIChwbjEtPnBuX3R5cGUgIT0gVE9LX1VOQVJZT1AgfHwKICAgICAgICAg
ICAgICAgICBwbjEtPnBuX29wICE9IEpTT1BfWE1MTkFNRSkgJiYKICNlbmRpZgogICAgICAgICAg
ICAgICAgcG4xLT5wbl90eXBlICE9IFRPS19MQikpIHsKICAgICAgICAgICAgIHJlcG9ydEVycm9y
TnVtYmVyKHBuMSwgSlNSRVBPUlRfRVJST1IsIEpTTVNHX0JBRF9GT1JfTEVGVFNJREUpOwogICAg
ICAgICAgICAgcmV0dXJuIE5VTEw7CiAgICAgICAgIH0KIAotICAgICAgICAvKiBwbjIgcG9pbnRz
IHRvIHRoZSBuYW1lIG9yIGRlc3RydWN0dXJpbmcgcGF0dGVybiBvbiBpbidzIGxlZnQuICovCi0g
ICAgICAgIEpTUGFyc2VOb2RlICpwbjIgPSBOVUxMOworICAgICAgICAvKgorICAgICAgICAgKiBB
ZnRlciB0aGUgZm9sbG93aW5nIGlmLWVsc2UsIHBuMiB3aWxsIHBvaW50IHRvIHRoZSBuYW1lIG9y
CisgICAgICAgICAqIGRlc3RydWN0dXJpbmcgcGF0dGVybiBvbiBpbidzIGxlZnQuIHBuMSB3aWxs
IHBvaW50IHRvIHRoZSBkZWNsLCBpZgorICAgICAgICAgKiBhbnksIGVsc2UgTlVMTC4gTm90ZSB0
aGF0IHRoZSAiZGVjbGFyYXRpb24gd2l0aCBpbml0aWFsaXplciIgY2FzZQorICAgICAgICAgKiBy
ZXdyaXRlcyB0aGUgbG9vcC1oZWFkLCBtb3ZpbmcgdGhlIGRlY2wgYW5kIHNldHRpbmcgcG4xIHRv
IE5VTEwuCisgICAgICAgICAqLworICAgICAgICBwbjIgPSBOVUxMOwogICAgICAgICB1aW50TiBk
ZmxhZyA9IFBORF9BU1NJR05FRDsKLQogICAgICAgICBpZiAoVG9rZW5LaW5kSXNEZWNsKHR0KSkg
ewotICAgICAgICAgICAgLyogVGVsbCBqc19FbWl0VHJlZShUT0tfVkFSKSB0aGF0IHBuMSBpcyBw
YXJ0IG9mIGEgZm9yL2luLiAqLworICAgICAgICAgICAgLyogVGVsbCBFbWl0VmFyaWFibGVzIHRo
YXQgcG4xIGlzIHBhcnQgb2YgYSBmb3IvaW4uICovCiAgICAgICAgICAgICBwbjEtPnBuX3hmbGFn
cyB8PSBQTlhfRk9SSU5WQVI7CiAKLSAgICAgICAgICAgIC8qCi0gICAgICAgICAgICAgKiBSZXdy
aXRlICdmb3IgKDxkZWNsPiB4ID0gaSBpbiBvKScgd2hlcmUgPGRlY2w+IGlzICd2YXInIG9yCi0g
ICAgICAgICAgICAgKiAnY29uc3QnIHRvIGhvaXN0IHRoZSBpbml0aWFsaXplciBvciB0aGUgZW50
aXJlIGRlY2wgb3V0IG9mCi0gICAgICAgICAgICAgKiB0aGUgbG9vcCBoZWFkLiBUT0tfVkFSIGlz
IHRoZSB0eXBlIGZvciBib3RoICd2YXInIGFuZCAnY29uc3QnLgotICAgICAgICAgICAgICovCiAg
ICAgICAgICAgICBwbjIgPSBwbjEtPnBuX2hlYWQ7CiAgICAgICAgICAgICBpZiAoKHBuMi0+cG5f
dHlwZSA9PSBUT0tfTkFNRSAmJiBwbjItPm1heWJlRXhwcigpKQogI2lmIEpTX0hBU19ERVNUUlVD
VFVSSU5HCiAgICAgICAgICAgICAgICAgfHwgcG4yLT5wbl90eXBlID09IFRPS19BU1NJR04KICNl
bmRpZgogICAgICAgICAgICAgICAgICkgeworICAgICAgICAgICAgICAgIC8qCisgICAgICAgICAg
ICAgICAgICogRGVjbGFyYXRpb24gd2l0aCBpbml0aWFsaXplci4KKyAgICAgICAgICAgICAgICAg
KgorICAgICAgICAgICAgICAgICAqIFJld3JpdGUgJ2ZvciAoPGRlY2w+IHggPSBpIGluIG8pJyB3
aGVyZSA8ZGVjbD4gaXMgJ3Zhcicgb3IKKyAgICAgICAgICAgICAgICAgKiAnY29uc3QnIHRvIGhv
aXN0IHRoZSBpbml0aWFsaXplciBvciB0aGUgZW50aXJlIGRlY2wgb3V0IG9mCisgICAgICAgICAg
ICAgICAgICogdGhlIGxvb3AgaGVhZC4gVE9LX1ZBUiBpcyB0aGUgdHlwZSBmb3IgYm90aCAndmFy
JyBhbmQgJ2NvbnN0Jy4KKyAgICAgICAgICAgICAgICAgKi8KICNpZiBKU19IQVNfQkxPQ0tfU0NP
UEUKICAgICAgICAgICAgICAgICBpZiAodHQgPT0gVE9LX0xFVCkgewogICAgICAgICAgICAgICAg
ICAgICByZXBvcnRFcnJvck51bWJlcihwbjIsIEpTUkVQT1JUX0VSUk9SLCBKU01TR19JTlZBTElE
X0ZPUl9JTl9JTklUKTsKICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIE5VTEw7CiAgICAgICAg
ICAgICAgICAgfQogI2VuZGlmIC8qIEpTX0hBU19CTE9DS19TQ09QRSAqLwogCiAgICAgICAgICAg
ICAgICAgcG5zZXEgPSBMaXN0Tm9kZTo6Y3JlYXRlKHRjKTsKQEAgLTUxOTYsNjUgKzUyNjAsNjMg
QEAgUGFyc2VyOjpmb3JTdGF0ZW1lbnQoKQogICAgICAgICAgICAgICAgICAqIHNpZGUpIGFuZCBp
dCBoYXMgYW4gaW5pdGlhbGl6ZXIuCiAgICAgICAgICAgICAgICAgICovCiAgICAgICAgICAgICAg
ICAgcG4xLT5wbl94ZmxhZ3MgJj0gflBOWF9GT1JJTlZBUjsKICAgICAgICAgICAgICAgICBwbjEt
PnBuX3hmbGFncyB8PSBQTlhfUE9QVkFSOwogICAgICAgICAgICAgICAgIHBuc2VxLT5pbml0TGlz
dChwbjEpOwogCiAjaWYgSlNfSEFTX0RFU1RSVUNUVVJJTkcKICAgICAgICAgICAgICAgICBpZiAo
cG4yLT5wbl90eXBlID09IFRPS19BU1NJR04pIHsKLSAgICAgICAgICAgICAgICAgICAgcG4xID0g
Q2xvbmVQYXJzZVRyZWUocG4yLT5wbl9sZWZ0LCB0Yyk7Ci0gICAgICAgICAgICAgICAgICAgIGlm
ICghcG4xKQotICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIE5VTEw7Ci0gICAgICAgICAg
ICAgICAgfSBlbHNlCisgICAgICAgICAgICAgICAgICAgIHBuMiA9IHBuMi0+cG5fbGVmdDsKKyAg
ICAgICAgICAgICAgICAgICAgSlNfQVNTRVJUKHBuMi0+cG5fdHlwZSA9PSBUT0tfUkIgfHwgcG4y
LT5wbl90eXBlID09IFRPS19SQyB8fAorICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcG4y
LT5wbl90eXBlID09IFRPS19OQU1FKTsKKyAgICAgICAgICAgICAgICB9CiAjZW5kaWYKLSAgICAg
ICAgICAgICAgICB7Ci0gICAgICAgICAgICAgICAgICAgIEpTX0FTU0VSVChwbjItPnBuX3R5cGUg
PT0gVE9LX05BTUUpOwotICAgICAgICAgICAgICAgICAgICBwbjEgPSBOYW1lTm9kZTo6Y3JlYXRl
KHBuMi0+cG5fYXRvbSwgdGMpOwotICAgICAgICAgICAgICAgICAgICBpZiAoIXBuMSkKLSAgICAg
ICAgICAgICAgICAgICAgICAgIHJldHVybiBOVUxMOwotICAgICAgICAgICAgICAgICAgICBwbjEt
PnBuX3R5cGUgPSBUT0tfTkFNRTsKLSAgICAgICAgICAgICAgICAgICAgcG4xLT5wbl9vcCA9IEpT
T1BfTkFNRTsKLSAgICAgICAgICAgICAgICAgICAgcG4xLT5wbl9wb3MgPSBwbjItPnBuX3BvczsK
LSAgICAgICAgICAgICAgICAgICAgaWYgKHBuMi0+cG5fZGVmbikKLSAgICAgICAgICAgICAgICAg
ICAgICAgIExpbmtVc2VUb0RlZihwbjEsIChKU0RlZmluaXRpb24gKikgcG4yLCB0Yyk7Ci0gICAg
ICAgICAgICAgICAgfQotICAgICAgICAgICAgICAgIHBuMiA9IHBuMTsKLSAgICAgICAgICAgIH0K
LSAgICAgICAgfQotCi0gICAgICAgIGlmICghcG4yKSB7CisgICAgICAgICAgICAgICAgcG4xID0g
TlVMTDsKKyAgICAgICAgICAgIH0KKworICAgICAgICAgICAgLyoKKyAgICAgICAgICAgICAqIHBu
MiBpcyBwYXJ0IG9mIGEgZGVjbGFyYXRpb24uIEl0IG1pZ2h0IGJlIGEgYm91bmQgbmFtZQorICAg
ICAgICAgICAgICogbm9kZS4gUmVwbGFjZSBpdCB3aXRoIGFuIHVuYm91bmQgY29weSB0aGF0IGNh
biBiZSBwYXNzZWQgdG8KKyAgICAgICAgICAgICAqIHNldEFzc2lnbm1lbnRMaHNPcHMgYW5kIHVs
dGltYXRlbHkgRW1pdEFzc2lnbm1lbnQuCisgICAgICAgICAgICAgKi8KKyNpZiBKU19IQVNfREVT
VFJVQ1RVUklORworICAgICAgICAgICAgaWYgKHBuMi0+cG5fdHlwZSA9PSBUT0tfUkIgfHwgcG4y
LT5wbl90eXBlID09IFRPS19SQykgeworICAgICAgICAgICAgICAgIHBuMiA9IENsb25lUGFyc2VU
cmVlKHBuMiwgdGMpOworICAgICAgICAgICAgICAgIGlmICghcG4yKQorICAgICAgICAgICAgICAg
ICAgICByZXR1cm4gTlVMTDsKKyAgICAgICAgICAgIH0gZWxzZQorI2VuZGlmCisgICAgICAgICAg
ICB7CisgICAgICAgICAgICAgICAgcG4yID0gQ2xvbmVOYW1lTm9kZVVuYm91bmQocG4yLCB0Yyk7
CisgICAgICAgICAgICAgICAgaWYgKCFwbjIpCisgICAgICAgICAgICAgICAgICAgIHJldHVybiBO
VUxMOworICAgICAgICAgICAgfQorICAgICAgICB9IGVsc2UgeworICAgICAgICAgICAgLyogTm90
IGEgZGVjbGFyYXRpb24uICovCiAgICAgICAgICAgICBwbjIgPSBwbjE7Ci0gICAgICAgICAgICBp
ZiAocG4yLT5wbl90eXBlID09IFRPS19MUCAmJgotICAgICAgICAgICAgICAgICFNYWtlU2V0Q2Fs
bChjb250ZXh0LCBwbjIsIHRjLCBKU01TR19CQURfTEVGVFNJREVfT0ZfQVNTKSkgewotICAgICAg
ICAgICAgICAgIHJldHVybiBOVUxMOwotICAgICAgICAgICAgfQotI2lmIEpTX0hBU19YTUxfU1VQ
UE9SVAotICAgICAgICAgICAgaWYgKHBuMi0+cG5fdHlwZSA9PSBUT0tfVU5BUllPUCkKLSAgICAg
ICAgICAgICAgICBwbjItPnBuX29wID0gSlNPUF9CSU5EWE1MTkFNRTsKLSNlbmRpZgotICAgICAg
ICB9CisgICAgICAgICAgICBwbjEgPSBOVUxMOworICAgICAgICB9CisKKyAgICAgICAgaWYgKCFz
ZXRBc3NpZ25tZW50TGhzT3BzKHBuMiwgSlNPUF9OT1ApKQorICAgICAgICAgICAgcmV0dXJuIE5V
TEw7CiAKICAgICAgICAgc3dpdGNoIChwbjItPnBuX3R5cGUpIHsKICAgICAgICAgICBjYXNlIFRP
S19OQU1FOgogICAgICAgICAgICAgLyogQmV3YXJlICdmb3IgKGFyZ3VtZW50cyBpbiAuLi4pJyB3
aXRoIG9yIHdpdGhvdXQgYSAndmFyJy4gKi8KICAgICAgICAgICAgIE5vdGVMVmFsdWUoY29udGV4
dCwgcG4yLCB0YywgZGZsYWcpOwogICAgICAgICAgICAgYnJlYWs7CiAKICNpZiBKU19IQVNfREVT
VFJVQ1RVUklORwogICAgICAgICAgIGNhc2UgVE9LX0FTU0lHTjoKLSAgICAgICAgICAgIHBuMiA9
IHBuMi0+cG5fbGVmdDsKLSAgICAgICAgICAgIEpTX0FTU0VSVChwbjItPnBuX3R5cGUgPT0gVE9L
X1JCIHx8IHBuMi0+cG5fdHlwZSA9PSBUT0tfUkMpOwotICAgICAgICAgICAgLyogRkFMTCBUSFJP
VUdIICovCisgICAgICAgICAgICBKU19OT1RfUkVBQ0hFRCgiZm9yU3RhdGVtZW50IFRPS19BU1NJ
R04iKTsKKyAgICAgICAgICAgIGJyZWFrOworCiAgICAgICAgICAgY2FzZSBUT0tfUkI6CiAgICAg
ICAgICAgY2FzZSBUT0tfUkM6Ci0gICAgICAgICAgICAvKiBDaGVjayBmb3IgdmFsaWQgbHZhbHVl
cyBpbiB2YXItbGVzcyBkZXN0cnVjdHVyaW5nIGZvci1pbi4gKi8KLSAgICAgICAgICAgIGlmIChw
bjEgPT0gcG4yICYmICFDaGVja0Rlc3RydWN0dXJpbmcoY29udGV4dCwgTlVMTCwgcG4yLCB0Yykp
Ci0gICAgICAgICAgICAgICAgcmV0dXJuIE5VTEw7Ci0KICAgICAgICAgICAgIGlmICh2ZXJzaW9u
TnVtYmVyKCkgPT0gSlNWRVJTSU9OXzFfNykgewogICAgICAgICAgICAgICAgIC8qCiAgICAgICAg
ICAgICAgICAgICogRGVzdHJ1Y3R1cmluZyBmb3ItaW4gcmVxdWlyZXMgW2tleSwgdmFsdWVdIGVu
dW1lcmF0aW9uCiAgICAgICAgICAgICAgICAgICogaW4gSlMxLjcuCiAgICAgICAgICAgICAgICAg
ICovCiAgICAgICAgICAgICAgICAgSlNfQVNTRVJUKHBuLT5wbl9vcCA9PSBKU09QX0lURVIpOwog
ICAgICAgICAgICAgICAgIGlmICghKHBuLT5wbl9pZmxhZ3MgJiBKU0lURVJfRk9SRUFDSCkpCiAg
ICAgICAgICAgICAgICAgICAgIHBuLT5wbl9pZmxhZ3MgfD0gSlNJVEVSX0ZPUkVBQ0ggfCBKU0lU
RVJfS0VZVkFMVUU7CkBAIC01MjcwLDcxICs1MzMyLDYzIEBAIFBhcnNlcjo6Zm9yU3RhdGVtZW50
KCkKICAgICAgICAgICogcmVtb3ZpbmcgdGhlIHRvcCBzdGF0ZW1lbnQgZnJvbSB0aGUgc3RhdGVt
ZW50LXN0YWNrIGlmIHRoaXMgaXMgYQogICAgICAgICAgKiAnZm9yIChsZXQgeCBpbiB5KScgbG9v
cC4KICAgICAgICAgICovCiAjaWYgSlNfSEFTX0JMT0NLX1NDT1BFCiAgICAgICAgIEpTU3RtdElu
Zm8gKnNhdmUgPSB0Yy0+dG9wU3RtdDsKICAgICAgICAgaWYgKGxldCkKICAgICAgICAgICAgIHRj
LT50b3BTdG10ID0gc2F2ZS0+ZG93bjsKICNlbmRpZgotICAgICAgICBwbjIgPSBleHByKCk7Cisg
ICAgICAgIHBuMyA9IGV4cHIoKTsKICNpZiBKU19IQVNfQkxPQ0tfU0NPUEUKICAgICAgICAgaWYg
KGxldCkKICAgICAgICAgICAgIHRjLT50b3BTdG10ID0gc2F2ZTsKICNlbmRpZgogCi0gICAgICAg
IHBuMiA9IEpTUGFyc2VOb2RlOjpuZXdCaW5hcnlPckFwcGVuZChUT0tfSU4sIEpTT1BfTk9QLCBw
bjEsIHBuMiwgdGMpOwotICAgICAgICBpZiAoIXBuMikKLSAgICAgICAgICAgIHJldHVybiBOVUxM
OwotICAgICAgICBwbi0+cG5fbGVmdCA9IHBuMjsKKyAgICAgICAgcG40LT5wbl90eXBlID0gVE9L
X0lOOwogICAgIH0gZWxzZSB7Ci0gICAgICAgIGlmIChwbi0+cG5faWZsYWdzICYgSlNJVEVSX0ZP
UkVBQ0gpCi0gICAgICAgICAgICBnb3RvIGJhZF9mb3JfZWFjaDsKKyAgICAgICAgaWYgKHBuLT5w
bl9pZmxhZ3MgJiBKU0lURVJfRk9SRUFDSCkgeworICAgICAgICAgICAgcmVwb3J0RXJyb3JOdW1i
ZXIocG4sIEpTUkVQT1JUX0VSUk9SLCBKU01TR19CQURfRk9SX0VBQ0hfTE9PUCk7CisgICAgICAg
ICAgICByZXR1cm4gTlVMTDsKKyAgICAgICAgfQogICAgICAgICBwbi0+cG5fb3AgPSBKU09QX05P
UDsKIAogICAgICAgICAvKiBQYXJzZSB0aGUgbG9vcCBjb25kaXRpb24gb3IgbnVsbCBpbnRvIHBu
Mi4gKi8KICAgICAgICAgTVVTVF9NQVRDSF9UT0tFTihUT0tfU0VNSSwgSlNNU0dfU0VNSV9BRlRF
Ul9GT1JfSU5JVCk7CiAgICAgICAgIHR0ID0gdG9rZW5TdHJlYW0ucGVla1Rva2VuKFRTRl9PUEVS
QU5EKTsKLSAgICAgICAgSlNQYXJzZU5vZGUgKnBuMjsKICAgICAgICAgaWYgKHR0ID09IFRPS19T
RU1JKSB7CiAgICAgICAgICAgICBwbjIgPSBOVUxMOwogICAgICAgICB9IGVsc2UgewogICAgICAg
ICAgICAgcG4yID0gZXhwcigpOwogICAgICAgICAgICAgaWYgKCFwbjIpCiAgICAgICAgICAgICAg
ICAgcmV0dXJuIE5VTEw7CiAgICAgICAgIH0KIAogICAgICAgICAvKiBQYXJzZSB0aGUgdXBkYXRl
IGV4cHJlc3Npb24gb3IgbnVsbCBpbnRvIHBuMy4gKi8KICAgICAgICAgTVVTVF9NQVRDSF9UT0tF
TihUT0tfU0VNSSwgSlNNU0dfU0VNSV9BRlRFUl9GT1JfQ09ORCk7CiAgICAgICAgIHR0ID0gdG9r
ZW5TdHJlYW0ucGVla1Rva2VuKFRTRl9PUEVSQU5EKTsKLSAgICAgICAgSlNQYXJzZU5vZGUgKnBu
MzsKICAgICAgICAgaWYgKHR0ID09IFRPS19SUCkgewogICAgICAgICAgICAgcG4zID0gTlVMTDsK
ICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgIHBuMyA9IGV4cHIoKTsKICAgICAgICAgICAg
IGlmICghcG4zKQogICAgICAgICAgICAgICAgIHJldHVybiBOVUxMOwogICAgICAgICB9CiAKLSAg
ICAgICAgLyogQnVpbGQgdGhlIEZPUkhFQUQgbm9kZSB0byB1c2UgYXMgdGhlIGxlZnQga2lkIG9m
IHBuLiAqLwotICAgICAgICBKU1BhcnNlTm9kZSAqcG40ID0gVGVybmFyeU5vZGU6OmNyZWF0ZSh0
Yyk7Ci0gICAgICAgIGlmICghcG40KQotICAgICAgICAgICAgcmV0dXJuIE5VTEw7CiAgICAgICAg
IHBuNC0+cG5fdHlwZSA9IFRPS19GT1JIRUFEOwotICAgICAgICBwbjQtPnBuX29wID0gSlNPUF9O
T1A7Ci0gICAgICAgIHBuNC0+cG5fa2lkMSA9IHBuMTsKLSAgICAgICAgcG40LT5wbl9raWQyID0g
cG4yOwotICAgICAgICBwbjQtPnBuX2tpZDMgPSBwbjM7Ci0gICAgICAgIHBuLT5wbl9sZWZ0ID0g
cG40OwotICAgIH0KKyAgICB9CisgICAgcG40LT5wbl9vcCA9IEpTT1BfTk9QOworICAgIHBuNC0+
cG5fa2lkMSA9IHBuMTsKKyAgICBwbjQtPnBuX2tpZDIgPSBwbjI7CisgICAgcG40LT5wbl9raWQz
ID0gcG4zOworICAgIHBuLT5wbl9sZWZ0ID0gcG40OwogCiAgICAgTVVTVF9NQVRDSF9UT0tFTihU
T0tfUlAsIEpTTVNHX1BBUkVOX0FGVEVSX0ZPUl9DVFJMKTsKIAogICAgIC8qIFBhcnNlIHRoZSBs
b29wIGJvZHkgaW50byBwbi0+cG5fcmlnaHQuICovCi0gICAgSlNQYXJzZU5vZGUgKnBuMjsKICAg
ICBwbjIgPSBzdGF0ZW1lbnQoKTsKICAgICBpZiAoIXBuMikKICAgICAgICAgcmV0dXJuIE5VTEw7
CiAgICAgcG4tPnBuX3JpZ2h0ID0gcG4yOwogCiAgICAgLyogUmVjb3JkIHRoZSBhYnNvbHV0ZSBs
aW5lIG51bWJlciBmb3Igc291cmNlIG5vdGUgZW1pc3Npb24uICovCiAgICAgcG4tPnBuX3Bvcy5l
bmQgPSBwbjItPnBuX3Bvcy5lbmQ7CiAKQEAgLTUzNDcsMjAgKzU0MDEsMTYgQEAgUGFyc2VyOjpm
b3JTdGF0ZW1lbnQoKQogI2VuZGlmCiAgICAgaWYgKHBuc2VxKSB7CiAgICAgICAgIHBuc2VxLT5w
bl9wb3MuZW5kID0gcG4tPnBuX3Bvcy5lbmQ7CiAgICAgICAgIHBuc2VxLT5hcHBlbmQocG4pOwog
ICAgICAgICBwbiA9IHBuc2VxOwogICAgIH0KICAgICBQb3BTdGF0ZW1lbnQodGMpOwogICAgIHJl
dHVybiBwbjsKLQotICBiYWRfZm9yX2VhY2g6Ci0gICAgcmVwb3J0RXJyb3JOdW1iZXIocG4sIEpT
UkVQT1JUX0VSUk9SLCBKU01TR19CQURfRk9SX0VBQ0hfTE9PUCk7Ci0gICAgcmV0dXJuIE5VTEw7
CiB9CiAKIEpTUGFyc2VOb2RlICoKIFBhcnNlcjo6dHJ5U3RhdGVtZW50KCkKIHsKICAgICBKU1Bh
cnNlTm9kZSAqY2F0Y2hMaXN0LCAqbGFzdENhdGNoOwogCiAgICAgLyoKQEAgLTY1MDEsODIgKzY1
NTEsODkgQEAgUGFyc2VyOjpjb25kRXhwcjEoKQogICAgICAgICBwbi0+cG5fa2lkMSA9IHBuMTsK
ICAgICAgICAgcG4tPnBuX2tpZDIgPSBwbjI7CiAgICAgICAgIHBuLT5wbl9raWQzID0gcG4zOwog
ICAgICAgICB0b2tlblN0cmVhbS5nZXRUb2tlbigpOyAgICAgLyogbmVlZCB0byByZWFkIG9uZSB0
b2tlbiBwYXN0IHRoZSBlbmQgKi8KICAgICB9CiAgICAgcmV0dXJuIHBuOwogfQogCi1KU1BhcnNl
Tm9kZSAqCi1QYXJzZXI6OmFzc2lnbkV4cHIoKQotewotICAgIEpTX0NIRUNLX1JFQ1VSU0lPTihj
b250ZXh0LCByZXR1cm4gTlVMTCk7Ci0KLSNpZiBKU19IQVNfR0VORVJBVE9SUwotICAgIGlmICh0
b2tlblN0cmVhbS5tYXRjaFRva2VuKFRPS19ZSUVMRCwgVFNGX09QRVJBTkQpKQotICAgICAgICBy
ZXR1cm4gcmV0dXJuT3JZaWVsZCh0cnVlKTsKLSNlbmRpZgotCi0gICAgSlNQYXJzZU5vZGUgKnBu
ID0gY29uZEV4cHIxKCk7Ci0gICAgaWYgKCFwbikKLSAgICAgICAgcmV0dXJuIE5VTEw7Ci0KLSAg
ICBpZiAoIXRva2VuU3RyZWFtLmlzQ3VycmVudFRva2VuVHlwZShUT0tfQVNTSUdOKSkgewotICAg
ICAgICB0b2tlblN0cmVhbS51bmdldFRva2VuKCk7Ci0gICAgICAgIHJldHVybiBwbjsKLSAgICB9
Ci0KLSAgICBKU09wIG9wID0gdG9rZW5TdHJlYW0uY3VycmVudFRva2VuKCkudF9vcDsKK2Jvb2wK
K1BhcnNlcjo6c2V0QXNzaWdubWVudExoc09wcyhKU1BhcnNlTm9kZSAqcG4sIEpTT3Agb3ApCit7
CiAgICAgc3dpdGNoIChwbi0+cG5fdHlwZSkgewogICAgICAgY2FzZSBUT0tfTkFNRToKICAgICAg
ICAgaWYgKCFDaGVja1N0cmljdEFzc2lnbm1lbnQoY29udGV4dCwgdGMsIHBuKSkKLSAgICAgICAg
ICAgIHJldHVybiBOVUxMOwotICAgICAgICBwbi0+cG5fb3AgPSBKU09QX1NFVE5BTUU7CisgICAg
ICAgICAgICByZXR1cm4gZmFsc2U7CisgICAgICAgIHBuLT5wbl9vcCA9IChwbi0+cG5fb3AgPT0g
SlNPUF9HRVRMT0NBTCkgPyBKU09QX1NFVExPQ0FMIDogSlNPUF9TRVROQU1FOwogICAgICAgICBO
b3RlTFZhbHVlKGNvbnRleHQsIHBuLCB0Yyk7CiAgICAgICAgIGJyZWFrOwogICAgICAgY2FzZSBU
T0tfRE9UOgogICAgICAgICBwbi0+cG5fb3AgPSBKU09QX1NFVFBST1A7CiAgICAgICAgIGJyZWFr
OwogICAgICAgY2FzZSBUT0tfTEI6CiAgICAgICAgIHBuLT5wbl9vcCA9IEpTT1BfU0VURUxFTTsK
ICAgICAgICAgYnJlYWs7CiAjaWYgSlNfSEFTX0RFU1RSVUNUVVJJTkcKICAgICAgIGNhc2UgVE9L
X1JCOgogICAgICAgY2FzZSBUT0tfUkM6Ci0gICAgICB7CiAgICAgICAgIGlmIChvcCAhPSBKU09Q
X05PUCkgewogICAgICAgICAgICAgcmVwb3J0RXJyb3JOdW1iZXIoTlVMTCwgSlNSRVBPUlRfRVJS
T1IsIEpTTVNHX0JBRF9ERVNUUlVDVF9BU1MpOwotICAgICAgICAgICAgcmV0dXJuIE5VTEw7Ci0g
ICAgICAgIH0KLSAgICAgICAgSlNQYXJzZU5vZGUgKnJocyA9IGFzc2lnbkV4cHIoKTsKLSAgICAg
ICAgaWYgKCFyaHMgfHwgIUNoZWNrRGVzdHJ1Y3R1cmluZyhjb250ZXh0LCBOVUxMLCBwbiwgdGMp
KQotICAgICAgICAgICAgcmV0dXJuIE5VTEw7Ci0gICAgICAgIHJldHVybiBKU1BhcnNlTm9kZTo6
bmV3QmluYXJ5T3JBcHBlbmQoVE9LX0FTU0lHTiwgb3AsIHBuLCByaHMsIHRjKTsKLSAgICAgIH0K
KyAgICAgICAgICAgIHJldHVybiBmYWxzZTsKKyAgICAgICAgfQorICAgICAgICBpZiAoIUNoZWNr
RGVzdHJ1Y3R1cmluZyhjb250ZXh0LCBOVUxMLCBwbiwgdGMpKQorICAgICAgICAgICAgcmV0dXJu
IGZhbHNlOworICAgICAgICBicmVhazsKICNlbmRpZgogICAgICAgY2FzZSBUT0tfTFA6CiAgICAg
ICAgIGlmICghTWFrZVNldENhbGwoY29udGV4dCwgcG4sIHRjLCBKU01TR19CQURfTEVGVFNJREVf
T0ZfQVNTKSkKLSAgICAgICAgICAgIHJldHVybiBOVUxMOworICAgICAgICAgICAgcmV0dXJuIGZh
bHNlOwogICAgICAgICBicmVhazsKICNpZiBKU19IQVNfWE1MX1NVUFBPUlQKICAgICAgIGNhc2Ug
VE9LX1VOQVJZT1A6CiAgICAgICAgIGlmIChwbi0+cG5fb3AgPT0gSlNPUF9YTUxOQU1FKSB7CiAg
ICAgICAgICAgICBwbi0+cG5fb3AgPSBKU09QX1NFVFhNTE5BTUU7CiAgICAgICAgICAgICBicmVh
azsKICAgICAgICAgfQogICAgICAgICAvKiBGQUxMIFRIUk9VR0ggKi8KICNlbmRpZgogICAgICAg
ZGVmYXVsdDoKICAgICAgICAgcmVwb3J0RXJyb3JOdW1iZXIoTlVMTCwgSlNSRVBPUlRfRVJST1Is
IEpTTVNHX0JBRF9MRUZUU0lERV9PRl9BU1MpOworICAgICAgICByZXR1cm4gZmFsc2U7CisgICAg
fQorICAgIHJldHVybiB0cnVlOworfQorCitKU1BhcnNlTm9kZSAqCitQYXJzZXI6OmFzc2lnbkV4
cHIoKQoreworICAgIEpTX0NIRUNLX1JFQ1VSU0lPTihjb250ZXh0LCByZXR1cm4gTlVMTCk7CisK
KyNpZiBKU19IQVNfR0VORVJBVE9SUworICAgIGlmICh0b2tlblN0cmVhbS5tYXRjaFRva2VuKFRP
S19ZSUVMRCwgVFNGX09QRVJBTkQpKQorICAgICAgICByZXR1cm4gcmV0dXJuT3JZaWVsZCh0cnVl
KTsKKyNlbmRpZgorCisgICAgSlNQYXJzZU5vZGUgKnBuID0gY29uZEV4cHIxKCk7CisgICAgaWYg
KCFwbikKICAgICAgICAgcmV0dXJuIE5VTEw7Ci0gICAgfQorCisgICAgaWYgKCF0b2tlblN0cmVh
bS5pc0N1cnJlbnRUb2tlblR5cGUoVE9LX0FTU0lHTikpIHsKKyAgICAgICAgdG9rZW5TdHJlYW0u
dW5nZXRUb2tlbigpOworICAgICAgICByZXR1cm4gcG47CisgICAgfQorCisgICAgSlNPcCBvcCA9
IHRva2VuU3RyZWFtLmN1cnJlbnRUb2tlbigpLnRfb3A7CisgICAgaWYgKCFzZXRBc3NpZ25tZW50
TGhzT3BzKHBuLCBvcCkpCisgICAgICAgIHJldHVybiBOVUxMOwogCiAgICAgSlNQYXJzZU5vZGUg
KnJocyA9IGFzc2lnbkV4cHIoKTsKLSAgICBpZiAocmhzICYmIFBOX1RZUEUocG4pID09IFRPS19O
QU1FICYmIHBuLT5wbl91c2VkKSB7CisgICAgaWYgKCFyaHMpCisgICAgICAgIHJldHVybiBOVUxM
OworICAgIGlmIChQTl9UWVBFKHBuKSA9PSBUT0tfTkFNRSAmJiBwbi0+cG5fdXNlZCkgewogICAg
ICAgICBKU0RlZmluaXRpb24gKmRuID0gcG4tPnBuX2xleGRlZjsKIAogICAgICAgICAvKgogICAg
ICAgICAgKiBJZiB0aGUgZGVmaW5pdGlvbiBpcyBub3QgZmxhZ2dlZCBhcyBhc3NpZ25lZCwgd2Ug
bXVzdCBoYXZlIGltcHV0ZWQKICAgICAgICAgICogdGhlIGluaXRpYWxpemVkIGZsYWcgdG8gaXQs
IHRvIG9wdGltaXplIGZvciBmbGF0IGNsb3N1cmVzLiBCdXQgdGhhdAogICAgICAgICAgKiBvcHRp
bWl6YXRpb24gdXNlcyBzb3VyY2UgY29vcmRpbmF0ZXMgdG8gY2hlY2sgZG9taW5hbmNlIHJlbGF0
aW9ucywKICAgICAgICAgICogc28gd2UgbXVzdCBleHRlbmQgdGhlIGVuZCBvZiB0aGUgZGVmaW5p
dGlvbiB0byBjb3ZlciB0aGUgcmlnaHQtaGFuZAogICAgICAgICAgKiBzaWRlIG9mIHRoaXMgYXNz
aWdubWVudCwgaS5lLiwgdGhlIGluaXRpYWxpemVyLgpAQCAtNzAwNCwxOCArNzA2MSwxNyBAQCBD
b21wRXhwclRyYW5zcGxhbnRlcjo6dHJhbnNwbGFudChKU1BhcnNlCiAgKiBhbiBleHByZXNzaW9u
IGluIGFuIG9wZW4gcGFyZW50aGVzaXMsIHBhcnNlIHRoZSB0YWlsIG9mIHRoZSBjb21wcmVoZW5z
aW9uCiAgKiBvciBnZW5lcmF0b3IgZXhwcmVzc2lvbiBzaWduaWZpZWQgYnkgdGhpcyB8Zm9yfCBr
ZXl3b3JkIGluIGNvbnRleHQuCiAgKgogICogUmV0dXJuIG51bGwgb24gZmFpbHVyZSwgZWxzZSBy
ZXR1cm4gdGhlIHRvcC1tb3N0IHBhcnNlIG5vZGUgZm9yIHRoZSBhcnJheQogICogY29tcHJlaGVu
c2lvbiBvciBnZW5lcmF0b3IgZXhwcmVzc2lvbiwgd2l0aCBhIHVuYXJ5IG5vZGUgYXMgdGhlIGJv
ZHkgb2YgdGhlCiAgKiAocG9zc2libHkgbmVzdGVkKSBmb3ItbG9vcCwgaW5pdGlhbGl6ZWQgYnkg
fHR5cGUsIG9wLCBraWR8LgogICovCiBKU1BhcnNlTm9kZSAqCi1QYXJzZXI6OmNvbXByZWhlbnNp
b25UYWlsKEpTUGFyc2VOb2RlICpraWQsIHVpbnROIGJsb2NraWQsCi0gICAgICAgICAgICAgICAg
ICAgICAgICAgIFRva2VuS2luZCB0eXBlLCBKU09wIG9wKQorUGFyc2VyOjpjb21wcmVoZW5zaW9u
VGFpbChKU1BhcnNlTm9kZSAqa2lkLCB1aW50TiBibG9ja2lkLCBUb2tlbktpbmQgdHlwZSwgSlNP
cCBvcCkKIHsKICAgICB1aW50TiBhZGp1c3Q7CiAgICAgSlNQYXJzZU5vZGUgKnBuLCAqcG4yLCAq
cG4zLCAqKnBucDsKICAgICBKU1N0bXRJbmZvIHN0bXRJbmZvOwogICAgIEJpbmREYXRhIGRhdGE7
CiAgICAgVG9rZW5LaW5kIHR0OwogICAgIEpTQXRvbSAqYXRvbTsKIApAQCAtNzE1MiwyMiArNzIw
OCwzMSBAQCBQYXJzZXI6OmNvbXByZWhlbnNpb25UYWlsKEpTUGFyc2VOb2RlICprCiAgICAgICAg
ICAgICB9CiAgICAgICAgICAgICBicmVhazsKICNlbmRpZgogCiAgICAgICAgICAgY2FzZSBUT0tf
TkFNRToKICAgICAgICAgICAgIGRhdGEucG4gPSBwbjM7CiAgICAgICAgICAgICBpZiAoIWRhdGEu
YmluZGVyKGNvbnRleHQsICZkYXRhLCBhdG9tLCB0YykpCiAgICAgICAgICAgICAgICAgcmV0dXJu
IE5VTEw7CisgICAgICAgICAgICAKKyAgICAgICAgICAgIC8qCisgICAgICAgICAgICAgKiBOb3cg
cG4zIGlzIGJvdW5kLiBNYWtlIGFuIHVuYm91bmQgY29weSB0aGF0IGNhbiBiZSBwYXNzZWQgdG8K
KyAgICAgICAgICAgICAqIHNldEFzc2lnbm1lbnRMaHNPcHMgYW5kIHVsdGltYXRlbHkgRW1pdEFz
c2lnbm1lbnQuCisgICAgICAgICAgICAgKi8KKyAgICAgICAgICAgIHBuMyA9IENsb25lTmFtZU5v
ZGVVbmJvdW5kKHBuMywgdGMpOwogICAgICAgICAgICAgYnJlYWs7CiAKICAgICAgICAgICBkZWZh
dWx0OjsKICAgICAgICAgfQogCi0gICAgICAgIHBuMi0+cG5fbGVmdCA9IEpTUGFyc2VOb2RlOjpu
ZXdCaW5hcnlPckFwcGVuZChUT0tfSU4sIEpTT1BfTk9QLCBwbjMsIHBuNCwgdGMpOworICAgICAg
ICBpZiAoIXNldEFzc2lnbm1lbnRMaHNPcHMocG4zLCBKU09QX05PUCkpCisgICAgICAgICAgICBy
ZXR1cm4gTlVMTDsKKworICAgICAgICBwbjItPnBuX2xlZnQgPSBKU1BhcnNlTm9kZTo6bmV3VGVy
bmFyeShUT0tfSU4sIEpTT1BfTk9QLCBOVUxMLCBwbjMsIHBuNCwgdGMpOwogICAgICAgICBpZiAo
IXBuMi0+cG5fbGVmdCkKICAgICAgICAgICAgIHJldHVybiBOVUxMOwogICAgICAgICAqcG5wID0g
cG4yOwogICAgICAgICBwbnAgPSAmcG4yLT5wbl9yaWdodDsKICAgICB9IHdoaWxlICh0b2tlblN0
cmVhbS5tYXRjaFRva2VuKFRPS19GT1IpKTsKIAogICAgIGlmICh0b2tlblN0cmVhbS5tYXRjaFRv
a2VuKFRPS19JRikpIHsKICAgICAgICAgcG4yID0gVGVybmFyeU5vZGU6OmNyZWF0ZSh0Yyk7CkBA
IC04MzcwLDIwICs4NDM1LDE5IEBAIFBhcnNlcjo6cHJpbWFyeUV4cHIoVG9rZW5LaW5kIHR0LCBK
U0Jvb2wKICAgICAgICAgICAgICAqCiAgICAgICAgICAgICAgKiAgIEpTT1BfRU5URVJCTE9DSyA8
bz4gLi4uIEpTT1BfTEVBVkVCTE9DSyA8bj4KICAgICAgICAgICAgICAqCiAgICAgICAgICAgICAg
KiB3aGVyZSA8bz4gaXMgYSBsaXRlcmFsIG9iamVjdCByZXByZXNlbnRpbmcgdGhlIGJsb2NrIHNj
b3BlLAogICAgICAgICAgICAgICogd2l0aCA8bj4gcHJvcGVydGllcywgbmFtaW5nIGVhY2ggdmFy
IGRlY2xhcmVkIGluIHRoZSBibG9jay4KICAgICAgICAgICAgICAqCiAgICAgICAgICAgICAgKiBF
YWNoIHZhciBkZWNsYXJhdGlvbiBpbiBhIGxldC1ibG9jayBiaW5kcyBhIG5hbWUgaW4gPG8+IGF0
CiAgICAgICAgICAgICAgKiBjb21waWxlIHRpbWUsIGFuZCBhbGxvY2F0ZXMgYSBzbG90IG9uIHRo
ZSBvcGVyYW5kIHN0YWNrIGF0Ci0gICAgICAgICAgICAgKiBydW50aW1lIHZpYSBKU09QX0VOVEVS
QkxPQ0suICBBIGJsb2NrLWxvY2FsIHZhciBpcyBhY2Nlc3NlZAotICAgICAgICAgICAgICogYnkg
dGhlIEpTT1BfR0VUTE9DQUwgYW5kIEpTT1BfU0VUTE9DQUwgb3BzLCBhbmQgaXRlcmF0ZWQgd2l0
aAotICAgICAgICAgICAgICogSlNPUF9GT1JMT0NBTC4gIFRoZXNlIG9wcyBhbGwgaGF2ZSBhbiBp
bW1lZGlhdGUgb3BlcmFuZCwgdGhlCi0gICAgICAgICAgICAgKiBsb2NhbCBzbG90J3Mgc3RhY2sg
aW5kZXggZnJvbSBmcC0+c3BiYXNlLgorICAgICAgICAgICAgICogcnVudGltZSB2aWEgSlNPUF9F
TlRFUkJMT0NLLiAgQSBibG9jay1sb2NhbCB2YXIgaXMgYWNjZXNzZWQgYnkKKyAgICAgICAgICAg
ICAqIHRoZSBKU09QX0dFVExPQ0FMIGFuZCBKU09QX1NFVExPQ0FMIG9wcy4gIFRoZXNlIG9wcyBh
bGwgaGF2ZSBhbgorICAgICAgICAgICAgICogaW1tZWRpYXRlIG9wZXJhbmQsIHRoZSBsb2NhbCBz
bG90J3Mgc3RhY2sgaW5kZXggZnJvbSBmcC0+c3BiYXNlLgogICAgICAgICAgICAgICoKICAgICAg
ICAgICAgICAqIFRoZSBhcnJheSBjb21wcmVoZW5zaW9uIGl0ZXJhdGlvbiBzdGVwLCBhcnJheS5w
dXNoKGkgKiBqKSBpbgogICAgICAgICAgICAgICogdGhlIGV4YW1wbGUgYWJvdmUsIGlzIGRvbmUg
YnkgPGkgKiBqPjsgSlNPUF9BUlJBWUNPTVAgPGFycmF5PiwKICAgICAgICAgICAgICAqIHdoZXJl
IDxhcnJheT4gaXMgdGhlIGluZGV4IG9mIGFycmF5J3Mgc3RhY2sgc2xvdC4KICAgICAgICAgICAg
ICAqLwogICAgICAgICAgICAgaWYgKGluZGV4ID09IDAgJiYgcG4tPnBuX2NvdW50ICE9IDAgJiYg
dG9rZW5TdHJlYW0ubWF0Y2hUb2tlbihUT0tfRk9SKSkgewogICAgICAgICAgICAgICAgIEpTUGFy
c2VOb2RlICpwbmV4cCwgKnBudG9wOwogCmRpZmYgLS1naXQgYS9qcy9zcmMvanNwYXJzZS5oIGIv
anMvc3JjL2pzcGFyc2UuaAotLS0gYS9qcy9zcmMvanNwYXJzZS5oCisrKyBiL2pzL3NyYy9qc3Bh
cnNlLmgKQEAgLTk4LDIxICs5OCwyNCBAQCBKU19CRUdJTl9FWFRFUk5fQwogICogICAgICAgICAg
ICAgICAgICAgICAgICAgICAgVE9LX0xFWElDQUxTQ09QRSBub2RlIHRoYXQgY29udGFpbnMgdGhl
IGxpc3Qgb2YKICAqICAgICAgICAgICAgICAgICAgICAgICAgICAgIFRPS19DQVNFIG5vZGVzLgog
ICogVE9LX0NBU0UsICAgIGJpbmFyeSAgICAgIHBuX2xlZnQ6IGNhc2UgZXhwciBvciBudWxsIGlm
IFRPS19ERUZBVUxUCiAgKiBUT0tfREVGQVVMVCAgICAgICAgICAgICAgcG5fcmlnaHQ6IFRPS19M
QyBub2RlIGZvciB0aGlzIGNhc2UncyBzdGF0ZW1lbnRzCiAgKiAgICAgICAgICAgICAgICAgICAg
ICAgICAgcG5fdmFsOiBjb25zdGFudCB2YWx1ZSBpZiBsb29rdXAgb3IgdGFibGUgc3dpdGNoCiAg
KiBUT0tfV0hJTEUgICAgYmluYXJ5ICAgICAgcG5fbGVmdDogY29uZCwgcG5fcmlnaHQ6IGJvZHkK
ICAqIFRPS19ETyAgICAgICBiaW5hcnkgICAgICBwbl9sZWZ0OiBib2R5LCBwbl9yaWdodDogY29u
ZAogICogVE9LX0ZPUiAgICAgIGJpbmFyeSAgICAgIHBuX2xlZnQ6IGVpdGhlcgotICogICAgICAg
ICAgICAgICAgICAgICAgICAgICAgZm9yL2luIGxvb3A6IGEgYmluYXJ5IFRPS19JTiBub2RlIHdp
dGgKLSAqICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcG5fbGVmdDogIFRPS19WQVIgb3Ig
VE9LX05BTUUgdG8gbGVmdCBvZiAnaW4nCi0gKiAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgaWYgVE9LX1ZBUiwgaXRzIHBuX3hmbGFncyBtYXkgaGF2ZSBQTlhfUE9QVkFSCisgKiAgICAg
ICAgICAgICAgICAgICAgICAgICAgICBmb3IvaW4gbG9vcDogYSB0ZXJuYXJ5IFRPS19JTiBub2Rl
IHdpdGgKKyAqICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcG5fa2lkMTogIFRPS19WQVIg
dG8gbGVmdCBvZiAnaW4nLCBvciBOVUxMCisgKiAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgaXRzIHBuX3hmbGFncyBtYXkgaGF2ZSBQTlhfUE9QVkFSCiAgKiAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgYW5kIFBOWF9GT1JJTlZBUiBiaXRzIHNldAotICogICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICBwbl9yaWdodDogb2JqZWN0IGV4cHIgdG8gcmlnaHQgb2YgJ2luJwor
ICogICAgICAgICAgICAgICAgICAgICAgICAgICAgICBwbl9raWQyOiBUT0tfTkFNRSBvciBkZXN0
cnVjdHVyaW5nIGV4cHIKKyAqICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0byBsZWZ0
IG9mICdpbic7IGlmIHBuX2tpZDEsIHRoZW4gdGhpcworICogICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgIGlzIGEgY2xvbmUgb2YgcG5fa2lkMS0+cG5faGVhZAorICogICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICBwbl9raWQzOiBvYmplY3QgZXhwciB0byByaWdodCBvZiAnaW4nCiAg
KiAgICAgICAgICAgICAgICAgICAgICAgICAgICBmb3IoOzspIGxvb3A6IGEgdGVybmFyeSBUT0tf
UkVTRVJWRUQgbm9kZSB3aXRoCiAgKiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBuX2tp
ZDE6ICBpbml0IGV4cHIgYmVmb3JlIGZpcnN0ICc7JwogICogICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICBwbl9raWQyOiAgY29uZCBleHByIGJlZm9yZSBzZWNvbmQgJzsnCiAgKiAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgIHBuX2tpZDM6ICB1cGRhdGUgZXhwciBhZnRlciBzZWNvbmQg
JzsnCiAgKiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFueSBraWQgbWF5IGJlIG51bGwK
ICAqICAgICAgICAgICAgICAgICAgICAgICAgICBwbl9yaWdodDogYm9keQogICogVE9LX1RIUk9X
ICAgIHVuYXJ5ICAgICAgIHBuX29wOiBKU09QX1RIUk9XLCBwbl9raWQ6IGV4Y2VwdGlvbgogICog
VE9LX1RSWSAgICAgIHRlcm5hcnkgICAgIHBuX2tpZDE6IHRyeSBibG9jawpAQCAtNDU0LDE2ICs0
NTcsMTkgQEAgcHJvdGVjdGVkOgogICAgIH0KIAogICAgIHN0YXRpYyBKU1BhcnNlTm9kZSAqY3Jl
YXRlKEpTUGFyc2VOb2RlQXJpdHkgYXJpdHksIEpTVHJlZUNvbnRleHQgKnRjKTsKIAogcHVibGlj
OgogICAgIHN0YXRpYyBKU1BhcnNlTm9kZSAqbmV3QmluYXJ5T3JBcHBlbmQoanM6OlRva2VuS2lu
ZCB0dCwgSlNPcCBvcCwgSlNQYXJzZU5vZGUgKmxlZnQsCiAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICBKU1BhcnNlTm9kZSAqcmlnaHQsIEpTVHJlZUNvbnRleHQgKnRj
KTsKIAorICAgIHN0YXRpYyBKU1BhcnNlTm9kZSAqbmV3VGVybmFyeShqczo6VG9rZW5LaW5kIHR0
LCBKU09wIG9wLCBKU1BhcnNlTm9kZSAqa2lkMSwgSlNQYXJzZU5vZGUgKmtpZDIsCisgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgIEpTUGFyc2VOb2RlICpraWQzLCBKU1RyZWVDb250
ZXh0ICp0Yyk7CisKICAgICAvKgogICAgICAqIFRoZSBwbl9leHByIGFuZCBsZXhkZWYgbWVtYmVy
cyBhcmUgYXJtcyBvZiBhbiB1bnNhZmUgdW5pb24uIFVubGVzcyB5b3UKICAgICAgKiBrbm93IGV4
YWN0bHkgd2hhdCB5b3UncmUgZG9pbmcsIHVzZSBvbmx5IHRoZSBmb2xsb3dpbmcgbWV0aG9kcyB0
byBhY2Nlc3MKICAgICAgKiB0aGVtLiBGb3IgbGVzcyBvdmVyaGVhZCBhbmQgYXNzZXJ0aW9ucyBm
b3IgcHJvdGVjdGlvbiwgdXNlIHBuLT5leHByKCkKICAgICAgKiBhbmQgcG4tPmxleGRlZigpLiBP
dGhlcndpc2UsIHVzZSBwbi0+bWF5YmVFeHByKCkgYW5kIHBuLT5tYXliZUxleERlZigpLgogICAg
ICAqLwogICAgIEpTUGFyc2VOb2RlICAqZXhwcigpIGNvbnN0IHsKICAgICAgICAgSlNfQVNTRVJU
KCFwbl91c2VkKTsKQEAgLTEyMTYsMTYgKzEyMjIsMTggQEAgcHJpdmF0ZToKICAgICBKU1BhcnNl
Tm9kZSAqeG1sRXhwcihKU0Jvb2wgaW5UYWcpOwogICAgIEpTUGFyc2VOb2RlICp4bWxBdG9tTm9k
ZSgpOwogICAgIEpTUGFyc2VOb2RlICp4bWxOYW1lRXhwcigpOwogICAgIEpTUGFyc2VOb2RlICp4
bWxUYWdDb250ZW50KGpzOjpUb2tlbktpbmQgdGFndHlwZSwgSlNBdG9tICoqbmFtZXApOwogICAg
IEpTQm9vbCB4bWxFbGVtZW50Q29udGVudChKU1BhcnNlTm9kZSAqcG4pOwogICAgIEpTUGFyc2VO
b2RlICp4bWxFbGVtZW50T3JMaXN0KEpTQm9vbCBhbGxvd0xpc3QpOwogICAgIEpTUGFyc2VOb2Rl
ICp4bWxFbGVtZW50T3JMaXN0Um9vdChKU0Jvb2wgYWxsb3dMaXN0KTsKICNlbmRpZiAvKiBKU19I
QVNfWE1MX1NVUFBPUlQgKi8KKworICAgIGJvb2wgc2V0QXNzaWdubWVudExoc09wcyhKU1BhcnNl
Tm9kZSAqcG4sIEpTT3Agb3ApOwogfTsKIAogaW5saW5lIGJvb2wKIFBhcnNlcjo6cmVwb3J0RXJy
b3JOdW1iZXIoSlNQYXJzZU5vZGUgKnBuLCB1aW50TiBmbGFncywgdWludE4gZXJyb3JOdW1iZXIs
IC4uLikKIHsKICAgICB2YV9saXN0IGFyZ3M7CiAgICAgdmFfc3RhcnQoYXJncywgZXJyb3JOdW1i
ZXIpOwogICAgIGJvb2wgcmVzdWx0ID0gdG9rZW5TdHJlYW0ucmVwb3J0Q29tcGlsZUVycm9yTnVt
YmVyVkEocG4sIGZsYWdzLCBlcnJvck51bWJlciwgYXJncyk7CmRpZmYgLS1naXQgYS9qcy9zcmMv
anNyZWZsZWN0LmNwcCBiL2pzL3NyYy9qc3JlZmxlY3QuY3BwCi0tLSBhL2pzL3NyYy9qc3JlZmxl
Y3QuY3BwCisrKyBiL2pzL3NyYy9qc3JlZmxlY3QuY3BwCkBAIC0yMTg5LDIxICsyMTg5LDIxIEBA
IEFTVFNlcmlhbGl6ZXI6OnN0YXRlbWVudChKU1BhcnNlTm9kZSAqcG4KICAgICAgICAgaWYgKCFz
dGF0ZW1lbnQocG4tPnBuX3JpZ2h0LCAmc3RtdCkpCiAgICAgICAgICAgICByZXR1cm4gZmFsc2U7
CiAKICAgICAgICAgYm9vbCBpc0ZvckVhY2ggPSBwbi0+cG5faWZsYWdzICYgSlNJVEVSX0ZPUkVB
Q0g7CiAKICAgICAgICAgaWYgKFBOX1RZUEUoaGVhZCkgPT0gVE9LX0lOKSB7CiAgICAgICAgICAg
ICBWYWx1ZSB2YXIsIGV4cHI7CiAKLSAgICAgICAgICAgIHJldHVybiAoUE5fVFlQRShoZWFkLT5w
bl9sZWZ0KSA9PSBUT0tfVkFSCi0gICAgICAgICAgICAgICAgICAgID8gdmFyaWFibGVEZWNsYXJh
dGlvbihoZWFkLT5wbl9sZWZ0LCBmYWxzZSwgJnZhcikKLSAgICAgICAgICAgICAgICAgICAgOiBQ
Tl9UWVBFKGhlYWQtPnBuX2xlZnQpID09IFRPS19MRVQKLSAgICAgICAgICAgICAgICAgICAgPyB2
YXJpYWJsZURlY2xhcmF0aW9uKGhlYWQtPnBuX2xlZnQsIHRydWUsICZ2YXIpCi0gICAgICAgICAg
ICAgICAgICAgIDogcGF0dGVybihoZWFkLT5wbl9sZWZ0LCBOVUxMLCAmdmFyKSkgJiYKKyAgICAg
ICAgICAgIHJldHVybiAoIWhlYWQtPnBuX2tpZDEKKyAgICAgICAgICAgICAgICAgICAgPyBwYXR0
ZXJuKGhlYWQtPnBuX2tpZDIsIE5VTEwsICZ2YXIpCisgICAgICAgICAgICAgICAgICAgIDogdmFy
aWFibGVEZWNsYXJhdGlvbihoZWFkLT5wbl9raWQxLAorICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgUE5fVFlQRShoZWFkLT5wbl9raWQxKSA9PSBUT0tfTEVULAorICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJnZhcikpICYmCiAgICAgICAg
ICAgICAgICAgICAgZXhwcmVzc2lvbihoZWFkLT5wbl9yaWdodCwgJmV4cHIpICYmCiAgICAgICAg
ICAgICAgICAgICAgYnVpbGRlci5mb3JJblN0YXRlbWVudCh2YXIsIGV4cHIsIHN0bXQsIGlzRm9y
RWFjaCwgJnBuLT5wbl9wb3MsIGRzdCk7CiAgICAgICAgIH0KIAogICAgICAgICBWYWx1ZSBpbml0
LCB0ZXN0LCB1cGRhdGU7CiAKICAgICAgICAgcmV0dXJuIGZvckluaXQoaGVhZC0+cG5fa2lkMSwg
JmluaXQpICYmCiAgICAgICAgICAgICAgICBvcHRFeHByZXNzaW9uKGhlYWQtPnBuX2tpZDIsICZ0
ZXN0KSAmJgpkaWZmIC0tZ2l0IGEvanMvc3JjL2pzdHJhY2VyLmNwcCBiL2pzL3NyYy9qc3RyYWNl
ci5jcHAKLS0tIGEvanMvc3JjL2pzdHJhY2VyLmNwcAorKysgYi9qcy9zcmMvanN0cmFjZXIuY3Bw
CkBAIC0xNDgwNywyMCArMTQ4MDcsMjAgQEAgVHJhY2VSZWNvcmRlcjo6cmVjb3JkX0pTT1BfTU9S
RUlURVIoKQogCiAgICAgUkVUVVJOX0lGX1hNTF9BKGl0ZXJvYmpfdmFsKTsKIAogICAgIEpTT2Jq
ZWN0KiBpdGVyb2JqID0gJml0ZXJvYmpfdmFsLnRvT2JqZWN0KCk7CiAgICAgTElucyogaXRlcm9i
al9pbnMgPSBnZXQoJml0ZXJvYmpfdmFsKTsKICAgICBMSW5zKiBjb25kX2luczsKIAogICAgIC8q
Ci0gICAgICogSlNPUF9GT1IqIGFscmVhZHkgZ3VhcmRzIG9uIHRoaXMsIGJ1dCBpbiBjZXJ0YWlu
IHJhcmUgY2FzZXMgd2UgbWlnaHQKKyAgICAgKiBKU09QX0lURVJORVhUIGFscmVhZHkgZ3VhcmRz
IG9uIHRoaXMsIGJ1dCBpbiBjZXJ0YWluIHJhcmUgY2FzZXMgd2UgbWlnaHQKICAgICAgKiByZWNv
cmQgbWlzZm9ybWVkIGxvb3AgdHJhY2VzLiBOb3RlIHRoYXQgaXQncyBub3QgbmVjZXNzYXJ5IHRv
IGd1YXJkIG9uCi0gICAgICogbmktPmZsYWdzIChub3IgZG8gd2UgaW4gdW5ib3hOZXh0VmFsdWUp
LCBiZWNhdXNlIHRoZSBkaWZmZXJlbnQKLSAgICAgKiBpdGVyYXRpb24gdHlwZSB3aWxsIGd1YXJh
bnRlZSBhIGRpZmZlcmVudCBlbnRyeSB0eXBlbWFwLgorICAgICAqIG5pLT5mbGFncyAobm9yIGRv
IHdlIGluIHVuYm94TmV4dFZhbHVlKSwgYmVjYXVzZSB0aGUgZGlmZmVyZW50IGl0ZXJhdGlvbgor
ICAgICAqIHR5cGUgd2lsbCBndWFyYW50ZWUgYSBkaWZmZXJlbnQgZW50cnkgdHlwZW1hcC4KICAg
ICAgKi8KICAgICBpZiAoaXRlcm9iai0+aGFzQ2xhc3MoJmpzX0l0ZXJhdG9yQ2xhc3MpKSB7CiAg
ICAgICAgIGd1YXJkQ2xhc3MoaXRlcm9ial9pbnMsICZqc19JdGVyYXRvckNsYXNzLCBzbmFwc2hv
dChCUkFOQ0hfRVhJVCksIExPQURfTk9STUFMKTsKIAogICAgICAgICBOYXRpdmVJdGVyYXRvciAq
bmkgPSAoTmF0aXZlSXRlcmF0b3IgKikgaXRlcm9iai0+Z2V0UHJpdmF0ZSgpOwogICAgICAgICBp
ZiAobmktPmlzS2V5SXRlcigpKSB7CiAgICAgICAgICAgICBMSW5zICpuaV9pbnMgPSB3LmxkcE9i
alByaXZhdGUoaXRlcm9ial9pbnMpOwogICAgICAgICAgICAgTElucyAqY3Vyc29yX2lucyA9IHcu
bGRwSXRlckN1cnNvcihuaV9pbnMpOwpAQCAtMTQ4NDcsMTYgKzE0ODQ3LDI2IEBAIFRyYWNlUmVj
b3JkZXI6OnJlY29yZF9KU09QX01PUkVJVEVSKCkKIAogICAgIC8vIFdyaXRlIHRoaXMgdmFsdWUg
YmFjayBldmVuIHRob3VnaCB3ZSBoYXZlbid0IGNoYW5nZWQgaXQuCiAgICAgLy8gU2VlIHRoZSBj
b21tZW50IGluIERlZXBCYWlsIGFib3V0ICJjbG9iYmVyaW5nIGRlZXAgYmFpbHMiLgogICAgIHN0
YWNrKC0xLCBpdGVyb2JqX2lucyk7CiAKICAgICByZXR1cm4gQVJFQ09SRF9DT05USU5VRTsKIH0K
IAorSlNfUkVRVUlSRVNfU1RBQ0sgQWJvcnRhYmxlUmVjb3JkaW5nU3RhdHVzCitUcmFjZVJlY29y
ZGVyOjpyZWNvcmRfSlNPUF9JVEVSTkVYVCgpCit7CisgICAgTElucyogdl9pbnM7CisgICAgVmFs
dWUgJml0ZXJvYmpfdmFsID0gc3RhY2t2YWwoLUdFVF9JTlQ4KGN4LT5yZWdzLT5wYykpOworICAg
IENIRUNLX1NUQVRVU19BKHVuYm94TmV4dFZhbHVlKGl0ZXJvYmpfdmFsLCB2X2lucykpOworICAg
IHN0YWNrKDAsIHZfaW5zKTsKKyAgICByZXR1cm4gQVJFQ09SRF9DT05USU5VRTsKK30KKwogc3Rh
dGljIEpTQm9vbCBGQVNUQ0FMTAogQ2xvc2VJdGVyYXRvcihKU0NvbnRleHQgKmN4LCBKU09iamVj
dCAqaXRlcm9iaikKIHsKICAgICBUcmFjZU1vbml0b3IgKnRtID0gSlNfVFJBQ0VfTU9OSVRPUl9P
Tl9UUkFDRShjeCk7CiAKICAgICBpZiAoIWpzX0Nsb3NlSXRlcmF0b3IoY3gsIGl0ZXJvYmopKSB7
CiAgICAgICAgIFNldEJ1aWx0aW5FcnJvcih0bSk7CiAgICAgICAgIHJldHVybiBmYWxzZTsKQEAg
LTE0ODk2LDE5ICsxNDkwNiwxOCBAQCBKU19SRVFVSVJFU19TVEFDSyB2b2lkCiBUcmFjZVJlY29y
ZGVyOjpzdG9yZU1hZ2ljKEpTV2h5TWFnaWMgd2h5LCBBZGRyZXNzIGFkZHIpCiB7CiAgICAgTElu
cyAqbWFnaWMgPSB3Lm5hbWVJbW1xKEJVSUxEX0pTVkFMKEpTVkFMX1RBR19NQUdJQywgd2h5KSk7
CiAgICAgdy5zdHEobWFnaWMsIGFkZHIpOwogfQogI2VuZGlmCiAKIEpTX1JFUVVJUkVTX1NUQUNL
IEFib3J0YWJsZVJlY29yZGluZ1N0YXR1cwotVHJhY2VSZWNvcmRlcjo6dW5ib3hOZXh0VmFsdWUo
TElucyogJnZfaW5zKQotewotICAgIFZhbHVlICZpdGVyb2JqX3ZhbCA9IHN0YWNrdmFsKC0xKTsK
K1RyYWNlUmVjb3JkZXI6OnVuYm94TmV4dFZhbHVlKFZhbHVlICZpdGVyb2JqX3ZhbCwgTElucyog
JnZfaW5zKQorewogICAgIEpTT2JqZWN0ICppdGVyb2JqID0gJml0ZXJvYmpfdmFsLnRvT2JqZWN0
KCk7CiAgICAgTElucyogaXRlcm9ial9pbnMgPSBnZXQoJml0ZXJvYmpfdmFsKTsKIAogICAgIGlm
IChpdGVyb2JqLT5oYXNDbGFzcygmanNfSXRlcmF0b3JDbGFzcykpIHsKICAgICAgICAgZ3VhcmRD
bGFzcyhpdGVyb2JqX2lucywgJmpzX0l0ZXJhdG9yQ2xhc3MsIHNuYXBzaG90KEJSQU5DSF9FWElU
KSwgTE9BRF9OT1JNQUwpOwogICAgICAgICBOYXRpdmVJdGVyYXRvciAqbmkgPSAoTmF0aXZlSXRl
cmF0b3IgKikgaXRlcm9iai0+Z2V0UHJpdmF0ZSgpOwogCiAgICAgICAgIExJbnMgKm5pX2lucyA9
IHcubGRwT2JqUHJpdmF0ZShpdGVyb2JqX2lucyk7CkBAIC0xNDk1OCw3MCArMTQ5NjcsMTYgQEAg
VHJhY2VSZWNvcmRlcjo6dW5ib3hOZXh0VmFsdWUoTElucyogJnZfaQogICAgIEFkZHJlc3MgaXRl
clZhbHVlQWRkciA9IEN4QWRkcmVzcyhpdGVyVmFsdWUpOwogICAgIHZfaW5zID0gdW5ib3hfdmFs
dWUoY3gtPml0ZXJWYWx1ZSwgaXRlclZhbHVlQWRkciwgc25hcHNob3QoQlJBTkNIX0VYSVQpKTsK
ICAgICBzdG9yZU1hZ2ljKEpTX05PX0lURVJfVkFMVUUsIGl0ZXJWYWx1ZUFkZHIpOwogCiAgICAg
cmV0dXJuIEFSRUNPUkRfQ09OVElOVUU7CiB9CiAKIEpTX1JFUVVJUkVTX1NUQUNLIEFib3J0YWJs
ZVJlY29yZGluZ1N0YXR1cwotVHJhY2VSZWNvcmRlcjo6cmVjb3JkX0pTT1BfRk9STkFNRSgpCi17
Ci0gICAgVmFsdWUqIHZwOwotICAgIExJbnMqIHhfaW5zOwotICAgIE5hbWVSZXN1bHQgbnI7Ci0g
ICAgQ0hFQ0tfU1RBVFVTX0EobmFtZSh2cCwgeF9pbnMsIG5yKSk7Ci0gICAgaWYgKCFuci50cmFj
a2VkKQotICAgICAgICBSRVRVUk5fU1RPUF9BKCJmb3JuYW1lIG9uIG5vbi10cmFja2VkIHZhbHVl
IG5vdCBzdXBwb3J0ZWQiKTsKLSAgICBMSW5zKiB2X2luczsKLSAgICBDSEVDS19TVEFUVVNfQSh1
bmJveE5leHRWYWx1ZSh2X2lucykpOwotICAgIHNldCh2cCwgdl9pbnMpOwotICAgIHJldHVybiBB
UkVDT1JEX0NPTlRJTlVFOwotfQotCi1KU19SRVFVSVJFU19TVEFDSyBBYm9ydGFibGVSZWNvcmRp
bmdTdGF0dXMKLVRyYWNlUmVjb3JkZXI6OnJlY29yZF9KU09QX0ZPUkdOQU1FKCkKLXsKLSAgICBy
ZXR1cm4gcmVjb3JkX0pTT1BfRk9STkFNRSgpOwotfQotCi1KU19SRVFVSVJFU19TVEFDSyBBYm9y
dGFibGVSZWNvcmRpbmdTdGF0dXMKLVRyYWNlUmVjb3JkZXI6OnJlY29yZF9KU09QX0ZPUlBST1Ao
KQotewotICAgIHJldHVybiBBUkVDT1JEX1NUT1A7Ci19Ci0KLUpTX1JFUVVJUkVTX1NUQUNLIEFi
b3J0YWJsZVJlY29yZGluZ1N0YXR1cwotVHJhY2VSZWNvcmRlcjo6cmVjb3JkX0pTT1BfRk9SRUxF
TSgpCi17Ci0gICAgTElucyogdl9pbnM7Ci0gICAgQ0hFQ0tfU1RBVFVTX0EodW5ib3hOZXh0VmFs
dWUodl9pbnMpKTsKLSAgICBzdGFjaygwLCB2X2lucyk7Ci0gICAgcmV0dXJuIEFSRUNPUkRfQ09O
VElOVUU7Ci19Ci0KLUpTX1JFUVVJUkVTX1NUQUNLIEFib3J0YWJsZVJlY29yZGluZ1N0YXR1cwot
VHJhY2VSZWNvcmRlcjo6cmVjb3JkX0pTT1BfRk9SQVJHKCkKLXsKLSAgICBMSW5zKiB2X2luczsK
LSAgICBDSEVDS19TVEFUVVNfQSh1bmJveE5leHRWYWx1ZSh2X2lucykpOwotICAgIGFyZyhHRVRf
QVJHTk8oY3gtPnJlZ3MtPnBjKSwgdl9pbnMpOwotICAgIHJldHVybiBBUkVDT1JEX0NPTlRJTlVF
OwotfQotCi1KU19SRVFVSVJFU19TVEFDSyBBYm9ydGFibGVSZWNvcmRpbmdTdGF0dXMKLVRyYWNl
UmVjb3JkZXI6OnJlY29yZF9KU09QX0ZPUkxPQ0FMKCkKLXsKLSAgICBMSW5zKiB2X2luczsKLSAg
ICBDSEVDS19TVEFUVVNfQSh1bmJveE5leHRWYWx1ZSh2X2lucykpOwotICAgIHZhcihHRVRfU0xP
VE5PKGN4LT5yZWdzLT5wYyksIHZfaW5zKTsKLSAgICByZXR1cm4gQVJFQ09SRF9DT05USU5VRTsK
LX0KLQotSlNfUkVRVUlSRVNfU1RBQ0sgQWJvcnRhYmxlUmVjb3JkaW5nU3RhdHVzCiBUcmFjZVJl
Y29yZGVyOjpyZWNvcmRfSlNPUF9QT1BOKCkKIHsKICAgICByZXR1cm4gQVJFQ09SRF9DT05USU5V
RTsKIH0KIAogc3RhdGljIGlubGluZSBib29sCiBJc0ZpbmRhYmxlQ2FsbE9iaihKU09iamVjdCAq
b2JqKQogewpAQCAtMTY1NTQsMTYgKzE2NTA5LDI5IEBAIFRyYWNlUmVjb3JkZXI6OnJlY29yZF9K
U09QX0NBTExHTkFNRSgpCiAgICAgfQogCiBEQkdfU1RVQihKU09QX0dFVFVQVkFSX0RCRykKIERC
R19TVFVCKEpTT1BfQ0FMTFVQVkFSX0RCRykKIERCR19TVFVCKEpTT1BfREVGRlVOX0RCR0ZDKQog
REJHX1NUVUIoSlNPUF9ERUZMT0NBTEZVTl9EQkdGQykKIERCR19TVFVCKEpTT1BfTEFNQkRBX0RC
R0ZDKQogCisjZGVmaW5lIFVOVVNFRF9TVFVCKE9QKSAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICBcCisgICAgSlNfUkVRVUlSRVNfU1RBQ0sgQWJv
cnRhYmxlUmVjb3JkaW5nU3RhdHVzICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBcCisg
ICAgVHJhY2VSZWNvcmRlcjo6cmVjb3JkXyMjT1AoKSAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICBcCisgICAgeyAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBcCisgICAgICAgIEpT
X05PVF9SRUFDSEVEKCNPUCk7ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICBcCisgICAgICAgIHJldHVybiBBUkVDT1JEX0VSUk9SOyAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBcCisgICAgfQorCitVTlVTRURfU1RV
QihKU09QX1VOVVNFRDExKQorVU5VU0VEX1NUVUIoSlNPUF9VTlVTRUQxMDYpCitVTlVTRURfU1RV
QihKU09QX1VOVVNFRDEwNykKK1VOVVNFRF9TVFVCKEpTT1BfVU5VU0VEMTA4KQorCiAjaWZkZWYg
SlNfSklUX1NQRVcKIC8qCiAgKiBQcmludCBpbmZvcm1hdGlvbiBhYm91dCBlbnRyeSB0eXBlbWFw
cyBhbmQgdW5zdGFibGUgZXhpdHMgZm9yIGFsbCBwZWVycwogICogYXQgYSBQQy4KICAqLwogdm9p
ZAogRHVtcFBlZXJTdGFiaWxpdHkoVHJhY2VNb25pdG9yKiB0bSwgY29uc3Qgdm9pZCogaXAsIEpT
T2JqZWN0KiBnbG9iYWxPYmosIHVpbnQzMiBnbG9iYWxTaGFwZSwKICAgICAgICAgICAgICAgICAg
IHVpbnQzMiBhcmdjKQpkaWZmIC0tZ2l0IGEvanMvc3JjL2pzdHJhY2VyLmggYi9qcy9zcmMvanN0
cmFjZXIuaAotLS0gYS9qcy9zcmMvanN0cmFjZXIuaAorKysgYi9qcy9zcmMvanN0cmFjZXIuaApA
QCAtMTM2OCwxNyArMTM2OCwxOCBAQCBjbGFzcyBUcmFjZVJlY29yZGVyCiAgICAgSlNfUkVRVUlS
RVNfU1RBQ0sgbmFub2ppdDo6TElucyAqY2Fub25pY2FsaXplTmFOcyhuYW5vaml0OjpMSW5zICpk
dmFsX2lucyk7CiAgICAgSlNfUkVRVUlSRVNfU1RBQ0sgQWJvcnRhYmxlUmVjb3JkaW5nU3RhdHVz
IHR5cGVkQXJyYXlFbGVtZW50KFZhbHVlJiBvdmFsLCBWYWx1ZSYgaWR4LCBWYWx1ZSomIHZwLAog
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICBuYW5vaml0OjpMSW5zKiYgdl9pbnMpOwogICAgIEpTX1JFUVVJUkVTX1NUQUNLIEFi
b3J0YWJsZVJlY29yZGluZ1N0YXR1cyBnZXRQcm9wKEpTT2JqZWN0KiBvYmosIG5hbm9qaXQ6OkxJ
bnMqIG9ial9pbnMpOwogICAgIEpTX1JFUVVJUkVTX1NUQUNLIEFib3J0YWJsZVJlY29yZGluZ1N0
YXR1cyBnZXRQcm9wKFZhbHVlJiB2KTsKICAgICBKU19SRVFVSVJFU19TVEFDSyBSZWNvcmRpbmdT
dGF0dXMgZ2V0VGhpcyhuYW5vaml0OjpMSW5zKiYgdGhpc19pbnMpOwogCiAgICAgSlNfUkVRVUlS
RVNfU1RBQ0sgdm9pZCBzdG9yZU1hZ2ljKEpTV2h5TWFnaWMgd2h5LCB0aml0OjpBZGRyZXNzIGFk
ZHIpOwotICAgIEpTX1JFUVVJUkVTX1NUQUNLIEFib3J0YWJsZVJlY29yZGluZ1N0YXR1cyB1bmJv
eE5leHRWYWx1ZShuYW5vaml0OjpMSW5zKiAmdl9pbnMpOworICAgIEpTX1JFUVVJUkVTX1NUQUNL
IEFib3J0YWJsZVJlY29yZGluZ1N0YXR1cyB1bmJveE5leHRWYWx1ZShWYWx1ZSAmaXRlcm9ial92
YWwsCisgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgIG5hbm9qaXQ6OkxJbnMqICZ2X2lucyk7CiAKICAgICBKU19SRVFVSVJFU19TVEFD
SyBWTVNpZGVFeGl0KiBlbnRlckRlZXBCYWlsQ2FsbCgpOwogICAgIEpTX1JFUVVJUkVTX1NUQUNL
IHZvaWQgbGVhdmVEZWVwQmFpbENhbGwoKTsKIAogICAgIEpTX1JFUVVJUkVTX1NUQUNLIFJlY29y
ZGluZ1N0YXR1cyBwcmltaXRpdmVUb1N0cmluZ0luUGxhY2UoVmFsdWUqIHZwKTsKICAgICBKU19S
RVFVSVJFU19TVEFDSyB2b2lkIGZpbmlzaEdldFByb3AobmFub2ppdDo6TElucyogb2JqX2lucywg
bmFub2ppdDo6TElucyogdnBfaW5zLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICBuYW5vaml0OjpMSW5zKiBva19pbnMsIFZhbHVlKiBvdXRwKTsKICAgICBKU19SRVFV
SVJFU19TVEFDSyBSZWNvcmRpbmdTdGF0dXMgZ2V0UHJvcGVydHlCeU5hbWUobmFub2ppdDo6TElu
cyogb2JqX2lucywgVmFsdWUqIGlkdmFscCwKZGlmZiAtLWdpdCBhL2pzL3NyYy9qc3hkcmFwaS5o
IGIvanMvc3JjL2pzeGRyYXBpLmgKLS0tIGEvanMvc3JjL2pzeGRyYXBpLmgKKysrIGIvanMvc3Jj
L2pzeGRyYXBpLmgKQEAgLTIyNiwxNyArMjI2LDE3IEBAIEpTX1hEUkZpbmRDbGFzc0J5SWQoSlNY
RFJTdGF0ZSAqeGRyLCB1aW4KICAqIEJ5dGVjb2RlIHZlcnNpb24gbnVtYmVyLiBJbmNyZW1lbnQg
dGhlIHN1YnRyYWhlbmQgd2hlbmV2ZXIgSlMgYnl0ZWNvZGUKICAqIGNoYW5nZXMgaW5jb21wYXRp
Ymx5LgogICoKICAqIFRoaXMgdmVyc2lvbiBudW1iZXIgc2hvdWxkIGJlIFhEUidlZCBvbmNlIG5l
YXIgdGhlIGZyb250IG9mIGFueSBmaWxlIG9yCiAgKiBsYXJnZXIgc3RvcmFnZSB1bml0IGNvbnRh
aW5pbmcgWERSJ2VkIGJ5dGVjb2RlIGFuZCBvdGhlciBkYXRhLCBhbmQgY2hlY2tlZAogICogYmVm
b3JlIGRlc2VyaWFsaXphdGlvbiBvZiBieXRlY29kZS4gIElmIHRoZSBzYXZlZCB2ZXJzaW9uIGRv
ZXMgbm90IG1hdGNoCiAgKiB0aGUgY3VycmVudCB2ZXJzaW9uLCBhYm9ydCBkZXNlcmlhbGl6YXRp
b24gYW5kIGludmFsaWRhdGUgdGhlIGZpbGUuCiAgKi8KLSNkZWZpbmUgSlNYRFJfQllURUNPREVf
VkVSU0lPTiAgICAgICgweGI5NzNjMGRlIC0gODUpCisjZGVmaW5lIEpTWERSX0JZVEVDT0RFX1ZF
UlNJT04gICAgICAoMHhiOTczYzBkZSAtIDg2KQogCiAvKgogICogTGlicmFyeS1wcml2YXRlIGZ1
bmN0aW9ucy4KICAqLwogZXh0ZXJuIEpTQm9vbAoganNfWERSQXRvbShKU1hEUlN0YXRlICp4ZHIs
IEpTQXRvbSAqKmF0b21wKTsKIAogSlNfRU5EX0VYVEVSTl9DCmRpZmYgLS1naXQgYS9qcy9zcmMv
bWV0aG9kaml0L0NvbXBpbGVyLmNwcCBiL2pzL3NyYy9tZXRob2RqaXQvQ29tcGlsZXIuY3BwCi0t
LSBhL2pzL3NyYy9tZXRob2RqaXQvQ29tcGlsZXIuY3BwCisrKyBiL2pzL3NyYy9tZXRob2RqaXQv
Q29tcGlsZXIuY3BwCkBAIC0xMDA5LDI3ICsxMDA5LDE5IEBAIG1qaXQ6OkNvbXBpbGVyOjpnZW5l
cmF0ZU1ldGhvZCgpCiAgICAgICAgICAgICAgKi8KICAgICAgICAgICAgIGlmIChjYW5Vc2VBcHBs
eVRyaWNrcygpKQogICAgICAgICAgICAgICAgIGFwcGx5VHJpY2tzID0gTGF6eUFyZ3NPYmo7CiAg
ICAgICAgICAgICBlbHNlCiAgICAgICAgICAgICAgICAganNvcF9hcmd1bWVudHMoKTsKICAgICAg
ICAgICAgIGZyYW1lLnB1c2hTeW5jZWQoKTsKICAgICAgICAgICBFTkRfQ0FTRShKU09QX0FSR1VN
RU5UUykKIAotICAgICAgICAgIEJFR0lOX0NBU0UoSlNPUF9GT1JBUkcpCi0gICAgICAgICAgICBp
dGVyTmV4dCgpOwotICAgICAgICAgICAgZnJhbWUuc3RvcmVBcmcoR0VUX1NMT1ROTyhQQyksIHRy
dWUpOwotICAgICAgICAgICAgZnJhbWUucG9wKCk7Ci0gICAgICAgICAgRU5EX0NBU0UoSlNPUF9G
T1JBUkcpCi0KLSAgICAgICAgICBCRUdJTl9DQVNFKEpTT1BfRk9STE9DQUwpCi0gICAgICAgICAg
ICBpdGVyTmV4dCgpOwotICAgICAgICAgICAgZnJhbWUuc3RvcmVMb2NhbChHRVRfU0xPVE5PKFBD
KSwgdHJ1ZSk7Ci0gICAgICAgICAgICBmcmFtZS5wb3AoKTsKLSAgICAgICAgICBFTkRfQ0FTRShK
U09QX0ZPUkxPQ0FMKQorICAgICAgICAgIEJFR0lOX0NBU0UoSlNPUF9JVEVSTkVYVCkKKyAgICAg
ICAgICAgIGl0ZXJOZXh0KFBDWzFdKTsKKyAgICAgICAgICBFTkRfQ0FTRShKU09QX0lURVJORVhU
KQogCiAgICAgICAgICAgQkVHSU5fQ0FTRShKU09QX0RVUCkKICAgICAgICAgICAgIGZyYW1lLmR1
cCgpOwogICAgICAgICAgIEVORF9DQVNFKEpTT1BfRFVQKQogCiAgICAgICAgICAgQkVHSU5fQ0FT
RShKU09QX0RVUDIpCiAgICAgICAgICAgICBmcmFtZS5kdXAyKCk7CiAgICAgICAgICAgRU5EX0NB
U0UoSlNPUF9EVVAyKQpAQCAtMTY0NSwzNCArMTYzNywxNiBAQCBtaml0OjpDb21waWxlcjo6Z2Vu
ZXJhdGVNZXRob2QoKQogICAgICAgICAgICAganNvcF9sb2NhbGluYyhvcCwgR0VUX1NMT1ROTyhQ
QyksIHBvcHBlZCk7CiAgICAgICAgICAgICBQQyArPSBKU09QX0xPQ0FMSU5DX0xFTkdUSDsKICAg
ICAgICAgICAgIGlmIChwb3BwZWQpCiAgICAgICAgICAgICAgICAgUEMgKz0gSlNPUF9QT1BfTEVO
R1RIOwogICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgfQogICAgICAgICAgIEVORF9DQVNF
KEpTT1BfTE9DQUxERUMpCiAKLSAgICAgICAgICBCRUdJTl9DQVNFKEpTT1BfRk9STkFNRSkKLSAg
ICAgICAgICAgIGpzb3BfZm9ybmFtZShzY3JpcHQtPmdldEF0b20oZnVsbEF0b21JbmRleChQQykp
KTsKLSAgICAgICAgICBFTkRfQ0FTRShKU09QX0ZPUk5BTUUpCi0KLSAgICAgICAgICBCRUdJTl9D
QVNFKEpTT1BfRk9SR05BTUUpCi0gICAgICAgICAgICBqc29wX2ZvcmduYW1lKHNjcmlwdC0+Z2V0
QXRvbShmdWxsQXRvbUluZGV4KFBDKSkpOwotICAgICAgICAgIEVORF9DQVNFKEpTT1BfRk9SR05B
TUUpCi0KLSAgICAgICAgICBCRUdJTl9DQVNFKEpTT1BfRk9SUFJPUCkKLSAgICAgICAgICAgIGpz
b3BfZm9ycHJvcChzY3JpcHQtPmdldEF0b20oZnVsbEF0b21JbmRleChQQykpKTsKLSAgICAgICAg
ICBFTkRfQ0FTRShKU09QX0ZPUlBST1ApCi0KLSAgICAgICAgICBCRUdJTl9DQVNFKEpTT1BfRk9S
RUxFTSkKLSAgICAgICAgICAgIC8vIFRoaXMgb3Bjb2RlIGlzIGZvciB0aGUgZGVjb21waWxlcjsg
aXQgaXMgc3VjY2VlZGVkIGJ5IGFuCi0gICAgICAgICAgICAvLyBFTlVNRUxFTSwgd2hpY2ggcGVy
Zm9ybXMgdGhlIGFjdHVhbCBhcnJheSBzdG9yZS4KLSAgICAgICAgICAgIGl0ZXJOZXh0KCk7Ci0g
ICAgICAgICAgRU5EX0NBU0UoSlNPUF9GT1JFTEVNKQotCiAgICAgICAgICAgQkVHSU5fQ0FTRShK
U09QX0JJTkROQU1FKQogICAgICAgICAgICAganNvcF9iaW5kbmFtZShzY3JpcHQtPmdldEF0b20o
ZnVsbEF0b21JbmRleChQQykpLCB0cnVlKTsKICAgICAgICAgICBFTkRfQ0FTRShKU09QX0JJTkRO
QU1FKQogCiAgICAgICAgICAgQkVHSU5fQ0FTRShKU09QX1NFVFBST1ApCiAgICAgICAgICAgICBp
ZiAoIWpzb3Bfc2V0cHJvcChzY3JpcHQtPmdldEF0b20oZnVsbEF0b21JbmRleChQQykpLCB0cnVl
KSkKICAgICAgICAgICAgICAgICByZXR1cm4gQ29tcGlsZV9FcnJvcjsKICAgICAgICAgICBFTkRf
Q0FTRShKU09QX1NFVFBST1ApCkBAIC00MTEwLDIzICs0MDg0LDIzIEBAIG1qaXQ6OkNvbXBpbGVy
OjppdGVyKHVpbnROIGZsYWdzKQogICAgIGZyYW1lLnB1c2hUeXBlZFBheWxvYWQoSlNWQUxfVFlQ
RV9PQkpFQ1QsIGlvcmVnKTsKIAogICAgIHN0dWJjYy5yZWpvaW4oQ2hhbmdlcygxKSk7CiAKICAg
ICByZXR1cm4gdHJ1ZTsKIH0KIAogLyoKLSAqIFRoaXMgYmlnIG5hc3R5IGZ1bmN0aW9uIGVtaXRz
IGEgZmFzdC1wYXRoIGZvciBuYXRpdmUgaXRlcmF0b3JzLCBwcm9kdWNpbmcKLSAqIGEgdGVtcG9y
YXJ5IHZhbHVlIG9uIHRoZSBzdGFjayBmb3IgRk9STE9DQUwsQVJHLEdMT0JBTCxldGMgb3BzIHRv
IHVzZS4KKyAqIFRoaXMgYmlnIG5hc3R5IGZ1bmN0aW9uIGltcGxlbWVudHMgSlNPUF9JVEVSTkVY
VCwgd2hpY2ggaXMgdXNlZCBpbiB0aGUgaGVhZAorICogb2YgYSBmb3ItaW4gbG9vcCB0byBwdXQg
dGhlIG5leHQgdmFsdWUgb24gdGhlIHN0YWNrLgogICovCiB2b2lkCi1taml0OjpDb21waWxlcjo6
aXRlck5leHQoKQorbWppdDo6Q29tcGlsZXI6Oml0ZXJOZXh0KHB0cmRpZmZfdCBvZmZzZXQpCiB7
Ci0gICAgRnJhbWVFbnRyeSAqZmUgPSBmcmFtZS5wZWVrKC0xKTsKKyAgICBGcmFtZUVudHJ5ICpm
ZSA9IGZyYW1lLnBlZWsoLW9mZnNldCk7CiAgICAgUmVnaXN0ZXJJRCByZWcgPSBmcmFtZS50ZW1w
UmVnRm9yRGF0YShmZSk7CiAKICAgICAvKiBJcyBpdCB3b3J0aCB0cnlpbmcgdG8gcGluIHRoaXMg
bG9uZ2VyPyBQcm9sbHkgbm90LiAqLwogICAgIGZyYW1lLnBpblJlZyhyZWcpOwogICAgIFJlZ2lz
dGVySUQgVDEgPSBmcmFtZS5hbGxvY1JlZygpOwogICAgIGZyYW1lLnVucGluUmVnKHJlZyk7CiAK
ICAgICAvKiBUZXN0IGNsYXNwICovCkBAIC00MTYwLDE2ICs0MTM0LDE3IEBAIG1qaXQ6OkNvbXBp
bGVyOjppdGVyTmV4dCgpCiAgICAgbWFzbS5hZGRQdHIoSW1tMzIoc2l6ZW9mKGpzaWQpKSwgVDIs
IFQ0KTsKICAgICBtYXNtLnN0b3JlUHRyKFQ0LCBBZGRyZXNzKFQxLCBvZmZzZXRvZihOYXRpdmVJ
dGVyYXRvciwgcHJvcHNfY3Vyc29yKSkpOwogCiAgICAgZnJhbWUuZnJlZVJlZyhUNCk7CiAgICAg
ZnJhbWUuZnJlZVJlZyhUMSk7CiAgICAgZnJhbWUuZnJlZVJlZyhUMik7CiAKICAgICBzdHViY2Mu
bGVhdmUoKTsKKyAgICBzdHViY2MubWFzbS5tb3ZlKEltbTMyKG9mZnNldCksIFJlZ2lzdGVyczo6
QXJnUmVnMSk7CiAgICAgT09MX1NUVUJDQUxMKHN0dWJzOjpJdGVyTmV4dCk7CiAKICAgICBmcmFt
ZS5wdXNoVW50eXBlZFBheWxvYWQoSlNWQUxfVFlQRV9TVFJJTkcsIFQzKTsKIAogICAgIC8qIEpv
aW4gd2l0aCB0aGUgc3R1YiBjYWxsLiAqLwogICAgIHN0dWJjYy5yZWpvaW4oQ2hhbmdlcygxKSk7
CiB9CiAKQEAgLTQ5OTQsNzAgKzQ5NjksOCBAQCB2b2lkCiBtaml0OjpDb21waWxlcjo6anNvcF9j
YWxsZWxlbV9zbG93KCkKIHsKICAgICBwcmVwYXJlU3R1YkNhbGwoVXNlcygyKSk7CiAgICAgSU5M
SU5FX1NUVUJDQUxMKHN0dWJzOjpDYWxsRWxlbSk7CiAgICAgZnJhbWUucG9wbigyKTsKICAgICBm
cmFtZS5wdXNoU3luY2VkKCk7CiAgICAgZnJhbWUucHVzaFN5bmNlZCgpOwogfQotCi12b2lkCi1t
aml0OjpDb21waWxlcjo6anNvcF9mb3Jwcm9wKEpTQXRvbSAqYXRvbSkKLXsKLSAgICAvLyBCZWZv
cmU6IElURVIgT0JKCi0gICAgLy8gQWZ0ZXI6ICBJVEVSIE9CSiBJVEVSCi0gICAgZnJhbWUuZHVw
QXQoLTIpOwotCi0gICAgLy8gQmVmb3JlOiBJVEVSIE9CSiBJVEVSIAotICAgIC8vIEFmdGVyOiAg
SVRFUiBPQkogSVRFUiBWQUxVRQotICAgIGl0ZXJOZXh0KCk7Ci0KLSAgICAvLyBCZWZvcmU6IElU
RVIgT0JKIElURVIgVkFMVUUKLSAgICAvLyBBZnRlcjogIElURVIgT0JKIFZBTFVFCi0gICAgZnJh
bWUuc2hpbW15KDEpOwotCi0gICAgLy8gQmVmb3JlOiBJVEVSIE9CSiBWQUxVRQotICAgIC8vIEFm
dGVyOiAgSVRFUiBWQUxVRQotICAgIGpzb3Bfc2V0cHJvcChhdG9tLCBmYWxzZSk7Ci0KLSAgICAv
LyBCZWZvcmU6IElURVIgVkFMVUUKLSAgICAvLyBBZnRlcjogIElURVIKLSAgICBmcmFtZS5wb3Ao
KTsKLX0KLQotdm9pZAotbWppdDo6Q29tcGlsZXI6Ompzb3BfZm9ybmFtZShKU0F0b20gKmF0b20p
Ci17Ci0gICAgLy8gQmVmb3JlOiBJVEVSCi0gICAgLy8gQWZ0ZXI6ICBJVEVSIFNDT1BFT0JKCi0g
ICAganNvcF9iaW5kbmFtZShhdG9tLCBmYWxzZSk7Ci0gICAganNvcF9mb3Jwcm9wKGF0b20pOwot
fQotCi12b2lkCi1taml0OjpDb21waWxlcjo6anNvcF9mb3JnbmFtZShKU0F0b20gKmF0b20pCi17
Ci0gICAgLy8gQmVmb3JlOiBJVEVSCi0gICAgLy8gQWZ0ZXI6ICBJVEVSIEdMT0JBTAotICAgIGpz
b3BfYmluZGduYW1lKCk7Ci0KLSAgICAvLyBCZWZvcmU6IElURVIgR0xPQkFMCi0gICAgLy8gQWZ0
ZXI6ICBJVEVSIEdMT0JBTCBJVEVSCi0gICAgZnJhbWUuZHVwQXQoLTIpOwotCi0gICAgLy8gQmVm
b3JlOiBJVEVSIEdMT0JBTCBJVEVSIAotICAgIC8vIEFmdGVyOiAgSVRFUiBHTE9CQUwgSVRFUiBW
QUxVRQotICAgIGl0ZXJOZXh0KCk7Ci0KLSAgICAvLyBCZWZvcmU6IElURVIgR0xPQkFMIElURVIg
VkFMVUUKLSAgICAvLyBBZnRlcjogIElURVIgR0xPQkFMIFZBTFVFCi0gICAgZnJhbWUuc2hpbW15
KDEpOwotCi0gICAgLy8gQmVmb3JlOiBJVEVSIEdMT0JBTCBWQUxVRQotICAgIC8vIEFmdGVyOiAg
SVRFUiBWQUxVRQotICAgIGpzb3Bfc2V0Z25hbWUoYXRvbSwgZmFsc2UpOwotCi0gICAgLy8gQmVm
b3JlOiBJVEVSIFZBTFVFCi0gICAgLy8gQWZ0ZXI6ICBJVEVSCi0gICAgZnJhbWUucG9wKCk7Ci19
Ci0KZGlmZiAtLWdpdCBhL2pzL3NyYy9tZXRob2RqaXQvQ29tcGlsZXIuaCBiL2pzL3NyYy9tZXRo
b2RqaXQvQ29tcGlsZXIuaAotLS0gYS9qcy9zcmMvbWV0aG9kaml0L0NvbXBpbGVyLmgKKysrIGIv
anMvc3JjL21ldGhvZGppdC9Db21waWxlci5oCkBAIC00MDAsMTcgKzQwMCwxNyBAQCBjbGFzcyBD
b21waWxlciA6IHB1YmxpYyBCYXNlQ29tcGlsZXIKICAgICBib29sIGp1bXBJblNjcmlwdChKdW1w
IGosIGpzYnl0ZWNvZGUgKnBjKTsKICAgICBib29sIGNvbXBhcmVUd29WYWx1ZXMoSlNDb250ZXh0
ICpjeCwgSlNPcCBvcCwgY29uc3QgVmFsdWUgJmxocywgY29uc3QgVmFsdWUgJnJocyk7CiAgICAg
Ym9vbCBjYW5Vc2VBcHBseVRyaWNrcygpOwogCiAgICAgLyogRW1pdHRpbmcgaGVscGVycy4gKi8K
ICAgICB2b2lkIHJlc3RvcmVGcmFtZVJlZ3MoQXNzZW1ibGVyICZtYXNtKTsKICAgICBib29sIGVt
aXRTdHViQ21wT3AoQm9vbFN0dWIgc3R1YiwganNieXRlY29kZSAqdGFyZ2V0LCBKU09wIGZ1c2Vk
KTsKICAgICBib29sIGl0ZXIodWludE4gZmxhZ3MpOwotICAgIHZvaWQgaXRlck5leHQoKTsKKyAg
ICB2b2lkIGl0ZXJOZXh0KHB0cmRpZmZfdCBvZmZzZXQpOwogICAgIGJvb2wgaXRlck1vcmUoKTsK
ICAgICB2b2lkIGl0ZXJFbmQoKTsKICAgICBNYXliZUp1bXAgbG9hZERvdWJsZShGcmFtZUVudHJ5
ICpmZSwgRlBSZWdpc3RlcklEIGZwUmVnKTsKICNpZmRlZiBKU19QT0xZSUMKICAgICB2b2lkIHBh
c3NJQ0FkZHJlc3MoQmFzZUlDSW5mbyAqaWMpOwogI2VuZGlmCiAjaWZkZWYgSlNfTU9OT0lDCiAg
ICAgdm9pZCBwYXNzTUlDQWRkcmVzcyhHbG9iYWxOYW1lSUNJbmZvICZtaWMpOwpAQCAtNDY2LDE5
ICs0NjYsMTYgQEAgY2xhc3MgQ29tcGlsZXIgOiBwdWJsaWMgQmFzZUNvbXBpbGVyCiAgICAgYm9v
bCBqc29wX2luc3RhbmNlb2YoKTsKICAgICB2b2lkIGpzb3BfbmFtZShKU0F0b20gKmF0b20pOwog
ICAgIGJvb2wganNvcF94bmFtZShKU0F0b20gKmF0b20pOwogICAgIHZvaWQgZW50ZXJCbG9jayhK
U09iamVjdCAqb2JqKTsKICAgICB2b2lkIGxlYXZlQmxvY2soKTsKICAgICB2b2lkIGVtaXRFdmFs
KHVpbnQzMiBhcmdjKTsKICAgICB2b2lkIGpzb3BfYXJndW1lbnRzKCk7CiAgICAgYm9vbCBqc29w
X3RhYmxlc3dpdGNoKGpzYnl0ZWNvZGUgKnBjKTsKLSAgICB2b2lkIGpzb3BfZm9ycHJvcChKU0F0
b20gKmF0b20pOwotICAgIHZvaWQganNvcF9mb3JuYW1lKEpTQXRvbSAqYXRvbSk7Ci0gICAgdm9p
ZCBqc29wX2ZvcmduYW1lKEpTQXRvbSAqYXRvbSk7CiAKICAgICAvKiBGYXN0IGFyaXRobWV0aWMu
ICovCiAgICAgdm9pZCBqc29wX2JpbmFyeShKU09wIG9wLCBWb2lkU3R1YiBzdHViKTsKICAgICB2
b2lkIGpzb3BfYmluYXJ5X2Z1bGwoRnJhbWVFbnRyeSAqbGhzLCBGcmFtZUVudHJ5ICpyaHMsIEpT
T3Agb3AsIFZvaWRTdHViIHN0dWIpOwogICAgIHZvaWQganNvcF9iaW5hcnlfZnVsbF9zaW1wbGUo
RnJhbWVFbnRyeSAqZmUsIEpTT3Agb3AsIFZvaWRTdHViIHN0dWIpOwogICAgIHZvaWQganNvcF9i
aW5hcnlfZG91YmxlKEZyYW1lRW50cnkgKmxocywgRnJhbWVFbnRyeSAqcmhzLCBKU09wIG9wLCBW
b2lkU3R1YiBzdHViKTsKICAgICB2b2lkIHNsb3dMb2FkQ29uc3RhbnREb3VibGUoQXNzZW1ibGVy
ICZtYXNtLCBGcmFtZUVudHJ5ICpmZSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
RlBSZWdpc3RlcklEIGZwcmVnKTsKZGlmZiAtLWdpdCBhL2pzL3NyYy9tZXRob2RqaXQvU3R1YkNh
bGxzLmNwcCBiL2pzL3NyYy9tZXRob2RqaXQvU3R1YkNhbGxzLmNwcAotLS0gYS9qcy9zcmMvbWV0
aG9kaml0L1N0dWJDYWxscy5jcHAKKysrIGIvanMvc3JjL21ldGhvZGppdC9TdHViQ2FsbHMuY3Bw
CkBAIC0yMTE2LDIyICsyMTE2LDIyIEBAIHN0dWJzOjpJbml0UHJvcChWTUZyYW1lICZmLCBKU0F0
b20gKmF0b20KIAogdm9pZCBKU19GQVNUQ0FMTAogc3R1YnM6OkluaXRNZXRob2QoVk1GcmFtZSAm
ZiwgSlNBdG9tICphdG9tKQogewogICAgIEluaXRQcm9wT3JNZXRob2QoZiwgYXRvbSwgSlNPUF9J
TklUTUVUSE9EKTsKIH0KIAogdm9pZCBKU19GQVNUQ0FMTAotc3R1YnM6Okl0ZXJOZXh0KFZNRnJh
bWUgJmYpCitzdHViczo6SXRlck5leHQoVk1GcmFtZSAmZiwgdWludDMyIG9mZnNldCkKIHsKLSAg
ICBKU19BU1NFUlQoZi5yZWdzLnNwIC0gMSA+PSBmLmZwKCktPmJhc2UoKSk7Ci0gICAgSlNfQVNT
RVJUKGYucmVncy5zcFstMV0uaXNPYmplY3QoKSk7CisgICAgSlNfQVNTRVJUKGYucmVncy5zcCAt
IG9mZnNldCA+PSBmLmZwKCktPmJhc2UoKSk7CisgICAgSlNfQVNTRVJUKGYucmVncy5zcFstb2Zm
c2V0XS5pc09iamVjdCgpKTsKIAotICAgIEpTT2JqZWN0ICppdGVyb2JqID0gJmYucmVncy5zcFst
MV0udG9PYmplY3QoKTsKKyAgICBKU09iamVjdCAqaXRlcm9iaiA9ICZmLnJlZ3Muc3BbLW9mZnNl
dF0udG9PYmplY3QoKTsKICAgICBmLnJlZ3Muc3BbMF0uc2V0TnVsbCgpOwogICAgIGYucmVncy5z
cCsrOwogICAgIGlmICghanNfSXRlcmF0b3JOZXh0KGYuY3gsIGl0ZXJvYmosICZmLnJlZ3Muc3Bb
LTFdKSkKICAgICAgICAgVEhST1coKTsKIH0KIAogSlNCb29sIEpTX0ZBU1RDQUxMCiBzdHViczo6
SXRlck1vcmUoVk1GcmFtZSAmZikKZGlmZiAtLWdpdCBhL2pzL3NyYy9tZXRob2RqaXQvU3R1YkNh
bGxzLmggYi9qcy9zcmMvbWV0aG9kaml0L1N0dWJDYWxscy5oCi0tLSBhL2pzL3NyYy9tZXRob2Rq
aXQvU3R1YkNhbGxzLmgKKysrIGIvanMvc3JjL21ldGhvZGppdC9TdHViQ2FsbHMuaApAQCAtMTk5
LDE3ICsxOTksMTcgQEAgdm9pZCBKU19GQVNUQ0FMTCBEaXYoVk1GcmFtZSAmZik7CiB2b2lkIEpT
X0ZBU1RDQUxMIE1vZChWTUZyYW1lICZmKTsKIHZvaWQgSlNfRkFTVENBTEwgTmVnKFZNRnJhbWUg
JmYpOwogdm9pZCBKU19GQVNUQ0FMTCBQb3MoVk1GcmFtZSAmZik7CiB2b2lkIEpTX0ZBU1RDQUxM
IE5vdChWTUZyYW1lICZmKTsKIHZvaWQgSlNfRkFTVENBTEwgU3RyaWN0RXEoVk1GcmFtZSAmZik7
CiB2b2lkIEpTX0ZBU1RDQUxMIFN0cmljdE5lKFZNRnJhbWUgJmYpOwogCiB2b2lkIEpTX0ZBU1RD
QUxMIEl0ZXIoVk1GcmFtZSAmZiwgdWludDMyIGZsYWdzKTsKLXZvaWQgSlNfRkFTVENBTEwgSXRl
ck5leHQoVk1GcmFtZSAmZik7Cit2b2lkIEpTX0ZBU1RDQUxMIEl0ZXJOZXh0KFZNRnJhbWUgJmYs
IHVpbnQzMiBvZmZzZXQpOwogSlNCb29sIEpTX0ZBU1RDQUxMIEl0ZXJNb3JlKFZNRnJhbWUgJmYp
Owogdm9pZCBKU19GQVNUQ0FMTCBFbmRJdGVyKFZNRnJhbWUgJmYpOwogCiBKU0Jvb2wgSlNfRkFT
VENBTEwgVmFsdWVUb0Jvb2xlYW4oVk1GcmFtZSAmZik7CiBKU1N0cmluZyAqIEpTX0ZBU1RDQUxM
IFR5cGVPZihWTUZyYW1lICZmKTsKIEpTQm9vbCBKU19GQVNUQ0FMTCBJbnN0YW5jZU9mKFZNRnJh
bWUgJmYpOwogdm9pZCBKU19GQVNUQ0FMTCBGYXN0SW5zdGFuY2VPZihWTUZyYW1lICZmKTsKIHZv
aWQgSlNfRkFTVENBTEwgQXJnQ250KFZNRnJhbWUgJmYpOw==
</data>

          </attachment>
      

    </bug>

</bugzilla>