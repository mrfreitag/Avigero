<?xml version="1.0" encoding="UTF-8" standalone="yes" ?>
<!DOCTYPE bugzilla SYSTEM "https://bugzilla.mozilla.org/bugzilla.dtd">

<bugzilla version="3.6.4+"
          urlbase="https://bugzilla.mozilla.org/"
          
          maintainer="bugzilla-admin@mozilla.org"
>

    <bug>
          <bug_id>648026</bug_id>
          
          <creation_ts>2011-04-06 10:26:00 -0700</creation_ts>
          <short_desc>Move Content Popup Helper out of FormHelperUI</short_desc>
          <delta_ts>2011-04-08 10:47:24 -0700</delta_ts>
          <reporter_accessible>1</reporter_accessible>
          <cclist_accessible>1</cclist_accessible>
          <classification_id>2</classification_id>
          <classification>Client Software</classification>
          <product>Fennec</product>
          <component>General</component>
          <version>Trunk</version>
          <rep_platform>All</rep_platform>
          <op_sys>All</op_sys>
          <bug_status>NEW</bug_status>
          
          
          
          
          
          
          <priority>--</priority>
          <bug_severity>normal</bug_severity>
          <target_milestone>---</target_milestone>
          
          <blocked>605365</blocked>
          
          <everconfirmed>1</everconfirmed>
          <reporter name="Vivien Nicolas (:vingtetun)">21</reporter>
          <assigned_to name="Vivien Nicolas (:vingtetun)">21</assigned_to>
          
          <qa_contact>general</qa_contact>
          <cf_blocking_fennec>---</cf_blocking_fennec>
          <cf_blocking_fx>---</cf_blocking_fx>
          <cf_blocking_20>---</cf_blocking_20>
          <cf_status_20>---</cf_status_20>
          <cf_blocking_192>---</cf_blocking_192>
          <cf_status_192>---</cf_status_192>
          <cf_blocking_191>---</cf_blocking_191>
          <cf_status_191>---</cf_status_191>
          
          
          
          
          
          
          
          
          
          

      

      

      

          <long_desc isprivate="0">
            <commentid>5392529</commentid>
              <attachid>524209</attachid>
            <who name="Vivien Nicolas (:vingtetun)">21</who>
            <bug_when>2011-04-06 10:26:00 -0700</bug_when>
            <thetext>Created attachment 524209
Patch

The content popup code can be useful for others stuff too, and extension developers will be able to add things on top of it. Moving it out of FormHelperUI also means a simpler FormHelperUI code and a feature easier to test.</thetext>
          </long_desc>
          <long_desc isprivate="0">
            <commentid>5396071</commentid>
              <attachid>524209</attachid>
            <who name="Mark Finkle (:mfinkle)">mark.finkle</who>
            <bug_when>2011-04-07 23:41:00 -0700</bug_when>
            <thetext>Comment on attachment 524209
Patch

&gt;diff --git a/chrome/content/ContentPopupHelper.js b/chrome/content/ContentPopupHelper.js

&gt;+var ContentPopupHelper = {
&gt;+  init: function() {
&gt;+    window.addEventListener(&quot;TabSelect&quot;, this, false);
&gt;+    window.addEventListener(&quot;TabClose&quot;, this, false);
&gt;+    Elements.browsers.addEventListener(&quot;PanBegin&quot;, this, false);
&gt;+    Elements.browsers.addEventListener(&quot;PanFinished&quot;, this, false);
&gt;+    window.addEventListener(&quot;AnimatedZoomBegin&quot;, this, false);
&gt;+    window.addEventListener(&quot;AnimatedZoomEnd&quot;, this, false);
&gt;+    window.addEventListener(&quot;MozBeforeResize&quot;, this, true);
&gt;+    window.addEventListener(&quot;resize&quot;, this, false);
&gt;+  },

It looks like we can delay adding event listeners until the &quot;popup&quot; setter. We should remove the even listeners too, when popup = null

&gt;+   * This method positionned an arrowbox on the screen using a &apos;virtual&apos;

positioned

&gt;+  update: function(aAnchorRect) {

if we are anchoring, why not call this &quot;anchorTo&quot; instead of &quot;update&quot; ?

&gt;+      case &quot;PanFinished&quot;:
&gt;+      case &quot;AnimatedZoomEnd&quot;:
&gt;+        popup.style.visibility = &quot;visible&quot;;
&gt;+        //this.update();

remove the code if it&apos;s not needed

&gt;diff --git a/chrome/content/browser-ui.js b/chrome/content/browser-ui.js
&gt;       FindHelperUI.init();
&gt;+      ContentPopupHelper.init();

No thank you. We should not need to init this unless a popup is being displayed, unless I am missing something.

&gt;diff --git a/chrome/content/common-ui.js b/chrome/content/common-ui.js

&gt;   _updateSuggestionsFor: function _formHelperUpdateAutocompleteFor(aElement) {

&gt;     let suggestionsContainer = this._suggestionsContainer;
&gt;-    suggestionsContainer.style.visibility = &quot;hidden&quot;;
&gt;-    suggestionsContainer.hidden = false;
&gt;-    suggestionsContainer.left = 0;

Do we really need to keep suggestionsContainer? If we do, move it closer to the first use.

&gt;diff --git a/chrome/tests/browser_autocomplete.js b/chrome/tests/browser_autocomplete.js

&gt;-  newTab = Browser.addTab(testURL, true);
&gt;+  let startupInfo = Cc[&quot;@mozilla.org/toolkit/app-startup;1&quot;].getService(Ci.nsIAppStartup).getStartupInfo();
&gt;+  if (!(&quot;firstPaint&quot; in startupInfo))
&gt;+    waitFor(function() { newTab = Browser.addTab(testURL, true); }, function() {
&gt;+      let startupInfo = Cc[&quot;@mozilla.org/toolkit/app-startup;1&quot;].getService(Ci.nsIAppStartup).getStartupInfo();
&gt;+      return (&quot;firstPaint&quot; in startupInfo);
&gt;+    }, Date.now() + 3000);
&gt;+  else
&gt;+    newTab = Browser.addTab(testURL, true);


Oh my. What is going on here?

&gt;diff --git a/chrome/tests/browser_contentpopup.js b/chrome/tests/browser_contentpopup.js

&gt;+  let startupInfo = Cc[&quot;@mozilla.org/toolkit/app-startup;1&quot;].getService(Ci.nsIAppStartup).getStartupInfo();
&gt;+  if (!(&quot;firstPaint&quot; in startupInfo))
&gt;+    waitFor(function() { newTab = Browser.addTab(testURL, true); }, function() {
&gt;+      let startupInfo = Cc[&quot;@mozilla.org/toolkit/app-startup;1&quot;].getService(Ci.nsIAppStartup).getStartupInfo();
&gt;+      return (&quot;firstPaint&quot; in startupInfo);
&gt;+    }, Date.now() + 3000);
&gt;+  else
&gt;+    newTab = Browser.addTab(testURL, true);
&gt;+}

And here

r- for a new patch and answers to some questions</thetext>
          </long_desc>
          <long_desc isprivate="0">
            <commentid>5396864</commentid>
              <attachid>524677</attachid>
            <who name="Vivien Nicolas (:vingtetun)">21</who>
            <bug_when>2011-04-08 10:47:24 -0700</bug_when>
            <thetext>Created attachment 524677
Patch v0.2

Address comments.

I&apos;ve not yet removed my &apos;firstPaint&apos; hack for tests, for some reasons I need to wait for that on my laptop if I run the test alone to prevent random oranges.
I can remove it if needed, it won&apos;t affect the browser-chrome tests when run as a test suite.</thetext>
          </long_desc>
      
          <attachment
              isobsolete="1"
              ispatch="1"
              isprivate="0"
              isurl="0"
          >
            <attachid>524209</attachid>
            <date>2011-04-06 10:26:00 -0700</date>
            <delta_ts>2011-04-08 10:47:24 -0700</delta_ts>
            <desc>Patch</desc>
            <filename>separate-contentpopuphelper.diff</filename>
            <type>text/plain</type>
            <size>39720</size>
            <attacher>21</attacher>
            
              <data encoding="base64">ZGlmZiAtLWdpdCBhL2Nocm9tZS9jb250ZW50L0NvbnRlbnRQb3B1cEhlbHBlci5qcyBiL2Nocm9t
ZS9jb250ZW50L0NvbnRlbnRQb3B1cEhlbHBlci5qcwpuZXcgZmlsZSBtb2RlIDEwMDY0NAotLS0g
L2Rldi9udWxsCisrKyBiL2Nocm9tZS9jb250ZW50L0NvbnRlbnRQb3B1cEhlbHBlci5qcwpAQCAt
MCwwICsxLDIyMCBAQAorLyogKioqKiogQkVHSU4gTElDRU5TRSBCTE9DSyAqKioqKgorICogVmVy
c2lvbjogTVBMIDEuMS9HUEwgMi4wL0xHUEwgMi4xCisgKgorICogVGhlIGNvbnRlbnRzIG9mIHRo
aXMgZmlsZSBhcmUgc3ViamVjdCB0byB0aGUgTW96aWxsYSBQdWJsaWMgTGljZW5zZSBWZXJzaW9u
CisgKiAxLjEgKHRoZSAiTGljZW5zZSIpOyB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2Vw
dCBpbiBjb21wbGlhbmNlIHdpdGgKKyAqIHRoZSBMaWNlbnNlLiBZb3UgbWF5IG9idGFpbiBhIGNv
cHkgb2YgdGhlIExpY2Vuc2UgYXQKKyAqIGh0dHA6Ly93d3cubW96aWxsYS5vcmcvTVBMLworICoK
KyAqIFNvZnR3YXJlIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVk
IG9uIGFuICJBUyBJUyIgYmFzaXMsCisgKiBXSVRIT1VUIFdBUlJBTlRZIE9GIEFOWSBLSU5ELCBl
aXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLiBTZWUgdGhlIExpY2Vuc2UKKyAqIGZvciB0aGUgc3Bl
Y2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHJpZ2h0cyBhbmQgbGltaXRhdGlvbnMgdW5kZXIgdGhl
CisgKiBMaWNlbnNlLgorICoKKyAqIFRoZSBPcmlnaW5hbCBDb2RlIGlzIG1vemlsbGEub3JnIGNv
ZGUKKyAqCisgKiBUaGUgSW5pdGlhbCBEZXZlbG9wZXIgb2YgdGhlIE9yaWdpbmFsIENvZGUgaXMK
KyAqIE1vemlsbGEgQ29ycG9yYXRpb24uCisgKiBQb3J0aW9ucyBjcmVhdGVkIGJ5IHRoZSBJbml0
aWFsIERldmVsb3BlciBhcmUgQ29weXJpZ2h0IChDKSAyMDA3CisgKiB0aGUgSW5pdGlhbCBEZXZl
bG9wZXIuIEFsbCBSaWdodHMgUmVzZXJ2ZWQuCisgKgorICogQ29udHJpYnV0b3Iocyk6CisgKgor
ICogQWx0ZXJuYXRpdmVseSwgdGhlIGNvbnRlbnRzIG9mIHRoaXMgZmlsZSBtYXkgYmUgdXNlZCB1
bmRlciB0aGUgdGVybXMgb2YKKyAqIGVpdGhlciB0aGUgR05VIEdlbmVyYWwgUHVibGljIExpY2Vu
c2UgVmVyc2lvbiAyIG9yIGxhdGVyICh0aGUgIkdQTCIpLCBvcgorICogdGhlIEdOVSBMZXNzZXIg
R2VuZXJhbCBQdWJsaWMgTGljZW5zZSBWZXJzaW9uIDIuMSBvciBsYXRlciAodGhlICJMR1BMIiks
CisgKiBpbiB3aGljaCBjYXNlIHRoZSBwcm92aXNpb25zIG9mIHRoZSBHUEwgb3IgdGhlIExHUEwg
YXJlIGFwcGxpY2FibGUgaW5zdGVhZAorICogb2YgdGhvc2UgYWJvdmUuIElmIHlvdSB3aXNoIHRv
IGFsbG93IHVzZSBvZiB5b3VyIHZlcnNpb24gb2YgdGhpcyBmaWxlIG9ubHkKKyAqIHVuZGVyIHRo
ZSB0ZXJtcyBvZiBlaXRoZXIgdGhlIEdQTCBvciB0aGUgTEdQTCwgYW5kIG5vdCB0byBhbGxvdyBv
dGhlcnMgdG8KKyAqIHVzZSB5b3VyIHZlcnNpb24gb2YgdGhpcyBmaWxlIHVuZGVyIHRoZSB0ZXJt
cyBvZiB0aGUgTVBMLCBpbmRpY2F0ZSB5b3VyCisgKiBkZWNpc2lvbiBieSBkZWxldGluZyB0aGUg
cHJvdmlzaW9ucyBhYm92ZSBhbmQgcmVwbGFjZSB0aGVtIHdpdGggdGhlIG5vdGljZQorICogYW5k
IG90aGVyIHByb3Zpc2lvbnMgcmVxdWlyZWQgYnkgdGhlIEdQTCBvciB0aGUgTEdQTC4gSWYgeW91
IGRvIG5vdCBkZWxldGUKKyAqIHRoZSBwcm92aXNpb25zIGFib3ZlLCBhIHJlY2lwaWVudCBtYXkg
dXNlIHlvdXIgdmVyc2lvbiBvZiB0aGlzIGZpbGUgdW5kZXIKKyAqIHRoZSB0ZXJtcyBvZiBhbnkg
b25lIG9mIHRoZSBNUEwsIHRoZSBHUEwgb3IgdGhlIExHUEwuCisgKgorICogKioqKiogRU5EIExJ
Q0VOU0UgQkxPQ0sgKioqKiogKi8KKwordmFyIENvbnRlbnRQb3B1cEhlbHBlciA9IHsKKyAgaW5p
dDogZnVuY3Rpb24oKSB7CisgICAgd2luZG93LmFkZEV2ZW50TGlzdGVuZXIoIlRhYlNlbGVjdCIs
IHRoaXMsIGZhbHNlKTsKKyAgICB3aW5kb3cuYWRkRXZlbnRMaXN0ZW5lcigiVGFiQ2xvc2UiLCB0
aGlzLCBmYWxzZSk7CisgICAgRWxlbWVudHMuYnJvd3NlcnMuYWRkRXZlbnRMaXN0ZW5lcigiUGFu
QmVnaW4iLCB0aGlzLCBmYWxzZSk7CisgICAgRWxlbWVudHMuYnJvd3NlcnMuYWRkRXZlbnRMaXN0
ZW5lcigiUGFuRmluaXNoZWQiLCB0aGlzLCBmYWxzZSk7CisgICAgd2luZG93LmFkZEV2ZW50TGlz
dGVuZXIoIkFuaW1hdGVkWm9vbUJlZ2luIiwgdGhpcywgZmFsc2UpOworICAgIHdpbmRvdy5hZGRF
dmVudExpc3RlbmVyKCJBbmltYXRlZFpvb21FbmQiLCB0aGlzLCBmYWxzZSk7CisgICAgd2luZG93
LmFkZEV2ZW50TGlzdGVuZXIoIk1vekJlZm9yZVJlc2l6ZSIsIHRoaXMsIHRydWUpOworICAgIHdp
bmRvdy5hZGRFdmVudExpc3RlbmVyKCJyZXNpemUiLCB0aGlzLCBmYWxzZSk7CisgIH0sCisKKyAg
X3BvcHVwOiBudWxsLAorICBnZXQgcG9wdXAoKSB7CisgICAgcmV0dXJuIHRoaXMuX3BvcHVwOwor
ICB9LAorCisgIHNldCBwb3B1cChhUG9wdXApIHsKKyAgICAvLyBJZiB0aGVyZSBpcyBub3RoaW5n
IHRvIGRvIHRoZW4gYmFpbCBvdXQKKyAgICBpZiAoIXRoaXMuX3BvcHVwICYmICFhUG9wdXApCisg
ICAgICByZXR1cm47CisKKyAgICBpZiAoYVBvcHVwKSB7CisgICAgICAvLyBLZWVwcyB0aGUgbmV3
IHBvcHVwIGVsZW1lbnQgaGlkZGVuIHVudGlsIGl0IGlzIHBvc2l0aW9ubmVkLCBidXQgdXNpbmcK
KyAgICAgIC8vIHZpc2liaWxpdHk6ICdoaWRkZW4nIGluc3RlYWQgb2YgZGlzcGxheTogJ25vbmUn
IHdpbGwgYWxsb3cgdG8KKyAgICAgIC8vIHdvcmthcm91bmQgc29tZSBidWdzIHdpdGggYXJyb3dz
Y3JvbGxib3gncyBhcnJvd3MgdGhhdCBkb2VzIG5vdAorICAgICAgLy8gdXBkYXRlIHRoZWlyIGhp
ZGRlbiBzdGF0ZSBjb3JyZWN0bHkgd2hlbiB1c2VkIGFzIGEgY2hpbGQgKGJlY2F1c2Ugb2YKKyAg
ICAgIC8vIG1pc3NlZCB1bmRlcmZsb3cgZXZlbnRzKQorICAgICAgLy8KKyAgICAgIC8vIEFsc28g
dGhlIHBvcHVwIGlzIG1vdmVkIHRvIHRoZSBsZWZ0IGJvcmRlciBvZiB0aGUgd2luZG93IG90aGVy
d2lzZSB0aGUKKyAgICAgIC8vIHNpZGViYXJzIHBvc2l0aW9uIGFyZSBtZXNzZWQgdXAgd2hlbiB0
aGUgY29udGVudCBvZiB0aGUgcG9wdXAncyBjaGlsZAorICAgICAgLy8gaXMgdG9vIHdpZGUsIGJ1
dCBzaW5jZSB0aGUgc2l6ZSBvZiB0aGUgcG9wdXAgY2FuJ3QgYmUgbGFyZ2VyIHRoYW4gNzUlCisg
ICAgICAvLyBvZiB0aGUgd2luZG93IHdpZHRoIChzZWUgdGhlIHVwZGF0ZSBtZXRob2QpIHRoZW4g
dGhlIHByb2JsZW0gZG9lcyBub3QKKyAgICAgIC8vIGFwcGVhciBpZiB0aGUgcG9wdXAgaXMgcG9z
aXRpb25uZWQgYmV0d2VlbiAwLTI1JSBwZXJjZW50IG9mIHRoZSB3aW5kb3cKKyAgICAgIC8vIHdp
ZHRoCisgICAgICBhUG9wdXAubGVmdCA9IDA7CisgICAgICBhUG9wdXAuZmlyc3RDaGlsZC5zdHls
ZS5tYXhXaWR0aCA9ICIwcHgiOworICAgICAgYVBvcHVwLnN0eWxlLnZpc2liaWxpdHkgPSAiaGlk
ZGVuIjsKKyAgICAgIGFQb3B1cC5oaWRkZW4gPSBmYWxzZTsKKworICAgIH0gZWxzZSB7CisgICAg
ICB0aGlzLl9wb3B1cC5oaWRkZW4gPSB0cnVlOworICAgICAgdGhpcy5fYW5jaG9yUmVjdCA9IG51
bGw7CisKKyAgICAgIGxldCBldmVudCA9IGRvY3VtZW50LmNyZWF0ZUV2ZW50KCJFdmVudHMiKTsK
KyAgICAgIGV2ZW50LmluaXRFdmVudCgiY29udGVudHBvcHVwaGlkZGVuIiwgdHJ1ZSwgZmFsc2Up
OworICAgICAgdGhpcy5fcG9wdXAuZGlzcGF0Y2hFdmVudChldmVudCk7CisgICAgfQorCisgICAg
dGhpcy5fcG9wdXAgPSBhUG9wdXA7CisgIH0sCisKKyAgLyoqCisgICAqIFRoaXMgbWV0aG9kIHBv
c2l0aW9ubmVkIGFuIGFycm93Ym94IG9uIHRoZSBzY3JlZW4gdXNpbmcgYSAndmlydHVhbCcKKyAg
ICogZWxlbWVudCBhcyByZWZlcnJlciB0aGF0IG1hdGNoIHRoZSByZWFsIGNvbnRlbnQgZWxlbWVu
dAorICAgKiBUaGlzIG1ldGhvZCBjYWxsZWQgZWxlbWVudC5nZXRCb3VuZGluZ0NsaWVudFJlY3Qo
KSBtYW55IHRpbWVzIGFuZCBjYW4gYmUKKyAgICogZXhwZW5zaXZlLCBkbyBub3QgY2FsbGVkIGl0
IHRvbyBtYW55IHRpbWVzLgorICAgKi8KKyAgdXBkYXRlOiBmdW5jdGlvbihhQW5jaG9yUmVjdCkg
eworICAgIGxldCBwb3B1cCA9IHRoaXMuX3BvcHVwOworICAgIGlmICghcG9wdXApCisgICAgICBy
ZXR1cm47CisKKyAgICB0aGlzLl9hbmNob3JSZWN0ID0gYUFuY2hvclJlY3QgPyBhQW5jaG9yUmVj
dCA6IHRoaXMuX2FuY2hvclJlY3Q7CisKKyAgICAvLyBDYWxjdWxhdGUgdGhlIG1heGltdW0gc2l6
ZSBvZiB0aGUgYXJyb3dwYW5lbCBieSBhbGxvd2luZyBpdCB0byBsaXZlIG9ubHkKKyAgICAvLyBv
biB0aGUgdmlzaWJsZSBicm93c2VyIGFyZWEKKyAgICBsZXQgW2xlZnRWaXMsIHJpZ2h0VmlzLCBs
ZWZ0VywgcmlnaHRXXSA9IEJyb3dzZXIuY29tcHV0ZVNpZGViYXJWaXNpYmlsaXR5KCk7CisgICAg
bGV0IGxlZnRPZmZzZXQgPSBsZWZ0VmlzICogbGVmdFc7CisgICAgbGV0IHJpZ2h0T2Zmc2V0ID0g
cmlnaHRWaXMgKiByaWdodFc7CisgICAgbGV0IHZpc2libGVBcmVhV2lkdGggPSB3aW5kb3cuaW5u
ZXJXaWR0aCAtIGxlZnRPZmZzZXQgLSByaWdodE9mZnNldDsKKyAgICBwb3B1cC5maXJzdENoaWxk
LnN0eWxlLm1heFdpZHRoID0gKHZpc2libGVBcmVhV2lkdGggKiAwLjc1KSArICJweCI7CisKKyAg
ICBsZXQgYnJvd3NlciA9IGdldEJyb3dzZXIoKTsKKyAgICBsZXQgcmVjdCA9IHRoaXMuX2FuY2hv
clJlY3QuY2xvbmUoKS5zY2FsZShicm93c2VyLnNjYWxlLCBicm93c2VyLnNjYWxlKTsKKyAgICBs
ZXQgc2Nyb2xsID0gYnJvd3Nlci5nZXRSb290VmlldygpLmdldFBvc2l0aW9uKCk7CisKKyAgICAv
LyBUaGUgc2lkZWJhcnMgc2Nyb2xsIG5lZWRzIHRvIGJlIHRha2VuIGludG8gYWNjb3VudCwgb3Ro
ZXJ3aXNlIHRoZSBhcnJvd3MKKyAgICAvLyBjYW4gYmUgbWlzcGxhY2VkIGlmIHRoZSBzaWRlYmFy
cyBhcmUgb3BlbgorICAgIGxldCB0b3BPZmZzZXQgPSAoQnJvd3NlclVJLnRvb2xiYXJIIC0gQnJv
d3Nlci5nZXRTY3JvbGxib3hQb3NpdGlvbihCcm93c2VyLnBhZ2VTY3JvbGxib3hTY3JvbGxlciku
eSk7CisgICAgbGV0IHZpcnR1YWxDb250ZW50UmVjdCA9IHsKKyAgICAgIHdpZHRoOiByZWN0Lndp
ZHRoLAorICAgICAgaGVpZ2h0OiByZWN0LmhlaWdodCwKKyAgICAgIGxlZnQ6IE1hdGguY2VpbChy
ZWN0LmxlZnQgLSBzY3JvbGwueCArIGxlZnRPZmZzZXQgLSByaWdodE9mZnNldCksCisgICAgICBy
aWdodDogTWF0aC5mbG9vcihyZWN0LmxlZnQgKyByZWN0LndpZHRoIC0gc2Nyb2xsLnggKyBsZWZ0
T2Zmc2V0IC0gcmlnaHRPZmZzZXQpLAorICAgICAgdG9wOiBNYXRoLmNlaWwocmVjdC50b3AgLSBz
Y3JvbGwueSArIHRvcE9mZnNldCksCisgICAgICBib3R0b206IE1hdGguZmxvb3IocmVjdC50b3Ag
KyByZWN0LmhlaWdodCAtIHNjcm9sbC55ICsgdG9wT2Zmc2V0KQorICAgIH07CisKKyAgICAvLyBU
cmFuc2xhdGUgdGhlIHZpcnR1YWwgcmVjdCBpbnNpZGUgdGhlIGJvdW5kcyBvZiB0aGUgdmlld2Fi
bGUgYXJlYSBpZiBpdAorICAgIC8vIG92ZXJmbG93CisgICAgaWYgKHZpcnR1YWxDb250ZW50UmVj
dC5sZWZ0ICsgdmlydHVhbENvbnRlbnRSZWN0LndpZHRoID4gdmlzaWJsZUFyZWFXaWR0aCkgewor
ICAgICAgbGV0IG9mZnNldFggPSB2aXNpYmxlQXJlYVdpZHRoIC0gKHZpcnR1YWxDb250ZW50UmVj
dC5sZWZ0ICsgdmlydHVhbENvbnRlbnRSZWN0LndpZHRoKTsKKyAgICAgIHZpcnR1YWxDb250ZW50
UmVjdC53aWR0aCArPSBvZmZzZXRYOworICAgICAgdmlydHVhbENvbnRlbnRSZWN0LnJpZ2h0IC09
IG9mZnNldFg7CisgICAgfQorCisgICAgaWYgKHZpcnR1YWxDb250ZW50UmVjdC5sZWZ0IDwgbGVm
dE9mZnNldCkgeworICAgICAgbGV0IG9mZnNldFggPSAodmlydHVhbENvbnRlbnRSZWN0LnJpZ2h0
IC0gdmlydHVhbENvbnRlbnRSZWN0LndpZHRoKTsKKyAgICAgIHZpcnR1YWxDb250ZW50UmVjdC53
aWR0aCArPSBvZmZzZXRYOworICAgICAgdmlydHVhbENvbnRlbnRSZWN0LmxlZnQgLT0gb2Zmc2V0
WDsKKyAgICB9CisKKyAgICAvLyBJZiB0aGUgc3VnZ2VzdGlvbnMgYXJlIG91dCBvZiB2aWV3IHRo
ZXJlIGlzIG5vIG5lZWQgdG8gZGlzcGxheSBpdAorICAgIGxldCBicm93c2VyUmVjdCA9IFJlY3Qu
ZnJvbVJlY3QoYnJvd3Nlci5nZXRCb3VuZGluZ0NsaWVudFJlY3QoKSk7CisgICAgaWYgKEJyb3dz
ZXJVSS5pc1Rvb2xiYXJMb2NrZWQoKSkgeworICAgICAgLy8gSWYgdGhlIHRvb2xiYXIgaXMgbG9j
a2VkLCBpdCBjYW4gYXBwZWFyIG92ZXIgdGhlIGZpZWxkIGluIHN1Y2ggYSB3YXkKKyAgICAgIC8v
IHRoYXQgdGhlIGZpZWxkIGlzIGhpZGRlbgorICAgICAgbGV0IHRvb2xiYXJIID0gQnJvd3NlclVJ
LnRvb2xiYXJIOworICAgICAgYnJvd3NlclJlY3QgPSBuZXcgUmVjdChsZWZ0T2Zmc2V0IC0gcmln
aHRPZmZzZXQsIE1hdGgubWF4KDAsIGJyb3dzZXJSZWN0LnRvcCAtIHRvb2xiYXJIKSArIHRvb2xi
YXJILAorICAgICAgICAgICAgICAgICAgICAgICAgICAgICBicm93c2VyUmVjdC53aWR0aCArIGxl
ZnRPZmZzZXQgLSByaWdodE9mZnNldCwgYnJvd3NlclJlY3QuaGVpZ2h0IC0gdG9vbGJhckgpOwor
ICAgIH0KKworICAgIGlmIChicm93c2VyUmVjdC5pbnRlcnNlY3QoUmVjdC5mcm9tUmVjdCh2aXJ0
dWFsQ29udGVudFJlY3QpKS5pc0VtcHR5KCkpIHsKKyAgICAgIHBvcHVwLnN0eWxlLnZpc2liaWxp
dHkgPSAiaGlkZGVuIjsKKyAgICAgIHJldHVybjsKKyAgICB9CisKKyAgICAvLyBBZGRpbmcgcmVj
dC5oZWlnaHQgdG8gdGhlIHRvcCBtb3ZlcyB0aGUgYXJyb3dib3ggYmVsb3cgdGhlIHZpcnR1YWwg
ZmllbGQKKyAgICBsZXQgbGVmdCA9IHJlY3QubGVmdCAtIHNjcm9sbC54ICsgbGVmdE9mZnNldCAt
IHJpZ2h0T2Zmc2V0OworICAgIGxldCB0b3AgPSByZWN0LnRvcCAtIHNjcm9sbC55ICsgdG9wT2Zm
c2V0ICsgKHJlY3QuaGVpZ2h0KTsKKworICAgIC8vIEVuc3VyZSBwYXJ0cyBvZiB0aGUgYXJyb3di
b3ggYXJlIG5vdCBvdXRzaWRlIHRoZSB3aW5kb3cKKyAgICBsZXQgYXJyb3dib3hSZWN0ID0gUmVj
dC5mcm9tUmVjdChwb3B1cC5nZXRCb3VuZGluZ0NsaWVudFJlY3QoKSk7CisgICAgaWYgKGxlZnQg
KyBhcnJvd2JveFJlY3Qud2lkdGggPiB3aW5kb3cuaW5uZXJXaWR0aCkKKyAgICAgIGxlZnQgLT0g
KGxlZnQgKyBhcnJvd2JveFJlY3Qud2lkdGggLSB3aW5kb3cuaW5uZXJXaWR0aCk7CisgICAgZWxz
ZSBpZiAobGVmdCA8IGxlZnRPZmZzZXQpCisgICAgICBsZWZ0ICs9IChsZWZ0T2Zmc2V0IC0gbGVm
dCk7CisgICAgcG9wdXAubGVmdCA9IGxlZnQ7CisKKyAgICAvLyBEbyBub3QgcG9zaXRpb24gdGhl
IHN1Z2dlc3Rpb25zIG92ZXIgdGhlIG5hdmlnYXRpb24gYnV0dG9ucworICAgIGxldCBidXR0b25z
SGVpZ2h0ID0gRWxlbWVudHMuY29udGVudE5hdmlnYXRvci5nZXRCb3VuZGluZ0NsaWVudFJlY3Qo
KS5oZWlnaHQ7CisgICAgaWYgKHRvcCArIGFycm93Ym94UmVjdC5oZWlnaHQgPj0gd2luZG93Lmlu
bmVySGVpZ2h0IC0gYnV0dG9uc0hlaWdodCkKKyAgICAgIHRvcCAtPSAocmVjdC5oZWlnaHQgKyBh
cnJvd2JveFJlY3QuaGVpZ2h0KTsKKyAgICBwb3B1cC50b3AgPSB0b3A7CisKKyAgICAvLyBDcmVh
dGUgYSB2aXJ0dWFsIGVsZW1lbnQgdG8gcG9pbnQgdG8KKyAgICBsZXQgdmlydHVhbENvbnRlbnRF
bGVtZW50ID0geworICAgICAgZ2V0Qm91bmRpbmdDbGllbnRSZWN0OiBmdW5jdGlvbigpIHsKKyAg
ICAgICAgcmV0dXJuIHZpcnR1YWxDb250ZW50UmVjdDsKKyAgICAgIH0KKyAgICB9OworICAgIHBv
cHVwLmFuY2hvclRvKHZpcnR1YWxDb250ZW50RWxlbWVudCk7CisgICAgcG9wdXAuc3R5bGUudmlz
aWJpbGl0eSA9ICJ2aXNpYmxlIjsKKworICAgIGxldCBldmVudCA9IGRvY3VtZW50LmNyZWF0ZUV2
ZW50KCJFdmVudHMiKTsKKyAgICBldmVudC5pbml0RXZlbnQoImNvbnRlbnRwb3B1cHNob3duIiwg
dHJ1ZSwgZmFsc2UpOworICAgIHBvcHVwLmRpc3BhdGNoRXZlbnQoZXZlbnQpOworICB9LAorCisg
IGhhbmRsZUV2ZW50OiBmdW5jdGlvbihhRXZlbnQpIHsKKyAgICBsZXQgcG9wdXAgPSB0aGlzLl9w
b3B1cDsKKyAgICBpZiAoIXBvcHVwIHx8ICF0aGlzLl9hbmNob3JSZWN0KQorICAgICAgcmV0dXJu
OworCisgICAgc3dpdGNoKGFFdmVudC50eXBlKSB7CisgICAgICBjYXNlICJUYWJTZWxlY3QiOgor
ICAgICAgY2FzZSAiVGFiQ2xvc2UiOgorICAgICAgICB0aGlzLnBvcHVwID0gbnVsbDsKKyAgICAg
ICAgYnJlYWs7CisKKyAgICAgIGNhc2UgIlBhbkJlZ2luIjoKKyAgICAgIGNhc2UgIkFuaW1hdGVk
Wm9vbUJlZ2luIjoKKyAgICAgICAgcG9wdXAubGVmdCA9IDA7CisgICAgICAgIHBvcHVwLnN0eWxl
LnZpc2liaWxpdHkgPSAiaGlkZGVuIjsKKyAgICAgICAgYnJlYWs7CisKKyAgICAgIGNhc2UgIlBh
bkZpbmlzaGVkIjoKKyAgICAgIGNhc2UgIkFuaW1hdGVkWm9vbUVuZCI6CisgICAgICAgIHBvcHVw
LnN0eWxlLnZpc2liaWxpdHkgPSAidmlzaWJsZSI7CisgICAgICAgIC8vdGhpcy51cGRhdGUoKTsK
KyAgICAgICAgYnJlYWs7CisKKyAgICAgIGNhc2UgIk1vekJlZm9yZVJlc2l6ZSI6CisgICAgICAg
IHBvcHVwLmxlZnQgPSAwOworICAgICAgICBicmVhazsKKworICAgICAgY2FzZSAicmVzaXplIjoK
KyAgICAgICAgLy90aGlzLnVwZGF0ZSgpOworICAgICAgICBicmVhazsKKyAgICB9CisgIH0KK307
CisKZGlmZiAtLWdpdCBhL2Nocm9tZS9jb250ZW50L2Jyb3dzZXItc2NyaXB0cy5qcyBiL2Nocm9t
ZS9jb250ZW50L2Jyb3dzZXItc2NyaXB0cy5qcwotLS0gYS9jaHJvbWUvY29udGVudC9icm93c2Vy
LXNjcmlwdHMuanMKKysrIGIvY2hyb21lL2NvbnRlbnQvYnJvd3Nlci1zY3JpcHRzLmpzCkBAIC05
OCwxNiArOTgsMTcgQEAgWFBDT01VdGlscy5kZWZpbmVMYXp5R2V0dGVyKHRoaXMsICJDb21tbwog
ICBbIkNvbnNvbGVWaWV3IiwgImNocm9tZTovL2Jyb3dzZXIvY29udGVudC9jb25zb2xlLmpzIl0s
CiAgIFsiRG93bmxvYWRzVmlldyIsICJjaHJvbWU6Ly9icm93c2VyL2NvbnRlbnQvZG93bmxvYWRz
LmpzIl0sCiAgIFsiRXh0ZW5zaW9uc1ZpZXciLCAiY2hyb21lOi8vYnJvd3Nlci9jb250ZW50L2V4
dGVuc2lvbnMuanMiXSwKICAgWyJNZW51TGlzdEhlbHBlclVJIiwgImNocm9tZTovL2Jyb3dzZXIv
Y29udGVudC9NZW51TGlzdEhlbHBlclVJLmpzIl0sCiAgIFsiT2ZmbGluZUFwcHMiLCAiY2hyb21l
Oi8vYnJvd3Nlci9jb250ZW50L09mZmxpbmVBcHBzLmpzIl0sCiAgIFsiUHJlZmVyZW5jZXNWaWV3
IiwgImNocm9tZTovL2Jyb3dzZXIvY29udGVudC9wcmVmZXJlbmNlcy5qcyJdLAogICBbIlNhbml0
aXplciIsICJjaHJvbWU6Ly9icm93c2VyL2NvbnRlbnQvc2FuaXRpemUuanMiXSwKICAgWyJTZWxl
Y3RIZWxwZXJVSSIsICJjaHJvbWU6Ly9icm93c2VyL2NvbnRlbnQvU2VsZWN0SGVscGVyVUkuanMi
XSwKKyAgWyJDb250ZW50UG9wdXBIZWxwZXIiLCAiY2hyb21lOi8vYnJvd3Nlci9jb250ZW50L0Nv
bnRlbnRQb3B1cEhlbHBlci5qcyJdLAogICBbIlNoYXJpbmdVSSIsICJjaHJvbWU6Ly9icm93c2Vy
L2NvbnRlbnQvU2hhcmluZ1VJLmpzIl0sCiAjaWZkZWYgTU9aX1NFUlZJQ0VTX1NZTkMKICAgWyJX
ZWF2ZUdsdWUiLCAiY2hyb21lOi8vYnJvd3Nlci9jb250ZW50L3N5bmMuanMiXSwKICNlbmRpZgog
ICBbIlNTTEV4Y2VwdGlvbnMiLCAiY2hyb21lOi8vYnJvd3Nlci9jb250ZW50L2V4Y2VwdGlvbnMu
anMiXQogXS5mb3JFYWNoKGZ1bmN0aW9uIChhU2NyaXB0KSB7CiAgIGxldCBbbmFtZSwgc2NyaXB0
XSA9IGFTY3JpcHQ7CiAgIFhQQ09NVXRpbHMuZGVmaW5lTGF6eUdldHRlcih3aW5kb3csIG5hbWUs
IGZ1bmN0aW9uKCkgewpkaWZmIC0tZ2l0IGEvY2hyb21lL2NvbnRlbnQvYnJvd3Nlci11aS5qcyBi
L2Nocm9tZS9jb250ZW50L2Jyb3dzZXItdWkuanMKLS0tIGEvY2hyb21lL2NvbnRlbnQvYnJvd3Nl
ci11aS5qcworKysgYi9jaHJvbWUvY29udGVudC9icm93c2VyLXVpLmpzCkBAIC01MjEsMTYgKzUy
MSwxNyBAQCB2YXIgQnJvd3NlclVJID0gewogCiAgICAgICBTZXJ2aWNlcy5vYnMuYWRkT2JzZXJ2
ZXIoQnJvd3NlclNlYXJjaCwgImJyb3dzZXItc2VhcmNoLWVuZ2luZS1tb2RpZmllZCIsIGZhbHNl
KTsKICAgICAgIG1lc3NhZ2VNYW5hZ2VyLmFkZE1lc3NhZ2VMaXN0ZW5lcigiQnJvd3NlcjpNb3pB
cHBsaWNhdGlvbk1hbmlmZXN0IiwgT2ZmbGluZUFwcHMpOwogCiAgICAgICAvLyBJbml0IGhlbHBl
cnMKICAgICAgIEJhZGdlSGFuZGxlcnMucmVnaXN0ZXIoQnJvd3NlclVJLl9lZGl0LnBvcHVwKTsK
ICAgICAgIEZvcm1IZWxwZXJVSS5pbml0KCk7CiAgICAgICBGaW5kSGVscGVyVUkuaW5pdCgpOwor
ICAgICAgQ29udGVudFBvcHVwSGVscGVyLmluaXQoKTsKICAgICAgIFBhZ2VBY3Rpb25zLmluaXQo
KTsKICAgICAgIEZ1bGxTY3JlZW5WaWRlby5pbml0KCk7CiAgICAgICBOZXdUYWJQb3B1cC5pbml0
KCk7CiAgICAgICBDaGFyc2V0TWVudS5pbml0KCk7CiAKICAgICAgIC8vIElmIHNvbWUgYWRkLW9u
cyB3ZXJlIGRpc2FibGVkIGR1cmluZyBkdXJpbmcgYW4gYXBwbGljYXRpb24gdXBkYXRlLCBhbGVy
dCB1c2VyCiAgICAgICBpZiAoU2VydmljZXMucHJlZnMucHJlZkhhc1VzZXJWYWx1ZSgiZXh0ZW5z
aW9ucy5kaXNhYmxlZEFkZG9ucyIpKSB7CiAgICAgICAgIGxldCBhZGRvbnMgPSBTZXJ2aWNlcy5w
cmVmcy5nZXRDaGFyUHJlZigiZXh0ZW5zaW9ucy5kaXNhYmxlZEFkZG9ucyIpLnNwbGl0KCIsIik7
CmRpZmYgLS1naXQgYS9jaHJvbWUvY29udGVudC9jb21tb24tdWkuanMgYi9jaHJvbWUvY29udGVu
dC9jb21tb24tdWkuanMKLS0tIGEvY2hyb21lL2NvbnRlbnQvY29tbW9uLXVpLmpzCisrKyBiL2No
cm9tZS9jb250ZW50L2NvbW1vbi11aS5qcwpAQCAtNjIxLDIzICs2MjEsMTkgQEAgdmFyIEZvcm1I
ZWxwZXJVSSA9IHsKICAgICBtZXNzYWdlTWFuYWdlci5hZGRNZXNzYWdlTGlzdGVuZXIoIkRPTVdp
bGxPcGVuTW9kYWxEaWFsb2ciLCB0aGlzKTsKICAgICBtZXNzYWdlTWFuYWdlci5hZGRNZXNzYWdl
TGlzdGVuZXIoIkRPTU1vZGFsRGlhbG9nQ2xvc2VkIiwgdGhpcyk7CiAKICAgICAvLyBMaXN0ZW4g
a2V5IGV2ZW50cyBmb3IgZmllbGRzIHRoYXQgYXJlIG5vbi1lZGl0YWJsZQogICAgIHdpbmRvdy5h
ZGRFdmVudExpc3RlbmVyKCJrZXlkb3duIiwgdGhpcywgdHJ1ZSk7CiAgICAgd2luZG93LmFkZEV2
ZW50TGlzdGVuZXIoImtleXVwIiwgdGhpcywgdHJ1ZSk7CiAgICAgd2luZG93LmFkZEV2ZW50TGlz
dGVuZXIoImtleXByZXNzIiwgdGhpcywgdHJ1ZSk7CiAKLSAgICAvLyBMaXN0ZW4gc29tZSBldmVu
dHMgdG8gc2hvdy9oaWRlIHRoZSBhdXRvY29tcGxldGUgYm94CisgICAgLy8gTGlzdGVuIHNvbWUg
ZXZlbnRzIHRvIHNob3cvaGlkZSBhcnJvd3MKICAgICBFbGVtZW50cy5icm93c2Vycy5hZGRFdmVu
dExpc3RlbmVyKCJQYW5CZWdpbiIsIHRoaXMsIGZhbHNlKTsKICAgICBFbGVtZW50cy5icm93c2Vy
cy5hZGRFdmVudExpc3RlbmVyKCJQYW5GaW5pc2hlZCIsIHRoaXMsIGZhbHNlKTsKLSAgICB3aW5k
b3cuYWRkRXZlbnRMaXN0ZW5lcigiQW5pbWF0ZWRab29tQmVnaW4iLCB0aGlzLCBmYWxzZSk7Ci0g
ICAgd2luZG93LmFkZEV2ZW50TGlzdGVuZXIoIkFuaW1hdGVkWm9vbUVuZCIsIHRoaXMsIGZhbHNl
KTsKLSAgICB3aW5kb3cuYWRkRXZlbnRMaXN0ZW5lcigiTW96QmVmb3JlUmVzaXplIiwgdGhpcywg
dHJ1ZSk7Ci0gICAgd2luZG93LmFkZEV2ZW50TGlzdGVuZXIoInJlc2l6ZSIsIHRoaXMsIGZhbHNl
KTsKICAgfSwKIAogICBfY3VycmVudEJyb3dzZXI6IG51bGwsCiAgIHNob3c6IGZ1bmN0aW9uIGZv
cm1IZWxwZXJTaG93KGFFbGVtZW50LCBhSGFzUHJldmlvdXMsIGFIYXNOZXh0KSB7CiAgICAgdGhp
cy5fY3VycmVudEJyb3dzZXIgPSBCcm93c2VyLnNlbGVjdGVkQnJvd3NlcjsKICAgICB0aGlzLl9j
dXJyZW50Q2FyZXRSZWN0ID0gbnVsbDsKIAogICAgIC8vIFVwZGF0ZSB0aGUgbmV4dC9wcmV2aW91
cyBjb21tYW5kcwpAQCAtNjQ1LDE3ICs2NDEsMTYgQEAgdmFyIEZvcm1IZWxwZXJVSSA9IHsKICAg
ICB0aGlzLl9jbWROZXh0LnNldEF0dHJpYnV0ZSgiZGlzYWJsZWQiLCAhYUhhc05leHQpOwogCiAg
ICAgLy8gSWYgYm90aCBuZXh0IGFuZCBwcmV2aW91cyBhcmUgZGlzYWJsZWQgZG9uJ3QgYm90aGVy
IHNob3dpbmcgYXJyb3dzCiAgICAgaWYgKCFhSGFzTmV4dCAmJiAhYUhhc1ByZXZpb3VzKQogICAg
ICAgdGhpcy5fY29udGFpbmVyLnNldEF0dHJpYnV0ZSgiZGlzYWJsZWQiLCAidHJ1ZSIpOwogICAg
IGVsc2UKICAgICAgIHRoaXMuX2NvbnRhaW5lci5yZW1vdmVBdHRyaWJ1dGUoImRpc2FibGVkIik7
CiAKLSAgICB0aGlzLl9oYXNTdWdnZXN0aW9ucyA9IGZhbHNlOwogICAgIHRoaXMuX29wZW4gPSB0
cnVlOwogCiAgICAgbGV0IGxhc3RFbGVtZW50ID0gdGhpcy5fY3VycmVudEVsZW1lbnQgfHwgbnVs
bDsKICAgICB0aGlzLl9jdXJyZW50RWxlbWVudCA9IHsKICAgICAgIGlkOiBhRWxlbWVudC5pZCwK
ICAgICAgIG5hbWU6IGFFbGVtZW50Lm5hbWUsCiAgICAgICB0aXRsZTogYUVsZW1lbnQudGl0bGUs
CiAgICAgICB2YWx1ZTogYUVsZW1lbnQudmFsdWUsCkBAIC02NjMsMTcgKzY1OCwxNiBAQCB2YXIg
Rm9ybUhlbHBlclVJID0gewogICAgICAgdHlwZTogYUVsZW1lbnQudHlwZSwKICAgICAgIGNob2lj
ZXM6IGFFbGVtZW50LmNob2ljZXMsCiAgICAgICBpc0F1dG9jb21wbGV0ZTogYUVsZW1lbnQuaXNB
dXRvY29tcGxldGUsCiAgICAgICBsaXN0OiBhRWxlbWVudC5saXN0LAogICAgIH0KIAogICAgIHRo
aXMuX3VwZGF0ZUNvbnRhaW5lckZvclNlbGVjdChsYXN0RWxlbWVudCwgdGhpcy5fY3VycmVudEVs
ZW1lbnQpOwogICAgIHRoaXMuX3pvb20oUmVjdC5mcm9tUmVjdChhRWxlbWVudC5yZWN0KSwgUmVj
dC5mcm9tUmVjdChhRWxlbWVudC5jYXJldFJlY3QpKTsKLSAgICB0aGlzLl91cGRhdGVTdWdnZXN0
aW9uc0Zvcih0aGlzLl9jdXJyZW50RWxlbWVudCk7CiAKICAgICAvLyBQcmV2ZW50IHRoZSB2aWV3
IHRvIHNjcm9sbCBhdXRvbWF0aWNhbGx5IHdoaWxlIHR5cGluZwogICAgIHRoaXMuX2N1cnJlbnRC
cm93c2VyLnNjcm9sbFN5bmMgPSBmYWxzZTsKICAgfSwKIAogICBoaWRlOiBmdW5jdGlvbiBmb3Jt
SGVscGVySGlkZSgpIHsKICAgICBpZiAoIXRoaXMuX29wZW4pCiAgICAgICByZXR1cm47CkBAIC02
ODEsMTcgKzY3NSwxNiBAQCB2YXIgRm9ybUhlbHBlclVJID0gewogICAgIC8vIFJlc3RvcmUgdGhl
IHNjcm9sbCBzeW5jaG9uaXNhdGlvbgogICAgIHRoaXMuX2N1cnJlbnRCcm93c2VyLnNjcm9sbFN5
bmMgPSB0cnVlOwogCiAgICAgLy8gcmVzZXQgY3VycmVudCBFbGVtZW50IGFuZCBDYXJldCBSZWN0
CiAgICAgdGhpcy5fY3VycmVudEVsZW1lbnRSZWN0ID0gbnVsbDsKICAgICB0aGlzLl9jdXJyZW50
Q2FyZXRSZWN0ID0gbnVsbDsKIAogICAgIHRoaXMuX3VwZGF0ZUNvbnRhaW5lckZvclNlbGVjdCh0
aGlzLl9jdXJyZW50RWxlbWVudCwgbnVsbCk7Ci0gICAgdGhpcy5fcmVzZXRTdWdnZXN0aW9ucygp
OwogCiAgICAgdGhpcy5fY3VycmVudEJyb3dzZXIubWVzc2FnZU1hbmFnZXIuc2VuZEFzeW5jTWVz
c2FnZSgiRm9ybUFzc2lzdDpDbG9zZWQiLCB7IH0pOwogICAgIHRoaXMuX29wZW4gPSBmYWxzZTsK
ICAgfSwKIAogICAvLyBmb3IgVktCIHRoYXQgZG9lcyBub3QgcmVzaXplIHRoZSB3aW5kb3cKICAg
X2N1cnJlbnRDYXJldFJlY3Q6IG51bGwsCiAgIF9jdXJyZW50RWxlbWVudFJlY3Q6IG51bGwsCkBA
IC03MDYsMzggKzY5OSwyMSBAQCB2YXIgRm9ybUhlbHBlclVJID0gewogICAgICAgICBicmVhazsK
IAogICAgICAgY2FzZSAiUGFuQmVnaW4iOgogICAgICAgICAvLyBUaGUgcHJldmlvdXMvbmV4dCBi
dXR0b25zIHNob3VsZCBiZSBoaWRkZW4gZHVyaW5nIGEgbWFudWFsIHBhbm5pbmcKICAgICAgICAg
Ly8gb3BlcmF0aW9uIGJ1dCBub3QgZG9pbmcgYSB6b29tIG9wZXJhdGlvbiBzaW5jZSB0aGlzIGhh
cHBlbiBvbiBib3RoCiAgICAgICAgIC8vIG1hbnVhbCBkYmxDbGljayBhbmQgbmF2aWdhdGlvbiBi
ZXR3ZWVuIHRoZSBmaWVsZHMgYnkgY2xpY2tpbmcgdGhlCiAgICAgICAgIC8vIGJ1dHRvbnMKICAg
ICAgICAgdGhpcy5fY29udGFpbmVyLnN0eWxlLnZpc2liaWxpdHkgPSAiaGlkZGVuIjsKKyAgICAg
ICAgYnJlYWs7CiAKLSAgICAgIGNhc2UgIkFuaW1hdGVkWm9vbUJlZ2luIjoKLSAgICAgICAgLy8g
Q2hhbmdpbmcgdGhlIGhpZGRlbiBhdHRyaWJ1dGUgaGVyZSBjcmVhdGUgYnVncyB3aXRoIHRoZSBz
Y3JvbGxib3gKLSAgICAgICAgLy8gYXJyb3dzIGJlY2F1c2UgdGhlIGJpbmRpbmcgd2lsbCBtaXNz
IHNvbWUgdW5kZXJmbG93IGV2ZW50cwotICAgICAgICBpZiAodGhpcy5faGFzU3VnZ2VzdGlvbnMp
IHsKLSAgICAgICAgICAvLyBCZWNhdXNlIHRoZSBzdWdnZXN0aW9ucyBjb250YWluZXIgY291bGQg
YmUgYmlnIGluIHRlcm1zIG9mIHdpZHRoCi0gICAgICAgICAgLy8gKGJ1dCBuZXZlciBiaWdnZXIg
dGhhbiB0aGUgc2NyZWVuKSBpdCdzIHBvc2l0aW9uIG5lZWRzIHRvIGJlCi0gICAgICAgICAgLy8g
cmVzZXR0ZWQgdG8gdGhlIGxlZnQgdG8gZW5zdXJlIGl0IGRvZXMgbm90IHB1c2ggdGhlIGNvbnRl
bnQgdG8KLSAgICAgICAgICAvLyB0aGUgcmlnaHQgYW5kIG1pc3BsYWNlZCBzaWRlYmFycyBhcyBh
IHJlc3VsdAotICAgICAgICAgIHRoaXMuX3N1Z2dlc3Rpb25zQ29udGFpbmVyLmxlZnQgPSAwOwot
ICAgICAgICAgIHRoaXMuX3N1Z2dlc3Rpb25zQ29udGFpbmVyLnN0eWxlLnZpc2liaWxpdHkgPSAi
aGlkZGVuIjsKLSAgICAgICAgfQotICAgICAgICBicmVhazsKIAogICAgICAgY2FzZSAiUGFuRmlu
aXNoZWQiOgogICAgICAgICB0aGlzLl9jb250YWluZXIuc3R5bGUudmlzaWJpbGl0eSA9ICJ2aXNp
YmxlIjsKLQotICAgICAgY2FzZSAiQW5pbWF0ZWRab29tRW5kIjoKLSAgICAgICAgaWYgKHRoaXMu
X2hhc1N1Z2dlc3Rpb25zKSB7Ci0gICAgICAgICAgdGhpcy5fc3VnZ2VzdGlvbnNDb250YWluZXIu
c3R5bGUudmlzaWJpbGl0eSA9ICJ2aXNpYmxlIjsKLSAgICAgICAgICB0aGlzLl9lbnN1cmVTdWdn
ZXN0aW9uc1Zpc2libGUoKTsKLSAgICAgICAgfQogICAgICAgICBicmVhazsKIAogICAgICAgY2Fz
ZSAiVVJMQ2hhbmdlZCI6CiAgICAgICAgIGlmIChhRXZlbnQuZGV0YWlsICYmIGFFdmVudC50YXJn
ZXQgPT0gZ2V0QnJvd3NlcigpKQogICAgICAgICAgIHRoaXMuaGlkZSgpOwogICAgICAgICBicmVh
azsKIAogICAgICAgY2FzZSAia2V5ZG93biI6CkBAIC03NjEsMjYgKzczNywxNiBAQCB2YXIgRm9y
bUhlbHBlclVJID0gewogICAgICAgICBicmVhazsKIAogICAgICAgY2FzZSAiU2l6ZUNoYW5nZWQi
OgogICAgICAgICBzZXRUaW1lb3V0KGZ1bmN0aW9uKHNlbGYpIHsKICAgICAgICAgICBTZWxlY3RI
ZWxwZXJVSS5zaXplVG9Db250ZW50KCk7CiAgICAgICAgICAgc2VsZi5fem9vbShzZWxmLl9jdXJy
ZW50RWxlbWVudFJlY3QsIHNlbGYuX2N1cnJlbnRDYXJldFJlY3QpOwogICAgICAgICB9LCAwLCB0
aGlzKTsKICAgICAgICAgYnJlYWs7Ci0KLSAgICAgIGNhc2UgIk1vekJlZm9yZVJlc2l6ZSI6Ci0g
ICAgICAgIGlmICh0aGlzLl9oYXNTdWdnZXN0aW9ucykKLSAgICAgICAgICB0aGlzLl9zdWdnZXN0
aW9uc0NvbnRhaW5lci5sZWZ0ID0gMDsKLSAgICAgICAgYnJlYWs7Ci0KLSAgICAgIGNhc2UgInJl
c2l6ZSI6Ci0gICAgICAgIGlmICh0aGlzLl9oYXNTdWdnZXN0aW9ucykKLSAgICAgICAgICB0aGlz
Ll9lbnN1cmVTdWdnZXN0aW9uc1Zpc2libGUoKTsKLSAgICAgICAgYnJlYWs7CiAgICAgfQogICB9
LAogCiAgIHJlY2VpdmVNZXNzYWdlOiBmdW5jdGlvbiBmb3JtSGVscGVyUmVjZWl2ZU1lc3NhZ2Uo
YU1lc3NhZ2UpIHsKICAgICBpZiAoIXRoaXMuX29wZW4gJiYgYU1lc3NhZ2UubmFtZSAhPSAiRm9y
bUFzc2lzdDpTaG93IiAmJiBhTWVzc2FnZS5uYW1lICE9ICJGb3JtQXNzaXN0OkhpZGUiKQogICAg
ICAgcmV0dXJuOwogCiAgICAgbGV0IGpzb24gPSBhTWVzc2FnZS5qc29uOwpAQCAtODUxLDU0ICs4
MTcsNDYgQEAgdmFyIEZvcm1IZWxwZXJVSSA9IHsKICAgICBpZiAoYVZhbCkgewogICAgICAgdGhp
cy5fem9vbVN0YXJ0KCk7CiAgICAgICB0aGlzLl9jb250YWluZXIuc2hvdyh0aGlzKTsKICAgICB9
IGVsc2UgewogICAgICAgdGhpcy5fem9vbUZpbmlzaCgpOwogICAgICAgdGhpcy5fY3VycmVudEVs
ZW1lbnQgPSBudWxsOwogICAgICAgdGhpcy5fY29udGFpbmVyLmhpZGUodGhpcyk7CiAKKyAgICAg
IENvbnRlbnRQb3B1cEhlbHBlci5wb3B1cCA9IG51bGw7CiAgICAgICB0aGlzLl9jb250YWluZXIu
cmVtb3ZlQXR0cmlidXRlKCJkaXNhYmxlZCIpOwogCiAgICAgICAvLyBTaW5jZSB0aGUgc3R5bGUg
aXMgb3ZlcnJpZGVkIHdoZW4gYSBwb3B1cCBpcyBzaG93biwgaXQgbmVlZHMgdG8gYmUKICAgICAg
IC8vIHJlc2V0dGVkIGhlcmUgdG8gbGV0IHRoZSBkZWZhdWx0IENTUyB3b3JrcwogICAgICAgdGhp
cy5fY29udGFpbmVyLnN0eWxlLmRpc3BsYXkgPSAiIjsKICAgICB9CiAKICAgICBsZXQgZXZ0ID0g
ZG9jdW1lbnQuY3JlYXRlRXZlbnQoIlVJRXZlbnRzIik7CiAgICAgZXZ0LmluaXRVSUV2ZW50KCJG
b3JtVUkiLCB0cnVlLCB0cnVlLCB3aW5kb3csIGFWYWwpOwogICAgIHRoaXMuX2NvbnRhaW5lci5k
aXNwYXRjaEV2ZW50KGV2dCk7CiAgIH0sCiAKLSAgX2hhc1N1Z2dlc3Rpb25zOiBmYWxzZSwKICAg
X3VwZGF0ZVN1Z2dlc3Rpb25zRm9yOiBmdW5jdGlvbiBfZm9ybUhlbHBlclVwZGF0ZUF1dG9jb21w
bGV0ZUZvcihhRWxlbWVudCkgewogICAgIGxldCBzdWdnZXN0aW9ucyA9IHRoaXMuX2dldEF1dG9j
b21wbGV0ZVN1Z2dlc3Rpb25zKGFFbGVtZW50KTsKICAgICBpZiAoIXN1Z2dlc3Rpb25zLmxlbmd0
aCkgewotICAgICAgdGhpcy5fcmVzZXRTdWdnZXN0aW9ucygpOworICAgICAgQ29udGVudFBvcHVw
SGVscGVyLnBvcHVwID0gbnVsbDsKICAgICAgIHJldHVybjsKICAgICB9Ci0gICAgLy8gS2VlcHMg
dGhlIHN1Z2dlc3Rpb25zIGVsZW1lbnQgaGlkZGVuIHdoaWxlIGlzIGl0IG5vdCBwb3NpdGlvbm5l
ZCB0byB0aGUKLSAgICAvLyBjb3JyZWN0IHBsYWNlCisKKyAgICAvLyBBdHRhY2ggdGhlIHN1Z2dl
c3Rpb25zIGNvbnRhaW5lciBhcyBhIGNvbnRlbnQgcG9wdXAgZWxlbWVudAogICAgIGxldCBzdWdn
ZXN0aW9uc0NvbnRhaW5lciA9IHRoaXMuX3N1Z2dlc3Rpb25zQ29udGFpbmVyOwotICAgIHN1Z2dl
c3Rpb25zQ29udGFpbmVyLnN0eWxlLnZpc2liaWxpdHkgPSAiaGlkZGVuIjsKLSAgICBzdWdnZXN0
aW9uc0NvbnRhaW5lci5oaWRkZW4gPSBmYWxzZTsKLSAgICBzdWdnZXN0aW9uc0NvbnRhaW5lci5s
ZWZ0ID0gMDsKIAogICAgIC8vIHRoZSBzY3JvbGxYL3Njcm9sbFkgcG9zaXRpb24gY2FuIGNoYW5n
ZSBiZWNhdXNlIG9mIHRoZSBhbmltYXRlZCB6b29tIHNvCiAgICAgLy8gZGVsYXkgdGhlIHN1Z2dl
c3Rpb25zIHBvc2l0aW9uaW5nCiAgICAgaWYgKEFuaW1hdGVkWm9vbS5pc1pvb21pbmcoKSkgewog
ICAgICAgbGV0IHNlbGYgPSB0aGlzOwotICAgICAgd2luZG93LmFkZEV2ZW50TGlzdGVuZXIoIkFu
aW1hdGVkWm9vbUVuZCIsIGZ1bmN0aW9uKCkgewotICAgICAgICB3aW5kb3cucmVtb3ZlRXZlbnRM
aXN0ZW5lcigiQW5pbWF0ZWRab29tRW5kIiwgYXJndW1lbnRzLmNhbGxlZSwgdHJ1ZSk7Ci0gICAg
ICAgICAgLy8gRW5zdXJlIHRoZSBjdXJyZW50IGVsZW1lbnQgaGFzIG5vdCBjaGFuZ2VkIGR1cmlu
ZyB0aGlzIGludGVydmFsCi0gICAgICAgICAgaWYgKHNlbGYuX2N1cnJlbnRFbGVtZW50ICE9IGFF
bGVtZW50KQotICAgICAgICAgICAgcmV0dXJuOwotCi0gICAgICAgICAgc2VsZi5fdXBkYXRlU3Vn
Z2VzdGlvbnNGb3IoYUVsZW1lbnQpOwotICAgICAgfSwgdHJ1ZSk7CisgICAgICB0aGlzLl93YWl0
Rm9yWm9vbShmdW5jdGlvbigpIHsKKyAgICAgICAgc2VsZi5fdXBkYXRlU3VnZ2VzdGlvbnNGb3Io
YUVsZW1lbnQpOworICAgICAgfSk7CiAgICAgICByZXR1cm47CiAgICAgfQogCiAgICAgbGV0IGNv
bnRhaW5lciA9IHN1Z2dlc3Rpb25zQ29udGFpbmVyLmZpcnN0Q2hpbGQ7CiAgICAgd2hpbGUgKGNv
bnRhaW5lci5oYXNDaGlsZE5vZGVzKCkpCiAgICAgICBjb250YWluZXIucmVtb3ZlQ2hpbGQoY29u
dGFpbmVyLmxhc3RDaGlsZCk7CiAKICAgICBsZXQgZnJhZ21lbnQgPSBkb2N1bWVudC5jcmVhdGVE
b2N1bWVudEZyYWdtZW50KCk7CkBAIC05MDcsMTggKzg2NSwxOCBAQCB2YXIgRm9ybUhlbHBlclVJ
ID0gewogICAgICAgbGV0IGJ1dHRvbiA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoImxhYmVsIik7
CiAgICAgICBidXR0b24uc2V0QXR0cmlidXRlKCJ2YWx1ZSIsIHN1Z2dlc3Rpb24ubGFiZWwpOwog
ICAgICAgYnV0dG9uLnNldEF0dHJpYnV0ZSgiZGF0YSIsIHN1Z2dlc3Rpb24udmFsdWUpOwogICAg
ICAgYnV0dG9uLmNsYXNzTmFtZSA9ICJmb3JtLWhlbHBlci1zdWdnZXN0aW9ucy1sYWJlbCI7CiAg
ICAgICBmcmFnbWVudC5hcHBlbmRDaGlsZChidXR0b24pOwogICAgIH0KICAgICBjb250YWluZXIu
YXBwZW5kQ2hpbGQoZnJhZ21lbnQpOwogCi0gICAgdGhpcy5faGFzU3VnZ2VzdGlvbnMgPSB0cnVl
OwotICAgIHRoaXMuX2Vuc3VyZVN1Z2dlc3Rpb25zVmlzaWJsZSgpOworICAgIENvbnRlbnRQb3B1
cEhlbHBlci5wb3B1cCA9IHN1Z2dlc3Rpb25zQ29udGFpbmVyOworICAgIENvbnRlbnRQb3B1cEhl
bHBlci51cGRhdGUodGhpcy5fY3VycmVudEVsZW1lbnRSZWN0KTsKICAgfSwKIAogICAvKiogUmV0
cmlldmUgdGhlIGF1dG9jb21wbGV0ZSBsaXN0IGZyb20gdGhlIGF1dG9jb21wbGV0ZSBzZXJ2aWNl
IGZvciBhbiBlbGVtZW50ICovCiAgIF9nZXRBdXRvY29tcGxldGVTdWdnZXN0aW9uczogZnVuY3Rp
b24gX2Zvcm1IZWxwZXJHZXRBdXRvY29tcGxldGVTdWdnZXN0aW9ucyhhRWxlbWVudCkgewogICAg
IGlmICghYUVsZW1lbnQuaXNBdXRvY29tcGxldGUpCiAgICAgICByZXR1cm4gW107CiAKICAgICBs
ZXQgc3VnZ2VzdGlvbnMgPSBbXTsKQEAgLTk0MSwxMTggKzg5OSwxNiBAQCB2YXIgRm9ybUhlbHBl
clVJID0gewogICAgIC8vIGRpc3BsYXllZCB2YWx1ZSBjYW4gZGlmZmVyIGZyb20gdGhlIHJlYWwg
dmFsdWUgb2YgdGhlIGVsZW1lbnQuCiAgICAgbGV0IG9wdGlvbnMgPSBhRWxlbWVudC5saXN0Owog
ICAgIGZvciAobGV0IGkgPSAwOyBpIDwgb3B0aW9ucy5sZW5ndGg7IGkrKykKICAgICAgIHN1Z2dl
c3Rpb25zLnB1c2gob3B0aW9uc1tpXSk7CiAKICAgICByZXR1cm4gc3VnZ2VzdGlvbnM7CiAgIH0s
CiAKLSAgX3Jlc2V0U3VnZ2VzdGlvbnM6IGZ1bmN0aW9uIF9mb3JtSGVscGVyUmVzZXRBdXRvY29t
cGxldGUoKSB7Ci0gICAgdGhpcy5fc3VnZ2VzdGlvbnNDb250YWluZXIuaGlkZGVuID0gdHJ1ZTsK
LSAgICB0aGlzLl9oYXNTdWdnZXN0aW9ucyA9IGZhbHNlOwotICB9LAotCi0gIC8qKgotICAgKiBU
aGlzIG1ldGhvZCBwb3NpdGlvbm5lZCB0aGUgbGlzdCBvZiBzdWdnZXN0aW9ucyBvbiB0aGUgc2Ny
ZWVuIHVzaW5nCi0gICAqIGEgJ3ZpcnR1YWwnIGVsZW1lbnQgYXMgcmVmZXJyZXIgdGhhdCBtYXRj
aCB0aGUgcmVhbCBjb250ZW50IGVsZW1lbnQKLSAgICogVGhpcyBtZXRob2QgY2FsbGVkIGVsZW1l
bnQuZ2V0Qm91bmRpbmdDbGllbnRSZWN0KCkgbWFueSB0aW1lcyBhbmQgY2FuIGJlCi0gICAqIGV4
cGVuc2l2ZSwgZG8gbm90IGNhbGxlZCBpdCB0b28gbWFueSB0aW1lcy4KLSAgICovCi0gIF9lbnN1
cmVTdWdnZXN0aW9uc1Zpc2libGU6IGZ1bmN0aW9uIF9mb3JtSGVscGVyRW5zdXJlU3VnZ2VzdGlv
bnNWaXNpYmxlKCkgewotICAgIGxldCBjb250YWluZXIgPSB0aGlzLl9zdWdnZXN0aW9uc0NvbnRh
aW5lcjsKLQotICAgIC8vIENhbGN1bGF0ZSB0aGUgbWF4aW11bSBzaXplIG9mIHRoZSBhcnJvd3Bh
bmVsIGJ5IGFsbG93aW5nIGl0IHRvIGxpdmUgb25seQotICAgIC8vIG9uIHRoZSB2aXNpYmxlIGJy
b3dzZXIgYXJlYQotICAgIGxldCBbbGVmdFZpcywgcmlnaHRWaXMsIGxlZnRXLCByaWdodFddID0g
QnJvd3Nlci5jb21wdXRlU2lkZWJhclZpc2liaWxpdHkoKTsKLSAgICBsZXQgbGVmdE9mZnNldCA9
IGxlZnRWaXMgKiBsZWZ0VzsKLSAgICBsZXQgcmlnaHRPZmZzZXQgPSByaWdodFZpcyAqIHJpZ2h0
VzsKLSAgICBsZXQgdmlzaWJsZUFyZWFXaWR0aCA9IHdpbmRvdy5pbm5lcldpZHRoIC0gbGVmdE9m
ZnNldCAtIHJpZ2h0T2Zmc2V0OwotICAgIGNvbnRhaW5lci5maXJzdENoaWxkLnN0eWxlLm1heFdp
ZHRoID0gKHZpc2libGVBcmVhV2lkdGggKiAwLjc1KSArICJweCI7Ci0KLSAgICBsZXQgYnJvd3Nl
ciA9IGdldEJyb3dzZXIoKTsKLSAgICBsZXQgcmVjdCA9IHRoaXMuX2N1cnJlbnRFbGVtZW50UmVj
dC5jbG9uZSgpLnNjYWxlKGJyb3dzZXIuc2NhbGUsIGJyb3dzZXIuc2NhbGUpOwotICAgIGxldCBz
Y3JvbGwgPSBicm93c2VyLmdldFJvb3RWaWV3KCkuZ2V0UG9zaXRpb24oKTsKLQotICAgIC8vIFRo
ZSBzaWRlYmFycyBzY3JvbGwgbmVlZHMgdG8gYmUgdGFrZW4gaW50byBhY2NvdW50LCBvdGhlcndp
c2UgdGhlIGFycm93cwotICAgIC8vIGNhbiBiZSBtaXNwbGFjZWQgaWYgdGhlIHNpZGViYXJzIGFy
ZSBvcGVuCi0gICAgbGV0IHRvcE9mZnNldCA9IChCcm93c2VyVUkudG9vbGJhckggLSBCcm93c2Vy
LmdldFNjcm9sbGJveFBvc2l0aW9uKEJyb3dzZXIucGFnZVNjcm9sbGJveFNjcm9sbGVyKS55KTsK
LSAgICBsZXQgdmlydHVhbENvbnRlbnRSZWN0ID0gewotICAgICAgd2lkdGg6IHJlY3Qud2lkdGgs
Ci0gICAgICBoZWlnaHQ6IHJlY3QuaGVpZ2h0LAotICAgICAgbGVmdDogTWF0aC5jZWlsKHJlY3Qu
bGVmdCAtIHNjcm9sbC54ICsgbGVmdE9mZnNldCAtIHJpZ2h0T2Zmc2V0KSwKLSAgICAgIHJpZ2h0
OiBNYXRoLmZsb29yKHJlY3QubGVmdCArIHJlY3Qud2lkdGggLSBzY3JvbGwueCArIGxlZnRPZmZz
ZXQgLSByaWdodE9mZnNldCksCi0gICAgICB0b3A6IE1hdGguY2VpbChyZWN0LnRvcCAtIHNjcm9s
bC55ICsgdG9wT2Zmc2V0KSwKLSAgICAgIGJvdHRvbTogTWF0aC5mbG9vcihyZWN0LnRvcCArIHJl
Y3QuaGVpZ2h0IC0gc2Nyb2xsLnkgKyB0b3BPZmZzZXQpCi0gICAgfTsKLQotICAgIC8vIFRyYW5z
bGF0ZSB0aGUgdmlydHVhbCByZWN0IGluc2lkZSB0aGUgYm91bmRzIG9mIHRoZSB2aWV3YWJsZSBh
cmVhIGlmIGl0Ci0gICAgLy8gb3ZlcmZsb3cKLSAgICBpZiAodmlydHVhbENvbnRlbnRSZWN0Lmxl
ZnQgKyB2aXJ0dWFsQ29udGVudFJlY3Qud2lkdGggPiB2aXNpYmxlQXJlYVdpZHRoKSB7Ci0gICAg
ICBsZXQgb2Zmc2V0WCA9IHZpc2libGVBcmVhV2lkdGggLSAodmlydHVhbENvbnRlbnRSZWN0Lmxl
ZnQgKyB2aXJ0dWFsQ29udGVudFJlY3Qud2lkdGgpOwotICAgICAgdmlydHVhbENvbnRlbnRSZWN0
LndpZHRoICs9IG9mZnNldFg7Ci0gICAgICB2aXJ0dWFsQ29udGVudFJlY3QucmlnaHQgLT0gb2Zm
c2V0WDsKLSAgICB9Ci0KLSAgICBpZiAodmlydHVhbENvbnRlbnRSZWN0LmxlZnQgPCBsZWZ0T2Zm
c2V0KSB7Ci0gICAgICBsZXQgb2Zmc2V0WCA9ICh2aXJ0dWFsQ29udGVudFJlY3QucmlnaHQgLSB2
aXJ0dWFsQ29udGVudFJlY3Qud2lkdGgpOwotICAgICAgdmlydHVhbENvbnRlbnRSZWN0LndpZHRo
ICs9IG9mZnNldFg7Ci0gICAgICB2aXJ0dWFsQ29udGVudFJlY3QubGVmdCAtPSBvZmZzZXRYOwot
ICAgIH0KLQotICAgIC8vIElmIHRoZSBzdWdnZXN0aW9ucyBhcmUgb3V0IG9mIHZpZXcgdGhlcmUg
aXMgbm8gbmVlZCB0byBkaXNwbGF5IGl0Ci0gICAgbGV0IGJyb3dzZXJSZWN0ID0gUmVjdC5mcm9t
UmVjdChicm93c2VyLmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpKTsKLSAgICBpZiAoQnJvd3NlclVJ
LmlzVG9vbGJhckxvY2tlZCgpKSB7Ci0gICAgICAvLyBJZiB0aGUgdG9vbGJhciBpcyBsb2NrZWQs
IGl0IGNhbiBhcHBlYXIgb3ZlciB0aGUgZmllbGQgaW4gc3VjaCBhIHdheQotICAgICAgLy8gdGhh
dCB0aGUgZmllbGQgaXMgaGlkZGVuCi0gICAgICBsZXQgdG9vbGJhckggPSBCcm93c2VyVUkudG9v
bGJhckg7Ci0gICAgICBicm93c2VyUmVjdCA9IG5ldyBSZWN0KGxlZnRPZmZzZXQgLSByaWdodE9m
ZnNldCwgTWF0aC5tYXgoMCwgYnJvd3NlclJlY3QudG9wIC0gdG9vbGJhckgpICsgdG9vbGJhckgs
Ci0gICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyb3dzZXJSZWN0LndpZHRoICsgbGVmdE9m
ZnNldCAtIHJpZ2h0T2Zmc2V0LCBicm93c2VyUmVjdC5oZWlnaHQgLSB0b29sYmFySCk7Ci0gICAg
fQotCi0gICAgaWYgKGJyb3dzZXJSZWN0LmludGVyc2VjdChSZWN0LmZyb21SZWN0KHZpcnR1YWxD
b250ZW50UmVjdCkpLmlzRW1wdHkoKSkgewotICAgICAgY29udGFpbmVyLnN0eWxlLnZpc2liaWxp
dHkgPSAiaGlkZGVuIjsKLSAgICAgIHJldHVybjsKLSAgICB9Ci0KLSAgICAvLyBBZGRpbmcgcmVj
dC5oZWlnaHQgdG8gdGhlIHRvcCBtb3ZlcyB0aGUgYXJyb3dib3ggYmVsb3cgdGhlIHZpcnR1YWwg
ZmllbGQKLSAgICBsZXQgbGVmdCA9IHJlY3QubGVmdCAtIHNjcm9sbC54ICsgbGVmdE9mZnNldCAt
IHJpZ2h0T2Zmc2V0OwotICAgIGxldCB0b3AgPSByZWN0LnRvcCAtIHNjcm9sbC55ICsgdG9wT2Zm
c2V0ICsgKHJlY3QuaGVpZ2h0KTsKLQotICAgIC8vIEVuc3VyZSBwYXJ0cyBvZiB0aGUgYXJyb3di
b3ggYXJlIG5vdCBvdXRzaWRlIHRoZSB3aW5kb3cKLSAgICBsZXQgYXJyb3dib3hSZWN0ID0gUmVj
dC5mcm9tUmVjdChjb250YWluZXIuZ2V0Qm91bmRpbmdDbGllbnRSZWN0KCkpOwotICAgIGlmIChs
ZWZ0ICsgYXJyb3dib3hSZWN0LndpZHRoID4gd2luZG93LmlubmVyV2lkdGgpCi0gICAgICBsZWZ0
IC09IChsZWZ0ICsgYXJyb3dib3hSZWN0LndpZHRoIC0gd2luZG93LmlubmVyV2lkdGgpOwotICAg
IGVsc2UgaWYgKGxlZnQgPCBsZWZ0T2Zmc2V0KQotICAgICAgbGVmdCArPSAobGVmdE9mZnNldCAt
IGxlZnQpOwotICAgIGNvbnRhaW5lci5sZWZ0ID0gbGVmdDsKLQotICAgIC8vIERvIG5vdCBwb3Np
dGlvbiB0aGUgc3VnZ2VzdGlvbnMgb3ZlciB0aGUgbmF2aWdhdGlvbiBidXR0b25zCi0gICAgbGV0
IGJ1dHRvbnNIZWlnaHQgPSB0aGlzLl9jb250YWluZXIuZ2V0Qm91bmRpbmdDbGllbnRSZWN0KCku
aGVpZ2h0OwotICAgIGlmICh0b3AgKyBhcnJvd2JveFJlY3QuaGVpZ2h0ID49IHdpbmRvdy5pbm5l
ckhlaWdodCAtIGJ1dHRvbnNIZWlnaHQpCi0gICAgICB0b3AgLT0gKHJlY3QuaGVpZ2h0ICsgYXJy
b3dib3hSZWN0LmhlaWdodCk7Ci0gICAgY29udGFpbmVyLnRvcCA9IHRvcDsKLQotICAgIC8vIENy
ZWF0ZSBhIHZpcnR1YWwgZWxlbWVudCB0byBwb2ludCB0bwotICAgIGxldCB2aXJ0dWFsQ29udGVu
dEVsZW1lbnQgPSB7Ci0gICAgICBnZXRCb3VuZGluZ0NsaWVudFJlY3Q6IGZ1bmN0aW9uKCkgewot
ICAgICAgICByZXR1cm4gdmlydHVhbENvbnRlbnRSZWN0OwotICAgICAgfQotICAgIH07Ci0gICAg
Y29udGFpbmVyLmFuY2hvclRvKHZpcnR1YWxDb250ZW50RWxlbWVudCk7Ci0gICAgY29udGFpbmVy
LnN0eWxlLnZpc2liaWxpdHkgPSAidmlzaWJsZSI7Ci0gIH0sCi0KLSAgLyoqIFVwZGF0ZSB0aGUg
Zm9ybSBoZWxwZXIgY29udGFpbmVyIHRvIHJlZmxlY3QgbmV3IGVsZW1lbnQgdXNlciBpcyBlZGl0
aW5nLiAqLwotICBfdXBkYXRlQ29udGFpbmVyOiBmdW5jdGlvbiBfZm9ybUhlbHBlclVwZGF0ZUNv
bnRhaW5lcihhTGFzdEVsZW1lbnQsIGFDdXJyZW50RWxlbWVudCkgewotICAgIHRoaXMuX3VwZGF0
ZUNvbnRhaW5lckZvclNlbGVjdChhTGFzdEVsZW1lbnQsIGFDdXJyZW50RWxlbWVudCk7Ci0KLSAg
ICB0aGlzLl9jb250YWluZXIuY29udGVudEhhc0NoYW5nZWQoKTsKLSAgfSwKLQogICAvKiogSGVs
cGVyIGZvciBfdXBkYXRlQ29udGFpbmVyIHRoYXQgaGFuZGxlcyB0aGUgY2FzZSB3aGVyZSB0aGUg
bmV3IGVsZW1lbnQgaXMgYSBzZWxlY3QuICovCiAgIF91cGRhdGVDb250YWluZXJGb3JTZWxlY3Q6
IGZ1bmN0aW9uIF9mb3JtSGVscGVyVXBkYXRlQ29udGFpbmVyRm9yU2VsZWN0KGFMYXN0RWxlbWVu
dCwgYUN1cnJlbnRFbGVtZW50KSB7CiAgICAgbGV0IGxhc3RIYXNDaG9pY2VzID0gYUxhc3RFbGVt
ZW50ICYmIChhTGFzdEVsZW1lbnQuY2hvaWNlcyAhPSBudWxsKTsKICAgICBsZXQgY3VycmVudEhh
c0Nob2ljZXMgPSBhQ3VycmVudEVsZW1lbnQgJiYgKGFDdXJyZW50RWxlbWVudC5jaG9pY2VzICE9
IG51bGwpOwogCiAgICAgaWYgKGN1cnJlbnRIYXNDaG9pY2VzKQogICAgICAgU2VsZWN0SGVscGVy
VUkuc2hvdyhhQ3VycmVudEVsZW1lbnQuY2hvaWNlcywgYUN1cnJlbnRFbGVtZW50LnRpdGxlKTsK
ICAgICBlbHNlIGlmIChsYXN0SGFzQ2hvaWNlcykKQEAgLTEwODgsMjYgKzk0NCwyMCBAQCB2YXIg
Rm9ybUhlbHBlclVJID0gewogCiAgIF9lbnN1cmVDYXJldFZpc2libGU6IGZ1bmN0aW9uIF9lbnN1
cmVDYXJldFZpc2libGUoYUNhcmV0UmVjdCkgewogICAgIGlmICghYUNhcmV0UmVjdCB8fCAhU2Vy
dmljZXMucHJlZnMuZ2V0Qm9vbFByZWYoImZvcm1oZWxwZXIuYXV0b3pvb20uY2FyZXQiKSkKICAg
ICAgIHJldHVybjsKIAogICAgIC8vIHRoZSBzY3JvbGxYL3Njcm9sbFkgcG9zaXRpb24gY2FuIGNo
YW5nZSBiZWNhdXNlIG9mIHRoZSBhbmltYXRlZCB6b29tIHNvCiAgICAgLy8gZGVsYXkgdGhlIGNh
cmV0IGFkanVzdG1lbnQKICAgICBpZiAoQW5pbWF0ZWRab29tLmlzWm9vbWluZygpKSB7Ci0gICAg
ICBsZXQgY3VycmVudEVsZW1lbnQgPSB0aGlzLl9jdXJyZW50RWxlbWVudDsKICAgICAgIGxldCBz
ZWxmID0gdGhpczsKLSAgICAgIHdpbmRvdy5hZGRFdmVudExpc3RlbmVyKCJBbmltYXRlZFpvb21F
bmQiLCBmdW5jdGlvbigpIHsKLSAgICAgICAgd2luZG93LnJlbW92ZUV2ZW50TGlzdGVuZXIoIkFu
aW1hdGVkWm9vbUVuZCIsIGFyZ3VtZW50cy5jYWxsZWUsIHRydWUpOwotICAgICAgICAgIC8vIEVu
c3VyZSB0aGUgY3VycmVudCBlbGVtZW50IGhhcyBub3QgY2hhbmdlZCBkdXJpbmcgdGhpcyBpbnRl
cnZhbAotICAgICAgICAgIGlmIChzZWxmLl9jdXJyZW50RWxlbWVudCAhPSBjdXJyZW50RWxlbWVu
dCkKLSAgICAgICAgICAgIHJldHVybjsKLQotICAgICAgICAgIHNlbGYuX2Vuc3VyZUNhcmV0Vmlz
aWJsZShhQ2FyZXRSZWN0KTsKLSAgICAgIH0sIHRydWUpOworICAgICAgdGhpcy5fd2FpdEZvclpv
b20oZnVuY3Rpb24oKSB7CisgICAgICAgIHNlbGYuX2Vuc3VyZUNhcmV0VmlzaWJsZShhQ2FyZXRS
ZWN0KTsKKyAgICAgIH0pOwogICAgICAgcmV0dXJuOwogICAgIH0KIAogICAgIGxldCBicm93c2Vy
ID0gZ2V0QnJvd3NlcigpOwogICAgIGxldCB6b29tUmVjdCA9IFJlY3QuZnJvbVJlY3QoYnJvd3Nl
ci5nZXRCb3VuZGluZ0NsaWVudFJlY3QoKSk7CiAKICAgICB0aGlzLl9jdXJyZW50Q2FyZXRSZWN0
ID0gYUNhcmV0UmVjdDsKICAgICBsZXQgY2FyZXRSZWN0ID0gYUNhcmV0UmVjdC5jbG9uZSgpLnNj
YWxlKGJyb3dzZXIuc2NhbGUsIGJyb3dzZXIuc2NhbGUpOwpAQCAtMTE0MiwxNiArOTkyLDI5IEBA
IHZhciBGb3JtSGVscGVyVUkgPSB7CiAgICAgICByZXR1cm47CiAKICAgICBsZXQgcmVzdG9yZSA9
IHRoaXMuX3Jlc3RvcmU7CiAgICAgZ2V0QnJvd3NlcigpLnNjYWxlID0gcmVzdG9yZS5zY2FsZTsK
ICAgICBCcm93c2VyLmNvbnRlbnRTY3JvbGxib3hTY3JvbGxlci5zY3JvbGxUbyhyZXN0b3JlLmNv
bnRlbnRTY3JvbGxPZmZzZXQueCwgcmVzdG9yZS5jb250ZW50U2Nyb2xsT2Zmc2V0LnkpOwogICAg
IEJyb3dzZXIucGFnZVNjcm9sbGJveFNjcm9sbGVyLnNjcm9sbFRvKHJlc3RvcmUucGFnZVNjcm9s
bE9mZnNldC54LCByZXN0b3JlLnBhZ2VTY3JvbGxPZmZzZXQueSk7CiAgIH0sCiAKKyAgX3dhaXRG
b3Jab29tOiBmdW5jdGlvbiBfZm9ybUhlbHBlcldhaXRGb3Jab29tKGFDYWxsYmFjaykgeworICAg
IGxldCBjdXJyZW50RWxlbWVudCA9IHRoaXMuX2N1cnJlbnRFbGVtZW50OworICAgIGxldCBzZWxm
ID0gdGhpczsKKyAgICB3aW5kb3cuYWRkRXZlbnRMaXN0ZW5lcigiQW5pbWF0ZWRab29tRW5kIiwg
ZnVuY3Rpb24oKSB7CisgICAgICB3aW5kb3cucmVtb3ZlRXZlbnRMaXN0ZW5lcigiQW5pbWF0ZWRa
b29tRW5kIiwgYXJndW1lbnRzLmNhbGxlZSwgdHJ1ZSk7CisgICAgICAvLyBFbnN1cmUgdGhlIGN1
cnJlbnQgZWxlbWVudCBoYXMgbm90IGNoYW5nZWQgZHVyaW5nIHRoaXMgaW50ZXJ2YWwKKyAgICAg
IGlmIChzZWxmLl9jdXJyZW50RWxlbWVudCAhPSBjdXJyZW50RWxlbWVudCkKKyAgICAgICAgcmV0
dXJuOworCisgICAgICBhQ2FsbGJhY2soKTsKKyAgICB9LCB0cnVlKTsKKyAgfSwKKwogICBfZ2V0
Wm9vbUxldmVsRm9yUmVjdDogZnVuY3Rpb24gX2dldFpvb21MZXZlbEZvclJlY3QoYVJlY3QpIHsK
ICAgICBjb25zdCBtYXJnaW4gPSAzMDsKICAgICBsZXQgem9vbUxldmVsID0gZ2V0QnJvd3Nlcigp
LmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpLndpZHRoIC8gKGFSZWN0LndpZHRoICsgbWFyZ2luKTsK
ICAgICByZXR1cm4gVXRpbC5jbGFtcCh6b29tTGV2ZWwsIGtCcm93c2VyRm9ybVpvb21MZXZlbE1p
biwga0Jyb3dzZXJGb3JtWm9vbUxldmVsTWF4KTsKICAgfSwKIAogICBfZ2V0T2Zmc2V0Rm9yQ2Fy
ZXQ6IGZ1bmN0aW9uIF9mb3JtSGVscGVyR2V0T2Zmc2V0Rm9yQ2FyZXQoYUNhcmV0UmVjdCwgYVJl
Y3QpIHsKICAgICAvLyBEZXRlcm1pbmUgaWYgd2UgbmVlZCB0byBtb3ZlIGxlZnQgb3IgcmlnaHQg
dG8gYnJpbmcgdGhlIGNhcmV0IGludG8gdmlldwpkaWZmIC0tZ2l0IGEvY2hyb21lL2NvbnRlbnQv
Zm9ybXMuanMgYi9jaHJvbWUvY29udGVudC9mb3Jtcy5qcwotLS0gYS9jaHJvbWUvY29udGVudC9m
b3Jtcy5qcworKysgYi9jaHJvbWUvY29udGVudC9mb3Jtcy5qcwpAQCAtNTY3LDE3ICs1NjcsMTcg
QEAgRm9ybUFzc2lzdGFudC5wcm90b3R5cGUgPSB7CiAKICAgICBpZiAoYUVsZW1lbnQgaW5zdGFu
Y2VvZiBIVE1MSW5wdXRFbGVtZW50IHx8IGFFbGVtZW50IGluc3RhbmNlb2YgSFRNTEJ1dHRvbkVs
ZW1lbnQpCiAgICAgICByZXR1cm4gIShhRWxlbWVudC50eXBlID09ICJoaWRkZW4iKTsKIAogICAg
IHJldHVybiB0aGlzLl9pc0VkaXRhYmxlKGFFbGVtZW50KTsKICAgfSwKIAogICBfaXNWaXNpYmxl
RWxlbWVudDogZnVuY3Rpb24gZm9ybUhlbHBlcklzVmlzaWJsZUVsZW1lbnQoYUVsZW1lbnQpIHsK
LSAgICBsZXQgc3R5bGUgPSBhRWxlbWVudC5vd25lckRvY3VtZW50LmRlZmF1bHRWaWV3LmdldENv
bXB1dGVkU3R5bGUoYUVsZW1lbnQsIG51bGwpOworICAgIGxldCBzdHlsZSA9IGFFbGVtZW50ID8g
YUVsZW1lbnQub3duZXJEb2N1bWVudC5kZWZhdWx0Vmlldy5nZXRDb21wdXRlZFN0eWxlKGFFbGVt
ZW50LCBudWxsKSA6IG51bGw7CiAgICAgaWYgKCFzdHlsZSkKICAgICAgIHJldHVybiBmYWxzZTsK
IAogICAgIGxldCBpc1Zpc2libGUgPSAoc3R5bGUuZ2V0UHJvcGVydHlWYWx1ZSgidmlzaWJpbGl0
eSIpICE9ICJoaWRkZW4iKTsKICAgICBsZXQgaXNPcGFxdWUgPSAoc3R5bGUuZ2V0UHJvcGVydHlW
YWx1ZSgib3BhY2l0eSIpICE9IDApOwogCiAgICAgbGV0IHJlY3QgPSBhRWxlbWVudC5nZXRCb3Vu
ZGluZ0NsaWVudFJlY3QoKTsKICAgICByZXR1cm4gaXNWaXNpYmxlICYmIGlzT3BhcXVlICYmIChy
ZWN0LmhlaWdodCAhPSAwIHx8IHJlY3Qud2lkdGggIT0gMCk7CmRpZmYgLS1naXQgYS9jaHJvbWUv
amFyLm1uIGIvY2hyb21lL2phci5tbgotLS0gYS9jaHJvbWUvamFyLm1uCisrKyBiL2Nocm9tZS9q
YXIubW4KQEAgLTIyLDE2ICsyMiwxNyBAQCBjaHJvbWUuamFyOgogKiBjb250ZW50L2Jyb3dzZXIt
dWkuanMgICAgICAgICAgICAgICAgKGNvbnRlbnQvYnJvd3Nlci11aS5qcykKICogY29udGVudC9i
cm93c2VyLXNjcmlwdHMuanMgICAgICAgICAgIChjb250ZW50L2Jyb3dzZXItc2NyaXB0cy5qcykK
ICogY29udGVudC9jb21tb24tdWkuanMgICAgICAgICAgICAgICAgIChjb250ZW50L2NvbW1vbi11
aS5qcykKICogY29udGVudC9BbGVydHNIZWxwZXIuanMgICAgICAgICAgICAgIChjb250ZW50L0Fs
ZXJ0c0hlbHBlci5qcykKICAgY29udGVudC9BcHBNZW51LmpzICAgICAgICAgICAgICAgICAgIChj
b250ZW50L0FwcE1lbnUuanMpCiAgIGNvbnRlbnQvQXdlc29tZVBhbmVsLmpzICAgICAgICAgICAg
ICAoY29udGVudC9Bd2Vzb21lUGFuZWwuanMpCiAgIGNvbnRlbnQvQm9va21hcmtIZWxwZXIuanMg
ICAgICAgICAgICAoY29udGVudC9Cb29rbWFya0hlbHBlci5qcykKICAgY29udGVudC9Cb29rbWFy
a1BvcHVwLmpzICAgICAgICAgICAgIChjb250ZW50L0Jvb2ttYXJrUG9wdXAuanMpCisgIGNvbnRl
bnQvQ29udGVudFBvcHVwSGVscGVyLmpzICAgICAgICAoY29udGVudC9Db250ZW50UG9wdXBIZWxw
ZXIuanMpCiAqIGNvbnRlbnQvQ29udGV4dENvbW1hbmRzLmpzICAgICAgICAgICAoY29udGVudC9D
b250ZXh0Q29tbWFuZHMuanMpCiAgIGNvbnRlbnQvTWVudUxpc3RIZWxwZXJVSS5qcyAgICAgICAg
ICAoY29udGVudC9NZW51TGlzdEhlbHBlclVJLmpzKQogICBjb250ZW50L09mZmxpbmVBcHBzLmpz
ICAgICAgICAgICAgICAgKGNvbnRlbnQvT2ZmbGluZUFwcHMuanMpCiAgIGNvbnRlbnQvU2VsZWN0
SGVscGVyVUkuanMgICAgICAgICAgICAoY29udGVudC9TZWxlY3RIZWxwZXJVSS5qcykKICAgY29u
dGVudC9TaGFyaW5nVUkuanMgICAgICAgICAgICAgICAgIChjb250ZW50L1NoYXJpbmdVSS5qcykK
ICogY29udGVudC9jb250ZW50LmpzICAgICAgICAgICAgICAgICAgIChjb250ZW50L2NvbnRlbnQu
anMpCiAgIGNvbnRlbnQvY29tbWFuZFV0aWwuanMgICAgICAgICAgICAgICAoY29udGVudC9jb21t
YW5kVXRpbC5qcykKICogY29udGVudC9iaW5kaW5ncy54bWwgICAgICAgICAgICAgICAgIChjb250
ZW50L2JpbmRpbmdzLnhtbCkKZGlmZiAtLWdpdCBhL2Nocm9tZS90ZXN0cy9NYWtlZmlsZS5pbiBi
L2Nocm9tZS90ZXN0cy9NYWtlZmlsZS5pbgotLS0gYS9jaHJvbWUvdGVzdHMvTWFrZWZpbGUuaW4K
KysrIGIvY2hyb21lL3Rlc3RzL01ha2VmaWxlLmluCkBAIC00NCwxNiArNDQsMTcgQEAgVEVTVFhQ
SSAgPSAkKENVUkRJUikvJChERVBUSCkvX3Rlc3RzL3RlcwogQURET05TUkMgPSAkKHNyY2Rpcikv
YWRkb25zCiAKIGluY2x1ZGUgJChERVBUSCkvY29uZmlnL2F1dG9jb25mLm1rCiBpbmNsdWRlICQo
dG9wc3JjZGlyKS9jb25maWcvcnVsZXMubWsKIAogX0JST1dTRVJfRklMRVMgPSBcCiAgIGhlYWQu
anMgXAogICByZW1vdGVfYXV0b2NvbXBsZXRlLmpzIFwKKyAgcmVtb3RlX2NvbnRlbnRwb3B1cC5q
cyBcCiAgIHJlbW90ZV9oZWFkLmpzIFwKICAgcmVtb3RlX2Zvcm1zLmpzIFwKICAgcmVtb3RlX2Zv
cm1zWm9vbS5qcyBcCiAgIHJlbW90ZV92a2IuanMgXAogICBicm93c2VyX2FkZG9ucy5qcyBcCiAg
IGJyb3dzZXJfYXV0b2NvbXBsZXRlLmh0bWwgXAogICBicm93c2VyX2F1dG9jb21wbGV0ZS5qcyBc
CiAgIGJyb3dzZXJfYXV0b2NvbXBsZXRlc2VhcmNoLmpzXApAQCAtNjEsMTYgKzYyLDE4IEBAIF9C
Uk9XU0VSX0ZJTEVTID0gXAogICBicm93c2VyX2JsYW5rXzAxLmh0bWwgXAogICBicm93c2VyX2Js
YW5rXzAyLmh0bWwgXAogICBicm93c2VyX2Jvb2ttYXJrcy5qcyBcCiAgIGJyb3dzZXJfYm9va21h
cmtzX3N0YXIuanMgXAogICBicm93c2VyX2Jvb2ttYXJrc190YWdzLmpzIFwKICAgYnJvd3Nlcl9j
bGlja19jb250ZW50Lmh0bWwgXAogICBicm93c2VyX2NsaWNrX2NvbnRlbnQuanMgXAogICBicm93
c2VyX2NvbnRhY3RzLmpzIFwKKyAgYnJvd3Nlcl9jb250ZW50cG9wdXAuaHRtbCBcCisgIGJyb3dz
ZXJfY29udGVudHBvcHVwLmpzIFwKICAgYnJvd3Nlcl9maW5kLmpzIFwKICAgYnJvd3Nlcl9mb3Jt
cy5odG1sIFwKICAgJCh3YXJuaW5nIGJyb3dzZXJfZm9ybXMuanMgZGlzYWJsZWQgZHVlIHRvIGZh
aWx1cmVzKSBcCiAgIGJyb3dzZXJfZm9ybXNab29tLmh0bWwgXAogICAkKHdhcm5pbmcgYnJvd3Nl
cl9mb3Jtc1pvb20uanMgZGlzYWJsZWQgZHVlIHRvIGZhaWx1cmVzKSBcCiAgIGJyb3dzZXJfaGlz
dG9yeS5qcyBcCiAgIGJyb3dzZXJfbWFpbnVpLmpzIFwKICAgYnJvd3Nlcl9uYXZpZ2F0aW9uLmpz
IFwKZGlmZiAtLWdpdCBhL2Nocm9tZS90ZXN0cy9icm93c2VyX2F1dG9jb21wbGV0ZS5odG1sIGIv
Y2hyb21lL3Rlc3RzL2Jyb3dzZXJfYXV0b2NvbXBsZXRlLmh0bWwKLS0tIGEvY2hyb21lL3Rlc3Rz
L2Jyb3dzZXJfYXV0b2NvbXBsZXRlLmh0bWwKKysrIGIvY2hyb21lL3Rlc3RzL2Jyb3dzZXJfYXV0
b2NvbXBsZXRlLmh0bWwKQEAgLTE2LDExICsxNiwxOSBAQAogICAgICAgPG9wdGlvbj5mb29iYXI8
L29wdGlvbj4KICAgICAgIDxvcHRpb24+Zm9vYmFyIGZvbzwvb3B0aW9uPgogICAgICAgPG9wdGlv
bj5mb29iYXIgZm9vIHRpdGk8L29wdGlvbj4KICAgICAgIDxvcHRpb24+Zm9vYmFyIGZvbyB0aXRp
IHRvdG88L29wdGlvbj4KICAgICAgIDxvcHRpb24+Zm9vYmFyIGZvbyB0aXRpIHRvdG8gdHV0dTwv
b3B0aW9uPgogICAgIDwvZGF0YWxpc3Q+CiAgICAgPGlucHV0IGlkPSJpbnB1dC1kYXRhbGlzdC0y
IiBsaXN0PSJkYXRhbGlzdC0yIj48L2lucHV0PgogCisgICAgPGJyIC8+PGJyIC8+CisKKyAgICA8
ZGF0YWxpc3QgaWQ9ImRhdGFsaXN0LTMiPgorICAgICAgPG9wdGlvbj5mb288L29wdGlvbj4KKyAg
ICA8L2RhdGFsaXN0PgorICAgIDxpbnB1dCBpZD0iaW5wdXQtZGF0YWxpc3QtMyIgbGlzdD0iZGF0
YWxpc3QtMyI+PC9pbnB1dD4KKworICAgIDxiciAvPjxiciAvPgogICA8L2JvZHk+CiA8L2h0bWw+
CiAKZGlmZiAtLWdpdCBhL2Nocm9tZS90ZXN0cy9icm93c2VyX2F1dG9jb21wbGV0ZS5qcyBiL2No
cm9tZS90ZXN0cy9icm93c2VyX2F1dG9jb21wbGV0ZS5qcwotLS0gYS9jaHJvbWUvdGVzdHMvYnJv
d3Nlcl9hdXRvY29tcGxldGUuanMKKysrIGIvY2hyb21lL3Rlc3RzL2Jyb3dzZXJfYXV0b2NvbXBs
ZXRlLmpzCkBAIC0xNSwzMiArMTUsNDIgQEAgZnVuY3Rpb24gdGVzdCgpIHsKICAgbWVzc2FnZU1h
bmFnZXIuYWRkTWVzc2FnZUxpc3RlbmVyKCJwYWdlc2hvdyIsIGZ1bmN0aW9uKGFNZXNzYWdlKSB7
CiAgICAgaWYgKG5ld1RhYiAmJiBuZXdUYWIuYnJvd3Nlci5jdXJyZW50VVJJLnNwZWMgIT0gImFi
b3V0OmJsYW5rIikgewogICAgICAgbWVzc2FnZU1hbmFnZXIucmVtb3ZlTWVzc2FnZUxpc3RlbmVy
KGFNZXNzYWdlLm5hbWUsIGFyZ3VtZW50cy5jYWxsZWUpOwogICAgICAgQnJvd3NlclVJLmNsb3Nl
QXV0b0NvbXBsZXRlKHRydWUpOwogICAgICAgc2V0VGltZW91dChydW5OZXh0VGVzdCwgMCk7CiAg
ICAgfQogICB9KTsKIAotICBuZXdUYWIgPSBCcm93c2VyLmFkZFRhYih0ZXN0VVJMLCB0cnVlKTsK
KyAgbGV0IHN0YXJ0dXBJbmZvID0gQ2NbIkBtb3ppbGxhLm9yZy90b29sa2l0L2FwcC1zdGFydHVw
OzEiXS5nZXRTZXJ2aWNlKENpLm5zSUFwcFN0YXJ0dXApLmdldFN0YXJ0dXBJbmZvKCk7CisgIGlm
ICghKCJmaXJzdFBhaW50IiBpbiBzdGFydHVwSW5mbykpCisgICAgd2FpdEZvcihmdW5jdGlvbigp
IHsgbmV3VGFiID0gQnJvd3Nlci5hZGRUYWIodGVzdFVSTCwgdHJ1ZSk7IH0sIGZ1bmN0aW9uKCkg
eworICAgICAgbGV0IHN0YXJ0dXBJbmZvID0gQ2NbIkBtb3ppbGxhLm9yZy90b29sa2l0L2FwcC1z
dGFydHVwOzEiXS5nZXRTZXJ2aWNlKENpLm5zSUFwcFN0YXJ0dXApLmdldFN0YXJ0dXBJbmZvKCk7
CisgICAgICByZXR1cm4gKCJmaXJzdFBhaW50IiBpbiBzdGFydHVwSW5mbyk7CisgICAgfSwgRGF0
ZS5ub3coKSArIDMwMDApOworICBlbHNlCisgICAgbmV3VGFiID0gQnJvd3Nlci5hZGRUYWIodGVz
dFVSTCwgdHJ1ZSk7CiB9CiAKIC8vLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0t
LS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCiAvLyBJdGVyYXRpbmcg
dGVzdHMgYnkgc2hpZnRpbmcgdGVzdCBvdXQgb25lIGJ5IG9uZSBhcyBydW5OZXh0VGVzdCBpcyBj
YWxsZWQuCiBmdW5jdGlvbiBydW5OZXh0VGVzdCgpIHsKICAgLy8gUnVuIHRoZSBuZXh0IHRlc3Qg
dW50aWwgYWxsIHRlc3RzIGNvbXBsZXRlZAogICBpZiAoZ1Rlc3RzLmxlbmd0aCA+IDApIHsKICAg
ICBnQ3VycmVudFRlc3QgPSBnVGVzdHMuc2hpZnQoKTsKICAgICBpbmZvKGdDdXJyZW50VGVzdC5k
ZXNjKTsKICAgICBnQ3VycmVudFRlc3QucnVuKCk7CiAgIH0KICAgZWxzZSB7CiAgICAgLy8gQ2xl
YW51cC4gQWxsIHRlc3RzIGFyZSBjb21wbGV0ZWQgYXQgdGhpcyBwb2ludAogICAgIHRyeSB7CiAg
ICAgICAvLyBBZGQgYW55IGNsZWFudXAgY29kZSBoZXJlCisKKyAgICAgIC8vIENsb3NlIG91ciB0
YWIgd2hlbiBmaW5pc2hlZAorICAgICAgQnJvd3Nlci5jbG9zZVRhYihuZXdUYWIpOwogICAgIH0K
ICAgICBmaW5hbGx5IHsKICAgICAgIC8vIFdlIG11c3QgZmluaWFsaXplIHRoZSB0ZXN0cwogICAg
ICAgZmluaXNoKCk7CiAgICAgfQogICB9CiB9CiAKQEAgLTEyNSwxNiArMTM1LDQ4IEBAIGdUZXN0
cy5wdXNoKHsKICAgICAgIGdDdXJyZW50VGVzdC5jaGVja1VJQ2xpY2soYUluZGV4ICsgMSk7CiAg
ICAgfSk7CiAgIH0sCiAKICAgZmluaXNoOiBmdW5jdGlvbigpIHsKICAgICAvLyBDbG9zZSB0aGUg
Zm9ybSBhc3Npc3RhbnQKICAgICBGb3JtSGVscGVyVUkuaGlkZSgpOwogCi0gICAgLy8gQ2xvc2Ug
b3VyIHRhYiB3aGVuIGZpbmlzaGVkCi0gICAgQnJvd3Nlci5jbG9zZVRhYihuZXdUYWIpOwogCi0g
ICAgLy8gV2UgbXVzdCBmaW5hbGl6ZSB0aGUgdGVzdHMKLSAgICBmaW5pc2goKTsKKyAgICBBc3lu
Y1Rlc3RzLndhaXRGb3IoIlRlc3RSZW1vdGVBdXRvY29tcGxldGU6UmVzZXQiLCB7IGlkOiAiaW5w
dXQtZGF0YWxpc3QtMSIgfSwgZnVuY3Rpb24oanNvbikgeworICAgICAgcnVuTmV4dFRlc3QoKTsK
KyAgICB9KTsKICAgfQogfSk7CiAKKy8vLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0t
LS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCisvLyBDYXNlOiBD
aGVjayBhcnJvd3MgdmlzaWJpbGl0eQorZ1Rlc3RzLnB1c2goeworICBkZXNjOiAiQ2hlY2sgYXJy
b3dzIHZpc2liaWxpdHkiLAorCisgIHJ1bjogZnVuY3Rpb24oKSB7CisgICAgbGV0IHBvcHVwID0g
ZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoImZvcm0taGVscGVyLXN1Z2dlc3Rpb25zLWNvbnRhaW5l
ciIpOworICAgIHBvcHVwLmFkZEV2ZW50TGlzdGVuZXIoImNvbnRlbnRwb3B1cHNob3duIiwgZnVu
Y3Rpb24oYUV2ZW50KSB7CisgICAgICBhRXZlbnQudGFyZ2V0LnJlbW92ZUV2ZW50TGlzdGVuZXIo
YUV2ZW50LnR5cGUsIGFyZ3VtZW50cy5jYWxsZWUsIGZhbHNlKTsKKyAgICAgIHdhaXRGb3IoZ0N1
cnJlbnRUZXN0LmNoZWNrTm9BcnJvd3MsIGZ1bmN0aW9uKCkgeworICAgICAgICByZXR1cm4gRm9y
bUhlbHBlclVJLl9vcGVuOworICAgICAgfSk7CisgICAgfSwgZmFsc2UpOworCisgICAgQXN5bmNU
ZXN0cy53YWl0Rm9yKCJUZXN0UmVtb3RlQXV0b2NvbXBsZXRlOkNsaWNrIiwKKyAgICAgICAgICAg
ICAgICAgICAgICAgIHsgaWQ6ICJpbnB1dC1kYXRhbGlzdC0zIiB9LCBmdW5jdGlvbihqc29uKSB7
fSk7CisgIH0sCisKKyAgY2hlY2tOb0Fycm93czogZnVuY3Rpb24oKSB7CisgICAgbGV0IHNjcm9s
bGJveCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJmb3JtLWhlbHBlci1zdWdnZXN0aW9ucyIp
OworICAgIHRvZG9faXMoc2Nyb2xsYm94Ll9zY3JvbGxCdXR0b25VcC5jb2xsYXBzZWQsIHRydWUs
ICJMZWZ0IGJ1dHRvbiBzaG91bGQgYmUgY29sbGFwc2VkIik7CisgICAgdG9kb19pcyhzY3JvbGxi
b3guX3Njcm9sbEJ1dHRvbkRvd24uY29sbGFwc2VkLCB0cnVlLCAiUmlnaHQgYnV0dG9uIHNob3Vs
ZCBiZSBjb2xsYXBzZWQiKTsKKyAgICBnQ3VycmVudFRlc3QuZmluaXNoKCk7CisgIH0sCisKKyAg
ZmluaXNoOiBmdW5jdGlvbigpIHsKKyAgICAvLyBDbG9zZSB0aGUgZm9ybSBhc3Npc3RhbnQKKyAg
ICBGb3JtSGVscGVyVUkuaGlkZSgpOworCisgICAgcnVuTmV4dFRlc3QoKTsKKyAgfQorfSk7CisK
ZGlmZiAtLWdpdCBhL2Nocm9tZS90ZXN0cy9icm93c2VyX2NvbnRlbnRwb3B1cC5odG1sIGIvY2hy
b21lL3Rlc3RzL2Jyb3dzZXJfY29udGVudHBvcHVwLmh0bWwKbmV3IGZpbGUgbW9kZSAxMDA2NDQK
LS0tIC9kZXYvbnVsbAorKysgYi9jaHJvbWUvdGVzdHMvYnJvd3Nlcl9jb250ZW50cG9wdXAuaHRt
bApAQCAtMCwwICsxLDI2IEBACis8aHRtbD4KKyAgPGJvZHk+CisgICAgPGRhdGFsaXN0IGlkPSJk
YXRhbGlzdC0xIj4KKyAgICAgIDxvcHRpb24+Zm9vPC9vcHRpb24+CisgICAgICA8b3B0aW9uIGRp
c2FibGVkPSJ0cnVlIj5iYXI8L29wdGlvbj4KKyAgICAgIDxvcHRpb24gdmFsdWU9ImJhciI+U29t
ZXdoYXQgYmFyPC9vcHRpb24+CisgICAgICA8b3B0aW9uIGxhYmVsPSJmb29iYXIiIHZhbHVlPSJf
Ij48L29wdGlvbj4KKyAgICA8L2RhdGFsaXN0PgorICAgIDxpbnB1dCBpZD0iaW5wdXQtZGF0YWxp
c3QtMSIgbGlzdD0iZGF0YWxpc3QtMSI+PC9pbnB1dD4KKworICAgIDxiciAvPjxiciAvPgorCisg
ICAgPGRhdGFsaXN0IGlkPSJkYXRhbGlzdC0yIj4KKyAgICAgIDxvcHRpb24+Zm9vPC9vcHRpb24+
CisgICAgICA8b3B0aW9uPmJhcjwvb3B0aW9uPgorICAgICAgPG9wdGlvbj5mb29iYXI8L29wdGlv
bj4KKyAgICAgIDxvcHRpb24+Zm9vYmFyIGZvbzwvb3B0aW9uPgorICAgICAgPG9wdGlvbj5mb29i
YXIgZm9vIHRpdGk8L29wdGlvbj4KKyAgICAgIDxvcHRpb24+Zm9vYmFyIGZvbyB0aXRpIHRvdG88
L29wdGlvbj4KKyAgICAgIDxvcHRpb24+Zm9vYmFyIGZvbyB0aXRpIHRvdG8gdHV0dTwvb3B0aW9u
PgorICAgIDwvZGF0YWxpc3Q+CisgICAgPGlucHV0IGlkPSJpbnB1dC1kYXRhbGlzdC0yIiBsaXN0
PSJkYXRhbGlzdC0yIj48L2lucHV0PgorCisgIDwvYm9keT4KKzwvaHRtbD4KKwpkaWZmIC0tZ2l0
IGEvY2hyb21lL3Rlc3RzL2Jyb3dzZXJfY29udGVudHBvcHVwLmpzIGIvY2hyb21lL3Rlc3RzL2Jy
b3dzZXJfY29udGVudHBvcHVwLmpzCm5ldyBmaWxlIG1vZGUgMTAwNjQ0Ci0tLSAvZGV2L251bGwK
KysrIGIvY2hyb21lL3Rlc3RzL2Jyb3dzZXJfY29udGVudHBvcHVwLmpzCkBAIC0wLDAgKzEsOTQg
QEAKK2xldCB0ZXN0VVJMID0gY2hyb21lUm9vdCArICJicm93c2VyX2NvbnRlbnRwb3B1cC5odG1s
IjsKK21lc3NhZ2VNYW5hZ2VyLmxvYWRGcmFtZVNjcmlwdChjaHJvbWVSb290ICsgInJlbW90ZV9j
b250ZW50cG9wdXAuanMiLCB0cnVlKTsKKworbGV0IG5ld1RhYiA9IG51bGw7CisKKy8vIEEgcXVl
dWUgdG8gb3JkZXIgdGhlIHRlc3RzIGFuZCBhIGhhbmRsZSBmb3IgZWFjaCB0ZXN0Cit2YXIgZ1Rl
c3RzID0gW107Cit2YXIgZ0N1cnJlbnRUZXN0ID0gbnVsbDsKKworZnVuY3Rpb24gdGVzdCgpIHsK
KyAgLy8gVGhpcyB0ZXN0IGlzIGFzeW5jCisgIHdhaXRGb3JFeHBsaWNpdEZpbmlzaCgpOworCisg
IC8vIE5lZWQgdG8gd2FpdCB1bnRpbCB0aGUgcGFnZSBpcyBsb2FkZWQKKyAgbWVzc2FnZU1hbmFn
ZXIuYWRkTWVzc2FnZUxpc3RlbmVyKCJwYWdlc2hvdyIsIGZ1bmN0aW9uKGFNZXNzYWdlKSB7Cisg
ICAgaWYgKG5ld1RhYiAmJiBuZXdUYWIuYnJvd3Nlci5jdXJyZW50VVJJLnNwZWMgIT0gImFib3V0
OmJsYW5rIikgeworICAgICAgbWVzc2FnZU1hbmFnZXIucmVtb3ZlTWVzc2FnZUxpc3RlbmVyKGFN
ZXNzYWdlLm5hbWUsIGFyZ3VtZW50cy5jYWxsZWUpOworICAgICAgQnJvd3NlclVJLmNsb3NlQXV0
b0NvbXBsZXRlKHRydWUpOworICAgICAgc2V0VGltZW91dChydW5OZXh0VGVzdCwgMCk7CisgICAg
fQorICB9KTsKKworICBsZXQgc3RhcnR1cEluZm8gPSBDY1siQG1vemlsbGEub3JnL3Rvb2xraXQv
YXBwLXN0YXJ0dXA7MSJdLmdldFNlcnZpY2UoQ2kubnNJQXBwU3RhcnR1cCkuZ2V0U3RhcnR1cElu
Zm8oKTsKKyAgaWYgKCEoImZpcnN0UGFpbnQiIGluIHN0YXJ0dXBJbmZvKSkKKyAgICB3YWl0Rm9y
KGZ1bmN0aW9uKCkgeyBuZXdUYWIgPSBCcm93c2VyLmFkZFRhYih0ZXN0VVJMLCB0cnVlKTsgfSwg
ZnVuY3Rpb24oKSB7CisgICAgICBsZXQgc3RhcnR1cEluZm8gPSBDY1siQG1vemlsbGEub3JnL3Rv
b2xraXQvYXBwLXN0YXJ0dXA7MSJdLmdldFNlcnZpY2UoQ2kubnNJQXBwU3RhcnR1cCkuZ2V0U3Rh
cnR1cEluZm8oKTsKKyAgICAgIHJldHVybiAoImZpcnN0UGFpbnQiIGluIHN0YXJ0dXBJbmZvKTsK
KyAgICB9LCBEYXRlLm5vdygpICsgMzAwMCk7CisgIGVsc2UKKyAgICBuZXdUYWIgPSBCcm93c2Vy
LmFkZFRhYih0ZXN0VVJMLCB0cnVlKTsKK30KKworLy8tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0t
LS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KKy8v
IEl0ZXJhdGluZyB0ZXN0cyBieSBzaGlmdGluZyB0ZXN0IG91dCBvbmUgYnkgb25lIGFzIHJ1bk5l
eHRUZXN0IGlzIGNhbGxlZC4KK2Z1bmN0aW9uIHJ1bk5leHRUZXN0KCkgeworICAvLyBSdW4gdGhl
IG5leHQgdGVzdCB1bnRpbCBhbGwgdGVzdHMgY29tcGxldGVkCisgIGlmIChnVGVzdHMubGVuZ3Ro
ID4gMCkgeworICAgIGdDdXJyZW50VGVzdCA9IGdUZXN0cy5zaGlmdCgpOworICAgIGluZm8oZ0N1
cnJlbnRUZXN0LmRlc2MpOworICAgIGdDdXJyZW50VGVzdC5ydW4oKTsKKyAgfQorICBlbHNlIHsK
KyAgICAvLyBDbGVhbnVwLiBBbGwgdGVzdHMgYXJlIGNvbXBsZXRlZCBhdCB0aGlzIHBvaW50Cisg
ICAgdHJ5IHsKKyAgICAgIC8vIEFkZCBhbnkgY2xlYW51cCBjb2RlIGhlcmUKKworICAgICAgLy8g
Q2xvc2Ugb3VyIHRhYiB3aGVuIGZpbmlzaGVkCisgICAgICBCcm93c2VyLmNsb3NlVGFiKG5ld1Rh
Yik7CisgICAgfQorICAgIGZpbmFsbHkgeworICAgICAgLy8gV2UgbXVzdCBmaW5pYWxpemUgdGhl
IHRlc3RzCisgICAgICBmaW5pc2goKTsKKyAgICB9CisgIH0KK30KKworLy8tLS0tLS0tLS0tLS0t
LS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0t
LS0tLS0tLS0KKy8vIENhc2U6IFNob3cvSGlkZSB0aGUgY29udGVudCBwb3B1cCBoZWxwZXIKK2dU
ZXN0cy5wdXNoKHsKKyAgZGVzYzogIlNob3cvSGlkZSB0aGUgY29udGVudCBwb3B1cCBoZWxwZXIi
LAorCisgIHJ1bjogZnVuY3Rpb24oKSB7CisgICAgbGV0IHBvcHVwID0gZG9jdW1lbnQuZ2V0RWxl
bWVudEJ5SWQoImZvcm0taGVscGVyLXN1Z2dlc3Rpb25zLWNvbnRhaW5lciIpOworICAgIHBvcHVw
LmFkZEV2ZW50TGlzdGVuZXIoImNvbnRlbnRwb3B1cHNob3duIiwgZnVuY3Rpb24oYUV2ZW50KSB7
CisgICAgICBhRXZlbnQudGFyZ2V0LnJlbW92ZUV2ZW50TGlzdGVuZXIoYUV2ZW50LnR5cGUsIGFy
Z3VtZW50cy5jYWxsZWUsIGZhbHNlKTsKKyAgICAgIG9rKCFwb3B1cC5oaWRkZW4sICJDb250ZW50
IHBvcHVwIHNob3VsZCBiZSB2aXNpYmxlIik7CisgICAgICB3YWl0Rm9yKGdDdXJyZW50VGVzdC5o
aWRlUG9wdXAsIGZ1bmN0aW9uKCkgeworICAgICAgICByZXR1cm4gRm9ybUhlbHBlclVJLl9vcGVu
OworICAgICAgfSk7CisgICAgfSwgZmFsc2UpOworCisgICAgQXN5bmNUZXN0cy53YWl0Rm9yKCJU
ZXN0UmVtb3RlQXV0b2NvbXBsZXRlOkNsaWNrIiwKKyAgICAgICAgICAgICAgICAgICAgICAgIHsg
aWQ6ICJpbnB1dC1kYXRhbGlzdC0xIiB9LCBmdW5jdGlvbihqc29uKSB7fSk7CisgIH0sCisKKyAg
aGlkZVBvcHVwOiBmdW5jdGlvbigpIHsKKyAgICBsZXQgcG9wdXAgPSBkb2N1bWVudC5nZXRFbGVt
ZW50QnlJZCgiZm9ybS1oZWxwZXItc3VnZ2VzdGlvbnMtY29udGFpbmVyIik7CisgICAgcG9wdXAu
YWRkRXZlbnRMaXN0ZW5lcigiY29udGVudHBvcHVwaGlkZGVuIiwgZnVuY3Rpb24oYUV2ZW50KSB7
CisgICAgICBwb3B1cC5yZW1vdmVFdmVudExpc3RlbmVyKCJjb250ZW50cG9wdXBoaWRkZW4iLCBh
cmd1bWVudHMuY2FsbGVlLCBmYWxzZSk7CisgICAgICBvayhwb3B1cC5oaWRkZW4sICJDb250ZW50
IHBvcHVwIHNob3VsZCBiZSBoaWRkZW4iKTsKKyAgICAgIHdhaXRGb3IoZ0N1cnJlbnRUZXN0LmZp
bmlzaCwgZnVuY3Rpb24oKSB7CisgICAgICAgIHJldHVybiAhRm9ybUhlbHBlclVJLl9vcGVuOwor
ICAgICAgfSk7CisgICAgfSwgZmFsc2UpOworCisgICAgLy8gQ2xvc2UgdGhlIGZvcm0gYXNzaXN0
YW50CisgICAgRm9ybUhlbHBlclVJLmhpZGUoKTsKKyAgfSwKKworICBmaW5pc2g6IGZ1bmN0aW9u
KCkgeworICAgIHJ1bk5leHRUZXN0KCk7CisgIH0KK30pOworCmRpZmYgLS1naXQgYS9jaHJvbWUv
dGVzdHMvcmVtb3RlX2F1dG9jb21wbGV0ZS5qcyBiL2Nocm9tZS90ZXN0cy9yZW1vdGVfYXV0b2Nv
bXBsZXRlLmpzCi0tLSBhL2Nocm9tZS90ZXN0cy9yZW1vdGVfYXV0b2NvbXBsZXRlLmpzCisrKyBi
L2Nocm9tZS90ZXN0cy9yZW1vdGVfYXV0b2NvbXBsZXRlLmpzCkBAIC0xMSw4ICsxMSwxNSBAQCBB
c3luY1Rlc3RzLmFkZCgiVGVzdFJlbW90ZUF1dG9jb21wbGV0ZTpDCiAgIHJldHVybiB0cnVlOwog
fSk7CiAKIEFzeW5jVGVzdHMuYWRkKCJUZXN0UmVtb3RlQXV0b2NvbXBsZXRlOkNoZWNrIiwgZnVu
Y3Rpb24oYU1lc3NhZ2UsIGFKc29uKSB7CiAgIGxldCBlbGVtZW50ID0gY29udGVudC5kb2N1bWVu
dC5nZXRFbGVtZW50QnlJZChhSnNvbi5pZCk7CiAgIHJldHVybiBlbGVtZW50LnZhbHVlOwogfSk7
CiAKK0FzeW5jVGVzdHMuYWRkKCJUZXN0UmVtb3RlQXV0b2NvbXBsZXRlOlJlc2V0IiwgZnVuY3Rp
b24oYU1lc3NhZ2UsIGFKc29uKSB7CisgIGdGb2N1c01hbmFnZXIuZm9jdXNlZEVsZW1lbnQgPSBu
dWxsOworICBsZXQgZWxlbWVudCA9IGNvbnRlbnQuZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoYUpz
b24uaWQpOworICBlbGVtZW50LnZhbHVlID0gIiI7CisgIHJldHVybiB0cnVlOworfSk7CisKZGlm
ZiAtLWdpdCBhL2Nocm9tZS90ZXN0cy9yZW1vdGVfY29udGVudHBvcHVwLmpzIGIvY2hyb21lL3Rl
c3RzL3JlbW90ZV9jb250ZW50cG9wdXAuanMKbmV3IGZpbGUgbW9kZSAxMDA2NDQKLS0tIC9kZXYv
bnVsbAorKysgYi9jaHJvbWUvdGVzdHMvcmVtb3RlX2NvbnRlbnRwb3B1cC5qcwpAQCAtMCwwICsx
LDE4IEBACitkdW1wKCI9PT09PT09PT09PT09PT09PT09PT09IENvbnRlbnQgU2NyaXB0IExvYWRl
ZCA9PT09PT09PT09PT09PT09PT09PT09PVxuIik7CisKK2xldCBhc3Npc3RhbnQgPSBDb250ZW50
Ll9mb3JtQXNzaXN0YW50OworCitBc3luY1Rlc3RzLmFkZCgiVGVzdFJlbW90ZUF1dG9jb21wbGV0
ZTpDbGljayIsIGZ1bmN0aW9uKGFNZXNzYWdlLCBhSnNvbikgeworICBsZXQgZWxlbWVudCA9IGNv
bnRlbnQuZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoYUpzb24uaWQpOworICBhc3Npc3RhbnQub3Bl
bihlbGVtZW50KTsKKyAgYXNzaXN0YW50Ll9leGVjdXRlRGVsYXllZChmdW5jdGlvbihhc3Npc3Rh
bnQpIHsKKyAgICBzZW5kQXN5bmNNZXNzYWdlKCJGb3JtQXNzaXN0OkF1dG9Db21wbGV0ZSIsIGFz
c2lzdGFudC5fZ2V0SlNPTigpKTsKKyAgfSk7CisgIHJldHVybiB0cnVlOworfSk7CisKK0FzeW5j
VGVzdHMuYWRkKCJUZXN0UmVtb3RlQXV0b2NvbXBsZXRlOkNoZWNrIiwgZnVuY3Rpb24oYU1lc3Nh
Z2UsIGFKc29uKSB7CisgIGxldCBlbGVtZW50ID0gY29udGVudC5kb2N1bWVudC5nZXRFbGVtZW50
QnlJZChhSnNvbi5pZCk7CisgIHJldHVybiBlbGVtZW50LnZhbHVlOworfSk7CisK
</data>
<flag name="review"
          id="437917"
          type_id="4"
          status="-"
          setter="mark.finkle"
    />
          </attachment>
          <attachment
              isobsolete="0"
              ispatch="1"
              isprivate="0"
              isurl="0"
          >
            <attachid>524677</attachid>
            <date>2011-04-08 10:47:00 -0700</date>
            <delta_ts>2011-04-08 10:47:24 -0700</delta_ts>
            <desc>Patch v0.2</desc>
            <filename>bug-contentvalidation-separation.diff</filename>
            <type>text/plain</type>
            <size>40659</size>
            <attacher>21</attacher>
            
              <data encoding="base64">ZGlmZiAtLWdpdCBhL21vYmlsZS9jaHJvbWUvY29udGVudC9Db250ZW50UG9wdXBIZWxwZXIuanMg
Yi9tb2JpbGUvY2hyb21lL2NvbnRlbnQvQ29udGVudFBvcHVwSGVscGVyLmpzCm5ldyBmaWxlIG1v
ZGUgMTAwNjQ0Ci0tLSAvZGV2L251bGwKKysrIGIvbW9iaWxlL2Nocm9tZS9jb250ZW50L0NvbnRl
bnRQb3B1cEhlbHBlci5qcwpAQCAtMCwwICsxLDIyNyBAQAorLyogKioqKiogQkVHSU4gTElDRU5T
RSBCTE9DSyAqKioqKgorICogVmVyc2lvbjogTVBMIDEuMS9HUEwgMi4wL0xHUEwgMi4xCisgKgor
ICogVGhlIGNvbnRlbnRzIG9mIHRoaXMgZmlsZSBhcmUgc3ViamVjdCB0byB0aGUgTW96aWxsYSBQ
dWJsaWMgTGljZW5zZSBWZXJzaW9uCisgKiAxLjEgKHRoZSAiTGljZW5zZSIpOyB5b3UgbWF5IG5v
dCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGgKKyAqIHRoZSBMaWNlbnNl
LiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXQKKyAqIGh0dHA6Ly93d3cu
bW96aWxsYS5vcmcvTVBMLworICoKKyAqIFNvZnR3YXJlIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBM
aWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuICJBUyBJUyIgYmFzaXMsCisgKiBXSVRIT1VUIFdB
UlJBTlRZIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLiBTZWUgdGhlIExp
Y2Vuc2UKKyAqIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHJpZ2h0cyBhbmQg
bGltaXRhdGlvbnMgdW5kZXIgdGhlCisgKiBMaWNlbnNlLgorICoKKyAqIFRoZSBPcmlnaW5hbCBD
b2RlIGlzIG1vemlsbGEub3JnIGNvZGUKKyAqCisgKiBUaGUgSW5pdGlhbCBEZXZlbG9wZXIgb2Yg
dGhlIE9yaWdpbmFsIENvZGUgaXMKKyAqIE1vemlsbGEgQ29ycG9yYXRpb24uCisgKiBQb3J0aW9u
cyBjcmVhdGVkIGJ5IHRoZSBJbml0aWFsIERldmVsb3BlciBhcmUgQ29weXJpZ2h0IChDKSAyMDA3
CisgKiB0aGUgSW5pdGlhbCBEZXZlbG9wZXIuIEFsbCBSaWdodHMgUmVzZXJ2ZWQuCisgKgorICog
Q29udHJpYnV0b3Iocyk6CisgKgorICogQWx0ZXJuYXRpdmVseSwgdGhlIGNvbnRlbnRzIG9mIHRo
aXMgZmlsZSBtYXkgYmUgdXNlZCB1bmRlciB0aGUgdGVybXMgb2YKKyAqIGVpdGhlciB0aGUgR05V
IEdlbmVyYWwgUHVibGljIExpY2Vuc2UgVmVyc2lvbiAyIG9yIGxhdGVyICh0aGUgIkdQTCIpLCBv
cgorICogdGhlIEdOVSBMZXNzZXIgR2VuZXJhbCBQdWJsaWMgTGljZW5zZSBWZXJzaW9uIDIuMSBv
ciBsYXRlciAodGhlICJMR1BMIiksCisgKiBpbiB3aGljaCBjYXNlIHRoZSBwcm92aXNpb25zIG9m
IHRoZSBHUEwgb3IgdGhlIExHUEwgYXJlIGFwcGxpY2FibGUgaW5zdGVhZAorICogb2YgdGhvc2Ug
YWJvdmUuIElmIHlvdSB3aXNoIHRvIGFsbG93IHVzZSBvZiB5b3VyIHZlcnNpb24gb2YgdGhpcyBm
aWxlIG9ubHkKKyAqIHVuZGVyIHRoZSB0ZXJtcyBvZiBlaXRoZXIgdGhlIEdQTCBvciB0aGUgTEdQ
TCwgYW5kIG5vdCB0byBhbGxvdyBvdGhlcnMgdG8KKyAqIHVzZSB5b3VyIHZlcnNpb24gb2YgdGhp
cyBmaWxlIHVuZGVyIHRoZSB0ZXJtcyBvZiB0aGUgTVBMLCBpbmRpY2F0ZSB5b3VyCisgKiBkZWNp
c2lvbiBieSBkZWxldGluZyB0aGUgcHJvdmlzaW9ucyBhYm92ZSBhbmQgcmVwbGFjZSB0aGVtIHdp
dGggdGhlIG5vdGljZQorICogYW5kIG90aGVyIHByb3Zpc2lvbnMgcmVxdWlyZWQgYnkgdGhlIEdQ
TCBvciB0aGUgTEdQTC4gSWYgeW91IGRvIG5vdCBkZWxldGUKKyAqIHRoZSBwcm92aXNpb25zIGFi
b3ZlLCBhIHJlY2lwaWVudCBtYXkgdXNlIHlvdXIgdmVyc2lvbiBvZiB0aGlzIGZpbGUgdW5kZXIK
KyAqIHRoZSB0ZXJtcyBvZiBhbnkgb25lIG9mIHRoZSBNUEwsIHRoZSBHUEwgb3IgdGhlIExHUEwu
CisgKgorICogKioqKiogRU5EIExJQ0VOU0UgQkxPQ0sgKioqKiogKi8KKwordmFyIENvbnRlbnRQ
b3B1cEhlbHBlciA9IHsKKyAgX3BvcHVwOiBudWxsLAorICBnZXQgcG9wdXAoKSB7CisgICAgcmV0
dXJuIHRoaXMuX3BvcHVwOworICB9LAorCisgIHNldCBwb3B1cChhUG9wdXApIHsKKyAgICAvLyBJ
ZiB0aGVyZSBpcyBub3RoaW5nIHRvIGRvIHRoZW4gYmFpbCBvdXQKKyAgICBpZiAoIXRoaXMuX3Bv
cHVwICYmICFhUG9wdXApCisgICAgICByZXR1cm47CisKKyAgICBpZiAoYVBvcHVwKSB7CisgICAg
ICAvLyBLZWVwcyB0aGUgbmV3IHBvcHVwIGVsZW1lbnQgaGlkZGVuIHVudGlsIGl0IGlzIHBvc2l0
aW9uZWQsIGJ1dCB1c2luZworICAgICAgLy8gdmlzaWJpbGl0eTogJ2hpZGRlbicgaW5zdGVhZCBv
ZiBkaXNwbGF5OiAnbm9uZScgd2lsbCBhbGxvdyB0bworICAgICAgLy8gd29ya2Fyb3VuZCBzb21l
IGJ1Z3Mgd2l0aCBhcnJvd3Njcm9sbGJveCdzIGFycm93cyB0aGF0IGRvZXMgbm90CisgICAgICAv
LyB1cGRhdGUgdGhlaXIgaGlkZGVuIHN0YXRlIGNvcnJlY3RseSB3aGVuIHVzZWQgYXMgYSBjaGls
ZCAoYmVjYXVzZSBvZgorICAgICAgLy8gbWlzc2VkIHVuZGVyZmxvdyBldmVudHMpCisgICAgICAv
LworICAgICAgLy8gQWxzbyB0aGUgcG9wdXAgaXMgbW92ZWQgdG8gdGhlIGxlZnQgYm9yZGVyIG9m
IHRoZSB3aW5kb3cgb3RoZXJ3aXNlIHRoZQorICAgICAgLy8gc2lkZWJhcnMgcG9zaXRpb24gYXJl
IG1lc3NlZCB1cCB3aGVuIHRoZSBjb250ZW50IG9mIHRoZSBwb3B1cCdzIGNoaWxkCisgICAgICAv
LyBpcyB0b28gd2lkZSwgYnV0IHNpbmNlIHRoZSBzaXplIG9mIHRoZSBwb3B1cCBjYW4ndCBiZSBs
YXJnZXIgdGhhbiA3NSUKKyAgICAgIC8vIG9mIHRoZSB3aW5kb3cgd2lkdGggKHNlZSB0aGUgdXBk
YXRlIG1ldGhvZCkgdGhlbiB0aGUgcHJvYmxlbSBkb2VzIG5vdAorICAgICAgLy8gYXBwZWFyIGlm
IHRoZSBwb3B1cCBpcyBwb3NpdGlvbmVkIGJldHdlZW4gMC0yNSUgcGVyY2VudCBvZiB0aGUgd2lu
ZG93CisgICAgICAvLyB3aWR0aAorICAgICAgYVBvcHVwLmxlZnQgPSAwOworICAgICAgYVBvcHVw
LmZpcnN0Q2hpbGQuc3R5bGUubWF4V2lkdGggPSAiMHB4IjsKKyAgICAgIGFQb3B1cC5zdHlsZS52
aXNpYmlsaXR5ID0gImhpZGRlbiI7CisgICAgICBhUG9wdXAuaGlkZGVuID0gZmFsc2U7CisKKyAg
ICAgIHdpbmRvdy5hZGRFdmVudExpc3RlbmVyKCJUYWJTZWxlY3QiLCB0aGlzLCBmYWxzZSk7Cisg
ICAgICB3aW5kb3cuYWRkRXZlbnRMaXN0ZW5lcigiVGFiQ2xvc2UiLCB0aGlzLCBmYWxzZSk7Cisg
ICAgICB3aW5kb3cuYWRkRXZlbnRMaXN0ZW5lcigiQW5pbWF0ZWRab29tQmVnaW4iLCB0aGlzLCBm
YWxzZSk7CisgICAgICB3aW5kb3cuYWRkRXZlbnRMaXN0ZW5lcigiQW5pbWF0ZWRab29tRW5kIiwg
dGhpcywgZmFsc2UpOworICAgICAgd2luZG93LmFkZEV2ZW50TGlzdGVuZXIoIk1vekJlZm9yZVJl
c2l6ZSIsIHRoaXMsIHRydWUpOworICAgICAgd2luZG93LmFkZEV2ZW50TGlzdGVuZXIoInJlc2l6
ZSIsIHRoaXMsIGZhbHNlKTsKKyAgICAgIEVsZW1lbnRzLmJyb3dzZXJzLmFkZEV2ZW50TGlzdGVu
ZXIoIlBhbkJlZ2luIiwgdGhpcywgZmFsc2UpOworICAgICAgRWxlbWVudHMuYnJvd3NlcnMuYWRk
RXZlbnRMaXN0ZW5lcigiUGFuRmluaXNoZWQiLCB0aGlzLCBmYWxzZSk7CisgICAgfSBlbHNlIHsK
KyAgICAgIHRoaXMuX3BvcHVwLmhpZGRlbiA9IHRydWU7CisgICAgICB0aGlzLl9hbmNob3JSZWN0
ID0gbnVsbDsKKworICAgICAgd2luZG93LnJlbW92ZUV2ZW50TGlzdGVuZXIoIlRhYlNlbGVjdCIs
IHRoaXMsIGZhbHNlKTsKKyAgICAgIHdpbmRvdy5yZW1vdmVFdmVudExpc3RlbmVyKCJUYWJDbG9z
ZSIsIHRoaXMsIGZhbHNlKTsKKyAgICAgIHdpbmRvdy5yZW1vdmVFdmVudExpc3RlbmVyKCJBbmlt
YXRlZFpvb21CZWdpbiIsIHRoaXMsIGZhbHNlKTsKKyAgICAgIHdpbmRvdy5yZW1vdmVFdmVudExp
c3RlbmVyKCJBbmltYXRlZFpvb21FbmQiLCB0aGlzLCBmYWxzZSk7CisgICAgICB3aW5kb3cucmVt
b3ZlRXZlbnRMaXN0ZW5lcigiTW96QmVmb3JlUmVzaXplIiwgdGhpcywgdHJ1ZSk7CisgICAgICB3
aW5kb3cucmVtb3ZlRXZlbnRMaXN0ZW5lcigicmVzaXplIiwgdGhpcywgZmFsc2UpOworICAgICAg
RWxlbWVudHMuYnJvd3NlcnMucmVtb3ZlRXZlbnRMaXN0ZW5lcigiUGFuQmVnaW4iLCB0aGlzLCBm
YWxzZSk7CisgICAgICBFbGVtZW50cy5icm93c2Vycy5yZW1vdmVFdmVudExpc3RlbmVyKCJQYW5G
aW5pc2hlZCIsIHRoaXMsIGZhbHNlKTsKKworICAgICAgbGV0IGV2ZW50ID0gZG9jdW1lbnQuY3Jl
YXRlRXZlbnQoIkV2ZW50cyIpOworICAgICAgZXZlbnQuaW5pdEV2ZW50KCJjb250ZW50cG9wdXBo
aWRkZW4iLCB0cnVlLCBmYWxzZSk7CisgICAgICB0aGlzLl9wb3B1cC5kaXNwYXRjaEV2ZW50KGV2
ZW50KTsKKyAgICB9CisKKyAgICB0aGlzLl9wb3B1cCA9IGFQb3B1cDsKKyAgfSwKKworICAvKioK
KyAgICogVGhpcyBtZXRob2QgcG9zaXRpb25lZCBhbiBhcnJvd2JveCBvbiB0aGUgc2NyZWVuIHVz
aW5nIGEgJ3ZpcnR1YWwnCisgICAqIGVsZW1lbnQgYXMgcmVmZXJyZXIgdGhhdCBtYXRjaCB0aGUg
cmVhbCBjb250ZW50IGVsZW1lbnQKKyAgICogVGhpcyBtZXRob2QgY2FsbGVkIGVsZW1lbnQuZ2V0
Qm91bmRpbmdDbGllbnRSZWN0KCkgbWFueSB0aW1lcyBhbmQgY2FuIGJlCisgICAqIGV4cGVuc2l2
ZSwgZG8gbm90IGNhbGxlZCBpdCB0b28gbWFueSB0aW1lcy4KKyAgICovCisgIGFuY2hvclRvOiBm
dW5jdGlvbihhQW5jaG9yUmVjdCkgeworICAgIGxldCBwb3B1cCA9IHRoaXMuX3BvcHVwOworICAg
IGlmICghcG9wdXApCisgICAgICByZXR1cm47CisKKyAgICAvLyBVc2UgdGhlIG9sZCByZWN0IHVu
dGlsIHdlIGdldCBhIG5ldyBvbmUKKyAgICB0aGlzLl9hbmNob3JSZWN0ID0gYUFuY2hvclJlY3Qg
PyBhQW5jaG9yUmVjdCA6IHRoaXMuX2FuY2hvclJlY3Q7CisKKyAgICAvLyBDYWxjdWxhdGUgdGhl
IG1heGltdW0gc2l6ZSBvZiB0aGUgYXJyb3dwYW5lbCBieSBhbGxvd2luZyBpdCB0byBsaXZlIG9u
bHkKKyAgICAvLyBvbiB0aGUgdmlzaWJsZSBicm93c2VyIGFyZWEKKyAgICBsZXQgW2xlZnRWaXMs
IHJpZ2h0VmlzLCBsZWZ0VywgcmlnaHRXXSA9IEJyb3dzZXIuY29tcHV0ZVNpZGViYXJWaXNpYmls
aXR5KCk7CisgICAgbGV0IGxlZnRPZmZzZXQgPSBsZWZ0VmlzICogbGVmdFc7CisgICAgbGV0IHJp
Z2h0T2Zmc2V0ID0gcmlnaHRWaXMgKiByaWdodFc7CisgICAgbGV0IHZpc2libGVBcmVhV2lkdGgg
PSB3aW5kb3cuaW5uZXJXaWR0aCAtIGxlZnRPZmZzZXQgLSByaWdodE9mZnNldDsKKyAgICBwb3B1
cC5maXJzdENoaWxkLnN0eWxlLm1heFdpZHRoID0gKHZpc2libGVBcmVhV2lkdGggKiAwLjc1KSAr
ICJweCI7CisKKyAgICBsZXQgYnJvd3NlciA9IGdldEJyb3dzZXIoKTsKKyAgICBsZXQgcmVjdCA9
IHRoaXMuX2FuY2hvclJlY3QuY2xvbmUoKS5zY2FsZShicm93c2VyLnNjYWxlLCBicm93c2VyLnNj
YWxlKTsKKyAgICBsZXQgc2Nyb2xsID0gYnJvd3Nlci5nZXRSb290VmlldygpLmdldFBvc2l0aW9u
KCk7CisKKyAgICAvLyBUaGUgc2lkZWJhcnMgc2Nyb2xsIG5lZWRzIHRvIGJlIHRha2VuIGludG8g
YWNjb3VudCwgb3RoZXJ3aXNlIHRoZSBhcnJvd3MKKyAgICAvLyBjYW4gYmUgbWlzcGxhY2VkIGlm
IHRoZSBzaWRlYmFycyBhcmUgb3BlbgorICAgIGxldCB0b3BPZmZzZXQgPSAoQnJvd3NlclVJLnRv
b2xiYXJIIC0gQnJvd3Nlci5nZXRTY3JvbGxib3hQb3NpdGlvbihCcm93c2VyLnBhZ2VTY3JvbGxi
b3hTY3JvbGxlcikueSk7CisgICAgbGV0IHZpcnR1YWxDb250ZW50UmVjdCA9IHsKKyAgICAgIHdp
ZHRoOiByZWN0LndpZHRoLAorICAgICAgaGVpZ2h0OiByZWN0LmhlaWdodCwKKyAgICAgIGxlZnQ6
IE1hdGguY2VpbChyZWN0LmxlZnQgLSBzY3JvbGwueCArIGxlZnRPZmZzZXQgLSByaWdodE9mZnNl
dCksCisgICAgICByaWdodDogTWF0aC5mbG9vcihyZWN0LmxlZnQgKyByZWN0LndpZHRoIC0gc2Ny
b2xsLnggKyBsZWZ0T2Zmc2V0IC0gcmlnaHRPZmZzZXQpLAorICAgICAgdG9wOiBNYXRoLmNlaWwo
cmVjdC50b3AgLSBzY3JvbGwueSArIHRvcE9mZnNldCksCisgICAgICBib3R0b206IE1hdGguZmxv
b3IocmVjdC50b3AgKyByZWN0LmhlaWdodCAtIHNjcm9sbC55ICsgdG9wT2Zmc2V0KQorICAgIH07
CisKKyAgICAvLyBUcmFuc2xhdGUgdGhlIHZpcnR1YWwgcmVjdCBpbnNpZGUgdGhlIGJvdW5kcyBv
ZiB0aGUgdmlld2FibGUgYXJlYSBpZiBpdAorICAgIC8vIG92ZXJmbG93CisgICAgaWYgKHZpcnR1
YWxDb250ZW50UmVjdC5sZWZ0ICsgdmlydHVhbENvbnRlbnRSZWN0LndpZHRoID4gdmlzaWJsZUFy
ZWFXaWR0aCkgeworICAgICAgbGV0IG9mZnNldFggPSB2aXNpYmxlQXJlYVdpZHRoIC0gKHZpcnR1
YWxDb250ZW50UmVjdC5sZWZ0ICsgdmlydHVhbENvbnRlbnRSZWN0LndpZHRoKTsKKyAgICAgIHZp
cnR1YWxDb250ZW50UmVjdC53aWR0aCArPSBvZmZzZXRYOworICAgICAgdmlydHVhbENvbnRlbnRS
ZWN0LnJpZ2h0IC09IG9mZnNldFg7CisgICAgfQorCisgICAgaWYgKHZpcnR1YWxDb250ZW50UmVj
dC5sZWZ0IDwgbGVmdE9mZnNldCkgeworICAgICAgbGV0IG9mZnNldFggPSAodmlydHVhbENvbnRl
bnRSZWN0LnJpZ2h0IC0gdmlydHVhbENvbnRlbnRSZWN0LndpZHRoKTsKKyAgICAgIHZpcnR1YWxD
b250ZW50UmVjdC53aWR0aCArPSBvZmZzZXRYOworICAgICAgdmlydHVhbENvbnRlbnRSZWN0Lmxl
ZnQgLT0gb2Zmc2V0WDsKKyAgICB9CisKKyAgICAvLyBJZiB0aGUgc3VnZ2VzdGlvbnMgYXJlIG91
dCBvZiB2aWV3IHRoZXJlIGlzIG5vIG5lZWQgdG8gZGlzcGxheSBpdAorICAgIGxldCBicm93c2Vy
UmVjdCA9IFJlY3QuZnJvbVJlY3QoYnJvd3Nlci5nZXRCb3VuZGluZ0NsaWVudFJlY3QoKSk7Cisg
ICAgaWYgKEJyb3dzZXJVSS5pc1Rvb2xiYXJMb2NrZWQoKSkgeworICAgICAgLy8gSWYgdGhlIHRv
b2xiYXIgaXMgbG9ja2VkLCBpdCBjYW4gYXBwZWFyIG92ZXIgdGhlIGZpZWxkIGluIHN1Y2ggYSB3
YXkKKyAgICAgIC8vIHRoYXQgdGhlIGZpZWxkIGlzIGhpZGRlbgorICAgICAgbGV0IHRvb2xiYXJI
ID0gQnJvd3NlclVJLnRvb2xiYXJIOworICAgICAgYnJvd3NlclJlY3QgPSBuZXcgUmVjdChsZWZ0
T2Zmc2V0IC0gcmlnaHRPZmZzZXQsIE1hdGgubWF4KDAsIGJyb3dzZXJSZWN0LnRvcCAtIHRvb2xi
YXJIKSArIHRvb2xiYXJILAorICAgICAgICAgICAgICAgICAgICAgICAgICAgICBicm93c2VyUmVj
dC53aWR0aCArIGxlZnRPZmZzZXQgLSByaWdodE9mZnNldCwgYnJvd3NlclJlY3QuaGVpZ2h0IC0g
dG9vbGJhckgpOworICAgIH0KKworICAgIGlmIChicm93c2VyUmVjdC5pbnRlcnNlY3QoUmVjdC5m
cm9tUmVjdCh2aXJ0dWFsQ29udGVudFJlY3QpKS5pc0VtcHR5KCkpIHsKKyAgICAgIHBvcHVwLnN0
eWxlLnZpc2liaWxpdHkgPSAiaGlkZGVuIjsKKyAgICAgIHJldHVybjsKKyAgICB9CisKKyAgICAv
LyBBZGRpbmcgcmVjdC5oZWlnaHQgdG8gdGhlIHRvcCBtb3ZlcyB0aGUgYXJyb3dib3ggYmVsb3cg
dGhlIHZpcnR1YWwgZmllbGQKKyAgICBsZXQgbGVmdCA9IHJlY3QubGVmdCAtIHNjcm9sbC54ICsg
bGVmdE9mZnNldCAtIHJpZ2h0T2Zmc2V0OworICAgIGxldCB0b3AgPSByZWN0LnRvcCAtIHNjcm9s
bC55ICsgdG9wT2Zmc2V0ICsgKHJlY3QuaGVpZ2h0KTsKKworICAgIC8vIEVuc3VyZSBwYXJ0cyBv
ZiB0aGUgYXJyb3dib3ggYXJlIG5vdCBvdXRzaWRlIHRoZSB3aW5kb3cKKyAgICBsZXQgYXJyb3di
b3hSZWN0ID0gUmVjdC5mcm9tUmVjdChwb3B1cC5nZXRCb3VuZGluZ0NsaWVudFJlY3QoKSk7Cisg
ICAgaWYgKGxlZnQgKyBhcnJvd2JveFJlY3Qud2lkdGggPiB3aW5kb3cuaW5uZXJXaWR0aCkKKyAg
ICAgIGxlZnQgLT0gKGxlZnQgKyBhcnJvd2JveFJlY3Qud2lkdGggLSB3aW5kb3cuaW5uZXJXaWR0
aCk7CisgICAgZWxzZSBpZiAobGVmdCA8IGxlZnRPZmZzZXQpCisgICAgICBsZWZ0ICs9IChsZWZ0
T2Zmc2V0IC0gbGVmdCk7CisgICAgcG9wdXAubGVmdCA9IGxlZnQ7CisKKyAgICAvLyBEbyBub3Qg
cG9zaXRpb24gdGhlIHN1Z2dlc3Rpb25zIG92ZXIgdGhlIG5hdmlnYXRpb24gYnV0dG9ucworICAg
IGxldCBidXR0b25zSGVpZ2h0ID0gRWxlbWVudHMuY29udGVudE5hdmlnYXRvci5nZXRCb3VuZGlu
Z0NsaWVudFJlY3QoKS5oZWlnaHQ7CisgICAgaWYgKHRvcCArIGFycm93Ym94UmVjdC5oZWlnaHQg
Pj0gd2luZG93LmlubmVySGVpZ2h0IC0gYnV0dG9uc0hlaWdodCkKKyAgICAgIHRvcCAtPSAocmVj
dC5oZWlnaHQgKyBhcnJvd2JveFJlY3QuaGVpZ2h0KTsKKyAgICBwb3B1cC50b3AgPSB0b3A7CisK
KyAgICAvLyBDcmVhdGUgYSB2aXJ0dWFsIGVsZW1lbnQgdG8gcG9pbnQgdG8KKyAgICBsZXQgdmly
dHVhbENvbnRlbnRFbGVtZW50ID0geworICAgICAgZ2V0Qm91bmRpbmdDbGllbnRSZWN0OiBmdW5j
dGlvbigpIHsKKyAgICAgICAgcmV0dXJuIHZpcnR1YWxDb250ZW50UmVjdDsKKyAgICAgIH0KKyAg
ICB9OworICAgIHBvcHVwLmFuY2hvclRvKHZpcnR1YWxDb250ZW50RWxlbWVudCk7CisgICAgcG9w
dXAuc3R5bGUudmlzaWJpbGl0eSA9ICJ2aXNpYmxlIjsKKworICAgIGxldCBldmVudCA9IGRvY3Vt
ZW50LmNyZWF0ZUV2ZW50KCJFdmVudHMiKTsKKyAgICBldmVudC5pbml0RXZlbnQoImNvbnRlbnRw
b3B1cHNob3duIiwgdHJ1ZSwgZmFsc2UpOworICAgIHBvcHVwLmRpc3BhdGNoRXZlbnQoZXZlbnQp
OworICB9LAorCisgIGhhbmRsZUV2ZW50OiBmdW5jdGlvbihhRXZlbnQpIHsKKyAgICBsZXQgcG9w
dXAgPSB0aGlzLl9wb3B1cDsKKyAgICBpZiAoIXBvcHVwIHx8ICF0aGlzLl9hbmNob3JSZWN0KQor
ICAgICAgcmV0dXJuOworCisgICAgc3dpdGNoKGFFdmVudC50eXBlKSB7CisgICAgICBjYXNlICJU
YWJTZWxlY3QiOgorICAgICAgY2FzZSAiVGFiQ2xvc2UiOgorICAgICAgICB0aGlzLnBvcHVwID0g
bnVsbDsKKyAgICAgICAgYnJlYWs7CisKKyAgICAgIGNhc2UgIlBhbkJlZ2luIjoKKyAgICAgIGNh
c2UgIkFuaW1hdGVkWm9vbUJlZ2luIjoKKyAgICAgICAgcG9wdXAubGVmdCA9IDA7CisgICAgICAg
IHBvcHVwLnN0eWxlLnZpc2liaWxpdHkgPSAiaGlkZGVuIjsKKyAgICAgICAgYnJlYWs7CisKKyAg
ICAgIGNhc2UgIlBhbkZpbmlzaGVkIjoKKyAgICAgIGNhc2UgIkFuaW1hdGVkWm9vbUVuZCI6Cisg
ICAgICAgIHBvcHVwLnN0eWxlLnZpc2liaWxpdHkgPSAidmlzaWJsZSI7CisgICAgICAgIHRoaXMu
YW5jaG9yVG8oKTsKKyAgICAgICAgYnJlYWs7CisKKyAgICAgIGNhc2UgIk1vekJlZm9yZVJlc2l6
ZSI6CisgICAgICAgIHBvcHVwLmxlZnQgPSAwOworICAgICAgICBicmVhazsKKworICAgICAgY2Fz
ZSAicmVzaXplIjoKKyAgICAgICAgdGhpcy5hbmNob3JUbygpOworICAgICAgICBicmVhazsKKyAg
ICB9CisgIH0KK307CisKZGlmZiAtLWdpdCBhL21vYmlsZS9jaHJvbWUvY29udGVudC9icm93c2Vy
LXNjcmlwdHMuanMgYi9tb2JpbGUvY2hyb21lL2NvbnRlbnQvYnJvd3Nlci1zY3JpcHRzLmpzCi0t
LSBhL21vYmlsZS9jaHJvbWUvY29udGVudC9icm93c2VyLXNjcmlwdHMuanMKKysrIGIvbW9iaWxl
L2Nocm9tZS9jb250ZW50L2Jyb3dzZXItc2NyaXB0cy5qcwpAQCAtOTgsMTYgKzk4LDE3IEBAIFhQ
Q09NVXRpbHMuZGVmaW5lTGF6eUdldHRlcih0aGlzLCAiQ29tbW8KICAgWyJDb25zb2xlVmlldyIs
ICJjaHJvbWU6Ly9icm93c2VyL2NvbnRlbnQvY29uc29sZS5qcyJdLAogICBbIkRvd25sb2Fkc1Zp
ZXciLCAiY2hyb21lOi8vYnJvd3Nlci9jb250ZW50L2Rvd25sb2Fkcy5qcyJdLAogICBbIkV4dGVu
c2lvbnNWaWV3IiwgImNocm9tZTovL2Jyb3dzZXIvY29udGVudC9leHRlbnNpb25zLmpzIl0sCiAg
IFsiTWVudUxpc3RIZWxwZXJVSSIsICJjaHJvbWU6Ly9icm93c2VyL2NvbnRlbnQvTWVudUxpc3RI
ZWxwZXJVSS5qcyJdLAogICBbIk9mZmxpbmVBcHBzIiwgImNocm9tZTovL2Jyb3dzZXIvY29udGVu
dC9PZmZsaW5lQXBwcy5qcyJdLAogICBbIlByZWZlcmVuY2VzVmlldyIsICJjaHJvbWU6Ly9icm93
c2VyL2NvbnRlbnQvcHJlZmVyZW5jZXMuanMiXSwKICAgWyJTYW5pdGl6ZXIiLCAiY2hyb21lOi8v
YnJvd3Nlci9jb250ZW50L3Nhbml0aXplLmpzIl0sCiAgIFsiU2VsZWN0SGVscGVyVUkiLCAiY2hy
b21lOi8vYnJvd3Nlci9jb250ZW50L1NlbGVjdEhlbHBlclVJLmpzIl0sCisgIFsiQ29udGVudFBv
cHVwSGVscGVyIiwgImNocm9tZTovL2Jyb3dzZXIvY29udGVudC9Db250ZW50UG9wdXBIZWxwZXIu
anMiXSwKICAgWyJTaGFyaW5nVUkiLCAiY2hyb21lOi8vYnJvd3Nlci9jb250ZW50L1NoYXJpbmdV
SS5qcyJdLAogI2lmZGVmIE1PWl9TRVJWSUNFU19TWU5DCiAgIFsiV2VhdmVHbHVlIiwgImNocm9t
ZTovL2Jyb3dzZXIvY29udGVudC9zeW5jLmpzIl0sCiAjZW5kaWYKICAgWyJTU0xFeGNlcHRpb25z
IiwgImNocm9tZTovL2Jyb3dzZXIvY29udGVudC9leGNlcHRpb25zLmpzIl0KIF0uZm9yRWFjaChm
dW5jdGlvbiAoYVNjcmlwdCkgewogICBsZXQgW25hbWUsIHNjcmlwdF0gPSBhU2NyaXB0OwogICBY
UENPTVV0aWxzLmRlZmluZUxhenlHZXR0ZXIod2luZG93LCBuYW1lLCBmdW5jdGlvbigpIHsKZGlm
ZiAtLWdpdCBhL21vYmlsZS9jaHJvbWUvY29udGVudC9jb21tb24tdWkuanMgYi9tb2JpbGUvY2hy
b21lL2NvbnRlbnQvY29tbW9uLXVpLmpzCi0tLSBhL21vYmlsZS9jaHJvbWUvY29udGVudC9jb21t
b24tdWkuanMKKysrIGIvbW9iaWxlL2Nocm9tZS9jb250ZW50L2NvbW1vbi11aS5qcwpAQCAtNTk0
LDE3ICs1OTQsMTYgQEAgdmFyIEZvcm1IZWxwZXJVSSA9IHsKICAgfSwKIAogICBnZXQgZW5hYmxl
ZCgpIHsKICAgICByZXR1cm4gU2VydmljZXMucHJlZnMuZ2V0Qm9vbFByZWYoImZvcm1oZWxwZXIu
ZW5hYmxlZCIpOwogICB9LAogCiAgIGluaXQ6IGZ1bmN0aW9uIGZvcm1IZWxwZXJJbml0KCkgewog
ICAgIHRoaXMuX2NvbnRhaW5lciA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJjb250ZW50LW5h
dmlnYXRvciIpOwotICAgIHRoaXMuX3N1Z2dlc3Rpb25zQ29udGFpbmVyID0gZG9jdW1lbnQuZ2V0
RWxlbWVudEJ5SWQoImZvcm0taGVscGVyLXN1Z2dlc3Rpb25zLWNvbnRhaW5lciIpOwogICAgIHRo
aXMuX2NtZFByZXZpb3VzID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQodGhpcy5jb21tYW5kcy5w
cmV2aW91cyk7CiAgICAgdGhpcy5fY21kTmV4dCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKHRo
aXMuY29tbWFuZHMubmV4dCk7CiAKICAgICAvLyBMaXN0ZW4gZm9yIGZvcm0gYXNzaXN0YW50IG1l
c3NhZ2VzIGZyb20gY29udGVudAogICAgIG1lc3NhZ2VNYW5hZ2VyLmFkZE1lc3NhZ2VMaXN0ZW5l
cigiRm9ybUFzc2lzdDpTaG93IiwgdGhpcyk7CiAgICAgbWVzc2FnZU1hbmFnZXIuYWRkTWVzc2Fn
ZUxpc3RlbmVyKCJGb3JtQXNzaXN0OkhpZGUiLCB0aGlzKTsKICAgICBtZXNzYWdlTWFuYWdlci5h
ZGRNZXNzYWdlTGlzdGVuZXIoIkZvcm1Bc3Npc3Q6VXBkYXRlIiwgdGhpcyk7CiAgICAgbWVzc2Fn
ZU1hbmFnZXIuYWRkTWVzc2FnZUxpc3RlbmVyKCJGb3JtQXNzaXN0OlJlc2l6ZSIsIHRoaXMpOwpA
QCAtNjIxLDIzICs2MjAsMTkgQEAgdmFyIEZvcm1IZWxwZXJVSSA9IHsKICAgICBtZXNzYWdlTWFu
YWdlci5hZGRNZXNzYWdlTGlzdGVuZXIoIkRPTVdpbGxPcGVuTW9kYWxEaWFsb2ciLCB0aGlzKTsK
ICAgICBtZXNzYWdlTWFuYWdlci5hZGRNZXNzYWdlTGlzdGVuZXIoIkRPTU1vZGFsRGlhbG9nQ2xv
c2VkIiwgdGhpcyk7CiAKICAgICAvLyBMaXN0ZW4ga2V5IGV2ZW50cyBmb3IgZmllbGRzIHRoYXQg
YXJlIG5vbi1lZGl0YWJsZQogICAgIHdpbmRvdy5hZGRFdmVudExpc3RlbmVyKCJrZXlkb3duIiwg
dGhpcywgdHJ1ZSk7CiAgICAgd2luZG93LmFkZEV2ZW50TGlzdGVuZXIoImtleXVwIiwgdGhpcywg
dHJ1ZSk7CiAgICAgd2luZG93LmFkZEV2ZW50TGlzdGVuZXIoImtleXByZXNzIiwgdGhpcywgdHJ1
ZSk7CiAKLSAgICAvLyBMaXN0ZW4gc29tZSBldmVudHMgdG8gc2hvdy9oaWRlIHRoZSBhdXRvY29t
cGxldGUgYm94CisgICAgLy8gTGlzdGVuIHNvbWUgZXZlbnRzIHRvIHNob3cvaGlkZSBhcnJvd3MK
ICAgICBFbGVtZW50cy5icm93c2Vycy5hZGRFdmVudExpc3RlbmVyKCJQYW5CZWdpbiIsIHRoaXMs
IGZhbHNlKTsKICAgICBFbGVtZW50cy5icm93c2Vycy5hZGRFdmVudExpc3RlbmVyKCJQYW5GaW5p
c2hlZCIsIHRoaXMsIGZhbHNlKTsKLSAgICB3aW5kb3cuYWRkRXZlbnRMaXN0ZW5lcigiQW5pbWF0
ZWRab29tQmVnaW4iLCB0aGlzLCBmYWxzZSk7Ci0gICAgd2luZG93LmFkZEV2ZW50TGlzdGVuZXIo
IkFuaW1hdGVkWm9vbUVuZCIsIHRoaXMsIGZhbHNlKTsKLSAgICB3aW5kb3cuYWRkRXZlbnRMaXN0
ZW5lcigiTW96QmVmb3JlUmVzaXplIiwgdGhpcywgdHJ1ZSk7Ci0gICAgd2luZG93LmFkZEV2ZW50
TGlzdGVuZXIoInJlc2l6ZSIsIHRoaXMsIGZhbHNlKTsKICAgfSwKIAogICBfY3VycmVudEJyb3dz
ZXI6IG51bGwsCiAgIHNob3c6IGZ1bmN0aW9uIGZvcm1IZWxwZXJTaG93KGFFbGVtZW50LCBhSGFz
UHJldmlvdXMsIGFIYXNOZXh0KSB7CiAgICAgdGhpcy5fY3VycmVudEJyb3dzZXIgPSBCcm93c2Vy
LnNlbGVjdGVkQnJvd3NlcjsKICAgICB0aGlzLl9jdXJyZW50Q2FyZXRSZWN0ID0gbnVsbDsKIAog
ICAgIC8vIFVwZGF0ZSB0aGUgbmV4dC9wcmV2aW91cyBjb21tYW5kcwpAQCAtNjQ1LDE3ICs2NDAs
MTYgQEAgdmFyIEZvcm1IZWxwZXJVSSA9IHsKICAgICB0aGlzLl9jbWROZXh0LnNldEF0dHJpYnV0
ZSgiZGlzYWJsZWQiLCAhYUhhc05leHQpOwogCiAgICAgLy8gSWYgYm90aCBuZXh0IGFuZCBwcmV2
aW91cyBhcmUgZGlzYWJsZWQgZG9uJ3QgYm90aGVyIHNob3dpbmcgYXJyb3dzCiAgICAgaWYgKCFh
SGFzTmV4dCAmJiAhYUhhc1ByZXZpb3VzKQogICAgICAgdGhpcy5fY29udGFpbmVyLnNldEF0dHJp
YnV0ZSgiZGlzYWJsZWQiLCAidHJ1ZSIpOwogICAgIGVsc2UKICAgICAgIHRoaXMuX2NvbnRhaW5l
ci5yZW1vdmVBdHRyaWJ1dGUoImRpc2FibGVkIik7CiAKLSAgICB0aGlzLl9oYXNTdWdnZXN0aW9u
cyA9IGZhbHNlOwogICAgIHRoaXMuX29wZW4gPSB0cnVlOwogCiAgICAgbGV0IGxhc3RFbGVtZW50
ID0gdGhpcy5fY3VycmVudEVsZW1lbnQgfHwgbnVsbDsKICAgICB0aGlzLl9jdXJyZW50RWxlbWVu
dCA9IHsKICAgICAgIGlkOiBhRWxlbWVudC5pZCwKICAgICAgIG5hbWU6IGFFbGVtZW50Lm5hbWUs
CiAgICAgICB0aXRsZTogYUVsZW1lbnQudGl0bGUsCiAgICAgICB2YWx1ZTogYUVsZW1lbnQudmFs
dWUsCkBAIC02NjMsMTcgKzY1NywxNiBAQCB2YXIgRm9ybUhlbHBlclVJID0gewogICAgICAgdHlw
ZTogYUVsZW1lbnQudHlwZSwKICAgICAgIGNob2ljZXM6IGFFbGVtZW50LmNob2ljZXMsCiAgICAg
ICBpc0F1dG9jb21wbGV0ZTogYUVsZW1lbnQuaXNBdXRvY29tcGxldGUsCiAgICAgICBsaXN0OiBh
RWxlbWVudC5saXN0LAogICAgIH0KIAogICAgIHRoaXMuX3VwZGF0ZUNvbnRhaW5lckZvclNlbGVj
dChsYXN0RWxlbWVudCwgdGhpcy5fY3VycmVudEVsZW1lbnQpOwogICAgIHRoaXMuX3pvb20oUmVj
dC5mcm9tUmVjdChhRWxlbWVudC5yZWN0KSwgUmVjdC5mcm9tUmVjdChhRWxlbWVudC5jYXJldFJl
Y3QpKTsKLSAgICB0aGlzLl91cGRhdGVTdWdnZXN0aW9uc0Zvcih0aGlzLl9jdXJyZW50RWxlbWVu
dCk7CiAKICAgICAvLyBQcmV2ZW50IHRoZSB2aWV3IHRvIHNjcm9sbCBhdXRvbWF0aWNhbGx5IHdo
aWxlIHR5cGluZwogICAgIHRoaXMuX2N1cnJlbnRCcm93c2VyLnNjcm9sbFN5bmMgPSBmYWxzZTsK
ICAgfSwKIAogICBoaWRlOiBmdW5jdGlvbiBmb3JtSGVscGVySGlkZSgpIHsKICAgICBpZiAoIXRo
aXMuX29wZW4pCiAgICAgICByZXR1cm47CkBAIC02ODEsMTcgKzY3NCwxNiBAQCB2YXIgRm9ybUhl
bHBlclVJID0gewogICAgIC8vIFJlc3RvcmUgdGhlIHNjcm9sbCBzeW5jaG9uaXNhdGlvbgogICAg
IHRoaXMuX2N1cnJlbnRCcm93c2VyLnNjcm9sbFN5bmMgPSB0cnVlOwogCiAgICAgLy8gcmVzZXQg
Y3VycmVudCBFbGVtZW50IGFuZCBDYXJldCBSZWN0CiAgICAgdGhpcy5fY3VycmVudEVsZW1lbnRS
ZWN0ID0gbnVsbDsKICAgICB0aGlzLl9jdXJyZW50Q2FyZXRSZWN0ID0gbnVsbDsKIAogICAgIHRo
aXMuX3VwZGF0ZUNvbnRhaW5lckZvclNlbGVjdCh0aGlzLl9jdXJyZW50RWxlbWVudCwgbnVsbCk7
Ci0gICAgdGhpcy5fcmVzZXRTdWdnZXN0aW9ucygpOwogCiAgICAgdGhpcy5fY3VycmVudEJyb3dz
ZXIubWVzc2FnZU1hbmFnZXIuc2VuZEFzeW5jTWVzc2FnZSgiRm9ybUFzc2lzdDpDbG9zZWQiLCB7
IH0pOwogICAgIHRoaXMuX29wZW4gPSBmYWxzZTsKICAgfSwKIAogICAvLyBmb3IgVktCIHRoYXQg
ZG9lcyBub3QgcmVzaXplIHRoZSB3aW5kb3cKICAgX2N1cnJlbnRDYXJldFJlY3Q6IG51bGwsCiAg
IF9jdXJyZW50RWxlbWVudFJlY3Q6IG51bGwsCkBAIC03MDYsMzggKzY5OCwyMSBAQCB2YXIgRm9y
bUhlbHBlclVJID0gewogICAgICAgICBicmVhazsKIAogICAgICAgY2FzZSAiUGFuQmVnaW4iOgog
ICAgICAgICAvLyBUaGUgcHJldmlvdXMvbmV4dCBidXR0b25zIHNob3VsZCBiZSBoaWRkZW4gZHVy
aW5nIGEgbWFudWFsIHBhbm5pbmcKICAgICAgICAgLy8gb3BlcmF0aW9uIGJ1dCBub3QgZG9pbmcg
YSB6b29tIG9wZXJhdGlvbiBzaW5jZSB0aGlzIGhhcHBlbiBvbiBib3RoCiAgICAgICAgIC8vIG1h
bnVhbCBkYmxDbGljayBhbmQgbmF2aWdhdGlvbiBiZXR3ZWVuIHRoZSBmaWVsZHMgYnkgY2xpY2tp
bmcgdGhlCiAgICAgICAgIC8vIGJ1dHRvbnMKICAgICAgICAgdGhpcy5fY29udGFpbmVyLnN0eWxl
LnZpc2liaWxpdHkgPSAiaGlkZGVuIjsKKyAgICAgICAgYnJlYWs7CiAKLSAgICAgIGNhc2UgIkFu
aW1hdGVkWm9vbUJlZ2luIjoKLSAgICAgICAgLy8gQ2hhbmdpbmcgdGhlIGhpZGRlbiBhdHRyaWJ1
dGUgaGVyZSBjcmVhdGUgYnVncyB3aXRoIHRoZSBzY3JvbGxib3gKLSAgICAgICAgLy8gYXJyb3dz
IGJlY2F1c2UgdGhlIGJpbmRpbmcgd2lsbCBtaXNzIHNvbWUgdW5kZXJmbG93IGV2ZW50cwotICAg
ICAgICBpZiAodGhpcy5faGFzU3VnZ2VzdGlvbnMpIHsKLSAgICAgICAgICAvLyBCZWNhdXNlIHRo
ZSBzdWdnZXN0aW9ucyBjb250YWluZXIgY291bGQgYmUgYmlnIGluIHRlcm1zIG9mIHdpZHRoCi0g
ICAgICAgICAgLy8gKGJ1dCBuZXZlciBiaWdnZXIgdGhhbiB0aGUgc2NyZWVuKSBpdCdzIHBvc2l0
aW9uIG5lZWRzIHRvIGJlCi0gICAgICAgICAgLy8gcmVzZXR0ZWQgdG8gdGhlIGxlZnQgdG8gZW5z
dXJlIGl0IGRvZXMgbm90IHB1c2ggdGhlIGNvbnRlbnQgdG8KLSAgICAgICAgICAvLyB0aGUgcmln
aHQgYW5kIG1pc3BsYWNlZCBzaWRlYmFycyBhcyBhIHJlc3VsdAotICAgICAgICAgIHRoaXMuX3N1
Z2dlc3Rpb25zQ29udGFpbmVyLmxlZnQgPSAwOwotICAgICAgICAgIHRoaXMuX3N1Z2dlc3Rpb25z
Q29udGFpbmVyLnN0eWxlLnZpc2liaWxpdHkgPSAiaGlkZGVuIjsKLSAgICAgICAgfQotICAgICAg
ICBicmVhazsKIAogICAgICAgY2FzZSAiUGFuRmluaXNoZWQiOgogICAgICAgICB0aGlzLl9jb250
YWluZXIuc3R5bGUudmlzaWJpbGl0eSA9ICJ2aXNpYmxlIjsKLQotICAgICAgY2FzZSAiQW5pbWF0
ZWRab29tRW5kIjoKLSAgICAgICAgaWYgKHRoaXMuX2hhc1N1Z2dlc3Rpb25zKSB7Ci0gICAgICAg
ICAgdGhpcy5fc3VnZ2VzdGlvbnNDb250YWluZXIuc3R5bGUudmlzaWJpbGl0eSA9ICJ2aXNpYmxl
IjsKLSAgICAgICAgICB0aGlzLl9lbnN1cmVTdWdnZXN0aW9uc1Zpc2libGUoKTsKLSAgICAgICAg
fQogICAgICAgICBicmVhazsKIAogICAgICAgY2FzZSAiVVJMQ2hhbmdlZCI6CiAgICAgICAgIGlm
IChhRXZlbnQuZGV0YWlsICYmIGFFdmVudC50YXJnZXQgPT0gZ2V0QnJvd3NlcigpKQogICAgICAg
ICAgIHRoaXMuaGlkZSgpOwogICAgICAgICBicmVhazsKIAogICAgICAgY2FzZSAia2V5ZG93biI6
CkBAIC03NjEsMjYgKzczNiwxNiBAQCB2YXIgRm9ybUhlbHBlclVJID0gewogICAgICAgICBicmVh
azsKIAogICAgICAgY2FzZSAiU2l6ZUNoYW5nZWQiOgogICAgICAgICBzZXRUaW1lb3V0KGZ1bmN0
aW9uKHNlbGYpIHsKICAgICAgICAgICBTZWxlY3RIZWxwZXJVSS5zaXplVG9Db250ZW50KCk7CiAg
ICAgICAgICAgc2VsZi5fem9vbShzZWxmLl9jdXJyZW50RWxlbWVudFJlY3QsIHNlbGYuX2N1cnJl
bnRDYXJldFJlY3QpOwogICAgICAgICB9LCAwLCB0aGlzKTsKICAgICAgICAgYnJlYWs7Ci0KLSAg
ICAgIGNhc2UgIk1vekJlZm9yZVJlc2l6ZSI6Ci0gICAgICAgIGlmICh0aGlzLl9oYXNTdWdnZXN0
aW9ucykKLSAgICAgICAgICB0aGlzLl9zdWdnZXN0aW9uc0NvbnRhaW5lci5sZWZ0ID0gMDsKLSAg
ICAgICAgYnJlYWs7Ci0KLSAgICAgIGNhc2UgInJlc2l6ZSI6Ci0gICAgICAgIGlmICh0aGlzLl9o
YXNTdWdnZXN0aW9ucykKLSAgICAgICAgICB0aGlzLl9lbnN1cmVTdWdnZXN0aW9uc1Zpc2libGUo
KTsKLSAgICAgICAgYnJlYWs7CiAgICAgfQogICB9LAogCiAgIHJlY2VpdmVNZXNzYWdlOiBmdW5j
dGlvbiBmb3JtSGVscGVyUmVjZWl2ZU1lc3NhZ2UoYU1lc3NhZ2UpIHsKICAgICBpZiAoIXRoaXMu
X29wZW4gJiYgYU1lc3NhZ2UubmFtZSAhPSAiRm9ybUFzc2lzdDpTaG93IiAmJiBhTWVzc2FnZS5u
YW1lICE9ICJGb3JtQXNzaXN0OkhpZGUiKQogICAgICAgcmV0dXJuOwogCiAgICAgbGV0IGpzb24g
PSBhTWVzc2FnZS5qc29uOwpAQCAtODUxLDc0ICs4MTYsNjUgQEAgdmFyIEZvcm1IZWxwZXJVSSA9
IHsKICAgICBpZiAoYVZhbCkgewogICAgICAgdGhpcy5fem9vbVN0YXJ0KCk7CiAgICAgICB0aGlz
Ll9jb250YWluZXIuc2hvdyh0aGlzKTsKICAgICB9IGVsc2UgewogICAgICAgdGhpcy5fem9vbUZp
bmlzaCgpOwogICAgICAgdGhpcy5fY3VycmVudEVsZW1lbnQgPSBudWxsOwogICAgICAgdGhpcy5f
Y29udGFpbmVyLmhpZGUodGhpcyk7CiAKKyAgICAgIENvbnRlbnRQb3B1cEhlbHBlci5wb3B1cCA9
IG51bGw7CiAgICAgICB0aGlzLl9jb250YWluZXIucmVtb3ZlQXR0cmlidXRlKCJkaXNhYmxlZCIp
OwogCiAgICAgICAvLyBTaW5jZSB0aGUgc3R5bGUgaXMgb3ZlcnJpZGVkIHdoZW4gYSBwb3B1cCBp
cyBzaG93biwgaXQgbmVlZHMgdG8gYmUKICAgICAgIC8vIHJlc2V0dGVkIGhlcmUgdG8gbGV0IHRo
ZSBkZWZhdWx0IENTUyB3b3JrcwogICAgICAgdGhpcy5fY29udGFpbmVyLnN0eWxlLmRpc3BsYXkg
PSAiIjsKICAgICB9CiAKICAgICBsZXQgZXZ0ID0gZG9jdW1lbnQuY3JlYXRlRXZlbnQoIlVJRXZl
bnRzIik7CiAgICAgZXZ0LmluaXRVSUV2ZW50KCJGb3JtVUkiLCB0cnVlLCB0cnVlLCB3aW5kb3cs
IGFWYWwpOwogICAgIHRoaXMuX2NvbnRhaW5lci5kaXNwYXRjaEV2ZW50KGV2dCk7CiAgIH0sCiAK
LSAgX2hhc1N1Z2dlc3Rpb25zOiBmYWxzZSwKICAgX3VwZGF0ZVN1Z2dlc3Rpb25zRm9yOiBmdW5j
dGlvbiBfZm9ybUhlbHBlclVwZGF0ZUF1dG9jb21wbGV0ZUZvcihhRWxlbWVudCkgewogICAgIGxl
dCBzdWdnZXN0aW9ucyA9IHRoaXMuX2dldEF1dG9jb21wbGV0ZVN1Z2dlc3Rpb25zKGFFbGVtZW50
KTsKICAgICBpZiAoIXN1Z2dlc3Rpb25zLmxlbmd0aCkgewotICAgICAgdGhpcy5fcmVzZXRTdWdn
ZXN0aW9ucygpOworICAgICAgQ29udGVudFBvcHVwSGVscGVyLnBvcHVwID0gbnVsbDsKICAgICAg
IHJldHVybjsKICAgICB9Ci0gICAgLy8gS2VlcHMgdGhlIHN1Z2dlc3Rpb25zIGVsZW1lbnQgaGlk
ZGVuIHdoaWxlIGlzIGl0IG5vdCBwb3NpdGlvbm5lZCB0byB0aGUKLSAgICAvLyBjb3JyZWN0IHBs
YWNlCi0gICAgbGV0IHN1Z2dlc3Rpb25zQ29udGFpbmVyID0gdGhpcy5fc3VnZ2VzdGlvbnNDb250
YWluZXI7Ci0gICAgc3VnZ2VzdGlvbnNDb250YWluZXIuc3R5bGUudmlzaWJpbGl0eSA9ICJoaWRk
ZW4iOwotICAgIHN1Z2dlc3Rpb25zQ29udGFpbmVyLmhpZGRlbiA9IGZhbHNlOwotICAgIHN1Z2dl
c3Rpb25zQ29udGFpbmVyLmxlZnQgPSAwOwogCiAgICAgLy8gdGhlIHNjcm9sbFgvc2Nyb2xsWSBw
b3NpdGlvbiBjYW4gY2hhbmdlIGJlY2F1c2Ugb2YgdGhlIGFuaW1hdGVkIHpvb20gc28KICAgICAv
LyBkZWxheSB0aGUgc3VnZ2VzdGlvbnMgcG9zaXRpb25pbmcKICAgICBpZiAoQW5pbWF0ZWRab29t
LmlzWm9vbWluZygpKSB7CiAgICAgICBsZXQgc2VsZiA9IHRoaXM7Ci0gICAgICB3aW5kb3cuYWRk
RXZlbnRMaXN0ZW5lcigiQW5pbWF0ZWRab29tRW5kIiwgZnVuY3Rpb24oKSB7Ci0gICAgICAgIHdp
bmRvdy5yZW1vdmVFdmVudExpc3RlbmVyKCJBbmltYXRlZFpvb21FbmQiLCBhcmd1bWVudHMuY2Fs
bGVlLCB0cnVlKTsKLSAgICAgICAgICAvLyBFbnN1cmUgdGhlIGN1cnJlbnQgZWxlbWVudCBoYXMg
bm90IGNoYW5nZWQgZHVyaW5nIHRoaXMgaW50ZXJ2YWwKLSAgICAgICAgICBpZiAoc2VsZi5fY3Vy
cmVudEVsZW1lbnQgIT0gYUVsZW1lbnQpCi0gICAgICAgICAgICByZXR1cm47Ci0KLSAgICAgICAg
ICBzZWxmLl91cGRhdGVTdWdnZXN0aW9uc0ZvcihhRWxlbWVudCk7Ci0gICAgICB9LCB0cnVlKTsK
KyAgICAgIHRoaXMuX3dhaXRGb3Jab29tKGZ1bmN0aW9uKCkgeworICAgICAgICBzZWxmLl91cGRh
dGVTdWdnZXN0aW9uc0ZvcihhRWxlbWVudCk7CisgICAgICB9KTsKICAgICAgIHJldHVybjsKICAg
ICB9CiAKKyAgICAvLyBEZWNsYXJlIHdoaWNoIGJveCBpcyBnb2luZyB0byBiZSB0aGUgaW5zaWRl
IGNvbnRhaW5lciBvZiB0aGUgY29udGVudCBwb3B1cCBoZWxwZXIKKyAgICBsZXQgc3VnZ2VzdGlv
bnNDb250YWluZXIgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgiZm9ybS1oZWxwZXItc3VnZ2Vz
dGlvbnMtY29udGFpbmVyIik7CiAgICAgbGV0IGNvbnRhaW5lciA9IHN1Z2dlc3Rpb25zQ29udGFp
bmVyLmZpcnN0Q2hpbGQ7CiAgICAgd2hpbGUgKGNvbnRhaW5lci5oYXNDaGlsZE5vZGVzKCkpCiAg
ICAgICBjb250YWluZXIucmVtb3ZlQ2hpbGQoY29udGFpbmVyLmxhc3RDaGlsZCk7CiAKICAgICBs
ZXQgZnJhZ21lbnQgPSBkb2N1bWVudC5jcmVhdGVEb2N1bWVudEZyYWdtZW50KCk7CiAgICAgZm9y
IChsZXQgaSA9IDA7IGkgPCBzdWdnZXN0aW9ucy5sZW5ndGg7IGkrKykgewogICAgICAgbGV0IHN1
Z2dlc3Rpb24gPSBzdWdnZXN0aW9uc1tpXTsKICAgICAgIGxldCBidXR0b24gPSBkb2N1bWVudC5j
cmVhdGVFbGVtZW50KCJsYWJlbCIpOwogICAgICAgYnV0dG9uLnNldEF0dHJpYnV0ZSgidmFsdWUi
LCBzdWdnZXN0aW9uLmxhYmVsKTsKICAgICAgIGJ1dHRvbi5zZXRBdHRyaWJ1dGUoImRhdGEiLCBz
dWdnZXN0aW9uLnZhbHVlKTsKICAgICAgIGJ1dHRvbi5jbGFzc05hbWUgPSAiZm9ybS1oZWxwZXIt
c3VnZ2VzdGlvbnMtbGFiZWwiOwogICAgICAgZnJhZ21lbnQuYXBwZW5kQ2hpbGQoYnV0dG9uKTsK
ICAgICB9CiAgICAgY29udGFpbmVyLmFwcGVuZENoaWxkKGZyYWdtZW50KTsKIAotICAgIHRoaXMu
X2hhc1N1Z2dlc3Rpb25zID0gdHJ1ZTsKLSAgICB0aGlzLl9lbnN1cmVTdWdnZXN0aW9uc1Zpc2li
bGUoKTsKKyAgICBDb250ZW50UG9wdXBIZWxwZXIucG9wdXAgPSBzdWdnZXN0aW9uc0NvbnRhaW5l
cjsKKyAgICBDb250ZW50UG9wdXBIZWxwZXIuYW5jaG9yVG8odGhpcy5fY3VycmVudEVsZW1lbnRS
ZWN0KTsKICAgfSwKIAogICAvKiogUmV0cmlldmUgdGhlIGF1dG9jb21wbGV0ZSBsaXN0IGZyb20g
dGhlIGF1dG9jb21wbGV0ZSBzZXJ2aWNlIGZvciBhbiBlbGVtZW50ICovCiAgIF9nZXRBdXRvY29t
cGxldGVTdWdnZXN0aW9uczogZnVuY3Rpb24gX2Zvcm1IZWxwZXJHZXRBdXRvY29tcGxldGVTdWdn
ZXN0aW9ucyhhRWxlbWVudCkgewogICAgIGlmICghYUVsZW1lbnQuaXNBdXRvY29tcGxldGUpCiAg
ICAgICByZXR1cm4gW107CiAKICAgICBsZXQgc3VnZ2VzdGlvbnMgPSBbXTsKQEAgLTk0MSwxMTgg
Kzg5NywxNiBAQCB2YXIgRm9ybUhlbHBlclVJID0gewogICAgIC8vIGRpc3BsYXllZCB2YWx1ZSBj
YW4gZGlmZmVyIGZyb20gdGhlIHJlYWwgdmFsdWUgb2YgdGhlIGVsZW1lbnQuCiAgICAgbGV0IG9w
dGlvbnMgPSBhRWxlbWVudC5saXN0OwogICAgIGZvciAobGV0IGkgPSAwOyBpIDwgb3B0aW9ucy5s
ZW5ndGg7IGkrKykKICAgICAgIHN1Z2dlc3Rpb25zLnB1c2gob3B0aW9uc1tpXSk7CiAKICAgICBy
ZXR1cm4gc3VnZ2VzdGlvbnM7CiAgIH0sCiAKLSAgX3Jlc2V0U3VnZ2VzdGlvbnM6IGZ1bmN0aW9u
IF9mb3JtSGVscGVyUmVzZXRBdXRvY29tcGxldGUoKSB7Ci0gICAgdGhpcy5fc3VnZ2VzdGlvbnND
b250YWluZXIuaGlkZGVuID0gdHJ1ZTsKLSAgICB0aGlzLl9oYXNTdWdnZXN0aW9ucyA9IGZhbHNl
OwotICB9LAotCi0gIC8qKgotICAgKiBUaGlzIG1ldGhvZCBwb3NpdGlvbm5lZCB0aGUgbGlzdCBv
ZiBzdWdnZXN0aW9ucyBvbiB0aGUgc2NyZWVuIHVzaW5nCi0gICAqIGEgJ3ZpcnR1YWwnIGVsZW1l
bnQgYXMgcmVmZXJyZXIgdGhhdCBtYXRjaCB0aGUgcmVhbCBjb250ZW50IGVsZW1lbnQKLSAgICog
VGhpcyBtZXRob2QgY2FsbGVkIGVsZW1lbnQuZ2V0Qm91bmRpbmdDbGllbnRSZWN0KCkgbWFueSB0
aW1lcyBhbmQgY2FuIGJlCi0gICAqIGV4cGVuc2l2ZSwgZG8gbm90IGNhbGxlZCBpdCB0b28gbWFu
eSB0aW1lcy4KLSAgICovCi0gIF9lbnN1cmVTdWdnZXN0aW9uc1Zpc2libGU6IGZ1bmN0aW9uIF9m
b3JtSGVscGVyRW5zdXJlU3VnZ2VzdGlvbnNWaXNpYmxlKCkgewotICAgIGxldCBjb250YWluZXIg
PSB0aGlzLl9zdWdnZXN0aW9uc0NvbnRhaW5lcjsKLQotICAgIC8vIENhbGN1bGF0ZSB0aGUgbWF4
aW11bSBzaXplIG9mIHRoZSBhcnJvd3BhbmVsIGJ5IGFsbG93aW5nIGl0IHRvIGxpdmUgb25seQot
ICAgIC8vIG9uIHRoZSB2aXNpYmxlIGJyb3dzZXIgYXJlYQotICAgIGxldCBbbGVmdFZpcywgcmln
aHRWaXMsIGxlZnRXLCByaWdodFddID0gQnJvd3Nlci5jb21wdXRlU2lkZWJhclZpc2liaWxpdHko
KTsKLSAgICBsZXQgbGVmdE9mZnNldCA9IGxlZnRWaXMgKiBsZWZ0VzsKLSAgICBsZXQgcmlnaHRP
ZmZzZXQgPSByaWdodFZpcyAqIHJpZ2h0VzsKLSAgICBsZXQgdmlzaWJsZUFyZWFXaWR0aCA9IHdp
bmRvdy5pbm5lcldpZHRoIC0gbGVmdE9mZnNldCAtIHJpZ2h0T2Zmc2V0OwotICAgIGNvbnRhaW5l
ci5maXJzdENoaWxkLnN0eWxlLm1heFdpZHRoID0gKHZpc2libGVBcmVhV2lkdGggKiAwLjc1KSAr
ICJweCI7Ci0KLSAgICBsZXQgYnJvd3NlciA9IGdldEJyb3dzZXIoKTsKLSAgICBsZXQgcmVjdCA9
IHRoaXMuX2N1cnJlbnRFbGVtZW50UmVjdC5jbG9uZSgpLnNjYWxlKGJyb3dzZXIuc2NhbGUsIGJy
b3dzZXIuc2NhbGUpOwotICAgIGxldCBzY3JvbGwgPSBicm93c2VyLmdldFJvb3RWaWV3KCkuZ2V0
UG9zaXRpb24oKTsKLQotICAgIC8vIFRoZSBzaWRlYmFycyBzY3JvbGwgbmVlZHMgdG8gYmUgdGFr
ZW4gaW50byBhY2NvdW50LCBvdGhlcndpc2UgdGhlIGFycm93cwotICAgIC8vIGNhbiBiZSBtaXNw
bGFjZWQgaWYgdGhlIHNpZGViYXJzIGFyZSBvcGVuCi0gICAgbGV0IHRvcE9mZnNldCA9IChCcm93
c2VyVUkudG9vbGJhckggLSBCcm93c2VyLmdldFNjcm9sbGJveFBvc2l0aW9uKEJyb3dzZXIucGFn
ZVNjcm9sbGJveFNjcm9sbGVyKS55KTsKLSAgICBsZXQgdmlydHVhbENvbnRlbnRSZWN0ID0gewot
ICAgICAgd2lkdGg6IHJlY3Qud2lkdGgsCi0gICAgICBoZWlnaHQ6IHJlY3QuaGVpZ2h0LAotICAg
ICAgbGVmdDogTWF0aC5jZWlsKHJlY3QubGVmdCAtIHNjcm9sbC54ICsgbGVmdE9mZnNldCAtIHJp
Z2h0T2Zmc2V0KSwKLSAgICAgIHJpZ2h0OiBNYXRoLmZsb29yKHJlY3QubGVmdCArIHJlY3Qud2lk
dGggLSBzY3JvbGwueCArIGxlZnRPZmZzZXQgLSByaWdodE9mZnNldCksCi0gICAgICB0b3A6IE1h
dGguY2VpbChyZWN0LnRvcCAtIHNjcm9sbC55ICsgdG9wT2Zmc2V0KSwKLSAgICAgIGJvdHRvbTog
TWF0aC5mbG9vcihyZWN0LnRvcCArIHJlY3QuaGVpZ2h0IC0gc2Nyb2xsLnkgKyB0b3BPZmZzZXQp
Ci0gICAgfTsKLQotICAgIC8vIFRyYW5zbGF0ZSB0aGUgdmlydHVhbCByZWN0IGluc2lkZSB0aGUg
Ym91bmRzIG9mIHRoZSB2aWV3YWJsZSBhcmVhIGlmIGl0Ci0gICAgLy8gb3ZlcmZsb3cKLSAgICBp
ZiAodmlydHVhbENvbnRlbnRSZWN0LmxlZnQgKyB2aXJ0dWFsQ29udGVudFJlY3Qud2lkdGggPiB2
aXNpYmxlQXJlYVdpZHRoKSB7Ci0gICAgICBsZXQgb2Zmc2V0WCA9IHZpc2libGVBcmVhV2lkdGgg
LSAodmlydHVhbENvbnRlbnRSZWN0LmxlZnQgKyB2aXJ0dWFsQ29udGVudFJlY3Qud2lkdGgpOwot
ICAgICAgdmlydHVhbENvbnRlbnRSZWN0LndpZHRoICs9IG9mZnNldFg7Ci0gICAgICB2aXJ0dWFs
Q29udGVudFJlY3QucmlnaHQgLT0gb2Zmc2V0WDsKLSAgICB9Ci0KLSAgICBpZiAodmlydHVhbENv
bnRlbnRSZWN0LmxlZnQgPCBsZWZ0T2Zmc2V0KSB7Ci0gICAgICBsZXQgb2Zmc2V0WCA9ICh2aXJ0
dWFsQ29udGVudFJlY3QucmlnaHQgLSB2aXJ0dWFsQ29udGVudFJlY3Qud2lkdGgpOwotICAgICAg
dmlydHVhbENvbnRlbnRSZWN0LndpZHRoICs9IG9mZnNldFg7Ci0gICAgICB2aXJ0dWFsQ29udGVu
dFJlY3QubGVmdCAtPSBvZmZzZXRYOwotICAgIH0KLQotICAgIC8vIElmIHRoZSBzdWdnZXN0aW9u
cyBhcmUgb3V0IG9mIHZpZXcgdGhlcmUgaXMgbm8gbmVlZCB0byBkaXNwbGF5IGl0Ci0gICAgbGV0
IGJyb3dzZXJSZWN0ID0gUmVjdC5mcm9tUmVjdChicm93c2VyLmdldEJvdW5kaW5nQ2xpZW50UmVj
dCgpKTsKLSAgICBpZiAoQnJvd3NlclVJLmlzVG9vbGJhckxvY2tlZCgpKSB7Ci0gICAgICAvLyBJ
ZiB0aGUgdG9vbGJhciBpcyBsb2NrZWQsIGl0IGNhbiBhcHBlYXIgb3ZlciB0aGUgZmllbGQgaW4g
c3VjaCBhIHdheQotICAgICAgLy8gdGhhdCB0aGUgZmllbGQgaXMgaGlkZGVuCi0gICAgICBsZXQg
dG9vbGJhckggPSBCcm93c2VyVUkudG9vbGJhckg7Ci0gICAgICBicm93c2VyUmVjdCA9IG5ldyBS
ZWN0KGxlZnRPZmZzZXQgLSByaWdodE9mZnNldCwgTWF0aC5tYXgoMCwgYnJvd3NlclJlY3QudG9w
IC0gdG9vbGJhckgpICsgdG9vbGJhckgsCi0gICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJy
b3dzZXJSZWN0LndpZHRoICsgbGVmdE9mZnNldCAtIHJpZ2h0T2Zmc2V0LCBicm93c2VyUmVjdC5o
ZWlnaHQgLSB0b29sYmFySCk7Ci0gICAgfQotCi0gICAgaWYgKGJyb3dzZXJSZWN0LmludGVyc2Vj
dChSZWN0LmZyb21SZWN0KHZpcnR1YWxDb250ZW50UmVjdCkpLmlzRW1wdHkoKSkgewotICAgICAg
Y29udGFpbmVyLnN0eWxlLnZpc2liaWxpdHkgPSAiaGlkZGVuIjsKLSAgICAgIHJldHVybjsKLSAg
ICB9Ci0KLSAgICAvLyBBZGRpbmcgcmVjdC5oZWlnaHQgdG8gdGhlIHRvcCBtb3ZlcyB0aGUgYXJy
b3dib3ggYmVsb3cgdGhlIHZpcnR1YWwgZmllbGQKLSAgICBsZXQgbGVmdCA9IHJlY3QubGVmdCAt
IHNjcm9sbC54ICsgbGVmdE9mZnNldCAtIHJpZ2h0T2Zmc2V0OwotICAgIGxldCB0b3AgPSByZWN0
LnRvcCAtIHNjcm9sbC55ICsgdG9wT2Zmc2V0ICsgKHJlY3QuaGVpZ2h0KTsKLQotICAgIC8vIEVu
c3VyZSBwYXJ0cyBvZiB0aGUgYXJyb3dib3ggYXJlIG5vdCBvdXRzaWRlIHRoZSB3aW5kb3cKLSAg
ICBsZXQgYXJyb3dib3hSZWN0ID0gUmVjdC5mcm9tUmVjdChjb250YWluZXIuZ2V0Qm91bmRpbmdD
bGllbnRSZWN0KCkpOwotICAgIGlmIChsZWZ0ICsgYXJyb3dib3hSZWN0LndpZHRoID4gd2luZG93
LmlubmVyV2lkdGgpCi0gICAgICBsZWZ0IC09IChsZWZ0ICsgYXJyb3dib3hSZWN0LndpZHRoIC0g
d2luZG93LmlubmVyV2lkdGgpOwotICAgIGVsc2UgaWYgKGxlZnQgPCBsZWZ0T2Zmc2V0KQotICAg
ICAgbGVmdCArPSAobGVmdE9mZnNldCAtIGxlZnQpOwotICAgIGNvbnRhaW5lci5sZWZ0ID0gbGVm
dDsKLQotICAgIC8vIERvIG5vdCBwb3NpdGlvbiB0aGUgc3VnZ2VzdGlvbnMgb3ZlciB0aGUgbmF2
aWdhdGlvbiBidXR0b25zCi0gICAgbGV0IGJ1dHRvbnNIZWlnaHQgPSB0aGlzLl9jb250YWluZXIu
Z2V0Qm91bmRpbmdDbGllbnRSZWN0KCkuaGVpZ2h0OwotICAgIGlmICh0b3AgKyBhcnJvd2JveFJl
Y3QuaGVpZ2h0ID49IHdpbmRvdy5pbm5lckhlaWdodCAtIGJ1dHRvbnNIZWlnaHQpCi0gICAgICB0
b3AgLT0gKHJlY3QuaGVpZ2h0ICsgYXJyb3dib3hSZWN0LmhlaWdodCk7Ci0gICAgY29udGFpbmVy
LnRvcCA9IHRvcDsKLQotICAgIC8vIENyZWF0ZSBhIHZpcnR1YWwgZWxlbWVudCB0byBwb2ludCB0
bwotICAgIGxldCB2aXJ0dWFsQ29udGVudEVsZW1lbnQgPSB7Ci0gICAgICBnZXRCb3VuZGluZ0Ns
aWVudFJlY3Q6IGZ1bmN0aW9uKCkgewotICAgICAgICByZXR1cm4gdmlydHVhbENvbnRlbnRSZWN0
OwotICAgICAgfQotICAgIH07Ci0gICAgY29udGFpbmVyLmFuY2hvclRvKHZpcnR1YWxDb250ZW50
RWxlbWVudCk7Ci0gICAgY29udGFpbmVyLnN0eWxlLnZpc2liaWxpdHkgPSAidmlzaWJsZSI7Ci0g
IH0sCi0KLSAgLyoqIFVwZGF0ZSB0aGUgZm9ybSBoZWxwZXIgY29udGFpbmVyIHRvIHJlZmxlY3Qg
bmV3IGVsZW1lbnQgdXNlciBpcyBlZGl0aW5nLiAqLwotICBfdXBkYXRlQ29udGFpbmVyOiBmdW5j
dGlvbiBfZm9ybUhlbHBlclVwZGF0ZUNvbnRhaW5lcihhTGFzdEVsZW1lbnQsIGFDdXJyZW50RWxl
bWVudCkgewotICAgIHRoaXMuX3VwZGF0ZUNvbnRhaW5lckZvclNlbGVjdChhTGFzdEVsZW1lbnQs
IGFDdXJyZW50RWxlbWVudCk7Ci0KLSAgICB0aGlzLl9jb250YWluZXIuY29udGVudEhhc0NoYW5n
ZWQoKTsKLSAgfSwKLQogICAvKiogSGVscGVyIGZvciBfdXBkYXRlQ29udGFpbmVyIHRoYXQgaGFu
ZGxlcyB0aGUgY2FzZSB3aGVyZSB0aGUgbmV3IGVsZW1lbnQgaXMgYSBzZWxlY3QuICovCiAgIF91
cGRhdGVDb250YWluZXJGb3JTZWxlY3Q6IGZ1bmN0aW9uIF9mb3JtSGVscGVyVXBkYXRlQ29udGFp
bmVyRm9yU2VsZWN0KGFMYXN0RWxlbWVudCwgYUN1cnJlbnRFbGVtZW50KSB7CiAgICAgbGV0IGxh
c3RIYXNDaG9pY2VzID0gYUxhc3RFbGVtZW50ICYmIChhTGFzdEVsZW1lbnQuY2hvaWNlcyAhPSBu
dWxsKTsKICAgICBsZXQgY3VycmVudEhhc0Nob2ljZXMgPSBhQ3VycmVudEVsZW1lbnQgJiYgKGFD
dXJyZW50RWxlbWVudC5jaG9pY2VzICE9IG51bGwpOwogCiAgICAgaWYgKGN1cnJlbnRIYXNDaG9p
Y2VzKQogICAgICAgU2VsZWN0SGVscGVyVUkuc2hvdyhhQ3VycmVudEVsZW1lbnQuY2hvaWNlcywg
YUN1cnJlbnRFbGVtZW50LnRpdGxlKTsKICAgICBlbHNlIGlmIChsYXN0SGFzQ2hvaWNlcykKQEAg
LTEwODgsMjYgKzk0MiwyMCBAQCB2YXIgRm9ybUhlbHBlclVJID0gewogCiAgIF9lbnN1cmVDYXJl
dFZpc2libGU6IGZ1bmN0aW9uIF9lbnN1cmVDYXJldFZpc2libGUoYUNhcmV0UmVjdCkgewogICAg
IGlmICghYUNhcmV0UmVjdCB8fCAhU2VydmljZXMucHJlZnMuZ2V0Qm9vbFByZWYoImZvcm1oZWxw
ZXIuYXV0b3pvb20uY2FyZXQiKSkKICAgICAgIHJldHVybjsKIAogICAgIC8vIHRoZSBzY3JvbGxY
L3Njcm9sbFkgcG9zaXRpb24gY2FuIGNoYW5nZSBiZWNhdXNlIG9mIHRoZSBhbmltYXRlZCB6b29t
IHNvCiAgICAgLy8gZGVsYXkgdGhlIGNhcmV0IGFkanVzdG1lbnQKICAgICBpZiAoQW5pbWF0ZWRa
b29tLmlzWm9vbWluZygpKSB7Ci0gICAgICBsZXQgY3VycmVudEVsZW1lbnQgPSB0aGlzLl9jdXJy
ZW50RWxlbWVudDsKICAgICAgIGxldCBzZWxmID0gdGhpczsKLSAgICAgIHdpbmRvdy5hZGRFdmVu
dExpc3RlbmVyKCJBbmltYXRlZFpvb21FbmQiLCBmdW5jdGlvbigpIHsKLSAgICAgICAgd2luZG93
LnJlbW92ZUV2ZW50TGlzdGVuZXIoIkFuaW1hdGVkWm9vbUVuZCIsIGFyZ3VtZW50cy5jYWxsZWUs
IHRydWUpOwotICAgICAgICAgIC8vIEVuc3VyZSB0aGUgY3VycmVudCBlbGVtZW50IGhhcyBub3Qg
Y2hhbmdlZCBkdXJpbmcgdGhpcyBpbnRlcnZhbAotICAgICAgICAgIGlmIChzZWxmLl9jdXJyZW50
RWxlbWVudCAhPSBjdXJyZW50RWxlbWVudCkKLSAgICAgICAgICAgIHJldHVybjsKLQotICAgICAg
ICAgIHNlbGYuX2Vuc3VyZUNhcmV0VmlzaWJsZShhQ2FyZXRSZWN0KTsKLSAgICAgIH0sIHRydWUp
OworICAgICAgdGhpcy5fd2FpdEZvclpvb20oZnVuY3Rpb24oKSB7CisgICAgICAgIHNlbGYuX2Vu
c3VyZUNhcmV0VmlzaWJsZShhQ2FyZXRSZWN0KTsKKyAgICAgIH0pOwogICAgICAgcmV0dXJuOwog
ICAgIH0KIAogICAgIGxldCBicm93c2VyID0gZ2V0QnJvd3NlcigpOwogICAgIGxldCB6b29tUmVj
dCA9IFJlY3QuZnJvbVJlY3QoYnJvd3Nlci5nZXRCb3VuZGluZ0NsaWVudFJlY3QoKSk7CiAKICAg
ICB0aGlzLl9jdXJyZW50Q2FyZXRSZWN0ID0gYUNhcmV0UmVjdDsKICAgICBsZXQgY2FyZXRSZWN0
ID0gYUNhcmV0UmVjdC5jbG9uZSgpLnNjYWxlKGJyb3dzZXIuc2NhbGUsIGJyb3dzZXIuc2NhbGUp
OwpAQCAtMTE0MiwxNiArOTkwLDI5IEBAIHZhciBGb3JtSGVscGVyVUkgPSB7CiAgICAgICByZXR1
cm47CiAKICAgICBsZXQgcmVzdG9yZSA9IHRoaXMuX3Jlc3RvcmU7CiAgICAgZ2V0QnJvd3Nlcigp
LnNjYWxlID0gcmVzdG9yZS5zY2FsZTsKICAgICBCcm93c2VyLmNvbnRlbnRTY3JvbGxib3hTY3Jv
bGxlci5zY3JvbGxUbyhyZXN0b3JlLmNvbnRlbnRTY3JvbGxPZmZzZXQueCwgcmVzdG9yZS5jb250
ZW50U2Nyb2xsT2Zmc2V0LnkpOwogICAgIEJyb3dzZXIucGFnZVNjcm9sbGJveFNjcm9sbGVyLnNj
cm9sbFRvKHJlc3RvcmUucGFnZVNjcm9sbE9mZnNldC54LCByZXN0b3JlLnBhZ2VTY3JvbGxPZmZz
ZXQueSk7CiAgIH0sCiAKKyAgX3dhaXRGb3Jab29tOiBmdW5jdGlvbiBfZm9ybUhlbHBlcldhaXRG
b3Jab29tKGFDYWxsYmFjaykgeworICAgIGxldCBjdXJyZW50RWxlbWVudCA9IHRoaXMuX2N1cnJl
bnRFbGVtZW50OworICAgIGxldCBzZWxmID0gdGhpczsKKyAgICB3aW5kb3cuYWRkRXZlbnRMaXN0
ZW5lcigiQW5pbWF0ZWRab29tRW5kIiwgZnVuY3Rpb24oKSB7CisgICAgICB3aW5kb3cucmVtb3Zl
RXZlbnRMaXN0ZW5lcigiQW5pbWF0ZWRab29tRW5kIiwgYXJndW1lbnRzLmNhbGxlZSwgdHJ1ZSk7
CisgICAgICAvLyBFbnN1cmUgdGhlIGN1cnJlbnQgZWxlbWVudCBoYXMgbm90IGNoYW5nZWQgZHVy
aW5nIHRoaXMgaW50ZXJ2YWwKKyAgICAgIGlmIChzZWxmLl9jdXJyZW50RWxlbWVudCAhPSBjdXJy
ZW50RWxlbWVudCkKKyAgICAgICAgcmV0dXJuOworCisgICAgICBhQ2FsbGJhY2soKTsKKyAgICB9
LCB0cnVlKTsKKyAgfSwKKwogICBfZ2V0Wm9vbUxldmVsRm9yUmVjdDogZnVuY3Rpb24gX2dldFpv
b21MZXZlbEZvclJlY3QoYVJlY3QpIHsKICAgICBjb25zdCBtYXJnaW4gPSAzMDsKICAgICBsZXQg
em9vbUxldmVsID0gZ2V0QnJvd3NlcigpLmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpLndpZHRoIC8g
KGFSZWN0LndpZHRoICsgbWFyZ2luKTsKICAgICByZXR1cm4gVXRpbC5jbGFtcCh6b29tTGV2ZWws
IGtCcm93c2VyRm9ybVpvb21MZXZlbE1pbiwga0Jyb3dzZXJGb3JtWm9vbUxldmVsTWF4KTsKICAg
fSwKIAogICBfZ2V0T2Zmc2V0Rm9yQ2FyZXQ6IGZ1bmN0aW9uIF9mb3JtSGVscGVyR2V0T2Zmc2V0
Rm9yQ2FyZXQoYUNhcmV0UmVjdCwgYVJlY3QpIHsKICAgICAvLyBEZXRlcm1pbmUgaWYgd2UgbmVl
ZCB0byBtb3ZlIGxlZnQgb3IgcmlnaHQgdG8gYnJpbmcgdGhlIGNhcmV0IGludG8gdmlldwpkaWZm
IC0tZ2l0IGEvbW9iaWxlL2Nocm9tZS9jb250ZW50L2Zvcm1zLmpzIGIvbW9iaWxlL2Nocm9tZS9j
b250ZW50L2Zvcm1zLmpzCi0tLSBhL21vYmlsZS9jaHJvbWUvY29udGVudC9mb3Jtcy5qcworKysg
Yi9tb2JpbGUvY2hyb21lL2NvbnRlbnQvZm9ybXMuanMKQEAgLTU2NywxNyArNTY3LDE3IEBAIEZv
cm1Bc3Npc3RhbnQucHJvdG90eXBlID0gewogCiAgICAgaWYgKGFFbGVtZW50IGluc3RhbmNlb2Yg
SFRNTElucHV0RWxlbWVudCB8fCBhRWxlbWVudCBpbnN0YW5jZW9mIEhUTUxCdXR0b25FbGVtZW50
KQogICAgICAgcmV0dXJuICEoYUVsZW1lbnQudHlwZSA9PSAiaGlkZGVuIik7CiAKICAgICByZXR1
cm4gdGhpcy5faXNFZGl0YWJsZShhRWxlbWVudCk7CiAgIH0sCiAKICAgX2lzVmlzaWJsZUVsZW1l
bnQ6IGZ1bmN0aW9uIGZvcm1IZWxwZXJJc1Zpc2libGVFbGVtZW50KGFFbGVtZW50KSB7Ci0gICAg
bGV0IHN0eWxlID0gYUVsZW1lbnQub3duZXJEb2N1bWVudC5kZWZhdWx0Vmlldy5nZXRDb21wdXRl
ZFN0eWxlKGFFbGVtZW50LCBudWxsKTsKKyAgICBsZXQgc3R5bGUgPSBhRWxlbWVudCA/IGFFbGVt
ZW50Lm93bmVyRG9jdW1lbnQuZGVmYXVsdFZpZXcuZ2V0Q29tcHV0ZWRTdHlsZShhRWxlbWVudCwg
bnVsbCkgOiBudWxsOwogICAgIGlmICghc3R5bGUpCiAgICAgICByZXR1cm4gZmFsc2U7CiAKICAg
ICBsZXQgaXNWaXNpYmxlID0gKHN0eWxlLmdldFByb3BlcnR5VmFsdWUoInZpc2liaWxpdHkiKSAh
PSAiaGlkZGVuIik7CiAgICAgbGV0IGlzT3BhcXVlID0gKHN0eWxlLmdldFByb3BlcnR5VmFsdWUo
Im9wYWNpdHkiKSAhPSAwKTsKIAogICAgIGxldCByZWN0ID0gYUVsZW1lbnQuZ2V0Qm91bmRpbmdD
bGllbnRSZWN0KCk7CiAgICAgcmV0dXJuIGlzVmlzaWJsZSAmJiBpc09wYXF1ZSAmJiAocmVjdC5o
ZWlnaHQgIT0gMCB8fCByZWN0LndpZHRoICE9IDApOwpkaWZmIC0tZ2l0IGEvbW9iaWxlL2Nocm9t
ZS9qYXIubW4gYi9tb2JpbGUvY2hyb21lL2phci5tbgotLS0gYS9tb2JpbGUvY2hyb21lL2phci5t
bgorKysgYi9tb2JpbGUvY2hyb21lL2phci5tbgpAQCAtMjIsMTYgKzIyLDE3IEBAIGNocm9tZS5q
YXI6CiAqIGNvbnRlbnQvYnJvd3Nlci11aS5qcyAgICAgICAgICAgICAgICAoY29udGVudC9icm93
c2VyLXVpLmpzKQogKiBjb250ZW50L2Jyb3dzZXItc2NyaXB0cy5qcyAgICAgICAgICAgKGNvbnRl
bnQvYnJvd3Nlci1zY3JpcHRzLmpzKQogKiBjb250ZW50L2NvbW1vbi11aS5qcyAgICAgICAgICAg
ICAgICAgKGNvbnRlbnQvY29tbW9uLXVpLmpzKQogKiBjb250ZW50L0FsZXJ0c0hlbHBlci5qcyAg
ICAgICAgICAgICAgKGNvbnRlbnQvQWxlcnRzSGVscGVyLmpzKQogICBjb250ZW50L0FwcE1lbnUu
anMgICAgICAgICAgICAgICAgICAgKGNvbnRlbnQvQXBwTWVudS5qcykKICAgY29udGVudC9Bd2Vz
b21lUGFuZWwuanMgICAgICAgICAgICAgIChjb250ZW50L0F3ZXNvbWVQYW5lbC5qcykKICAgY29u
dGVudC9Cb29rbWFya0hlbHBlci5qcyAgICAgICAgICAgIChjb250ZW50L0Jvb2ttYXJrSGVscGVy
LmpzKQogICBjb250ZW50L0Jvb2ttYXJrUG9wdXAuanMgICAgICAgICAgICAgKGNvbnRlbnQvQm9v
a21hcmtQb3B1cC5qcykKKyAgY29udGVudC9Db250ZW50UG9wdXBIZWxwZXIuanMgICAgICAgIChj
b250ZW50L0NvbnRlbnRQb3B1cEhlbHBlci5qcykKICogY29udGVudC9Db250ZXh0Q29tbWFuZHMu
anMgICAgICAgICAgIChjb250ZW50L0NvbnRleHRDb21tYW5kcy5qcykKICAgY29udGVudC9NZW51
TGlzdEhlbHBlclVJLmpzICAgICAgICAgIChjb250ZW50L01lbnVMaXN0SGVscGVyVUkuanMpCiAg
IGNvbnRlbnQvT2ZmbGluZUFwcHMuanMgICAgICAgICAgICAgICAoY29udGVudC9PZmZsaW5lQXBw
cy5qcykKICAgY29udGVudC9TZWxlY3RIZWxwZXJVSS5qcyAgICAgICAgICAgIChjb250ZW50L1Nl
bGVjdEhlbHBlclVJLmpzKQogICBjb250ZW50L1NoYXJpbmdVSS5qcyAgICAgICAgICAgICAgICAg
KGNvbnRlbnQvU2hhcmluZ1VJLmpzKQogKiBjb250ZW50L2NvbnRlbnQuanMgICAgICAgICAgICAg
ICAgICAgKGNvbnRlbnQvY29udGVudC5qcykKICAgY29udGVudC9jb21tYW5kVXRpbC5qcyAgICAg
ICAgICAgICAgIChjb250ZW50L2NvbW1hbmRVdGlsLmpzKQogKiBjb250ZW50L2JpbmRpbmdzLnht
bCAgICAgICAgICAgICAgICAgKGNvbnRlbnQvYmluZGluZ3MueG1sKQpkaWZmIC0tZ2l0IGEvbW9i
aWxlL2Nocm9tZS90ZXN0cy9NYWtlZmlsZS5pbiBiL21vYmlsZS9jaHJvbWUvdGVzdHMvTWFrZWZp
bGUuaW4KLS0tIGEvbW9iaWxlL2Nocm9tZS90ZXN0cy9NYWtlZmlsZS5pbgorKysgYi9tb2JpbGUv
Y2hyb21lL3Rlc3RzL01ha2VmaWxlLmluCkBAIC00NCwxNiArNDQsMTcgQEAgVEVTVFhQSSAgPSAk
KENVUkRJUikvJChERVBUSCkvX3Rlc3RzL3RlcwogQURET05TUkMgPSAkKHNyY2RpcikvYWRkb25z
CiAKIGluY2x1ZGUgJChERVBUSCkvY29uZmlnL2F1dG9jb25mLm1rCiBpbmNsdWRlICQodG9wc3Jj
ZGlyKS9jb25maWcvcnVsZXMubWsKIAogX0JST1dTRVJfRklMRVMgPSBcCiAgIGhlYWQuanMgXAog
ICByZW1vdGVfYXV0b2NvbXBsZXRlLmpzIFwKKyAgcmVtb3RlX2NvbnRlbnRwb3B1cC5qcyBcCiAg
IHJlbW90ZV9oZWFkLmpzIFwKICAgcmVtb3RlX2Zvcm1zLmpzIFwKICAgcmVtb3RlX2Zvcm1zWm9v
bS5qcyBcCiAgIHJlbW90ZV92a2IuanMgXAogICBicm93c2VyX2FkZG9ucy5qcyBcCiAgIGJyb3dz
ZXJfYXV0b2NvbXBsZXRlLmh0bWwgXAogICBicm93c2VyX2F1dG9jb21wbGV0ZS5qcyBcCiAgIGJy
b3dzZXJfYXV0b2NvbXBsZXRlc2VhcmNoLmpzXApAQCAtNjEsMTYgKzYyLDE4IEBAIF9CUk9XU0VS
X0ZJTEVTID0gXAogICBicm93c2VyX2JsYW5rXzAxLmh0bWwgXAogICBicm93c2VyX2JsYW5rXzAy
Lmh0bWwgXAogICBicm93c2VyX2Jvb2ttYXJrcy5qcyBcCiAgIGJyb3dzZXJfYm9va21hcmtzX3N0
YXIuanMgXAogICBicm93c2VyX2Jvb2ttYXJrc190YWdzLmpzIFwKICAgYnJvd3Nlcl9jbGlja19j
b250ZW50Lmh0bWwgXAogICBicm93c2VyX2NsaWNrX2NvbnRlbnQuanMgXAogICBicm93c2VyX2Nv
bnRhY3RzLmpzIFwKKyAgYnJvd3Nlcl9jb250ZW50cG9wdXAuaHRtbCBcCisgIGJyb3dzZXJfY29u
dGVudHBvcHVwLmpzIFwKICAgYnJvd3Nlcl9maW5kLmpzIFwKICAgYnJvd3Nlcl9mb3Jtcy5odG1s
IFwKICAgJCh3YXJuaW5nIGJyb3dzZXJfZm9ybXMuanMgZGlzYWJsZWQgZHVlIHRvIGZhaWx1cmVz
KSBcCiAgIGJyb3dzZXJfZm9ybXNab29tLmh0bWwgXAogICAkKHdhcm5pbmcgYnJvd3Nlcl9mb3Jt
c1pvb20uanMgZGlzYWJsZWQgZHVlIHRvIGZhaWx1cmVzKSBcCiAgIGJyb3dzZXJfaGlzdG9yeS5q
cyBcCiAgIGJyb3dzZXJfbWFpbnVpLmpzIFwKICAgYnJvd3Nlcl9uYXZpZ2F0aW9uLmpzIFwKZGlm
ZiAtLWdpdCBhL21vYmlsZS9jaHJvbWUvdGVzdHMvYnJvd3Nlcl9hdXRvY29tcGxldGUuaHRtbCBi
L21vYmlsZS9jaHJvbWUvdGVzdHMvYnJvd3Nlcl9hdXRvY29tcGxldGUuaHRtbAotLS0gYS9tb2Jp
bGUvY2hyb21lL3Rlc3RzL2Jyb3dzZXJfYXV0b2NvbXBsZXRlLmh0bWwKKysrIGIvbW9iaWxlL2No
cm9tZS90ZXN0cy9icm93c2VyX2F1dG9jb21wbGV0ZS5odG1sCkBAIC0xNiwxMSArMTYsMTkgQEAK
ICAgICAgIDxvcHRpb24+Zm9vYmFyPC9vcHRpb24+CiAgICAgICA8b3B0aW9uPmZvb2JhciBmb288
L29wdGlvbj4KICAgICAgIDxvcHRpb24+Zm9vYmFyIGZvbyB0aXRpPC9vcHRpb24+CiAgICAgICA8
b3B0aW9uPmZvb2JhciBmb28gdGl0aSB0b3RvPC9vcHRpb24+CiAgICAgICA8b3B0aW9uPmZvb2Jh
ciBmb28gdGl0aSB0b3RvIHR1dHU8L29wdGlvbj4KICAgICA8L2RhdGFsaXN0PgogICAgIDxpbnB1
dCBpZD0iaW5wdXQtZGF0YWxpc3QtMiIgbGlzdD0iZGF0YWxpc3QtMiI+PC9pbnB1dD4KIAorICAg
IDxiciAvPjxiciAvPgorCisgICAgPGRhdGFsaXN0IGlkPSJkYXRhbGlzdC0zIj4KKyAgICAgIDxv
cHRpb24+Zm9vPC9vcHRpb24+CisgICAgPC9kYXRhbGlzdD4KKyAgICA8aW5wdXQgaWQ9ImlucHV0
LWRhdGFsaXN0LTMiIGxpc3Q9ImRhdGFsaXN0LTMiPjwvaW5wdXQ+CisKKyAgICA8YnIgLz48YnIg
Lz4KICAgPC9ib2R5PgogPC9odG1sPgogCmRpZmYgLS1naXQgYS9tb2JpbGUvY2hyb21lL3Rlc3Rz
L2Jyb3dzZXJfYXV0b2NvbXBsZXRlLmpzIGIvbW9iaWxlL2Nocm9tZS90ZXN0cy9icm93c2VyX2F1
dG9jb21wbGV0ZS5qcwotLS0gYS9tb2JpbGUvY2hyb21lL3Rlc3RzL2Jyb3dzZXJfYXV0b2NvbXBs
ZXRlLmpzCisrKyBiL21vYmlsZS9jaHJvbWUvdGVzdHMvYnJvd3Nlcl9hdXRvY29tcGxldGUuanMK
QEAgLTE1LDMyICsxNSw0MiBAQCBmdW5jdGlvbiB0ZXN0KCkgewogICBtZXNzYWdlTWFuYWdlci5h
ZGRNZXNzYWdlTGlzdGVuZXIoInBhZ2VzaG93IiwgZnVuY3Rpb24oYU1lc3NhZ2UpIHsKICAgICBp
ZiAobmV3VGFiICYmIG5ld1RhYi5icm93c2VyLmN1cnJlbnRVUkkuc3BlYyAhPSAiYWJvdXQ6Ymxh
bmsiKSB7CiAgICAgICBtZXNzYWdlTWFuYWdlci5yZW1vdmVNZXNzYWdlTGlzdGVuZXIoYU1lc3Nh
Z2UubmFtZSwgYXJndW1lbnRzLmNhbGxlZSk7CiAgICAgICBCcm93c2VyVUkuY2xvc2VBdXRvQ29t
cGxldGUodHJ1ZSk7CiAgICAgICBzZXRUaW1lb3V0KHJ1bk5leHRUZXN0LCAwKTsKICAgICB9CiAg
IH0pOwogCi0gIG5ld1RhYiA9IEJyb3dzZXIuYWRkVGFiKHRlc3RVUkwsIHRydWUpOworICBsZXQg
c3RhcnR1cEluZm8gPSBDY1siQG1vemlsbGEub3JnL3Rvb2xraXQvYXBwLXN0YXJ0dXA7MSJdLmdl
dFNlcnZpY2UoQ2kubnNJQXBwU3RhcnR1cCkuZ2V0U3RhcnR1cEluZm8oKTsKKyAgaWYgKCEoImZp
cnN0UGFpbnQiIGluIHN0YXJ0dXBJbmZvKSkKKyAgICB3YWl0Rm9yKGZ1bmN0aW9uKCkgeyBuZXdU
YWIgPSBCcm93c2VyLmFkZFRhYih0ZXN0VVJMLCB0cnVlKTsgfSwgZnVuY3Rpb24oKSB7CisgICAg
ICBsZXQgc3RhcnR1cEluZm8gPSBDY1siQG1vemlsbGEub3JnL3Rvb2xraXQvYXBwLXN0YXJ0dXA7
MSJdLmdldFNlcnZpY2UoQ2kubnNJQXBwU3RhcnR1cCkuZ2V0U3RhcnR1cEluZm8oKTsKKyAgICAg
IHJldHVybiAoImZpcnN0UGFpbnQiIGluIHN0YXJ0dXBJbmZvKTsKKyAgICB9LCBEYXRlLm5vdygp
ICsgMzAwMCk7CisgIGVsc2UKKyAgICBuZXdUYWIgPSBCcm93c2VyLmFkZFRhYih0ZXN0VVJMLCB0
cnVlKTsKIH0KIAogLy8tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0t
LS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KIC8vIEl0ZXJhdGluZyB0ZXN0cyBi
eSBzaGlmdGluZyB0ZXN0IG91dCBvbmUgYnkgb25lIGFzIHJ1bk5leHRUZXN0IGlzIGNhbGxlZC4K
IGZ1bmN0aW9uIHJ1bk5leHRUZXN0KCkgewogICAvLyBSdW4gdGhlIG5leHQgdGVzdCB1bnRpbCBh
bGwgdGVzdHMgY29tcGxldGVkCiAgIGlmIChnVGVzdHMubGVuZ3RoID4gMCkgewogICAgIGdDdXJy
ZW50VGVzdCA9IGdUZXN0cy5zaGlmdCgpOwogICAgIGluZm8oZ0N1cnJlbnRUZXN0LmRlc2MpOwog
ICAgIGdDdXJyZW50VGVzdC5ydW4oKTsKICAgfQogICBlbHNlIHsKICAgICAvLyBDbGVhbnVwLiBB
bGwgdGVzdHMgYXJlIGNvbXBsZXRlZCBhdCB0aGlzIHBvaW50CiAgICAgdHJ5IHsKICAgICAgIC8v
IEFkZCBhbnkgY2xlYW51cCBjb2RlIGhlcmUKKworICAgICAgLy8gQ2xvc2Ugb3VyIHRhYiB3aGVu
IGZpbmlzaGVkCisgICAgICBCcm93c2VyLmNsb3NlVGFiKG5ld1RhYik7CiAgICAgfQogICAgIGZp
bmFsbHkgewogICAgICAgLy8gV2UgbXVzdCBmaW5pYWxpemUgdGhlIHRlc3RzCiAgICAgICBmaW5p
c2goKTsKICAgICB9CiAgIH0KIH0KIApAQCAtMTI1LDE2ICsxMzUsNDggQEAgZ1Rlc3RzLnB1c2go
ewogICAgICAgZ0N1cnJlbnRUZXN0LmNoZWNrVUlDbGljayhhSW5kZXggKyAxKTsKICAgICB9KTsK
ICAgfSwKIAogICBmaW5pc2g6IGZ1bmN0aW9uKCkgewogICAgIC8vIENsb3NlIHRoZSBmb3JtIGFz
c2lzdGFudAogICAgIEZvcm1IZWxwZXJVSS5oaWRlKCk7CiAKLSAgICAvLyBDbG9zZSBvdXIgdGFi
IHdoZW4gZmluaXNoZWQKLSAgICBCcm93c2VyLmNsb3NlVGFiKG5ld1RhYik7CiAKLSAgICAvLyBX
ZSBtdXN0IGZpbmFsaXplIHRoZSB0ZXN0cwotICAgIGZpbmlzaCgpOworICAgIEFzeW5jVGVzdHMu
d2FpdEZvcigiVGVzdFJlbW90ZUF1dG9jb21wbGV0ZTpSZXNldCIsIHsgaWQ6ICJpbnB1dC1kYXRh
bGlzdC0xIiB9LCBmdW5jdGlvbihqc29uKSB7CisgICAgICBydW5OZXh0VGVzdCgpOworICAgIH0p
OwogICB9CiB9KTsKIAorLy8tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0t
LS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KKy8vIENhc2U6IENoZWNrIGFy
cm93cyB2aXNpYmlsaXR5CitnVGVzdHMucHVzaCh7CisgIGRlc2M6ICJDaGVjayBhcnJvd3Mgdmlz
aWJpbGl0eSIsCisKKyAgcnVuOiBmdW5jdGlvbigpIHsKKyAgICBsZXQgcG9wdXAgPSBkb2N1bWVu
dC5nZXRFbGVtZW50QnlJZCgiZm9ybS1oZWxwZXItc3VnZ2VzdGlvbnMtY29udGFpbmVyIik7Cisg
ICAgcG9wdXAuYWRkRXZlbnRMaXN0ZW5lcigiY29udGVudHBvcHVwc2hvd24iLCBmdW5jdGlvbihh
RXZlbnQpIHsKKyAgICAgIGFFdmVudC50YXJnZXQucmVtb3ZlRXZlbnRMaXN0ZW5lcihhRXZlbnQu
dHlwZSwgYXJndW1lbnRzLmNhbGxlZSwgZmFsc2UpOworICAgICAgd2FpdEZvcihnQ3VycmVudFRl
c3QuY2hlY2tOb0Fycm93cywgZnVuY3Rpb24oKSB7CisgICAgICAgIHJldHVybiBGb3JtSGVscGVy
VUkuX29wZW47CisgICAgICB9KTsKKyAgICB9LCBmYWxzZSk7CisKKyAgICBBc3luY1Rlc3RzLndh
aXRGb3IoIlRlc3RSZW1vdGVBdXRvY29tcGxldGU6Q2xpY2siLAorICAgICAgICAgICAgICAgICAg
ICAgICAgeyBpZDogImlucHV0LWRhdGFsaXN0LTMiIH0sIGZ1bmN0aW9uKGpzb24pIHt9KTsKKyAg
fSwKKworICBjaGVja05vQXJyb3dzOiBmdW5jdGlvbigpIHsKKyAgICBsZXQgc2Nyb2xsYm94ID0g
ZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoImZvcm0taGVscGVyLXN1Z2dlc3Rpb25zIik7CisgICAg
dG9kb19pcyhzY3JvbGxib3guX3Njcm9sbEJ1dHRvblVwLmNvbGxhcHNlZCwgdHJ1ZSwgIkxlZnQg
YnV0dG9uIHNob3VsZCBiZSBjb2xsYXBzZWQiKTsKKyAgICB0b2RvX2lzKHNjcm9sbGJveC5fc2Ny
b2xsQnV0dG9uRG93bi5jb2xsYXBzZWQsIHRydWUsICJSaWdodCBidXR0b24gc2hvdWxkIGJlIGNv
bGxhcHNlZCIpOworICAgIGdDdXJyZW50VGVzdC5maW5pc2goKTsKKyAgfSwKKworICBmaW5pc2g6
IGZ1bmN0aW9uKCkgeworICAgIC8vIENsb3NlIHRoZSBmb3JtIGFzc2lzdGFudAorICAgIEZvcm1I
ZWxwZXJVSS5oaWRlKCk7CisKKyAgICBydW5OZXh0VGVzdCgpOworICB9Cit9KTsKKwpkaWZmIC0t
Z2l0IGEvbW9iaWxlL2Nocm9tZS90ZXN0cy9icm93c2VyX2NvbnRlbnRwb3B1cC5odG1sIGIvbW9i
aWxlL2Nocm9tZS90ZXN0cy9icm93c2VyX2NvbnRlbnRwb3B1cC5odG1sCm5ldyBmaWxlIG1vZGUg
MTAwNjQ0Ci0tLSAvZGV2L251bGwKKysrIGIvbW9iaWxlL2Nocm9tZS90ZXN0cy9icm93c2VyX2Nv
bnRlbnRwb3B1cC5odG1sCkBAIC0wLDAgKzEsMjYgQEAKKzxodG1sPgorICA8Ym9keT4KKyAgICA8
ZGF0YWxpc3QgaWQ9ImRhdGFsaXN0LTEiPgorICAgICAgPG9wdGlvbj5mb288L29wdGlvbj4KKyAg
ICAgIDxvcHRpb24gZGlzYWJsZWQ9InRydWUiPmJhcjwvb3B0aW9uPgorICAgICAgPG9wdGlvbiB2
YWx1ZT0iYmFyIj5Tb21ld2hhdCBiYXI8L29wdGlvbj4KKyAgICAgIDxvcHRpb24gbGFiZWw9ImZv
b2JhciIgdmFsdWU9Il8iPjwvb3B0aW9uPgorICAgIDwvZGF0YWxpc3Q+CisgICAgPGlucHV0IGlk
PSJpbnB1dC1kYXRhbGlzdC0xIiBsaXN0PSJkYXRhbGlzdC0xIj48L2lucHV0PgorCisgICAgPGJy
IC8+PGJyIC8+CisKKyAgICA8ZGF0YWxpc3QgaWQ9ImRhdGFsaXN0LTIiPgorICAgICAgPG9wdGlv
bj5mb288L29wdGlvbj4KKyAgICAgIDxvcHRpb24+YmFyPC9vcHRpb24+CisgICAgICA8b3B0aW9u
PmZvb2Jhcjwvb3B0aW9uPgorICAgICAgPG9wdGlvbj5mb29iYXIgZm9vPC9vcHRpb24+CisgICAg
ICA8b3B0aW9uPmZvb2JhciBmb28gdGl0aTwvb3B0aW9uPgorICAgICAgPG9wdGlvbj5mb29iYXIg
Zm9vIHRpdGkgdG90bzwvb3B0aW9uPgorICAgICAgPG9wdGlvbj5mb29iYXIgZm9vIHRpdGkgdG90
byB0dXR1PC9vcHRpb24+CisgICAgPC9kYXRhbGlzdD4KKyAgICA8aW5wdXQgaWQ9ImlucHV0LWRh
dGFsaXN0LTIiIGxpc3Q9ImRhdGFsaXN0LTIiPjwvaW5wdXQ+CisKKyAgPC9ib2R5PgorPC9odG1s
PgorCmRpZmYgLS1naXQgYS9tb2JpbGUvY2hyb21lL3Rlc3RzL2Jyb3dzZXJfY29udGVudHBvcHVw
LmpzIGIvbW9iaWxlL2Nocm9tZS90ZXN0cy9icm93c2VyX2NvbnRlbnRwb3B1cC5qcwpuZXcgZmls
ZSBtb2RlIDEwMDY0NAotLS0gL2Rldi9udWxsCisrKyBiL21vYmlsZS9jaHJvbWUvdGVzdHMvYnJv
d3Nlcl9jb250ZW50cG9wdXAuanMKQEAgLTAsMCArMSw5NCBAQAorbGV0IHRlc3RVUkwgPSBjaHJv
bWVSb290ICsgImJyb3dzZXJfY29udGVudHBvcHVwLmh0bWwiOworbWVzc2FnZU1hbmFnZXIubG9h
ZEZyYW1lU2NyaXB0KGNocm9tZVJvb3QgKyAicmVtb3RlX2NvbnRlbnRwb3B1cC5qcyIsIHRydWUp
OworCitsZXQgbmV3VGFiID0gbnVsbDsKKworLy8gQSBxdWV1ZSB0byBvcmRlciB0aGUgdGVzdHMg
YW5kIGEgaGFuZGxlIGZvciBlYWNoIHRlc3QKK3ZhciBnVGVzdHMgPSBbXTsKK3ZhciBnQ3VycmVu
dFRlc3QgPSBudWxsOworCitmdW5jdGlvbiB0ZXN0KCkgeworICAvLyBUaGlzIHRlc3QgaXMgYXN5
bmMKKyAgd2FpdEZvckV4cGxpY2l0RmluaXNoKCk7CisKKyAgLy8gTmVlZCB0byB3YWl0IHVudGls
IHRoZSBwYWdlIGlzIGxvYWRlZAorICBtZXNzYWdlTWFuYWdlci5hZGRNZXNzYWdlTGlzdGVuZXIo
InBhZ2VzaG93IiwgZnVuY3Rpb24oYU1lc3NhZ2UpIHsKKyAgICBpZiAobmV3VGFiICYmIG5ld1Rh
Yi5icm93c2VyLmN1cnJlbnRVUkkuc3BlYyAhPSAiYWJvdXQ6YmxhbmsiKSB7CisgICAgICBtZXNz
YWdlTWFuYWdlci5yZW1vdmVNZXNzYWdlTGlzdGVuZXIoYU1lc3NhZ2UubmFtZSwgYXJndW1lbnRz
LmNhbGxlZSk7CisgICAgICBCcm93c2VyVUkuY2xvc2VBdXRvQ29tcGxldGUodHJ1ZSk7CisgICAg
ICBzZXRUaW1lb3V0KHJ1bk5leHRUZXN0LCAwKTsKKyAgICB9CisgIH0pOworCisgIGxldCBzdGFy
dHVwSW5mbyA9IENjWyJAbW96aWxsYS5vcmcvdG9vbGtpdC9hcHAtc3RhcnR1cDsxIl0uZ2V0U2Vy
dmljZShDaS5uc0lBcHBTdGFydHVwKS5nZXRTdGFydHVwSW5mbygpOworICBpZiAoISgiZmlyc3RQ
YWludCIgaW4gc3RhcnR1cEluZm8pKQorICAgIHdhaXRGb3IoZnVuY3Rpb24oKSB7IG5ld1RhYiA9
IEJyb3dzZXIuYWRkVGFiKHRlc3RVUkwsIHRydWUpOyB9LCBmdW5jdGlvbigpIHsKKyAgICAgIGxl
dCBzdGFydHVwSW5mbyA9IENjWyJAbW96aWxsYS5vcmcvdG9vbGtpdC9hcHAtc3RhcnR1cDsxIl0u
Z2V0U2VydmljZShDaS5uc0lBcHBTdGFydHVwKS5nZXRTdGFydHVwSW5mbygpOworICAgICAgcmV0
dXJuICgiZmlyc3RQYWludCIgaW4gc3RhcnR1cEluZm8pOworICAgIH0sIERhdGUubm93KCkgKyAz
MDAwKTsKKyAgZWxzZQorICAgIG5ld1RhYiA9IEJyb3dzZXIuYWRkVGFiKHRlc3RVUkwsIHRydWUp
OworfQorCisvLy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0t
LS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQorLy8gSXRlcmF0aW5nIHRlc3RzIGJ5IHNo
aWZ0aW5nIHRlc3Qgb3V0IG9uZSBieSBvbmUgYXMgcnVuTmV4dFRlc3QgaXMgY2FsbGVkLgorZnVu
Y3Rpb24gcnVuTmV4dFRlc3QoKSB7CisgIC8vIFJ1biB0aGUgbmV4dCB0ZXN0IHVudGlsIGFsbCB0
ZXN0cyBjb21wbGV0ZWQKKyAgaWYgKGdUZXN0cy5sZW5ndGggPiAwKSB7CisgICAgZ0N1cnJlbnRU
ZXN0ID0gZ1Rlc3RzLnNoaWZ0KCk7CisgICAgaW5mbyhnQ3VycmVudFRlc3QuZGVzYyk7CisgICAg
Z0N1cnJlbnRUZXN0LnJ1bigpOworICB9CisgIGVsc2UgeworICAgIC8vIENsZWFudXAuIEFsbCB0
ZXN0cyBhcmUgY29tcGxldGVkIGF0IHRoaXMgcG9pbnQKKyAgICB0cnkgeworICAgICAgLy8gQWRk
IGFueSBjbGVhbnVwIGNvZGUgaGVyZQorCisgICAgICAvLyBDbG9zZSBvdXIgdGFiIHdoZW4gZmlu
aXNoZWQKKyAgICAgIEJyb3dzZXIuY2xvc2VUYWIobmV3VGFiKTsKKyAgICB9CisgICAgZmluYWxs
eSB7CisgICAgICAvLyBXZSBtdXN0IGZpbmlhbGl6ZSB0aGUgdGVzdHMKKyAgICAgIGZpbmlzaCgp
OworICAgIH0KKyAgfQorfQorCisvLy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0t
LS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQorLy8gQ2FzZTogU2hv
dy9IaWRlIHRoZSBjb250ZW50IHBvcHVwIGhlbHBlcgorZ1Rlc3RzLnB1c2goeworICBkZXNjOiAi
U2hvdy9IaWRlIHRoZSBjb250ZW50IHBvcHVwIGhlbHBlciIsCisKKyAgcnVuOiBmdW5jdGlvbigp
IHsKKyAgICBsZXQgcG9wdXAgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgiZm9ybS1oZWxwZXIt
c3VnZ2VzdGlvbnMtY29udGFpbmVyIik7CisgICAgcG9wdXAuYWRkRXZlbnRMaXN0ZW5lcigiY29u
dGVudHBvcHVwc2hvd24iLCBmdW5jdGlvbihhRXZlbnQpIHsKKyAgICAgIGFFdmVudC50YXJnZXQu
cmVtb3ZlRXZlbnRMaXN0ZW5lcihhRXZlbnQudHlwZSwgYXJndW1lbnRzLmNhbGxlZSwgZmFsc2Up
OworICAgICAgb2soIXBvcHVwLmhpZGRlbiwgIkNvbnRlbnQgcG9wdXAgc2hvdWxkIGJlIHZpc2li
bGUiKTsKKyAgICAgIHdhaXRGb3IoZ0N1cnJlbnRUZXN0LmhpZGVQb3B1cCwgZnVuY3Rpb24oKSB7
CisgICAgICAgIHJldHVybiBGb3JtSGVscGVyVUkuX29wZW47CisgICAgICB9KTsKKyAgICB9LCBm
YWxzZSk7CisKKyAgICBBc3luY1Rlc3RzLndhaXRGb3IoIlRlc3RSZW1vdGVBdXRvY29tcGxldGU6
Q2xpY2siLAorICAgICAgICAgICAgICAgICAgICAgICAgeyBpZDogImlucHV0LWRhdGFsaXN0LTEi
IH0sIGZ1bmN0aW9uKGpzb24pIHt9KTsKKyAgfSwKKworICBoaWRlUG9wdXA6IGZ1bmN0aW9uKCkg
eworICAgIGxldCBwb3B1cCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJmb3JtLWhlbHBlci1z
dWdnZXN0aW9ucy1jb250YWluZXIiKTsKKyAgICBwb3B1cC5hZGRFdmVudExpc3RlbmVyKCJjb250
ZW50cG9wdXBoaWRkZW4iLCBmdW5jdGlvbihhRXZlbnQpIHsKKyAgICAgIHBvcHVwLnJlbW92ZUV2
ZW50TGlzdGVuZXIoImNvbnRlbnRwb3B1cGhpZGRlbiIsIGFyZ3VtZW50cy5jYWxsZWUsIGZhbHNl
KTsKKyAgICAgIG9rKHBvcHVwLmhpZGRlbiwgIkNvbnRlbnQgcG9wdXAgc2hvdWxkIGJlIGhpZGRl
biIpOworICAgICAgd2FpdEZvcihnQ3VycmVudFRlc3QuZmluaXNoLCBmdW5jdGlvbigpIHsKKyAg
ICAgICAgcmV0dXJuICFGb3JtSGVscGVyVUkuX29wZW47CisgICAgICB9KTsKKyAgICB9LCBmYWxz
ZSk7CisKKyAgICAvLyBDbG9zZSB0aGUgZm9ybSBhc3Npc3RhbnQKKyAgICBGb3JtSGVscGVyVUku
aGlkZSgpOworICB9LAorCisgIGZpbmlzaDogZnVuY3Rpb24oKSB7CisgICAgcnVuTmV4dFRlc3Qo
KTsKKyAgfQorfSk7CisKZGlmZiAtLWdpdCBhL21vYmlsZS9jaHJvbWUvdGVzdHMvcmVtb3RlX2F1
dG9jb21wbGV0ZS5qcyBiL21vYmlsZS9jaHJvbWUvdGVzdHMvcmVtb3RlX2F1dG9jb21wbGV0ZS5q
cwotLS0gYS9tb2JpbGUvY2hyb21lL3Rlc3RzL3JlbW90ZV9hdXRvY29tcGxldGUuanMKKysrIGIv
bW9iaWxlL2Nocm9tZS90ZXN0cy9yZW1vdGVfYXV0b2NvbXBsZXRlLmpzCkBAIC0xMSw4ICsxMSwx
NSBAQCBBc3luY1Rlc3RzLmFkZCgiVGVzdFJlbW90ZUF1dG9jb21wbGV0ZTpDCiAgIHJldHVybiB0
cnVlOwogfSk7CiAKIEFzeW5jVGVzdHMuYWRkKCJUZXN0UmVtb3RlQXV0b2NvbXBsZXRlOkNoZWNr
IiwgZnVuY3Rpb24oYU1lc3NhZ2UsIGFKc29uKSB7CiAgIGxldCBlbGVtZW50ID0gY29udGVudC5k
b2N1bWVudC5nZXRFbGVtZW50QnlJZChhSnNvbi5pZCk7CiAgIHJldHVybiBlbGVtZW50LnZhbHVl
OwogfSk7CiAKK0FzeW5jVGVzdHMuYWRkKCJUZXN0UmVtb3RlQXV0b2NvbXBsZXRlOlJlc2V0Iiwg
ZnVuY3Rpb24oYU1lc3NhZ2UsIGFKc29uKSB7CisgIGdGb2N1c01hbmFnZXIuZm9jdXNlZEVsZW1l
bnQgPSBudWxsOworICBsZXQgZWxlbWVudCA9IGNvbnRlbnQuZG9jdW1lbnQuZ2V0RWxlbWVudEJ5
SWQoYUpzb24uaWQpOworICBlbGVtZW50LnZhbHVlID0gIiI7CisgIHJldHVybiB0cnVlOworfSk7
CisKZGlmZiAtLWdpdCBhL21vYmlsZS9jaHJvbWUvdGVzdHMvcmVtb3RlX2NvbnRlbnRwb3B1cC5q
cyBiL21vYmlsZS9jaHJvbWUvdGVzdHMvcmVtb3RlX2NvbnRlbnRwb3B1cC5qcwpuZXcgZmlsZSBt
b2RlIDEwMDY0NAotLS0gL2Rldi9udWxsCisrKyBiL21vYmlsZS9jaHJvbWUvdGVzdHMvcmVtb3Rl
X2NvbnRlbnRwb3B1cC5qcwpAQCAtMCwwICsxLDE4IEBACitkdW1wKCI9PT09PT09PT09PT09PT09
PT09PT09IENvbnRlbnQgU2NyaXB0IExvYWRlZCA9PT09PT09PT09PT09PT09PT09PT09PVxuIik7
CisKK2xldCBhc3Npc3RhbnQgPSBDb250ZW50Ll9mb3JtQXNzaXN0YW50OworCitBc3luY1Rlc3Rz
LmFkZCgiVGVzdFJlbW90ZUF1dG9jb21wbGV0ZTpDbGljayIsIGZ1bmN0aW9uKGFNZXNzYWdlLCBh
SnNvbikgeworICBsZXQgZWxlbWVudCA9IGNvbnRlbnQuZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQo
YUpzb24uaWQpOworICBhc3Npc3RhbnQub3BlbihlbGVtZW50KTsKKyAgYXNzaXN0YW50Ll9leGVj
dXRlRGVsYXllZChmdW5jdGlvbihhc3Npc3RhbnQpIHsKKyAgICBzZW5kQXN5bmNNZXNzYWdlKCJG
b3JtQXNzaXN0OkF1dG9Db21wbGV0ZSIsIGFzc2lzdGFudC5fZ2V0SlNPTigpKTsKKyAgfSk7Cisg
IHJldHVybiB0cnVlOworfSk7CisKK0FzeW5jVGVzdHMuYWRkKCJUZXN0UmVtb3RlQXV0b2NvbXBs
ZXRlOkNoZWNrIiwgZnVuY3Rpb24oYU1lc3NhZ2UsIGFKc29uKSB7CisgIGxldCBlbGVtZW50ID0g
Y29udGVudC5kb2N1bWVudC5nZXRFbGVtZW50QnlJZChhSnNvbi5pZCk7CisgIHJldHVybiBlbGVt
ZW50LnZhbHVlOworfSk7CisK
</data>
<flag name="review"
          id="438302"
          type_id="4"
          status="?"
          setter="21"
          requestee="mark.finkle"
    />
          </attachment>
      

    </bug>

</bugzilla>